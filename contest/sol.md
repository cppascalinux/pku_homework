# 题解
首先不难发现，对于序列k长度为偶数的情况，我们将所有数排序后，在最优方案中，最外侧的两个间隔会被计算2次，向里一层的两个间隔会被计算4次，再向里一层的两个间隔会被计算6次。。。以此类推，但最中间的一个间隔会被计算k-1次  
对于k为奇数的情况同理，不一样的是最中间的两个间隔中，较大的会被计算k-1次，较小的会被计算k-2次

因此对于没有修改的情况，只需要使用主席树维护，每次询问时只需要查询区间中位数，区间和，以及所有比中位数大的数的和，再减去某一段间隔即可计算出答案

对于带修的情况，将主席树换成树套树即可

时间复杂度$O(mlog^2n)$