文 档 说 明
 这 些文 档生 成自 restructuredtext  原文 档由 sphinx  一 个 专门 为 python  文档 写的 文 档生 成 器 创建
 本文档 和它 所用工 具 链 的 开 发完 全 是 由志 愿者 完 成 的 这 和 python  本身 一 样
 如 果您 想参 与进来 请 阅 读 解 决 bug  了 解如 何参 与
我 们随 时 欢 迎新 的 志 愿 者 非 常 感 谢 fred  l
 创 造了 用于 早 期 python  文档的 工具 链以 及撰写 了 非常 多的 文 档 docutils  软 件 包 项目 创建了 restructuredtext  文本 格式和 docutils  软件 套件 fredrik  lundhsphinx  从 他 的 alternative  python  reference  项目 中 获 得 了很 多 好的 想 法
python 文 档 贡 献 者
 解决 bug
python  是一 门 以稳定著称 的编 程 语 言
 为了保 持它 的稳定 性开发 者 们想 了解 您 在 python 中发 现 的任 何缺陷
有时 候自 己修 复 漏洞 并 将补丁 提 交给 python 能更 快地解决 问 题因为 它简 化 了 流 程 并且减 少了 参 与的 人力
请参 阅如 何提交 补丁
 文档 错误
 使用 python 的问 题追 踪系 统
 对 于 python  本身 的错 误 报告 应当 通过 python  错 误追 踪系 统 httpsbugs
org 进行 提 交
 该 错误 追踪系统提 供了 一个 可以 输 入并提 交相关信息 给开 发 者的网页 表单
第一 步 是确认 是否有 重 复 的报 告
 这样 做 除了 可以节 省开 发者 的 时 间也 能让 您从 中 了解 到我 们做出 了 怎 样的 努 力我们 有 可能 已经 在下 个版 本 中修复 了这个问题 也有 可能需 要 更详细 的信 息 在这 种情 况 下非 常 欢 迎您提 供
 要查找 重 复的报 告 请 使用 顶 部 的 搜 索栏进 行 搜索
如 果 您 没有 搜 索 到 您想报告 的问题 请返回 并 登 录 python  错误 追 踪系统
 如果您 没 有账 号请 点击 注 册 register 链 接 或 者在侧 边栏 中 选择 任 何一个 openid  登录 方式
 您 不能 匿名提交 一份错误报 告
 如果已 经登录 那 您就 可以 提交错误 报告了
请点 击 侧边栏 中的新 建 createnew  链接 打开报告表单
 表 单 中有 几 个 空栏 译 者注 请用 英语 填写
请在标 题 title 栏 填入对 问题 非常 简 短 的 描述 一个 好的 描述 应当 少于 十 个单 词
在 类 型 type 栏 选择 您的 问题 的类 型同样 地选择 bug 相 对应的组 件 component 和版本 versions
在说 明 comment  栏 请详 细 描述 问题 包括您预 期的情 况和 实际的 情况
 请确 保包 含任 何涉 及的 拓 展 模块 以及 您当 时 所使 用的 硬件 和软件平台 如果 可能 请 附上 版本 信 息
每一 份 错误 报 告 将被 分派 给一 名 开发 者 并由 这 名 开 发 者 决 定 如 何修 正 这 个问 题
 每当 有 相 关的进展 时您 都会 收到 通 知
参 见如 何有 效 地报 告错 误该 文章 详 细 介绍了 如 何 创建 一份 有 用的错 误报 告
它 描 述 了什 么 样 的信 息 是 有用 的 以 及为 什 么是 有用 的
 错误 报 告编 写 指 南关 于 写一份好 的错 误 报 告
 部 分 仅针 对 mozilla 项 目不 过其 描述 了 通 用的 恰当 做法
开 始 为 python  贡献 您的 知 识
除 了 仅 仅报 告 您 所 发现 的 错误 之外 同样 欢迎 您提 交修 复 它们 的 补 丁
您可以 在 python 开 发 者指 引中 找到更多为 python  打补 丁 的信 息
如 果 您有 任何 问 题 核 心 导师 邮件列 表是 一个 友好 的 去 处在 那 里你可以 寻求 修 复 python 相关问 题 的 答案
 抽象 对象 层
在堆中 分配 对象
 为新 分 配的 对象 op  初 始化 它的 类型 和 引用
 返 回 初始 化 后 的对 象
如 果 type  声明这个 对象 参与循环 垃圾 检测 那 么这个 对象 会被 添加进 垃 圾检 测的 对 象 集中
 这个 对象 的其他 字段 不 会被 影响
 它 的 功 能 和 pyobjectinit 一样 并且初始 化变 量大 小的 对 象的 长 度
 使 用 c  结构类 型 type 和 python  类 型对 象 type 分 配一 个 新的 python 对 象
 未在该 python  对 象头中 定义 的字段 不 会 被 初始化对 象 的 引 用 计数 将 为 一
内 存分配 大 小由 type  对象的 tpbasicsize 字 段来确定
 使用 c  的数据 结构 类型 type  和 python 的 类型对 象 type  分 配一个 新 的 python 对 象
python 对 象头文 件 中没 有定义 的 字段 不 会被 初始化
被 分 配 的内存 空间 预留 了 type 结构 加 type  对 象 中 tpitemsize 字 段 提 供 的 size 字 段的 值
这对于 实 现 类 似 元组 这 种 能 够在 构 造 期决定自 己大 小的 对象是 很实用 的
将字段 的数 组嵌 入到 相同的 内 存分配 中 可 以减 少 内存分 配 的 次数 这提 高了 内存 分配 的 效率
void  pyobjectdelvoid   op 释放 由 pyobjectnew  或 者 pyobjectnewvar 分 配内 存 的 对象
 这通 常由 对 象的 type 字段 定义 的 tpdealloc 处理 函数来 调用
 调 用 这 个函数 以 后 op 对 象 中 的 字段 都 不 可以 被 访 问因 为原分 配的 内存空间 已不再是 一 个 有 效的 python  对 象
pyobject  pynonestruct 像 none 一 样 的 python 对 象
这个对 象仅 可 以 使用 pynone  宏 访 问这 个宏取得 指向 这个 对象的 指针
 参见 pymodulecreate  分 配 内存和创建 扩展 模 块
api 和 abi  版本 管 理
pyversionhex 是 python 的 版本号 的 整数形式
 例如 如果 pyversionhex  被 置为0 x 030401 a 2 其 包含 的 版本信 息 可 以 通 过 以 下方 式 将其 作为 一 个32位 数 字来 处理 字 节位 数大 端字节 序 意义118 pymajorversion 3
1 a 2 中的32916 pyminorversion 3
1 a 2 中 的431724 pymicroversion 3
1 a 2中 的142528 pyreleaselevel 0 xa 是 alpha  版本0 xb  是 beta  版 本0 xc  发布 的候 选 版本 并且0 xf  是最 终 版 本 在这 个 例子 中这 个 版本 是 alpha 版 本
2932 pyreleaseserial 3
1 a 2中 的2最 终 版 本用0 因 此3
1 a 2的16 进 制 版本 号是0 x 030401 a 2
 所有 提到 的 宏都 定义 在 includepatchlevel
语 句解 释 及 变 量 编 译
 这 些 函 数 在创 建 你自己的 函数 时帮 助很 大
更 多 说明以 及实例可参 考说 明 文 档中的 扩展 和 嵌入 python  解释 器 小节
 这 些函 数 描 述的 前三 个 pyargparsetuplepyargparsetupleandkeywords 以 及 pyargparse 它 们都 使 用格 式 化 字符串来 将函 数期 待 的 参 数告 知函 数
这 些函数 都使 用 相 同语 法 规 则的 格式 化 字 符 串
 解析参 数
一个格 式化 字符 串包 含0 或者 更多 的 格 式 单 元
一个 格式 单 元用 来描 述一 个 python  对象它 通 常是一 个 字 符或者由 括 号括起 来的格 式单 元序 列
 除了 少数 例外 一 个 非括 号序 列的 格式 单元通常 对应 这 些 函 数的 具 有 单 一地 址的 参 数
 在接 下 来的 描述 中双 引 号 内 的表 达 式是 格式 单元 圆 括 号内的 是对 应 这个格 式单元 的 python 对 象 类 型方 括号 内的是传 递的 c  变 量 变 量 集 类型
 字 符 串和缓存区
 数字
b  int  unsigned  char  将一个 非 负的 python 整型 转 化 成一 个 无符号的 微整 型 存 储在一个 c  unsigned  char  类 型中
b  int  unsigned  char  将 一个 python  整型 转化 成 一个微整 型 并 不检 查 溢出问 题 存 储在 一个 c  unsigned  char  类型中
h  int  short  int 将 一 个 python 整型转 化 成 一个 c  short  int  短 整型
h  int  unsigned  short  int  将一 个 python 整型转化成 一个 c  unsigned  short  int  无 符 号 短 整型并 不检查 溢出 问题
i  int  int  将一 个 python  整型转化 成 一 个 c  int 整型
i  int  unsigned  int  将 一个 python  整 型 转 化 成 一个 c  unsigned  int  无符 号整型 并 不检 查溢 出问题
l  int  long  int 将 一个 python  整型 转化 成一个 c  long  int  长整型
k  int  unsigned  long  将一 个 python 整 型转化 成一 个 c  unsigned  long  int  无符号 长 整 型并 不检 查 溢 出 问题
l  int  long  long  将一 个 python 整 型 转 化 成 一 个 c  long  long  长长 整 型
k  int  unsigned  long  long  将一 个 python 整 型 转 化 成 一个 c  unsigned  long  long  无符 号长 长整 型并不检 查 溢出问 题
n  int  pyssizet  将一 个 python  整 型转 化 成 一个 c  pyssizet  python  元大小类 型
c  bytes 或 者 bytearray 长 度为1 char  将 一 个 python  字节 类型 如一 个 长 度 为1 的 bytes  或者 bytearray  对象 转 化 成一 个 c  char 字 符类 型
在3
3 版更 改允 许 bytearray 类 型 的对 象
c  str 长 度为1 int 将一 个 python 字 符 如 一个 长 度为1 的 str 字符串 对 象 转 化成 一个 c  int  整型类 型
f  float  float 将 一个 python  浮点 数转 化成 一 个 c  float  浮点数
d  float  double 将 一 个 python 浮 点数转 化 成一 个 c  double 双精度 浮点 数
d  complex  pycomplex 将 一个 python  复 数 类 型转化成 一个 c  pycomplex  python 复数 类 型
其 他对 象
o  object  pyobject 将 python  对象 不进 行 任何 转 换 存储在 c 对 象 指针中
 因 此 c  程序 接收 已传递的 实 际对 象
对 象 的引 用 计数 不会 增加
 存储的指针 不是 null
o  object  typeobject  pyobject  将一 个 python 对 象 存 入 一 个 c  对象指针
 这 类似 于 o 但是 接 受 两个 c 参 数 第一 个是 python  类 型 对象 的地 址 第 二个 是存储 对 象 指针的 c  变 量类型为 pyobject  的地 址
如 果 python 对 象 不具 有所要求 的 类 型则 会引 发 typeerror
o  object  converter  anything 通 过 一个 converter  函数 将 一个 python  对 象转 换为 一个 c  变量
 此 函数接 受 两个参 数第 一个 是函 数第 二个 是 c  变量 类型任 意的 地 址转换为 void  类 型
 converter 函 数 将以 如 下 方式 被 调用 status  converterobject  address 其 中 object 是待转 换 的 python 对 象 而 address  为 传 给 pyargparse 函 数 的 void 参 数
 返回 的 status  应当 以1代 表 转 换 成 功 而以0 代 表 转换 失败
 当转 换失 败 时 converter 函 数应 当引 发 异 常 并 且 会让 address  的内 容保 持未 修 改状 态
如 果 converter  返回 pycleanupsupported  则 如果 参数 解析 最终失败 它可 能会 再次 调用 该函 数从 而使 转 换器有 机会 释放 已 分 配 的任 何内 存
 在第 二个调 用中 object  参数 将为 null  因 此该参 数将 为 null  因 此 该 参 数 将为 null  因 此该 参数 将为 null  如果 值为 null  address  的值与 原始 呼叫中 的值相 同
在3
1 版更改 pycleanupsupported  被 添 加
p  bool  int  测试 传 入的值 是 否 为真 一个 布尔 判 断并 且 将结 果 转 化 为 相 对应的 c  truefalse  整型值
 如果 表达 式 为真 置1 假则 置0
它 接 受任 何 合法 的 python 值
 参 见 逻 辑值 检测获取 更 多 关 于 python 如 何测 试值 为真 的 信 息
3
3新 版功能
items  tuple  matchingitems  对象 必 须 是 python  序 列它 的长 度 是 items 中 格 式单 元的 数 量
c 参 数必 须对 应 items 中 每一 个独立 的格 式单 元
序 列 中的 格 式单 元可 能 有 嵌套
 传递 long  整型 整 型 的值 超 过了 平台 的 longmax  限制 是 可能的 然 而 没 有进行适 当的 范 围检测—— 当接 收字 段太 小而接 收不 到值 时最 重要 的位被静 默地 截断 实际 上 c 语 言会 在语义继承 的基 础 上 强 制 类 型 转 换——期 望的 值可 能会 发生变化
 格 式 化 字符串 中还有 一 些其 他的 字符具 有 特殊的 涵义
 这 些可能 并 不嵌套在 圆括 号中
它 们 是 表明 在 python  参 数列表 中 剩下的参 数 都 是 可选 的
c 变 量 对应的 可选参数 需 要初始 化为 默认值—— 当 一个 可 选参 数没 有 指定时 pyargparsetuple  不能 访问 相 应的 c 变 量变量集 的 内容
 pyargparsetupleandkeywords  only 表 明在 python  参数 列表中 剩下的参 数 都是 强 制关 键字 参数
 当前 所 有强制关键 字 参数 都必须 也 是 可选 参数 所以格式 化字 符串 中 必须 一直在前 面
3
3 新版 功能
 格式单 元的 列 表结 束标 志冒 号 后 的字 符 串被 用来 作为错 误消 息 中 的函 数 名 pyargparsetuple 函 数引 发的 关 联值 异常
格 式单元 的列表 结 束标 志分 号 后 的字符 串 被用来作为 错 误 消息 取 代默 认的 错 误 消息
和 相互排 斥
 注 意 任何 由 调 用 者 提 供的 python  对 象 引用 是借 来 的引 用 不 要 递减 它们 的引 用 计数传 递给这些 函数 的附 加参数 必 须 是由 格式 化字 符串 确定 的变 量 的 地 址这 些 都是 用 来存 储输 入 元 组的 值
有一 些情 况如 上 面的 格式 单元 列表 中所 描述的 这 些 参数作为输 入值 使 用在这 种 情况 下它 们应该匹 配指定的 相应 的格 式单 元
为了 转换成功 arg 对象必 须匹 配 格式并且 格 式必须 用 尽
成 功的话 pyargparse  函数返回 true  反之 它们 返回 false  并 且 引发 一 个 合 适 的异 常
 当 pyargparse 函 数因为 某一 个格 式单 元 转化 失败 而失 败 时 对 应 的以 及 后续的格 式单元 地址 内的 变量 都不 会被 使用
api 函 数
解 析一 个函 数的参数表 达式 中的参 数按 参数 位置 顺序 存入局 部 变量中
 成功返回 true  失败 返回 false  并 且 引 发 相 应的 异常
int  pyargvaparsepyobject   args  const  char   format  valist   vargs  和 pyargparsetuple 相 同然 而它 接受 一 个 valist 类型的 参数 而不 是可 变数 量 的 参数 集
 分析 将位 置参 数和 关键字 参数同 时转换为 局部 变量的函 数的参 数
 keywords 参 数是关键 字参 数名 称 的 null 终止数 组
 空 名称 表示 positionalonly  parameters
 成 功时 返回 true 发生 故障 时 它将 返回 false 并引 发 相应 的异 常
在3
6 版更改 添加了 positionalonly  parameters  的支持
int  pyargvaparsetupleandkeywordspyobject   args  pyobject   kw  const  char   format  char   keywords  valist   vargs  和 pyargparsetupleandkeywords 相同然 而它 接受 一个 valist 类 型的 参数 而 不 是可 变 数量的 参数 集
int  pyargvalidatekeywordargumentspyobject  确 保 字典 中 的 关 键字 参数 都 是字 符串
 这 个函 数 只被 使用于 pyargparsetupleandkeywords  不 被使用 的 情况 下 后者 已经不 再 做 这样的 检查
3
2 新 版 功能
 函 数被 用 来 析构旧 类型 函数的 参数 列表—— 这些函数 使 用 的 metholdargs 参 数 解析 方法已从 python 3 中移除
 这不 被 推 荐 用 于新 代 码 的参 数 解 析并 且在 标准 解释 器中 的大 多数 代 码已 被 修 改已 不 再用 于该目 的
它仍 然方 便于 分 解其 他元 组然 而可 能因 为这 个目 的被 继 续使用
 一个 更简 单的参数 提取 方式 它不 使 用格式字 符串 来 指定 参数类型
 使用 这种 方法 来提 取参 数的 函数 应 当 在 函数或 方法 表中 被 声 明 为 methvarargs
包含 实际 参数 的 元组 应当作为 args  传入 它 必须 确实 是一个元 组
元 组的 长度 必须 至少 为 min 并 且不 超过 maxmin  和 max  可 能 相等
额 外的 参数 必 须 被 传入函 数每 个参 数 必须 是一个指 向 pyobject 变 量 的 指 针它 们将 以 来 自 args  的值填 充 它们将包 含 暂 借 的引用
对 应于 可选 参 数的变 量 不会 由 args 给 出的值 填充 它们将由 调 用 者来 初 始化
 此 函 数执 行 成 功 时 返 回真 值如 果 args  不是 元组或 者包含 错 误数 量的 元素则 返回 假值 如果 执 行失 败则将 设置 一个 异常
 这是 一 个使 用此 函数 的示例 取自 weakref  帮助 模块 用来 弱化 引 用的 源代码 static  pyobject  weakrefrefpyobject  self  pyobject  args  pyobject  object  pyobject  callback  null  pyobject  result  null  if  pyargunpacktupleargs  ref 12 object  callback  result  pyweakrefnewrefobject  callback  return  result  这个 例子 中 调 用 pyargunpacktuple 完 全等 价于调 用 pyargparsetuple  pyargparsetupleargs  ooref  object  callback
创 建变 量
基 于类 似于 pyargparse  函 数系 列和一 系 列 值的 格式字 符串 创建新 值
 在出 现错 误 时 返回值 或 null  如果返回 null 将 引发 异 常
 pybuildvalue  并 不一 直创 建 一 个元组
 只有当 它 的 格式化字 符串 包含 两 个或 更多 的格 式单 元才 会创 建一 个元组
 如果 格 式化字 符 串是 空它返回 none  如 果 它包含一 个格 式 单 元 它返 回 由 格 式单元 描述 的 的任一 对 象
用 圆括 号包裹格 式 化 字符串 可 以 强制 它 返回一 个大 小 为0或 者1 的元 组
 当内存缓 存区的 数据 以 参数形式传 递用 来构建 对象 时 如 s 和 s 格式单元 会 拷贝 需要 的 数 据
调 用者提供 的缓 冲区 从 来 都不会被 由 pybuildvalue 创 建 的 对象 来引用
 换 句 话 说如 果 你的代 码调 用 malloc  并且将分配的 内 存 空间 传递 给 pybuildvalue  你的 代码就有 责任在 pybuildvalue  返回 时调 用 free 
在 下面 的描述中双 引号 的表 达式使格 式单元圆 括号 内 的是格式 单元将 要返 回 的 python  对 象类 型方括 号内 的是 传递 的 c 变 量 变量 集 的类 型
字 符 例 如 空格 制 表符 冒号 和逗 号 在格式 化 字符串中 会被 忽 略但 是 不包 括格 式单 元如 s
这 可以 使很 长 的格 式 化 字 符 串 具 有更 好的可 读 性
 s  str  或 none  const  char 使 用 utf 8 编 码 将 空 终止的 c 字 符 串 转换 为 python  str 对象
如果 c  字符 串 指 针 为 null 则 使用 none
 s  str 或 none  const  char  int  或 pyssizet 使 用 utf 8编 码将 c  字符 串及 其长 度转 换 为 python  str 对 象
 如果 c  字符串指 针为 null 则长 度将被忽 略并返回 none
 y  bytes  const  char 这 将 c 字符串 转换为 python  bytes 对象
 如果 c 字符 串 指针为 null  则返回 none
 y  bytes  const  char  int 或 pyssizet  这会将 c 字 符 串及其 长 度转换 为一个 python 对 象
如果该 c 字 符串指针 为 null  则返回 none
 z  str  or  none  const  char  和 s 一样
 z  str 或 none  const  char  int 或 pyssizet  和 s 一 样
 u  str  const  wchart  将空 终 止的 wchart 的 unicode  utf 16 或 ucs 4 数据缓 冲区转换 为 python  unicode 对象
如 果 unicode 缓冲区 指针为 null 则返 回 none
 u  str  const  wchart  int 或 pyssizet 将 unicode  utf 16或 ucs 4 数据缓冲区 及其长度 转换为 python  unicode 对 象
如果 unicode 缓 冲区 指针为 null 则 长度将被 忽略并返 回 none
 u  str 或 none  const  char 和 s 一 样
 u  str  或 none  const  char  int 或 pyssizet 和 s  一 样
 i  int  int 将一 个 c  int 整型转 化 成 python 整型对 象
 b  int  char 将一个 c  char  字 符型转 化成 python 整型 对 象
 h  int  short  int 将一个 c  short  int  短整型转 化成 python 整型 对 象
 l  int  long  int 将一 个 c  long  int 长整型 转 化成 python 整 型对象
 b  int  unsigned  char 将 一 个 c  unsigned  char 无符 号 字符型 转化成 python 整型 对 象
 h  int  unsigned  short  int 将一 个 c  unsigned  long 无符号短 整型转化成 python  整型对象
 i  int  unsigned  int  将一个 c  unsigned  long 无 符 号整型 转化成 python 整 型 对象
 k  int  unsigned  long 将一 个 c  unsigned  long 无符号 长整 型转化成 python  整 型对象
 l  int  long  long  将一 个 c  long  long 长 长整形 转 化 成 python  整形 对象
 k  int  unsigned  long  long 将 一个 c  unsigned  long  long 无符号长 长整 型 转化成 python 整 型 对象
 n  int  pyssizet 将一 个 c  pyssizet 类 型转 化为 python  整型
 c  bytes 长度 为1 char 将 一个 c  int  整 型 代表的字 符转化 为 python  bytes 长 度为1 的字 节对象
 c  str  长度为1 int 将一 个 c  int 整型 代表 的字 符 转化 为 python  str  长度为1的 字 符 串对 象
 d  float  double 将 一 个 c  double  双精度浮点 数 转化 为 python  浮 点数 类 型 数 字
 f  float  float 将 一个 c  float 单 精度浮 点 数 转 化为 python  浮点 数 类 型 数字
 d  complex  pycomplex 将 一个 c  pycomplex  类 型 的 结构 转化 为 python  复数类 型
 o  object  pyobject  将 python 对 象传 递不 变 其引 用计 数除外 该计 数由1递增
 如 果传入的对 象 是 null  指 针则假 定这 是由 于生 成 参数 的调 用发现 错误 并设 置异 常 而引 起的
因此 pybuildvalue  将返 回 null 但不 会 引发 异常
 如果尚 未 引发 异常 则设 置 systemerror
 s  object  pyobject  和 o 相 同
 n  object  pyobject  和 o 相同 然 而它 并不 增加 对 象的引用 计 数
当 通 过 调用参数 列 表中 的对 象 构造器创 建对象 时 很实用
 o  object  converter  anything  通过 converter  函数 将 anything 转 换 为 python 对象
该 函数调用 时会 传 入 anything 应 与 void  兼容 作为 参数 并且 应 当返 回一个新 的 python  对象或 者当发 生错 误时 返回 null
 items  tuple  matchingitems  将一个 c 变 量序 列转 换成 python  元组 并保持相同 的元 素数量
 items  list  相关 的 元 素 将一个 c  变量序列 转 换成 python 列 表 并保 持 相 同的元 素 数量
 items  dict  相 关 的元 素 将 一 个 c 变量 序 列转换 成 python 字 典
每一 对连 续 的 c  变 量 对 作 为一 个元 素插 入字 典中 分别作 为关 键字 和 值
如 果 格式 字符串 中 出现错 误 则 设置 systemerror  异常 并返 回 null
和 pybuildvalue 相 同然而 它 接 受一 个 valist  类型 的参 数而 不是可 变 数量 的参数 集
布 尔 对象
 缓 冲协议
 在 python 中可 使用一些 对 象来 包 装 对底 层 内存 数 组或 称缓 冲的 访问
 此类 对象 包括 内置 的 bytes 和 bytearray 以 及 一些如 array
array  这样 的扩 展类 型
 第 三方 库也 可能 会为 了特殊 的目的而定 义它 们 自己 的类 型例 如用 于图 像处理和 数值 分析 等
 虽然 这些 类型 中的 每一 种都 有自 己的 语义 但它 们具 有由可 能较 大的 内存缓 冲区 支持 的 共同 特征
 在某 些 情况下 希望 直接 访问 该缓 冲区 而无 需中 间 复 制
python 以 缓 冲协 议 的形式 在 c  层级上 提 供 这样的 功能
 此协 议 包 括 两个方面 在生 产者 这 一方面 该 类型 的协议 可以 导出 一个缓 冲 区 接 口允 许公开它 的 底 层 缓冲 区信 息
该 接 口的 描述信息 在 buffer  object  structures 一 节 中在消 费者 一侧有 几 种方 法 可用于 获得 指向 对象的 原始底层 数 据 的指针 例如 一个 方法 的 形 参
 一些 简单 的对 象 例如 bytes  和 bytearray 会 以面向 字节 的形 式公开 它们 的底 层缓 冲区
也 可 能 会用其 他 形式 例如 array
array  所公开 的元素 可以 是多 字 节值
 缓冲 区 接口 的 消费 者 的 一 个 例 子 是 文 件对象的 write  方 法任何 可以输 出 为一 系 列字节 流的对象 可 以被 写入 文 件
 然而 write  方法只需 要对于 传入 对象 的 只 读权 限其 他的方 法如 readinto 需要参 数内 容的 写 入权 限
缓 冲区接口 使得 对 象可以选择性 地 允 许或 拒绝读 写或只 读缓 冲 区 的 导 出
 对于 缓 冲 接口的 消费 者 而 言有 两 种 方 式来获取一个 目 的对 象的缓冲 使 用正 确 的参数 来调 用 pyobjectgetbuffer 函数 调用 pyargparsetuple 或 其同 级对象 之 一并 传 入 y  w  or  s 格式 代码中的一个
 在 这两 种 情 况 下当不 再需 要缓 冲区 时必 须 调 用 pybufferrelease  
 如果此 操作 失败可 能会导 致各 种 问题 例如 资 源 泄 漏
缓 冲 区结 构
 缓 冲区结构 或者 简 单 地 称为 buffers  对 于 将二 进制 数据 从另 一 个 对象 公开 给 python 程 序 员 非 常有 用
它 们还 可以用 作零 拷 贝 切片机制
 使用 它们 引用内 存 块 的 能 力 可以 很 容 易 地 将 任 何 数据 公 开 给 python  程 序 员
内 存 可 以是 c  扩展 中 的 一个 大 的 常量 数组 也 可以 是在 传 递 到操 作 系统库 之前 用于 操 作的 原始 内存 块 或 者可 以用 来 传递 本机内 存格 式的结构化 数据
与 python  解释 器公开 的 大 多部数 据类 型不同 缓冲 区不是 pyobject  指针 而是简单 的 c  结 构
 这 使 得 它 们 可以 非常 简单 地创 建和 复 制
 当 需要 为缓 冲区 加上 泛型 包 装 器时 可以创 建 一个内 存视图 对象
 有关如何编 写 并 导 出对象的简 短说 明 请参 阅缓冲 区 对象 结构
 要获 取 缓冲区 对 象请 参 阅 pyobjectgetbuffer
pybuffer  void  buf 指 向由 缓 冲 区 字 段 描 述 的 逻 辑 结 构开 始的指针
 这可 以是导 出 程 序底 层 物 理 内存 块 中 的 任何位置
 例如 使用 负的 strides  值 可能 指 向 内 存块的 末尾
 对于 contiguous ‘ 邻接’数 组值指 向 内存块 的开头
 void  obj  对导 出 对 象 的新引 用
该 引用归 使用者所 有并 由 pybufferrelease 自动 递减 并设 置为 null
 该字段 等 于 任 何 标准 capi 函 数 的 返 回 值
作 为一 种 特 殊情 况对 于 由 pymemoryviewfrombuffer 或 pybufferfillinfo 包 装 的 temporary  缓冲区 此字 段为 null 
 通常 导出对 象不 得 使用此 方案
 对于 连 续 数组 这 是 基础 内存块 的 长 度
 对于非 连续 数组 如果逻 辑 结 构复 制 到 连续 表示 形式 则 该长 度 将 具有该 长度
仅 当 缓 冲 区是 通 过 保证 连 续 性 的请求 获取时 才访问 char  buf 0 up  to  char  buflen 1 时 才有 效
 在 大 多 数 情 况下此 类 请求 将 为 pybufsimple  或 pybufwritable
 int  readonly 缓 冲 区是 否 为只 读的指 示器
此 字 段 由 pybufwritable  标志控 制
 pyssizet  itemsize 单 个元 素的项 大 小 以 字节为 单 位
与 struct
calcsize  调 用 非 null  format 的 值相 同
 重要 例 外 如果 使用 者请 求 的 缓 冲区 没 有 pybufformat 标志 format  将 设置为 null  但 itemsize  仍 具有 原始 格 式的 值
 如 果 shape 存在 则相 等的 productshape  itemsize  len  仍 然存 在使 用者 可以使用 itemsize 来 导 航缓 冲区
如 果 shape  是 null 因 为结 果 为 pybufsimple 或 pybufwritable 请 求则使用者 必须 忽 略 itemsize  并假设 itemsize 1
 const  char  format  在 struct  模块 样式 语法 中 nul 字符 串描述单 个项 的内 容
如果 这是 null  则 假 定 为 b  无 符 号字 节
 此 字 段由 pybufformat 标志控制
 shape  形状 数 组 中的值被 限定在 shapen 0
 shapen 0 这 一情形 需要特 别注 意
 更 多 信 息请 参阅 complex  arrays 
 shape  数组对于 使用者 来 说 是只读 的
 stride  步幅数组中 的 值可 以为 任 何整数
对 于 常规数 组 步幅通 常 为 正 数 但是 使 用者 必须 能 够处 理 stridesn 0的 情 况
 更 多信 息 请 参 阅 complex  arrays 
 strides 数组对 用户 来 说是 只 读的
 python  imaging  library  pil  中 使 用 了 这 种类 型 的 数 组表达 方 式
 请 参 阅 complex  arrays  来 了解 如何 从 这 样 一个 数 组中 访问 元 素
 suboffsets 数 组对 于 使 用 者来 说 是只 读的
buffer  request  types
requestindependent  fields
readonly  format
 形状 步幅子 偏移 量
 请 求 形 状步 幅 子 偏移 量 pybufindirect  是 是 如果需要的话 pybufstrides  是是 null  pybufnd 是 null  null  pybufsimple  null  null  null 
 连续 性 的请求
 请 求 形状 步 幅 子偏 移量 邻 接 pybufccontiguous 是 是 null  c  pybuffcontiguous 是 是 null  f  pybufanycontiguous 是 是 null  c 或 f  pybufnd 是 null  null  c 
 复合 请 求
所 有 可能 的 请 求都 由上 一 节 中 某些标 志的 组合 完全定 义
 为方 便起 见缓 冲 区协议 提供 常用 的 组合 作为 单个 标 志
 请求 形状 步幅子偏移 量 邻接只 读 格 式 pybuffull 是 是如果需 要 的 话 u 0 是 pybuffullro  是 是如果 需 要 的 话 u 1或0 是 pybufrecords  是是 null  u 0 是 pybufrecordsro  是是 null  u 1 或0 是 pybufstrided 是是 null  u 0 null  pybufstridedro  是 是 null  u 1或0 null  pybufcontig  是 null  null  c 0 null  pybufcontigro  是 null  null  c 1或0 null 
 复杂 数组
numpy  风 格形 状和 步幅
pil  风格 形状 步 幅和 子偏 移量
 缓冲 区 相关 函 数
3
9 新 版功 能
 otherwise  raise  pyexcbuffererror  set  viewobj  to  null  and  return 1如 果 此 函 数 用 作 getbufferproc  的 一 部分 则 exporter 必 须设 置为 导出 对象并 且必 须 在 未 修 改的 情况 下 传 递 flags
 否 则 exporter  必 须 是 null
 字 节 数组对 象
pybytearrayobject 这 个 pyobject 的子 类型 表 示一个 python  字节 数 组对 象
pytypeobject  pybytearraytype  python  bytearray 类 型 表示 为 pytypeobject  的 实例 这与 python  层面 的 bytearray  是 相 同的 对象
 类型 检查 宏
int  pybytearraycheckpyobject   o 当 对象 o  是一 个字 节数 组对 象 而 且 是 一 个 字 节数 组类 型 的 子 类型 实例时 返回真
int  pybytearraycheckexactpyobject   o 当对 象 o  是一 个字 节 数组对 象但 不是 一 个 字 节 数组 类型 的子 类 型 实 例 时 返回 真
 直接 api  函 数
根 据任 何 实现 了 缓冲 区 协 议的 对象 o  返回 一个 新的字节 数组 对象
 根据 string  及 其 长度 len  创 建一 个 新的 bytearray 对 象
 当 失 败时返回 null
 连接 字节 数组 a  和 b  并 返回 一个带 有结果 的新 的 字 节数 组
pyssizet  pybytearraysizepyobject   bytearray  在检查 null  指针后 返回 bytearray  的大小
char  pybytearrayasstringpyobject   bytearray  在 检查 null 指 针 后返 回将 bytearray  返回 为 一 个字 符 数 组
 返回 的数 组 总 是 会 附加一 个额外 的 空字 节
int  pybytearrayresizepyobject   bytearray  pyssizet   len  将 bytearray  的内 部缓冲 区的大 小 调 整为 len
 宏
这些 宏 减 低安 全性 以 换 取性能 它们 不 检 查 指针
char  pybytearrayasstringpyobject   bytearray  c  函 数 pybytearrayasstring  的宏 版 本
pyssizet  pybytearraygetsizepyobject   bytearray  c 函 数 pybytearraysize  的 宏版 本
 字 节对 象
呼叫 协 议
cpython 支 持 两 种 不 同的 调用 协 议 tpcall  和 矢 量 调 用
tpcall  协议
设 置 tpcall  的 类 的实 例 都 是可 调 用 的
槽 位 的签 名为 pyobject  tpcallpyobject  callable  pyobject  args  pyobject  kwargsa  call  is  made  using  a  tuple  for  the  positional  arguments  and  a  dictfor  the  keyword  arguments  similarly  to  callableargs  kwargs  inpython  code
the  vectorcall  protocol
3
9 新 版功 能
this  bears  repeating  警告 a  class  supporting  vectorcall  must  also  implement  tpcall  with  the  same  semantics
 注 解 in  cpython 3
 递归控 制
vectorcall  support  api
3
8 新版 功 能
3
8 新版功 能
3
8新 版功能
object  calling  api
 函数 callable  args  kwargs  pyobjectcall  pyobject  tuple  dictnull  pyobjectcallnoargs  pyobject  pyobjectcallonearg  pyobject 1 个对象 pyobjectcallobject  pyobject  元组 null  pyobjectcallfunction  pyobject  format  pyobjectcallmethod  对象 char  format  pyobjectcallfunctionobjargs  pyobject  可 变参 数 pyobjectcallmethodobjargs  对象 名称 可变 参数 pyobjectcallmethodnoargs  对 象名称 pyobjectcallmethodonearg 对 象名称1 个对象 pyobjectvectorcall  pyobject  vectorcall  vectorcall  pyobjectvectorcalldict  pyobject  vectorcall  dictnull  pyobjectvectorcallmethod 参 数 名 称 vectorcall  vectorcall  pyobject  pyobjectcallpyobject   callable  pyobject   args  pyobject   kwargs  return  value  new  reference
成 功 时返 回 结 果 在 失 败 时抛出 一 个异常 并返 回 null
成 功时返 回结果 在 失 败 时抛 出一个 异常 并返 回 null
3
9新 版功 能
成 功时 返 回结 果 在 失 败 时抛出 一 个 异 常并 返 回 null
3
9新 版功 能
 成 功时 返 回 结果 在失 败时抛 出一 个异 常 并返 回 null
这 等价 于 python 表达 式 callableargs
成 功时 返 回 结 果在 失败时 抛出 一 个异 常 并返 回 null
这 等价 于 python 表 达 式 callableargs
在3
4 版更 改 the  type  of  format  was  changed  from  char 
 成 功时返 回结果 在失 败时 抛出一 个异 常并返 回 null
 在3
4版更 改 the  types  of  name  and  format  were  changed  from  char 
 成 功 时 返 回结 果在 失 败 时 抛出 一个 异常 并返 回 null
这 和 python 表 达式 callablearg 1 arg 2
 是 一样 的
成功 时返 回结 果在 失败 时 抛出 一个 异 常 并返 回 null
成功 时返回 结果在 失 败时 抛 出 一个 异 常并返 回 null
3
9新 版功 能
 成功 时返回结 果在失 败时 抛 出 一个 异 常并 返回 null
3
9新 版 功 能
成 功时 返回 结果 在 失败 时抛 出一 个异 常 并 返回 null
3
9 新版 功 能
3
9 新 版功 能
成 功时 返回结 果在 失 败时 抛 出一 个异 常并返 回 null
3
9新 版 功能
call  support  api
capsule  对象
cell 对 象
cell 对象用 于实 现 由多 个作 用域 引用 的变 量
 对于 每个这 样的 变量一 个 cell 对 象 为了 存储 该 值而被 创建引 用该值 的每 个堆 栈框 架的 局部 变量 包含 同 样使 用 该变量 的对外部作 用 域的 cell  引 用
 访问该 值时 将 使用 cell  中包含 的值 而不 是单元 格 对象本 身
 这种 对 cell  对象 的非 关联化的 引 用需要 支持 生成的 字节 码访 问时不会自 动 非关联化 这些 内容
 cell 对 象在 其他 地 方可 能 不 太有用
pycellobject  用 于 cell 对象 的 c  结构 体
pytypeobject  pycelltype  与 cell 对 象 对 应 的 类型对​​ 象
int  pycellcheckob 如 果 ob 是一 个 cell  对象 则 返 回 真值 ob  必须 不为 null
 创建 并返回 一个包 含值 ob  的 新 cell 对 象
形 参可 以为 null
 返回 cell  对象 cell  的 内 容
返 回 cell 对象 cell  的内 容但是 不 检测 cell  是否 非 null  并且 为一 个 cell  对 象
int  pycellsetpyobject   cell  pyobject   value 将 cell  对象 cell  的 内 容设 为 value
这 将释 放 任 何对 cell 对象 当 前内 容 的引 用
 value  可以 为 null
 cell 必 须为非 null 如果 它不 是一个 cell  对象 则将 返 回1
如果 设置 成 功 则将 返 回0
void  pycellsetpyobject   cell  pyobject   value 将 cell  对 象 cell 的 值设为 value
 不 会 调整引用计 数并 且 不 会进 行检 测以保证 安 全 cell 必须 为 非 null  并 且 为一 个 cell 对 象
代码 对象
代 码 对 象是 cpython  实 现的 低 级 细节
 每个代 表一 块尚 未 绑 定 到 函数中 的可执 行 代码
pycodeobject  用 于描 述代 码对 象 的对 象的 c  结 构
此 类 型字段 可随 时更改
pytypeobject  pycodetype 这 是 一个 pytypeobject 实 例 其 表示 python  的 code 类 型
int  pycodecheckpyobject   co 如 果 co 是 一个 code 对 象 则 返 回 true
int  pycodegetnumfreepycodeobject   co 返 回 co  中的 自 由 变量 数
返回 一个 新的 代 码对 象
 如果你 需要一 个 虚 拟 代 码对 象来 创建 一 个代 码帧 请 使用 pycodenewempty
 调 用 pycodenew 直 接 可 以 绑定 到准 确 的 python 版 本 因 为字 节 码 的 定义 经 常变 化
类 似于 pycodenew 但 带 有 一个 额 外的 posonlyargcount  用于 仅限 位置参 数
3
8 新 版功 能
 返 回具 有 指定 文 件 名、函 数名 和 第 一 行号 的新空 代码 对 象
 对 于 exec 或 eval  生成的代 码对象 是非 法的
 编 解 码器 注 册与 支持 功能
int  pycodecregisterpyobject   searchfunction 注册 一 个 新 的编 解码 器搜索 函 数
 作为副作用 其 尝 试 加载 encodings  包如 果尚未 完 成 请确保它始 终位 于搜 索函 数列 表的 第一 位
int  pycodecknownencodingconst  char   encoding 根 据 注册 的给 定 encoding 的 编解 码 器是 否已 存在 而返回1 或0
此函 数 总能成 功
 泛型编 解 码器基 本编 码 api
 object 使 用由 errors  所定 义的错误 处理 方法 传递给 定 encoding 的编码 器 函 数
 errors 可以 为 null 表 示 使用 为编 码 器所定 义的默认 方 法
 如果找 不到 编码 器 则 会 引发 lookuperror
 泛型编解 码器 基本 解码 api
 object 使 用由 errors 所定 义 的 错误处 理方 法 传递 给定 encoding  的 解码器 函数
 errors 可以 为 null  表 示使用 为 编解 码器 所定义的 默认 方 法
如 果 找不 到 编解码器 则会 引 发 lookuperror
codec  查 找 api
 在 下 列 函 数中 encoding  字 符 串 会 被 查找 并转 换 为小写 字 母 形式 这使得通 过 此 机 制 查 找 编码 格式 实 际 上 对大 小 写 不 敏 感
如 果未找 到 任何 编解 码器 则将 设置 keyerror  并返回 null
为给定 的 encoding 获取一 个编码 器 函数
 为给定 的 encoding 获取一个 解码 器函数
为 给定 的 encoding  获取 一 个 incrementalencoder 对象
 为 给定的 encoding 获 取一 个 incrementaldecoder  对象
 为 给定 的 encoding 获 取 一 个 streamreader  工 厂 函数
 为给 定 的 encoding 获取 一 个 streamwriter  工厂 函 数
用 于 unicode  编 码错 误处理 程序 的 注 册 表 api
复数对 象
从 c  api  看 python 的 复 数对 象由两 个不 同的 部分 实现 一个 是在 python 程序使 用的 python 对象 另外 的是 一个 代表 真正 复 数值的 c  结构 体
api  提供 了 函 数共同 操 作两 者
表 示 复 数 的 c  结 构体
 表 示 复数 的 python 对 象
具 体 的对 象层
 本 章中的 函数 特定 于某些 python  对象类 型
将错误 类 型 的对 象传 递 给 它 们并 不是 一 个好 主 意如果 您从 python  程序接 收到 一个 对象 但 不 确 定它 是否具 有正 确 的类 型 则必须 首先 执行 类型 检查例 如要检查 对象 是否为字 典请 使用 pydictcheck
 本 章的 结 构类 似于 python  对象 类型 的家 族 树
 警告 虽然本 章所 描 述 的函 数 会 仔 细 检查 传入对 象的 类 型但 是 其中 许 多 函 数不 会检 查传入 的 对 象 是 否 为 null
允 许传入 null  可能导 致内 存访问 冲突 和解 释 器的立 即终止
 基本 对 象
 本节 描 述 python 类 型对 象 和单 一实例 对象  象 none
 type 对象 creating  heapallocated  types  none  对 象
数 值对 象
整数 型对 象布 尔 对 象浮点 数对 象 复 数对 象 表示复 数的 c 结 构体 表 示复 数的 python  对象
 序列 对象
 序 列对 象的 一般 操作 在 前 一章 中讨 论 过 本 节介绍 python  语言 固 有 的 特定 类型 的 序 列 对象
 字 节对 象 字节 数组 对象类型 检查 宏直 接 api  函数 宏 unicode 对 象和 编码 解 码器 unicode  对象 unicode  类型 unicode  字符属 性 creating  and  accessing  unicode  strings  deprecated  pyunicode  apis  locale  encoding  file  system  encoding  wchart  support  builtin  codecs  generic  codecs  utf 8 codecs  utf 32 codecs  utf 16 codecs  utf 7 codecs  unicodeescape  codecs  rawunicodeescape  codecs  latin 1 codecs  ascii  codecs  character  map  codecs  mbcs  codecs  for  windows  methods  slots  methods  and  slot  functions 元组 对 象结构 序列 对象 列表 对象
 容器对象
 字典 对象 集合对 象
函数对 象
 函 数对象 实 例方 法对 象方法 对 象 cell  对象 代码 对象
 其他 对象
 文 件 对 象模 块对 象 initializing  c  modules  singlephase  initialization  multiphase  initialization  lowlevel  module  creation  functions  support  functions  module  lookup 迭代器 对象 描述符对 象 切片 对象 ellipsis 对 象 memoryview 对 象 弱引用 对 象 capsule 对 象 生 成器对 象协程 对 象 上下 文变量 对 象 datetime 对 象
 上下 文变量 对象
字符串 转换 与格式化
 协程 对 象
3
5新 版 功能
协 程 对象是使 用 async 关 键 字声 明 的函 数返 回 的
pycoroobject  用 于 协 程对 象的 c  结 构体
pytypeobject  pycorotype 与 协 程 对象 对 应的 类 型 对​​象
int  pycorocheckexactpyobject   ob  如果 ob 的 类型 是 pycorotype  则 返 回真值 ob 必 须不 为 null
基 于 frame  对象 创建并 返回 一个 新的 协程 对象 其中 name 和 qualname 设为 name  和 qualname
此函数 会取得 一个 对 frame  的引用
 frame 参 数 必须 不为 null
datetime 对 象
datetime  模块 提 供了各 种日期 和 时 间 对象
 在 使用 任何 这些 函数 之前 必 须在你 的 源码 中包 含头 文 件 datetime
h 请 注 意 此文 件并 未包 含在 python
h  中并 且宏 pydatetimeimport 必须 被 发起调 用通常 是作为 模块初始化 函数的 一 部分
这个 宏会 将 指 向 特定 c  结构 的 指针 放入一 个静 态变量 pydatetimeapi  中它会 由下 面的宏 来使 用
 宏 访 问 utc  单例 pyobject  pydatetimetimezoneutc  返回 表 示 utc 的 时区 单例 与 datetime
utc  为同一对象
3
7 新 版功 能
类型检查 宏 int  pydatecheckpyobject   ob 如 果 ob 为 pydatetimedatetype  类型 或 pydatetimedatetype  的 某 个子 类型 则 返 回 真 值
 ob  不能 为 null
int  pydatecheckexactpyobject   ob 如 果 ob 为 pydatetimedatetype 类型则 返回 真值
 ob  不能 为 null
int  pydatetimecheckpyobject   ob  如果 ob 为 pydatetimedatetimetype  类型 或 pydatetimedatetimetype 的 某个 子 类型 则 返回 真 值
 ob 不 能为 null
int  pydatetimecheckexactpyobject   ob  如果 ob 为 pydatetimedatetimetype  类型 则返回 真值
 ob  不 能为 null
int  pytimecheckpyobject   ob  如 果 ob 的 类 型 是 pydatetimetimetype  或是 pydatetimetimetype  的子 类 型 则返 回 真 值
 ob  必 须不 为 null
int  pytimecheckexactpyobject   ob  如果 ob  的类 型 是 pydatetimetimetype 则 返 回 真值
 ob  必须 不为 null
int  pydeltacheckpyobject   ob 如果 ob  为 pydatetimedeltatype  类型 或 pydatetimedeltatype 的 某个 子 类型 则返 回真值
 ob  不能为 null
int  pydeltacheckexactpyobject   ob 如 果 ob  为 pydatetimedeltatype 类 型则 返 回真 值
 ob 不 能为 null
int  pytzinfocheckpyobject   ob 如 果 ob 为 pydatetimetzinfotype 类 型或 pydatetimetzinfotype  的某个 子类型 则返 回真值
 ob 不 能为 null
int  pytzinfocheckexactpyobject   ob 如果 ob  的类型 是 pydatetimetzinfotype 则返 回 真值
 ob  不 能为 null
 用于 创 建对 象的宏 pyobject  pydatefromdateint   year  int   month  int   day  return  value  new  reference
返 回指 定 年、 月、日 的 datetime
date 对象
 返回具有 指 定 year  month  day  hour  minute  second 和 microsecond  属性 的 datetime
datetime  对 象
 返回 具有 指 定 year  month  day  hour  minute  second  microsecond 和 fold  属 性 的 datetime
datetime  对 象
3
6 新 版功能
 返回 具 有 指 定 hour  minute  second  and  microsecond 属 性的 datetime
time 对 象
返回 具有指定 hour  minute  second  microsecond  和 fold  属性 的 datetime
time  对象
3
6新 版功能
返 回代 表给 定天、 秒和 微 秒数 的 datetime
timedelta 对 象
将 执 行正 规 化操 作以 使 最终 的微秒和秒 数处在 datetime
timedelta 对象 的 文档 指 明的 区 间之 内
返 回 一个 datetime
timezone  对象 该对 象具有 以 offset 参 数表 示的 未 命名 固定 时差
3
7新版 功 能
返回一 个 datetime
timezone 对 象该 对象具 有以 offset 参 数表 示的 固定 时差 和时区名 称 name
3
7新版 功能
一 些 用来从 date 对 象中提 取字段 的 宏
参数必 须是 pydatetimedate  包括 其子 类例 如 pydatetimedatetime  的实 例
参 数 必 须 不 为 null 并 且 类型 不被会检 查 int  pydatetimegetyearpydatetimedate   o 以正 整数的 形 式返 回年 份值
int  pydatetimegetmonthpydatetimedate   o  返回 月从0到12 的整 数
int  pydatetimegetdaypydatetimedate   o 返 回 日期 从0到31的 整数
一 些用来 从 datetime 对 象 中提取 字段 的 宏
参 数 必须是 pydatetimedatetime  包 括其 子类的实 例
参数 必须 不 为 null 并 且类 型不 会被 检查 int  pydatetimedategethourpydatetimedatetime   o  返回 小时 从0到23的 整数
int  pydatetimedategetminutepydatetimedatetime   o  返 回分钟 从0 到59 的整 数
int  pydatetimedategetsecondpydatetimedatetime   o 返 回 秒从0 到59的整 数
int  pydatetimedategetmicrosecondpydatetimedatetime   o 返 回微 秒从0 到999999的 整 数
一些 用 来从 time  对象 中 提取 字段 的宏
参 数必须 是 pydatetimetime  包括 其子类 的实例
 参数 必须不 为 null 并且 类 型不会 被检 查 int  pydatetimetimegethourpydatetimetime   o 返 回小 时从0 到23的 整数
int  pydatetimetimegetminutepydatetimetime   o  返 回分 钟 从0到59的 整数
int  pydatetimetimegetsecondpydatetimetime   o  返 回 秒 从0到59 的整 数
int  pydatetimetimegetmicrosecondpydatetimetime   o 返 回 微秒 从0到999999 的 整数
一 些用来从 timedelta 对 象中 提取字段的宏
 参数 必 须 是 pydatetimedelta 包 括其子类的 实 例
参 数 必须 不为 null 并且类 型不会 被 检查 int  pydatetimedeltagetdayspydatetimedelta   o  返回 天 数从999999999 到999999999 的整 数
3
3新 版功 能
int  pydatetimedeltagetsecondspydatetimedelta   o 返回 秒数 从0到86399 的整 数
3
3 新 版功 能
int  pydatetimedeltagetmicrosecondspydatetimedelta   o 返 回微 秒数从0到999999的 整数
3
3 新 版功 能
一 些便 于模块 实 现 db  api 的宏 pyobject  pydatetimefromtimestamppyobject   args  return  value  new  reference
创 建并 返 回一个 给 定元 组参数的新 datetime
datetime  对 象 适合 传给 datetime
 创 建并 返 回 一个给定元 组 参数 的新 datetime
date  对 象 适 合 传给 datetime
描 述符 对象
描 述 符是 描述 对象的某 些 属性 的对象
 它们 存在于 类型对 象 的字 典 中
pytypeobject  pypropertytype 内 建描述 符类 型的类 型对象
int  pydescrisdatapyobject   descr  如 果描 述符对 象 descr 描 述数据 属性则 返 回 true 如 果描述 方 法则 返回 false
 descr  必 须 是描 述符对 象没 有错误 检查
字 典 对象
 异常处 理
 注解 the  error  indicator  is  not  the  result  of  sys
printing  and  clearing
 抛 出 异 常
3
5新 版功 能
3
4新 版功 能
 可用性 windows
 可用 性 windows
可用 性 windows
可用 性 windows
 可用 性 windows
3
4新版 功能
可 用 性 windows
3
3 新 版 功能
3
4 新 版功能
3
2新 版 功 能
issuing  warnings
 the  standard  python  warning  categories  are  available  as  global  variables  whose  names  are  enumerated  at 标 准 警告 类 别
3
6新版功能
3
4 新 版功能
3
2 新版功能
3
6新 版功 能
querying  the  error  indicator
注解 do  not  compare  the  return  value  to  a  specific  exception  use  pyerrexceptionmatches  instead  shown  below
 注解 this  function  is  normally  only  used  by  code  that  needs  to  catch  exceptions  or  by  code  that  needs  to  save  and  restore  the  error  indicator  temporarily  e
注 解 this  function  is  normally  only  used  by  code  that  needs  to  save  and  restore  the  error  indicator  temporarily
 注解 this  function  does  not  implicitly  set  the  traceback  attribute  on  the  exception  value
 注 解 this  function  is  not  normally  used  by  code  that  wants  to  handle  exceptions
3
3新版 功 能
注 解 this  function  is  not  normally  used  by  code  that  wants  to  handle  exceptions
3
3新 版 功 能
signal  handling
在3
5 版更改 on  windows  the  function  now  also  supports  socket  handles
exception  classes
3
2 新 版功 能
exception  objects
unicode  exception  objects
3
3版后 已移除3
11 pyunicode  is  deprecated  since  python 3
 please  migrate  to  pyobjectcallfunctionpyexcunicodeencodeerror  sonns 
3
3 版后 已移 除3
11 pyunicode  is  deprecated  since  python 3
 please  migrate  to  pyobjectcallfunctionpyexcunicodetranslateerror  onns 
递归 控 制
在3
9 版 更改 this  function  is  now  also  available  in  the  limited  api
 在3
9 版 更改 this  function  is  now  also  available  in  the  limited  api
 标准异 常
 for  completenesshere  are  all  the  variables  c 名称 python  名称注释 pyexcbaseexception  baseexception 1 pyexcexception  exception 1 pyexcarithmeticerror  arithmeticerror 1 pyexcassertionerror  assertionerror  pyexcattributeerror  attributeerror  pyexcblockingioerror  blockingioerror  pyexcbrokenpipeerror  brokenpipeerror  pyexcbuffererror  buffererror  pyexcchildprocesserror  childprocesserror  pyexcconnectionabortederror  connectionabortederror  pyexcconnectionerror  connectionerror  pyexcconnectionrefusederror  connectionrefusederror  pyexcconnectionreseterror  connectionreseterror  pyexceoferror  eoferror  pyexcfileexistserror  fileexistserror  pyexcfilenotfounderror  filenotfounderror  pyexcfloatingpointerror  floatingpointerror  pyexcgeneratorexit  generatorexit  pyexcimporterror  importerror  pyexcindentationerror  indentationerror  pyexcindexerror  indexerror  pyexcinterruptederror  interruptederror  pyexcisadirectoryerror  isadirectoryerror  pyexckeyerror  keyerror  pyexckeyboardinterrupt  keyboardinterrupt  pyexclookuperror  lookuperror 1 pyexcmemoryerror  memoryerror  pyexcmodulenotfounderror  modulenotfounderror  pyexcnameerror  nameerror  pyexcnotadirectoryerror  notadirectoryerror  pyexcnotimplementederror  notimplementederror  pyexcoserror  oserror 1 pyexcoverflowerror  overflowerror  pyexcpermissionerror  permissionerror  pyexcprocesslookuperror  processlookuperror  pyexcrecursionerror  recursionerror  pyexcreferenceerror  referenceerror 2 pyexcruntimeerror  runtimeerror  pyexcstopasynciteration  stopasynciteration  pyexcstopiteration  stopiteration  pyexcsyntaxerror  syntaxerror  pyexcsystemerror  systemerror  pyexcsystemexit  systemexit  pyexctaberror  taberror  pyexctimeouterror  timeouterror  pyexctypeerror  typeerror  pyexcunboundlocalerror  unboundlocalerror  pyexcunicodedecodeerror  unicodedecodeerror  pyexcunicodeencodeerror  unicodeencodeerror  pyexcunicodeerror  unicodeerror  pyexcunicodetranslateerror  unicodetranslateerror  pyexcvalueerror  valueerror  pyexczerodivisionerror  zerodivisionerror 3
3 新版功能 pyexcblockingioerror  pyexcbrokenpipeerrorpyexcchildprocesserror  pyexcconnectionerrorpyexcconnectionabortederror  pyexcconnectionrefusederrorpyexcconnectionreseterror  pyexcfileexistserrorpyexcfilenotfounderror  pyexcinterruptederrorpyexcisadirectoryerror  pyexcnotadirectoryerrorpyexcpermissionerror  pyexcprocesslookuperror  andpyexctimeouterror  介 绍如 下 pep 3151
3
5新版 功能 pyexcstopasynciteration 和 pyexcrecursionerror
3
6新 版 功能 pyexcmodulenotfounderror
这 些是 兼容 性别 名 pyexcoserror  c  名称 注 释 pyexcenvironmenterror  pyexcioerror  pyexcwindowserror 3 在3
3 版更改 这些 别 名 曾经 是 单独 的 异常 类型
注 释1
这 是其他 标准 异常 的 基类
 标 准警 告 类 别
 forcompleteness  here  are  all  the  variables  c 名 称 python  名称 注释 pyexcwarning  warning 1 pyexcbyteswarning  byteswarning  pyexcdeprecationwarning  deprecationwarning  pyexcfuturewarning  futurewarning  pyexcimportwarning  importwarning  pyexcpendingdeprecationwarning  pendingdeprecationwarning  pyexcresourcewarning  resourcewarning  pyexcruntimewarning  runtimewarning  pyexcsyntaxwarning  syntaxwarning  pyexcunicodewarning  unicodewarning  pyexcuserwarning  userwarning 3
2新 版功 能 pyexcresourcewarning
注释1
这是其 他标准警 告类 别的 基类
 文件对 象
这此 api  是 对 内置 文件 对象的 python 2 c  api  的 最 小仿 真 它 过 去 依赖于 c  标准库 的 缓冲 io  file  支持
在 python 3 中 文件 和 流 使用 新 的 io 模块该 模 块 在 操作 系统的 低 层 级 无缓 冲 io  之 上定 义了 几 个层
 下面 所 描 述的函数 是针 对这些新 api 的 便捷 c 包 装 器主要 用 于解释 器的 内 部错 误 报 告 建议 第三 方 代码改 为访问 io  api
 根据 已打 开 文件 fd 的 文 件 描 述符创建 一个 python  文 件 对象
 参 数 name  encoding  errors 和 newline  可以 为 null  表示 使 用 默 认值 buffering  可 以为1 表示使用 默 认 值
 name  会被忽略仅 保 留用 于 向下 兼 容
 失 败时 返 回 null
 有关 参 数的 更 全面 描述 请 参阅 io
open 函 数 的 文 档
 警告由 于 python 流 具有自 己 的 缓冲 层因 此将 它们与 os 级 文件 描 述 符 混合 会 产生 各种 问题 例如 数据 的意外 排序
 在3
2版 更改 忽 略 name 属 性
int  pyobjectasfiledescriptorpyobject   p 将与 p  关联的 文件 描 述器 返回 为 int 
如 果 对象 是 整数 则返 回 其值
如 果没有 则 调 用对 象 的 fileno 方 法 如果 存 在该 方法必须返 回 一 个整 数该 整 数作 为 文 件描 述器 值 返回
 设置 异常 并在 失败时返 回1
 等价于 p
readlinen  这个函 数从 对象 p 中 读取一行
 p  可以 是 文 件对象 或具 有 readline 方法 的 任 何对 象
 如 果 n 是0则无 论 该行的长度 如何都 会读 取一 行
 如 果 n 大于0 则从 文 件中读取 不 超过 n  个 字 节可 以 返回行 的一 部分
 在这两 种情况 下 如 果立 即到 达文件 末 尾 则返 回空 字符 串
但 是如 果 n  小 于0 则无 论长度 如何 都会读 取 一行 但是 如果立 即到达 文件末尾则 引 发 eoferror
int  pyfilesetopencodehookpyopencodehookfunction   handler 重 载 io
opencode 的 正常 行为 将其形参 通过 所提供 的处 理程 序来 传递
 处理程 序是 一 个类型 为 pyobject  pyobject  path  void  userdata  的函数其 中 path 确 保为 pyunicodeobject
 userdata  指针会 被传入钩子 函数
因 于钩 子函 数可 能由 不同 的运 行 时 调用 该 指针 不 应直接 指向 python 状 态
鉴 于这 个钩 子专门 在导 入期间 使用 的请 避免 在新 模 块 执 行期 间进 行 导 入操 作 除非 已 知它 们为 冻结 状态 或 者是在 sys
modules  中 可用
一 旦钩 子 被设定 它就 不能 被移除 或替 换之 后对 pyfilesetopencodehook  的调用 也将失败如 果解释 器 已经 被 初始 化函 数 将返 回1并 设置一 个异常
此函 数可 以安 全地 在 pyinitialize  之前 调 用
引 发 一 个审 计事 件 setopencodehook  不附 带任何 参数
3
8 新版 功 能
int  pyfilewriteobjectpyobject   obj  pyobject   p  int   flags  将 对象 obj  写入 文件 对象 p 
 flags  唯 一支 持 的 标志是 pyprintraw  如果 给定则 写 入对象 的 str 而不是 repr
 成 功时 返回0 失败 时 返 回1
 将 设 置适 当 的 例外
int  pyfilewritestringconst  char   s  pyobject   p  将字 符串 s 写 入文件 对 象 p
成功 返回0失败 返 回1将 设定 相应 的异 常
浮点数 对 象
pyfloatobject 这 个 c  类型 pyobject  的 子类型 代 表 一 个 python  浮 点数 对象
pytypeobject  pyfloattype  这是 个 属 于 c 类 型 pytypeobject 的代 表 python 浮 点 类型 的实 例
在 python 层 面的 类型 float  是 同一 个对 象
int  pyfloatcheckpyobject   p 当 他 的参 数是 一个 c  类型 pyfloatobject  或者 是 c  类型 pyfloatobject  的子 类 型 时返 回真
int  pyfloatcheckexactpyobject   p  当他的 参数是一 个 c 类 型 pyfloatobject  但不 是 c  类型 pyfloatobject  的子 类型 时返回 真
根 据字 符 串 str 的 值 创 建 一 个 pyfloatobject  失败 时 返 回 null
 根据 v  创建 一个 pyfloatobject  对象 失 败时返 回 null
double  pyfloatasdoublepyobject   pyfloat  返 回 一 个 c  double 代 表 pyfloat  的内 容
如 果 pyfloat 不 是 一 个 python 浮点 数 对 象 但 是具 有 float  方 法 此 方法 将首 先 被调 用将 pyfloat 转 换成 一个 数 点数
 如果 float  未 定义 则将 回退 至 index
如 果失 败此 方法 将返回1
0因 此开 发者应 当调 用 pyerroccurred 来 检 查 错误
在3
8 版更改 如果 可 用将 使用 index
double  pyfloatasdoublepyobject   pyfloat  返 回 一 个 pyfloat 内 容 的 c  double 表示 但没 有 错 误检 查
返 回一 个 structseq 实例其 中包 含 有关 float  的 精 度、最 小 值和最大值 的信 息
它是 头文件 float
h  的一个简 单包 装
double  pyfloatgetmax 返 回最 大可表 示的 有限浮点 数 dblmax  为 c  double 
double  pyfloatgetmin 返 回 最 小 可表 示 归一 化 正 浮点 数 dblmin  为 c  double 
函 数 对象
 使对象 类型 支持 循环垃 圾回 收
生 成 器对 象
生 成器 对 象是 python  用来 实现生成 器迭代器的 对 象
 它们 通常 通过 迭 代 产 生值 的函 数来创 建而 不是 显 式 调 用 pygennew 或 pygennewwithqualname
pygenobject  用于生成 器 对象 的 c 结 构体
pytypeobject  pygentype  与 生 成器 对象 对应 的类 型对​​象
int  pygencheckpyobject   ob  如果 ob  是 一 个生成 器对 象则 返回 真值 ob  必须 不为 null
int  pygencheckexactpyobject   ob 如 果 ob 的类 型为 pygentype  则返回 真值 ob  必须 不 为 null
基 于 frame 对 象创建并 返回 一 个新 的 生 成器 对象
 此函 数会 取走 一个对 frame  的 引用
 参数必 须不 为 null
基 于 frame  对象创建 并 返 回一个新的 生成 器对 象其中 name 和 qualname 设 为 name 和 qualname
 此 函 数 会 取走 一个 对 frame  的引用
 frame  参 数 必 须不 为 null
导 入 模块
 该函数 总 是使 用 绝对 路径 导入
 该函 数是 pyimportimportmodule  的一 个被 弃用的别 名
在3
3 版更 改 this  function  used  to  fail  immediately  when  the  import  lock  was  held  by  another  thread
3 though  the  locking  scheme  switched  to  permodule  locks  for  most  purposes  so  this  functions  special  behaviour  isnt  needed  anymore
3
3新 版功能
在3
3 版更改 negative  values  for  level  are  no  longer  accepted
 该 函数 总是 使用 绝对 路 径导 入
注 解 this  function  does  not  load  or  import  the  module  if  the  module  wasnt  already  loaded  you  will  get  an  empty  module  object
3
3新 版功 能
 参见 pyimportexeccodemodulewithpathnames
3
3 新 版 功能
3
2 新 版 功能
在3
3 版更 改 uses  imp
sourcefromcache  in  calculating  the  source  path  if  only  the  bytecode  path  is  provided
 在3
3版 更改 失败时返 回 值1
3
2新版功能
3
7 新版 功能
3
3 新版 功 能
 在3
4 版更改 the  file  attribute  is  no  longer  set  on  the  module
h  is  struct  frozen  const  char  name  const  unsigned  char  code  int  size  const  struct  frozen  pyimportfrozenmodules  该 指 针被初始 化 为指向 struct  frozen  数组 以 null  或者0 作为 结 束标 记
 当一个 冻 结模 块 被导 入首先要 在 这 个 表中 搜 索
 第三 方库可 以以 此 来提供 动态 创 建的冻 结模 块集 合
pythonc  api  参考 手册
 本手 册描 述 了希 望编写扩 展 模块 并 将 python 解释 器 嵌入 其 应用 程序 中的 c  和 c 程 序 员可用的 api
 同时 可以 参阅 扩展和 嵌入 python  解释 器 其 中描述 了扩展编 写的一般 原 则但没 有 详细描 述 api  函数
概 述代码标准 包 含文件 有用 的宏对象、 类型和引 用计数异 常 嵌入 python  调 试构建稳 定的应 用程序 二进制 接 口 the  very  high  level  layer 引 用计 数 异常 处理 printing  and  clearing  抛 出 异常 issuing  warnings  querying  the  error  indicator  signal  handling  exception  classes  exception  objects  unicode  exception  objects 递 归控 制标准 异常 标 准警 告类 别工具 操作 系统实 用 程序系 统 功 能过 程控 制 导入 模 块数 据 marshal  操作支 持 语句 解释 及变 量编译 字符 串转 换 与 格 式化 反射 编解 码器 注 册与支 持功 能抽 象 对 象层对 象协 议 呼叫 协 议 数字 协议 序列协 议映 射协议迭 代器 协议 缓 冲 协 议旧缓 冲协 议具 体 的对 象 层基 本 对象 数 值 对象序 列对 象容 器对 象函数 对象其 他对 象 initialization  finalization  and  threads  在 python  初始 化之 前 全局 配 置变 量 initializing  and  finalizing  the  interpreter  processwide  parameters  thread  state  and  the  global  interpreter  lock  subinterpreter  support 异 步 通知分 析和 跟 踪高级 调 试 器支持 thread  local  storage  support  python  初始 化配 置 pywidestringlist  pystatus  pypreconfig  preinitialization  with  pypreconfig  pyconfig  initialization  with  pyconfig  isolated  configuration  python  configuration  路径配 置 pyrunmain  pygetargcargv  multiphase  initialization  private  provisional  api 内 存 管 理概 述原 始内 存接口 内存 接口 对象 分 配 器默认 内存 分配器 自定 义内 存 分 配 器 pymalloc  分 配 器 tracemalloc  c  api 示例 对 象 实现支 持在 堆中 分配 对 象 common  object  structures  type 对 象 number  object  structures  mapping  object  structures  sequence  object  structures  buffer  object  structures  async  object  structures  slot  type  typedefs 例 子使 对 象类型支 持循 环 垃圾 回 收 api 和 abi  版 本管理
initialization  finalization  and  threads
 请参 阅 python  初 始化 配 置
在 python 初始 化 之前
 在 初 始化 python 之 前可 以安 全地调 用以 下函 数配 置 函数 pyimportappendinittab  pyimportextendinittab  pyinitfrozenextensions  pymemsetallocator  pymemsetupdebughooks  pyobjectsetarenaallocator  pysetpath  pysetprogramname  pysetpythonhome  pysetstandardstreamencoding  pysysaddwarnoption  pysysaddxoption  pysysresetwarnoptions 信 息函数 pyisinitialized  pymemgetallocator  pyobjectgetarenaallocator  pygetbuildinfo  pygetcompiler  pygetcopyright  pygetplatform  pygetversion 工 具 pydecodelocale 内 存 分 配器 pymemrawmalloc  pymemrawrealloc  pymemrawcalloc  pymemrawfree  注 解以 下 函数 不应 该 在 pyinitialize  pyencodelocale  pygetpath  pygetprefix  pygetexecprefix  pygetprogramfullpath  pygetpythonhome  pygetprogramname  和 pyevalinitthreads  前 调 用
全 局 配 置 变量
initializing  and  finalizing  the  interpreter
注解 on  windows  changes  the  console  mode  from  otext  to  obinary  which  will  also  affect  nonpython  uses  of  the  console  using  the  c  runtime
3
6新 版功能
processwide  parameters
3
4新 版功 能
 在3
8版 更改 the  program  full  path  is  now  used  for  sys
 注解 it  is  recommended  that  applications  embedding  the  python  interpreter  for  purposes  other  than  executing  a  single  script  pass 0 as  updatepath  and  update  sys
pop 0 n 3
3 新版功 能
在3
4 版更 改 the  updatepath  value  depends  on  i
thread  state  and  the  global  interpreter  lock
releasing  the  gil  from  extension  code
 注解 calling  system  io  functions  is  the  most  common  use  case  for  releasing  the  gil  but  it  can  also  be  useful  before  calling  long  running  computations  which  dont  need  access  to  python  objects  such  as  compression  or  cryptographic  functions  operating  over  memory  buffers
 非 python  创建 的线程
cautions  about  fork
 in  addition  it  resets  any  锁对 象 inthe  child
高 阶 api
 在3
9 版更改 the  function  now  does  nothing
在3
7 版更 改 this  function  is  now  called  by  pyinitialize  so  you  dont  have  to  call  it  yourself  anymore
在3
2版 更改 this  function  cannot  be  called  before  pyinitialize  anymore
 在3
7版 更 改 the  gil  is  now  initialized  by  pyinitialize
注 解 calling  this  function  from  a  thread  when  the  runtime  is  finalizing  will  terminate  the  thread  even  if  the  thread  was  not  created  by  python
注 解 calling  this  function  from  a  thread  when  the  runtime  is  finalizing  will  terminate  the  thread  even  if  the  thread  was  not  created  by  python
3
4新版功 能
lowlevel  api
在3
7 版更 改 pyinitialize  now  initializes  the  gil
在3
9 版 更 改 this  function  now  calls  the  pythreadstate
3
9 新版 功 能
3
9 新版 功能
3
9新 版功 能
3
9新 版 功 能
3
7 新版 功能
3
8 新版 功能
在3
9版更 改 the  function  now  takes  a  tstate  parameter
3
9新 版功 能
3
9新 版 功能
 在3
7 版更 改 the  type  of  the  id  parameter  changed  from  long  to  unsigned  long
注解 calling  this  function  from  a  thread  when  the  runtime  is  finalizing  will  terminate  the  thread  even  if  the  thread  was  not  created  by  python
 在3
8版 更 改 updated  to  be  consistent  with  pyevalrestorethread  pyendallowthreads  and  pygilstateensure  and  terminate  the  current  thread  if  called  while  the  interpreter  is  finalizing
3
2 版 后 已 移除 this  function  does  not  update  the  current  thread  state
注解 calling  this  function  from  a  thread  when  the  runtime  is  finalizing  will  terminate  the  thread  even  if  the  thread  was  not  created  by  python
 在3
8 版更 改 updated  to  be  consistent  with  pyevalrestorethread  pyendallowthreads  and  pygilstateensure  and  terminate  the  current  thread  if  called  while  the  interpreter  is  finalizing
3
2版 后已 移除 this  function  does  not  update  the  current  thread  state
subinterpreter  support
错误 和 警告
 异步 通知
 警告 this  is  a  lowlevel  function  only  useful  for  very  special  cases
在3
9 版更 改 if  this  function  is  called  in  a  subinterpreter  the  function  func  is  now  scheduled  to  be  called  from  the  subinterpreter  rather  than  being  called  from  the  main  interpreter
 each  subinterpreter  now  has  its  own  list  of  scheduled  calls
3
1新 版功 能
分析 和跟踪
 the  first  parameter  is  the  object  passed  to  the  registration  function  as  obj  frame  is  the  frame  object  to  which  the  event  pertains  what  is  one  of  the  constants  pytracecall  pytraceexception  pytraceline  pytracereturn  pytraceccall  pytracecexception  pytracecreturn  or  pytraceopcode  and  arg  depends  on  the  value  of  what  what  的 值 arg 的含 义 pytracecall  总是 pynone
 pytraceexception  sys
excinfo  返回的 异常 信息
 pytraceline  总是 pynone
 pytracereturn  value  being  returned  to  the  caller  or  null  if  caused  by  an  exception
 pytraceccall  正在 调 用函数对 象
 pytracecexception 正在 调 用函 数对 象
 pytracecreturn 正在 调用 函数 对 象
 pytraceopcode 总是 pynone
 int  pytracecall  the  value  of  the  what  parameter  to  a  pytracefunc  function  when  a  new  call  to  a  function  or  method  is  being  reported  or  a  new  entry  into  a  generator
 高 级调 试器支 持
thread  local  storage  support
 注解 none  of  these  api  functions  handle  memory  management  on  behalf  of  the  void  values
thread  specific  storage  tss  api
3
7 新版 功能
参 见 a  new  capi  for  threadlocal  storage  in  cpython  pep 539 pytsst  this  data  structure  represents  the  state  of  a  thread  key  the  definition  of  which  may  depend  on  the  underlying  tls  implementation  and  it  has  an  internal  field  representing  the  keys  initialization  state
注 解 a  freed  key  becomes  a  dangling  pointer  you  should  reset  the  key  to  null
 方法 the  parameter  key  of  these  functions  must  not  be  null
thread  local  storage  tls  api
3
7版 后 已 移 除 this  api  is  superseded  by  thread  specific  storagetss  api
注解 this  version  of  the  api  does  not  support  platforms  where  the  native  tls  key  is  defined  in  a  way  that  cannot  be  safely  cast  to  int
 由于上 面提 到的 兼 容性 问 题不 应在新 代 码中使 用此 版 本 的 api
python 初始 化配 置
3
8新 版功能
 结构 pyconfig  pypreconfig  pystatus  pywidestringlist  函数 pyconfigclear  pyconfiginitisolatedconfig  pyconfiginitpythonconfig  pyconfigread  pyconfigsetargv  pyconfigsetbytesargv  pyconfigsetbytesstring  pyconfigsetstring  pyconfigsetwidestringlist  pypreconfiginitisolatedconfig  pypreconfiginitpythonconfig  pystatuserror  pystatusexception  pystatusexit  pystatusiserror  pystatusisexit  pystatusnomemory  pystatusok  pywidestringlistappend  pywidestringlistinsert  pyexitstatusexception  pyinitializefromconfig  pypreinitialize  pypreinitializefromargs  pypreinitializefrombytesargs  pyrunmain  pygetargcargvthe  preconfiguration  pypreconfig  type  is  stored  inpyruntime
参见 pep 587 python  初始 化配 置
pywidestringlist
方 法 pystatus  pywidestringlistappendpywidestringlist   list  const  wchart   item  append  item  to  list
 structure  fields  pyssizet  length  list  长度
 wchart  items 列 表项目
pystatus
pypreconfig
 int  devmode 参 见 pyconfig
 int  isolated 参 见 pyconfig
 int  useenvironment 参 见 pyconfig
preinitialization  with  pypreconfig
pyconfig
initialization  with  pyconfig
isolated  configuration
python  configuration
路径 配置
pyconfig  contains  multiple  fields  for  the  path  configuration  路径 配置 输入 pyconfig
pth  仅 windows  pybuilddir
txt  仅 unixthe  pyvenvlauncher  environment  variable  is  used  to  setpyconfig
pyrunmain
pygetargcargv
multiphase  initialization  private  provisional  api
path  enable  optional  features  like  faulthandler  and  tracemalloc  import  the  site  module 等等
 概述
python 的 应用 编程 接 口 api 使 得 c  和 c 程 序员可以 在多个 层级上 访 问 python 解 释器
 该 api 在 c 中 同样 可用 但 为简 化 描述 通常将 其称 为 pythonc  api
使 用 pythonc  api  有 两 个基本的 理 由
第 一 个理 由是 为了 特 定目的 而编 写扩展 模块 它们 是 扩展 python 解 释器 功能的 c 模 块
 这可能是 最 常见 的使 用场景
 第 二个 理 由 是将 python  用作更大 规模 应用 的 组件 这 种技 巧 通常被称 为 在 一个 应用 中 embedding  python
编 写 扩 展模 块的过 程 相 对来说 更 易于 理解 可以 通过菜谱 的 形式 分 步骤介绍
 使 用某 些工具 可在 一定程 度上 自 动化 这 一过 程
虽 然人 们 在 其他应用中 嵌 入 python 的 做法早 已有 之 但嵌 入 python 的 过程 没有 编 写扩展 模 块 那 样 方 便直 观
 许多 api  函 数 在 你嵌 入或 是 扩展 python  这两 种 场 景下 都 能 发 挥作用 此外 大多数 嵌 入 python  的应 用程 序 也需要 提 供自 定 义 扩 展 因 此在 尝试在 实 际应 用中嵌 入 python  之前 先 熟 悉 编写 扩 展应 该 会 是个好 主意
 代码 标 准
 如 果 你 想 要 编 写 可 包 含于 cpython  的 c 代 码 你 必须 遵循 在 pep 7中 定义 的指 导原 则和标 准
 这 些指 导 原则 适用于 任何 你 所 要 扩 展的 python  版本
 在编写 你自 己的 第 三 方 扩 展 模块 时可 以不 必 遵 循这 些 规范 除非 你 准备 在日 后向 python 贡 献 这些模 块
包 含 文 件
 使 用 pythonc  api  所 需 要的 全部 函 数、 类型 和 宏 定 义 可 通 过 下面 这行语 句 包含到 你的 代码 之中 define  pyssizetclean  include  python
h  这意 味着 包 含 以 下 标准 头 文 件 stdio
hstring
herrno
hlimits
hassert
h  和 stdlib
h 如 果 可 用
 注解 由于 python 可 能会 定义 一些 能 在 某 些系 统 上 影响标准 头 文件的预 处 理器定 义 因此 在包含任何 标准 头文 件 之 前你 必须先 包 含 python
h
it  is  recommended  to  always  define  pyssizetclean  before  including  python
 see 语句解释及变 量 编 译 for  a  description  of  this  macro
python
h  所定 义 的全 部 用 户可 见 名称 由包含 的标准 头 文件 所定 义 的 除外 都 带有 前 缀 py 或 者 py
以 py  打头 的名 称 是供 python  实现内 部使 用 的 不应 被 扩 展编 写者 使用
 结构 成员名 称没有 保留 前 缀
注 解 user  code  should  never  define  names  that  begin  with  py  or  py
头 文 件 通常 会 与 python 一 起安 装
在 unix  上 它 们位 于 以下目 录 prefixincludepythonversion  和 execprefixincludepythonversion 其 中 prefix  和 execprefix  是由 向 python  的 configure 脚 本传入 的 对应形 参 所 定义 而 version  则 为 d
d  sys
 在 windows  上 头文件 安装 于 prefixinclude 其 中 prefix  是向 安装程 序 指 定 的安 装目 录
 要 包 含头 文件 请 将两 个目 录如 果 不 同 都 放 到 你 所用 编译器 的 包含 搜索 路径中
请 不要将 父 目录 放入 搜 索路径 然 后 使用 includepythonx
h  这 将使 得多平 台编 译 不 可 用因 为 prefix  下 平 台 无关 的头文 件需要 包 含 来 自 execprefix  下特 定 平 台 的 头 文 件
 有用 的宏
对 象、类型和 引用 计数
 引 用计数
 类型
 异常
python  程 序员 只 需要 处 理特 定需 要 处理 的 错误 异 常未 处理 的异 常会 自动 传递 给 调 用 者 然后传 递 给调 用者 的 调用 者 依 此类推 直 到他 们到 达顶级解释 器 在 那里将 它 们 报告 给用 户并 伴随 堆 栈回 溯
嵌 入 python
调 试 构 建
 除 了前 面 描 述 的 引 用计 数调 试之外还 执行以 下额 外检 查 额外检查将 添加 到对 象分 配器
 额 外的检 查将 添加 到解 析器和 编 译 器 中
许多断 言被 添加 到字 典 和集 合实现 中
另外 集 合 对象 需要 testcapi  方法
 输入 参数 的 完 整性 检查 被 添 加 到 框架 创 建中
 使用 已知的无效 模式初 始化 整 型 的 存储 以 捕 获对未 初始化 数字的 引 用
添 加 底层跟踪 和额 外 的 异常 检 查 到虚 拟机 的运行时中
 添 加额外调 试 到 线 程模块
这 里 可能没有提 到的额 外 的检 查
有 关更多 详细 信 息请 参阅 python 源 代 码中的 miscspecialbuilds
txt 
迭 代器 协 议
 迭代 器 有 两个 函数
int  pyitercheckpyobject   o  返回 true 如果对 象 o   支持迭代 器 协 议 的话
返回 迭 代 o 的下一个 值
对象 必 须是 一个 迭代器 这应 由 调用 者来判 断
 如果 没有 余 下 的 值 则 返回 null  并且 不 设 置异 常
 如 果在 获取 条 目 时 发生 了错 误 则 返回 null 并且 传 递 异常
 要 为 迭 代器 编写一个 一个 循环 c  代码应该 看 起来 像 这样 pyobject  iterator  pyobjectgetiterobj  pyobject  item  if  iterator  null  propagate  error  while  item  pyiternextiterator  do  something  with  item 
迭代器 对 象
python  提供 了 两 个通 用迭 代器 对象
 第一 个是 序列 迭代 器 它 使 用 支 持 getitem 方 法的任 意 序列
 第二个 使用 可 调 用对 象和 一 个 sentinel  值 为序 列 中的 每个项 调用可 调用 对 象并 在返 回 sentinel 值时 结 束迭代
pytypeobject  pyseqitertype  pyseqiternew  返 回 迭代 器对象 的类 型 对象 和内 置序 列类 型内 置 函 数 iter  的单 参 数 形 式
int  pyseqitercheckop  如果 op  的类 型为 pyseqitertype  则返回 true
 返回一个 与 常 规序列 对 象一 起使 用 的 迭代 器 seq
当序列 订阅 操作 引 发 indexerror 时 迭代 结 束
pytypeobject  pycallitertype 由 函 数 pycalliternew  和 iter 内 置函 数 的双参 数 形 式返 回的 迭 代 器 对 象 类型对 象
int  pycallitercheckop 如果 op 的类 型 为 pycallitertype 则 返回 true
 返 回一 个新的 迭代 器
第 一 个参 数 callable 可 以是任 何 可以 在没 有参 数的情 况 下 调 用 的 python 可 调用对象 每次调 用 都应 该返 回迭代 中的 下一 个项 目
当 callable  返 回 等于 sentinel  的 值时 迭代 将终 止
 列表 对 象
pylistobject 这 个 c 类 型 pyobject  的子类 型代表 一个 python  列表 对象
pytypeobject  pylisttype  这 是 个属 于 pytypeobject 的 代表 python  列 表类型 的实例
在 python 层 面和类型 list  是同 一个 对象
int  pylistcheckpyobject   p  如果 p  是 一个 列表对 象或 者 是一个 列 表类 型 的 子 类型 实例 时返 回真
int  pylistcheckexactpyobject   p  当 p  是一 个 列表 对 象但是 不 是 列 表类 型的 子类 型实 例时 返 回真
 成功时返 回一个 长度 为 len 的新 列表失 败时 返回 null
 注 解当 len  大 于零时 被 返回 的列 表对 象 项 目 被 设成 null
因 此你不 能 用类 似 c 函数 pysequencesetitem  的抽 象 api 或 者用 c 函 数 pylistsetitem 将所有项 目 设置 成真实 对象前 对 python  代码公开 这个 对 象
pyssizet  pylistsizepyobject   list 返回 list  中 列 表对 象 的 长 度这等 于在 列表对 象 调 用 lenlist 
pyssizet  pylistgetsizepyobject   list 宏版本 的 c  函数 pylistsize  没有 错 误检测
 返 回 list 所 指 向 列 表 中 index  位置 上的对 象
 位置 值必须 为非负 数 不 支持 从 列表 末 尾 进行 索 引
 如果 index 超 出边 界0 or  lenlist 则返 回 null 并 设置 indexerror 异 常
 宏版 本的 c 函 数 pylistgetitem  没 有 错 误 检测
int  pylistsetitempyobject   list  pyssizet   index  pyobject   item  将列 表中 索引为 index  的项 设 为 item
成功 时 返回0
如 果 index  超 出范 围则 返 回1并 设 定 indexerror  异 常
 注 解 此 函数会 偷走 一 个 对 item 的 引 用 并 丢弃 一个 对 列 表中 受 影响 位 置上 的已 有 条 目的 引用
void  pylistsetitempyobject   list  pyssizet   i  pyobject   o 不带 错误 检 测 的 宏版 本 pylistsetitem
 这 通 常 只 被用 于 新列表 中 之前 没 有内 容的 位置 进 行 填 充
注 解 该宏会 偷走一个对 item  的引 用 但与 pylistsetitem 不 同 的 是 它 不 会丢 弃 对 任何 被替换 条目 的引 用在 list  的 i  位置 上 的 任 何 引 用都 将 被 泄 露
int  pylistinsertpyobject   list  pyssizet   index  pyobject   item 将条目 item  插入 到列 表 list  索引 号 index  之前 的位 置
 如 果成 功将 返 回0 如 果 不成功 则返 回1并 设置 一个 异常
 相 当 于 list
int  pylistappendpyobject   list  pyobject   item 将 对 象 item  添加到 列 表 list  的末 尾
如果 成 功 将返回0 如果 不成 功则 返 回1并 设置 一 个异 常
 相 当 于 list
返 回 一 个 对 象 列表 包 含 list  当 中位于 low  和 high 之 间的对 象
 如果 不 成 功则返 回 null 并 设 置 异 常
 相 当 于 listlowhigh
不 支持 从 列表 末尾 进 行 索引
int  pylistsetslicepyobject   list  pyssizet   low  pyssizet   high  pyobject   itemlist 将 list  当 中 low  与 high  之 间 的 切 片设 为 itemlist  的 内容
 相当 于 listlowhigh  itemlist
 itemlist 可以 为 null 表 示赋 值 为一 个 空 列 表 删除 切 片
 成 功 时 返回0 失败 时返 回1
这 里 不 支持 从列 表末 尾 进 行索 引
int  pylistsortpyobject   list  对 list 中 的 条目 进行 原 地排 序
成 功时返回0 失败 时返 回1
这 等价 于 list
int  pylistreversepyobject   list  对 list 中 的 条目 进 行 原 地反 转
 成功 时 返 回0 失败 时返 回1
 这 等价 于 list
返 回 一 个新 的元组 对 象其 中 包 含 list 的内容等价 于 tuplelist 
 整数 型 对象
映 射协 议
参 见 pyobjectgetitem 、 pyobjectsetitem  与 pyobjectdelitem
int  pymappingcheckpyobject   o  如果 对 象提 供映 射协 议 或支持切 片 则返 回1否 则 返 回0
请 注意 它 将为具 有 getitem 方 法的 python  类 返回1 因为 在 一 般情 况下无 法确定 它 所 支持 的 键类 型
 此 函 数 总是会 成功 执 行
pyssizet  pymappingsizepyobject   opyssizet  pymappinglengthpyobject   o  成 功 时 返 回对 象 o  中 键 的 数量失败 时返 回1
 这相当 于 python 表 达 式 leno
返 回 o  中 对 应 于 字 符 串 key 的元 素 或 者失败 时返回 null
这 相当于 python  表达 式 okey
 另请 参见 also  pyobjectgetitem
int  pymappingsetitemstringpyobject   o  const  char   key  pyobject   v  在 对 象 o  中 将 字 符 串 key 映 射 到值 v
 失败 时返 回1
 这 相 当 于 python 语 句 okey  v
 另 请参见 pyobjectsetitem
 此 函 数不 会 增加 对 v  的引 用
int  pymappingdelitempyobject   o  pyobject   key 从 对 象 o  中 移 除 对象 key  的 映射
 失败 时 返 回1
 这 相 当于 python  语句 del  okey
 这 是 pyobjectdelitem  的一个别 名
int  pymappingdelitemstringpyobject   o  const  char   key 从对 象 o 中 移除 字 符 串 key  的映 射
 失 败时 返回1
 这 相 当 于 python  语句 del  okey
int  pymappinghaskeypyobject   o  pyobject   key  如 果映 射 对象 具有 键 key  则返 回1 否 则返 回0
这 相当 于 python  表 达 式 key  in  o
此 函数 总是 会 成 功执 行
 请注 意在 调用 getitem  方 法 期间 发生的 异常 将 会被 屏蔽
 要 获取 错误报 告 请 改用 pyobjectgetitem
int  pymappinghaskeystringpyobject   o  const  char   key  如 果 映 射 对 象具 有 键 key  则 返 回1否 则 返 回0
 这 相当于 python 表达 式 key  in  o
此 函 数 总是 会成功 执 行
 请 注意 在 调用 getitem  方法 期间 发生 的异 常 将 会 被屏 蔽
 要 获取 错 误 报告 请改 用 pymappinggetitemstring
成 功 时 返 回对 象 o 中 的 键的 列 表
 失 败 时 返 回 null
在3
7 版 更改 在 之 前 版本中 此函 数返 回一个 列表 或元 组
 成 功 时返回 对 象 o 中 的值 的列表
 失败 时返 回 null
 在3
7 版 更 改在 之前 版 本 中 此 函 数 返回 一个 列 表 或元组
 成功 时返 回对 象 o  中 条目 的 列 表 其 中每 个条目 是一个 包 含 键 值对 的 元 组
 失 败 时返 回 null
在3
7版 更 改 在 之 前版 本 中此函 数 返 回 一 个列 表 或 元组
 数 据 marshal 操作 支 持
这 些 例 程 允许 c 代 码处 理 与 marshal  模 块所 用 相 同数 据 格 式的序 列 化 对 象
 其中 有 些 函 数 可用 来将 数据写 入这 种序 列 化 格式 另一些 函 数 则 可用 来读 取并 恢复 数据
 用于 存 储 marshal  数据的 文 件必 须以 二 进 制 模式 打 开
 数字 值 在 存 储 时 会 将 最 低 位 字 节 放在开 头
此 模 块 支 持两 种数 据格式 版 本第0 版 为 历 史版 本第1 版 本 会 在 文 件 和 marshal 反 序 列化 中共 享固化 的字 符串
 第2 版 本 会 对 浮 点 数 使用 二进 制 格 式
 pymarshalversion  指 明 了当前 文 件的 格式当 前取 值为2
void  pymarshalwritelongtofilelong   value  file   file  int   version  将 一个 long  整 数 value 以 marshal  格式写 入 file
 这 将 只 写入 value  最低 的32位 无论 本 机 long  类型的 长度 如 何
 version  指 明 文 件 格 式 的 版本
void  pymarshalwriteobjecttofilepyobject   value  file   file  int   version  将 一 个 python  对 象 value  以 marshal  格式 写入 file
 version 指 明 文 件 格 式 的 版本
 返 回 一 个 包 含 value  的 marshal  表 示 形 式 的字 节串 对象
 version  指 明 文 件格式的版本
以 下 函数允 许读 取并 恢复 存储 为 marshal  格式的 值
long  pymarshalreadlongfromfilefile   file  从打 开 用 于读 取的 file  的对 应 数据 流返 回一 个 c  long
 使用只 函数 只能 读取32 位 的 值无 论本机 long  类型 的 长度 为 何
发 生错 误时 将设 置适 当的异常 eoferror 并 返 回1
int  pymarshalreadshortfromfilefile   file 从 打开 用于 读 取 的 file 的 对应 数 据流返 回一 个 c  short
 使用 此函数只 能读 取16位 的值无论 本 机 short 类型的 长度为 何
发 生错误时 将 设置适 当的 异常 eoferror  并返 回1
从打开 用于 读 取的 file  的 对 应数 据流 返回一 个 python 对 象
发生 错误 时将 设置适 当的异常 eoferror  valueerror  或 typeerror 并 返 回 null
从 打开 用于 读 取的 file  的对 应数 据流 返 回一 个 python 对象
不同 于 pymarshalreadobjectfromfile 此 函数假定 将 不再 从该 文件 读 取更 多 的对 象允 许 其 将文 件 数 据 积 极地 载入 内存 以 便反序列化 过程 可以 在 内存 中的 数 据上 操 作而 不是 每次从文 件读 取一 个字 节
只 有 当 你 确定 不 会 再 从文 件读 取 任 何内 容时 方可 使用 此形 式
 发 生错误 时 将 设置 适当 的异 常 eoferror  valueerror 或 typeerror 并 返回 null
 从 包 含指向 data  的 len 个字 节的 字节 缓冲 区 对应的 数 据 流 返 回 一 个 python 对象
 发生 错误 时 将设 置适当 的异常 eoferror  valueerror 或 typeerror  并返 回 null
内 存管 理
概 述
在 python 中内 存管 理涉 及 到 一个 包 含所 有 python 对 象和 数 据 结构 的私 有 堆 heap
这 个 私 有堆 的 管理由 内部的 python  内存管理 器 python  memorymanager 保 证
python 内 存管理 器有不 同的 组件 来处理 各种 动态存储 管理 方面 的问题 如共 享、分割、预 分配 或缓 存
 在 最底 层一 个 原 始 内 存分 配器 通过 与操 作系 统的 内 存管 理器 交 互确 保私 有堆中有足够 的 空间 来 存储 所有 与 python  相 关的 数据
 在原始内 存 分配 器的 基 础上 几个 对象 特定的分 配器在 同一 堆上 运 行 并根 据每 种对象类 型 的特 点实 现不 同的 内 存管理 策略
 例 如 整数 对象在 堆内 的管理 方式 不 同于字 符 串、元 组或字 典 因为 整 数 需要不同的 存储需 求和 速度与 空 间的权 衡
 因 此 python  内存 管 理 器将 一些 工作分配 给对 象 特 定 分配 器 但确保 后 者在 私有堆 的 范 围 内运行
python  堆内 存的管理 是由 解 释器 来执 行 用户 对 它没有 控制权即使 他 们经 常 操作指 向堆 内内存 块的 对 象指针 理 解 这 一点 十 分 重要
python  对象 和其他 内部缓 冲 区的 堆空间 分 配是由 python  内 存管 理器 按需通 过本 文档 中 列出 的 pythonc  api  函 数进 行 的
为 了避免 内 存 破坏 扩 展的 作 者 永远 不应 该 试图用 c  库 函数 导出 的 函数来 对 python  对象进 行操 作这些 函数 包括 malloc  callocrealloc  和 free
 这将导 致 c 分配器 和 python  内存管 理器 之 间的 混 用引发严重 后果这是由 于它们实现 了不 同的 算法 并 在不 同的 堆上 操作
 但是 我们 可以 安 全地 使用 c  库分 配 器 为 单 独的 目的 分配 和 释 放内存 块如 下 例所示 pyobject  res  char  buf  char  mallocbufsiz  for  io  if  buf  null  return  pyerrnomemory 
 res  pybytesfromstringbuf  freebuf  malloced  return  res 在 这个 例子 中 io  缓冲 区的 内存 请求是由 c  库 分配 器处 理 的
python 内 存管 理器只参 与了 分 配 作为结果返 回的字 节 对 象
然 而在大 多数 情况 下建议 专 门从 python  堆 中 分 配 内存 因为后 者由 python  内 存管理器 控 制
 例 如 当 解释器扩展 了 用 c 写的 新对象 类 型时就必 须这样 做
 使用 python 堆 的另一 个原因 是 希 望通 知 python  内存 管理 器关 于扩 展模 块 的 内 存 需求
 即使所 请 求的 内存全 部只 用 于 内 部的、高 度特 定的目 的 将所 有的内 存请 求交 给 python 内 存管 理器 能让 解 释器 对其内 存占 用的 整体 情况有更 准确 的了 解
因 此在 某些 情 况 下 python 内 存 管 理 器可 能 会触 发或 不触 发适当 的操 作如 垃圾回收、 内 存压缩 或其他预 防 性 操 作
 请 注 意 通过使 用前 面例 子中 所 示的 c  库分配 器 为 io  缓 冲 区分 配的 内 存会 完全 不 受 python 内 存 管 理 器管理
参见环 境 变 量 pythonmalloc 可被用 来 配 置 python  所 使 用 的 内 存分配 器
环境变 量 pythonmallocstats 可 以用 来在 每次 创建 和关 闭新 的 pymalloc  对 象区 域时打印 pymalloc 内 存 分 配器的统计 数据
 原 始内 存接 口
 内存 接口
对象分 配器
 以 下 函数 集仿 照 ansi  c  标 准并 指 定了请求 零字节 时 的行 为 可用 于从 python 堆 分配 和释放内 存
默 认对象分配 器 使用 pymalloc 内存分配 器
警 告在使用 这些 函数时 必须 持有全 局 解释器 锁 gil 
void  pyobjectmallocsizet   n 分 配 n 个字节 并 返 回 一 个 指向 分 配的 内 存的 void  类型 指针如 果 请求 失 败 则返 回 null
 请 求 零字 节可能返回 一 个 独 特的 非 null  指 针就 像调 用了 pyobjectmalloc 1一样
 但是 内 存 不会 以 任 何方 式 被初 始 化
void  pyobjectcallocsizet   nelem  sizet   elsize  分 配 nelem 个 元素 每个 元素 的大 小 为 elsize  字节并 返回 指向 分配 的内 存 的 void 类型 指 针 如 果请 求 失败 则 返回 null
 内 存会被 初 始 化 为零
 请求零 字节 可能返 回 一个 独特 的 非 null 指 针 就像调用了 pyobjectcalloc 11一 样
3
5 新 版 功 能
void  pyobjectreallocvoid   p  sizet   n  将 p 指向 的 内存块 大 小 调整为 n  字节
 以新 旧 内存 块大小中的最 小值为 准其 中内 容 保持 不变如果 p 是 null 则 相当于 调用 pyobjectmallocn  如果 n 等 于0 则内 存块 大小 会 被 调整 但不会 被释放返回 非 null  指针
 除非 p  是 null 否则 它必 须是之前 调用 pyobjectmalloc 、 pyobjectrealloc  或 pyobjectcalloc 所返回的
 如 果请求失败 pyobjectrealloc 返 回 null  p 仍 然是 指向 先前 内存 区 域的有效指针
void  pyobjectfreevoid   p  释放 p 指 向的 内存 块
 p  必须是 之前调用 pyobjectmalloc 、 pyobjectrealloc 或 pyobjectcalloc 所 返回 的指针
否则 或在 pyobjectfreep  之前 已经调 用 过的情 况 下未 定 义行 为会发生
 如 果 p  是 null 那 么什 么 操作 也 不会进 行
 默认内存分 配器
默 认 内 存 分配 器 配置名 称 pymemrawmalloc  pymemmalloc  pyobjectmalloc  发布 版 本 pymalloc  malloc  pymalloc  pymalloc 调 试构 建 pymallocdebug  malloc  debug  pymalloc  debug  pymalloc  debug 没 有 pymalloc 的 发布 版 本 malloc  malloc  malloc  malloc 没有 pymalloc  的调 试构 建 mallocdebug  malloc  debug  malloc  debug  malloc  debug  说明名 称环境 变量 pythonmalloc  的值 malloc  来自 c  标准库的 系统分配 c 函 数 malloc  calloc  realloc  and  free  pymalloc  pymalloc 内 存分 配器 debug 带有 pymemsetupdebughooks 安 装 的 调试 钩子
 自定 义内 存 分配 器
pymalloc  分配器
python  有 为具 有 短 生 命周期 的小 对象 小于 或 等 于512 字节 优 化的 pymalloc 分配 器
它 使 用 固定 大小 为256 kib 的 称 为 arenas 的内 存 映 射
 对 于大 于512 字节 的分 配 它 回 到使 用 pymemrawmalloc  和 pymemrawrealloc 
pymalloc  是 pymemdomainmem  例如 pymemmalloc  和 pymemdomainobj 例 如 pyobjectmalloc  域的默 认分 配器
arena  分配器使用以 下函 数 windows 上 的 virtualalloc 和 virtualfree  mmap  和 munmap  如 果可用 否则 malloc  和 free 
自 定 义 pymalloc  arena  分配 器
tracemalloc  c  api
3
7新 版 功能
int  pytracemalloctrackunsigned  int   domain  uintptrt   ptr  sizet   size  在 tracemalloc  模 块中 跟踪一 个已 分 配 的内 存块
成 功时返回0出 错 时返回1无 法 分 配内 存 来保存 跟踪信 息
如 果禁用了 tracemalloc 则 返回2
如 果内 存块 已 被 跟踪 则 更 新现 有 跟 踪信 息
int  pytracemallocuntrackunsigned  int   domain  uintptrt   ptr 在 tracemalloc  模块中 取 消 跟 踪一 个已 分配的 内存 块
如果 内 存 块 未被 跟 踪 则不执 行任 何 操 作
 如果 tracemalloc  被 禁用则返回2 否则 返回0
 示例
以 下是 来自 概述 小 节 的示 例 经 过重 写以 使 io  缓 冲区 是 通 过使用 第 一 个函 数 集从 python  堆中 分 配的 pyobject  res  char  buf  char  pymemmallocbufsiz  for  io  if  buf  null  return  pyerrnomemory 
 res  pybytesfromstringbuf  pymemfreebuf  allocated  with  pymemmalloc  return  res 使 用面 向类 型函 数集 的 相同代 码 pyobject  res  char  buf  pymemnewchar  bufsiz  for  io  if  buf  null  return  pyerrnomemory 
 res  pybytesfromstringbuf  pymemdelbuf  allocated  with  pymemnew  return  res 请 注 意在 以 上 两个 示例 中 缓冲 区总 是 通过归 属于 相同 集的 函数 来操 纵的
 事 实上对 于一 个 给定 的内 存块 必须 使 用相 同的 内存 api  族以 便使 得混 合不 同分 配器 的风险 减至最 低
以 下代 码序 列 包含 两处 错 误 其中 一个被 标记为 fatal  因 为 它 混 合了 两种 在 不 同堆 上 操作 的不 同分 配器
 pymemdelbuf 3 wrong  should  be  pymemfree  freebuf 2 right  allocated  via  malloc  freebuf 1 fatal  should  be  pymemdel  除 了旨 在处 理 来自 python  堆的 原始 内 存块 的函 数 之 外 python 中 的 对象 是 通过 pyobjectnew  pyobjectnewvar  和 pyobjectdel 来 分配 和 释 放 的
 这些 将在 有 关如 何 在 c 中 定义 和 实现 新 对象 类 型的 下一 章中 讲 解
memoryview 对 象
一 个 memoryview 对 象 c  级别 的 缓冲 区接 口 暴 露为一 个 可以 像任 何其 他 对 象一 样传 递 的 python 对 象
 从 提供缓 冲 区 接口 的对 象 创建 memoryview  对象
 如 果 obj  支 持可 写缓 冲区 导出 则 memoryview 对 象将 可以被读写 否 则 它可 能是只 读的 也可以 是导出器自行 决定 的读 写
使 用 mem 作为底层 缓冲 区 创 建 一个 memoryview 对 象
 flags 可 以是 pybufread 或者 pybufwrite  之 一
3
3 新版 功能
创建 一 个包 含 给 定 缓 冲区 结构 view 的 memoryview 对象
 对 于 简 单 的 字节缓 冲区 pymemoryviewfrommemory 是首选 函 数
 从定 义缓冲 区接口的 对 象 创 建一个 memoryview  对 象 contiguous 内 存块 在 c 或 fortran  order  中
如 果内存是连 续的 则 memoryview 对象指向 原始内 存
否 则 复制并 且 memoryview 指 向 新的 bytes 对 象
int  pymemoryviewcheckpyobject   obj 如 果对 象 obj 是 memoryview 对 象则返回 true 
 目前不 允 许 创建 memoryview 的 子类
pybuffer  pymemoryviewgetbufferpyobject   mview  返回指向 memoryview  的 导 出缓 冲区 私有副 本的指 针
 mview  必须是 一个 memoryview  实例 这个宏 不检 查 它的 类型你必 须 自 己检 查 否则你 将面 临崩溃 风 险
pybuffer  pymemoryviewgetbasepyobject   mview  返回 memoryview  所基于 的导出 对 象的指 针或 者 如 果 memoryview 已由 函 数 pymemoryviewfrommemory 或 pymemoryviewfrombuffer  创建则返 回 null
 mview 必须 是一 个 memoryview 实 例
 实 例方法 对象
 实例 方 法 是 pycfunction 的 包 装 器 也 是将 pycfunction  绑定 到类 对象 的一 种新方 式
它 替代了 原先 的 调用 pymethodnewfunc  null  class
pytypeobject  pyinstancemethodtype  这 个 pytypeobject 实例 代 表 python  实例方 法类 型
它 并 不对 python  程 序公 开
int  pyinstancemethodcheckpyobject   o  如 果 o  是 实 例方 法 对象 类型 为 pyinstancemethodtype 则返 回 真 值
 形参 必 须 不为 null
返回一 个新 的 实例 方法对象 func  应为 任意 可调用 对象 func  将在 实 例方 法被 调用 时作为函 数被 调用
 返 回关 联到实例 方法 im 的 函数对 象
宏 版本 的 pyinstancemethodfunction 略 去了 错误检测
 模块 对象
3
3 新版功 能
在3
4 版更 改 package  and  loader  are  set  to  none
3
3新 版功 能
3
2新 版 功能
3
2版后 已移 除 pymodulegetfilename  raises  unicodeencodeerror  on  unencodable  filenames  use  pymodulegetfilenameobject  instead
initializing  c  modules
 see 构 建 cc  扩展 or  extending  embeddedpython  for  details
 在3
5版 更改 prior  to  version 3
5 this  member  was  always  set  to  null  and  was  defined  as  inquiry  mreload  traverseproc  mtraverse  a  traversal  function  to  call  during  gc  traversal  of  the  module  object  or  null  if  not  needed
 在3
9 版更 改 no  longer  called  before  the  module  state  is  allocated
 在3
9 版更 改 no  longer  called  before  the  module  state  is  allocated
 在3
9版更 改 no  longer  called  before  the  module  state  is  allocated
singlephase  initialization
注解 most  uses  of  this  function  should  be  using  pymodulecreate  instead  only  use  this  if  you  are  sure  you  need  it
multiphase  initialization
3
5 新 版 功能
3
5新版 功 能
lowlevel  module  creation  functions
3
5新版 功能
注解 most  uses  of  this  function  should  be  using  pymodulefromdefandspec  instead  only  use  this  if  you  are  sure  you  need  it
3
5 新版功 能
3
5 新版功 能
3
5新版功 能
3
5新版 功 能
support  functions
 注解 unlike  other  functions  that  steal  references  pymoduleaddobject  only  decrements  the  reference  count  of  value  on  success
3
9新 版 功能
module  lookup
3
3 新版 功 能
3
3新 版功能
none  对 象
请 注意 none  的 pytypeobject 不 会直 接在 python  c  api  中 公 开
由 于 none 是 单例 测试对 象标 识在 c  中使 用就 足够了
 由于同 样的原 因 没有 pynonecheck 函 数
pyobject  pynone  python  none 对 象表 示缺 乏值
这 个对 象没有 方法
 它需要 像引用 计数一 样处 理任何其他 对象
pyreturnnone  正确 处理来 自 c 函数内的 pynone  返回也就是 说增 加 none 的引 用计数并返 回它

 数字协议
int  pynumbercheckpyobject   o 如 果对象 o 提 供 数字 的协议返 回 真1否则 返回 假
这 个函 数 不会调 用 失败
 在3
8版更改 如 果 o 是 一个 索引 整数则返回1
 返回 o 1、 o 2 相加 的 结 果如果失 败返回 null
 等价 于 python 表达式 o 1 o 2
 返回 o 1减去 o 2 的结果 如果 失败 返回 null
 等价于 python  表达 式 o 1 o 2
返 回 o 1、 o 2相乘 的 结 果如 果 失 败返回 null
 等价于 python  表 达 式 o 1 o 2
 返 回 o 1、 o 2做 矩阵乘法 的结果如 果失 败返回 null
 等 价 于 python 表达 式 o 1 o 2
3
5新版 功 能
 返回 o 1 除以 o 2 的向下 取 整后的 结果 如 果 失败 返回 null
等 价 于 传统 的 整数 除法
 返 回 o 1除 以 o 2的一个 合理的 近似值 如 果 失败 返 回 null
 结果是 近似的因 为 二进 制浮点 数是 一个 近似值 不可 能 以2 为 基 数来 表示 出所有 实数
 这 个函 数 返 回两 个 整数相 除得到 的 浮点 数
 返回 o 1 除以 o 2 得到 的 余数 如果 失败返回 null
 等价于 python 表达 式 o 1 o 2
 参考内置函 数 divmod
 如 果失 败返 回 null
等 价于 python 表 达式 divmodo 1 o 2
 请 参 阅内 置函数 pow
 如 果失 败 返回 null
等价 于 python  中的 表 达式 powo 1 o 2 o 3其中 o 3是可 选的
如 果要 忽略 o 3 则需传入 pynone  作为 代 替如 果传 入 null 会 导 致 非法 内存 访问
 返 回 o 的负 值 如 果失败返 回 null 
 等价 于 python 表 达 式 o 
返 回 o 如 果失 败 返 回 null 
 等价 于 python  表 达式 o
 返 回 o 的 绝 对值 如果失败 返 回 null
等 价于 python 表 达式 abso
 返回 o  的 按位 取反 后的结 果 如果 失败 返回 null
 等价于 python 表 达式 o
 返 回 o 1左 移 o 2个比特 后的结 果如 果失 败返回 null
 等价于 python 表 达式 o 1 o 2
返回 o 1 右移 o 2 个比特 后的 结果 如 果失败返 回 null 
等 价于 python  表达 式 o 1 o 2
返回 o 1和 o 2按 位与的 结 果 如果 失败返 回 null 
等价 于 python  表 达 式 o 1 o 2
返回 o 1 和 o 2按位异 或 的结果 如果 失败返 回 null 
 等价 于 python 表 达 式 o 1 o 2
 返回 o 1 和 o 2 按 位或 的结果 如 果失 败返 回 null 
等价 于 python 表 达 式 o 1 o 2
 返 回 o 1、 o 2 相加的 结果 如果 失败返 回 null
 当 o 1支 持时 这个 运 算直接使 用 它 储 存 结果
 等 价于 python  语句 o 1 o 2
 返回 o 1、 o 2 相 减 的 结果 如 果 失 败返 回 null 
当 o 1 支持时 这个 运算 直 接使用 它储 存 结果
 等价 于 python 语句 o 1 o 2
 返回 o 1、 o 2相乘 的结 果 如果 失败返 回 null 
 当 o 1支 持时 这个运算 直接 使用 它储 存结果
 等价于 python  语句 o 1 o 2
返回 o 1、 o 2 做 矩阵 乘法 后的结 果 如 果失 败返 回 null 
当 o 1支 持时这个 运算 直接 使用它储 存 结果
 等价于 python  语句 o 1 o 2
3
5 新 版 功能
返 回 o 1 除以 o 2 后 向 下取 整 的结 果如 果失败 返回 null
 当 o 1支 持时 这个 运算 直 接使 用 它储 存 结果
 等价于 python 语 句 o 1 o 2
 返回 o 1 除以 o 2的 一个合 理的近 似值如果 失败 返回 null
 结 果是 近似 的 因 为 二进制 浮点 数是一 个近似值 不可能 以2 为基 数 来 表示 出所有 实数
 这 个函 数返回 两个整 数相 除得 到的 浮 点数
 当 o 1 支持时 这个 运 算直 接 使用它 储 存 结果
返回 o 1 除 以 o 2 得到 的余 数如 果失 败返 回 null
当 o 1 支持 时 这个 运算直接 使 用 它 储存结 果
等价于 python  语句 o 1 o 2
请 参 阅 内 置函 数 pow
如果失 败返 回 null
当 o 1支 持 时这个 运 算直 接使 用 它 储 存结 果
当 o 3 是 pynone 时等价 于 python  语句 o 1 o 2 否 则等价 于在 原 来 位置 储存结 果的 powo 1 o 2 o 3
 如 果要 忽略 o 3 则 需 传 入 pynone  传入 null  会导 致非 法内 存访 问
 返回 o 1 左移 o 2个 比 特后 的 结果 如果失 败返 回 null
当 o 1支 持时 这 个运算 直 接使用 它 储 存 结果
 等价于 python 语 句 o 1 o 2
返 回 o 1 右移 o 2 个比 特后的 结 果如 果 失 败返 回 null
当 o 1 支持 时这个运 算直接使用它储存 结果
 等价 于 python  语 句 o 1 o 2
成 功时 返 回 o 1 和 o 2按位与 的 结 果 失败 时返回 null
在 o 1 支持 的前 提下该操 作将 原 地执 行
等 价与 python  语句 o 1 o 2
 成功 时返回 o 1和 o 2 按位异 或的 结 果 失败 时 返回 null
在 o 1支 持的 前 提下该操 作将 原地 执 行
 等价 与 python 语 句 o 1 o 2
成 功时 返回 o 1 和 o 2按位 或的 结果 失败 时返 回 null
在 o 1 支持 的前 提下 该操 作将原地执 行
等 价于 python  语句 o 1 o 2
 成功 时返 回 o  转换 为整 数对 象 后 的结果 失败 时返回 null
等价 于 python 表 达式 into
成 功 时 返 回 o  转 换 为浮点 对象 后的结 果失 败 时返 回 null
等价于 python  表达 式 floato
 成功 时返 回 o  转换 为 python  int 类 型 后的 结果失败 时 返回 null  并引 发 typeerror 异常
返 回整数 n 转 换成 以 base 为 基数的字 符串 后的 结 果
这 个 base  参数 必须 是2810或者16
 对于基 数28或16返 回的 字符串将分 别加上基数 标识0 b 0 o  or 0 x
如果 n  不是 python  中的 整 数 int 类 型就先 通过 pynumberindex  将它转换 成整数 类型
pyssizet  pynumberasssizetpyobject   o  pyobject   exc 如果 o  是一 个整 数类型 的 解释 型 返回 o  转换 成一 个 pyssizet 值 项后 的结果
如 果调用失 败返 回1 并引 发异 常
如果 o 可 以被 转换 为 python  int 类 型 但尝 试转换为 pyssizet  值 则会 引发 overflowerror  这时 exc 参数 为 将 被引 发 的异常 类型通常 是 indexerror  或 overflowerror
如 果 exc 为 null  则 异 常 会被 清除 并且 值会 被裁 剪为 负整数 pyssizetmin 或 正整 数 pyssizetmax
int  pyindexcheckpyobject   o 如 果 o 是 一 个 索引 整数 存有 nbindex 位置并 有 tpasnumber  填入其中则 返回1 否则返回0
 这个 函数 不会 调用 失败
旧缓冲 协议
3
0 版后已 移除
 这些 函 数是 python 2中 旧 缓冲协议 api 的 组成部分
在 python 3 中此协 议已不复存 在但这些 函数仍然 被公 开以便 移植2
x  的代 码
它 们被用 作新缓 冲协 议的 兼容 性包 装器 但 它们并 不会 在缓冲 被 导出 时 向你 提供对 所获资 源的生 命周期 控 制
因 此推 荐你 调用 pyobjectgetbuffer  或者 配合 pyargparsetuple  函 数族 使 用 y  或 w 格 式 码 来 获取 一个对 象的 缓冲 视图 并在 缓 冲视 图 可被 释放时调 用 pybufferrelease
int  pyobjectascharbufferpyobject   obj  const  char   buffer  pyssizet   bufferlen 返 回 一个指 向 可用作 基于 字 符的 输入 的只 读内存地 址的 指针
 obj 参 数必须支 持单 段字符 缓冲 接口
成功 时返 回0 将 buffer 设为 内存地址 并将 bufferlen  设为缓 冲区 长度
出 错时 返回1并 设置 一个 typeerror
int  pyobjectasreadbufferpyobject   obj  const  void   buffer  pyssizet   bufferlen  返回一个 指向 包含 任意数 据的 只读 内存地址 的指 针
 obj 参 数必须 支 持 单段 可 读 缓冲接 口
 成 功时返回0 将 buffer 设为 内存地址 并 将 bufferlen 设为 缓冲 区长度
 出 错 时返 回1 并设置 一个 typeerror
int  pyobjectcheckreadbufferpyobject   o  如 果 o 支 持 单段可读 缓 冲接口 则返回1
 否 则返 回0
此 函 数 总是 会成 功执行
 请注意 此函数 会尝试 获取 并释放 一个缓冲 区并 且在调用 对应 函数期 间 发生的 异 常会 被屏 蔽
 要 获取错 误报告 则应 改用 pyobjectgetbuffer
int  pyobjectaswritebufferpyobject   obj  void   buffer  pyssizet   bufferlen  返回 一个 指 向可 写内 存地址 的指针
 obj 必 须支 持单段 字符 缓冲接 口
 成功时 返 回0 将 buffer 设为 内存地址 并将 bufferlen  设为 缓 冲 区长度
 出错 时返回1并 设 置一 个 typeerror
对象协 议
 as  outlined  in 实 现 描述 器 data  descriptors  take  preference  over  instance  attributes  while  nondata  descriptors  dont
 otherwise  an  attributeerror  is  raised
3
3 新 版功 能
3
3 新版 功能
 注解 if  o 1 and  o 2 are  the  same  object  pyobjectrichcomparebool  will  always  return 1 for  pyeq  and 0 for  pyne
在3
4 版 更改 this  function  now  includes  a  debug  assertion  to  help  ensure  that  it  does  not  silently  discard  an  active  exception
 在3
4 版更改 this  function  now  includes  a  debug  assertion  to  help  ensure  that  it  does  not  silently  discard  an  active  exception
在3
2 版更 改 the  return  type  is  now  pyhasht
 this  is  a  signed  integer  the  same  size  as  pyssizet
3
4新 版功能
 对象 实现 支持
本章 描述 了定义新对 象类 型时 所 使用的 函数、 类 型和 宏
在 堆中 分配 对象 common  object  structures  base  object  types  and  macros  implementing  functions  and  methods  accessing  attributes  of  extension  types  type  对象 快速参 考 tp 槽 subslots  slot  typedefs  pytypeobject  definition  pyobject  slots  pyvarobject  slots  pytypeobject  slots  heap  types  number  object  structures  mapping  object  structures  sequence  object  structures  buffer  object  structures  async  object  structures  slot  type  typedefs  例子 使对象 类 型支 持循环垃 圾回 收
引用 计数
 反射
返 回当 前 执行 帧中内 置函数的 字典 如 果当 前 没有 帧 正在 执 行 则 返 回线程状态 的解 释器
 返回当 前 执行 帧中局 部 变量 的 字典 如果没 有当 前 执行 的 帧则 返 回 null
返回 当前 执行帧 中全局 变量的字 典如 果没有 当前 执行 的帧则返 回 null
 返回 当前 线程 状 态 的帧 如 果没 有 当前执 行的 帧 则返回 null
 另请 参 阅 pythreadstategetframe
int  pyframegetbackpyframeobject   frame  获 取 frame  为下 一个 外部 帧
 返 回一个强 引用 如 果 frame  没 有外 部 帧 则 返 回 null
 frame  必须 不 为 null
3
9新 版 功能
int  pyframegetcodepyframeobject   frame  获取 frame  的代码
 返 回 一个强 引 用
 frame  必须不 为 null
结 果帧的 代码 不 能 为 null
3
9 新 版功 能
int  pyframegetlinenumberpyframeobject   frame 返 回 frame 当 前正 在 执行的 行号
 frame 必 须不 为 null
const  char  pyevalgetfuncnamepyobject   func  如果 func 是 函 数、类 或实例 对象则返 回 它的 名 称 否则返 回 func  的类型的 名称
const  char  pyevalgetfuncdescpyobject   func 根据 func 的类 型返回 描述字 符 串
返 回值 包括函 数和方法 的 constructor  instance  和 object
与 pyevalgetfuncname 的 结果 连 接结果 将 是 func  的描 述
序 列 协议
int  pysequencecheckpyobject   o  如果对 象提 供序 列协 议函数 返 回1 否 则 返回0
 请注 意 它将 为 具有 getitem 方 法的 python  类 返回1 除非 它 们是 dict  的 子类 因为 在一 般情况 下 无法确定它 所支 持 键 类 型
此 函数 总是会 成 功 执 行
pyssizet  pysequencesizepyobject   opyssizet  pysequencelengthpyobject   o  到哪里 积 分返 回序 列 o  中 对象的数 量 失败 时 返回1
 这 相当于 python  表 达式 leno
 成功时返 回 o 1和 o 2的 拼接 失败 时 返 回 null
 这等 价于 python 表达 式 o 1 o 2
返回序列 对 象 o 重复 count 次 的结 果失 败时返 回 null
这等 价 于 python 表达 式 o  count
 成 功时 返回 o 1 和 o 2 的拼 接失败 时返 回 null
在 o 1 支持 的情况 下 操 作 将 原地 完成
 这 等价 于 python  表达式 o 1 o 2
 return  the  result  of  repeating  sequence  object 返 回 序列 对象 o  重 复 count 次 的结 果失 败 时 返回 null
 在 o  支持 的 情况下该 操作会原地 完成
 这等 价于 python  表达 式 o  count
返回 o 中 的第 i 号 元素 失 败时 返 回 null
这 等价于 python  表 达 式 oi
 返 回序 列 对 象 o 的 i 1 到 i 2 的切 片失 败时 返 回 null
这 等价 于 python  表达式 oi 1 i 2
int  pysequencesetitempyobject   o  pyssizet   i  pyobject   v  将 对象 v  赋值 给 o 的第 i  号元 素
 失败时 会引 发 异常并返 回1成 功 时返 回0
 这相当于 python  语句 oi  v
此函数 不会 改变 对 v  的 引用
 如 果 v  为 null 元 素 将被 删除 但是此特性 已 被弃 用应当 改用 pysequencedelitem
int  pysequencedelitempyobject   o  pyssizet   i  删除对 象 o 的 第 i 号元 素
 失 败 时返回1
 这相当 于 python 语 句 del  oi
int  pysequencesetslicepyobject   o  pyssizet   i 1 pyssizet   i 2 pyobject   v  将序列 对象 v  赋值 给 序列 对 象 o  的 从 i 1 到 i 2切 片
 这相当于 python  语句 oi 1 i 2 v
int  pysequencedelslicepyobject   o  pyssizet   i 1 pyssizet   i 2 删除 序 列对 象 o  的 从 i 1 到 i 2的切片
 失 败 时 返回1
这 相当 于 python 语 句 del  oi 1 i 2
pyssizet  pysequencecountpyobject   o  pyobject   value  返 回 value  在 o  中 出现 的 次 数 即 返 回使得 okey  value  的键 的数 量
 失 败时 返 回1
这 相当于 python  表达式 o
countvalue 
int  pysequencecontainspyobject   o  pyobject   value 确 定 o 是否 包含 value
 如果 o 中的 某一 项等 于 value 则 返 回1否则 返 回0
出错 时 返回1
这 相当 于 python 表 达式 value  in  o
pyssizet  pysequenceindexpyobject   o  pyobject   value  返回第一 个 索引 i 其 中 oi  value
出 错 时返 回1
相当于 python  的 o
indexvalue 表 达 式
返回一个 列 表对象其内 容与序 列 或可 迭代 对象 o  相同 失败时 返回 null
 返回 的 列表保 证是一 个新 对 象
 这 等 价于 python 表 达式 listo
 返回 一个元 组对象 其内 容 与 序列或 可 迭代对象 o  相同 失 败时 返回 null
 如果 o  为 元 组则将 返回 一个 新的 引 用 在 其 他情 况 下将 使 用 适当 的内 容构 造 一 个 元组
 这等 价于 python  表达 式 tupleo
将 序列 或可 迭代 对 象 o  作 为 其他 pysequencefast  函数 族可 用的 对象 返回
 如果 该 对 象 不 是序 列或 可迭 代对 象则 会引 发 typeerror 并将 m 作为消 息 文 本
失 败时 返回 null
 pysequencefast  函数 之所 以 这 样命 名是 因为 它们会 假定 o  是一 个 pytupleobject 或 pylistobject  并直 接访 问 o  的 数据字 段
 作为 cpython 的 实现 细节如 果 o 已 经是 一个 序 列或 列表 它 将被 直接 返回
pyssizet  pysequencefastgetsizepyobject   o 在 o  由 pysequencefast  返 回且 o 不为 null  的 情况 下返回 o  的长 度
 也可以 通过在 o  上调用 pysequencesize  来 获取 大小 但是 pysequencefastgetsize  速度 更 快因 为 它可 以 假 定 o  为列 表或 元组
在 o  由 pysequencefast  返 回且 o 不 null 并 且 i  d 在 索引 范 围内 的 情况 下 返回 o  的第 i  号元 素
pyobject  pysequencefastitemspyobject   o 返 回 pyobject  指针 的 底 层 数组
 假 设 o  由 pysequencefast 返回且 o  不为 null
 请注 意如果 列表 调 整大 小重 新 分配可 能会 重 新定位 items  数 组
 因此仅 在序 列无 法 更 改的上 下文 中使 用基 础 数组 指针
 返回 o  的 第 i 个 元素 或在 失败时 返回 null
 此形 式比 pysequencegetitem  理馔但 不会检 查 o 上的 pysequencecheck  是 否 为 真 值也 不会对 负序号 进行调 整
集合 对象
这 一章节详 细介绍 了 set 和 frozenset 对 象的公 共 api
任何 未在下 面列出 的功能 最好是 使用 抽象 对象协议 包 括 pyobjectcallmethodpyobjectrichcomparebool  pyobjecthash  pyobjectreprpyobjectistrue  pyobjectprint 以及 pyobjectgetiter  或者抽象 数 字协议 包括 pynumberand  pynumbersubtractpynumberor  pynumberxor  pynumberinplaceandpynumberinplacesubtract  pynumberinplaceor  以及 pynumberinplacexor  来访 问
pysetobject 这 个 pyobject  的子类 型 被用来 保存 set  和 frozenset  对 象 的 内 部 数据
 它类 似于 pydictobject 因 为 对 于 小 尺寸集 合来说 它 是 固定大 小 的 很 像元 组的 存储 方式 并且 对于 中 等 和 大尺寸 集合来 说 它 将指向 单独的 可 变 大小 的内 存 块 很 像列 表 的 存 储 方 式
此 结构 体的 字 段不 应被 视 为 公 有并 且可 能发 生改 变
 所 有 访问 应当 通过 已写入 文 档的 api  来 进行 而不 可通 过操 纵 结构 体 中的 值
pytypeobject  pysettype 这 是一 个 pytypeobject 实 例表 示 python  set 类 型
pytypeobject  pyfrozensettype  这是一个 pytypeobject 实 例表 示 python  frozenset  类型
下 列类 型检查 宏适 用于 指向 任 意 python 对象的指 针
类 似 地 这些 构 造函 数 也 适用 于任 意可 迭代 的 python 对 象
int  pysetcheckpyobject   p  如果 p 是 一个 set  对象或 者是 其 子类 型的 实例则返 回真值
int  pyfrozensetcheckpyobject   p  如果 p 是 一个 frozenset  对象或 者是 其子类 型的实例则返 回真值
int  pyanysetcheckpyobject   p 如果 p  是一 个 set 对 象、 frozenset 对 象 或 者是 其子 类型 的实 例则返 回真值
int  pyanysetcheckexactpyobject   p 如 果 p 是一个 set 对 象或 frozenset  对象但不是 其子 类型的实 例则返回真 值
int  pyfrozensetcheckexactpyobject   p 如 果 p 是 一个 frozenset  对象但不 是其子类型 的实 例则 返 回 真值
 返 回 一个 新 的 set  其 中 包 含 iterable  所 返回 的对 象
 iterable  可 以为 null  表示创 建 一 个新 的空 集合
成功时 返回 新 的集 合失败时 返 回 null
如 果 iterable 实际 上不 是可 迭代 对 象则 引发 typeerror 
 该构 造 器也适用于 拷贝 集合 csets
返回 一 个新 的 frozenset 其中 包 含 iterable  所 返回的 对 象
 iterable  可以 为 null 表示 创建 一 个新的 空冻结集 合
成 功时 返回 新的 冻结 集 合失败时 返回 null
 如果 iterable  实际上 不是 可迭代对 象 则引发 typeerror
 下列 函 数和 宏适 用于 set 或 frozenset 的 实例 或是其子 类型 的 实例
pyssizet  pysetsizepyobject   anyset  返回 set  或 frozenset 对象 的 长 度
等 价于 lenanyset
 如 果 anyset 不 是 set  frozenset 或其 子类 型的 实例 则会 引 发 pyexcsystemerror
pyssizet  pysetgetsizepyobject   anyset 宏 版 本的 pysetsize 不带 错误 检测
int  pysetcontainspyobject   anyset  pyobject   key  如果 找到返回1 如果 未找到返 回0 如 果遇 到错 误则返 回1
不 同于 python  contains  方法 此函数 不会自 动 将不可 哈 希 的 集 合 转换 为临 时的冻 结集合
 如果 key  为不可 哈希 对象 则会引发 typeerror 
 如果 anyset 不是 set  frozenset  或 其子 类型的 实例则 会引 发 pyexcsystemerror
int  pysetaddpyobject   set  pyobject   key 添 加 key 到一 个 set  实例
 也可用 于 frozenset  实例 类似于 pytuplesetitem  它可被用 来 为 全 新冻 结集 合在 公开 给 其他 代 码 之 前填 充全 新 的值
 成功 时 返回0 失 败时返 回1
如 果 key 为不 可哈 希对 象则 会 引发 typeerror
 如果 没 有增 长空间 则 会 引 发 memoryerror
 如果 set  不是 set  或 其子类型 的实 例则会引 发 systemerror
下列 函 数适 用于 set  或其子类 型的 实 例但不 可用 于 frozenset 或 其子 类型 的实例
int  pysetdiscardpyobject   set  pyobject   key  如果 找 到并 移除 返回1 如果 未 找 到 无 操作 返回0 如果 遇到 错误则返 回1
对于 不存在的键 不会引 发 keyerror
如 果 key 为 不可 哈 希 对 象则 会 引 发 typeerror
不 同于 python  discard 方 法此函 数 不 会 自动将 不 可哈 希 的 集 合转 换 为 临时 的 冻 结 集 合
 如 果 set 不 是 set 或 其子类型 的 实 例则会 引发 pyexcsystemerror
 返回 set  中 任意 对象 的 新 引 用 并从 set  中移 除该 对象
失败 时返 回 null
 如果 集合为 空 则会引发 keyerror
 如果 set  不 是 set 或 其 子 类 型的 实例 则会 引 发 systemerror
int  pysetclearpyobject   set 清 空现 有字典 的 所有 键值对
 切片 对象
稳 定的 应 用程 序 二进 制接 口
common  object  structures
base  object  types  and  macros
3
9新 版功能
3
9 新版 功能
3
9 新 版功 能
3
9新 版功能
implementing  functions  and  methods
 the  function  signature  is  pyobject  pycmethodpyobject  self  pytypeobject  definingclass  pyobject  const  args  pyssizet  nargs  pyobject  kwnames 3
9 新版 功能
 this  structure  has  four  fields  域 c 类型 意义 mlname  const  char  name  of  the  method  mlmeth  pycfunction  pointer  to  the  c  implementation  mlflags  int  flag  bits  indicating  how  the  call  should  be  constructed  mldoc  const  char  points  to  the  contents  of  the  docstring  the  mlmeth  is  a  c  function  pointer
3
7 新 版 功 能
3
7新 版 功 能
3
9 新 版 功 能
accessing  attributes  of  extension  types
 its  fields  are 域 c  类 型 意 义 name  const  char  name  of  the  member  type  int  the  type  of  the  member  in  the  c  struct  offset  pyssizet  the  offset  in  bytes  that  the  member  is  located  on  the  types  object  struct  flags  int  flag  bits  indicating  if  the  field  should  be  readonly  or  writable  doc  const  char  points  to  the  contents  of  the  docstring  type  can  be  one  of  many  t  macros  corresponding  to  various  c  types
 macro  name  c 数 据类 型 tshort  short  tint  int  tlong 长 整 型 tfloat  float  tdouble  double  tstring  const  char  tobject  pyobject  tobjectex  pyobject  tchar  char  tbyte  char  tubyte  unsigned  char  tuint 无符号整 型 tushort  unsigned  short  tulong 无 符号长 整型 tbool  char  tlonglong  long  long  tulonglong  无符 号 long  long  tpyssizet  pyssizet  tobject  and  tobjectex  differ  in  that  tobject  returns  none  if  the  member  is  null  and  tobjectex  raises  an  attributeerror
域 c 类 型意 义 name  const  char  attribute  name  get  getter  c  function  to  get  the  attribute  set  setter  optional  c  function  to  set  or  delete  the  attribute  if  omitted  the  attribute  is  readonly  doc  const  char  optional  docstring  closure  void  optional  function  pointer  providing  additional  data  for  getter  and  setter  the  get  function  takes  one  pyobject  parameter  the  instance  and  a  function  pointer  the  associated  closure  typedef  pyobject  getterpyobject  void  it  should  return  a  new  reference  on  success  or  null  with  a  set  exception  on  failure
操 作系 统实用 程序
3
6 新 版 功 能
警 告 the  c  fork  call  should  only  be  made  from  the  main  thread  of  the  main  interpreter
3
7新 版 功能
警告 the  c  fork  call  should  only  be  made  from  the  main  thread  of  the  main  interpreter
3
7 新版功 能
 警告 the  c  fork  call  should  only  be  made  from  the  main  thread  of  the  main  interpreter
3
7 新 版 功 能
 参见 os
3
7版 后 已移除 this  function  is  superseded  by  pyosafterforkchild
 参见 the  pyunicodedecodefsdefaultandsize  and  pyunicodedecodelocaleandsize  functions
3
5 新 版 功能
 在3
7版更 改 the  function  now  uses  the  utf 8 encoding  in  the  utf 8 mode
在3
8版更改 the  function  now  uses  the  utf 8 encoding  on  windows  if  pylegacywindowsfsencodingflag  is  zerochar  pyencodelocaleconst  wchart   text  sizet   errorpos  encode  a  wide  character  string  to  the  locale  encoding  with  the  surrogateescape  error  handler  surrogate  characters  in  the  range  udc 80
 参见 the  pyunicodeencodefsdefault  and  pyunicodeencodelocale  functions
3
5 新版 功 能
 在3
7 版 更改 the  function  now  uses  the  utf 8 encoding  in  the  utf 8 mode
 在3
8 版更 改 the  function  now  uses  the  utf 8 encoding  on  windows  if  pylegacywindowsfsencodingflag  is  zero
 元组 对 象
type  对 象
pytypeobject 对 象的 c 结 构用于描述 builtin 类 型
pyobject  pytypetype 这 是 属 于 type 对 象的 type  object  它在 python 层 面 和 type 是 相同的 对 象
int  pytypecheckpyobject   o  如果 对象 o 是一 个类 型对 象包括继 承于 标准 类型对象的 类型 实例返 回非 零
在 其它所有 情况 下返 回0
3
2新版功能
 在3
4 版 更 改 the  return  type  is  now  unsigned  long  rather  than  long
3
4新 版功 能
3
9新版功 能
3
9新 版功 能
creating  heapallocated  types
3
9新版功能
3
3 新 版 功能
 在3
9版 更改 slots  in  pybufferprocs  in  may  be  set  in  the  unlimited  api
type 对象
in  addition  to  the  following  quick  reference  the  例子 sectionprovides  ataglance  insight  into  the  meaning  and  use  ofpytypeobject
 快速 参考
tp 槽
 pytypeobject 槽 type 特 殊方法 属性 信息21 o  t  d  i  r  tpname  const  char  name  x  x  tpbasicsize  pyssizet  x  x  x  tpitemsize  pyssizet  x  x  tpdealloc  destructor  x  x  x  tpvectorcallof  pyssizet  x  x  fset  tpgetattr  getattrfunc  getattribute  g  getattr  tpsetattr  setattrfunc  setattr  g  delattr  tpasasync  pyasyncmethods  subslots  tprepr  reprfunc  repr  x  x  x  tpasnumber  pynumbermethods  subslots  tpassequence  pysequencemethod  subslots  s  tpasmapping  pymappingmethods  subslots  tphash  hashfunc  hash  x  g  tpcall  ternaryfunc  call  x  x  tpstr  reprfunc  str  x  x  tpgetattro  getattrofunc  getattribute  x  x  g  getattr  tpsetattro  setattrofunc  setattr  x  x  g  delattr  tpasbuffer  pybufferprocs  tpflags  无符号长 整型 x  x  tpdoc  const  char  doc  x  x  tptraverse  traverseproc  x  g  tpclear  inquiry  x  g  tprichcompare  richcmpfunc  lt  le  x  g  eq  ne  gt  ge  tpweaklistoffse  pyssizet  x  t  tpiter  getiterfunc  iter  x  tpiternext  iternextfunc  next  x  tpmethods  pymethoddef  x  x  tpmembers  pymemberdef  x  tpgetset  pygetsetdef  x  x  tpbase  pytypeobject  base  x  tpdict  pyobject  dict  tpdescrget  descrgetfunc  get  x  tpdescrset  descrsetfunc  set  x  delete  tpdictoffset  pyssizet  x  tpinit  initproc  init  x  x  x  tpalloc  allocfunc  x  tpnew  newfunc  new  x  x  tpfree  freefunc  x  x  tpisgc  inquiry  x  x  tpbases  pyobject  bases  tpmro  pyobject  mro  tpcache  pyobject  tpsubclasses  pyobject  subclasses  tpweaklist  pyobject  tpdel  destructor  tpversiontag  无符 号整型 tpfinalize  destructor  del  x  tpvectorcall  vectorcallfunc 1 a  slot  name  in  parentheses  indicates  it  is  effectively  deprecated
2列 o  set  on  pybaseobjecttype  t  set  on  pytypetype  d  default  if  slot  is  set  to  null  x  pytypeready  sets  this  value  if  it  is  null  pytypeready  always  sets  this  value  it  should  be  null  pytypeready  may  set  this  value  depending  on  other  slots  also  see  the  inheritance  column  i
subslots
槽 type  特 殊 方法 amawait  unaryfunc  await  amaiter  unaryfunc  aiter  amanext  unaryfunc  anext  nbadd  binaryfunc  add  radd  nbinplaceadd  binaryfunc  iadd  nbsubtract  binaryfunc  sub  rsub  nbinplacesubtract  binaryfunc  sub  nbmultiply  binaryfunc  mul  rmul  nbinplacemultiply  binaryfunc  mul  nbremainder  binaryfunc  mod  rmod  nbinplaceremainder  binaryfunc  mod  nbdivmod  binaryfunc  divmod  rdivmod  nbpower  ternaryfunc  pow  rpow  nbinplacepower  ternaryfunc  pow  nbnegative  unaryfunc  neg  nbpositive  unaryfunc  pos  nbabsolute  unaryfunc  abs  nbbool  inquiry  bool  nbinvert  unaryfunc  invert  nblshift  binaryfunc  lshift  rlshift  nbinplacelshift  binaryfunc  lshift  nbrshift  binaryfunc  rshift  rrshift  nbinplacershift  binaryfunc  rshift  nband  binaryfunc  and  rand  nbinplaceand  binaryfunc  and  nbxor  binaryfunc  xor  rxor  nbinplacexor  binaryfunc  xor  nbor  binaryfunc  or  ror  nbinplaceor  binaryfunc  or  nbint  unaryfunc  int  nbreserved  void  nbfloat  unaryfunc  float  nbfloordivide  binaryfunc  floordiv  nbinplacefloordivide  binaryfunc  floordiv  nbtruedivide  binaryfunc  truediv  nbinplacetruedivide  binaryfunc  truediv  nbindex  unaryfunc  index  nbmatrixmultiply  binaryfunc  matmul  rmatmul  nbinplacematrixmultip  binaryfunc  matmul  ly  mplength  lenfunc  len  mpsubscript  binaryfunc  getitem  mpasssubscript  objobjargproc  setitem  delitem  sqlength  lenfunc  len  sqconcat  binaryfunc  add  sqrepeat  ssizeargfunc  mul  sqitem  ssizeargfunc  getitem  sqassitem  ssizeobjargproc  setitem  delitem  sqcontains  objobjproc  contains  sqinplaceconcat  binaryfunc  iadd  sqinplacerepeat  ssizeargfunc  imul  bfgetbuffer  getbufferproc  bfreleasebuffer  releasebufferpr  oc 
slot  typedefs
 typedef  参数类 型 返回 类型 allocfunc  pytypeobject  pyssizet  pyobject  destructor  void  void  freefunc  void  void  traverseproc  void  visitproc  void  整型 newfunc  pyobject  pyobject  pyobject  pyobject  initproc  pyobject  pyobject  整 型 pyobject  reprfunc  pyobject  pyobject  getattrfunc  pyobject  const  char  pyobject  setattrfunc  pyobject  const  char 整 型 pyobject  getattrofunc  pyobject  pyobject  pyobject  setattrofunc  pyobject  pyobject  整 型 pyobject  descrgetfunc  pyobject  pyobject  pyobject  pyobject  descrsetfunc  pyobject  pyobject  整 型 pyobject  hashfunc  pyobject  pyhasht  richcmpfunc  pyobject  pyobject  整 pyobject 型 getiterfunc  pyobject  pyobject  iternextfunc  pyobject  pyobject  lenfunc  pyobject  pyssizet  getbufferproc  pyobject  pybuffer  整整型型 releasebufferproc  pyobject  pybuffer  void  inquiry  void  整型 unaryfunc  pyobject  pyobject  binaryfunc  pyobject  pyobject  pyobject  ternaryfunc  pyobject  pyobject  pyobject  pyobject  ssizeargfunc  pyobject  pyssizet  pyobject  ssizeobjargproc  pyobject  pyssizet 整型 objobjproc  pyobject  pyobject  整型 objobjargproc  pyobject  pyobject  整型 pyobject 请参阅 slot  type  typedefs  里有 更多 详细 信 息
pytypeobject  definition
pyobject  slots
pyvarobject  slots
pytypeobject  slots
警告 it  is  not  recommended  for  heap  types  to  implement  the  vectorcall  protocol
注 解 the  semantics  of  the  tpvectorcalloffset  slot  are  provisional  and  expected  to  be  finalized  in  python 3
在3
8 版 更 改 before  version 3
8 this  slot  was  named  tpprint
 in  python 2
 in  python 3
0 to 3
3
5新 版功能 formerly  known  as  tpcompare  and  tpreserved
 more  information  in  section  使对 象类 型支 持循环垃 圾回 收
 this  bit  also  implies  that  the  gcrelated  fields  tptraverse  and  tpclear  are  present  in  the  type  object
3
8 新 版 功 能
3
4 新版 功能
3
8 版后 已 移 除 this  flag  isnt  necessary  anymore  as  the  interpreter  assumes  the  tpfinalize  slot  is  always  present  in  the  type  structure
3
9 新 版 功 能
 the  signature  is  int  tptraversepyobject  self  visitproc  visit  void  arg  more  information  about  pythons  garbage  collection  scheme  can  be  found  in  section  使对 象类 型支 持 循 环 垃圾回 收
警告 when  implementing  tptraverse  only  the  members  that  the  instance  owns  by  having  strong  references  to  them  must  be  visited
 在3
9 版更改 heapallocated  types  are  expected  to  visit  pytypeself  in  tptraverse
 more  information  about  pythons  garbage  collection  scheme  can  be  found  in  section  使对 象类型 支持 循环 垃圾 回 收
 the  following  constants  are  defined  to  be  used  as  the  third  argument  for  tprichcompare  and  for  pyobjectrichcompare  常数对 照 pylt  pyle  pyeq  pyne  pygt  pyge  定义 以 下宏是为了简 化编 写丰富的比较 函数 pyreturnrichcomparevala  valb  op  return  pytrue  or  pyfalse  from  the  function  depending  on  the  result  of  a  comparison
3
7 新 版功能
 注 解 slot  initialization  is  subject  to  the  rules  of  initializing  globals
 警 告 it  is  not  safe  to  use  pydictsetitem  on  or  otherwise  modify  tpdict  with  the  dictionary  capi
3
4 新 版功能
 参见 safe  object  finalization  pep 442 vectorcallfunc  pytypeobject
3
9 新 版 功能 the  field  exists  since 3
8 but  its  only  used  since 3
heap  types
unicode 对 象和编 码 解码 器
unicode 对 象
自 从 python 3
3 中 实现 了 pep 393以 来 unicode 对 象在 内部 使 用 各种表 示 形 式以 便在 保 持 内存 效率 的 同 时 处 理 完 整 范 围 的 unicode  字 符
 对 于 所有 代码 点 都 低于128、256 或65536的 字 符 串有 一 些 特 殊情 况否 则代 码点必 须低 于1114112 这 是 完 整 的 unicode 范 围
注 解 the  legacy  unicode  object  will  be  removed  in  python 3
unicode 类 型
3
3 新 版 功 能
 在3
3 版更 改 in  previous  versions  this  was  a 16 bit  type  or  a 32 bit  type  depending  on  whether  you  selected  a  narrow  or  wide  unicode  version  of  python  at  build  time
3
3 新 版功能
3
3 新版 功 能
3
3 新 版 功能
3
3新 版功 能
3
3新 版功 能
3
3新 版功 能
3
3新 版功 能
3
3新 版功 能
3
3新 版功 能
3
3 新 版 功 能
3
3新 版 功 能
在3
3版 更改 this  macro  is  now  inefficient  because  in  many  cases  the  pyunicode  representation  does  not  exist  and  needs  to  be  created  and  can  fail  return  null  with  an  exception  set
 try  to  port  the  code  to  use  the  new  pyunicodenbytedata  macros  or  use  pyunicodewrite  or  pyunicoderead
int  pyunicodeisidentifierpyobject   o  return 1 if  the  string  is  a  valid  identifier  according  to  the  language  definition  section  标识 符和 关键 字
 return 0 otherwise
在3
9 版 更改 the  function  does  not  call  pyfatalerror  anymore  if  the  string  is  not  ready
unicode  字 符 属 性
3
3版 后 已 移 除 this  function  uses  simple  case  mappings
3
3 版后 已 移除 this  function  uses  simple  case  mappings
3
3 版 后 已移除 this  function  uses  simple  case  mappings
creating  and  accessing  unicode  strings
3
3 新 版 功能
3
3 新版 功 能
 the  following  format  characters  are  allowed  格式 字 符类 型注 释不 适用 文 字字 符
 c 整 型单个 字符 表示 为 c 语 言的 整型
 d  整型 相当于 printfd
1 u  无符号 整型 相 当 于 printfu
1 ld  长整型 相 当于 printfld
1 li  长整 型相 当 于 printfli
1 lu  无符 号 长 整 型相 当 于 printflu
1 lld  long  long 相 当于 printflld
1 lli  long  long 相当 于 printflli
1 llu  无 符 号 long  long  相当 于 printfllu
1 zd  pyssizet 相 当 于 printfzd
1 zi  pyssizet 相 当于 printfzi
1 zu  sizet  相 当于 printfzu
1 i  整型 相当 于 printfi
1 x  整型相 当 于 printfx
1 s  const  char 以 null  为 终 止符 的 c  字 符 数 组
 p  const  void 一 个 c  指 针 的十六 进 制 表 示 形式
 基本 等 价 于 printfp  但 它 会确 保 以 字 面 值0 x 开 头 不论 系 统 平 台上 printf 的输 出是 什 么
 a  pyobject  ascii  调用 的结果
 u  pyobject  a  unicode  object
 注 解 the  width  formatter  unit  is  number  of  characters  rather  than  bytes
在3
2 版更 改 support  for  lld  and  llu  added
 在3
3 版 更 改 support  for  li  lli  and  zi  added
 在3
4 版 更 改 support  width  and  precision  formatter  for  s  a  u  v  s  r  added
3
3新版功能
3
3 新版功 能
3
3 新版功 能
3
3新 版功能
3
3 新 版 功 能
3
3新版功 能
3
3 新版 功能
3
3 新版 功 能
deprecated  pyunicode  apis
3
3 新 版 功 能
3
2 新 版功 能
locale  encoding
参 见 the  pydecodelocale  function
3
3新 版功 能
 在3
7 版 更改 the  function  now  also  uses  the  current  locale  encoding  for  the  surrogateescape  error  handler  except  on  android
3
3 新 版 功 能
参 见 the  pyencodelocale  function
3
3新版 功能
 在3
7版 更 改 the  function  now  also  uses  the  current  locale  encoding  for  the  surrogateescape  error  handler  except  on  android
file  system  encoding
3
1 新 版功 能
在3
6 版更改 接 受 一个类路 径 对 象
3
2新版功 能
 在3
6 版更 改接 受 一 个 类 路 径对 象
参见 the  pydecodelocale  function
 在3
6版 更改 use  pyfilesystemdefaultencodeerrors  error  handler
在3
6 版更 改 use  pyfilesystemdefaultencodeerrors  error  handler
 参 见 the  pyencodelocale  function
3
2 新版 功能
在3
6版更 改 use  pyfilesystemdefaultencodeerrors  error  handler
wchart  support
3
2新 版功 能
 在3
7 版 更 改 raises  a  valueerror  if  size  is  null  and  the  wchart  string  contains  null  characters
builtin  codecs
generic  codecs
utf 8 codecs
3
3 新版 功能
在3
7版 更改 the  return  type  is  now  const  char  rather  of  char 
3
3 新 版 功 能
在3
7 版更 改 the  return  type  is  now  const  char  rather  of  char 
utf 32 codecs
utf 16 codecs
utf 7 codecs
unicodeescape  codecs
rawunicodeescape  codecs
latin 1 codecs
ascii  codecs
character  map  codecs
mbcs  codecs  for  windows
3
3新 版 功 能
methods  slots
methods  and  slot  functions
3
3新 版功 能
在3
7版更 改 start  and  end  are  now  adjusted  to  behave  like  strstartend
工 具
 本 章 中的 函数 执行 各 种 实 用工具 任 务 包括帮 助 c  代 码提升跨 平台可 移植 性 在 c  中 使 用 python 模 块 以及解 析函 数 参 数 并 根据 c 中 的值构建 python  中的 值 等 等
 操 作 系 统 实 用 程 序系 统 功 能 过 程 控制 导 入 模块 数 据 marshal  操 作支 持语 句解 释 及 变 量 编 译 解析 参 数字 符串 和 缓存 区 数字 其他 对象 api  函 数 创 建变 量 字符 串 转换与格 式化 反射编 解码 器 注 册与 支持 功能 codec  查找 api  用 于 unicode  编 码 错 误 处 理 程序 的 注册 表 api
the  very  high  level  layer
3
8 新 版 功 能
 注 解 on  windows  fp  should  be  opened  as  binary  mode  e
 在3
4 版 更 改 the  result  must  be  allocated  by  pymemrawmalloc  or  pymemrawrealloc  instead  of  being  allocated  by  pymemmalloc  or  pymemrealloc
3
4 新 版功 能
3
2 新 版 功 能
 在3
4 版更 改 this  function  now  includes  a  debug  assertion  to  help  ensure  that  it  does  not  silently  discard  an  active  exception
 在3
8 版 更 改 added  cffeatureversion  field
 弱 引 用 对 象
python  支 持 弱 引 用 作 为 一 类对 象
 具 体 来说 有 两 种 直 接 实现 弱引用的 对象
 第 一 种 就 是 简 单 的引 用 对 象 第二 种 尽可 能 地 作用 为 一个 原对 象的 代 理
int  pyweakrefcheckob  如果 ob  是一个 引用或者 一 个 代理 对 象 则 返 回 一 个 true
int  pyweakrefcheckrefob  如 果 ob  是 一个 引 用 则 返回 true
int  pyweakrefcheckproxyob  如 果 ob 是 一 个代 理对象则返 回 true
返 回对 象 ob  的一 个 弱 引 用 对 象
 该 函 数 总 是 会 返回 一 个 新 的 引用 但不 保 证 创 建 一 个 新的 对 象它有 可 能 返回 一 个现 有的 引用 对 象
 第二个形 参 callback 为一 个可 调 用 对象 它会 在 ob 被作 为垃 圾回 收时 接收 通知 它 应该 接 受 一 个 单 独 形 参 即 弱 引 用 对 象 本 身
 callback  也 可以 为 none  或 null
 如果 ob  不是一 个 弱 引 用对 象 或 者如 果 callback  不 是 可调 用 对 象 none  或 null  该函 数 将返 回 null  并 且引 发 typeerror
 返 回对 象 ob 的 一 个 弱 引 用 代理 对 象
 该函 数 将总 是返 回一个 新 的引 用但不 保证 创建 一个 新的对象它 有可能 返回 一个现 有 的 代理对 象
 第 二 个 形参 callback 为一 个可 调 用对 象它 会在 ob  被 作 为垃 圾 回收 时 接 收通 知它 应该 接受 一个 单独形 参即 弱引 用对象 本身
 callback  也可 以为 none  或 null
如果 ob  不 是 一个 弱 引用 对象 或 者 如果 callback  不是可 调用 对象 none  或 null 该 函数 将返 回 null 并 且 引发 typeerror
返回 弱引 用对象 ref 的 被引用对 象
 如果 被 引用 对 象不 再 存在 则 返回 pynone
 注解 该 函数 返回被 引用 对 象 的一 个 借 来的引 用
这意 味着除非 你 很清 楚 在你使 用 期 间 这个 对象不 可 能被 销毁 否则你 应 该始终对 该对象 调用 pyincref
 类似 pyweakrefgetobject  但实 现为 一个 不做 类型 检查的 宏
python 文档 内容
 版权
python  与 这 份 文档 版权 所 有©20012020 python 软 件 基金 会
保 留所 有权 利
版 权所 有©2000 beopen
保 留所 有权 利
版 权所 有©19952000 corporation  for  national  research  initiatives
保 留所 有权 利
 版权 所有©19911995 stichting  mathematisch  centrum
 保留 所有 权利
 有 关完 整的 许可 证和许 可 信 息参见 历史 和许 可证
 分发 python  模 块
电 子 邮箱 distutilssigpython
org  作为 一个流 行的开 源 开发 项目 python  拥 有 一 个活 跃的 贡献者 和用户 支持社 区这些 社区 也 可以 让他 们的 软 件可 供其他 python  开发人员 在开 源许可 条款下 使用
 这允 许 python 用 户 有 效地 共享和协 作从 其他 人已经创 建的 解 决方 案中 受益 于常见有 时甚 至是 罕 见 的问题以 及 可以提供 他们 自己 的解 决 方 案
本 指南涵 盖 了分发 部 分的流 程
有关 安装 其他 python  项 目的 指南请 参阅安 装指南
 注解 对于企 业 和 其 他 机构 用 户 请注意许多 组织都 有 自己 的 政 策 来使用和 贡 献 开源 软件
 在 使 用 python  提供的 分 发和 安装工 具时 请考 虑 这些政 策
 关键 术 语
 开源许可与 协作
 在 世界上 大 多数 地方软 件 自 动受 版权 保 护
 这 意味着 其 他开发人 员需 要明 确的 权限 来 复 制 使用修改 和重新 分发软 件
开 源 许 可 是 一种 以相对 一致 的 方 式 明确 授予此 类 权限 的方 式 允 许开发人 员 通过 为各种 问题 免费提供通用 解决 方 案来 有效 地 共享 和协作
 这 使 得许 多开 发人 员可 以 将更 多时 间 用 于 关 注他 们 特定 情 况 相对独特 的问题
python  提 供 的分发 工具 旨在 使开发 人 员 选择 开源 时 可 以合 理地 直 接 将其 自己 的贡 献回 馈到 该公 共软件 池
无论 该软件 是否作 为开 源软件发布相同 的分 发工 具也 可 用于 在组 织内 分 发软 件
安装工具
标准 库不 包 括支持 现代 python  打包 标准的 构 建 工 具因 为核心 开 发 团 队已 经 发现 即使 在旧版 本的 python 上 使 用一 致工作 的 标 准工 具也很重 要
可以 通过 在命 令行调用 pip  模块来 安 装当 前推 荐 的构建和 分发 工具 python  m  pip  install  setuptools  wheel  twine  注解对 于 posix 用户包 括 mac  os  x 和 linux 用户 这些说 明假 定 使用 virtual  environment 
 对于 windows 用户 这些 说明 假 定在 安装 python 时 选择 了调 整 系统 path  环境 变 量 的选 项
python 打包 用 户 指南包 含 有关 currently  recommended  tools  的 更 多详细 信息
阅 读 python  包 用户 指 南
python 包 装用户 指南 介绍了 创 建和 发布项 目 所 涉及 的各个关 键 步骤 和 元 素 项目 的结 构 项 目 的构 建与打 包 上传 项目 到 python  packaging  index  the 
 我该如 何？
这 是一 些常见 任 务 的快 速解 答或相 关 链接
 为我 的 项目 选择一 个名 字？
这 不 是一 个简 单的主 题但 这里 有 一些 提示检查 python  packaging  index  以查看 该 名称 是否 已 被使用 检查 流 行的托管网 站如 githubbitbucket 等等看 是否已有 一 个该 名 称 的项目检 查您正在 考 虑 的名称在 网络搜 索中 出 现 的内容避 免使 用特 别 常见 的单 词尤 其是 具 有多 重 含 义 的单词因 为它们会使 用户 在搜 索时难 以找 到您的 软件
创建 和分发二进制扩 展？
这实际 上是一 个非 常复 杂 的 主题根 据您的 目标可 以 提供 各种 替代 方 案
 有关更 多信 息 和建议请 参阅 python  打包 指 南
 参见 python 封 装使 用 指南二进 制扩 展
api 参 考引 用
 参 见 new  and  changed  setup
 注解这 篇 文 档只 有在 httpssetuptools
html 上 的 setuptools  文档 独立 涵盖此 处 包含 的 所 有 相 关信 息之 前才 会 单 独保 留
distutilscore 分发 包功能 的核心
core  是为 了使 用 distutils  工具 唯一 要安装 的模块
 它提供 函 数 setup 该 函数被 setup 脚本 调用
 间接 提供 了类 distutils
distribution 和 distutils
command
参 数 名 称值 类型 name  包的名 字字 符串 version  包的版 本号参见 字 符串 distutils
version  description  单行的 包 的 描述字 符串 longdescription  更长 的 包描述 字符串 author  包 的作 者字 符串 authoremail 包的 作 者的 电子邮 件 字 符串 maintainer  the  name  of  the  current  字符 串 maintainer  if  different  from  the  author
 note  that  if  the  maintainer  is  provided  distutils  will  use  it  as  the  author  in  pkginfo  maintaineremail  当前 维护 者的 电 子邮 件地址 如果 不 字符 串 同与作 者 url 包 的 url 主 页 字符串 downloadurl  包的下 载地址 字符 串 packages  a  list  of  python  packages  that  字符 串列表 distutils  will  manipulate  pymodules  distutils  会 操作的 python  模块 列字符 串列 表表 scripts  要构建 和安 装 的独立脚 本文 件 的列表 字符 串 列表 extmodules 要 构建的 python 扩 展的 列表 类 distutils
extension  的 实例的 列表 classifiers  包的类别 列表 a  list  of  strings  valid  classifiers  are  listed  on  pypi
 distclass 要 使 用 的类 distribution  类 distutils
distribution  的子 类 scriptname  setup
py 脚 本名 称——默认 为 字符串 sys
argv 0 scriptargs  提 供给 安装 脚本的 参 数字符 串列 表 options  安 装脚本 的默 认选项字 典 license  包 的 许可 证字 符串 keywords  descriptive  metadata  see  pep  字符串 列 表或 逗号 分隔 的 字符 串314 platforms  字 符 串 列 表或逗号 分 隔的 字符串 cmdclass  a  mapping  of  command  names  to  字 典 command  subclasses  datafiles 要 安装的数 据 文 件 列 表 列 表 packagedir  a  mapping  of  package  to  字 典 directory  names  distutils
 stopafter  tells  setup  when  to  stop  processing  possible  values  值描述 init  stop  after  the  distribution  instance  has  been  created  and  populated  with  the  keyword  arguments  to  setup  config  stop  after  config  files  have  been  parsed  and  their  data  stored  in  the  distribution  instance  commandline  stop  after  the  commandline  sys
 it  accepts  the  following  keyword  arguments  in  its  constructor  参数名 称 值类型 name  the  full  name  of  the  extension 字符 串 including  any  packages  ie
 not  a  filename  or  pathname  but  python  dotted  name  sources  list  of  source  filenames 字符 串列表 relative  to  the  distribution  root  where  the  setup  script  lives  in  unix  form  slash  separated  for  portability
 includedirs  list  of  directories  to  search  字符串 列表 for  cc  header  files  in  unix  form  for  portability  definemacros  list  of  macros  to  define  each  元 组 列表 macro  is  defined  using  a 2 tuple  name  value  where  value  is  either  the  string  to  define  it  to  or  none  to  define  it  without  a  particular  value  equivalent  of  define  foo  in  source  or  dfoo  on  unix  c  compiler  command  line  undefmacros 要 明确 取消定 义的 宏 列表 字符 串列 表 librarydirs  list  of  directories  to  search 字符 串 列表 for  cc  libraries  at  link  time  libraries 要 链接的 库名 列 表 不 是文件名或 路字 符 串 列 表径 runtimelibrarydirs  list  of  directories  to  search  字符 串 列 表 for  cc  libraries  at  run  time  for  shared  extensions  this  is  when  the  extension  is  loaded  extraobjects  list  of  extra  files  to  link  with  字 符串 列 表 eg
 extracompileargs  any  extra  platform  and 字 符串列 表 compilerspecific  information  to  use  when  compiling  the  source  files  in  sources
 extralinkargs  any  extra  platform  and 字符 串列表 compilerspecific  information  to  use  when  linking  object  files  together  to  create  the  extension  or  to  create  a  new  static  python  interpreter
 exportsymbols  list  of  symbols  to  be  exported  字 符串列 表 from  a  shared  extension
 depends 扩 展名 依 赖的 文 件列 表 字符 串 列表 language  extension  language  i
 c  字符 串 c  objc
 optional  指 定 扩 展 中的构 建 失败 不 应中 止构 建 布尔 过程 而只 是 跳过扩 展
在3
8 版更 改 on  unix  c  extensions  are  no  longer  linked  to  libpython  except  on  android  and  cygwin
在3
7 版更 改 distribution  now  warns  if  classifiers  keywords  and  platforms  fields  are  not  specified  as  a  list  or  a  string
distutilsccompiler  ccompiler 基 类
 the  exact  set  of  executables  that  may  be  specified  here  depends  on  the  compiler  class  via  the  executables  class  attribute  but  most  will  have 属性描 述 compiler  cc 编译 器 linkerso  用 于创 建共享 对象 和库的链接 器 linkerexe 用于 创建二 进制 可执行 文件的 链接 器 archiver 静 态 库创建 者 on  platforms  with  a  commandline  unix  doswindows  each  of  these  is  a  string  that  will  be  split  into  executable  name  and  optional  list  of  arguments
distutilsunixccompiler  unix  c  compiler
distutilsmsvccompiler  microsoft  compiler
distutilsbcppcompiler  borland  compiler
distutilscygwincompiler  cygwin  compiler
distutilsarchiveutil  archiving  utilities
distutilsdeputil  dependency  checking
distutilsdirutil  directory  tree  operations
在3
1 版更 改 nfs  files  are  ignored
distutilsfileutil  single  file  operations
警 告 handles  crossdevice  moves  on  unix  using  copyfile
distutilsutil  miscellaneous  other  utility  functions
 返回 值的 示 例 linuxi 586 linuxalpha  solaris 2
8 and  earlier 在3
9版 更改 the  aix  platform  string  format  now  also  includes  the  technology  level  build  date  and  abi  bitsize
 在3
3版更改 create 
pyc  files  with  an  import  magic  tag  in  their  name  in  a  pycache  subdirectory  instead  of  files  without  tag  in  the  current  directory
 在3
5版 更改 create 
pyc  files  according  to  pep 488
distutilsdist  the  distribution  class
distutilsextension  the  extension  class
distutilsdebug  distutils  debug  mode
 本 模 块提供 debug  标识
distutilserrors  distutils  exceptions
distutilsfancygetopt  wrapper  around  the  standard  getopt  module
distutilsfilelist  the  filelist  class
distutilslog  simple  pep 282 style  logging
distutilsspawn  spawn  a  subprocess
distutilssysconfig  system  configuration  information
distutilstextfile  the  textfile  class
 the  options  are  all  boolean  and  affect  the  values  returned  by  readline  选 项名称描 述默 认值 stripcomments  strip  from  to  endofline  true  as  well  as  any  whitespace  leading  up  to  the  unless  it  is  escaped  by  a  backslash  lstripws  strip  leading  whitespace  from  false  each  line  before  returning  it  rstripws  strip  trailing  whitespace  true  including  line  terminator  from  each  line  before  returning  it
distutilsversion  version  number  classes
distutilscmd  abstract  base  class  for  distutils  commands
creating  a  new  distutils  command
distutilscommand  individual  distutils  commands
distutilscommandbdist  build  a  binary  installer
distutilscommandbdistpackager  abstract  base  class  for  packagers
distutilscommandbdistdumb  build  a  dumb  installer
distutilscommandbdistmsi  build  a  microsoft  installer  binary  package
bdistmsi 3
9 版 后 已移除 use  bdistwheel  wheel  packages  instead
builds  awindows  installer 
in  most  cases  the  bdistmsiinstaller  is  a  better  choice  than  the  bdistwininst  installerbecause  it  provides  better  support  for  win 64 platforms  allowsadministrators  to  perform  noninteractive  installations  and  allowsinstallation  through  group  policies
distutilscommandbdistrpm  build  a  binary  distribution  as  a  redhat  rpm  and  srpm
distutilscommandbdistwininst  build  a  windows  installer
3
8 版后 已 移除 use  bdistwheel  wheel  packages  instead
distutilscommandsdist  build  a  source  distribution
distutilscommandbuild  build  all  files  of  a  package
distutilscommandbuildclib  build  any  c  libraries  in  a  package
distutilscommandbuildext  build  any  extensions  in  a  package
distutilscommandbuildpy  build  the  pypyc  files  of  a  package
distutilscommandbuildscripts  build  the  scripts  of  a  package
distutilscommandclean  clean  a  package  build  area
distutilscommandconfig  perform  package  configuration
distutilscommandinstall  install  a  package
distutilscommandinstalldata  install  data  files  from  a  package
distutilscommandinstallheaders  install  cc  header  files  from  a  package
distutilscommandinstalllib  install  library  files  from  a  package
distutilscommandinstallscripts  install  script  files  from  a  package
distutilscommandregister  register  a  module  with  the  python  package  index
distutilscommandcheck  check  the  metadata  of  a  package
creating  built  distributions
创建 rpm  软件 包
spec 文 件配置或 选 项 distutils  安装脚 本选 项名称 name 摘 要 在 序言中 description  版本 version  供应 商 author  和 authoremail 或 maintainer  和 maintaineremail 版权 license  url  url  d 描 述部分 longdescription  additionally  there  are  many  options  in 
spec  文件 配置 或选项 bdistrpm 选 项 默 认值发 布版 本 release 1组织 group  developmentlibraries 供 应 商 vendor  同上 打包 packager  none  提 供 provides  none 需 求 requires  none  冲 突 conflicts  none 淘 汰 obsoletes  none  distribution  distributionname  none  构建 要求 buildrequires  none  icon  icon  none  obviously  supplying  even  a  few  of  these  options  on  the  commandlinewould  be  tedious  and  errorprone  so  its  usually  best  to  put  them  inthe  setup  configuration  file  setup
cfgsee  section  编写 设 置脚 本的 配置 文 件
 if  you  distribute  or  package  many  python  moduledistributions  you  might  want  to  put  options  that  apply  to  all  of  themin  your  personal  distutils  configuration  file 
if  you  want  to  temporarily  disable  this  file  you  can  pass  the  nousercfg  option  to  setup
creating  windows  installers
crosscompiling  on  windows
the  postinstallation  script
vista  user  access  control  uac
命令参考
 注 解 这篇文档 只有在 httpssetuptools
html  上的 setuptools 文 档独 立涵盖此 处 包 含的 所有相 关信息之 前才会 单独保留
 安装 模块 install 命令 族
install  命令 会确 保 build 命 令 已经 运 行然 后 运 行子命 令 installlibinstalldata  和 installscripts
installdata
此命 令 会安 装 随 发行 包一 同 提 供 的 所有数 据文 件
installscripts
 此命 令会 安 装 发行 包中的 所 有 python 脚 本
 创建源 码发行 包 sdist 命 令
编 写 设 置脚 本 的配置 文 件
distutils 示 例
注解这篇 文档 只有在 httpssetuptools
html  上的 setuptools 文 档独 立涵 盖此处 包含 的所 有相 关信 息之前 才会 单独保留
本章 节提 供几 个 基 础 示例来 帮助 用 户入 门 distutils
关 于 使 用 distutils 的 额 外信 息可 以 参 考 distutils  cookbook
参见 distutils  cookbook  一套 展 示如何 更好 地控 制和 使用 distutils 的 方法
 纯 python 分发 通 过 module
纯 python  分发 通 过 包
单 个扩 展 模块
扩 展模 块用 extmodules  选项指定
packagedir  对 在哪寻 找 扩展 源文 件无 效它只对纯 python 模 块 的源文 件有 效
最 简 单的一 个用单个 c  源 文件 写的单扩 展模 块 是 root  setup
c 如 果 foo  扩 展属于 根包 则 配置 脚 本可 以是 from  distutils
c  如果 扩 展在包 中比如 foopkg 那 么使 用完全 相同 的源文件 树排 布通过 改 变扩 展的 名字 这 个 扩 展 很容 易 放入 foopkg 包 中 from  distutils
检 查一个 包
check 命令 允许 你 校验你的 包的元数 据 是 否满足 生 成 分发的 最低 要 求
 直接 使用 你的 setup
py  脚本来运 行 它
如果缺 了一些东 西 check 会显 示警告
我 们来 用单 个脚本举 例 from  distutils
core  import  setup  setupnamefoobar  运行 check 命 令 会 显示 一些 警告 python  setup
py  check  running  check  warning  check  missing  required  metadata  version  url  warning  check  missing  metadata  either  author  and  authoremail  or  maintainer  and  maintaineremail  should  be  supplied  如果 你在 longdescription  域中 使 用 restructuredtext  语 法并且 安装 了 docutils 你可 以用 check 命令和 restructuredtext  选项检 查语法 是 否正确
 比如 如果 setup
py  脚本 改 成 from  distutils
com  longdescriptiondesc  长 描述中 有问 题的地 方通过使用 docutils  解析器 check  能进行 删 除 python  setup
读取 元数 据
distutils
setup 函 数提供一 个 通 过项 目的 setup
py 脚 本 来查 询 项 目的元 数 据的域 的命令行 接口 python  setup
py  name  distribute  这个调用 通 过 运 行 distutils
setup 函数 读 取 name 元数据
 然而 当源文 件 或者 二进 制分发 用 distutils 创 建时 元数据域 写入 一个 名为 pkginfo  的静态 文件
当 一个 基于 distutils  的 项 目安装 在 python 中 时 pkginfo  文 件随 着分 发 的 模块 和 包一起 复制到 nameversionpyx
egginfo  中 其中 name  是项目 的 名 字 version  是元 数据 中定 义 的 版 本 pyx
x 则 是 python 的 大 版本和小版 本如2
7 或 者3
 你可 以读 回静态 文件使 用 distutils
distributionmetadata 类 和 它的 readpkgfile  方 法 from  distutils
description  easily  download  build  install  upgrade  and  uninstall  python  packages 注意 类也 可以 用 元数据文 件 载入 值 来 实 例 化 pkginfopath  distribute 0
扩 展 distutils
 注解 这篇 文档 只有 在 httpssetuptools
html 上的 setuptools  文 档独 立 涵 盖此 处包含 的 所有相关 信 息之前 才会单 独保留
distutils  可 以通 过 各 种 方式 扩展
大 多数 扩展都采 用新命 令 或现有命 令的替 换形 式
例 如可以 编 写 新命令 以 支持 新的特 定于平 台的包 格 式但 是可以 修改 现有 命 令的替 换 以 修 改 命令 在 包上 的操作 细 节
distutils  的 大多数 扩展都 在 想 要 修改 现有 命 令 的 setup
py  脚本 中 编写 其中 许多 只是 简单 地 在
py 文 件以 外添加了 一 些 应当被 拷贝到 包中 的文 件 后 缀 以便 使 用
大多 部 distutils  命 令 的 实现都 是 distutils
command 类的子 类
新 增 命 令可 直 接继承 自 command  而替换 命 令往 往 间接派生 自 command  直接 子类化 它们 所 替换 的命 令
所 有 命令 都 要求 自 command 派生
集 成 新的命令
 有多 种方 法可 将 新的 命令 实现集成 到 distutils 中
 最困 难的一 种是 鼓动 在 distutils 自 身内 部包含 新特性 并等待 以及要 求某 个 python 版 本提 供该 支持
 出 于 多 种 原 因 这 确 实 是 相 当 难 的
 对 于 大 多 数需 求来 说最 为常见并 且 可能 最 为合理 的一 种 则是通 过你自 己的 setup
py 脚本 来 包 含 新的 实 现然 后让 distutils
setup 函 数使 用 它 们 from  distutils
 如 果 新 的 实 现 必须 通 过特 定的 包 来 使用则 此 方式最为 适 宜因为 每个 对这个 包 感兴 趣的 人都 将 会 需要 有 新的 命令 实 现
 从 python 2
4 开 始 还 有第三 个选 项 可 用 其目 标是 允 许添 加支持 现有 setup
py 脚 本 的新命 令而不 需要 修 改 python  安装 包
 这 预 计 可允许 第三 方 扩展 提供对 附 加打 包系 统的 支持而 相应 命 令又 可用于 任 何 distutils 命 令可 被使 用 的 地方
 新 的 配 置选 项 commandpackages 命 令 行 选 项为 commandpackages  可 用 来指定 附加 包以在其 中 查 找 实 现 新增 命 令的 模块
像 所有 distutils  选 项 一 样 这可 以通 过 命令 行或 配置文件 来 指定
 此 选项只 能在 配置 文件的 global 小 节 之中 或 在命令 行的 任何 命令 之 前 设置
 如果 是设 置在 配置 文件 中 则它可 被 命 令 行 设置 重 载如果 在 命 令行中将 其 设为空 字符串 则将会 使用 默认值
 此选 项绝 不应当 在 随特 定包 提供 的 配置 文件 中设 置
这 个 新 选项 可被用 来添 加任 意数 量的包 到 查找命 令实 现的 包列 表多个 包名 应 当 以 逗 号 分 隔
当 未指 明时查 找将 只在 distutils
command  包中进行
 但 是 当 setup
py  附 带 commandpackages  distcmdsbuildcmds 选 项运 行 时 distutils
command  distcmds  和 buildcmds  包 将按 此顺 序 被查找
 新的 命令应 当 在 与命名同 名的 模块中由 同 名 的 类 来 实现
给 定 上 述示 例 命令 行选 项则 命令 bdistopenpkg  可由 类 distcmds
bdistopenpkg 或 buildcmds
bdistopenpkg  来 实现
 添 加 新的 发 布 类 型
创 建 发 布 在 dist  目 录 中 的 文 件的 命令 需 要 将 command  filename  二 元 组 添 加 到 self
distfiles  以便 upload 可 以将 其 上 传 到 pypi
二元 组 中 的 filename  不 包 含路径 信 息 而 只有 文 件 名 本 身
在 dryrun  模式 下二 元组 仍然 应当 被添 加 以 表示 必 须创建 的 内 容
分 发 python 模块 遗留 版 本
an  introduction  to  distutils
 注 解 这篇 文档 只有 在 httpssetuptools
html  上 的 setuptools  文档 独立涵 盖 此 处 包 含的 所 有 相 关信 息之 前才 会单 独保留
this  document  covers  using  the  distutils  to  distribute  your  pythonmodules  concentrating  on  the  role  of  developerdistributor  if  yourelooking  for  information  on  installing  python  modules  you  should  referto  the  安装 python  模块 旧版 chapter
概 念和 术 语
 as  adeveloper  your  responsibilities  apart  from  writing  solid  welldocumented  and  welltested  code  of  course  are 编写一 个设 置脚 本 setup
py  by  convention 可 选编 写 设置脚 本的 配置文件 create  a  source  distribution  optional  create  one  or  more  built  binary  distributions  每 个这 些 任 务 均已在 此文 档 覆 盖
一 个 简 单 的例 子
general  python  terminology
 nevertheless  just  to  be  surethat  everyone  is  operating  from  a  common  starting  point  we  offer  thefollowing  glossary  of  common  python  terms  模块 the  basic  unit  of  code  reusability  in  python  a  block  of  code  imported  by  some  other  code
扩 展模 块 a  module  written  in  the  lowlevel  language  of  the  python  implementation  cc  for  python  java  for  jython
 包 a  module  that  contains  other  modules  typically  contained  in  a  directory  in  the  filesystem  and  distinguished  from  other  directories  by  the  presence  of  a  file  init
distutilsspecific  terminology
python  包索 引 pypi
python 包索 引 pypi 存储 描述 与 distutils  和 其 他 发布 工具 一起打 包的 发 行 版 的 元数 据以 及 分发 存档本 身
供参考 的最 新 pypi 文 档可以在 阅 读 python 包用户 指南 找 到
编 写安装 脚本
注 解这 篇文 档只有 在 httpssetuptools
html 上 的 setuptools 文档独 立涵盖 此处包含 的所 有相 关信息之 前才 会 单独保留
 as  we  saw  in  section  一个 简 单 的例 子 above  the  setup  script  consists  mainly  of  a  call  to  setup  andmost  information  supplied  to  the  distutils  by  the  module  developer  issupplied  as  keyword  arguments  to  setup
command  there  are  only  two  differences  between  this  and  the  trivial  onefiledistribution  presented  in  section  一个 简单 的例子 more  metadata  andthe  specification  of  pure  python  modules  by  package  rather  than  bymodule
listing  whole  packages
listing  individual  modules
 thissimplest  case  was  shown  in  section 一 个简单 的例 子 here  is  a  slightlymore  involved  example  pymodules  mod 1 pkg
describing  extension  modules
 扩 展名 和 软件 包
extension  source  files
preprocessor  options
例 如 extension
library  options
其他选 项
relationships  between  distributions  and  packages
lets  look  at  a  bunch  of  examples  requires  expression 解释1
some  examples  provides  expression  解 释 mypkg  provide  mypkg  using  the  distribution  version  mypkg 1
installing  scripts
 scriptsscriptsxmlprocparse  scriptsxmlprocval 在3
1 版更 改 all  the  scripts  will  also  be  added  to  the  manifestfile  if  no  template  is  provided
 see  specifying  the  files  todistribute
installing  package  data
dat 在3
1版 更 改 all  the  files  that  match  packagedata  will  be  addedto  the  manifest  file  if  no  template  is  provided
 see  specifying  thefiles  to  distribute
installing  additional  files
在3
1 版更改 all  the  files  that  match  datafiles  will  be  added  tothe  manifest  file  if  no  template  is  provided
 see  specifying  thefiles  to  distribute
additional  metadata
 this  information  includes 元 数据描 述值 注释 name 包名 称 短字 符串1 version  此发 布的 版 本 短 字 符串12 author 软 件包 作者 的 姓名 短字符 串3 authoremail  软 件包 的作者的 电 子邮件地 址电子邮 件地 址3 maintainer  软件 包维护者 的 名字 短 字符 串3 maintaineremail 软 件包维护者 的 电 子邮 件地 址电子邮件地 址3 url 软 件包 的网址网 址1 description 软 件 包的简短 摘要 说 明 短字 符 串 longdescription 软 件包 的详细说 明长字 符串4 downloadurl  可 以 下载 软 件包 的网 址网址 classifiers 分 类列表 字 符串 列表67 platforms  平台清 单 字符 串列表68 keywords 关 键字列 表字 符串列表68 license  软 件包 许可 证短 字符 串5 注 释1
 classifiers  development  status 4 beta  environment  console  environment  web  environment  intended  audience  end  usersdesktop  intended  audience  developers  intended  audience  system  administrators  license  osi  approved  python  software  foundation  license  operating  system  macos  macos  x  operating  system  microsoft  windows  operating  system  posix  programming  language  python  topic  communications  email  topic  officebusiness  topic  software  development  bug  tracking  在3
7 版更改 setup  now  warns  when  classifiers  keywords  orplatforms  fields  are  not  specified  as  a  list  or  a  string
debugging  the  setup  script
creating  a  source  distribution
specifying  the  files  to  distribute
 在3
1版 更改 an  existing  generated  manifest  will  be  regeneratedwithout  sdist  comparing  its  modification  time  to  the  one  ofmanifest
在3
3版 更改 manifest  files  start  with  a  comment  indicating  theyare  generated
 files  without  this  comment  are  not  overwritten  orremoved
 在3
2 版 更改 sdist  will  read  a  manifest  file  if  nomanifest
 在3
7 版 更 改 readme
rst  is  now  included  in  the  list  of  distutilsstandard  readmes
 there  are  several  other  commands  available  in  themanifest  template  minilanguage  see  section  创 建源 码 发行 包 sdist 命 令
 include  all  python  source  files  in  the  distutils  and  distutilscommand  subdirectories  because  packages  corresponding  to  those  two  directories  were  mentioned  in  the  packages  option  in  the  setup  scriptsee  section  编 写 安 装 脚本2
manifestrelated  options
 上 传 包 到包 索 引
 供参考 的最 新 pypi 文 档 可 以在 阅 读 python  包用户指 南找 到
构 建 cc 扩展
 使用 distutils  构建 c  和 c 扩展
 扩 展 模块可 以用 distutils  来构 建这 是 python  自 带的
distutils  也 支 持 创 建 二进 制 包用户 无需 编 译 器 而 distutils  就 能安装 扩展
一 个 distutils  包包含了 一个 驱动 脚 本 setup
py 
 这是 个 纯 python 文件大 多数时 候也很简 单看起来 如 下 from  distutils
0 description  this  is  a  demo  package  extmodules  module 1通 过 文件 setup
py 和文件 demo
c  运行如 下 python  setup
py  build 这会 编译 demo
c  然 后 产生一 个扩展 模块叫 做 demo 在目录 build  里
依 赖于系 统 模块文件 会放在 某个子 目录 形如 buildlib
system  名字可 能 是 demo
so  或 demo
pyd 
 在文 件 setup
py 里 所 有动作的入 口通过 setup  函 数
该 函数 可 以接 受 可变 数量个 关 键 字参 数上 面 的例 子只 使 用了一个 子 集
特别需 要注意 的 例子指定 了构建包的 元信 息 以 及指 定了包 内容
 通常 一 个包会 包括 多个 模 块 就像 python  的 源 码 模 块、文 档、 子包等
请 参数 distutils 的 文档 在 分发 python 模 块 遗 留版 本来了 解更 多 distutils 的 特性 本 章节 只解释 构建扩 展 模块的部 分
 通 常 预计 算参数给 setup  想要更 好的 结构化 驱 动脚本
 有如如 上 例 子 函数 setup 的 extmodules 参数 是 一列扩 展模块 每 个是 一个 extension  类的 实 例
 例子中 的实 例定义 了扩 展命 名 为 demo  从 单一 源码文 件构 建 demo
c 
更多时候 构 建 一个 扩展会 复杂 的 多需 要 额外的预 处理 器定 义 和 库
如下例 子展 示了这 些
 extmodules  module 1 例子 中 函数 setup 在 调 用时额 外 传递了元 信息是 推荐发 布 包 构 建时的内 容
 对 于这个扩 展其指定了 预处理 器 定 义 include  目录 库目录 库
 依赖于编 译器 distutils  还会用其他 方 式传 递 信 息 给 编 译 器
 例 如 在 unix  上结 果是如下编 译命令 gcc  dndebug  g  o 3 wall  wstrictprototypes  fpic  dmajorversion 1 dminorversion 0 iusrlocalinclude  iusrlocalincludepython 2
so  这些 行代码 仅 用 于展 示目 的 distutils 用 户 应该 相信 distutils 能 正确 调用
 发布 你 的扩展模块
 在其它 应用程序 嵌入 python
参 见 pythonc  api 参 考 手 册 the  details  of  pythons  c  interface  are  given  in  this  manual
very  high  level  embedding
beyond  very  high  level  embedding  an  overview
转换 python  的数据值 到 c 2
 转换 c  的 数据 值 到 python 2
 纯 嵌入
 if  you  compile  and  link  this  programlets  call  the  finished  executable  call  and  use  it  to  execute  apython  script  such  as  def  multiplyab  printwill  compute  a  times  b  c 0 for  i  in  range 0 a  c  c  b  return  c 然后 结果 应 该是 call  multiply  multiply 32 will  compute 3 times 2 result  of  call 6 although  the  program  is  quite  large  for  its  functionality  most  of  thecode  is  for  data  conversion  between  python  and  c  and  for  errorreporting
extending  embedded  python
 在 c  中 嵌 入 python
 在 类 unix 系 统中编译 和链 接
4 m  xlinker  exportdynamic  注 解 to  avoid  confusion  between  several  python  installations  and  especially  between  the  system  python  and  your  own  compiled  python  it  is  recommended  that  you  use  the  absolute  path  to  pythonx
使 用 c  或 c 扩 展 python
一 个 简单的例 子
让我 们创 建一个 扩 展模 块 spam  monty  python  粉 丝 最喜 欢 的 食 物
并 且想 要创 建 对应 c  库 函 数 system 1的 python 接 口
这 个函 数 接受一 个以 null  结尾 的字 符 串 参 数 并 返 回 一个 整数
我 们 希望 可以 在 python  中 以如 下 方 式调用 此 函 数 import  spam  status  spam
systemls  l  首先创 建 一个 spammodule
c  文件
传 统上如 果一 个模块 叫 spam  则 对 应 实 现 它 的 c  文件 叫 spammodule
c  如 果 这 个 模 块名 字 非常 长比 如 spammify 则这 个 模块 的文件 可以 直 接 叫 spammify
 文 件 中 开 始 的 两 行 是 define  pyssizetclean  include  python
h 这 会 导 入 python  api  如 果 你 喜欢 你可 以在这 里添 加 描 述 模 块 目 标 和 版 权 信 息 的 注 释
 注 解 由 于 python  可 能会 定义一 些影响某些 系 统上 标 准 头文 件的 预处理 器 定 义 因 此 在 包含 任 何标 准头 文件之 前 您必须 include  这个文 件 python
h
推 荐 总 是在 python
h 前 定 义 pyssizetclean 
查 看 提取 扩 展 函 数 的参 数来了 解这个 宏的 更多内 容
 所 有 在 python
h  中定义的用 户可见 的符号都 具 有 py 或 py 前 缀已 在 标 准 头 文件 中 定义的 那些 除外
 考 虑到 便 利 性 也 由 于其 在 python 解 释器 中被 广 泛使 用 python
h 还包 含了一 些标准 头 文 件 stdio
hstring
herrno
h  和 stdlib
 如果 后面 的头 文件在 你的系 统上 不存 在它还 会直 接声 明函数 mallocfree  和 realloc
下 面 要 做 的 事 是将 c 函 数添加 到我 们的 扩 展模 块 当 python 表达式 spam
systemstring  被求值 时函 数将被调 用我 们很 快就 会看到 它 最终 是如何 被调用的 static  pyobject  spamsystempyobject  self  pyobject  args  const  char  command  int  sts  if  pyargparsetupleargs  s  command  return  null  sts  systemcommand  return  pylongfromlongsts  有个直接 翻 译参 数 列表 的 方 法例如 单独 的 lsl 到 要 传递 给 c 函 数的 参数
c  函数 总是有两 个 参数 通常 名字 是 self 和 args 
 对模块级 函数 self  参数 指向 模块对象对 于对象 实例 则指 向方 法
args 参 数 是指向 一个 python  的 tuple 对 象的 指针 其中包 含参 数
每 个 tuple  项对应一 个调用 参数
这 些参 数 也全 都是 python  对象 要在 我 们的 c 函 数中 使用 它们 就需 要 先将 其 转换 为 c  值
 python  api 中 的函 数 pyargparsetuple  会 检查 参 数类 型并 将其 转 换 为 c 值
 它使用 模板字 符 串确定需 要的参 数 类 型 以及存储被 转换 的值 的 c 变 量 类 型
细节将 稍后 说明
pyargparsetuple  在所 有 参数都 有正 确类 型且组成部 分按 顺序 放在 传递 进来 的 地址里 时返 回 真 非 零
其 在 传入 无 效参数 时返回 假 零
在后续 例子里 还 会 抛 出 特定 异 常使 得 调 用 的函 数可 以理 解 返 回 null 也 就是例子 里所 见
关于 错误和 异 常
回到例 子
回到 前 面 的 例子你 应该 明白下面的 代 码 if  pyargparsetupleargs  s  command  return  null 如 果 在参 数 列表 中检测到 错误 它将返 回 null  该值 是返回 对象指针 的函 数所使 用的 错 误提 示这 取决 于 pyargparsetuple 设置 的 异 常
 在其 他情 况下 参 数 的字 符串 值会被 拷 贝到 局部变 量 command
这是 一 个 指 针赋值并 且你 不应该 修改 它 所指 向的字 符串 因 此在 标 准 c 中 变量 command  应当 被正确 地声 明 为 const  char  command
下一个语 句使 用 unix 系统 函数 system  传递给 他的 参数 是刚才从 pyargparsetuple  取出 的 sts  systemcommand  我们 的 spam
system  函数 必须返 回 sts  的值作 为 python 对 象
这 通过使用函 数 pylongfromlong  来实 现
 return  pylongfromlongsts  在 这种情 况下会返回 一 个整数对 象 这个 对象 会在 python 堆 里面管理
如 果你 的 c 函 数没有 有 用的 返回值返 回 void  的函 数则 必须返回 none
 你 可以 用 pyretunnone  宏来 完成 pyincrefpynone  return  pynonepynone 是特殊 python  对 象 none 所 对应的 c  名 称
它 是一 个真正 的 python 对象而 不 是 null  指针 如 我们 所 见后 者 在 大多 数上 下文中 都意味着 错误
 模块 方法 表 和初始 化函 数
编译 和 链接
在 你能 使 用你 的新 写的扩 展 之 前你还 需要做两 件 事情使 用 python 系 统来 编译 和 链 接
 如果你 使 用 动态加 载这 取决 于 你 使 用 的 操 作系统的 动态 加 载机 制 更 多信 息 请 参考 编译 扩 展 模 块 的章 节 构 建 cc 扩 展 章节 以及 在 windows  上编 译需要 的额 外信 息在 windows  上构建 c 和 c  扩展 章 节
如 果你 不使用 动 态 加载 或者 想要 让模块永 久性 的作 为 python 解 释器 的 一 部 分 就必 须 修改 配 置设置 并重 新 构 建 解 释器
 幸 运的 是 在 unix 上很 简 单 只需 要 把你的 文 件 spammodule
c 为 例放 在 解压 缩 源 码 发行 包 的 modules  目 录 下添 加 一 行 到 modulessetup
local  来 描 述你 的文件 spam  spammodule
o  然后在 顶 层目录 运 行 make  来 重新 构建 解 释 器
你也 可以在 modules  子 目 录 使 用 make  但 是 你 必 须先重建 makefile  文 件 然 后运行 make  makefile 命 令
 你每 次修改 setup  文件 都需要 这 样 操作
 如果你 的模 块 需 要额 外的链 接这 些内容可 以列 出在 配置 文件 里 举个实例 spam  spammodule
 在 c 中 调用 python  函数
提 取扩 展函 数的 参数
函数 pyargparsetuple  的声 明如 下 int  pyargparsetuplepyobject  arg  const  char  format 
参 数 arg 必 须是一 个元 组对 象 包含 从 python 传 递给 c  函数 的参 数 列表
format  参 数必须是一 个 格式字 符串语 法请参考 python  capi  手册 中的 语 句解 释及 变 量 编译
剩余 参数 是 各 个 变量 的地 址 类 型 要与格 式字符 串对应
注 意 pyargparsetuple  会检测他 需 要 的 python  参数类 型却 无法检 测 传递给 他的 c  变量地 址 如果 这里 出错了 可能 会 在 内存 中 随 机写 入 东 西小 心
注 意任何 由 调 用者提供的 python  对 象引 用是借 来 的 引用 不要 递 减 它们 的 引 用计 数一 些 调 用 的 例子 define  pyssizetclean  make  s  use  pyssizet  rather  than  int
 给扩展 函 数的 关键 字参数
函 数 pyargparsetupleandkeywords 声明如 下 int  pyargparsetupleandkeywordspyobject  arg  pyobject  kwdict  const  char  format  char  kwlist 
arg 与 format 形 参 与 pyargparsetuple  函 数 所定 义的一 致
kwdict  形参 是作为第 三 个参数 从 python  运 行 时接 收的 关 键字 字 典
kwlist 形 参是以 null  结 尾的 字符串 列表 它被 用来 标 识 形参 名 称从 左至 右 与来自 format  的 类型 信息 相 匹配
如 果执 行成功 pyargparsetupleandkeywords  会返回 真 值否则返 回 假 值并引 发一 个 适 当 的 异常
 注解嵌套 的元 组在 使 用关键 字 参 数时无 法生 效不 在 kwlist  中的 关 键字 参数 会 导致 typeerror 异常
 如 下是 使用 关 键字参数 的 例子 模块 作者 是 geoff  philbrickphibrickhks
构 造 任意 值
引 用 计 数
python  中 的 引 用计 数
拥有规 则
危 险的 薄 冰
null 指针
 通 常 接受对 象引 用作为参 数的函 数 不 希望你 传 给它 们 null  指针 并 且 当 你这样 做 时 将 会 转 储 核 心 或 在 以 后导 致 核心转 储
 返 回 对 象 引 用 的函 数通 常 只 在要指明 发生了 异常 时才 返 回 null
 不 检 测 null  参 数的 原 因 在于这 些函数 经常要 将 它 们所 接收 的 对 象 传 给其 他函 数 如果每个 函数都 检测 null  将 会 导致 大量的冗 余检 测而 使代 码运行 得更 缓 慢
更好 的做 法 是 仅在 源头 上 检测 null  即 在 接 收到 一个 可 能 为 null  的指针 例如 来自 malloc  或 是 一 个可 能引 发异 常的 函数 的时 候
pyincref 和 pydecref  等宏不 会检 测 null 指针但 是 它 们的 变种 pyxincref  和 pyxdecref  则 会检 测
用 于检测 特 定对 象 类型 的 宏 pytypecheck  不 会检 测 null 指 针同 样地有 大量代 码会 连 续调 用这些宏 来测 试一个对 象是 否为 几种 不同预 期 类型 之一 这将 会 生 成冗 余的 测试
 不存 在带 有 null 检 测 的变 体
c  函 数 调 用 机制 会保证 传给 c 函 数的 参数 列表本示 例中 为 args  绝不 会为 null  实际 上它 会 保 证其 总是 为 一 个 元 组4
任 何时 候 将 null 指 针 泄 露 给 python 用户 都 会是个 严 重的错 误
在 c  中编写 扩展
 给扩 展模 块 提 供 c  api
扩展和 嵌入 python  解释 器
 本文 档描 述 了 如 何 使用 c  或 c 编写 模块 以使 用新 模块来 扩展 python  解释 器 的 功 能
 这些 模块 不仅 可以 定 义新 的 函数还 可以 定义新 的对 象类 型及其 方法
该 文档还描 述了如 何将 python 解释 器 嵌 入到 另 一个应用 程序 中 以用 作扩展 语言
 最后 它 展示了如 何 编译 和链 接扩 展模 块以便 它们 可以 动态 地在运 行 时加 载到解 释 器中 如 果底 层 操作系 统 支持此 特 性 的 话
本文档 假设 你具 备有 关 python  的基本 知识
有关 该语 言的 非正 式 介绍请参 阅 python 教程
 python  语 言参 考 给 出了更 正式 的 语 言定义
 python  标准 库包 含现有 的对 象 类型、 函数和 模 块内置 和用 python  编写 的文 档 使 语言具 有广泛 的应用 范围
 关于整 个 pythonc  api 的详 细 介 绍请参阅 独立 的 pythonc  api 参考手册
 推荐 的第 三 方工具
 本 指南仅 介 绍了 作为此 cpython 版 本的一 部 分 提供的 创建扩展的 基 本 工 具
第 三方工 具如 cython 、 cffi 、 swig  和 numba 提 供了 更简单 和 更 复 杂的方法来 为 python 创 建 c 和 c  扩 展
参见 python  packaging  user  guide  binary  extensions  python  packaging  user  guide 不 仅 涵盖了几个 简 化二 进制扩 展创 建的 可 用工 具还讨论 了为 什么 首先创 建 扩展模块 的各种 原 因
 不使 用第 三 方工具 创建 扩展
 本指南的 这一 部分包 括在 没有 第 三方 工具 帮 助的 情况 下 创建 c  和 c 扩展
 它主要用 于这些工 具 的创 建者 而不 是建 议 你创 建自己 的 c  扩 展 的方 法
使 用 c  或 c  扩 展 python 1
一 个简单 的例 子1
关 于错 误和 异常1
 回到 例子1
 模 块方 法 表和初 始 化 函数1
 编 译和 链接1
 在 c  中调 用 python 函 数1
提 取扩 展 函数的 参数1
 给扩展 函数 的关 键字参数1
构 造任 意值1
引用 计数1
在 c 中编 写扩展1
 给扩 展模 块提 供 c  api 2
自定 义扩 展 类 型 教程2
基 础2
定义 扩展 类 型 已 分 类 主题3
 终结 和内 存 释放3
 对象 展示3
属 性管 理3
更多 建议4
 构建 cc  扩 展4
使 用 distutils  构建 c  和 c  扩 展4
发 布你的扩展 模块5
 在 windows 上构建 c  和 c  扩展5
菜 谱式 说明5
 unix 和 windows  之间 的 差异5
 dll  的实际 使用
在 更 大 的应 用程 序中 嵌入 cpython  运行 时
有 时不 是要创建 在 python  解释 器 中作 为主 应 用程序运 行的 扩展 而 是希 望 将 cpython 运 行时 嵌 入 到 更 大 的 应用 程序中
 本节介 绍了 成功 完成 此 操作所 涉及的 一些 细 节
 在其 它应 用 程序 嵌 入 python 1
纯 嵌入1
在 c 中 嵌 入 python 1
在 类 unix 系 统中 编译 和链 接
 定义 扩 展类型已 分类 主题
 终 结 和内 存释 放
destructor  tpdealloc 当 您的 类 型实 例 的引 用计 数 减 少 为 零并 且 python  解 释 器 想 要回 收它 时将 调用 此 函 数
 如 果 你 的 类 型有 内存 可供 释放 或 执 行 其他 清理 你可以 把它 放在 这 里
对象本 身 也需 要在 这里 释 放
 以下 是此 函数 的示 例 static  void  newdatatypedeallocnewdatatypeobject  obj  freeobjobjunderlyingdatatypeptr  pytypeobjtpfreeobj 一 个重要 的 释放 器 函数 实 现 要求 是 把 所 有未 决异 常放 着不 动
 这 很重 要 是因 为释 放器会 被解释器 频繁 的调 用当栈异 常退 出时而 非 正常 返 回 不会 有 任何办 法保 护 释放器看 到一个 异 常 尚未 被设 置
 此事释 放器 的 任 何行 为 都 会导致额 外 增加 的 python 代 码来 检查 异 常 是 否被 设置
这 可 能导致 解释 器的 误导 性 错 误
正确 的保护 方 法是 在任 何不 安全 的 操作 前保存 未 决异 常 然后 在 其完成后 恢复
者 可 以通过 pyerrfetch 和 pyerrrestore  函 数 来实现 static  void  mydeallocpyobject  obj  myobject  self  myobject  obj  pyobject  cbresult  if  selfmycallback  null  pyobject  errtype  errvalue  errtraceback  this  saves  the  current  exception  state  pyerrfetcherrtype  errvalue  errtraceback  cbresult  pyobjectcallnoargsselfmycallback  if  cbresult  null  pyerrwriteunraisableselfmycallback  else  pydecrefcbresult  this  restores  the  saved  exception  state  pyerrrestoreerrtype  errvalue  errtraceback  pydecrefselfmycallback  pytypeobjtpfreepyobjectself  注 解 there  are  limitations  to  what  you  can  safely  do  in  a  deallocator  function
从 python 3
4开始 推荐 不要在 tpdealloc  放 复 杂的终 结代码而是 使 用 新 的 tpfinalize  类型方 法
参 见 pep 442解 释了 新的终 结方案
 对象展示
在 python  中有 两种 方 式可以生 成 对 象 的文 本 表 示 repr  函数 和 str 函 数
 print 函 数 会直 接调用 str
这 些处 理程 序都是 可 选的
 reprfunc  tprepr  reprfunc  tpstrtprepr 处理 程 序应 该返回 一个 字符 串对 象 其 中 包 含调 用它的 实例的 表示形 式
 下面是一 个简 单 的例子 static  pyobject  newdatatypereprnewdatatypeobject  obj  return  pyunicodefromformatreprifiednewdatatypesized  objobjunderlyingdatatypeptrsize  如果 没有 指定 tprepr  处理 程 序解 释器 将提 供 一 个使 用 tpname  的 表 示形 式以及对 象 的 惟 一 标识值
下 面 是一 个简 单 的例 子 static  pyobject  newdatatypestrnewdatatypeobject  obj  return  pyunicodefromformatstringifiednewdatatypesized  objobjunderlyingdatatypeptrsize 
属 性管理
 泛型 属性 管理
typespecific  attribute  management
 例 如 static  pyobject  newdatatypegetattrnewdatatypeobject  obj  char  name  if  strcmpname  data 0 return  pylongfromlongobjdata  pyerrformatpyexcattributeerror 
object  comparison
abstract  protocol  support
python  supports  a  variety  of  abstract  protocols  the  specificinterfaces  provided  to  use  these  interfaces  are  documented  in 抽 象 对 象层
weak  reference  support
 参见 documentation  for  the  weakref  module
 更多 建议
 asample  of  its  use  might  be  something  like  the  following  if  pyobjecttypechecksomeobject  mytype  pyerrsetstringpyexctypeerror  arg 1 not  a  mything  return  null  参见 下载 cpython  源代 码 版本
orgdownloadssource  github  上 开 发 cpython  源代 码的 cpython 项 目
自定 义 扩展 类型 教程
python  允 许 编写 c 扩 展模 块定 义可 以从 python 代码 中操纵 的 新类 型这很 像内置的 str 和 list 类 型
所有 扩展类型 的代 码都遵循一 个 模式 但是在您 开 始 之前 您 需要 了解 一些细 节
这 份文件 是对 这个主 题介 绍
基础
adding  data  and  methods  to  the  basic  example
 注解 the  explicit  cast  to  destructor  above  is  needed  because  we  defined  customdealloc  to  take  a  customobject  argument  but  the  tpdealloc  function  pointer  expects  to  receive  a  pyobject  argument
 注 解 tpnew  shouldnt  call  tpinit  explicitly  as  the  interpreter  will  do  it  itself
 注解 we  didnt  fill  the  tpalloc  slot  ourselves
 注解 if  you  are  creating  a  cooperative  tpnew  one  that  calls  a  base  types  tpnew  or  new  you  must  not  try  to  determine  what  method  to  call  using  method  resolution  order  at  runtime
 see  the 泛 型属 性管 理 section  below  fordetails
providing  finer  control  over  data  attributes
supporting  cyclic  garbage  collection
 with  pyvisit  we  can  minimize  the  amount  ofboilerplate  in  customtraverse  static  int  customtraversecustomobject  self  visitproc  visit  void  arg  pyvisitselffirst  pyvisitselflast  return 0注解 the  tptraverse  implementation  must  name  its  arguments  exactly  visit  and  arg  in  order  to  use  pyvisit
 注解 you  could  emulate  pyclear  by  writing  pyobject  tmp  tmp  selffirst  selffirst  null  pyxdecreftmp  nevertheless  it  is  much  easier  and  less  errorprone  to  always  use  pyclear  when  deleting  an  attribute
subclassing  other  types
 脚注1 this  is  true  when  we  know  that  the  object  is  a  basic  type  like  a  string  or  a  float
 在 windows 上 构 建 c 和 c  扩展
 这一章简 要介 绍 了如 何 使用 microsoft  visual  c 创 建 python 的 windows  扩 展模 块然 后 再 提供 有关 其工作 机 理的详细 背 景 信息
 这些 说明材 料同 时 适用 于 windows 程 序员 学习 构建 python  扩展以及 unix 程 序员 学习 如何 生成 在 unix  和 windows  上 均能 成 功构 建的 软 件
 鼓励模 块作 者 使 用 distutils 方式 来构 建扩 展模 块而不 使用本 节 所描述的方式
 你 仍将 需要 使用 c  编译器来 构 建 python 通 常 为 microsoft  visual  c
注 解这 一章 提及 了 多个 包括已 编码 python  版本 号的 文 件名
 这 些 文件 名 以 显 示为 xy  的 版 本号来 代表在 实 践 中 x 将 为你 所使 用的 python 发 布版 的 主版 本 号 而 y 将 为次 版 本号
例 如 如果你所 使用的 是 python 2
1 xy 将 为22
菜 谱式 说明
 在 windows 和 unix 上 构 建扩展模块都 有两 种方式 使用 distutils 包来控 制构 建 过程 或者 全手 动 操 作
 distutils 方式 适用于 大 多数扩 展使用 distutils  构建和打 包扩 展模块 的文 档 见 分 发 python 模 块遗留版 本
如 果你 发现 你确实 需 要手动 操作那 么研 究 一 下 winsound 标 准 库模 块 的项 目 文 件可能会很 有帮 助
unix 和 windows  之间 的差异
unix 和 windows  对 于代码 的 运行时 加载 使 用 了 完全 不同的 范式
 在你 尝 试 构 建可动 态 加 载 的 模 块之 前要 先了 解你所 用系 统 是如 何工 作 的
在 unix  中一个共 享对 象
so 文 件中 包含将 由程 序来使 用的 代 码也 包 含 在程 序中可被找 到的 函数 名 称 和 数 据
 当 文 件 被 合并 到程 序中 时对 在 文件代 码 中这些函数 和数 据的 全部引 用都 会被 改为 指向程 序中 函数 和数据 在内 存中 所 放置的实 际位 置
这 基本 上 是 一个 链接 操 作
在 windows  中一 个 动态 链接库
dll  文件中没有 悬挂 的引用
 而是 通过 一个查 找表执行对 函数或数 据的访问
 因 此 在运 行时 dll 代码不 必 在运 行 时 进行修改 相反 地代码已经 使 用了 dll  的查找表 并 且 在 运 行时 查找表 会被 修改 以 指 向 特定 的函数和 数据
在 unix  中 只存 在 一 种库文件
a 它包 含来 自多 个对象 文 件
o 的 代码
在 创 建 共 享对 象文 件
so 的 链接阶 段链接器可 能 会发 现它不 知道某 个 标 识符 是 在哪里 定义的
 链接 器将 在各个 库 的 对象 文件中 查找它如 果找 到了 它链接器 将 会包括来自 该对象 文件的所 有代 码
在 windows  中存在两种 库类 型静态 库和 导入 库 扩展 名都 是
静态 库类似于 unix 的
a  文 件它包 含在 必 要时可被包 括的代 码
导 入 库基本 上仅 用于让链 接器能 确保 特定 标识符 是合 法 的并 且 将在 dll  被加 载时 出现 于程序 中
这样 链接 器可 使 用 来 自 导 入 库 的信 息构 建查找 表 以便 使用 未 包 括在 dll  中的 标识符
当 一 个应用 程序或 dll 被 链接时 可 能会 生 成 一个导入 库它 将 需要 被用 于应 用程序 或 dll  中 未来 所 有 依赖 于这些 符号 的 dll
假设 你正 在编 译两个动 态加 载 模 块 b 和 c 它们 应 当 共 享另 一个代 码 块 a
在 unix  上 你 不应 将 a
a 传给 链接 器作 为 b
so  和 c
so 那 会导致 它 被 包 括两次 这样 b 和 c  将 分别拥 有它 们 自己 的副 本
在 windows 上 编译 a
dll  将同时 编译 a
 你 应 当 将 a
lib  传给链 接器 用于 b  和 c
 a
lib  并 不包 含代码它 只 包含将在运 行时 被 用于 访问 a 的 代码 的信 息
在 windows  上使 用 导入 库 有点 像 是使 用 import  spam  它让你 可以访问 spam  中的名 称但 并不会创建 一个单独副 本
 在 unix 上链 接到 一 个 库更 像是 from  spam  import  它 会创建 一个 单独副本
dll  的 实 际 使用
windows  版 python  是 用 microsoft  visual  c  编译 的 使 用 其 他编 译 器可 能 行 也 可 能不行 但 borland  看 来是 可 以 的
这 一节 的剩 余 部分只 适 用于 msvc
当在 windows 中 创 建 dll 时 你 必 须将 pythonxy
lib  传给 链接器
 要编 译 两个 dllspam 和 ni  会使 用 spam  中找 到的 c  函数你 应 当使 用以 下 命令 cl  ld  ipythoninclude  spam
lib  第一条 命令创 建了三 个文 件 spam
dll 和 spam
spam
dll  不包 含任 何 python 函 数 例 如 pyargparsetuple 但 它通 过 pythonxy
lib  可 以知 道 如何找 到 所 需的 python 代 码
第二 条 命 令创 建了 ni
dll 以及
obj  和
lib  它知道 如何 从 spam 以 及 python  可执 行文 件 中 找到 所 需的 函数
 不 是 每 个 标 识 符 都 会 被 导 出到 查 找表
如 果你想要 任 何其 他 模 块包括 python  都能 看到 你的标 识符你 必须 写上 declspecdllexport  就如在 voiddeclspecdllexport  initspamvoid  或 pyobject  declspecdllexportnigetspamdatavoid  中一 样
developer  studio 将 加 入 大 量你并 不真 正 需 要的 导入 库使 你 的可执行 文件大 小增 加100 k
要摆 脱它 们请 使用项 目设 置 对 话框 的链 接选项 卡指 定忽 略默 认 库
将 正确的 msvcrtxx
lib  添 加到库 列表中
设 计 和历史 常见问 题
为 什 么 python  使用缩 进来 分 组语 句？
guido  van  rossum 认为 使用 缩 进进行 分组非常 优雅并 且大 大 提高 了普 通 python 程序的 清晰 度
 大多数 人 在一段 时 间 后 就 学会 并喜欢 上这 个功能
 由于没有 开始结 束括 号 因此 解析 器感知的 分组与 人类 读 者 之 间 不会存在分 歧
 偶尔 c 程序 员 会遇 到像 这样的 代码片 段 if  x  y  x  y  z 如 果条件 为真 则只 执 行 x  语句但 缩进会使你 认 为情况 并非如此
即使 是 经验 丰 富的 c  程序 员 有时 也 会长 久地盯 着 它发 呆 不明 白为 什么在 x  y  时 y 也 会减少
 因 为 没 有 开始结 束花 括号所以 python 更 不 容 易发生编码风 格 冲突
 在 c 中 有 许 多 不同的放 置花 括号 的方式
 在 习 惯了阅读 和编 写某种 特定 风格 的代码 之后 当阅 读或被 要 求 编写 另一 种 风 格的 代码 时通 常都会令 人感 觉 有 点 不 舒服
 许多编 码 风格将 开始 结束 括 号 单独放 在一 行上
 这使得 程 序 相 当 长浪 费了宝 贵的屏幕 空间 使得 更 难 以 对程 序进 行 全面 的 了 解
 理 想情 况下 函数 应该 适合一个 屏幕 例 如2030 行
20 行 python  可以 完成 比20行 c 更 多 的 工作
 这 不仅 仅是 由于缺少 开始 结 束 括号 缺 少 声明 和高 级数据 类 型 也 是 其 中的原因但 缩进 基于语法 肯定 有 帮助
 为什 么简 单 的算 术运算 得 到奇 怪的结果？
请 看下 一个问题
 为 什么 浮点 计算 不 准确？
 用户经 常 对 这 样的 结果感到惊 讶1
19999999999999996并 且认为这 是 python  中的一 个 bug
 其实 不是这 样
这与 python  关系不 大 而与 底层平台如 何处 理 浮点数字 关 系更 大
cpython  中的 float  类 型使 用 c 语 言的 double 类 型进 行存 储
 float  对象 的值 是以 固定 的 精度 通 常 为53位 存储的 二 进制浮 点数 由 于 python 使 用 c  操 作 而 后者 依赖 于处理器中 的硬件实 现来 执 行 浮点 运算
这意 味着就 浮点 运 算而 言 python  的行为 类似 于 许 多流 行 的语 言包 括 c  和 java
许 多可 以轻 松 地用 十进制 表 示 的 数 字 不能 用二 进 制浮 点 表示
 例如 在输 入以下语 句后 x 1
2 为 x 存 储的值是 与十 进 制的值1
2 非常接 近的 近似 值 但 不 完 全 等 于它
 在 典 型的 机器 上实 际存储的 值 是1
0011001100110011001100110011001100110011001100110011 binary  它对应 于十 进 制 数值1
1999999999999999555910790149937383830547332763671875 decimal  典 型 的53位 精 度为 python  浮 点数 提 供 了1516 位 小 数的 精度
要 获得 更完 整的 解释请参 阅 python  教 程中的 浮点 算 术 一 章
 为 什 么 python 字 符 串 是 不 可变 的？
 有几 个 优 点
一 个是性 能知 道 字符 串 是 不可 变的 意味 着我们 可以 在创建时 为它 分配 空 间并 且存 储 需求 是固 定 不 变 的
 这 也 是元 组和 列表 之间 区别 的原 因之 一
另 一 个 优 点是 python  中 的字 符 串 被 视 为 与 数 字一 样基 本
 任 何动 作都 不 会将 值8 更 改为 其 他值在 python  中任 何动 作都 不会 将字 符 串8更 改为其 他值
 为什 么 必须 在 方 法定 义和 调 用中 显 式使用 self ？
这 个想 法借鉴 了 modula 3语 言
 出于 多 种 原因它 被证明 是 非常 有 用的
首先更明 显的 显 示出 使用 的 是方 法 或实 例 属 性而不 是局部 变 量
阅读 self
x  或 self
meth  可以清楚 地表 明 即使 您不 知道 类的 定义 也 会使用实例 变量 或方 法
 在 c 中 可 以 通过缺 少 局 部变量 声明 来判 断假 设全 局 变 量 很少见 或容易识 别——但 是在 python  中 没有 局部变 量声 明 所 以 必须 查找 类定义 才能 确 定
一 些 c 和 java 编 码标准 要 求实 例属性 具有 m  前缀 因此这 种 显式性 在这些语 言中 仍然 有用
其 次这意 味着如 果要 显 式引 用或从 特定类 调用 该方法不 需要 特殊 语法
 在 c 中如果 你 想使 用在派 生类中重 写基类 中 的方法 你必 须 使 用运 算 符在 python  中你 可以编写 baseclass
methodnameself  argumentlist
这 对于 init 方法 非常有 用 特别 是 在派 生类方 法想 要 扩展 同 名的 基类 方 法而 必须 以 某种 方式 调用基类 方 法时
最后 它解 决了 变量 赋 值 的 语法问 题为 了 python 中 的局 部变 量根据定 义在 函 数体中 赋值 的那 些变 量并 且 没有明 确声明为 全 局赋 值 就 必须以 某种 方式 告诉解释 器一 个赋值是为 了 分 配 一 个 实例 变量 而不 是一个 局部 变量 它 最 好 是通过 语法 实 现的 出于 效率 原因
 c 通过 声 明来做 到 这一点但 是 python  没 有 声 明仅 仅为 了这 个 目的 而引 入它们 会 很可 惜
使 用显 式 的 self
var  很好 地解 决了这 个问 题
类 似地 对于 使用 实例变 量 必 须编写 self
var  意 味 着对方 法内 部 的非 限定名 称的 引 用 不 必 搜索 实 例 的 目 录
 换 句话 说局部变量 和 实例变量 存 在 于 两 个不 同的命 名空间 中您 需要告 诉 python 使 用 哪个命名空 间
为什 么不能 在表达式中赋 值？
自 python 3
8 开始 你能做 到的赋值 表 达式使 用 海 象运算符在 表 达式中 为 变量 赋 值 while  chunk  fp
read 200 printchunk  请 参阅 pep 572了解 详情
 为什 么 python 对某 些 功 能例如 listindex 使 用 方 法 来实现 而其 他功 能例如 lenlist  使用 函数 实现？
正 如 guido 所说 a 对 于某 些操作前 缀 表示法比 后 缀更 容易阅读 前缀 和中缀运 算在 数 学中 有着 悠久 的 传统就像 在视觉 上帮 助数 学家 思考问 题的记 法
比 较一 下我们将 xab  这样的公式 改写 为 xaxb  的容易程度 以 及使用 原 始 oo 符 号做 相 同事 情 的 笨拙 程度
 b  当读 到写有 lenx 的代码 时就 知 道 它要求的 是某 件 东西 的 长 度
 这 告诉 我 们两件 事结 果 是一 个 整数参数 是某种容 器
 相反 当阅 读 x
len  时 必 须 已经知道 x 是 某 种 实现 接 口 的 容器或 者是从具 有标准 len 的 类 继承的容器
 当 没有实现映 射的 类有 get 或 key  方法 或 者不 是文件的 类有 write  方法时 我们偶 尔会 感 到 困惑
为 什么 join  是一个字符 串方法 而不 是列 表或元组 方 法？
 从 python 1
6开 始字 符串变得 更像 其他标 准 类型 当 添加方 法时 这些 方法 提供的功能 与始终 使用 string  模块 的函数 时提供 的 功 能 相同
这 些 新 方 法中 的大 多数已 被 广泛 接 受但 似乎让一 些程 序员 感到不 舒 服的 一种 方 法是
join 124816 结果 如下124816 反对 这种用法 有两 个 常 见的 论点
 第一 条是这 样 的使 用 字 符 串 文 本 string  constant  的方 法看起 来真的 很难看答 案是 也许 吧但是 字符串 文本 只是 一个固 定 值
如 果 在绑 定到字 符串的 名 称上允许 使用 这 些方 法 则没 有逻 辑 上的 理 由使 其 在文 字上 不 可用
 第 二个异 议通 常 是这 样 的我实际 上是在 告诉 序列使用 字符串常 量 将其 成 员 连 接在一 起
遗憾的 是并非如此
 出于某 种原 因把 split 作 为一 个字 符串 方法似 乎 要容 易 得 多 因为 在 这 种 情 况 下 很容易 看到124816
split  是对字 符串文 本的指令 用于 返 回 由 给 定分隔 符分隔的 子字符 串或 在 默认情况 下 返回 任 意空格
join  是字 符 串 方法因 为在 使用该 方法时您告 诉分 隔 符字 符 串 去迭 代一 个字 符 串 序列并在相 邻元 素 之 间插 入 自 身
此方 法的 参 数可 以 是 任何 遵循序 列规 则 的 对 象包 括您自己定 义的 任何 新 的类
 对于 字节和字 节 数 组对象 也有 类似的 方法
 异 常有多 快？
如果 没 有引发 异常 则 tryexcept 块的 效率 极高
实 际上捕 获异常 是 昂 贵的
在2
0之 前的 python  版 本中 通 常使用 这个 习惯用 法 try  value  mydictkey  except  keyerror  mydictkey  getvaluekey  value  mydictkey  只 有当你 期望 dict  在 任何 时 候 都 有 key  时这才 有意 义
 如果 不是 这样 的话 你 就 是应 该 这样 编 码 if  key  in  mydict  value  mydictkey  else  value  mydictkey  getvaluekey 对于 这种 特 定的 情况 您还 可以 使用 value  dict
setdefaultkeygetvaluekey  但前 提是调 用 getvalue 足够 便宜因 为在 所有情况 下 都会对其 进行 评 估
为 什 么 python 中没 有 switch  或 case 语句？
 难道不能 在 解释 器中模 拟线程而非 得 依 赖 特定于 操作 系 统的线 程实现 吗？
 答案1 不幸的 是 解释 器为 每个 python  堆 栈 帧推 送 至 少一 个 c 堆 栈 帧
此 外 扩 展 可以 随时 回调 python
 因此 一个完 整 的线程 实现需 要对 c  的线 程支 持
 答案2 幸运的是 stackless  python  有一个完全 重新 设 计的解 释器 循环 可 以 避免 c  堆栈
 为 什 么 lambda 表达 式不 能 包 含语句？
python  的 lambda 表达式 不能 包含 语 句 因 为 python 的 语 法 框 架不 能处理 嵌套 在 表 达 式 内部的 语句
然 而在 python  中这 并 不是一 个严 重的 问题
 与 其 他 语 言中 添加 功能的 lambda  表单 不同 python 的 lambdas 只 是一种速 记符号 如 果您懒 得 定 义函 数的话
 函数已经是 python  中的 第一类对象可 以在本地 范 围内声明
因 此 使 用 lambda  而 不是本地 定义的 函数 的唯 一优 点 是你 不 需要为 函数 创 建一 个名 称这 只是 一个 分配 了函 数对象 与 lambda 表 达 式生 成 的对象类 型 完 全 相 同的 局部 变 量
 可以 将 python 编 译为 机 器 代码 c 或其 他 语言吗？
cython 将带有 可选 注释 的 python 修 改 版 本 编 译 到 c  扩展中
 nuitka  是 一 个 将 python  编译 成 c 代码的 新 兴编译器 旨在 支持 完整的 python  语 言
 要编译 成 java  可 以考虑 voc 
python  如 何 管 理 内存？
python  内存管理 的细 节取 决 于实 现
 python 的标准 实现 cpython  使用引用计 数 来 检 测不可 访问 的 对 象 并使 用另 一种 机制来 收集 引用循 环定 期 执行循 环检测 算 法 来 查找 不 可访问 的循 环并 删 除所 涉及 的 对 象
 gc  模 块提 供 了执 行 垃圾回 收、获 取调 试 统计 信 息和优化 收集器 参 数 的 函数
 但 是其他实 现如 jython  或 pypy  可以 依赖 不同的 机 制 如 完全的 垃圾 回收器 
 如 果 你 的 python 代 码依赖于 引用计数 实现的 行为 则这 种差 异可 能 会 导致一些 微妙 的 移植 问题
 在 一些 python 实现 中以 下代 码 在 cpython 中 工作 的很 好可能会 耗 尽文 件描 述 符 for  file  in  verylonglistoffiles  f  openfile  c  f
read 1实 际上 使用 cpython  的引 用计 数和 析构函 数方 案 每个 新 赋 值的 f 都 会关闭 前一 个文件
然 而对 于传统 的 gc  这些 文 件对 象只能 以 不 同 的 时 间 间 隔 可 能很 长 的时 间间 隔 被收集 和关闭
 如 果 要编 写 可用于 任何 python 实现 的 代码则 应显 式关 闭该文 件 或 使 用 with 语句 无论 内存 管 理 方 案如何 这 都有 效 for  file  in  verylonglistoffiles  with  openfile  as  f  c  f
 为什 么 cpython 不使 用 更传 统的 垃 圾回 收方案？
首 先这 不是 c  标准 特性 因此 不能 移植
 是的 我 们知道 boehm  gc  库
它 包含 了 大多 数 常见平台 但不 是 所 有 平台的 汇编代 码 尽 管 它 基 本上是 透明的但 也 不 是 完 全 透 明的 要让 python 使 用它 需要 使 用 补丁
 当 python 嵌 入 到 其 他 应 用程序 中时 传统 的 gc  也成 为 一个 问题
在 独立的 python 中 可 以用 gc 库 提供 的版 本替换 标 准 的 malloc  和 free  嵌入 python  的应用 程序 可能 希 望用 它 自己 替 代 malloc 和 free 而 可能不 需 要 python  的
现在 cpython  可以 正 确 地 实 现 malloc  和 free
cpython 退 出 时为 什 么不释 放 所有 内存？
 为什 么有 单独的 元组 和 列表 数 据 类型？
虽 然列表 和元 组 在 许多 方面 是 相 似 的但 它 们 的 使用方 式通 常 是完 全 不同的
可 以认为元 组类 似于 pascal  记 录或 c 结构 它们 是 相关 数据 的小 集合 可 以是 不同类型的数 据可 以 作为 一个 组进 行操作
例如笛 卡尔坐标 适当地 表示为 两 个 或三 个 数字 的 元组
 另一方 面 列 表更 像其 他语言中 的数组
它 们 倾向 于持有 不同数 量 的对象 所有对 象 都具 有 相同的 类 型 并且 逐个 操作
 例 如 os
返 回 表示当 前目 录中的 文件的 字符串 列 表
如 果 向目录 中 添加了 一两个 文 件对此输 出进 行 操作的函 数 通常不 会中 断
 元组是不可变的 这意 味 着一旦 创 建了元 组就 不能 用 新值 替 换它的任何元素
 列表 是 可变的这 意 味 着您 始 终可 以更改 列表的 元素
只 有不变 元 素可以 用作 字典 的 key 因 此只 能 将元组和非列表 用作 key
 列 表 是如何在 cpython 中 实 现 的？
cpython 的列 表 实 际上 是 可变长 度 的 数组 而 不是 lisp  风 格的 链表
 该实现 使 用对 其他对 象 的引 用 的连续 数 组并在 列表头 结构 中保 留指向 该数 组和 数组长 度的 指针
 这使得 索引列 表 ai 的操作成 本与列 表的 大 小或 索 引的 值 无关
 当添 加或 插入 项 时将 调整引 用数 组的 大 小
并采 用了一些 巧 妙的方 法来 提 高重 复添 加 项的 性 能当 数组 必须 增长时会分配 一些额外 的空 间 以 便在接下来的 几次 中不需 要实 际调 整大 小
 字典是如 何 在 cpython  中 实现 的？
cpython 的字 典实 现为 可调 整 大 小的哈 希表
 与 b 树 相 比这 在大 多 数 情况 下为 查找目前 最常见的 操 作 提 供了 更 好的性 能 并且 实 现更 简单
 字典的 工作 方式 是 使用 hash 内 置函数 计算字典 中存 储 的每个 键的 hash  代码
hash  代码 根据 键 和每 个进 程 的种 子而 变化 很大例 如 python 的 hash  值 为539294296而 python 一个按 位不同 的字符串 的 hash  值为1142331976
 然后 hash 代 码用 于计 算内 部数 组 中将 存储该 值的 位置
假设您存 储 的键 都 具 有 不同 的 hash 值 这意 味 着字典需 要 恒定 的时 间 o 1用 bigo  表 示法来 检索 一个 键
 为什么 字典 key  必须是 不可 变的？
 为什么 listsort 没有 返回 排序 列表？
在性 能很重 要的 情况 下仅仅 为了 排序 而复制 一份 列 表 将是一 种浪费
 因此 list
sort  对列 表进 行了适 当的 排序
 为了 提醒您 这 一事 实它 不会返回已 排 序的列表
这 样当您 需要排 序的 副 本但也需要保 留未排 序 的 版 本 时就 不 会意外地覆 盖列表
 如 果要返 回新列 表 请使用内置 sorted  函数
 此 函数从 提供 的可迭代 列 表中 创 建 新列 表对 其进行排 序 并返 回
例 如下 面是如 何迭 代遍历 字 典并 按 keys 排 序 for  key  in  sortedmydict 
如何 在 python  中指 定和实 施接口 规范？
为 什么 没有 goto ？
 可 以使 用异 常捕获 来提 供 goto 结 构 甚 至可 以跨 函数 调用工作 的
许 多人认为 异常捕 获可 以方 便地 模拟 cfortran  和 其他 语言 的 go 或 goto  结 构 的 所有 合 理用 法
例 如 class  labelexception  pass  declare  a  label  try 
但 是不 允许你 跳到 循环 的 中间 这通 常被 认 为是 滥用 goto
 谨 慎使 用
为 什 么原始 字符串 rstrings  不能 以反 斜杠结尾？
 为什么 python  没有 属性赋 值的 with  语句？
python  具有 with  语句 它 能将 一个 代码块 的执 行 包装 起 来 在进入和 退 出代 码块 时 调 用特 定的代码
 有 些 语言 具 有这 样 的 结 构 with  obj  a 1 equivalent  to  obj
total 1 在 python 中 这样的结 构是不明 确的
 其他 语 言如 objectpascal 、 delphi 和 c  使用 静态类 型 因此可 以毫 不 含糊 地 知道 分配 给什 么成员
 这 是静 态类 型的 要 点编 译器总 是 在 编 译 时知道 每个变 量 的 作 用 域
python 使 用动 态类 型
事 先 不可能知 道 在运 行 时引 用哪 个属性
 可 以动 态地 在对 象 中 添加 或 删 除成员 属性
 这使得无 法通过 简单 的 阅 读就 知 道引用 的是 什么属性 局部属 性、全局属 性还 是 成 员属性？例 如采用 以下 不 完整 的 代码段 def  fooa  with  a  printx  该 代 码 段假设 a  必 须有一个 名为 x 的成 员 属性
然而 python 中 并没 有告 诉解 释器这 一点
 假设 a 是整 数 会发 生什 么？如 果有 一个名为 x  的 全局 变量它是否会在 with  块中使用？ 如您 所见 python  的 动态 特性 使得这 样 的选 择 更加 困 难
 然而 python  可以 通过 赋值 轻松 实现 with  和 类似 语 言特性 减少 代码 量的 主 要好 处
代替 functionargs
c 63 写成 这 样 ref  functionargs
c 63这 也具有 提高 执行速度 的副作 用因 为 python  在运 行 时 解析名称 绑 定 而第 二 个 版本 只需要执 行一 次解 析
为 什 么 ifwhiledefclass  语句需要 冒号？
 冒 号主要 用于增 强 可读 性 abc 语言 实验的结 果之 一
考 虑一 下这 个 if  a  b  printa 与 if  a  b  printa  注意第 二种 方法 稍 微容易一些
 请 进 一步 注意在 这 个 faq 解 答的 示例 中冒号 是如 何 设置的这 是英 语中 的标 准用 法
另一 个次 要原 因是 冒 号使带 有语 法突 出显示 的编 辑 器更容 易工作他 们 可以 寻找冒 号来 决定 何时 需 要增 加缩 进而 不必 对程 序 文本 进 行更精 细的 解析
 为什 么 python 在 列表 和元组 的 末尾允 许使用逗 号？
python  允许您 在 列 表元 组和 字典的末尾添加 一个尾随逗号123 a  b  c  d  a 15 b 67 last  trailing  comma  is  optional  but  good  style 有几 个理由允 许这样做
 如 果列表元 组或 字典 的 字面 值 分布在 多行 中则 更容 易添加 更多 元素因 为不必记 住在上一 行中添 加 逗 号
这 些行 也可 以 重新 排序而不 会 产生语 法错误
不 小 心省略 逗 号会导致 难 以诊 断 的错误
 例如 x  fee  fie  foo  fum 这个 列表 看起来有四 个元素但 实际 上包 含三个 fee  fiefoo  和 fum
总 是 加上逗号 可以避 免 这个 错误的来源
允许 尾随逗号也可以使 编程代码 更容易生 成
扩 展嵌 入常见问 题
可以使用 c  语言创 建自己的 函数吗？
 是的 您可 以在 c  中 创建 包含函 数、变 量、异常 甚至 新类 型的内置 模 块
在 文档 扩展和 嵌入 python 解 释器中 有 说明
 大 多数 中 级 或 高级的 python  书籍也 涵 盖这 个 主题
 可 以使用 c  语言 创建 自 己的 函 数吗？
 是 的可以 使 用 c 中 兼 容 c 的 功能
 在 python  include 文件 周 围放 置 externc
 并 在 python 解释 器调用 的 每个 函 数之 前 放置 externc
 具 有构造 函数 的全 局或 静 态 c 对象 可能 不是 一 个好 主意
c  很 难写 有 没有其 他 选择？
 编 写自 己的 c  扩展有 很 多 选择具 体取决 于 您 要 做的 事情
cython  及 其相关的 pyrex  是接 受稍 微 修改 过的 python  形 式并 生 成相应 c  代码的 编 译器
 cython  和 pyrex  可以编写 扩展而 无需 学习 python  的 c  api
如 果需要连 接 到某 些当 前 不存在 python  扩 展的 c 或 c  库 可 以 尝 试使用 swig  等工具 包 装库的 数据类 型 和函 数
 sip  cxx  boost 或 weave  也是 包 装 c 库 的替代 方案
 如何 在 c  中 执 行 任 意 python  语句？
执 行此 操作的 最高 层 级函 数 为 pyrunsimplestring 它 接 受 单个字符 串参 数用于 在模块 main 的 上 下 文中 执 行并在 成功 时返 回0而在 发生 异 常包括 syntaxerror 时 返回1
如果 你 想要 更 多可控 性可以 使用 pyrunstring  请在 pythonpythonrun
c  中 查看 pyrunsimplestring 的 源 码
如 何在 c 中 对任 意 python 表达 式求值？
 可以 调用 前一问 题中介 绍的 函 数 pyrunstring  并附 带起 始标 记 符 pyevalinput 它 会 解析表达式 对其求值并返回结 果 值
 如何从 python  对 象 中提 取 c 的 值？
如 何使 用 pybuildvalue 创 建任 意长 度的 元组？
 不可 以
应 该 使用 pytuplepack 
 如何从 c 调 用对 象的方 法？
如 何捕获 pyerrprint  或打 印到 stdout  stderr  的任 何 内 容的输 出？
 在 python  代码 中 定义一 个支持 write 方 法 的对 象
将此对 象 赋值给 sys
stdout 和 sys
调 用 printerror 或 者只 是 允 许标 准回 溯 机 制 生效
 在此之 后输 出 将 转 往你的 write 方 法所 指 向的任 何地 方
 做到 这一 点的最 简 单方式 是使 用 io
stringio  类 import  io  sys  sys
getvalue  foo  hello  world 实 现 同样 效果 的自定 义 对象看 起来 是 这样的 import  io  sys  class  stdoutcatcherio
如 何 从 c 访 问 用 python  编 写的模 块？
如 何 在 python 中 对接 c  对象？
 根 据你 的 需 求可 以选 择许多 方 式
 手动 的 实 现 方式 请 查 阅 扩展 与嵌 入文 档来 入门
 需要知 道的是 对 于 python 运行时 系 统来 说 c 和 c  并 不 没 有太 大 的 区别—— 因 此 围 绕一 个 c 结 构 指针类 型构建新 python 对 象的策 略同样适用 于 c  对 象
 有关 c 库 请参 阅 c  很 难写 有没有其他 选择？
 我使 用 setup 文 件添 加了一个 模 块为 什么 make  失 败了？
 安装 程序 必须 以换 行符 结束 如果 没 有 换行符 则构 建 过程 将 失败
 修复 这个 需 要 一些 丑陋的 shell  脚本 编程 而且 这个 bug 很小 看起 来不 值得花 这 么大 力 气
 如何 调试 扩展？
 将 gdb 与 动 态 加载 的 扩展 名 一起使 用时 在加载扩 展名之 前不 能在扩展 名 中 设置断 点
在您 的
gdbinit 文 件中 或 交 互式添 加 命令 br  pyimportloaddynamicmodule  然 后 运行 gdb  gdb  localbinpython  gdb  run  myscript
 我想 在 linux 系统 上编 译一个 python  模块 但是缺少 一些 文件。 为什么
大 多数 打包 的 python  版本 不 包 含 usrlibpython 2
xconfig 目 录该 目录中包含 编 译 python 扩展 所 需 的 各种文件
 对于 red  hat  安 装 pythondevel  rpm  以获 取必要的 文件
对于 debian  运行 aptget  install  pythondev 
 如 何区 分输 入不完整 和 输入无 效？
 如何 找 到未 定 义 的 g  符 号 builtinnew  或 purevirtual ？
 能否 创建 一个 对象 类其中 部分 方法在 c  中 实现 而其他 方法 在 python 中 实现 例 如 通过 继 承？
python 常 见问 题
一般 信息
什么 是 python ？
python  是一 种解 释型、 交互 式、面 向对 象的 编程语言
 它包 含 了模块、 异常、 动 态 类 型、 高层 级动 态数 据 类型 以及 类等 特性
 在面 向对 象编程以 外它 还支持多 种编 程 范式例 如过 程 式 和函数 式编 程等
 python 结 合 了 超强 的 功 能和 极 清 晰 的 语 法
它 带 有许 多 系统 调用 和 库以 及多种窗 口系 统的 接口 并 且 能用 c 或 c  来 进行 扩展
 它还 可 用作 需要 可 编程 接口 的应 用程 序的扩展 语言
最后 python  非常 易 于 移植 它可 以在 包括 linux  和 macos  在内的 许多 unix  变种 以及 windows  上 运 行
要了 解更 多 详 情请 先查 看 python  教 程
 python 新 手指南提 供了 学 习 python 的其他 入门 教程 及资 源的 链接
 什么 是 python 软 件基 金 会？
python 软 件基 金 会 python  software  foundation  简称 psf  是一个 独立 的非盈 利组 织 它 拥有 python 2
1 及 以 上 各版 本 的版 权
 psf 的 使命 是 推 进与 python 编 程 语言 相关 的 开 源技 术 并推 广 python 的 使 用
 psf 的 主页 是 httpswww
向 psf 提 供 捐 助 在美 国是免 税 的
如 果你在 使 用 python 并 且感 觉 它对 你 很有 帮 助可 以通 过 psf 捐 助页进 行捐 助
 使用 python 是 否存 在版权限 制？
 你可 以任 意使用源 码只要你 保 留版 权 信息并 在 你基 于 python  的产 品文档 中 显 示 该版权 信息
 如果你遵 守此 版权 规 则 就 可以 将 python 用 于 商 业领 域 以 源 码 或二 进制 码的 形 式不论 是 否 经过 修 改 销 售 python 的副本 或是 以 某 种 形 式包含 了 python 的 产品
 当然我们 仍然 希 望获 知 所有 对 python  的商 业 使用
 请 参阅 psf  许可 页以 查 看进 一步 的说 明以 及许 可 的完 整文本 内 容 的链 接
python 的 徽标 是注 册商标 在某 些情 况下需 要 获得允 许 方可 使用
 请参 阅商 标使用 政 策了 解 详情
 创 造 python 的 最 初理 由是什 么？
以 下 是有关最 初缘起的 一 份非 常简 短 的摘 要由 guido  van  rossum  本人 撰 写我在 cwi  的 abc  部 门时在 实 现解释 型语言方 面 积 累 了丰富经 验通 过 与这个 部门 成员的协 同工 作 我学到了 大量有关 语 言 设 计的知识
 这是 许 多 python 特性 的最 初 来源 包 括使 用 缩 进来组 织语 句 以 及 包含非常 高层级的 数 据 结构 虽然在 python  中具 体的实现细 节完 全 不同
 我对 abc  语言 有 过许 多抱怨但 同时 也很喜欢 它 的许 多特性
没 有可 能通 过扩 展 abc  语 言或 它的 实现 来弥 补我的 不满—— 实际 上缺 乏可 扩展 性就 是它 最大 的问 题 之 一
我 也 有 一 些 使 用 modula 2 的 经验并 曾与 modula 3的 设 计 者进行 交流 还阅读 了 modula 3 的 报 告
 modula 3 是 python 中异 常 机 制 所 用语 法和 语义 以 及其 他一 些语 言 特性 的最 初来 源
 我 还 曾在 cwi 的 amoeba  分 布式 操 作系统 部 门 工 作
当时 我们 需要 有 一 种 比 编写 c  程 序 或 bash  脚 本更 好 的方 式 来 进行 系统 管理 因为 amoeba  有它自 己 的系统 调 用接 口并 且 无 法方便地 通过 bash  来访 问
我在 amoeba  中 处 理错误 的 经 验 令我 深刻 地意 识 到 异常 处 理 在 编 程语 言 特性 当中的 重要地 位
 我 发现 某 种具 有 abc 式的语法而 又能访问 amoeba  系统调 用的 脚 本语言将 可满 足需求
我 意 识到 编 写一种 amoeba  专 属的 语言 是 愚蠢 的 所以我 决定 编写 一 种具 有 全 面 可扩展 性的 语言
在1989年 的圣 诞假 期 中 我 手头的 时间 非常 充裕 因 此 我 决定开 始尝 试一下
在 接 下 来 的 一年里 虽然 我仍 然主要 用我 的业余 时间来 做这 件事但 python 在 amoeba  项目 中的 使用 获得了 很大 的成 功来自 同事 的反 馈让我 得以 增加了 许多早 期 的改进
到1991 年2 月经 过一 年多的开 发我 决定 将其 发 布 到 usenet
 之 后 的 事情 就 都 可 以在 mischistory  文件 里面看了
python  适合 做什 么？
python 是一种高 层 级的多用 途编 程语 言可 用 于 解 决 许多 不 同门 类 的 问 题
 该 语 言附带一 个庞 大的标 准 库涵 盖了字 符 串处理 正则表 达 式 unicode 比 较文 件间的差 异等 因特 网协议 httpftpsmtpxmlrpcpopimapcgi  编程等软 件工 程 单 元测 试日 志 记录性 能分析 python  代 码解 析等以及 操 作 系 统接 口系统 调用文 件 系 统 tcpip  套接 字 等
请 查看 python 标准 库 的 目录 以了解所 有 可用 的内容
此 外还 可以 获 取到 各 种各样 的第 三方扩展
 请 访 问 python 包 索引来 查 找 你 感兴趣 的 软 件包
python  版本的 编号 形式 是 怎样 的？
我 应如 何获 取 一 份 python  源代 码的 副 本？
最 新的 python  发布版 源代 码总 能 从 python
org 获取 下载 页链 接为 httpswww
 最 新 的 开发 版源 代 码可 以在 httpsgithub
compythoncpython 获取
 发布 版 源代 码是一个 以 gzip 压缩 的 tar  文件其中包 含完整 的 c 源 代码、 sphinx  格 式的文 档、 python 库模块、 示例 程 序以及 一些 有 用 的自 由 分发 软件
 该源代 码将 可 在大 多数 unix  类 平台上 直 接编 译 并 运 行
 请参阅 python  开发者指 南的 初步上 手部 分 了解 有 关 获取源 代 码并进 行编 译的更 多 信息
我 应 如何 获 取 python  的 文档？
 当前 的 python  稳 定版 本 的 标 准文 档可 在 httpsdocs
org 3查 看
也 可在 httpsdocs
html  获 取 pdf 、纯文 本以 及 可 下 载 的 html  版本
文 档以 restructuredtext  格 式 撰 写并 使用 sphinx  文档 工 具 生 成
 文 档 的 restructuredtext 源文 件 是 python  源 代 码发 布版的 一部 分
 我之 前从 未 接触 过 编程。哪里 有 python 的教程？
有 许多可 选择的教程 和书籍
 标 准文 档 中也包含 有 python 教程
请参 阅 新手 指南 以获 取 针对 python  编程 初 学者 的信 息 包 括教程的清单
是 否有 专 门针 对 python 的新 闻组 或 邮件列表？
有 一个新 闻组 comp
python  和一 个邮 件列 表 pythonlist
新闻 组和邮 件 列 表是彼此 互 通的—— 如 果你 可以 阅读 新闻 就不 必再 订阅邮 件列 表
comp
python  的流 量很大每 天 会 收到数以 百计 的 发帖 usenet  使 用者 通常 更 擅长 处理 这 样 大 的流量
有关新 软 件发 布和活 动的 公告可 以 在 comp
announce 中找到这 是个 严 格管 理的 低流 量列 表每 天会 收 到五 个左右 的 发 帖
 可以 在 python 公 告邮 件 列表 页 面进 行订 阅
 有关 其他 邮 件列 表 和新闻组的 更多 信息 可以 在 httpswww
orgcommunitylists 找到
我 应 如何获 取 python  的公开 测 试版 本？
可 以从 httpswww
orgdownloads 下载 alpha  和 beta 发 布 版
所 有 发布 版 都会在 comp
python  和 comp
announce  新闻组 以及 python  主页 httpswww
org 上进行公 告 并会推 送到 rss 新 闻 源
 你还可 以通 过 git  访问 python  的开 发版
 请参 阅 python  开 发者 指 南 了解详 情
我 应 如 何 为 python 提 交 错 误 报告和 补 丁？
要报 告 错误或 提 交补丁 请 使用安 装 于 httpsbugs
org 上的 roundup
 你 必须拥 有 一个 roundup 账 号才能 报告 错误 这样 我们 就可 以 在有 后 续问 题时 与你 联 系
这 也使 得 roundup 能 在 我们 处 理所 报告 的 错误 时向 你发 送更 新 消息
 如果 你之前使 用 过 sourceforge  向 python  报 告 错 误 你 可以 通过 roundup  的密 码重 置 操 作 来获 取你的 roundup  密码
 有关 python  开发流 程 的 更多信 息 请 参 阅 python  开 发者指 南
是否 有任 何公开发表的 python 相 关文 章可 以供 我 参 考 引 用？
 可能 作为 参考 文献 的最 好 方 式 还是引 用你 喜欢的 python  相关书 籍
第一 篇有 关 python  的文 章写于1991年 现在 其内 容已经相 当过时 了
 guido  van  rossum 与 jelke  de  boer  使用 python 编程 语言交互 式 地 测 试 远 程服务器 cwi  季刊 第4卷 第4 期1991 年12 月 阿 姆斯 特 丹第283303 页
 是否有任 何 python  相关 的书 籍？
是 的 相 关 的书 籍 很 多 还有 更多 即将 发行
请 访问 python
org  的 wiki 页 面 httpswiki
orgmoinpythonbooks  获取 一份清单
 你也 可 以到 各 大在 线书店 搜索 python  并过滤 掉 对 monty  python 的 引用 或 者也 可以搜 索 python 加 language
wwwpythonorg  具体位 于世 界上 的 哪个 地点？
python  项 目的 基 础 架 构分 布于世界 各地并由 python  基础架构 团队 负 责 管 理
详 情请访问 这里
 为 何 命 名为 python ？
 在 着手 编 写 python  实 现 的 时候 guido  van  rossum  同时 还 阅读 了 刚 出 版的 monty  python 的 飞行马戏 团剧 本这 是 一 部 自1970年 代开 始 播出 的 bbc  系列 喜 剧
 van  rossum 觉 得 他 需 要 选 择一 个简 短、独 特而 又 略 显神 秘的名 字 于是 他 决 定将 这 个新 语 言命 名为 python
 我 必 须 喜欢 monty  python 的 飞 行马 戏团 吗？
 不必 但这对 学习 会 有帮助

现 实世 界中 的 python
python 有 多稳 定？
有多 少 人在 使 用 python ？
使 用 者 应 该 数 以百 万计 但 很难 获得 一 个精确的数 字
python 可 以免 费 下载 因此并 不 存在 销量 数据此 外它 也可 以从许 多不 同 网站获取 并且 包 含于 许多 linux  发行 版 之 中因 此 下载 量 统计同样 无 法 完 全 说明 问 题
comp
python  新闻 组非 常活 跃但不 是所有 python  用户都会 在 新 闻组发帖 许多 人甚 至不 会 阅读新 闻组
 有哪 些重要 的项 目是 用 python 开 发的？
 请访 问 httpswww
orgaboutsuccess 查 看使 用了 python  的项 目列 表
 阅览 历次 python 会议 的 日程纪要 可以 看到 许多不 同公 司和 组织所 做的 贡献
 高水 准 的 python 项目 包 括 mailman  邮件 列表 管理 器 和 zope 应 用 服务器
 多个 linux  发 行 版 其中 最著 名的有 red  hat 均 已 使用 python 来编 写 部分 或 全部 的安 装 程序 和系 统管理 软件
 在内 部使用 python  的大 公司 包 括了 google  yahoo  以及 lucasfilm 等
 在未 来可 以 期 待 python 将 有什么 新进 展？
请 访 问 httpswww
orgdevpeps  查 看 python  增强提 议 pep
pep 是为 python  加入 某种 新 特性 的 提议 进 行描 述 的设计文 档 其 中会提 供 简明的 技术 规格说明 与 基 本 原 理
可 以查找标 题 为 python  x
y  releaseschedule 的 pep 其 中 x
y 是 某个 尚 未公 开发布 的版本
新 版 本 的开发 会在 pythondev 邮 件 列 表中进行讨 论
提 议 对 python 加入 不兼 容的 更 改 是否合 理？
通 常来 说 是不 合 理的
 世界 上已存 在的 python 代 码数 以亿 计因此 任 何对 该语言 的更 改 即便 仅会 使 得 现有程 序中 极 少的一 部分失 效也是 难 以 令人 接 受 的
就 算 你可 以 提供一个转 换程序 也仍然存 在 需要 更新全 部文 档的问 题另 外还有 大量已 出版 的 python 书 籍我 们不希 望让它 们在 一瞬 间全 部变 成废纸
如 果必 须更 改某个 特性 则应 该提 供 渐进式 的升级 路径
 pep 5 描述了 引入 向后 不兼 容的更改 所 需 遵循 的流程以 尽可 能减 少对 用 户的 干扰
python 是一 种对 编程 初学者友 好的 语言 吗？
当然
从 过程 式、 静态 类型的 编程 语言 例 如 pascal  c 或者 c  以及 java 的某 一子集 开始 引导 学 生入门 仍然是 常见 的做 法
 但以 python 作 为 第一种 编 程语言 进 行学习 对 学生可 能 更有利
python  具 有非常 简单 和一 致 的语法 和庞大 的标 准库而 且最 重要 的是 在编程入 门 教 学中 使用 python 可以 让学 生专 注于更重 要的 编程 技能例如 问题 分 解与 数据类 型设 计
使 用 python  可以快 速向学生 介绍基 本概 念例 如 循环与 过 程等
他 们甚 至 有可能 在第 一次 课 里就开 始接触 用户自定 义对 象
对 于之前从 未接触 过编 程的 学 生来说 使用 静态 类型 语 言会感 觉不够 自然
 这会 给学生带 来必须掌 握的额外 复杂性并 减 慢教学 的 进度
学 生 需要尝 试像计算 机一 样思 考 分 解问 题设计 一 致 的接 口并封 装 数 据
虽 然从 长远来看 学习 和使用 一种静态 类型 语言 是 很 重 要的 但 这并 不是 最适 宜在 学生 的第一次 编程 课上 就进 行探 讨的 主题
 还 有许 多其 他方面 的特 点使 得 python 成 为很 好 的 入门 语言
 像 java 一 样 python 拥 有一个庞 大的 标 准库因 此可 以在课 程非 常早 期的 阶 段就给学生 布置 一些 实用 的编 程 项 目
 编 程作业 不必仅限 于标 准四 则 运算 和账目检查程 序
通过 使用标 准库学生可以 在学 习编程 基础知 识的 同时开发 真正的应用从 而获得 更 大 的满足 感
使用 标准 库 还 能使 学 生 了解代 码 重 用的 概 念
 而 像 pygame 这 样 的 第 三 方模 块 同样有助于 扩 大 学生 的 接 触领域
python  的解释 器 使 学生 能够 在 编程 时 测试 语言特 性
 他 们 可以在一 个 窗 口 中 输入 程序源 代码 的同 时开 启一 个 解释器运行 窗 口
如果他们不 记得 列表有 哪 些方 法 他 们这 以这样 做 l  dirl  add  class  contains  delattr  delitem  dir  doc  eq  format  ge  getattribute  getitem  gt  hash  iadd  imul  init  iter  le  len  lt  mul  ne  new  reduce  reduceex  repr  reversed  rmul  setattr  setitem  sizeof  str  subclasshook  append  clear  copy  count  extend  index  insert  pop  remove  reverse  sort  d  for  d  in  dirl  if  not  in  d  append  clear  copy  count  extend  index  insert  pop  remove  reverse  sort  helpl
append 1 l 1通 过使 用 解 释器 学 生 编写 程序 时参 考 文档总 是能伴随 在 他 们身 边
python 还 拥 有 很好的 ide
 idle  是一个跨 平台 的 python  ide  它基于 tkinter  库 使 用 python 语 言编 写
 pythonwin 是 一 个 windows 专 属 的 ide
 emacs 用户 将 高兴地 了解 到 emacs 具 有 非常好 的 python  模式
所 有这些编 程环 境都提 供 语 法高 亮 自动 缩进以 及在 编写 代码 时使用 交 互式 解释器等功能
 请访问 python  wiki  查看 python  编程 环 境的 完整列 表
如果你想要 讨论 python  在教 育中 的 使 用 你 可能 会有兴 趣加 入 edusig  邮 件列 表
图 形用户界 面 gui 常见问题
图 形 界 面 常见问 题
python 是否有平台 无 关 的图 形界 面 工具 包？
tkinter
wxwidgets
qt
qt 工 具包 可 使用 pyqt 或 pyside  及 kde  pykde 4 有 多 个 绑 定 适配可 供选择
 pyqt  当 前相较 pyside 更成熟 但如果你 想编 写专有 软件就 必须 要从 riverbank  computing 购 买 pyqt 许可 证
 pyside 则 可以 自 由使 用于 各 类软 件
5以 上版本 使用 lgpl 进 行许可 此 外商 业 许可 证可从 qt  公司那 里获得
gtk
kivy
kivy 是 一种跨 平 台 图 形用 户界 面库 同时 支 持桌 面操作 系统 windowsmacos 和 linux  以及 移动设 备 androidios
该库 使用 python  和 cython 编写 可以 使用 一 系列 窗口后 端
kivy 是 自由的 开源 软件 使用 mit  许可证 分 发
fltk
the  fltk  toolkit  的 python  绑定是 简 单却 功能 强大 且成 熟的跨 平台 窗 口系 统可以 在 the  pyfltk  project 里获 得 相关 信息
opengl
对 于 opengl 绑定 请参 阅 pyopengl
 有哪 些 python 的 gui  工具是 某个 平台 专 用的？
 通 过 安装 pyobjc  objectivec  bridgepython  程序 可以使 用 mac  os  x  的 cocoa 库
mark  hammond  的 pythonwin  包 括 一个微 软 基础 类 mfc 的接 口 和 一 个绝 大 多数由 使用 mfc  类的 python 写 成的 python  编程环 境
 有关 tkinter  的问 题
 我怎样 冻 结 tkinter 程 序？
在 等待 io  操 作时 能够 处 理 tk 事 件 吗？
 在 windows 以 外的 其 他平台 上可 以 你 甚 至 不需 要使 用线程 但是 你 必 须稍 微 修 改 一 下 你的 io 代 码
 tk 有 与 xt 的 xtaddinput 对应 的调用 它允 许你 注册 一 个 回调 函数当 一个 文件 描 述 符 可 以进 行 io 操作的 时候 tk  主循环将 会 调 用这 个 回 调函 数
参 见 file  handlers
 在 tkinter 中键 绑定不工 作 为什么？
 经常听到 的抱怨是 已经通过 bind  方法绑定了 事件 的 处理 程 序但 是当 按下 相关 的按键后这 个处理程 序却没有 执 行
最常 见的 原 因是那 个绑定的 控件没有 键盘 焦点
 请在 tk 文 档中 查找 focus 指令
通 常一个 控件 要获 得键盘 焦 点 需要 点击那个 控件 而不 是 标 签请查看 takefocus 选 项
python 常见问题
 python  常 见 问题 编程 常见问 题设 计和历 史 常见 问 题代码 库 和 插 件 faq 扩展 嵌入 常 见问 题 python 在 windows 上 的 常 见问 题图 形用 户界 面 gui  常 见 问 题 为什么 我的 电 脑上安 装 了 python ？
 为什么 我的 电脑 上安 装了 python ？
什 么是 python ？
 为什么 我的 电脑上 安装 了 python ？
如 果你不 记 得你曾主 动安 装过 python 但 它却 出现 在了你 的 电脑 上这里 有一 些可 能 的原 因
 可 能 是这 台电脑 的 其他 用 户因想 学习 编程 而 安 装 了 它 你得 琢磨 一下 谁用 过 这台 电脑 并 安装 了 python
电 脑上安 装 的 第 三方应 用程 序可能 由 python 写成并附 带 了 一 份 python
 这样 的应用程 序有很多 例如 gui 程序、 网络 服务器、管理 脚 本 等
一 些 windows 可 能预 装了 python
 在撰 写 本 文 时 我 们 了解 到 hewlett  packard 和 compaq  的计 算机 包含 python
 显然 hpcompaq  的一些 管 理 工 具 是用 python  编写的
 许 多 unix  兼 容 的操 作系 统 例如 mac  os  x 和 一些 linux  发行版 默认 安 装了 python  它被 包 含 在基 本安装 套 件 中
我 能删 除 python 吗？
代 码 库和 插件 faq
 通用的 代 码库问 题
 如何 找到 可 以 用 来 做 xxx  的 模块 或应用？
mathpysocketpyregexpy 等 的 源文 件 在 哪？
如 果找不 到 模 块 的源文 件可 能 它 是一个 内 建 的 模块 或是使用 cc 或 其他 编译 型语言实 现 的动 态加 载 模块
这 种情况 下可 能是没 有源码文 件 的类似 mathmodule
c  这样的 文件 会 存 放在 c  代码 目录 中但不 在 python 目 录中
python  中至 少有 三 类模 块1
使 用 python 编 写 的模 块
py 2
 使 用 c  编写 的 动态加载 模块
dll
pyd
so
sl  等3
使用 c  编写 并链 接到 解 释器的 模块 要获取此 列表 输入 import  sys  printsys
 在 unix 中 怎样 让 python 脚 本可 执 行？
python  中有 cursestermcap  包吗？
 对于 类 unix  系统 标准 python  源 码发 行版 会 在 modules 子 目录 中附带 curses  模块但默 认并 不会编 译
注 意在 windows  平 台下不 可用—— windows  中 没有 curses  模块
curses  模块 支 持基本 的 curses  特性 同时 也 支 持 ncurses 和 sysv  curses  中 的 很多额 外功能比 如 颜色、 不同的 字符集 支 持、填 充和 鼠标支 持
这 意味着这个 模块不兼 容 只有 bsd  curses 模 块的 操作 系 统但是目前 仍 在 维护 的系 统应 该 都 不会 存在这种情况
 对于 windows  平台 使用 consolelib  模块
python  中存 在类似 c 的 onexit 函数的 东 西吗？
atexit  模 块提 供 了一 个 与 c  的 onexit  函 数 类 似的 注 册 函数
 为什么我 的 信号 处 理函数不 能 工作？
 最 常见的 问题 是信 号 处理函数 没有 正 确定 义参 数 列 表
 它会被 这样调用 handlersignum  frame 因 此它 应 当声 明 为带 有两个形 参 def  handlersignum  frame 
通 用任务
 怎样 测 试 python 程序 或 组件？
python  带 有 两个 测试 框 架
doctest 模 块 从模块 的 docstring  中寻找 示例 并执 行 对 比 输 出是否与 docstring  中 给出 的是 否 一 致
unittest 模块是 一个 模 仿 java 和 smalltalk  测试框 架的 更棒 的测 试框架
 为了使测 试更 容易 你应该 在程 序中 使用 良好 的模 块化 设计
 程序 中的 绝 大多数 功能 都 应该用 函数 或类方 法 封装—— 有时 这样 做会有 额外 惊 喜 程 序会 运行 得 更 快 因 为局 部 变 量比 全 局变 量访 问要 快
 除 此 之外程 序应 该避 免依 赖可 变的局部 变量 这 会使 得测试 困 难许多
 程序 的 全局主逻辑 应 该尽 量简 单 if  name  main  mainlogic  并 放置 在 程 序主 模块 的最 后面
 一 旦你的 程序 已经 组 织 为一个函 数和类行 为的 有 完整 集合 你就 应 该编 写测 试函 数 来检 测这 些行 为
可 以将 自动 执 行一 系列 测 试的 测 试集 关 联 到 每个 模块
 这听 起来似 乎 需要大 量的 工作 但是由 于 python  是如此 简 洁 灵活 因 此 它会 极其 容 易
你 可以 通过 与生 产代 码 同 步 编写 测试 函 数 使 编 程更 为愉 快和 有趣 因 为 这 将 更容 易 并 更早 发 现 代 码问 题 甚 至 设计 缺陷
 程 序 主模 块之 外 的 其 他辅 助 模 块 中 可 以增 加自 测 试 的 入口
 if  name  main  selftest 通 过 使用 python  实现 的 假 接 口即 使 是需要 与复杂 的外 部 接 口交 互的 程序 也可以 在外 部接 口不可用 时进 行 测试
 怎 样用 docstring  创建 文档？
pydoc  模块 可以 用 python  源 码中 的 docstring 创 建 html 文 件
 也 可以 使 用 epydoc  来只 通过 docstring  创 建 api  文 档
sphinx 也可 以引入 docstring 的 内 容
怎 样一次 只获取一 个按 键？
在类 unix  系统中 有多 种 方 案
 最直 接的 方法 是使 用 curses 但 是 curses  模块 太大了 难 以 学 习
线 程相 关
程 序中 怎样 使 用 线 程？
一 定 要使 用 threading 模 块不要 使用 thread 模 块
threading 模 块对 thread  模 块提 供的底 层线 程原 语做 了 更 易 用的 抽 象
aahz  的非 常 实用 的 threading 教程中 有一 些幻 灯片 可 以 参阅 httpwww
comoscon 2001
 我的线 程都没 有 运 行 为 什 么？
如 何 将 任务 分 配 给多 个 工 作线 程？
 最 简 单的 方式 是使 用 concurrent
futures  模块特 别是 其中 的 threadpoolexecutor  类
 或 者 如 果 你 想更 好地 控制分 发算法 你也 可以 自 己 写 逻 辑 实现
 使用 queue  模块 来创 建任务 列表队 列
queue 类 维 护 一 个 了 一个 存有 对象 的列 表 提 供 了
putobj  方法添 加元素 并 且可以 用
get  方 法获 取元 素
 这 个类会 使用 必要 的加 锁操 作以此 确 保每 个任 务只 会执行 一 次
 这是 一个简 单的例 子 import  threading  queue  time  the  worker  thread  gets  jobs  off  the  queue
sleep 5运行 时会 产 生如 下输 出 running  worker  running  worker  running  worker  running  worker  running  worker  main  thread  sleeping  worker  threadworker 1 started 130283832797456 running  with  argument 0 worker  threadworker 2 started 130283824404752 running  with  argument 1 worker  threadworker 3 started 130283816012048 running  with  argument 2 worker  threadworker 4 started 130283807619344 running  with  argument 3 worker  threadworker 5 started 130283799226640 running  with  argument 4 worker  threadworker 1 started 130283832797456 running  with  argument 5
查 看模块的 文档以 获 取 更多信 息 queue  类提 供了 多种 接口
 怎样 修改 全局变量 是线程 安 全的？
python  vm  内部 会使 用 global  interpreter  lock  gil  来 确保 同 一时间只 有一个 线程 运行
 通 常 python 只 会 在 字 节 码指令之 间切换线程 切 换 的 频 率可 以通过 设置 sys
setswitchinterval  指 定
从 python  程序 的 角度 来看 每一条字 节 码 指令 以 及 每 一 条 指 令 对应的 c  代码 实现 都是 原子的
 理论 上 说 具 体的 结 果 要看具体的 pvm  字 节码 实 现 对指 令的解 释
而实 际上 对内 建类型 intlistdict  等的共享 变 量的 类 原 子操作都 是原 子 的
 举 例来说 下面 的操 作 是原子 的 l 、 l 1、 l 2是 列表 d 、 d 1、 d 2 是字 典 x 、 y 是 对象 ij  是 int 变量 l
keys 这 些不 是原 子的 i  i 1 l
appendl 1 li  lj  dx  dx 1 覆 盖其 他对 象的 操作会 在 其他 对象 的 引用计 数变成0 时触 发其 del 方法 这可 能 会产 生一 些影响
 对 字典 和 列 表 进行 大量 操 作时尤 其如 此
 如 果 有疑 问的话 使 用互斥 锁
不能删 除全 局解 释 器锁 吗？
global  interpreter  lock  gil 通 常被 视 为 python 在 高端 多核 服 务器上开发 时的 阻力 因为几 乎所有 python 代码 只有 在获 取到 gil 时才 能 运行 所以 多 线程的 python 程 序只能有 效地 使用一 个 cpu
 在 python 1
5 时代 greg  stein 开 发了 一个 完整 的补 丁包 freethreadings  补丁移 除了 gil 并 用粒 度更 合 适的 锁来代 替
adam  olsen 最 近也 在他 的 pythonsafethread 项目 里 做 了类 似的 实验
 不 幸的 是由 于 为 了 移 除 gil 而 使用了大 量细 粒度 的 锁 这 两个 实 验在 单线程测 试中的性 能都有 明显的 下降至 少慢30
 但 这 并意 味着 你 不能 在多 核机 器 上很好 地使 用 python 你 只 需 将 任务 划分 为 多 进程 而 不 是 多 线程
 新的 concurrent
futures  模 块中 的 processpoolexecutor 类 提 供了 一个 简单 的方 法如 果你 想对 任 务 分发 做更 多控 制 可以 使用 multiprocessing  模 块提 供的 底层 api
 恰当 地使 用 c 拓 展也 很 有 用使 用 c 拓 展处 理 耗时 较久 的任 务时 拓展 可以在线 程 执行 c  代码 时释 放 gil  让其他 线 程 执 行
zlib 和 hashlib  等 标准库 模块 已经 这 样 做 了
也 有 建议 说 gil  应 该是解 释 器状 态 锁而 不 是 完全的 全 局锁 解 释器不 应 该共享对 象
不幸 的是 这也 不 可 能发生
 由于目 前许 多 对 象 的实 现都 有 全 局 的 状态因 此这 是一个艰 巨的 工 作
 举例来 说小 整型 数和 短 字符 串会 缓存 起来 这些 缓 存 将 不得 不 移动 到 解释 器状 态中
 其他 对象 类 型都 有自 己的自 由 变量列 表这 些自 由变 量列表 也 必须 移 动 到 解 释 器 状态 中
 等 等
我 甚 至怀 疑这 些工 作是 否可 能在 优 先的 时间 内完 成 因 为同样 的 问 题在 第 三方拓展 中也 会存在
 第 三方 拓 展编 写的 速度可 比你 将它们转换为 把 全局 状 态存 入 解 释 器 状态 中的 速度快 得多
 最后 假设多 个解 释器 不 共 享 任 何状 态那 么 这 样做 比 每个进 程一 个解 释器 好在 哪里 呢？
输入 输 出
怎样 删除 文件？ 以 及 其 他文件 相 关 的 问 题……
怎 样复 制文件？
shutil  模 块有一 个 copyfile 函 数
注 意在 macos 9 中 不会 复 制 resource  fork 和 finder  info
 怎样 读取 或 写 入 二 进 制 数据？
似 乎 ospopen  创 建的 管 道不 能 使用 osread  这是 为什么？
read  是 一个底 层函 数它 接收 的是 文件描 述 符—— 用 小整 型数 表 示的 打开 的文 件
os
popen 创 建的 是一 个高 级 文 件 对 象和内 建的 open  方法 返回 的类 型一 样
因 此如果 要 从 os
popen 创 建的管 道 p  中读 取 n 个 字节的 话你 应该 使用 p
 怎样 访问 rs 232 串口？
 为 什么 关闭 sysstdoutstdinstderr  并不 会真正 关掉 它？
网络 internet  编 程
python  中的 www  工具是 什么？
参 阅代 码库 参 考手 册中 互联 网协 议和支持和互联 网 数据处 理这 两 章的 内容
python 有 大量 模块 来 帮 助 你构 建服 务端 和客 户 端 web 系 统
paul  boddie  维 护 了 一 份 可 用框 架 的 概 览见 httpswiki
orgmoinwebprogramming 
cameron  laird  维护 了 一 份关 于 python  web 技 术的 实用 网 页 的集 合见 httpphaseit
pythonwebpython 
 怎样 模 拟 发送 cgi  表 单 methodpost ？
 生成 html  需要 使 用 什 么 模 块？
 你 可 以 在 web 编 程 wiki  页 面找 到许多 有用 的 链 接
怎 样 使 用 python  脚 本 发送 邮 件？
 使 用 smtplib  标 准库 模 块
 下 面是 一 个很简单 的交 互式 发送 邮件 的代 码
这个 方法 适用 于任 何支 持 smtp 协 议的 主机
quit  在 unix 系 统中 还 可以 使用 sendmail
sendmail  程序的 位置 在不同 系统 中不 一样 有时 是在 usrlibsendmail  有时 是 在 usrsbinsendmail
sendmail  手册 页面 会对 你有所帮 助
以下 是示例 代码 import  os  sendmail  usrsbinsendmail  sendmail  location  p  os
socket 的 connect 方 法怎 样避免阻塞？
 通常 会 用 select  模 块处 理 socket  异 步 io
要 防止 tcp  连 接 发生 阻塞 你可 以将 socket 设 为非 阻塞模式
这 样当你 执行 socket
connect  时你 将或 是立 即 完成 连接 不大 可 能或 是收 到一 个 包含
errno  错误 码的异常
einprogress  表示 连接正 在进 行 但还 没 有完成
 不同 的操 作系 统 将返回 不 同 的 值因此 你需 要确 认你的系统 会返 回什 么值
你 可以 使 用 socket
connectex 方 法来避免生 成 异常
它将只 返 回 errno 值
 要进行 轮询你可 以稍 后再次 调用 socket
connectex 0 或 errno
eisconn  表 示连 接已 完成或 者 你也 可以 将此 socket  传 给 select
select 来 检查 它是 否可 写
注解 asyncio  模块 提 供 了通 用的 单 线 程并 发 异步 库它 可被 用 来 编写非 阻塞 的网络 代码
第 三 方 的 twisted  库是 一个热 门 且 功 能丰 富的 替代 选择
 数据 库
python 中 有数据库包 的接口 吗？
当然
标 准 python 还 包含了 基 于磁盘的哈 希接口 例 如 dbm 和 gdbm 
除此 之外 还有 sqlite 3模块 该 模块 提供了 一 个轻量 级的 基 于磁 盘的 关系型数据 库
大多 数关 系 型数据库 都已 经支持
查 看数 据库编 程 wiki  页面获取 更多信 息
在 python 中 如 何实 现 持久 化对 象？
pickle  库 模块 以一种非常 通 用 的方 式 解决 了 这个 问题虽然 你依 然不能 用它 保 存打开的 文件、 套 接字 或 窗口 之类 的东 西此 外 shelve 库 模块可 使 用 pickle 和 gdbm 来 创建 包含 任意 python  对 象的 持久 化映 射
数学 和数 字
python 中怎 样生成随 机数？
 编程 常见 问 题
一般问 题
python  有没 有 提供 断点 与 单 步 调 试等功 能的 源 码 层 次的 调 试器？
有的
 以 下介 绍了一些 python  的调 试 器内 置函数 breakpoint 允 许你使 用其 中的 任 何一 种
pdb 模 块是 一 个 简单但是 够 用的 控制台 模式 python  调试器
它 是标 准 python 库的 一 部分 并 且已 收录 于库参考 手册
 你也可以通 过 使用 pdb  代 码作 为 样例 来编 写你自己 的 调试器
 作 为标准 python  发行 版 附带组 件 的 idle 交互 式环境通 常 位于 toolsscriptsidle 中 包含一个 图形化的 调试器
pythonwin 是 一 个包含 有基于 pdb 的 gui  调 试器的 python  ide
 pythonwin  调 试器会 为 断点加 上颜色并 具有许多 很棒 的 特性例 如 也可以 非 pythonwin 程序
 pythonwin 是 python  for  windows  extensions  项 目的一 部 分也是 activepython  发行 版的 一部分参 见 httpswww
comactivepython
eric  是一个 基于 pyqt  和 scintilla  编辑组 件构建的 ide
pydb  是标 准 python  调 试器 pdb  的一个版本 经 过修改 后 可与 ddd 数 据 显示调 试器 一起 使用 ddd 是一种 流行 的图形化 调试器前端
 pydb  可以在 httpbashdb
netpydb 找 到 ddd 可以在 httpswww
orgsoftwareddd  找 到
有许 多商 业 python  ide  包括图 形 调试器
 他 们包括 wing  ide  httpswingware
 是 否有能 帮助寻找 漏洞或执 行静态分 析的工具？
 有的
pylint 和 pyflakes 可 进行基本 检查来帮 助你尽早 捕捉 漏洞
静态类 型检 查器例 如 mypy 、 pyre  和 pytype 可以 检 查 python 源代 码中 的类型 提 示
我如 何能够通 过一个 python 脚 本创建一 个独立运 行的二进 制文件？
如 果你想要 的只是一 个独立的 程序用户可 以下 载和 运 行而不必 先 安 装 python  发行版 你就 不需要 将 python 编 译 成 c 代 码
 有许多工 具可 以确定 程 序所 需 的模 块 集并 将这 些模 块 与 python  二 进制文 件 绑定 在 一 起以 生成 单 个可 执 行文 件
 一 种是 使 用冻 结工具它 包含 在 python 源 代码 树 toolsfreeze 中
 它将 python  字节 代 码转换为 c  数组 一 个 c 编 译器 你 可 以将 所 有 模块 嵌入到一 个新 程序 中 然后 将其 与 标准 python  模块 链接
 它 的工 作 原理是递 归 扫 描源 代码 以 获 取 import  语句 两种 形 式并 在 标 准 python 路径和 源 目 录用 于 内 置 模 块 中 查 找 模块
 然后 它 将用 python 编写 的 模块 的 字节 码转 换为 c 代码可 以 使 用 编组模 块转 换为 代 码对 象的 数组 初 始 化器 并创建 一 个定 制 的配置文 件该文 件 仅包 含程 序中 实际使 用的 内置模块
然 后 它编 译生成 的 c 代 码 并将 其与 python  解释 器的其余部 分 链 接以 形 成 一个 独立的二 进 制 文 件其 行为与你 的 脚 本 完全相 同
 显 然 freeze  需要一 个 c  编译器
 有 几个其 他实 用工 具 不需要
 一个 是 thomasheller 的 py 2 exe 仅 限 windows  httpwww
org 另一个 工具是 anthony  tuininga 的 cxfreeze
 是否 有 python  程序规 范代 码标准或 风格指南？
 有的
 请参 阅标准 库 模 块所 要求的 代码 风 格描 述 文 档 pep 8
核 心语 言
当 变量 有 值 时 为 什 么 会出 现 unboundlocalerror ？
 通 过 在 函数 体中的某处添加赋 值 语句导 致 以前 正 常 工作的代 码被 修改而 得到 unboundlocalerror 会令 人 感 到 意外
以 下 代码 x 10 def  bar
 printx  bar 10正常工 作但 是 以 下代 码 x 10 def  foo
 x 1会 得到 一个 unboundlocalerror  footraceback  most  recent  call  last 
unboundlocalerror  local  variable  x  referenced  before  assignment 这 是因 为当 你对 作用域 中的 变量进 行赋 值时 该变 量将 成为 该作 用域 的局 部变 量 并在 外部 作用域 中隐 藏任 何类 似 命名 的变 量
由 于 foo 中的 最后 一 个 语句为 x  分配 了一 个新 值编 译器 会将 其识别 为局 部 变量
 因 此 当 先前的 printx 尝 试打 印未 初 始化 的 局部变 量时 会导 致错 误
在 上面的 示例 中你 可以 通过将其声 明为全 局来访 问 外部作 用 域变 量 x 10 def  foobar
 x 1 foobar 10 这 个显式声明 是必 需 的以 便提醒 你 与类和 实 例 变量的表 面类 似 情况不同 你实 际 上 是在 外部 作 用域中修改 变量 的值 printx 11 你可以 使 用 nonlocal  关 键 字 在 嵌套 作 用域中 执行 类似 的操 作 def  foo
python  中的局部变 量和 全局 变量有 哪 些规 则？
在 python 中 仅 在函 数内引 用的 变量是 隐式 全局变量
如 果在 函数 体 内的 任何 位 置 为 变量 赋值则 除非明 确声 明为 全 局否 则将其 视为局 部 值
虽然 起初 有点 令人 惊 讶但片刻考虑就 可 以解释
一 方 面要 求 global 表 示 已分配的 变量可 以防 止意外 的副 作用
另 一方面 如果 所 有 全局 引 用都 需要 global  那么你一直 都在 使用 global 
 你必须 将对 内 置 函 数或 导入 模 块的组件 的 每 个引 用声明 为 全 局
这 种杂 乱 会 破 坏 global  声明 用 于识别 副 作用的 有用性
为 什么 在具 有不 同 值的 循 环中定 义 的 lambdas 都 返回相同 的 结果？
 如何跨 模块共 享全局 变量？
在单 个程 序 中 跨 模 块共 享信息 的规 范 方法 是创 建一 个特 殊模块 通常称为 config  或 cfg
只 需在应 用 程 序的 所 有 模块 中导 入 配 置 模块 然后 该 模 块可 用 作 全 局名 称
因 为每 个模 块只 有一 个实 例 所以对 模块 对象 所 做的 任何 更 改都会 在任 何地 方反映 出来
 例如 config
x  请注意出 于同 样的原因 使用 模块 也是 实现 singleton 设 计 模 式的 基础
导入模 块的 最佳 实践 是什 么？
 为什 么对 象之间会 共享默 认值？
这 种类型的 缺陷 通常 会惹恼新 手 程序 员
考 虑这个 函数 def  foomydict  danger  shared  reference  to  one  dict  for  all  calls 
 mydictkey  value  return  mydict  第一 次调用此函 数时 mydict  包含 一项
 第 二 次 mydict  包含两项 因 为 当 foo  开 始执行 时 mydict  中 已经 有一 项了
函 数调 用经 常 被 期 望 为 默 认值创 建新的对 象
但 实际情 况 并非 如此
 默认 值会在 函数 定 义 时一 次性地 创 建
如 果对象发 生改 变就 如 本示 例 中 的字 典那 样 则 对 函数 的 后续 调用将 会 引用 这个被 改 变 的对 象
 按 照定 义 不可 变 对象 例如数 字、字符 串、元组和 none  因 为不可变所 以是 安 全 的
 对可 变对象 例 如字 典、列表和 类实 例 的改 变则 可 能造 成迷 惑
由于 这一特 性 在编 程 中应 遵循 的一项 好习 惯 是不 使用可 变 对象 作 为 默认值
 而应 使 用 none 作 为 默认 值和函 数中 的值 检查 值为 none 的 形参 并创建 相 应的 列表、 字 典或 其他 可 变 对象
 例如 不 要这样 写 def  foomydict 
而 要 这 样写 def  foomydictnone  if  mydict  is  none  mydict  create  a  new  dict  for  local  namespace  这 一特 性有 时会 很 有用 处
 当你 有 一个 需要 进 行 大量耗时 计 算的函数 时 一 个 常 见 技巧是 将每 次 调 用函 数的 参数和 结 果值 缓存 起来 并在 同样 的值被 再次 请求 时返 回缓 存 的 值
这 称为记 忆具 体 实现 方式 可以是这样 的 callers  can  only  provide  two  parameters  and  optionally  pass  cache  by  keyword  def  expensivearg 1 arg 2 cache  if  arg 1 arg 2 in  cache  return  cachearg 1 arg 2 calculate  the  value  result 
 cachearg 1 arg 2 result  store  result  in  the  cache  return  result 你 也 可 以使 用 包 含一 个字 典 的全 局变量而 不使用参数 默认 值 这完全取 决 于个 人偏 好
如 何将 可选 参数 或关 键字参数 从一个函 数传 递到另 一 个函数？
使用 函数参 数列表中的 和说 明 符 收集 参数 这会将位 置参 数 作 为元 组将 关键 字参 数作 为字典
 然后 您可 以使 用和 调用 另一 个函数 时传 递 这 些参 数 def  fx  args  kwargs 
形 参和 实参之 间有 什么 区别？
 形参 是指 出现 在函 数定 义中 的名称 而实 参则 是在 调用 函 数时 实 际传入的 值
 形参 定 义了 一 个函 数能 接受 何种 类型 的 实 参
例 如对 于以 下函 数 定义 def  funcfoo  barnone  kwargs  passfoo  bar  和 kwargs 是 func  的形 参
但 是在 调用 func  时例 如 func 42 bar 314 extrasomevar 实 际的 值42314和 somevar  则是 实参
 为什 么更 改列 表 y  也会 更改 列表 x ？
 如何 编写带输出 参数的函 数通过 引 用 调用？
 请 记住在 python 中 参数是 通 过赋值来传递 的
 由于赋值 只是 创建了 对象 的引 用因 此 在调 用者 和被 调用者 的参 数名 称之间 没有 别名所 以 本 身是没 有按 引 用调 用的
你可 以 通过多 种方式实 现所需 的效 果
通过返回 一个 结果元 组 def  func 1 a  b 
 x  y  oldvalue 99 func 1 x  y  newvalue 100这 几 乎 总 是 最清 晰 明了 的解决 方案
通 过使用 全局变量
 这种方 式不 是线 程安全的 而且 也 不受 推荐
通过 传 递一个 可变 即可原 地 修改 的对 象 def  func 2 a 
通 过 传递一个会 被 改变 的字 典 def  func 3 args 
 或者 在 一个 类实 例 中捆 绑值 class  namespace 
 args  namespaceaoldvalue  b 99 func 4 args  varsargs  a  newvalue  b 100几乎 没 有 任 何适当 理 由 将问 题 如 此复杂化
你的 最佳 选 择是 返回 一 个包 含多个 结果的 元组
 如何 在 python  中 创 建 高阶函 数？
你有 两种 选 择使 用嵌 套 作用 域 或 者使 用可 调 用对 象
例 如 假设 你想 要定 义 linearab  使其 返回一 个函 数 fx 来 设 计 axb 的值
可 以使用以 下嵌套作 用域 def  lineara  b  def  resultx  return  a  x  b  return  result 或使 用一个可 调用对象 class  linear  def  initself  a  b  self
b  在两种情 况下 taxes  linear 0
32都会 给出一个 可调用对 象使得 taxes 10 e 60
可 调用对象 方式的缺 点是速度 略慢且生 成的 代码略 长
 但是请注 意一 组可 调 用 对象 能够 通过 继承 来共 享 签名 class  exponentiallinear  init  inherited  def  callself  x  return  self
b  对 象可以封 装多 个方 法 的状态 class  counter  value 0 def  setself  x  self
set 这 里 inc  dec  和 reset 将 表现为 共享 同一 计数 变量 的 多 个函 数
 如 何 在 python  中复 制 对 象？
 一般来说 通常 情况 下 请 尝试 copy
copy 或 copy
deepcopy
 不是 所有 对象都 可 以复 制但 多 数都 是 可以 的
 某些 对 象 可 以方便地 复制
 例 如字 典具有 copy  方法 newdict  olddict
copy  序 列可以 通 过 切 片来 复 制 newl  l
如何 找 到 对 象的 方 法或属 性？
对 于 一个 用 户 自 定 义类的 实例 xdirx  将 返回一 个按字母 顺序排 序的 包含 实例属性 和方 法及 其类 所定 义的 属性 名称 的列表
我的 代 码如 何 才能 发 现对 象的名 称？
逗 号运 算 符 的优 先 级 是什 么？
逗号在 python 中不是 运算 符
 考虑这个例 子 a  in  b  a  false  a  由于 逗号 不 是运 算符而 是 表达式 之 间的分 隔 符以上代码 的 含义 就相 当 于 a  in  b  a 而 不是 a  in  b  a 对 于 各种 赋 值 运算符 等来 说同 样 如 此
它 们并 不是 真正的运 算符而是 赋值语句中 的 语法分 隔符
是否 有与 c 的三 目运算符 等 价的东 西？
有的
相 应语 法如下 ontrue  if  expression  else  onfalse  x  y 5025 small  x  if  x  y  else  y  在 python 2
5引 入此 语 法之 前 常见的做法 是 使用逻 辑运 算符 expression  and  ontrue  or  onfalse  然而 这种做 法并 不保 险因为 当 ontrue  具 有布 尔假值 时将 会 给出 错误 的结 果
所 以使 用
形 式总 是会 更好
 是 否 可以 用 python 编 写混 淆的 单行 程序
可以
通 常 是 在 lambda 中 嵌套 lambda  来实 现的
 请参阅 以下三 个来自 ulf  bartelt  的示例代 码 from  functools  import  reduce  primes 1000 printlistfilternonemaplambda  yyreducelambda  xyxy 0 maplambda  xyyyxrange 2 intpowy 0
2308024 lines  on  screen  v  v  columns  on  screen  maximum  of  iterations  range  on  y  axis  range  on  x  axis 请不 要 在家 里尝试 骚 年
函数 参数 列表 中 的斜 杠是 什么 意思？
函数 参数列 表中的 斜杠 表 示在 它之前 的形 参是仅 限位 置形 参
 仅 限 位置形参 没有 外部可 用的 名称
 在 调用 接 受仅限 位置 形参 的函数时 参 数只 会基 于它 们的 位 置被 映 射 到形 参
例如 divmod 是一 个接 受 仅 限位 置形 参的函数
 它的文档是 这样的 helpdivmod  help  on  builtin  function  divmod  in  module  builtins  divmodx  y  return  the  tuple  xy  xy
在 形参 列表 末尾 的斜 杠意味 着两 个形 参 都是 仅限 位置形参
 因 此附 带 关键字 参 数调用 divmod 将会 导 致报 错 divmodx 3 y 4 traceback  most  recent  call  last  file  stdin  line 1 in  module  typeerror  divmod  takes  no  keyword  arguments
数 字和字符 串
如何 指定十 六 进制和八 进制整 数？
 要指定 一个 八 进制 数 码 则在 八 进制 值之 前加一 个零和一 个小 写或 大写字 母 o  作为 前缀
 例如 要将变量 a  设为 八进 制 的10 十进制 的8就 输 入 a 0 o 10 a 8 十 六 进制 数也同样 简单
 只要在 十 六进 制数 之前 加 一个 零和 一个 小写或大 写 字母 x
 十六进 制数码中 的 字 母可 以 为 大写 或小 写
例如 在 python 解释 器中 输入 a 0 xa 5 a 165 b 0 xb 2 b 178
为 什 么2210 返 回3？
如何 将 字符 串转换为 数 字？
如 何将 数字转 换 为字 符串？
 如 何修改 字符 串？
 无 法 修改 因为字符串 是不 可 变对 象
 在 大 多 数 情 况下 你 应 该使 用你 想要 的各 种 部分 来 构造 一 个新字符 串
 但 是如果 你想要 一个 可以 原地修 改 unicode  数据的 对 象可 尝 试 使用 io
stringio  对 象或 array  模 块 import  io  s  hello  world  sio  io
如 何使用字 符 串 调用 函数 方 法？
有多种技 巧可供选择
 最 好的 做法 是使 用一 个将 字符 串映 射到 函数的 字典
 这一 技巧的 主要 优势 在于 字符串不 必与 函数 名 称一 致
这 也是 用于模 拟其他语言 中 case 结构 的主 要 技巧 def  a  pass  def  b  pass  dispatch  go  a  stop  b  note  lack  of  parens  for  funcs  dispatchgetinput  note  trailing  parens  to  call  function  使 用内 置函 数 getattr  import  foo  getattrfoo  bar 请注 意 getattr  可 用 于 任何 对 象包括 类、类 实例、 模块等等
在 标 准 库中 多次使用了 这个 技 巧例如 class  foo  def  dofooself 
 f  getattrfooinstance  do  opname  f 使 用 locals 来 解析 出函 数名 def  myfunc  printhello  fname  myfunc  f  localsfname  f
是否 有 与 perl 的 chomp 等 效 的方 法 用 于 从 字 符 串 中 删除尾 随换 行 符？
可 以使 用 s
rstriprn 从字 符串 s  的末 尾删除所有 的换行 符 而 不删除 其他 尾随 空格
 如果字 符串 s  表示 多行 且末尾 有 几 个空 行 则将 删除 所有空 行的 换 行符 lines  line 1 rn 
rstripnr  line 1 由于 通 常 只在 一次读取一 行文 本时 才需要这 样 做所以 使 用 s
rstrip 这 种 方 式 工作得 很好
是 否有 scanf 或 sscanf 的对 应 物？
 没 有 这样的 对应 物
对于 简单的输入 解析最 方便 的 做法 通 常是 使 用 字符 串对 象 的 split 方 法将 一 行 内 容 拆解 为 以空格 分隔 的单 词然后使用 int  或 float  将 表示 十进 制 数的字 符串 转换为 数值
 split 支持可 选 的 sep  形参 适用于内容 行使 用空 格符以外 的 分隔符 的 情况
 以 于更复 杂的输入解 析 正 则表达 式会比 c 的 sscanf 更 强大 也更 适合 此类任务
unicodedecodeerror 或 unicodeencodeerror  错 误 是什 么意思？
见 unicode 指 南
性 能
我 的程序太 慢 了。该如 何 加快 速度？
总的 来说 这是个棘 手的问题
 首 先 下面列出 了 深 入了 解前需 要记住的 事 情不 同 的 python 实 现具有不 同 的性 能特 点
本 faq  着 重解 答的是 cpython 
 行为可能 因操 作系统 而 异 尤其是在 谈论 i  o  或多线 程时
 在尝 试优化 任何 代 码前 应始 终 找 到程序 中的 热点 请参 阅 profile 模 块
编写 基准脚 本 将允许 您在 搜索 改进 时快 速迭代 请参 阅 timeit 模 块
 强烈 建议在 可能 引 入隐 藏在复杂 优化中 的 回归之 前 要有 良 好 的 代 码 覆盖 率 通 过 单 元 测 试 或任 何其 他 技 术
话 虽 如此 加速 python  代码有很 多技 巧
 以下 是一 些可 以达 到可 接受 的性 能水平的 一般原则 使您 的算 法更 快 或更 改为 更快的算 法可 以产 生 比 尝 试在 代码中 使用 微优 化技巧更大 的 好处
 使用 正确 的数 据 结构
 参考 文 档内置 类型和 collections  模块
当 标准 库提 供 用于 执行 某些操 作 的原 语 时可 能尽管 不能 保 证比 您可 能提 出的任 何替 代方 案更 快
 对于 用 c 编 写的 原语例如 内置 函 数和一 些 扩 展类 型 这是 真的
 例如 请确保 使 用 list
sort 内 置方 法或 相关的 sorted  函 数 进 行 排 序有 关适 度高 级用法的 示例 请 参阅 排序 指 南
 抽象倾 向 于创 造间 接性 并 迫 使 翻译 更 多地 工作
 如 果间 接 级 别 超 过 完成 的 有 用工 作 量则 程序 将变慢
 你应该 避免 过度 抽象 特别 是 在 微小 的 功 能 或 方法的 形 式 下这通 常也 会对可读性产 生不 利影 响
 如果 你 已经 达到 纯 python  允 许的 限制那 么有 一些工 具可 以 让 你走 得 更远
 例 如 cython 可 以 将稍 微修改 的 python 代 码 版本 编译为 c  扩展并 且可以在 许多 不 同的平台 上使用
 cython 可以 利用 编译和可选 的 类型注 释来使代 码明 显快于解释运 行时 的速度
如 果您 对 c  编程技 能有 信心 也可以自 己 编写 c 扩 展 模块
 参见专门 介绍 性能提示 的 wiki  页 面
将多 个字符 串连 接在 一 起的最 有 效方法 是什 么？
str 和 bytes  对 象是 不 可 变的 因此 将多个字 符串连接 在一 起效 率很 低因 为每个连接 都会创建 一个新对象
在一 般 情 况下总运行 时间 是总字符 串长 度 的二 次方
 要 连 接 多 个 str  对象通常 推荐 的用 法 是将 它们 放 入 一 个列表 中 并在结 尾处调 用 str
join  chunks  for  s  in  mystrings  chunks
joinchunks  另 一 个 合理 有效 的惯 用 方法是 io
stringio  要 连 接多个 str  对 象建 议 使用 本地 连接运 算符 扩 展 bytearray 对 象 result  bytearray  for  b  in  mybytesobjects  result  b
序列元 组 列表
如何在元 组和 列表 之间 进 行转 换？
类 型构 造器 tupleseq 可将任 意 序列 实 际上 是 任意可迭 代对 象转 换为 具 有 相同 排列 顺序 的相 同条 目的 元 组
例 如 tuple 123产 生123而 tupleabc  产生 a  b  c
 如果 参数 为 一个 元 组它 不会 创建 副本 而 是返 回同 一对 象因 此如 果你 不 确定某个对 象 是否 为元 组时 也可 简单 地调 用 tuple
 类 型 构 造 器 listseq 可 将任 意 序列或 可迭代 对象 转换 为具 有相 同排 列顺 序的 相同条目的 列 表
例 如 list 123产 生123 而 listabc  产 生 a  b  c
如 果 参数为一个 列 表它 会像 seq  那样 创建 一 个副 本
什 么是 负数 序号？
python  序列 使用 正数 或负 数 作 为 序号 或称 索引 号
 对于正数序 号 第一 个 序 号为0 而1为 第 二个 序号依此 类 推
对 于负 数序 号倒 数 第 一个 序号 为1而 倒数 第 二个 序 号 为2依 此类 推
可 以认 为 seqn  就 相当 于 seqlenseqn
使 用负 数序号 有时 会很 方便
例如 s 1 就 是原 字符 串去 掉最 后一 个字 符这可 以 用 来 移 除某 个 字符 串末尾的换 行符
 如 何以 相反 的 顺序 迭 代 序列？
 使用 reversed  内 置 函数 for  x  in  reversedsequence 
这不 会修改 您 的 原始 序列 而是构 建一个 反向顺序 的新副本以 进行 迭 代
如何 从列 表 中删 除 重复项？
 如 何从列 表中删除 多 个项？
对 于 删除重 复项一种可 能 的做法 是设 置 删除条 件 显式地 进行反向 迭代
 但是 更 容易也 更快速的 做法是进 行 隐式 或 显式的 正 向迭代 并 使用切 片替代
以 下列出了三种方 式
 mylist  filterkeepfunction  mylist  mylist  x  for  x  in  mylist  if  keepcondition  mylist  x  for  x  in  mylist  if  keepcondition  列表推 导式 可能 是最快的
如 何在 python  中创建 数 组？
使 用 列表 this 1 is  an  array  列表 在时 间复 杂度 方 面相 当于 c  或 pascal  数 组 主要 区别在 于 python 列 表可 以 包 含许 多不 同类 型的 对象
array 模块 还 提供 了 创 建具有 紧凑表 示的 固定 类型 的 数组 的 方 法但 它的索 引 速度比 列 表慢
 还 要注 意数字 扩 展和 其 他扩 展 还 定义 了具 有各 种特性的 类似数组 的 结构
要 获取 lisp  样 式的列表 可以使用 元组 模拟 cons  单元 lisplist  like  this  example  none  如 果需要 可变 性可以 使 用列 表而 不是 元 组
 这 里模 拟 lisp  car 的是 lisplist 0 模拟 cdr  的是 lisplist 1
 只 有在你 确定 真 的 需 要 的 时候 才 这样做因 为它通 常比使用 python  列 表 慢得多
 如何创 建 多 维 列表？
你可 能试 图制作一 个 像这 样的多 维数组 a  none 23如果 你 打印它 看起 来是正 确的 a  none  none  none  none  none  none 但 是当 你给某 一项赋值 时 会 同 时 在 多个位置 显 示变 化 a 005 a 5 none 5 none 5 none 其中的原 因在 于 使用 对列 表执 行 重复操作 并 不是 创建副 本它 只是 创建 现有对象 的引 用
3 创建 了 对 长 度 为二 的同一列表 的3个 引用
对 某一 行的 改变 会作 用于 所有行 通常这 一定 不是你 所 希望 的
建 议的 做法是 先 创建一个 所需长 度的 列表然后 其中 的 元素 再 以 一个 新创建 的 列 表来填 充 a  none 3 for  i  in  range 3 ai  none 2 这样 就生 成了 一个 包含3个 长度 为二的 不同 列 表的 列表
 你 也 可以 使用列 表推导 式 w  h 23 a  none  w  for  i  in  rangeh 或 者你 还可 以 使用提 供矩 阵类 型的 扩 展包 其中 最著 名的是 numpy
 如何将 方法 应用 于 一 系列 对 象？
可 以使 用 列表 推 导 式 result  obj
为 什 么 atuplei  item 会 在 执行加 法 时 引发 异常？
这 是由两个 事 实共 同导致 的 结果 一 是增 强 赋值 运算 符 属于 赋值运 算符二是在 python 中 存在 可变 和不 可 变两 种 不同 的对 象
 此 处的讨 论在 任 何 对 元组 中指 向可 变对象的 元素 使用增 强 赋值 运算 符的情况 都是普 遍成 立的但 在此 我们 只以 list  和来 举例
 如果 你 写成这 样 atuple 12 atuple 01 traceback  most  recent  call  last 
 typeerror  tuple  object  does  not  support  item  assignment 发 生异常的 原 因是显 而易见的1会 与 对象 atuple 0 相加 而该 对象为1得到 结 果对象2 但当 我们 试 图 将运算 结 果2赋值 给 元组 的0号元素 时就将 报 错因为 我 们 不能改 变元组 的元 素所指向 的 对 象
在表 层之处以 上增 强 赋值 语 句 所做 的大 致是这 样 result  atuple 01 atuple 0 result  traceback  most  recent  call  last 
 typeerror  tuple  object  does  not  support  item  assignment  由 于 元 组是不 可变 的因此操 作的 赋值 部分 会引发错 误
 当 你这 样写 的 时 候 atuple  foo  bar  atuple 0 item  traceback  most  recent  call  last 
 typeerror  tuple  object  does  not  support  item  assignment  发 生异 常会 令人 略感 吃惊 还 有一个 更为令 人吃 惊的 事实 虽然 有报错但 是 添加 操作 却 生效 了 atuple 0 foo  item  要明白为 何会 这样 你 需 要知 道 a  如 果 一 个对象 实现 了 iadd  魔术 方法 它 会在 执 行增 强 赋 值时 被调用 并且其 返回 值将用 于该 赋值语 句 b  对于列表 来说 iadd  等价 于 在列 表 上 调 用 extend  并返 回 该列表
因此 对 于 列表我 们可以 说就是 list
extend 的 快捷 方 式 alist  alist 1 alist 1 这相 当 于 result  alist
iadd 1 alist  resultalist 所 引用 的对象已被 修 改 而 引用 被修 改 对象 的指 针 又重 新被 赋值 给 alist
赋 值的 最终 结果 没 有 变 化因为 它 是引用 alist 之前 所引用的 同 一对 象 的 指针 但 仍 然发 生了 赋值 操作
 因此在我 们的 元组 示例 中 发生的 事情 等 同 于 result  atuple 0
 typeerror  tuple  object  does  not  support  item  assignmentiadd  成 功执 行因此 列 表得 到 了 扩 充但是虽 然 result 指 向 了 atuple 0已经 指向 的同一 对象 最后 的 赋 值仍然 导致了 报 错因 为元 组 是不 可 变的
我想 做 一 个 复杂 的 排序 你 能用 python 做 一 个 schwartzian 变 换 吗？
 该技 术归功 于 perl  社区 的 randal  schwartz 它通 过将每个 元 素映 射 到 其 排 序 值 sort  value 的 度量 对列表 中的 元素 进行 排 序
在 python  中使 用 list
sort  方法 的 key 参 数 isorted  l  isorted
如 何按 其他列表 中的值 对一 个 列 表进 行 排 序？
将 它们 合并到 元 组的 迭代 器中 对结 果列 表进 行 排 序 然后选择 所需 的元素
 对象
 什么是 类？
什 么是 方法？
 什 么 是 self ？
self  只 是方 法 的第 一 个 参数的常 规 名称
 例如对 于某 个类 的某 个实 例 x  其方 法 methself  a  b  c 实 际 上 应该 被称 为 x
metha  b  c 对 于被 调 用 的方 法 会被 称为 methx  a  b  c 
另 请参 阅为 什么 必须 在 方 法 定 义和 调 用中 显式 使用 self ？
 如 何检 查 对象 是否 为 给定 类或 其 子 类的 一 个 实 例？
什 么 是委 托？
 委托是一种 面 向 对象的技 巧也 称 为设 计 模式
 假设 您有一 个 对 象 x 并 且 想要 改 变 其中一个方 法 的行为
您 可 以创 建 一 个新 类它 提供您感兴 趣的 方法 的 新 实现并 将 所 有其他 方 法委 托给 x  的 相应 方 法
python  程 序员可 以轻 松实 现委 托
例如以 下类 实 现了 一个类 该类的 行为 类似 于 文 件但将 所 有 写 入 的数 据转 换为 大写 class  upperout  def  initself  outfile  self
outfile  name 在 这里 upperout  类重 新定 义了 write  方 法 在调用下层 的 self
write  方法 之 前将 参 数字 符串 转换 为 大写 形式
 所有 其他 方法 都被 委 托给 下层 的 self
outfile 对象
委 托是通过 getattr  方 法 来完 成 的 请参阅语 言参考了 解有 关 控制 属 性访 问的 更多 信息
 请注意对于 更一 般的情 况 来说 委 托 可能 包含 更多 细节 问 题
当 某些 属 性 既需 要 读取 又需 要设置 时类 还必 须定 义 setattr 方 法 并且 这 样做 必须 小心 谨慎
 setattr 的 基本实现 大致 相 当于 以下 代 码 class  x 
 大多数 setattr  实现必 须 修改 self
dict 来 为 自 身 保存局部状态 而又不 至于 造 成无限递归
 如 何 从 覆盖 基 类 的派生类 调用 基类中定 义的 方法
使用内 置 的 super 函数 class  derivedbase  def  methself  superderived  self
meth  对于 python 3
0 之前 的版本您 可能 正在使 用经 典 类对 于 诸如 classderivedbase 
 之类 的 类定 义 可以 将在 base  或 base  中的 一 个 的基 类 中 定 义的 方法 meth  调用 为 base
 这里 base
meth  是 一个未 绑 定的 方法因 此 您需要提 供 self  参 数
 如何组 织代码以 便 更 改基 类？
 如何 创建 静态 类数据和 静 态类 方法？
python  支持 静态 数据和 静态 方 法 在 c  或 java  的 意 义 上
 对 于 静 态数 据 只 需定义一 个类 属性
 要为 属性分 配新 值就 必须 在赋 值 中显式 使用类 名 class  c  count 0 number  of  times  c
count  对于任 意 c 来 说只 要 isinstancec  c 为真则 c
count  同样 也指向 c
count  除非被 c 自 身或者 从 c
class 回 到 c 的基 类搜 索 路 径上的某个 类所 重载
 注意 在 c 的 某 个方 法内部 像 self
count 42 这样的 赋值将 在 self 自身 的字 典 中新建一 个名为 count  的不 相关实 例
想要重 新绑 定 类静 态 数 据名称就必 须总 是指 明类名 无论 是 在方 法内 部 还是 外部 c
count 314 静态方 法 是可 行 的 class  c  staticmethod  def  staticarg 1 arg 2 arg 3 no  self  parameter 
然 而 获 得 静 态方 法效果的 更直 接的方 法 是通 过 一个 简单 的模 块 级函 数 def  getcount  return  c
count 如 果 您的 代码 是结 构 化的 以 便为每个 模块 定义一个 类或紧 密相关 的 类层次 结构 那么 这 就提 供了 所需的 封 装
 如何 在 python 中重 载构造函数 或 方法？
我 尝 试使 用 spam  但是得到 一个关于 someclassnamespam  的 错误信 息。
以双 下划线打头 的变量会 被更 名 以提 供 一 种定义 类私 有变量的 简单 而有 效的 方式
 任何形式 为 spam  的标识符 至少 前 缀 两 个 下 划 线至 多 后缀 一 个 下划线 文 本会 被替 换为 classnamespam  其 中 classname 为 去除 了全 部前缀下 划 线的当前类 名 称
 这并不 能 保 证私 密 性外 部用户 仍然可 以访 问 classnamespam 属性 私有 变量值也在对 象 的 dict 中可见
 许多 python 程 序员从来 都 不使 用 这种私 有变量名 称
 类定 义了 del  方法 但 是删 除 对 象 时没 有 调 用 它。
如何获取给 定类的所 有实 例的 列表？
python  不跟踪 类或 内 置类 型的 所有 实 例
 您可 以对 类的 构造 函数 进行编 程以通过保 留每 个实 例的 弱引用列 表来跟 踪所 有实 例
为 什么 id 的 结 果看起 来 不是 唯一 的？
id  返回一 个 整数 该整 数 在对 象的生命周 期 内 保证 是唯 一的
因为 在 cpython  中这 是对 象的 内存地 址 所以经 常发 生在 从内 存中删 除对象 之后下 一 个新 创建 的对象被 分配在 内存 中的相 同 位置
这 个 例 子说 明了这一 点 id 100013901272 id 200013901272 这 两 个 id 属于 之前 创 建 的不 同 整数 对象 并在 执 行 id 调 用后立即 删 除
 要 确 保 要 检查其 id 的对 象仍 处于 活动 状 态 请创建 对该 对象 的另 一 个引 用 a 1000 b 2000 ida 13901272 idb 13891296
 模块
 如何 创 建 pyc 文 件？
如 何 找 到当 前 模块名 称？
模块 可 以通 过查 看 预定 义的 全局变量 name 找 到 自己的模 块名 称
 如果它的值 为 main 程 序将作为脚 本运 行
通常 通 过导 入使 用 的 许多 模块 也提供 命令 行 界面 或自 检 并且 只在检查 name 之 后 才执行 之 后 的代 码 def  main  printrunning  test
如 何让 模块 相互导 入？
 假 设您 有以下模 块 foo
py  from  foo  import  foovar  barvar 2 问题是 解 释器 将执 行以下 步 骤 首 先 导 入 foo  创建 用于 foo  的空 全局 变量 foo  被 编译 并 开 始执 行 foo 导 入 bar  创建 了用 于 bar 的空全 局 变量 bar  被 编译 并 开 始 执 行 bar  导 入 foo  这是一 个空 操 作 noop 因为已 经有一个名为 foo  的 模 块 bar
foovar 最后 一步 失 败了 因 为 python  还没 有解 释 foo 而 foo  的 全局 符号 字 典仍 然是 空 的
当 你使用 import  foo 然 后 尝试 在全局代 码中 访问 foo
foovar  时 会发 生同 样 的 事情
这 个 问 题 有 至少三 种可 能的 解决方 法
guido  van  rossum 建 议 避 免使 用 from  module  import 
并将 所 有 代 码放在 函 数中
全 局 变量 和类变量 的 初 始 化 只 能 使用常量 或 内置函 数
 这 意 味着 导入 模块 中 的所 有内容 都被 引用 为 module
name 
jim  roskind  建 议在每 个 模块 中按 以下顺 序 执行步骤 导出 全 局变量 函数和 不需 要 导入基 类的类 导入 声明活 动代码包括 从导 入值 初 始化的 全局 变量
van  rossum  不喜欢 这种 方 法因为 导入出 现在 一 个陌 生 的地 方 但这种 方法确 实有 效
matthias  urlichs  建议重 构代码 以便 首先 不 需要递 归导 入
这些 解决 方案并 不相 互排 斥
importxyz  返回 module  x  如何 获 取 z
考 虑 使用 importlib 中的 函数 importmodule  z  importlib
 当我编 辑 了导 入 过的 模 块并重 新导入 它时 这些变 化没有显 示 出 来。 为什 么 会这样？
 出于 效率和 一致 性的原 因 python 仅 在 第 一次 导入模 块时 读取 模块文件
 如果不这 么做 在 一个 由 许 多模 块组 成的 程序 中每 个 模 块都 会导入相 同的 基 本模块 那么基 本模 块将被 解 析和 重 新解析 多次
要 强制 重 新读取 已更改 的模 块请 执 行以下 操作 import  importlib  import  modname  importlib
reloadmodname  警告 这种 技 术不 是100％万无一 失
特 别是 包含 如下 语 句 的 模块 from  modname  import  someobjects  将 继 续使 用旧 版本的导 入对 象
如 果模 块包 含类 定义则 不会更新现 有的 类实 例以 使 用新的类定 义
 这 可能 导致以下 矛盾 行为 import  importlib  import  cls  c  cls
c  isinstance  is  false  false  如果 打 印出类对 象的 标 识问 题的 本质 就 会明 确 hexidc
python 在 windows  上 的 常见问 题
 我怎 样 在 windows 下运 行一 个 python  程 序？
 我怎 么让 python  脚 本可 执行？
 在 windows 上标准 python  安装 程序已 将
py 扩 展 名 与 文件 类型 python
file 相 关 联并 为 该 文件 类 型 提供 运 行 解 释器 的 打开命 令 dprogram  filespythonpython
exe 1
这 足 以使 脚本 在命令 提示符下 作为 foo
py 命 令 被执 行
如 果 希望通 过简 单 地键 入 foo  而无 需输入文 件扩 展 名来 执行 脚本 则需要 将
py 添加到 pathext  环境 变量 中
为 什 么有时 候 python 程 序会 启动 缓慢？
 通常 python 在 windows  上启 动 得 很快 但 偶尔会 有错误 报 告 说 python 突 然需 要 很长 时间才能 启 动
 更令 人费 解的 是在 其他 配置 相同 的 windows 系统上 python  却 可 以工 作得很好
 该问 题可 能是 由于计 算机上的 杀毒 软件 配置 错误 造成 的
 当将 病毒扫描配置 为监视 文件 系统 中所 有读 取 行为 时一 些杀 毒扫 描 程序会导致 两 个 数量级 的启 动开 销
请 检查 你系统 安装 的杀 毒扫 描程 序的配 置确 保 两台 机它们是同 样 的 配置
 已 知的 mcafee  杀 毒软 件 在 将它 设 置 为扫描 所有 文件 系 统访 问时 会产生 这个问题
 我怎 样使 用 python  脚本 制 作可 执行 文件？
请参 阅 cxfreeze  来 了解 distutils  扩展 它 允 许你 基 于 python 代 码 创建控 制台和 gui  可执行 文 件
 py 2 exe 是 最 流行 的用 来构 建 基于 python 2
x  的可执 行文 件的扩 展 它暂时 还不支 持 python 3但 新的版 本 已在 开 发中
pyd  文件 和 dll 文件相 同吗？
 我怎 样 将 python  嵌 入 一 个 windows  程序？
 在 windows 应 用 程 序中 嵌 入 python 解 释器 可以 总 结如 下1
请 不要 直接在 你的
exe  文件 中内 置 python 
在 windows  上 python  必须 是 一个 dll  这样 才可 以处 理 导 入的 本 身 就是 dll  的模 块
这 是第 一 个未 记 录 的关键 事 实
相 反链 接到 pythonnn
dll  它通常 安装 在 cwindowssystem  中
 nn  是 python 版 本如 数字33代 表 python 3
3
你 可以 通过 两种不 同的 方 式链接 到 python 
 加 载 时链接 意 味着 链接 到 pythonnn
lib  而运 行时链 接意 味着 链接 pythonnn
dll 
一 般说 明 python  nn
lib 是所谓 的 import  lib 对 应于 pythonnn
dll 
它 只定 义 了 链接 器的 符号
 运行 时链接 极大 地简 化了链 接选项一切 都 在 运行 时发 生
 你的代码 必须 使 用 windows 的 loadlibraryex 程序 加载 pythonnn
dll 
 代码 还 必 须使 用使 用 windows 的 getprocaddress  例程获 得的 指针 访问 pythonnn
dll  中程 序 和数据 即 python 的 c  api 
 宏 可 以 使这 些指 针对 任何 调 用 python  c  api 中 的例程的 c  代码 都是透明 的
 borland 提示 首 先使用 coff 2 omf
exe  将 pythonnn
lib 转 换为 omf  格式
 如 果你 使 用 swig 很 容易 创建 一 个 python 扩 展 模块 它将 使 应 用 程 序 的 数 据 和 方 法 可 供 python  使 用
swig 将 为 你处 理所 有 蹩 脚 的细 节
结 果是你 将链 接 到
exe  文件 中的 c  代 码 你 不 必创 建 dll 文件 这也 简化 了 链 接
 swig  将创 建一 个 init  函数 一 个 c  函数 其名 称 取 决 于 扩展 模块 的 名称
 例 如 如果 模块 的 名 称是 leo 则 init  函数 将被 称为 initleo 
 如 果 您 使用 swig 阴 影类 则 init 函 数将 被称为 initleoc 
 这 初 始 化了 一 个由 阴 影类 使用 的 隐 藏 辅助 类
你 可 以 将 步 骤2中 的 c 代 码链 接到
exe  文 件的 原 因是 调 用 初 始 化 函数等 同于 将 模 块导 入 python 这 是 第 二 个关键 的 未 记 载事 实
4
 简 而 言 之你可 以 用以 下代 码 使 用 扩展模 块 初始 化 python 解 释 器
 python  c  api  存 在 两个问 题 如果 你使 用除 msvc 之 外 的编 译器 用于 构 建 python
dll  这 将 会 变 得 明显
 问 题1采 用 file  参数 的 所 谓 极 高级 函数 在多 编 译 器 环境 中不 起作 用 因 为 每个 编 译器 的 file  结构 体概 念 都不 同
从 实现 的 角 度 来看 这 些是 非常 低级 的 功 能
问 题2在为 void 函 数 生 成包 装器 时 swig  会生成 以 下代码 pyincrefpynone  resultobj  pynone  return  resultobj  pynone  是一 个 宏 它扩 展为对 pythonnn
dll 中 名 为 pynonestruct 的 复 杂数据 结构的 引 用
 同 样 此 代码将 在 多 编 译器环 境中 失败
 将 此 类代 码替 换 为 return  pybuildvalue  有 可能 使用 swig 的 typemap 命令 自动 进 行 更改 但 我 无 法使 其工作我 是一 个完全 的 swig 新手
 使 用 python  shell 脚 本 从 windows 应 用 程序内 部建 立 python  解释 器 窗 口 并不 是一个 好 主意 生成 的 窗 口将 独立于 应 用程 序 的窗 口系 统
相 反你 或 wxpythonwindow 类 应 该创 建一 个本 机 解释 器窗 口
将该 窗 口 连 接 到 python 解 释器 很容 易
 你可 以将 python  的 io 重 定向 到支 持 读 写 的任 意对 象 因 此 你 只 需 要一个 包含 read  和 write  方法的 python  对 象 在 扩展 模块 中 定义
 如 何 让编 辑 器 不 要 在 我 的 python 源 代 码中插 入 tab ？
 本 faq  不 建议 使用 制表符 python  样式 指南 pep 8 为发 行的 python 代 码 推荐4 个 空格这 也是 emacs  pythonmode  默认 值
 在 任何编 辑器下 混合 制 表 符 和空 格 都 是一个 坏主 意
 msvc  在 这 方 面 没 有什 么不 同并 且 很 容 易 配 置 为使 用 空 格 点击 tools ‣ options ‣ tabs  对 于 文 件类 型 default 设 置 tab  size 和 indent  size  为4 并 选择 插入 空格 单选按 钮
如果 混 合制表符 和空格 导 致前 导 空格出现 问题 python 会引发 indentationerror  或 taberror 
你 还可 以 运 行 tabnanny 模 块以批处 理 模式检查 目录树
如何 在不 阻 塞的 情况 下 检 查 按键？
 使 用 msvcrt  模块
 这是一个 标准 的 windows  专属扩展 模 块
 它定义 了一个函数 kbhit  用 于检 查 是否 有键 盘 中 的某 个 键被 按下以 及 getch 用 于获 取一 个字符 而不 将其 回显
 术 语对 照 表
argparse 教 程
作 者 tshepang  lekhonkhobe  这篇教程旨 在作为 argparse 的入 门介绍 此 模 块是 python 标准 库中 推荐的命 令 行 解析模 块
 注 解 还 有 另 外 两 个模 块 可 以 完成 同 样 的任务 称为 getopt 对应于 c  语言 中的 getopt  函数 和被 弃 用 的 optparse
还 要注意 argparse  是基 于 optparse 的 因此 用法与 其 非 常相似
 概念
让我们 利 用 ls 命 令来 展示我 们 将 要在 这 篇 入 门教 程中探 索 的功 能 ls  cpython  devguide  prog
我 们 可 以从这 四 个 命 令 中学 到 几 个 概 念 ls 是 一个 即使 在 运行的时 候 没 有 提 供 任何 选 项也 非 常有 用 的 命 令
在 默 认 情况 下他 会 输出 当 前 文 件 夹包含 的文件 和 文件 夹
 如 果我 们 想 要使 用比 它默 认提 供的更 多 功 能 我们 需要 告诉 该命令 更多 信 息
 在这个 例 子里 我 们 想要 查 看一 个 不 同 的目 录 pypy
 我们 所 做的 是指 定 所谓 的位 置 参数
之 所以这 样命名是因 为程 序 应该 如何 处 理 该参 数 值完 全 取决于它在 命令行出现 的位置
 更 能 体现这个 概 念 的命令 如 cp 它 最 基 本 的 用 法 是 cp  src  dest
 第 一个 位 置 参 数指 的是你 想 要复 制 的第 二 个位 置 参数指 的 是你想 要 复 制到的位 置
现 在假 设 我 们 想要 改变 这 个程序的行 为
在 我们的 例子 中我 们 不仅 仅只 是输 出 每 个文 件 的 文 件 名还输 出了 更多信 息
 在这 个 例子 中 l  被 称 为 可选 参数
这是 一 段帮 助文 档 的 文 字
它 是 非常 有用的 因为 当你遇到 一 个 你 从 未使用 过 的 程序时你可 以通 过阅 读 它 的帮 助文档 来弄 清楚它 是 如何 运 行的
基 础
 位置 参 数 介绍
 可 选参 数 介绍
 到目前 为止我 们一 直在 研究位置参 数
 让我 们 看 看如何 添 加 可选 的 import  argparse  parser  argparse
verbosity  printverbosity  turned  on 和 输出 python 3 prog
py  error  argument  verbosity  expected  one  argument 程 序 运行 情 况 如下 这 一 程序 被设 计 为 当 指 定 verbosity  选项 时显示 某些东 西否 则不 显示
 不添加这 一选 项时程 序 没有 提示 任 何错 误而 退出 表 明 这 一 选项 确实是可 选的
注 意 如果一 个可 选参 数没 有 被使 用时 相关变量被 赋值 为 none 在此 例中是 args
verbosity  这 也就是 为 什么它在 if 语 句中被 当作 逻 辑假
 帮助 信 息有 点不 同
使 用 verbosity 选项 时必 须 指定 一个 值但 可以 是任 何 值
 上 述例 子 接受任 何 整数 值 作 为 verbosity  的参 数 但对 于我们 的简 单程 序 而言只有两 个值有实 际意义 true  或者 false
 让我 们据 此修 改 代码 import  argparse  parser  argparse
verbose  printverbosity  turned  on  和输 出 python 3 prog
py  h  verbose  optional  arguments  h  help  show  this  help  message  and  exit  verbose  increase  output  verbosity 程 序运 行情况如 下现在 这一选 项更多 地 是一个 标 志而 非 需 要 接 受一 个值 的 什 么 东西
 我们甚至 改 变 了选 项 的 名字 来 符合这 一思 路
 注 意我 们现在指 定 了一 个 新 的 关键 词 action  并赋值 为 storetrue
 这 意 味着 当这 一 选项存在时 为 args
verbose 赋 值为 true
 没 有指 定时 则隐 含 地 赋值 为 false
 当 你为 其指定一个 值 时它 会报 错符 合 作 为 标志的真 正的 精神
留意不 同的帮 助文字
 短选项
 如果你熟悉 命令行的 用法 你会发 现我 还没讲到 这一选项 的 短版 本
 这 也很 简 单 import  argparse  parser  argparse
verbose  printverbosity  turned  on 效果 就 像这 样 python 3 prog
py  h  v  optional  arguments  h  help  show  this  help  message  and  exit  v  verbose  increase  output  verbosity  可 以注 意 到 这一新 的能 力 也 反 映 在 帮助 文本里
 结 合 位置 参数 和可 选 参 数
进 行 一 些 小小 的 改 进
 如 果我们 想 扩 展我 们 的简 短程序 来执 行 其他 幂次的运 算而 不仅是 乘 方 import  argparse  parser  argparse
y  answer  else  printanswer 输出 python 3 prog
py 42 v 4216 请注意 到目前 为 止 我们一直在 使用详细 级别 来更改 所显示的 文 本
以 下 示 例则 使 用详细级 别来显 示 更多的 文 本 import  argparse  parser  argparse
y  end  printanswer 输 出 python 3 prog
 矛 盾 的 选 项
 后 记
 除 了 这 里显示的 内 容 argparse 模块 还 提 供了 更多 功能
它 的文 档相 当 详 细和 完整 包含 大 量 示例
 完 成这 个教 程之 后 你应 该 能毫 不 困 难地 阅 读该 文档
argument  clinic  howto
 作者 larry  hastings  摘 要 argument  clinic  is  a  preprocessor  for  cpython  c  files
the  goals  of  argument  clinic
basic  concepts  and  usage
converting  your  first  function
 for  more  on  format  units  please  see 语句解释 及变 量 编 译
advanced  topics
symbolic  default  values
 currently  the  following  are  explicitly  supported  numeric  constants  integer  and  float 字 符串 常 量 true  false  and  none  simple  symbolic  constants  like  sys
renaming  the  c  functions  and  variables  generated  by  argument  clinic
converting  functions  using  pyargunpacktuple
optional  groups
注 解 optional  groups  are  only  intended  for  use  when  converting  functions  that  make  multiple  calls  to  pyargparsetuple  functions  that  use  any  other  approach  for  parsing  arguments  should  almost  never  be  converted  to  argument  clinic  using  optional  groups
注 释 for  every  optional  group  one  additional  parameter  will  be  passed  into  the  impl  function  representing  the  group
using  real  argument  clinic  converters  instead  of  legacy  converters
下 表显 示了 传 统 转 换 器 映 射到 实参转 换 器的 情 况
左 边 是 传 统 转换 器右边是 要 替换 它的 文本
pybuffer
advanced  converters
parameter  default  values
the  null  default  value
expressions  specified  as  default  values
using  a  return  converter
cloning  existing  functions
calling  python  code
using  a  self  converter
writing  a  custom  converter
writing  a  custom  return  converter
metho  and  methnoargs
tpnew  and  tpinit  functions
changing  and  redirecting  clinics  output
the  ifdef  trick
using  argument  clinic  in  python  files
 将 扩展 模 块 移 植 到 python
对 于将扩 展模 块 移植 到 python 3我 们推 荐 下列资源 supporting  python 3 an  indepth  guide  中 的 migrating  c  extensions  这 一 章这本 书 介 绍了如何从 python 2 迁移 到 python 3包 括 指 导 读者 如何移 植扩 展 模 块
 py 3 c  项目中 的 porting  guide  提供了 有 关支 持 代 码的 指 导性 建 议
 cython 和 cffi  库提供 了对于 python  的 c  api 的 抽象
 扩展大都需 要 进行 重写 以使用 两 者 中的 一个 然后就 可 以通 过 库 来处 理 各 种 python 版 本和 实 现 之 间 的 差异
 用 python 进行 curses  编程
作 者 a
 raymond 发 布版 本2
04摘 要本文档 介绍 了如何 使 用 curses 扩 展模 块 控制 文本 模式 的 显 示
curses  是 什么？
python  的 curses 模块
此 python  模块相 当 简单地 封装 了 curses 提 供的 c  函 数如 果你 已经熟悉在 c  语言 中使用 curses  编程把 这 些知识 转 移的 python 是非常 容易的
 最大 的 差异 在于 python  中的 接 口通过把不 同的 c  函数 合 并 来 让 事情 变得 更简单 比 如 addstr 、 mvaddstr 和 mvwaddstr  三个 c  函数被 并入 addstr 这 一个方法
下 文 中 会 描 述更多 的细 节
本 howto  是 关 于 使 用 curses 和 python 编 写文 本 模式 程 序的 概述
 它并不 被 设 计为一个 curses  api  的完 整指南 如 需完整 指 南 请 参 见 ncurses 的 python 库 指南 章 节和 ncurses  的 c 手 册 页
相对 地 本 howto 将 会 给你 一 些 基 本 思路
 开 始和结 束 curses  应 用程 序
窗口 和面 板
 显 示文字
 属 性和 颜 色
 用 户 输入
c  curses  库提 供了非常 简 单 的 输入 机 制
 python  的 curses 模 块添 加 了一 个 基本的 文本 输 入 控件
 其 他的 库 例如 urwid  拥 有更丰 富的 控 件 集
有 两个方 法 可以从 窗 口获 取 输入 getch 会 刷 新 屏 幕然 后 等待 用户 按键 如果之 前调用 过 echo  还会显 示 所按 的 键
你 还 可以 选 择指定 一个 坐 标 以便 在暂停 之 前让 光 标移动 到那 里
 getkey 将 做同 样的 事 但是 会 把 整 数转 换为 字符串
 每个 字 符 将 返 回 为 长 度 为1个 字 符的 字符串特 殊键 例如 函数键 将 返 回包 含键 名的 较长 字符 串例如 keyup  或 g
 使用 nodelay  窗口 方法 可以 做到 不 等 待 用 户
在 nodelaytrue  之 后 窗 口的 getch  和 getkey  将成为 非阻 塞的
 为 表明 输入 未 就绪 getch 会 返 回 curses
err 值为1 而 getkey 会 引发异 常
 此外 还有 halfdelay 函 数 它 可 被用 来实际 地在 每个 getch 上设置 一个 计时 器 如 果 在指 定 的 延迟 内没 有输 入可 用以 十 分之 一秒 为 单位 curses 将 引发 异常
getch 方法返 回一个整 数 如果数 值在0 到255 之 间它代 表所 按下键的 ascii  码
大 于255的值为 特 殊键 例如 page  up  home 或 方向 键等
 你可 以将返 回的 值与 curses
keyppage  curses
keyhome 或 curses
keyleft  等常量 做比 较
你 的程 序 主 循环 看 起 来 可能 是这 样 while  true  c  stdscr
keyhome  x  y 0 curses
ascii 模 块提 供了一 些 ascii 类成员 函数 它 们接受 整 数或 长度 为1个 字符 的字 符串 参 数 这 些 函 数 在为这样 的 循环 编写 更具 可读性 的 测 试时 可能 会很 有 用
 它 还 提供 了 一些 转 换函数 它们 接受 整数 或长度 为1个 字 符的 字 符 串 参 数 并 返回 同 样 的类型
 例 如 curses
ctrl  返 回与 其参数 相对应 的控 制字符
还有 一 个可 以提 取整 个 字 符串 的方 法 getstr
它并 不经常被 使 用因 为它的 功能相 当受限 可用的 编辑 键只有 backspace 和 enter  键它们 会结束字 符 串
也可以 选择 限 制为 固定数量 的字符
getstr 0015 curses
textpad  模 块提供 了一个文 本 框它 支持类 似 emacs 的键 绑定 集
textbox 类的各种 方法支持 带输入 验证的编 辑及 包含或不 包含 末尾 空格 地收 集编 辑结 果
 下 面 是一 个例子 import  curses  from  curses
gather  请查 看 curses
textpad 的 库文档 了解更 多细 节
更 多 的 信息
 描述器 使 用指 南
作 者 raymond  hettinger  联系 方 式 python  at  rcn  dot  com  目 录描述器 使用 指南 primer  simple  example  a  descriptor  that  returns  a  constant  dynamic  lookups  managed  attributes  customized  names  closing  thoughts  complete  practical  example  validator  class  custom  validators  practical  use  technical  tutorial 摘 要 definition  and  introduction  descriptor  protocol  overview  of  descriptor  invocation  invocation  from  an  instance  invocation  from  a  class  invocation  from  super  summary  of  invocation  logic  automatic  name  notification  orm  example  pure  python  equivalents 属性 functions  and  methods  static  methods  class  methods  member  objects  and  slotsdescriptors  let  objects  customize  attribute  lookup  storage  anddeletion
primer
simple  example  a  descriptor  that  returns  a  constant
dynamic  lookups
managed  attributes
customized  names
closing  thoughts
complete  practical  example
validator  class
custom  validators
practical  use
technical  tutorial
摘 要
学习 描述 器不 仅能 提 供接 触到 更 多 工具集 的方 法 还能 更深 地理 解 python  工 作的原 理并 更加 体会 到其 设计的优 雅 性
definition  and  introduction
descriptor  protocol
deleteself  obj  none 以上 就是 全 部
 定 义这些 方法中 的任 何一个 的 对象被视为 描 述器 并在被 作为属性 时覆 盖其 默 认 行 为
 如 果一 个 对象定 义了 set  或 delete 则它会 被视为数据 描 述器
 仅 定 义了 get 的 描 述器 称 为非 数据 描 述 器它 们通 常被 用于 方法 但 也 可以有 其他 用 途
 数 据和非 数据描 述器 的不同 之处 在于如何计 算实例字典 中 条目 的替代 值
如果 实例 的字典 具有 与数 据描述 器 同名的 条目 则 数据描述 器优 先
如果 实例 的 字典 具 有 与非 数据描述 器同名 的条 目则 该字 典条 目优 先
为 了使数据描述 器成 为只读 的 应 该同 时定义 get  和 set  并在 set  中引发 attributeerror 
 用 引 发异常 的占 位符 定 义 set 方法 使 其成为数据 描 述器
overview  of  descriptor  invocation
invocation  from  an  instance
invocation  from  a  class
invocation  from  super
summary  of  invocation  logic
要 记住的重要 点是 descriptors  are  invoked  by  the  getattribute  method
automatic  name  notification
orm  example
pure  python  equivalents
 属 性
 itssignature  is  propertyfgetnone  fsetnone  fdelnone  docnone  property 该文档 显示了 定义托 管 属性 x  的典型 用法 class  c  def  getxself  return  self
 要了 解 property  如 何根据 描 述器 协议 实现 这里 是一 个 纯 python  的等价 实 现如下 class  property  emulate  pypropertytype  in  objectsdescrobject
doc  这 个内 置的 property 每 当用 户访问 属性时生 效 随后的变 化 需要一个 方法 的参 与
 例如 一 个 电子表格 类可以通 过 cellb 10
value 授予 对 单 元格值 的 访 问权限
 对程 序的 后续改 进 要 求 每次 访问 都要 重新 计算 单元 格但是程 序员 不希望 影响 直接 访 问该属 性 的 现 有 客户端 代 码
 解 决 方案是 将对 value 属性 的 访问 包装在 属性 数据描 述器中 class  cell 
functions  and  methods
python  的面向对象 功 能是 在基于 函 数 的环境构 建的
 通 过使 用非 数 据 描述 器这 两 方 面完 成 了无 缝 融合
static  methods
非 数据 描 述 器 为 把 函数 绑 定 为方法 的 通常 模式 提供了一 种 简单 的机 制
下 表 总 结 了绑定 及 其 两个 最 有用 的 变体转换 形式 called  from  an  object  called  from  a  class  函数 fobj  args  fargs 静 态 方 法 fargs  fargs  类方 法 ftypeobj  args  fcls  args  静 态方 法返 回底 层 函 数不做任 何更 改
 调 用 c
f 或 c
f  等效 于通 过 object
getattributec  f  或 object
getattributec  f 查 找
这 样 该 函数就可 以从 对象或 类中进行相 同的 访问
 适合 于作为 静 态 方法 的是那 些 不引 用 self 变 量的 方法
 例 如 一 个统 计用 的 包 可 能 包含一 个实验 数据 的 容器 类
该 容 器 类 提 供了 用于计 算数 据的 平均 值均 值 中位 数 和 其 他描 述性统 计 信息 的常 规 方法
 但 是可 能 有在 概念 上相 关但 不 依 赖 于数 据 的 函 数
 例 如 erfx 是在 统计 中的 便捷 转换但并 不直接依 赖 于特 定的 数 据集
 可以 从 对象 或类 中调用 它 s
5
9332或 sample
f 33 使用非数 据描述 器 纯 python  版本 的 staticmethod 如 下 所示 class  staticmethod  emulate  pystaticmethodtype  in  objectsfuncobject
class  methods
 与 静 态方 法 不 同 类 方 法 在调 用 函 数 之 前 将 类 引 用放 在 参数列表 的最 前
 无 论 调 用方 是对 象还 是 类此 格式 相 同 class  f  classmethod  def  fcls  x  return  cls
c  d  cls  for  key  in  iterable  dkey  value  return  d  现 在 可 以这 样 构 造 一 个 新的唯一 键 字典 dict
fromkeysabracadabra  a  none  r  none  b  none  c  none  d  none  使用 非数 据 描述 符协 议 纯 python  版本 的 classmethod  如下 class  classmethod  emulate  pyclassmethodtype  in  objectsfuncobject
member  objects  and  slots
 函数 式编程 指引
 概述
 形式 证明
 一 个理 论上 的优点 是构 造 数 学证 明来 说明 函数式 程序 是正 确的 相 对 更容 易些
 很 长 时 间 研 究者 们对 寻找 证 明程 序正确 的数 学 方法 都很 感兴 趣
 这 和通过大 量 输入 来测 试并 得 出程 序的输 出基 本 正确 或 者阅 读一个 程序 的源 代码然 后得 出 代码看 起来 没问 题不 同相反 这里 的目标 是一 个严 格的 证明证 明程序 对 所 有 可能的 输 入都能 给出 正确的 结果
证明 程 序正确性 所用 到的 技术 是 写 出不变 量 也就 是对于 输入 数据 和程 序 中的 变 量永远为 真的特 性
然 后对 每行代 码你说 明这行代 码执行前的 不变量 x  和 y 以 及 执行后稍 有 不同的 不变量 x  和 y 为真
 如此 一 直到 程序结 束这 时候 在 程 序的输出 上不变 量 应该 会 与期望 的状态 一 致
函 数式 编程之 所以 要 消除赋值 是 因为 赋 值在 这个技 术中 难以 处理赋值 可能 会破 坏 赋值前 为 真的 不变 量却并 不 产生 任 何可以传 递 下 去的 新的不 变 量
不幸 的是 证明 程序的正 确性很大 程 度上 是 经 验性 质的而且 和 python  软件无 关
 即 使是 微 不足道 的程 序 都需 要几页 长的 证 明一 个中等复 杂的 程序 的 正 确性证 明会 非 常 庞 大而 且极 少甚 至 没 有你 日 常 所使 用的 程序 python 解 释器 xml  解析 器 浏 览器 的正 确性 能够 被 证明
即使 你 写出或 者生 成 一 个 证 明 验证 证明也 会是 一个 问题 里 面 可能出 了差 错而 你错 误 地相 信你 证明了 程序 的正 确性
 模块化
 易于调试 和测 试
测试和调 试函 数式 程 序相对 来说 更 容易
 调试 很简单是 因 为函 数通常 都很小而 且清 晰 明确
 当程 序 无法 工作的 时 候每 个函数 都 是一 个可 以检 查数据 是否 正 确的 接 入点
 你可 以通过 查 看中 间输入 和输 出迅 速找 到出错 的函数
 测试 更容 易 是 因为 每个 函 数都是 单元测 试 的 潜在 目 标
在执行 测试 前函数并 不 依赖 于 需要重 现的系统 状 态相反 你只需 要 给出正确 的输 入然 后检查 输出是否 和 期望 的结 果 一 致
 组 合性
当 你 编 写 函数 式风 格 的程 序 时 你 会写出 很 多带有 不同输 入和 输出 的 函 数
 其中一 些 不 可 避免 地会 局限 于特 定的应 用但 其他的却 可 以广泛 的用 在 程序 中
举 例来 说一 个 接受 文 件夹目 录返回 所 有文件夹 中的 xml  文件的函数 或是 一个 接受文 件名 然后 返回文 件 内容 的函数都 可以应 用 在很 多 不同 的场合
久而 久 之你会 形成一个 个人工具 库
 通 常你可以 重 新组 织已 有的 函数来组 成新的 程序然 后为 当前 的工 作写一 些 特殊的函 数
迭 代器
支持迭 代 器的 数据 类型
 我 们已经知 道列 表和 元组 支持 迭代 器
实际 上 python  中的任何 序列 类型比如字 符 串都 自动 支 持创 建 迭代器
 对字典调 用 iter 会 返回一 个 遍历 字典 的键的 迭代器 m  jan 1 feb 2 mar 3 apr 4 may 5 jun 6
 printkey  mkey  jan 1 feb 2 mar 3 apr 4 may 5 jun 6 jul 7 aug 8 sep 9 oct 10 nov 11 dec 12注 意从 python 3
7 开始字典的 遍 历顺 序一 定和 输 入顺 序一 样
先前 的 版 本并 没有明 确 这 一点所以 不同的 实现 可能 不一 致
 对字典使 用 iter  总 是 会遍 历 键但字典 也有返回其 他 迭代 器的 方 法
 如 果你只 遍 历值 或者键 值 对你 可以明确 地调用 values  或 items 方 法得 到合适的 迭 代 器
dict 构 造函 数可 以 接受 一个 迭代 器然 后返回一 个有 限的 key  value 元 组 的 数据 流 l  italy  rome  france  paris  us  washington  dc  dictiterlitaly  rome  france  paris  us  washington  dc 文 件也 可 以通 过调 用 readline 来遍 历 直 到穷 尽文件 中 所 有的 行
这 意味 着你可 以 像 这 样读 取文件 中 的 每 一行 for  line  in  file  do  something  for  each  line 
 集 合可以 从可遍历 的对象 获 取 内容 也可 以 让 你遍 历集 合的元 素 s 23571113 for  i  in  s  printi
生 成器 表达 式 和 列表 推 导式
 迭 代器 的输出有两 个 很常 见的 使用方 式1对 每一 个 元 素执 行操 作2选 择一 个 符 合条 件的元素 子集
 比如给定一 个 字符 串列 表 你 可能 想去 掉每个 字符 串尾 部 的 空白 字符或是 选 出 所有包含给 定 子串的 字符 串
列表 推导式 和 生成 器表 达 时 简 写 listcomps 和 genexps 让这 些操作 更加简明 这个 形 式借 鉴 自函 数式 程序 语 言 haskellhttpswww
org
你 可以 用以 下 代 码去 掉一个 字 符 串流中 的 所有 空白 字符 linelist  line 1 n  line 2 n 
strip  for  line  in  linelist  你 可 以加上 条 件语 句 if 来 选取 特定的元 素 strippedlist  line
strip  for  line  in  linelist  if  line 通 过列 表推导 式你 会获得 一 个 python 列 表 strippedlist  就是一个 包 含所 有结果 行 的 列 表 并不是 迭 代 器
生 成器 表达 式会返回 一个 迭代器 它 在必 要 的时候 计算 结果 避 免 一次 性生成 所有 的值
 这意 味着如果 迭 代器返 回一个 无限 数据流 或 者大 量 的数据列 表 推导 式就 不太好 用 了
 这种情 况 下 生成 器表 达式 会更受青 睐
 生 成器表 达 式两 边 使用圆 括号 而列 表 推 导式 则使用 方括 号
生 成器 表达 式的 形式 为 expression  for  expr  in  sequence 1 if  condition 1 for  expr 2 in  sequence 2 if  condition 2 for  expr 3 in  sequence 3
 if  condition 3 for  exprn  in  sequencen  if  conditionn 再 次说 明列表推 导 式只有 两 边的 括号 不一 样 方括 号而 不是圆 括 号
 这些 生成用 于 输 出的元素 会 成为 expression 的 后继 值
其中 if 语 句 是可 选的 如果给 定的 话 expression  只会 在符 合条 件时 计 算并 加入 到 结 果中
 生成器 表达式总是 写在圆 括 号 里面 不过也可 以算上 调 用函数 时用 的括 号
 如果 你想即 时 创建一个 传 递给 函数的 迭代 器可 以这么 写 objtotal  sumobj
count  for  obj  in  listallobjects 其中 for
in  语句包 含了 将要遍历 的序列
这些 序 列 并不必 须 同 样长因为 它们 会从左往 右开 始遍历 而 不是同时 执 行
对每 个 sequence 1中的元 素 sequence 2 会 从 头开 始 遍 历
sequence 3 会 对每 个 sequence 1 和 sequence 2的 元素 对 开始遍 历
 换 句话 说列 表 推导 式 器是和 下 面 的 python 代 码等 价 for  expr 1 in  sequence 1 if  not  condition 1 continue  skip  this  element  for  expr 2 in  sequence 2 if  not  condition 2 continue  skip  this  element 
这说 明 如果有多 个 for
in  语 句而没 有 if 语句输 出 结果的长 度 就是所有 序列长 度的 乘 积
如果你 的两个列 表长度为3 那么 输出 的列表长 度就是9 seq 1 abc  seq 2123 x  y  for  x  in  seq 1 for  y  in  seq 2 a 1 a 2 a 3 b 1 b 2 b 3 c 1 c 2 c 3为 了不 让 python 语法变 得含糊 如果 expression  会 生 成元 组那这 个元 组必须要 用 括号括起来
 下面 第一个列 表推 导式 语法 错误 第 二 个则 是 正确 的 syntax  error  x  y  for  x  in  seq 1 for  y  in  seq 2 correct  x  y  for  x  in  seq 1 for  y  in  seq 2
生 成器
 向生 成器 传递 值
内置函 数
itertools 模块
itertools 模 块 包 含很 多常用 的迭 代器 以及用 来组合 迭 代器的 函数
 本 节 会用 些小 的例子 来 介绍 这 个模 块的 内容
 这 个模块里 的 函数 大致可 以 分为 几类从 已有 的迭 代器 创建 新的迭代器 的 函 数
接受 迭 代器元 素作 为参 数的 函数
选取 部分 迭代器 输出的 函数
 给迭 代 器输出 分组的函 数
创建 新的 迭代器
countstart  step  返 回 一 个等 分的 无限 数据 流
 初始值 默认 为0间 隔默 认 为1 你 也选择 可 以指 定初 始值和间 隔 itertools
cycleiter 保存一份 所提 供的 可 迭代 对象的副本 并返回 一个 能产 生 整个 可迭 代 对象 序 列的 新 迭代器
新 迭代器会 无限 重复 这 些元 素
 itertools
repeatelem  n 返 回 n 次 所 提供 的 元素 当 n 不 存在 时 返回 无数次 所 提 供的 元 素
接受任 意 数量 的可 迭代 对象作为 输入首 先返回 第一 个迭 代器 的 所有元 素然 后是第二 个的 所 有 元 素如 此一 直进行下 去直 到 消 耗 掉所 有输 入的 可迭 代对 象
isliceiter  start  stop  step 返 回一 个 所输 入 的迭代器 切 片 的数 据流
如 果只 单独 给定 stop  参数的 话它会 返 回 从起 始算 起 stop 个数 量的 元素
 如果你 提供 了起 始 下 标 start 你 会得 到 stopstart  个 元 素如 果你 给定 了 step 参数 数据流会跳 过相 应的 元素
 和 python 里 的字 符串 和列 表切 片 不同 你不 能 在 start  stop 或 者 step 这些 参数 中使 用 负数
 itertools
teeiter  n 可以 复 制 一 个迭代 器它 返 回 n 个 能够 返 回 源迭 代器内 容的独立迭 代器
 如果 你不 提供 参数 n 默 认值为2
 复制 迭 代器 需 要 保 存源迭 代器 的一 部分 内容 因此在 源 迭 代器 比 较大 的时 候会 显著 地 占用 内 存同 时在 所有 新迭 代器中 有 一个 迭代 器会 比其他 迭 代 器占 用 更多 的 内存
 对 元素 使用 函 数
operator 模 块包 含 一组 对应 于 python 操 作 符的 函 数
比 如 operator
adda  b  把两 个数 加起 来 operator
nea  b  和 a  b  相 同以 及 operator
attrgetterid 返回获 取
id  属性 的可 调用对象
starmapfunc  iter  假 定可迭代 对 象能够 返回一个 元 组的流并 且 利 用这 些 元 组作 为 参 数来 调用 func  itertools
 选 择元素
 另 外一 系列 函数 根据谓 词 选 取 一 个迭代 器中元素 的子 集
filterfalsepredicate  iter 和 filter 相反返 回 所有 让 predicate  返回 false  的 元素 itertools
takewhilepredicate  iter  返回 一直 让 predicate 返 回 true  的元素
一 旦 predicate 返 回 false  迭代 器就 会发 出终 止结果 的 信号
 def  lessthan 10 x  return  x 10 itertools
dropwhilepredicate  iter 在 predicate  返回 true 的 时候 丢 弃元 素 并且 返回 可迭代 对象 的 剩 余 结果
 itertools
compressdata  selectors  接 受 两 个迭 代器然 后返回 data  中使 相 应地 selector  中的元 素为 真的 元 素它会 在 任一 个 迭代 器耗 尽的时 候停止 itertools
组 合函数
itertools
combinationsiterable  r  返 回一个 迭代器 它能 给出输 入迭 代器 中所包 含的 元 素 的所有可 能 的 r 元 元组的 组 合
 itertools
combinations 123453123124125134135145234235245345每 个元组 中的 元素保 持着 可迭 代对 象 返 回他 们 的 顺序
 例 如在 上 面 的例 子中数字1 总是 会在234 或5 前面
 一 个类似 的函 数 itertools
permutationsiterable  rnone 取 消 了 保持 顺 序的 限制返回 所 有 可能 的长 度为 r  的排 列 itertools
54321 如果 你 不提 供 r 参数 的 值 它会 使 用 可迭 代对 象的 长度也 就是 说 会排 列所 有 的元 素
 注意 这些函 数 会输 出所 有 可 能的 位 置 组合 并 不要 求可迭 代对 象的 内 容不 重复 itertools
permutationsaba 3 a  b  a  a  a  b  b  a  a  b  a  a  a  a  b  a  b  a 同一个 元 组 a  a  b  出 现 了 两 次 但是 两个 a  字 符来 自 不 同的 位 置
itertools
combinationswithreplacementiterable  r  函 数 放松 了 一 个不 同的 限制元组 中的 元 素 可以 重 复
从 概念 讲为 每个 元组 第一 个位 置选 取一 个元 素然 后 在选 择第 二 个 元素前 替 换 掉它
 itertools
为元 素 分组
 我 要讨 论 的最 后一 个函 数 itertools
groupbyiterkeyfuncnone 是 最 复 杂的函数
 keyfuncelem 是 一个 可 以对 迭代 器返 回的 每 个元 素计算 键值的 函 数
 如果 你不 提供 这个 键 值函 数它 就 会简 化成 每个 元素 自身
groupby  从所 依据 的 可迭 代对 象 中 连续地收 集 具有 相同 值 的元 素然后 返回 一个长 度为2 的元组 的数 据 流 每个 元 组 包含键 值以 及 对应这 个 键 值的 元素 所 组 成的 迭代 器
 where  iterator 1 decatur  al  huntsville  al  selma  al  iterator 2 anchorage  ak  nome  ak  iterator 3 flagstaff  az  phoenix  az  tucson  azgroupby  假 定 了所依据 的可 迭 代 对 象的内容 已 经根 据键值 排 序
 注 意 返回 的 迭 代器 也 会 使用 所 依 据 的可 迭代 对 象所 以 在请 求迭 代 器2 和 相 应的 键 之 前你 必须 先 消 耗 迭代 器1的 结果
functools  模 块
python 2
5中 的 functools  模 块包 含了 一 些高 阶函 数
 高阶函 数 接受 一个或多 个 函 数作 为 输入 返 回 新的 函数
这个模 块中 最有 用的 工 具 是 functools
partial 函 数
 对于 用函 数式 风格编 写的程 序有 时 你会 希 望通过 给 定 部分 参 数将 已有 的函 数 构 变 形称新 的函 数
考 虑一 个 python 函数 fa  b  c  你 希 望创 建一 个 和 f 1 b  c 等 价的新函 数 gb  c 也 就 是 说 你给 定了 f  的一 个 参 数 的 值
这就 是 所谓 的部分 函数 应用
partial  接受 参数 function  arg 1 arg 2
 kwarg 1 value 1 kwarg 2 value 2
 它会 返 回 一个可 调 用的 对象 所以 你能 够直接 调用 这个结果 以使用 给定 参数的 function
这 里有 一 个很 小 但 很 现实的例 子 import  functools  def  logmessage  subsystem  write  the  contents  of  message  to  the  specified  subsystem
reducefunc  iter  initialvalue 持 续 地在可迭 代对 象 的所 有元 素上 执行 操作 因此 它不 能够 用在 无限的 可迭 代 对 象 上
func 必 须 是 一 个接 受 两个 元 素 并 返回 一个 值的 函数
functools
reduce  接 受 迭代 器 返 回 的前 两个元素 a  和 b  并计算 funca  b 
 然后 它会 请 求 第 三个 元素 c  计 算 funcfunca  b  c  然 后把 这个 结 果 再和 第 四个 元素 组合 并 返 回如 此继 续下 去直 到消 耗 整 个可 迭 代对 象
如 果 输入 的 可 迭 代对 象 完 全不 返回 任 何 值 typeerror 异 常 就 会 抛出
 如果 提供 了初 值 initial  value 它 会 被 用作 起始 值也 就是先计 算 funcinitialvalue  a 
 import  operator  functools  functools
mul 11 如 果 你 在 functools
reduce 中 使用 operator
add  你就 会把 可迭 代对 象 中 的所 有 元素 加 起来
这 种情况 非 常常见所以 python 有一 个特 殊的 内 置函 数 sum  import  functools  operator  functools
add 1234010 sum 123410 sum 0不过 对 于很 多使 用 functools
reduce  的情 形使 用明 显 的 for 循 环 会 更清晰 import  functools  instead  of  product  functools
mul 1231 you  can  write  product 1 for  i  in 123 product  i  一 个相 关的 函数 是 itertools
accumulateiterable  funcoperator
它 执 行 同样 的 计 算不 过 相对 于只 返 回最 终结 果 accumulate 会 返回 一 个迭 代 器来 输出所 有 中间 结果 itertools
operator 模块
 前 面已经提 到了 operator  模块
 它包 含一系 列 对 应于 python 操作 符的 函 数
在 函数式 风 格 的代 码中这些 函数通常很有用 可 以帮你 省下 不少 时间 避 免 写一 些琐 碎 的仅 仅 执行一 个 简 单 操作的 函数
 这个 模块 里 的 一 些函数 数 学 运 算 addsubmulfloordivabs 
逻辑 运 算 nottruth
位运 算 andorinvert
 比较 eqneltlegt 和 ge
 确认对象 isisnot
 全部函数 列表可以 参考 operator 模块 的文档
小 函 数和 lambda 表 达式
编写 函数式风格 程序 时你会 经 常 需要很小的 函 数作 为谓 词函数或者以 某种 方式 来组 合 元 素
如 果 合适的 python  内 置的或 者其他 模块中的 函 数你就 一点 也不需 要 定 义新的 函 数 strippedlines  line
exists  filelist  如 果 不存在你 需 要的函 数你 就必须 自己 编 写
一 个编写 小 函 数 的 方式是 使 用 lambda 表 达式
lambda  接受 一 组参 数以及 组 合这 些 参数 的 表达式 它会 创 建一 个返回 表 达式 值的 匿名函数 adder  lambda  x  y  xy  printassign  lambda  name  value  name  strvalue 另 一种 替代方 案就 是通常 的使 用 def 语 句 来 定义函 数 def  adderx  y  return  x  y  def  printassignname  value  return  name  strvalue 哪 一种 更受 青 睐 呢？这 是一个 风格 问题 我 通 常 的 做法是避免使 用 lambda
 我 这么 偏好 的 一 个原 因 是 lambda  能 够 定 义的 函数 非常受 限
函 数的 结果必 须能够 作为单 独 的表 达式 来 计算 这意 味着你 不能 使用多路 if
else 比 较或者 try
 except  语 句
如 果你尝 试 在 lambda 语 句中做太多事 情 你 最终 会把表 达式 过于复杂 以 至 于难以阅读
你 能快速的 说出下 面的代 码做 了什么 事情 吗？ import  functools  total  functools
reducelambda  a  b 0 a 1 b 1 items 1你 可以弄 明白不 过 要 花上时 间 来 理清表 达式 来 搞 清楚发生了 什么
 使用一 个简 短的 嵌套 的 def 语句 可以 让 情 况变得 更好 import  functools  def  combinea  b  return 0 a 1 b 1 total  functools
reducecombine  items 1如果我 仅仅 使用 一 个 for 循环会更 好 total 0 for  a  b  in  items  total  b 或者 使 用内 置的 sum  和 一个生成器表 达 式 total  sumb  for  a  b  in  items 许多 使用 functools
reduce  的 情形 可以 更清 晰地 写成 for  循环 的 形 式
fredrik  lundh 曾经建 议以下 一 组规则 来重构 lambda  的使 用1
写一 个 lambda  函数
写 一句 注 释来说 明这 个 lambda 究 竟干 了什 么
研究一会 这个注 释然后 想 出一个 抓住注释本 质的 名 字
用 这 个名 字把 这 个 lambda 改 写 成 def 语 句
把注释去 掉
我非常 喜欢这 些 规 则不过 你 完全 有权 利争 辩这 种消 除 lambda  的 风格是 不是 更好
 修订 记录和 致谢
 作者要 感 谢以下 人员 对本文 各种 草稿 给予的 建 议更正 和协 助 ianbickingnick  coghlan  nick  efford  raymond  hettinger  jim  jewett  mikekrellleandro  lameiro  jussi  salmela  collin  winter  blake  winton
0
1 版2006 年6 月30 日 发布
0
11 版2006年7月1日发 布
修 正拼写错 误
0
2版2006年7月10日 发布
 将 genexp 与 listcomp  两节 合二为一
 修正拼写 错误
0
21 版 加入 了 tutor 邮件 列表中建 议的 更多 参 考文 件
0
30 版 添加了 有关 functional 模 块 的小 节 由 collin  winter 撰 写添 加了 有关 operator 模块 的简 短小节其 他 少量 修 改
引 用文献
 通用 文献
structure  and  interpretation  of  computer  programs  harold  abelsongerald  jay  sussman  和 julie  sussman 著
 全文 可见 httpsmitpress
edusicp 
 在这 部 计算 机科 学 的 经 典教科 书中第 二和 第三 章讨 论 了使 用序 列和流 来组 织程 序内部 的 数据传 递
书中 的 示例 采用 scheme 语 言但其中 这些 章节 中描 述的 很多 设 计 方 法同 样适用于 函数 式风 格 的 python 代码
html 一个使 用 java 示例 的函 数式 编程 的总 体介绍有 很长 的历 史 说 明
orgwikifunctionalprogramming 一 般 性的函数 式 编程 的 wikipedia 条 目
orgwikicoroutine  协程 条目
orgwikicurrying  函 数 柯里 化条目
python 相 关
cxtpipdavid  mertz  书中 的 第 一章 text  processing  inpythonutilizing  higherorder  functions  in  text  processing 标 题部分 讨论 了文 本处 理的函 数式 编程
mertz 还在 ibm  的 developerworks 站 点上 针对 函数式 编程 撰 写了一 系列共3篇 文 章 参 见 part 1 part 2和 part 3
python  文档
itertools  模块 文档
functools  模块文档
operator  模 块 文档
pep 289 generator  expressionspep 342 coroutines  via  enhanced  generators  描述 了 python 2
5中 新 的生成器 特 性
python 常用 指引
python  常用指引 的 形 式来 源于 linux  文 档项 目的常用 指引 章节 是一系列独 立、指定 主题 并尝 试 完全覆 盖 该 主 题的 文章集 合
致力于 提供比 python 库参 考 帮助 更 详尽的 文 档
目 前 提供 了 如下 指引 将 python 2代码 迁移 到 python 3将 扩展 模块 移植到 python 3用 python  进行 curses  编 程描 述器使用 指 南函 数式 编程 指 引 日志 howto  日志操作 手册 正 则 表达式 howto  套接字 编 程指南 排序 指南 unicode  指南 howto  使用 urllib 包获 取网 络资源 argparse 教 程 ipaddress 模块 介 绍 argument  clinic  howto 使 用 dtrace  和 systemtap  检 测 cpython
 使用 dtrace  和 systemtap 检测 cpython
作 者 david  malcolm  作 者ł ukasz  langadtrace 和 systemtap  是 监 控工 具它 们 都 提 供 了 一种 检 查计 算机系 统上 的进程的 方 法
它们 都使 用特 定 领域的 语 言 允许 用 户 编 写脚 本 其 中进 程监 视的 过滤器从感 兴趣 的进程 中收 集数 据生成有 关数据 的报告 从 python 3
6开 始 cpython  可 以使 用 嵌 入 式标记 构 建 也 称为 探 测器 可以通 过 dtrace 或 systemtap  脚本 观察 从 而 更 容 易 监视 系 统上 的 cpython  进 程正在 做 什 么
cpython  implementation  detail  dtrace  标记 是 cpython 解 释 器 的 实现 细 节
 不 保 证 cpython 版 本之 间 的探 针兼容性
 更改 cpython 版本 时 dtrace  脚本 可 能 会 停止 工 作 或 无法正 常工 作 而不 会 发出 警 告
 启用 静态 标记
macos  内 置 了对 dtrace 的支 持
在 linux  上为 了 使用 systemtap  的 嵌 入 式 标 记构 建 cpython 必 须安装 systemtap 开 发 工 具
在 linux  机器上 这 可以通过 yum  install  systemtapsdtdevel  或者 sudo  aptget  install  systemtapsdtdev  然后 必须 将 cpython  配置 为 withdtrace  checking  for  withdtrace
 yes 在 macos 上您 可以 通过在 后台 运 行 python  进程 列出可 用的 dtrace  探测 器并 列出 python 程 序提供 的 所 有探 测器 python 3
6 maybedtraceline  line  在 linux 上 您 可 以 通过 查看 是否 包 含
stapsdt 部分 来验 证构 建的 二 进制 文件 中是否 存在 systemtap 静 态 标 记
stapsdt  note 000000000000000000308 d 78如 果您 已将 python  构 建 为 共享 库使 用 enableshared 则 需 要在共 享库 中查 找
例 如 readelf  s  libpython 3
stapsdt  note 000000000000000000365 b 68 足够 现代 的 readelf 命 令 可以打印元 数据 readelf  n 
32 displaying  notes  found  at  file  offset 0 x 00000274 with  length 0 x 00000024 owner  data  size  description  gnu 0 x 00000014 ntgnubuildid  unique  build  id  bitstring  build  id  df 924 a 2 b 08 a 7 e 89 f 6 e 11251 d 4602022977 af 2670 displaying  notes  found  at  file  offset 0 x 002 d 6 c 30 with  length 0 x 00000144 owner  data  size  description  stapsdt 0 x 00000031 ntstapsdt  systemtap  probe  descriptors  provider  python  name  gcstart  location 0 x 00000000004371 c 3 base 0 x 0000000000630 ce 2 semaphore 0 x 00000000008 d 6 bf 6 arguments 4 ebx  stapsdt 0 x 00000030 ntstapsdt  systemtap  probe  descriptors  provider  python  name  gcdone  location 0 x 00000000004374 e 1 base 0 x 0000000000630 ce 2 semaphore 0 x 00000000008 d 6 bf 8 arguments 8 rax  stapsdt 0 x 00000045 ntstapsdt  systemtap  probe  descriptors  provider  python  name  functionentry  location 0 x 000000000053 db 6 c  base 0 x 0000000000630 ce 2 semaphore 0 x 00000000008 d 6 be 8 arguments 8 rbp 8 r 124 eax  stapsdt 0 x 00000046 ntstapsdt  systemtap  probe  descriptors  provider  python  name  functionreturn  location 0 x 000000000053 dba 8 base 0 x 0000000000630 ce 2 semaphore 0 x 00000000008 d 6 bea  arguments 8 rbp 8 r 124 eax  上 述元 数据 包 含 systemtap 的 信息描述 如何 修补 策略 性放 置 的 机器代 码指令 以 启 用 systemtap 脚 本 使 用的 跟踪钩子
 静态 dtrace  探 针
静 态 systemtap  标 记
 使用 systemtap  集成的底 层方 法是 直接 使用 静态 标 记
这需 要 你显 式地 说 明包含 它 们 的二 进制 文 件
 例如 这个 systemtap  脚 本可 以 用 来 显示 python 脚 本 的调用 返回层 次 结 构 probe  processpython
markfunctionreturn  filename  userstringarg 1 funcname  userstringarg 2 lineno  arg 3 printfs  s  in  sdn  threadindent 1 funcname  filename  lineno  它可 以这样调 用 stap  showcallhierarchy
py  输 出 结 果会 像 这 样11408 python 8274 contains  in  libabcoll
py 366其中的列 是脚 本开 始 后 经 过的微秒 数 可执 行文件的 名字进程 的 pid  其余部 分则 表示脚本 执行 时 的 调 用返 回 层 次结 构
对 于 enableshared  构 建 的 cpython  来 说 这 些 标记是包 含 在 libpython 共 享库 中的探 针 的 点状 路 径 需要 反 映 这 一点
比 如上面 例子 中的 这一行 probe  processpython
markfunctionentry 应 改为 probe  processpython
markfunctionentry  假 设 是 cpython 3
6的 调试构 建
 可 用的静 态标 记
systemtap  tapsets
 示 例
ipaddress 模 块 介 绍
作 者 peter  moody 作 者 nick  coghlan  概 述 本 文档旨在简 要介 绍 ipaddress 模块
 它主 要针 对那 些 不 熟 悉 ip  网 络 术 语 的用 户 但也 可能对 想要 速览 ipaddress  如何代 表 ip 网络 寻址 概念的网 络 工程 师有 用
创 建 addressnetworkinterface 对 象
因为 ipaddress 是 一个 用于检 查 和操作 ip 地址 的模 块 你要做的第 一 件 事就 是创 建一 些 对 象
您 可以 使 用 ipaddress 从字 符 串 和整数 创建 对 象
 关于 ip 版本的 说明
 对于 不 太熟 悉 ip 寻 址 的读者重要 的 是要知 道 internet  协议 当前 正在从 协议的版本4 转移到 版本6
 转换很大程度 上 是 因 为协 议 的 版 本4 没有提 供 足够的地 址 来满 足整 个 世界的需 求 特 别是 考虑 到越 来 越 多 的设 备直 接连 接 到互联网
 解 释协议 的 两 个版本之间 的差 异的 细节 超 出了 本介绍 的范 围但 读者 需要 至少 知道 存 在 这两 个版本 并且 有时 需 要强 制使 用一 个版本 或其 他 版 本
ip 主机 地址
定 义网络
 主机地址 通常 组合 在 一起形成 ip  网络 因此 ipaddress  提供了 一种 创 建、 检 查和 操 作 网 络 定 义 的 方 法
 ip  网 络对 象由字符串 构成 这 些字符 串定 义作 为该 网络一 部 分 的主 机地 址 范 围
该 信 息的最 简单 形式 是 网络 地 址网 络前缀 对 其中前 缀定 义了比 较的 前导比 特数 以确定 地 址是 否 是网 络 的 一 部 分 并 且 网 络地 址定义 了那些位 的预 期 值
 对于地址 提供了一 个自 动 确定 正 确 ip  版 本 的 工厂 函数 ipaddress
ipnetwork 2001 db 8096 ipv 6 network 2001 db 896 网 络对 象不 能 设置 任何 主 机 位
 这样 做的 实际 效果 是192
124 没 有描 述网 络
这 种 定义 被称 为 接 口 对象因为 网络 上 ip 表 示法通常 用于 描述 给定 网 络 上的计算 机 的 网 络接口 并在 下一节中 进 一步 描述
默 认 情 况下 尝试 创建一个 设置 了主 机位的网络 对象 将 导 致 valueerror  被 引 发
要请 求将附加 位强 制为零 可以将 标志 strictfalse 传 递给 构造函数 ipaddress
024虽 然字符串 形式 提供 了更 大的 灵 活 性 但 网 络也 可以 用整 数定 义就 像主 机地址一样
 在这 种情况下网 络 被 认为 只包含由整 数标 识的 单个 地址 因 此 网 络前缀 包括整 个网 络地 址 ipaddress
ipnetwork 42540766411282592856903984951653826560 ipv 6 network 2001 db 8128与地 址 一样 可以 通过 直 接 调用 类构 造函 数而 不是使 用 工厂 函数 来强制创 建特定 类型的 网 络
主机接口
 审 查 addressnetworkinterface 对 象
network  作为 address 列表
将 网 络 视为 列表 有时很 有 用
这意 味着它 可 以 像 这样 索引它们 net 41 ipv 4 address 192
255 net 61 ipv 6 address 2001 db 81 net 61 ipv 6 address 2001 db 8 ffffffff  它 还意 味着 网 络 对象可以 使 用像 这样的 列 表 成 员 测试 语 法 if  address  in  network  do  something 根 据 网络 前缀有 效 地完成 包含性 测 试 addr 4 ipaddress
 比 较
ipaddress 有 意 义 地提供了一 些简 单、 希 望 直观 的比较 对 象的 方法 ipaddress
2 true  如果 你 尝试 比 较不 同 版本 或不 同类 型的对 象 则 会引 发 typeerror  异常
 将 ip  地 址 与其 他 模 块一起 使 用
其 他使 用 ip  地址 的 模 块例 如 socket  通常 不 会直接接受 来自 该 模 块的 对象
 相反 它 们必 须被 强制 转换为 另一 个模块 可接 受的 整数或 字符 串 addr 4 ipaddress
实 例创 建 失 败时获 取更 多详 细信 息
使 用与 版 本无 关 的 工厂 函 数 创 建 addressnetworkinterface  对象 时任 何错 误都将报 告为 valueerror 带 有 一般 错误 消息 只是 说传 入 的 值未 被识 别 为该 类 型 的对象
缺 少特 定错误 是因为 有必 要知 道该 值是 假设是 ipv 4 还是 ipv 6 以便提 供有 关其被 拒绝 原 因的 更 多 详细信 息
为了 支 持 访 问这 些 额 外细 节的用例 各个类 构 造函 数实 际上 引发 了 valueerror 子类 ipaddress
addressvalueerror  和 ipaddress
netmaskvalueerror  以准确 指示 定 义的哪 一部分 无法 正 确解析
 直接使 用 类构 造函数 时错 误 消息更 加详 细
例 如 ipaddress
netmaskvalueerror 64 is  not  a  valid  netmask  但 是 两个 模块特 定的 异 常都 有 valueerror  作 为它 们 的父 类所 以 如果 你 不关 心特定 类 型的 错误 你仍然 可 以 编 写 如 下代 码 try  network  ipaddress
日志操 作 手册
 作者 vinay  sajip  vinaysajip  at  reddove  dot  com  本页 包含 了许 多 日 志 记录相 关 的 概 念这 些 概念 在 过 去一 直被 认为 很有 用
 在 多 个模 块中 使 用 日志
 多 次调 用 logging
getloggersomelogger 时会 返回 对同 一个 logger  对象的 引用
 这 不仅是在同 一个 模块 中在其他 模块调 用也 是 如 此 只 要是在 同一个 python  解释 器 进 程中
 是应该引 用同一 个 对象 此 外应 用程序也可 以在 一个 模 块中 定义和 配置父 logger  而在单独 的模块 中 创建 但不 配置子 logger  对子 logger  的所 有调 用 都将传 给父 logger
 这 里是 主模 块 import  logging  import  auxiliarymodule  create  logger  with  spamapplication  logger  logging
somefunction  这 里是 辅助模块 import  logging  create  logger  modulelogger  logging
inforeceived  a  call  to  somefunction  输 出 结 果会 像这 样20050323234711663 spamapplication  info  creating  an  instance  of  auxiliarymodule
 在 多 线程 中 使 用 日 志
 使 用多 个日志处 理器和 多 种 格式 化
在 多 个地 方记录 日 志
日 志服务 器 配 置 示例
 以 下是在一 个模块 中使 用 日志 服务 器配 置的 示 例 import  logging  import  logging
join  然后如下 的脚 本它 接 收文 件名 做为命 令行 参 数并 将 该文件 以二 进 制 编码 的 方 式传 给 服务 器 做为 新的 日志 服务 器 配置 usrbinenv  python  import  socket  sys  struct  with  opensys
 处理日 志处 理器 的阻 塞
有时 候 需要 让日 志处理 程序 在不 阻 塞 当前正 在记 录线 程 的 情况下 完成 工 作
这在 web 应 用 程序 中 很常 见当 然 也会 在其他 场 景中 出现
 一个 常 见的 缓 慢 行为 是 smtphandler  由于 开发 者无 法 控 制 的多 种原 因例如性 能不佳 的邮件 或网络 基 础架构发 送 电子 邮件 可能 需要 很长时 间
其 实几 乎所 有基于网 络 的处 理程 序都 可能 造成 阻塞 即便 是 sockethandler 也 可能在 底层 进行 dns 查 询这太 慢 了这 个查 询 会深 入至套 接字 代码位 于 python  层 之下 这是 不 受开发 者 控 制的
 一 种解 决 方 案是分 成两 部分去处 理
 第 一部分 针对那些 对 性 能 有要 求的关 键线 程的日 志记 录 附 加一个 queuehandler
 日志记 录器 只 需简 单 写入 队列 该队 列 可以 设 置一个足 够 大 的容 量 甚至 不设 置 容量 上限
 通常 写入 队 列 是 一 个 快 速 的操 作 即使 可能需 要在代码 中去捕 获例 如 queue
full 等异常
 如果 你 是一 名 处 理关 键线程的开 发者 请务 必 记录这 些信 息 包括 建议 只 为日 志处 理器附 加 queuehandlers  以便 于其 他开发者 使用 你的 代码
 解决方 案 的 另一部 分是 queuelistener  它被 设 计用 来作 为 queuehandler 的对 应
 queuelistener  非 常 简单 向 其传入一 个 队 列 和一 些 处理句 柄它会 启动 一个 内部线 程 来 监听 从 queuehandlers 或 任 何其他 可 用的 logrecords 源 发送 过来 的 logrecords  队列
 logrecords 会从队 列中被 移除 并被传递给句 柄 进行 处理
使用一 个单独 的类 queuelistener   优 点是可 以 使 用 同一 个 实例 去 服务于多 个 queuehandlers
 这 样会 更节 省 资源 否则每 个处 理程 序都 占用一 个 线程没 有任 何 益处
 以下 是使 用 了 这样 两个类 的示例 省略了 导 入 语句 que  queue
stop  在 运 行后 会产生 mainthread  look  out 在3
5 版更改 在 python 3
5 之 前 queuelistener 总 是把 从队 列 中接 收的每 个消息 都传 给 它 初始 化 的 日 志处 理程序
这 是因 为它 会假 设过滤 级别总 是 在队 列的 另 一侧 去 设置 的
 从 python 3
5 开 始可以通 过 在监 听器 构 造函 数 中 添加 一 个 参数 respecthandlerleveltrue 改 变这 种情 况
当这样设置 时 监听 器会比较每 条 消息 的 等级 和 日志处 理器 中设置的等级 只把 需要传 递 的 消 息 传 给 对 应的 日 志 处 理 器
 通过 网络 发送 和 接 收 日志
 如果 你 想 在 网络 上 发送 日 志 并在 接收 端处理 它们
 一 个 简单 的 方式 是 通 过 附加 一 个 sockethandler 的 实例在发送端的 根日 志处 理器中 import  logging  logging
 在接收 端 你可以使 用 socketserver 模 块设 置一 个接 收器
 这 里 是 一 个 基础示 例 import  pickle  import  logging  import  logging
serveuntilstopped  if  name  main  main 首先运 行 服 务端 然后是客 户端
 在 客 户 端 没有 什 么内容会 打 印在控 制台中在 服 务端你应 该会看 到 如下 内容 about  to  start  tcp  server
 请 注 意在 某些情况 下序 列 化会 存在 一些 安 全
如 果 这影 响 到 你 那 么 你可 以 通 过 覆 盖 makepickle  方 法使 用 自 己 的 实 现 来解 决并 调 整 上述 脚 本 也使 用 覆盖 后 的序 列化 方 法
 在 日志 记录 中添 加上 下文信息
 使 用日 志适配 器传递 上下 文 信息
使 用 过 滤 器 传 递上 下文 信 息
从多个 进 程记 录至 单个 文件
using  concurrentfuturesprocesspoolexecutor
 轮 换日 志文 件
使 用其 他日 志格式化 方式
 当 日 志模 块 被 添加 至 python  标准 库 时 只有 一 种格式 化 消息内容 的 方 法即 formatting
 在那 之后 python  又 增 加了 两种 格式 化方 法 string
template 在 python 2
4 中新 增和 str
format  在 python 2
6中 新 增
日志 从3
2开始 为 这两 种格式化方 式提 供 了 更多 支持
formatter 类 可以添加 一个额 外的 可 选关 键字 参 数 style
 它的 默认 值是 其他的 值和 也 支 持 对 应了 其他两 种格 式化 样式
其 保 持了 向后 兼容 如 您 所 愿但通过显 示指 定样 式参数 你 可以 指定 格 式 化 字符串 的方 式 是使 用 str
format 或 string
 这里是 一个控 制台 会话 的 示例 展示 了 这 些方 式 import  logging  root  logging
bar  critical  this  is  a  critical  message  请注 意最 终输 出到 日 志 的 消息格式 完全 独立于单 条日志 消息 的 构造 方式
它仍 然可以 使用 formatting  如 下 所示 logger
customizing  logrecord
subclassing  queuehandler  a  zeromq  example
subclassing  queuelistener  a  zeromq  example
makelogrecordmsg  参见 模 块 logging 日 志记录 模块 的 api 参考
 模块 logging
config  日 志记 录 模块的 配置 api 
模块 logging
handlers  日志 记 录模 块附带 的有用处 理程序
an  example  dictionarybased  configuration
using  a  rotator  and  namer  to  customize  log  rotation  processing
a  more  elaborate  multiprocessing  example
inserting  a  bom  into  messages  sent  to  a  sysloghandler
implementing  structured  logging
customizing  handlers  with  dictconfig
using  particular  formatting  styles  throughout  your  application
using  logrecord  factories
using  custom  message  objects
 you  may  recallfrom  使用任 意对 象作 为消息 that  when  logging  you  can  use  an  arbitraryobject  as  a  message  format  string  and  that  the  logging  package  willcall  str  on  that  object  to  get  the  actual  format  string
 considerthe  following  two  classes  class  bracemessage  def  initself  fmt  args  kwargs  self
configuring  filters  with  dictconfig
 as  described  in  访问 外部对 象
 for  example  you  could  have  used  the  text  extmain
myfilter  instead  of  myfilter  in  the  above  example
 see 用 户定 义 对 象 for  more  information  on  how  logging  supports  using  userdefined  objects  in  its  configuration  and  see  the  other  cookbook  recipe  customizing  handlers  with  dictconfig  above
customized  exception  formatting
speaking  logging  messages
 缓冲 日志 消 息并 有条 件地 输出它 们
 在 某 些情 况 下 你可 能 希 望 在 临时 区 域 中记 录日志消 息并且 只在 发生某 种 特 定的情况 下才 输出 它们
 例 如你可 能希 望 起始在函 数中记 录调 试事 件如 果函 数 执行 完成 且没 有错 误你 不 希望输出 收集 的调 试 信息 以避 免造 成日 志混 乱但 如果出 现错误 那 么你希望所 有调 试以 及错 误 消息被 输 出
下 面 是一 个示 例展 示如 何在你的日 志记 录 函数 上使 用 装饰 器以 实 现这一功能
 该示例使用 logging
memoryhandler  它允 许 缓冲 已 记录 的 事件直 到 某些条 件发 生 缓 冲 的事 件才 会 被 刷新 flushed  传递 给另 一个 处理 程序 target  handler  进行 处 理
 默认 情况下 memoryhandler  在 其缓 冲区 被填满 时被刷 新或 者看 到一 个级别 大于 或等于指定阈值 的事件
如 果想要自定 义刷 新 行 为你可以通 过 更专 业 的 memoryhandler  子类 来使 用 这个 秘 诀
这 个 示 例脚本有 一个 简 单的函 数 foo  它 只是 在所有的日 志级 别中循环运 行写 到 sys
stderr 说 明它要 记录在 哪个级别 上然后 在这 个级 别 上 实际记 录一 个消 息
 你 可 以给 foo 传 递 一 个参数如 果 为 true  它将在 error  和 critical 级 别 记录 否则它 只在 debug 、 info 和 warning  级别 记 录
 脚 本 只 是使 用 了一 个 装饰 器 来装 饰 foo  这个 装饰 器将记 录执 行所 需的 条件
 装饰 器 使用 一个记 录 器作 为参数 并在调用 被装饰的 函数期 间附 加一个 内 存处 理程 序
 装 饰器可 以 使 用 目 标处 理程 序、 记录 级别 和缓冲 区 的容量缓 冲 记录 的数 量 来 附加 参数
这些参 数分 别默认 为 写入 sys
stderr  的 streamhandler  logging
error 和100
以 下 是 脚本 import  logging  from  logging
debug  writelinecalling  undecorated  foo  with  false  assert  not  foofalse  writelinecalling  undecorated  foo  with  true  assert  footrue  writelinecalling  decorated  foo  with  false  assert  not  decoratedfoofalse  writelinecalling  decorated  foo  with  true  assert  decoratedfootrue  运行此脚 本时应看到 以下 输 出 calling  undecorated  foo  with  false  about  to  log  at  debug 
 actually  logged  at  critical  如你 所见 实 际 日 志记 录 输出仅在 消息 等级为 error  或 更 高 的事 件时 发生但 在 这种 情况 下 任何 之前 较低 消息等级的 事 件还会 被 记 录
你 当 然 可以 使 用传 统的 装 饰 方 法 logiferrorslogger  def  foofailfalse 
 通过配置 使 用 utc  gmt  格 式化 时间
有 时候你希 望 使 用 utc 来格 式 化时 间这 可 以使用一 个类 来完成例如 utcformatter 如 下 所 示 import  logging  import  time  class  utcformatterlogging
gmtime 然 后你 可 以 在你的 代码 中使 用 utcformatter  而不 是 formatter
如 果你 想 通过 配 置 来实 现 这 一功能 你 可以 使用 dictconfig  api  来完 成 该方法在以 下完整 示例 中 展示 import  logging  import  logging
asctime 脚 本会 运 行输出 类似下面 的 内容20151017125329501 the  local  time  is  sat  oct 17135329201520151017135329501 the  local  time  is  sat  oct 171353292015 展 示 了如何 将时 间格 式化为 本地时间 和 utc 两 种形 式其 中 每种 形 式对 应一个 日 志 处理 器
使 用上 下 文 管理 器进行 选择 性记 录
 有 时 候 我 们需 要暂 时 更改 日志配置并在 执行 某些 操 作 后将 其 还原
 为此 上下 文管理 器 是实现 保 存 和恢 复日 志上 下文 的最 明显 的方 式
 这 是 一 个 关于上 下 文管 理 器 的简 单例 子它 允许你 在上下 文管 理 器 的作用 域内 更 改 日 志等级以 及增 加 日 志句 柄 import  logging  import  sys  class  loggingcontext  def  initself  logger  levelnone  handlernone  closetrue  self
close  implicit  return  of  none  dont  swallow  exceptions 如果指 定上下文 管理器 的 日 志记 录等 级属 性 则 在上 下文管理 器 的 with 语句所 涵盖 的 代 码中 日志记录 器的记 录等级将 临 时 设 置 为上 下 文管 理器所配 置的 日志 记录 等级
 如果 指定 上下文 管 理 的 句 柄属 性 则该 句柄在进 入上 下文 管理 器的 上 下文 时添加 到记 录器 中 并 在退出 时被删除
 如果 你 再 也不需 要该句 柄时你 可 以让上下文 管理器 在退 出上下文管理 器的 上 下文 时关 闭它
 为了说 明它 是如 何 工作的我 们可 以 在 上面 添 加以下 代码 块 if  name  main  logger  logging
 我 们最 初设 置 日 志 记录器 的 消 息等 级 为 info 因此消 息1出 现 消息2没有出 现
 在接 下来的 with  代码 块中 我们 暂 时 将消 息等级 变 更为 debug 从而消 息3 出现
 在 这一 代码块 退出 后日 志记录 器 的消息等级 恢 复为 info  从而 消息4 没有出现
 在下一 个 with 代码块中 我们 再一次将 设 置 消 息等 级 设置 为 debug 同 时 添 加一 个将 消 息写 入 sys
stdout 的 日志 处 理器
 因此消息5 在 控 制 台 出现两 次 分别 通 过 stderr 和 stdout
在 with  语句 完成 后状 态与 之 前一 样 因 此消 息6 出 现 类似 消 息1 而消 息7没有 出现类 似消 息2
 如 果我 们运 行生成的 脚本 结果如 下 python  logctx
我 们 将 stderr  标准 错误传 输 到 devnull 我 再次 运行 生成 的 脚步唯 一被 写 入 stdout 标 准输出的 消 息 即我 们所能看 见 的 消 息如 下 python  logctx
再一 次将 stdout  标准 输出 重定向 到 devnull  我 获得 如下结 果 python  logctx
在 这种 情况下 与预期 一致 打 印 到 stdout  标 准 输 出的 消息＃5 不会 出现
当然这 里描述 的 方 法 可 以 概括 例如临时 附 加 日 志记 录过 滤器
 请 注 意上面 的 代 码适 用于 python 2以 及 python 3
a  cli  application  starter  template
a  qt  gui  for  logging
 日 志 howto
作 者 vinay  sajip  vinaysajip  at  reddove  dot  com
日 志基 础教程
 什 么 时候 使 用日 志
一个 简单 的例 子
记 录日 志到文件
从 多个 模块 记 录 日志
 如果 你的程 序包 含多 个模块 这里 有 一 个 如何 组 织日 志记 录的 示 例 myapp
infodoing  something 如 果 你 运行 myapp
py  你应 该在 myapp
log  中 看 到 inforootstarted  inforootdoing  something  inforootfinished 这 是 你期 待 看 到的
 你可以使 用 mylib
py  中的模 式将 此 概括 为 多个模 块
请 注 意 对于这种 简 单的使 用模 式除 了查 看事 件 描述 之外 你不 能 通过查看 日志文 件来 了解 应 用 程 序 中 消 息的 来 源
如 果 要跟 踪消 息 的 位置 则需 要参考 教程 级 别以 外的文 档请 参阅 进阶 日志 教程
记 录 变量 数据
 要记录 变量 数 据请 使用 格式 字 符 串作 为 事 件描 述 消 息并将 变量数 据 作 为参 数附 加
例 如 import  logging  logging
warnings  before  you  s  look  leap  将 显示 warningrootlook  before  you  leap  如 你所见 将 可 变 数 据合 并 到事件 描述 消息 中 使 用旧的 s  形式的字符 串 格式 化
 这 是为了 向 后兼 容 logging  包 的 出现 时间 早于 较 新的 格式 化 选 项例如 str
format 和 string
这 些较 新 格 式 化 选 项是 受支持的但 探 索它 们 超 出 了本教 程的范 围有 关 详细 信息请 参 阅 using  particularformatting  styles  throughout  your  application
 更改 显 示消 息 的格 式
 要 更 改 用于 显示 消息的格 式你 需 要指 定要 使用的 格式 import  logging  logging
warningand  this  too  这将输出 debugthis  message  should  appear  on  the  console  infoso  should  this  warningand  this  too 请 注意 前 面 示 例中 出 现的 root 已 消 失
对于 可 以出 现在格式 字符 串中的全部 内容 你可以 参 考以 下文档 logrecord  属性 但 为了 简 单 使 用你 只需要 levelname 严 重 性 message  事件描 述 包 括可 变 数据也 许在事件 发生时 显示
 这将在 下一 节 中 介绍
 在消 息中 显示 日 期时 间
要 显示 事 件的日期和 时间 你 可以 在 格式字 符串 中放 置 asctimes  import  logging  logging
 应 该打 印 这样 的东 西20101212114142612 is  when  this  event  was  logged
日 期时 间显 示的默 认格 式 如 上所示类 似 于 iso 8601 或 rfc 3339
如 果你需 要更多地 控制 日期 时 间的 格式请为 basicconfig  提 供 datefmt  参数如 下 例 所 示 import  logging  logging
 这 会 显 示如 下内容12122010114636 am  is  when  this  event  was  logged
datefmt  参数 的格 式与 time
strftime  支持 的 格式 相 同
 后续 步 骤
基 本教程 到此 结束
 它应 该足 以让你启动 并运行 日 志 记录
 日志 包提 供了 更 多 功能但 为了 充分利用它 你需 要 花更多的 时间 来阅读以 下部 分
 如果你 准 备 好 了可 以 拿一些你最 喜欢 的 饮 料 然后 继续
如果 你的 日志 记 录需 求很 简单那 么 使用 上 面的示 例将 日 志记 录 合 并到 你 自己的 脚本 中如果你 遇到 问题 或者不理 解 某些 内容请在 comp
python  usenet  组 上发布 一 个 问题在 httpsgroups
python 你 应该 在短 时间内 得到 帮助
还不够？ 你可 以继 续 阅读 接下 来的 几 个部分这些 部 分 提供了比 上面 基 本 部 分更高级 或 深 入 的教程
之 后你 可 以 看 一 下 日志 操作 手册
 进阶 日志教程
 日 志库 采用 模 块 化方法并 提供 几类组件记 录 器、处理程 序、 过滤 器和 格 式 化程 序
 记 录器暴露 了 应用程序 代码 直接 使用的 接 口
处 理程 序 将日 志记 录 由记 录器 创建 发 送 到 适当 的目标
 过 滤器提供 了 更精 细的 附加功能 用于 确 定 要输出 的日志记 录
格式 化程 序指 定最终 输出 中 日志 记录 的 样式
 日 志事 件信 息 在 logrecord 实 例中 的 记录 器、 处理 程 序、 过滤器和格 式化 程 序 之间传递
 通过 调用 logger 类 以下 称 为 loggers 记录器的 实例 来 执 行日志记 录
每 个 实 例都 有 一 个名 称它们 在概念 上以 点句点 作 为分 隔符排 列 在 命 名空间 的层次 结构中
 例 如 名为 scan 的记 录器 是 记录 器 scan
textscan
html 和 scan
pdf 的 父 级
 记录 器名 称可以 是 你想 要的任 何 名 称 并指示 记录 消 息源 自的 应用 程 序区 域
 在 命名记录 器时 使 用的 一个好 习惯是在 每个 使用 日志记录的 模块中 使用 模块 级记 录器 命名如 下 logger  logging
getloggername 这 意味 着 记录 器 名称 跟踪包 或模块 的层 次 结构并 且 直观地从 记 录器 名称 显示 记录事 件的 位置
 记录 器 层 次结 构的 根 称为 根记 录器
这 是函 数 debug 、 info 、 warning 、 error 和 critical  使用 的记 录 器它们 只 调用 根记录器 的 同名 方 法
功能和方 法具有 相 同 的签 名
根记录 器的 名 称在 记录的 输 出中打印 为 root 
 当然 可以 将 消息 记录 到不 同的 地方
 软件 包 中的支 持包含 用于 将日 志消 息 写入文 件、 http  getpost 位置、通 过 smtp 发 送 电 子 邮 件、通用 套接 字、队 列或 特定于 操 作 系 统的 日志 记录 机制 如 syslog 或 windows  nt 事件 日 志
目 标由 handler  类 提 供
 如果你有 任何 内置处理程 序类 未满 足的 特殊 要求 则 可 以 创建 自己 的日志目 标类
 默 认情 况下 没 有 为 任何日 志记 录消息 设 置 目 标
你 可以使用 basicconfig  指定 目标 例如控 制台 或文 件 如 教程示例 中所 示
 如果你调 用函 数 debug 、 info 、 warning 、 error 和 critical  他 们将 检查是 否有 设 置目 的地如 果 没 有设 置它 们将 在委 托 给根 记 录器 进行实 际的 消息输 出之 前设 置 目标为控 制 台 sys
stderr  和默 认 格式 的显 示消息
 由 basicconfig  设 置的 消 息默认 格式 为 severitylogger  namemessage 你 可以 通过 使 用 format  参数 将格 式 字符 串传 递 给 basicconfig  来更 改此 设置
 有关如何构造 格式 字 符 串的 所 有 选 项请 参阅 格 式 器 对象
 记 录流 程
 记录 器和 处理 程序中 的日 志 事件信息 流 程 如下 图 所示
 图 片
记录器
 处 理程 序
handler 对象 负 责 将 适 当的 日 志消 息 基 于 日志 消 息的 严重 性分 派给处 理程序的指 定 目标
 logger  对象可以使 用 addhandler 方 法向自 己 添加零 个 或多 个处理 程 序对 象
作 为示例场 景应 用 程序可能 希望将 所 有 日志消息 发送 到日 志 文件 将错误 或更 高的所 有 日 志 消 息 发 送到 标准 输出以及 将所 有关键 消息发送 至 一个邮 件 地址
 此方 案需 要 三个 单独 的处理程序 其中 每 个 处 理 程序负 责 将 特 定 严 重性 的消息 发送 到特定 位 置
标准库 包含 很 多处 理程 序类型参见 有用 的处理程序 教程主 要 使 用 streamhandler  和 filehandler 
 处理 程 序中 很少 有方 法 可供应用 程 序开 发 人员 使用
与 使用 内 置处理程 序 对象 即 不创 建 自定 义处 理 程序 的 应 用程 序开 发人员相关 的唯一处 理 程序方法 是以下配 置方 法 setlevel  方法 就像 在记录器 对象 中 一样 指 定将 被 分派到 适当目标的 最 低 严重性
 为什 么 有 两 个 setlevel  方 法？ 记 录 器 中设置的 级 别确定将传 递给 其 处理程序的消 息 的 严重 性
每个处 理 程 序中设置的 级 别 确定处理 程 序将发送 哪 些 消 息
 setformatter  选 择 一个 该处理 程序 使用 的 formatter 对 象
 addfilter 和 removefilter 分 别在 处理 程序上 配置和 取消 配置过滤器对 象
应 用程 序 代码 不应 直接 实 例 化并 使 用 handler 的 实 例
相反 handler 类 是一个 基类 它 定义了 所 有 处 理程 序应 该具有 的接 口并 建 立了子类 可以使用 或覆 盖的一 些默认 行为
 格式 化 程序
 格式 化程序对 象配 置日 志消 息的最 终顺 序、 结构和 内容
与 logging
handler  类不 同 应 用程 序代 码 可 以 实 例化 格 式化程序 类 但如果应 用程 序 需 要 特殊行为 则 可 能 会 对 格式 化 程 序 进 行子类化
 构造 函数有三个 可 选 参数——消 息格式字 符串、 日 期 格 式 字 符 串 和样式 指示符
initfmtnone  datefmtnone  style 如 果没有 消 息格 式字 符 串 则默 认 使用原 始 消 息
如 果没有 日期格 式字符串 则默 认 日期 格式 为 ymd  hms  最后 加 上毫 秒数
 style  是％或 之一
如果 未 指 定其 中一 个则将 使 用％
如 果 style 是％ 则消 息 格 式字 符串使 用 dictionary  keys 样 式 字符 串替 换可能 的键值 在 logrecord 属性 中
如果 样式为 则假 定消 息格式 字符串 与 str
format 使用 关键 字参数 兼 容而 如 果样式 为 则 消息 格 式 字符串 应符 合 string
substitute 
在3
2 版 更改 添 加 style 形 参
以 下消息格 式字符串 将以 人 类可读 的格 式 记 录 时间、 消 息的 严重 性以及消 息的 内容按 此 顺序 asctimes  levelnames  messages  格式 化 程 序 使用用户 可 配置的 函 数将 记录 的创 建时 间转 换为 元组
默 认情 况下 使用 time
localtime  要为 特定 格式 化程 序实 例更改此项 请将实例 的 converter 属 性 设 置为具有 相同 签名 的函数 time
localtime 或 time
gmtime 
 要为 所有 格 式 化 程序 更改它 例如 如 果 你希 望所 有 记 录时间都 以 gmt  显 示 请在格式 化 程序 类中 设置 converter  属性 对 于 gmt 显 示设置 为 time
gmtime 
 配 置日 志记 录
开 发者可以 通过 三种 方 式配置 日志 记录1
 使用 调用上面列 出的配置 方 法 的 python 代码显 式创建记 录 器、处理 程序 和格 式 化 程 序
创 建日志 配置 文件 并使 用 fileconfig 函 数读 取 它
 创建 配置 信息 字 典并 将其 传递给 dictconfig 函数
 有 关 最后 两 个选 项的 参考文 档请参 阅配 置 函数
 以下示例使用 python  代码 配 置一个 非 常 简单的 记录 器 一个 控 制台处理 程 序 和 一个 简单 的 格 式 化程序 import  logging  create  logger  logger  logging
criticalcritical  message  从命 令 行 运行此模块 将 生成 以下 输出 python  simpleloggingmodule
py 20050319151026618 simpleexample  debug  debug  message 20050319151026620 simpleexample  info  info  message 20050319151026695 simpleexample  warning  warn  message 20050319151026697 simpleexample  error  error  message 20050319151026773 simpleexample  critical  critical  message 以 下 python 模 块创建的 记 录器、处 理程序和 格 式化 程序 几乎与 上 面列 出的 示例 中的 相同 唯一 的 区别 是对 象的 名称 import  logging  import  logging
criticalcritical  message  这是 logging
conf  文件 loggers  keysrootsimpleexample  handlers  keysconsolehandler  formatters  keyssimpleformatter  loggerroot  leveldebug  handlersconsolehandler  loggersimpleexample  leveldebug  handlersconsolehandler  qualnamesimpleexample  propagate 0 handlerconsolehandler  classstreamhandler  leveldebug  formattersimpleformatter  argssys
stdout  formattersimpleformatter  formatasctimes  names  levelnames  messages  datefmt  输 出几 乎与 不基于 配 置 文件 的 示例 相 同 python  simpleloggingconfig
py 20050319153855977 simpleexample  debug  debug  message 20050319153855979 simpleexample  info  info  message 20050319153856054 simpleexample  warning  warn  message 20050319153856055 simpleexample  error  error  message 20050319153856130 simpleexample  critical  critical  message 你可 以看 到配 置文件方 法比 python 代 码方 法有 一 些优 势主 要 是配 置 和 代 码的分离 以及非 开 发者 轻松修改 日 志 记录 属 性的 能力
警告 fileconfig  函数 接受 一个默 认参 数 disableexistingloggers  出于 向后 兼容 的 原因默认为 true 
 这 可能 是你 想 要的 也 可 能不是 你想 要 的因为除非 在配置中 明确命 名 它们 或 一个 上级 节点中 否 则它将导 致在 fileconfig  调用之 前 存在 的任何 非 root 记 录 器被禁 用
 有关 更多 信息请 参阅 参考文档 如果需 要请 为此参数指 定 false 
传 递 给 dictconfig 的 字典 也可 以用键 disableexistingloggers 指 定一 个布 尔值如 果没 有在 字 典中 明确指定 也 默认被 解释 为 true 
 这 会 导致 上面 描述的 记录器禁用 行 为这 可能不 是 你 想要 的——在 这种情况 下 明确地为 键提 供 false 值
 请 注 意 配置 文件中 引用 的 类名 称需 要相 对于 日志 记录 模块或者 可 以 使用常规 导 入机制解 析 的绝 对 值
因 此你 可以 使用 watchedfilehandler  相对 于日志 记 录模块 或 mypackage
myhandler 对于 在 mypackage 包 中定 义 的 类和 模 块 mymodule 其 中 mypackage 在 python 导 入 路 径上可用
在 python 3
2 中引入 了 一种新 的配 置日 志记 录的 方 法使用字 典 来 保 存配 置 信息
这提 供 了上述基于 配置文 件 方法的 功能 的 超 集 并 且是 新 应 用程 序 和部 署 的推 荐 配置方 法
因为 python 字 典用 于 保 存配 置 信息 并且 由于你 可以 使用不同 的 方式填 充该字典 因此 你有 更多 的配置选项
 例 如 你可以 使用 json  格 式 的配 置文 件或者 如 果 你有权访 问 yaml 处 理功能则 可以 使用 yaml  格式 的文 件来 填充 配置 字典
当然你 可以在 python  代码 中 构造 字典 通过套 接 字 以 pickle 形 式接收 它 或者使 用 对 你 的应 用程 序合 理的 任何方 法
以 下是与 上述 相同 配置 的 示例 采 用 yaml 格 式用 于新的基于 字典 的 方法 version 1 formatters  simple  format  asctimes  names  levelnames  messages  handlers  console  class  logging
stdout  loggers  simpleexample  level  debug  handlers  console  propagate  no  root  level  debug  handlers  console 有 关使 用字 典 进 行日 志记 录的更 多信 息 请参 阅 配 置函 数
如果没 有 提供 配 置 会发 生 什 么
如 果未 提供 日志 记录 配 置 则 可能 出现 需要 输出 日志 记录 事 件但 无 法找 到 输出 事件的 处理 程序 的 情 况
在 这些 情况 下日 志 包的 行为 取 决于 python  版本
对 于3
2之 前的 python  版本行为 如下如 果 logging
raiseexceptions 为 false  生产模 式 则会 以静 默 方 式 丢 弃该事 件
如 果 logging
raiseexceptions 为 true  开 发模 式则 会打 印一 条 消息无法 找到 记录 器 x
z 的 处 理 程序
在 python 3
2 及更 高版 本 中行 为 如下 事 件 使用最后 的 处 理 程 序 输 出存 储在 logging
lastresort 中
 这个 内部处理 程 序与任 何记 录器 都 没有关联它 的作 用类似于 streamhandler 它 将事 件描 述 消息写入 sys
stderr 的 当 前值因此 服从 任 何可 能的 重 定 向 影响
 没有 对消息 进行 格 式化—— 只 打印 裸事 件描 述 消息
 处理 程 序的 级 别 设置 为 警告 因此 将输出 此级 别 和更 高 级 别的所有事 件
 要 获得3
2之 前的 行为 logging
lastresort  可以 设 置 为 none 
配 置库 的 日志 记录
 日 志级 别
日 志 记 录 级别 的数值 在下 表中给出
如 果你想要定 义 自己 的级别 并且需要 它 们 具有相对 于 预 定 义级 别的特 定值 那 么这 些 内 容 可 能是 你 感兴趣 的
如 果 你定 义 具有 相同 数 值 的级 别 它将 覆盖 预定 义 的值预 定 义的 名称 丢失
 级 别数 值 critical 50 error 40 warning 30 info 20 debug 10 notset 0级别也 可 以与记 录器 相关 联由 开 发 人员设 置或 通 过加 载 已保 存的日 志 记录 配置
 在记录 器 上 调 用日 志 记录 方法时 记录 器会 将其自 己的 级别 与与 方 法调 用关 联的 级 别 进 行 比较
 如果 记 录 器的 级别 高 于方法 调用 的级 别则 实际 上 不 会 生成 任何记录 消息
 这 是 控 制 日志 记录 输 出详 细程 度的 基 本 机制
 记 录消 息 被编码 为 logrecord 类 的 实例
 当 记录 器决定 实际 记 录事 件时 从 记 录消 息创 建 logrecord 实 例
记 录消 息 通 过使 用 handlers  进 行调 度 机 制它 们是 handler 类 的子类的 实例
处理 程序 负责确保记 录 的消息以 logrecord  的形式最终 位于特定 位置或一组 位置这 对 该消息 的 目 标 受众 例 如最 终用 户、支持 服务 台员 工、系统 管 理 员、 开 发人 员
传 递 处 理程序用 于特 定目 标 的 logrecord 实 例
每 个 记录器 可以 有零 个、一 个 或多 个 与之 关 联的 处 理 程序通过 logger  的 addhandler 方法
 除 了与 记录 器直 接关联 的 任何 处理 程序之外 还调用与 记录 器的 所 有祖先相 关联的 所有 处 理 程序来 分派消 息除 非记 录 器 的 propagate  标 志设 置为 false  值这 将停止 传递到上 级处 理程 序
 就像记 录器一 样处 理程 序可 以具 有与 它们 相关 联的 级 别
处理 程序 的 级别 作为过 滤器其方 式与 记录 器 级 别相 同
如 果处 理程序 决定 调度一 个事件则 使用 emit  方 法将 消 息发 送到其目 标
大多数 用户 定义 的 handler  子类 都需 要 重 载 emit 
 自 定义级别
 定义你 自己 的 级别 是可能 的 但不 一 定是 必要的 因 为 现有级别 是根 据实 践 经验选 择 的
 但是 如果 你 确信 需要自定 义 级别 那 么 在 执行 此 操作时应 特 别 小 心如 果 你正 在开 发 库 则定 义 自定 义级 别 可能 是一 个非常 糟 糕的主 意
这 是因 为如 果 多 个库 作者 都定 义了 他们 自己的 自 定义 级别那 么使 用开 发 人员 很 难控制和 解释这 些多 个 库的 日志记 录 输出 因为给定 的数 值可 能 意味 着不 同的东 西对 于不 同的 库
有 用的处 理程 序
记录 日志 中引发的异 常
日 志 包设 计为 忽略 记 录日 志生 产时 发 生的 异常
 这样 处理 日志 记录 事件 时发 生的 错误例 如日 志记录错 误配 置、 网络 或其他 类似错误 不会 导致使用 日志 记 录 的 应 用 程序 过早 终止
systemexit 和 keyboardinterrupt  异常 永远 不 会被 忽略
 在 handler 子 类 的 emit  方 法 中发生的 其他 异 常被 传 递给 它的 handleerror 方 法
handler  中默 认 实现 的 handleerror 检 查是 否 设 置了模 块级 变 量 raiseexceptions 
 如 果 有设 置则会 将跟踪 打印 到 sys
stderr 
如 果未设 置 则 忽 略异 常
注 解 raiseexceptions 默 认 值是 true
这是 因 为在 开发 期间你通常 希望收 到 任 何发 生异 常的 通知
建 议你 将 raiseexceptions 设置为 false  以供 生 产 环境 使 用
 使用任 意对象作 为消 息
优 化
将 python 2 代码迁移 到 python
作 者 brett  cannon 摘要 python 3 是 python 的未来 但 python 2 仍处于 活 跃使用 阶段 最好 让您 的项目 在两 个主要 版本 的 python 上 都 可 用
 本指南 旨在帮 助您 了解如 何最 好地 同 时支 持 python 2和3
 如 果 您 希 望迁移 扩展 模 块而 不是 纯 python 代 码请参阅 将扩 展 模块移植 到 python 3
 如 果 你 想 了 解 核 心 python  开发 者对于 python 3的 出现 有何 看法 你 可 以 阅 读 nick  coghlan 的 python 3 q  a  或 brett  cannon 的为什 么要有 python 3
有 关迁 移的 帮助 您 可 以通 过 电 子邮 件向 pythonporting  邮 件 列表发 送 问题
简要 说 明
了解 python 2 和3 之间的 区别4
注解 note  using  python  m  pip  install  guarantees  that  the  pip  you  invoke  is  the  one  installed  for  the  python  currently  in  use  whether  it  be  a  systemwide  pip  or  one  installed  within  a  virtual  environment
 详情
 删 除对 python 26及 更 早版本 的 支持
make  sure  you  specify  the  proper  version  support  in  your  setuppy  file
良 好的测试 覆 盖率
了 解 python 2 和3之间 的区别
更 新代码
除 法 in  python 3522
文本与 二进制数 据 in  python 2 you  could  use  the  str  type  for  both  text  and  binarydata
文本数 据 二进制 数据 decode  encode  format  isdecimal  isnumeric  making  the  distinction  easier  to  handle  can  be  accomplished  byencoding  and  decoding  between  binary  data  and  text  at  the  edge  of  yourcode
prevent  compatibility  regressions
check  which  dependencies  block  your  transition
update  your  setuppy  file  to  denote  python 3 compatibility
use  continuous  integration  to  stay  compatible
考虑 使用可选 的静态类 型检查
正 则 表达式 howto
 作 者 a
ca 摘要 本 文档是 在 python  中使用 re  模 块使用 正 则表达 式的入门 教 程
它提 供了比标 准库参考 中相应部 分更平 和的 介绍
概 述
正 则表达 式称 为 re  或 正则 或正 则表达 式模 式本 质上 是嵌 入在 python  中的 一种微 小的、 高 度专业 化 的 编程 语言 可 通 过 re  模块 获 得
使 用 这种小 语言 你 可以为 要匹 配的 可能 字符 串集 指定规则 此 集可 能 包含英语 句子 电 子 邮件 地 址 tex 命 令或 你 喜 欢的 任何内容
 然后 您 可以询 问 诸如 此 字符 串 是 否 与模 式匹 配？或 此 字符串 中的 模 式 是否匹 配？等 问题
你还 可 以使 用正 则 修改 字 符串 或以 各种 方式将 其 拆分
 正则 表达式 模式被编 译成 一 系列 字 节 码然 后由 用 c 编写 的 匹配引 擎执行
 对于 高 级 用途 可 能 需要 特 别注 意引 擎如 何执 行 给 定 的正 则并 将正 则写 入 以某 种 方式 生成 运 行 速 度 更快 的字 节 码
本 文 档 未涉及 优 化因为它要求 你充分 了解匹 配引擎的 内部 结构
正 则表 达 式 语 言 相对 较小且 受限 制 因此 并 非 所 有可 能的 字符 串处 理任务都 可以使用 正则 表达式 完成
 还有一 些任务可 以用正 则表 达 式完 成但表 达式 变得 非 常复 杂
在 这些情况 下 你最好 编 写 python  代 码 来 进 行 处理 虽 然 python 代码 比 精 心设 计 的 正则表达 式慢 但 它也可 能更 容易理解
 简 单 模式
我 们首 先要 了 解最简 单 的正 则表达式
 由于 正则表 达 式用 于对 字 符 串 进 行 操 作 因此 我们 将从 最常 见 的任 务 开 始匹 配 字 符
 有关正 则表 达式确 定性和 非确 定 性 有限 自动机的 计算 机 科 学的详 细解释 你 可以 参考 几 乎 所有有 关 编 写编 译器 的 教 科 书
 匹配 字符
 大 多数 字母和 字符 只会 匹 配自己
 例如 正则 表 达式 test  将完全 匹 配 字符 串 test 
 你可 以启 用 一个 不 区 分 大 小写的模 式 让这 个正则 匹配 test 或 test  稍 后会 详细介 绍
这 条规 则有例 外一 些 字符 是特 殊 的 metacharacters 并 且 不匹 配自 己
相 反 它 们表 示应 该 匹 配一 些与 众 不同 的东 西或者 通 过重复 它 们 或 改 变 它们的 含义来 影响 正 则 的 其 他 部 分
本 文档 的 大部 分内 容都致 力 于讨论各 种 元 字符 及其 功能
 这 是元 字符 的完整 列 表它们 的意 思 将 在 本 howto  的其 余部分讨 论
我 们将 看 到的 第一 个元 字符 是和
 它们 用 于 指 定字符 类它 是 你 希望 匹配 的一组 字符
 可以 单独 列出 字 符也 可以通过给出 两个 字符并 用标记 将它们 分开来表 示一 系 列字符
 例如 abc  将 匹配任 何字符 a 、 b  或 c 这与 ac 相同它 使用 一个 范围 来表示 同一组字 符
如 果你只想 匹配 小写 字母 你 的正 则 是 az 
字 符类 中的元字符 不 生 效
 例如 akm 将 匹配 a  k 、 m  或 中的 任 意字符通 常 是 一 个 元字符 但在 一个字 符类 中 它被 剥夺 了特殊 性
你可以 通 过 以下 方式 匹 配 complementing 设 置的 字符 类中 未 列出的 字符
这通 过包 含一 个 作 为该类的 第一 个字 符 来表示
例 如5将匹 配除5 之 外 的任何 字符
如果 插入 符 出 现在 字符 类 的 其 他 位置 则它没 有特殊含义
 例如5 将 匹配5或
也 许最重要 的 元字符是 反斜杠
 与 python  字 符串 文 字 一样 反 斜杠后面 可以 跟 各种 字符以 指 示 各种 特 殊 序列
 它也 用 于转 义 所 有 元字符 因此您 仍 然 可 以 在模 式中匹 配 它 们例如 如果你 需要 匹 配或 你 可 以在 它们前 面 加 一个 反 斜杠 来移 除它 们 的 特 殊含 义或
 一 些 以开 头的 特 殊序 列 表示通 常 有用 的 预定义字 符集 例如数字 集、字 母集 或 任 何 非空格 的集 合
让我 们 举 一个例 子 w 匹配 任何 字母 数 字 字 符
如果正 则表达 式模式以字 节 类 表示 这 相当于类 azaz 09
 如 果正则表 达式 是 一个 字 符串 w 将 匹配由 unicodedata  模块提 供的 unicode 数据 库中 标记 为 字母的 所有 字 符
通过 在 编译正 则 表达式 时 提 供 re
ascii  标志可 以 在 字符串 模式 中使 用更为 受限 制的 w 定 义
以下 特 殊 序列列表 不完 整
 有关 unicode  字 符 串 模式的 序列和扩 展类定 义的 完 整列表 请 参 阅标准 库参考 中的最 后一部 分正 则表达 式语 法
通 常 unicode  版本匹 配 unicode 数据 库 中相 应类 别中的 任何字 符
d 匹配 任 何十 进 制数 字这等 价 于 类09
d  匹配任 何非 数字字 符 这等 价于 类09
s 匹配 任何 空 白 字 符 这等价于 类 tnrfv
s 匹配 任 何 非空 白字符这 相 当 于类 tnrfv
w  匹 配任 何字母 与数 字字符这相当 于 类 azaz 09
w  匹配 任 何非 字母与 数 字字 符这 相当 于 类 azaz 09
这 些序 列可以 包含 在 字符 类中
 例如 s
 是一 个匹 配任 何空格字符 的 字符 类或 者或
本 节的 最后一个 元字 符 是

它匹 配除换 行符之 外的任 何 内容并且 有一 个 可选 模 式 re
dotall 甚 至 可 以匹配 换行 符

常 用于 你 想匹 配 任何 字 符 的地 方
重 复
 能够 匹配 不 同的 字符 集 合是 正 则表 达式 可以 做的 第 一件 事 这对 于 字符 串 可用 方 法 来说是 不可 能的
 但 是如 果 这是 正 则 表 达 式 的唯 一额 外功能 那么它 们就 不 会 有太 大 的 优势
另一 个 功能是 你 可以指 定 正则的 某 些部分 必 须重复 一 定次数
 重复 中我 们要 了解的第一个 元 字符 是
 与 字 面字 符不 匹配 相反 它指定前 一个 字 符可 以匹配 零次或 多次而 不是 恰 好一次
 例如 cat 将匹 配 ct 0个 a 字 符 cat 1个 a  caaat 3 个 a 字 符等 等
 类似 这 样的重 复是 贪婪 的 当重 复 正则 时匹 配引擎 将尝 试尽 可能 多地 重复 它
 如果模 式的 后 续部分 不匹配 则匹配引擎将回退 并以 较 少的 重复 次数 再次 尝试
 一个 逐步的例子 将使这更 加明 显
 让 我 们考虑 表达 式 abcdb
 这个 正 则匹配 字母 a 类 bcd 中 的零 或多 个字 母最 后以 b  结尾
 现在 想象 一 下 这个 正则与 字 符 串 abcbd  匹配
 步骤 匹配 解释1 a  正 则 中的 a  匹配
2 abcbd  引 擎 尽可 能 多 地匹 配 bcd 直 到字 符串 结束
3 失败 引擎 尝试 匹配 b  但是 当前 位置 位于 字符串结束 所以匹配失 败
4 abcb  回 退 一次 bcd  少匹 配 一 个字符
5失 败 再 次尝试 匹配 b 但是 当前 位置 是 最 后 一 个字 符 d 
6 abc  再 次回 退所以 bcd 只 匹配 bc 
6 abcb  再 试一 次 b 
 这 次 当 前 位置 的字 符是 b  所以它成 功了
 正 则 现在已经 结 束了它 已经 匹 配 了 abcb
这 演示 了匹 配 引擎 最 初 如 何进 行 如果没有找 到匹 配它将逐步回退并 一次 又一 次地重试正 则的 其余部 分
它 将 回 退直 到它 为 bcd  尝试 零 匹配如 果随后 失败 引擎 将断 定该 字符 串与 正则 完全不 匹配
 另一 个 重 复的元字 符 是它 匹配一次 或多 次
要 特 别注 意 和 之 间 的区别 匹配 零 次 或更 多次 因 此重复的 任何 东西 都可 能根本 不存 在而至 少 需 要一 次
使 用类 似的 例子 cat  将匹 配 cat 1 个 acaaat 3 个 a  但不 会匹 配 ct
还 有 两个 重 复限 定 符
问 号字 符匹配一次 或零 次你可以 把它 想 象成 是可 选的
例 如 homebrew 匹 配 homebrew 或 homebrew
 最复杂 的重 复限 定符 是 mn 其 中 m 和 n  是 十进 制整 数
这 个限 定 符意 味着 必须至 少重 复 m 次 最 多重 复 n 次
 例如 a 13 b  将匹 配 ab  ab 和 ab 
 它不 匹配 没有 斜线 的 ab 或 者有 四个的 ab
 你可 以省 略 m 或 n  在这 种情 况 下将 假定 缺失 值的合理 值
省 略 m 被 解释 为0 下限而省 略 n  则 为无 穷大 的上限
 还原 论者的 读 者可 能会 注 意 到其 他三 个 限 定 符都 可以用这 种表 示法 表达
0与相 同1相 当 于01和 相同
 最好 使用 或只要 因为它 们更 短 更容 易阅 读
 使用 正 则 表达 式
 现在 我们 已经 看 了一 些 简 单的 正 则 表达 式我 们如 何在 python  中实 际 使用 它们？ re  模 块提供了正则表 达 式 引擎的接 口允 许你 将 正则 编 译为对 象然后用 它们 进行 匹配
 编译正则 表达式
正 则表 达式被 编译成模 式 对象 模式 对象 具 有 各种操 作的 方 法例如 搜索 模式 匹配 或 执行 字符串替 换
 import  re  p  re
compile 也 接 受 一 个可选 的 flags  参数 用于启用 各种 特殊 功 能和 语 法变体
 我们 稍后 将 介绍 可用 的设置但 现在 只 需一 个例 子 p  re
ignorecase 正 则作 为字符 串 传 递 给 re
compile 
正 则被 处理 为字 符 串 因 为 正则 表 达 式 不是 核 心 python 语 言 的一部分 并且 没 有 创 建用 于表 达 它们 的 特殊 语 法
有 些 应用 程序根 本不需要 正则 因此 不需 要 通过 包含 它们 来扩 展语 言 规 范
 相 反 re  模 块只 是 python 附 带的 c  扩展模 块就类 似于 socket  或 zlib 模 块
将 正则 放 在字符串 中可以 使 python 语 言更简 单但有 一 个缺 点 是 下 一节 的 主 题
反 斜 杠灾 难
 应用 匹 配
一 旦你 有 一个 表示 编 译 正则 表 达式 的 对 象你 用它 做什 么？模式对 象 有几种方法 和 属 性
这 里只介绍最重 要的内 容请 参阅 re  文档 获取 完整 列 表
方法 属性 目 的 match 确 定 正则是 否从字符 串 的 开 头匹 配
 search 扫描字 符串 查找 此正则 匹配 的任 何 位置
 findall 找 到 正 则匹 配的 所有 子字 符 串并将 它们 作为 列表 返 回
 finditer 找 到正 则匹 配 的 所 有 子字 符 串并 将它 们返 回为 一个 iterator
 如 果没有找 到 匹配 match  和 search 返 回 none 
如 果 它 们成 功一 个匹 配对 象实 例 将 被 返回 包含 匹 配 相关的信 息起 始 和终 结位 置、匹 配的 子串以及其它
 你可以通过交 互式实 验 re  模 块来了解这一 点
 如果 你有 tkinter  你 可 能还想查看 toolsdemoredemo
py 这 是 python 发行附 带的 演示 程序
 它允 许你输 入正则和字符 串并 显 示 re  是匹 配还 是 失败
 redemo
py 在 尝试 调试 复杂 的正则 时非 常 有用
 本 howto  使用标 准 python  解 释器作 为示 例
首 先 运 行 python  解 释 器导入 re 模块然 后编 译 一个 正则 import  re  p  re
compileaz 现 在 你可 以尝 试匹 配 正则 az  的各 种字 符 串
空 字 符串 根 本 不 匹配 因为 表 示一 次或 多次 重 复
 match  在这 种 情况下 应返 回 none  这将 导致 解 释器 不打 印 输出
你可以显 式打 印 match  的 结 果使 其清 晰
 p
match  none  现 在 让 我 们尝 试 一 下 它应该 匹配 的字 符串 例如 tempo
在 这 个例 子中 match 将返回一 个匹 配 对象 因此你应 该 将结果 储存 到一个变 量 中 以供稍后 使用
match  object  span 05 matchtempo  现在 你 可 以 检 查匹配对 象 以 获取有 关 匹配字符串的 信息
 匹 配对 象实 例也 有几个方 法和 属性 最 重要 的是 方法 属 性目 的 group 返 回正 则 匹 配 的 字符串 start  返 回 匹 配的 开始 位 置 end  返 回匹 配 的结 束 位 置 span  返 回包 含匹 配 start  end  位置的 元组 尝 试这 些方法 很快 就会清楚它们 的 含 义 m
span 05 group 返回 正则 匹配的 子字 符串
 start 和 end  返回匹 配的 起始和 结 束 索引
 span  在 单个 元 组中 返 回开始 和结束 索引
由于 match  方法只 检 查 正则 是 否在 字 符串 的 开头匹 配所以 start  将始终为 零
 但是 模式 的 search  方 法 会 扫 描 字 符串 因此在 这 种 情 况 下 匹配 可能 不会 从零开 始
 printp
span 411 在 实际 程序中 最 常 见 的 样 式是 在变量中 存储匹配 对象然后 检查它是 否为 none
这通 常看起来 像 p  re
group  else  printno  match 两种模 式方法返 回模式的 所有匹配 项
 findall  返回匹 配 字符串 的列表 p  re
findall 12 drummers  drumming 11 pipers  piping 10 lords  aleaping 121110在 这个例子 中需要 r 前 缀 使字面 为原始字 符 串字面 因为 普通的加 工字符串字面 中 的转 义 序列 不能 被 python 识 别为 正 则表 达 式导 致 deprecationwarning 并最终 产 生 syntaxerror
 请 参阅 反斜 杠 灾 难
findall 必 须先 创建整 个列 表才 能返 回结 果
 finditer 方 法将一个 匹配 对象的 序列 返 回为 一个 iterator  iterator  p
 模块级 别函 数
 你不 必创 建模 式 对象并 调用 其方 法 re  模块 还提 供 了顶 级函 数 matchsearchfindallsub 等 等
这些 函 数采 用与 相应 模 式方 法相 同的 参 数并 将正 则字 符串 作 为第 一个 参数添 加并 仍 然返 回 none 或 匹 配 对象实 例
 printre
match  object  span 05 matchfrom 本 质上 这些函 数只是为你 创 建一 个模 式对 象并 在 其 上调 用适当 的 方 法
它们 还 将 编 译 对 象存储 在 缓存 中因 此使用相 同的 未来 调用将不 需要 一次又一 次地 解析该模 式
你是 否应 该使 用这 些模块级 函 数还是应 该自己 获取模 式并 调用 其方 法？ 如果 你正 在循 环中访 问 正则表 达式预 编译 它将节 省一 些 函数 调用
 在循 环之外 由于 有内部 缓存 没有太大 区 别
 编 译 标 志
 编 译 标 志允许你 修改 正 则表 达式 的工作方 式
标 志在 re  模块 中有 两 个名 称长 名 称如 ignorecase  和一 个 简短的单字 母 形式例 如 i
 如 果你熟悉 perl 的 模 式修 饰符则单 字 母 形 式 使用 和 其相 同的字 母例 如 re
verbose  的缩 写形 式 为 re
x
多 个标 志可 以 通过按位或 运算来 指定它 们 例如 re
m  设置 i  和 m  标志
 这是 一个可用 标志 表以 及每个 标 志的 更 详细 说 明
标 志意义 ascii  a 使 几个 转 义如 w 、 b 、 s 和 d 匹配 仅 与具有 相应特征 属性的 ascii  字符 匹配
 dotall  s  使
 匹 配任何字 符包括 换行符
 ignorecase  i  进 行大 小写 不 敏感 匹配
 locale  l 进行 区域 设置 感知 匹 配
 multiline  m 多行匹 配影响 和
 verbose  x  为扩 展 启用 详细 的正则 可以 更 清 晰更 容易 理解
 iignorecase 执 行不 区分 大 小 写的匹配 字符类 和 字面字 符 串将 通过 忽 略 大小 写 来匹配字 母
 例如 az  也匹配小 写字 母
 除非使用 ascii  标 志来 禁用 非 ascii 匹 配 否则 完全 unicode  匹配 也 有效
 当 unicode 模式 az 或 az  与 ignorecase  标志结合使用 时 它们将匹 配52个 ascii  字母 和4个额 外的 非 ascii 字 母 i ̇ u 0130拉丁大 写字母 i  带上 面 的 点ı u 0131 拉丁文 小写 字 母无 点 is  u 017 f  拉丁文 小 写 字 母长 s 和 k  u 212 a 开尔 文 符号
 spam  将匹配 spamspam  spam  或ſ pam 后 者仅在 unicode  模式 下匹配
此 小写 不考虑 当前区 域设 置 如 果你 还设置了 locale 标 志 则 将考虑
llocale  使 w 、 w 、 b 、 b 和 大小 写敏 感 匹配 依 赖于 当 前区 域 而不是 unicode 数 据 库
 区域设 置 是 c  库的 一个 功能 旨在 帮助编写 考虑 到语 言差 异的 程 序
 例 如如 果 你 正在 处理编 码的法语 文本 那 么 你希 望 能够 编写 w  来匹 配 单词但 w  只 匹配字 符类 azaz  字 节 模 式 它不 会匹 配对 应于é或ç 的字节
 如果 你的 系 统 配置正确 并且选 择 了法 语 区域 设 置某些 c  函数 将 告诉 程序 对 应于é 的字节 也应该被 视 为字母
 在编译 正则表 达式时设 置 locale  标志将导致 生成的 编译对 象将这 些 c  函数用 于 w  这比 较慢 但 也 可以 使 w  匹配你所 期 望的 法语单词
 在 python 3中 不 鼓励使用 此 标志 因 为语言 环 境 机 制非常不可 靠 它一 次只处 理一 个 文 化 它只 适用于8位 语 言环境
 默 认 情况 下 python 3中 已 经为 unicodestr  模式启用 了 unicode 匹 配 并 且 它能 够 处 理 不 同 的区 域语 言
mmultiline 和 还 没有解 释它 们将在 以 下部分 介 绍 更 多元字 符
通 常只 匹配字符 串 的开头 而只 匹配 字符 串的 结尾紧 接在字 符串 末尾 的 换行符 如 果 有 的话之前
当 指 定了 这个标 志时 匹 配 字 符串 的开头和 字 符串中 每 一 行的 开头 紧 跟在 每个换行 符之 后
 类 似地 元字 符 匹 配 字 符串 的 结 尾 和 每 行的 结尾 紧接 在每 个换 行符 之 前
sdotall  使
 特殊 字符匹配 任何 字 符包 括 换行 符 没有这 个 标 志
将 匹配任 何字 符除 了 换 行符
aascii  使 w 、 w 、 b 、 b 、 s  和 s  执 行仅 ascii  匹 配 而 不 是 完整 匹配 unicode  匹配
 这仅 对 unicode 模 式 有意义并 且对 于 字节模式 将 被 忽略
xverbose  此标 志 允 许你 编 写更 易读 的 正 则表达 式方法是 为您提供 更灵 活的格 式化 方式
指 定此 标志 后将 忽略正则 字符 串中 的空 格 除非 空格 位于 字符 类中 或前面带有 未转义的 反斜 杠这 使你 可 以 更清楚 地组织 和 缩进 正 则
此标志 还 允许你 将 注释 放 在正则 中 引擎将忽 略该 注释 注 释 标 记为 既 不 是 在字 符 类中 也 不是在 未转义 的反 斜杠之前
 例如 这里 的 正 则 使 用 re
verbose 看 看阅 读 有 多 容易？ charref  re
verbose  如果 没 有详 细设 置正则将如下 所示 charref  re
compile 00709 x 09 afaf 在上面 的例子中 python 的 字 符串 文字 的 自 动 连 接已 被用于将 正 则分 解 为更小 的部分但 它 仍然比 以下 使用 re
verbose 版本 更难 理解
 更 多模 式能 力
到 目前 为止 我们只介 绍 了正 则表达 式的一 部分 功能
 在本 节中 我们 将介 绍一 些新 的元 字符 以及如 何使 用组 来检 索匹 配的 文本部分
更 多元 字符
 我们 还没有涉及到 一些 元 字符
其 中大 部分 内 容将 在 本节中 介 绍
 要讨 论 的其 余一 些元字符是零 宽 度断言
 它 们 不会使 解 析引 擎 在 字 符串 中前 进一 个字符相反它 们根 本 不占用 任 何 字符只 是成 功 或失 败
 例如 b  是一 个断 言指 明当前 位置位于 字 边 界 这个 位置 根本 不 会 被 b 改 变
 这 意味 着永远 不 应重 复零宽 度断 言 因为如 果 它 们在给 定 位 置匹 配 一次它 们 显 然 可以无 限 次 匹 配
 或者 or  运算 符
如 果 a 和 b 是 正则表 达式 ab 将 匹 配 任 何 与 a 或 b 匹配 的字 符串
 具有 非 常 低的优 先级以 便在 交替使用多 字 符 字 符 串 时 使 其合 理 地 工作
 crowservo 将 匹配 crow 或 servo  而 不 是 cro 、 w 或 s  和 ervo
要匹 配字面 请 使用或将 其括 在字 符 类 中 如
在 行 的开 头 匹配
 除 非 设 置 了 multiline  标 志 否则 只会 在字 符 串的 开头 匹 配
在 multiline 模 式下 这 也在 字符 串中 的每个换行 符 后立即 匹 配
 例如如 果你希 望 仅 在 行 的开 头 匹配 单词 from 则 要 使用 的正则 from 
 printre
searchfrom  reciting  from  memory  none  要匹 配 字面 使 用
 匹 配行的 末 尾 定 义 为字 符 串的 结 尾或者 后跟 换 行 符 的任 何 位 置
 printre
match  object  span 67 match  以匹配 字 面使用 或者将 其 包 裹 在 一个 字符 类 中 例 如
a  仅 匹配 字 符串 的开头
当不 在 multiline 模式 时 a  和 实 际上 是 相同的
 在 multiline 模式 中它 们 是不 同的 a  仍然 只在 字符 串 的开 头匹 配但 可以 匹 配 在换 行符 之后 的字符串 内的任 何 位 置
z  只 匹配字 符串尾
b  字边 界
这 是 一个零 宽度 断言 仅 在单 词 的开头 或 结尾处 匹配
 单 词被定 义为 一个 字母数字字符 序 列因 此单 词的 结尾由 空格或非 字母 数 字字 符 表 示
 以 下 示例仅当它 是 一个 完整 的单 词 时匹配 class  当 它 包含在 另 一个单 词中 时将 不会匹 配
searchone  subclass  is  none 使 用这 个 特殊序 列 时你 应 该 记住两个 细微之 处
首 先 这是 python  的字符串 文字和 正 则表 达 式序 列之间 最严重的 冲 突
在 python 的 字符 串文字中 b  是 退格 字 符 ascii 值 为8
如 果 你没 有使 用原始 字符 串那 么 python  会将 b 转 换 为 退格你 的正 则不 会按照 你的 预期 匹配
 以 下 示 例与 我们 之前的正则 看起 来相 同但 省略了正则字 符串前 面 的 r
 p  re
match  object  span 07 matchx 08 classx 08 其次在 一个字 符类 中 这 个 断言 没 有 用处 b 表示 退格 字 符 以便 与 python  的字 符 串文 字 兼 容
b 另 一个 零 宽 度 断言 这 与 b 相 反 仅 在当 前 位置 不在 字 边界时 才 匹 配
 分 组
 通常 你需 要 获取更多 信息 而不仅仅 是正 则是 否匹 配
 正则 表达 式通常 用于 通过 将 正则分成几个 子组 来解 析 字 符串这 些子 组匹 配不 同 的 感兴 趣组 件
 例如 rfc 822 标 题行 分为标 题名 称和 值用 分 隔如 下 所示 from  authorexample
com  这 可 以通过编 写与 整个 标题 行匹 配 的 正则 表 达式 来 处理 并 且具 有 与 标题名称 匹配 的 一个 组以 及与 标题 的值 匹配的 另 一 个 组
 组由元 字符标 记
和与 数学 表 达 式 的 含义 大致 相 同它 们 将 包含 在 其中 的表达式组 合 在一 起你 可 以使用重 复 限 定符重复组 的内 容例 如或 mn
例如 ab 将 匹配 ab 的 零次 或 多次重 复
 p  re
span 010用 表示的 组也 捕获 它们 匹 配的文本 的起 始 和结束索引 这可 以通过 将 参数 传递 给 group 、 start 、 end 以 及 span
组从0开始编 号
组0 始终存 在它 表示整 个正 则所 以 匹 配 对象方法 都将 组0作 为默认参数
 稍 后我 们 将看到如何 表 达不 捕获它 们匹 配 的文本 范围 的组
 p  re
group 0 ab  子组 从左 到 右 编号 从1 向上 编号
 组可以嵌 套要 确定 编 号 只需 计 算 从 左到右 的 左括 号 字 符
 p  re
group 2 bgroup  可以 一次 传递多个 组号 在这 种情 况下 它 将 返回 一 个包 含这些 组的 相 应值 的元 组
 m
group 212 b  abc  bgroups 方 法 返回一个 元 组其 中 包含 所 有子组的字 符串 从1到 最后 一个子组
 m
groups  abc  b 模式 中 的 后向 引用 允许你 指定 还 必 须 在 字符 串中 的 当 前 位 置找到 先 前捕 获组 的内容
例 如如果可 以在当 前位 置 找到组1的 确 切内 容 则1将 成 功否则将失 败
请 记住 python  的字 符串文字也使 用 反 斜杠 后跟 数字以 允许 在 字 符 串 中包 含任 意 字 符 因 此正则 中 引入 反向 引用时务 必使用原 始字符 串
例 如以 下 正 则检测 字符 串中 的 双 字
 p  re
group  the  the 像 这 样的 后 向引 用通 常不 仅仅 用于 搜 索字符串—— 很 少有 文 本 格 式以这种 方 式重 复数 据——但 是你很 快 就 会发 现它 们在 执 行字符串 替换 时 非常 有用
非 捕获和命名组
 精心 设 计的 正则可 以使 用许 多 组既可以 捕获 感兴 趣的 子串 也可 以 对 正则 本 身 进行 分 组和构建
 在复 杂的 正 则中 很 难跟踪 组号
 有两 个功能 可以 帮助 解决 这个问题
它 们 都 使用 常用语法 进行 正 则 表达式 扩展 因此 我们 首 先看一下
perl 5 以其 对标准正则表 达式的 强大补 充而 闻名
对于 这些 新 功能 perl  开发人员 无法选 择新的 单键 击元 字 符或 以开 头的 新 特 殊序 列否 则 perl 的 正 则表 达 式与标 准 正则 容易 混 淆
 例如如果他们 选择 作为 一个 新的元字符 旧 的 表达式 将假设 是一 个 普通字符 并且 不 会编写 或
perl  开 发 人 员 选 择 的解 决 方案是 使 用
作 为扩展 语 法
 括 号后面的 是一 个语法 错误 因 为 没有 什么可重复 的所 以 这 并没 有 引入任 何兼容 性问 题
紧跟在之 后 的 字 符表 示正在 使 用 什么 扩展名所 以 foo  是 一个东西 一个 正向的先 行断言和 foo  是其 它东 西包含子 表达式 foo  的 非捕获组
python  支 持一 些 perl 的 扩 展并 增加 了新的扩 展 语法用于 perl  的 扩展语 法
 如 果在问号之 后 的 第一个字 符 为 p 即 表明其为 python  专属 的扩 展
现在 我们 已经 了 解了一般 的扩 展 语 法我们 可以 回到 简化复 杂正 则 中组处 理 的 功能
有 时你会想 要使用组 来表 示正则 表达 式 的一部 分但是 对检索组 的 内 容不感兴 趣
你 可以通 过使 用非捕 获 组来显 式表 达这 个事 实
你 可以用 任何 其 他正则 表 达式 替换

 m  re
groups  除 了你无 法检 索组匹 配内 容 的事 实 外非 捕获 组的行为 与捕 获组完全 相同 你可 以 在里面 放任何东西 用重 复 元字符重复 它 比如 然 后 把 它嵌 入 其 他 组捕 获或 不捕 获
在修改现 有模 式时 特别 有 用 因为 你 可 以 添加新 组而 不更 改所有其 他组 的编号 方 式
值 得 一 提 的是捕获和 非捕获 组之 间的 搜索 没有 性 能差 异两 种形式没 有一种更快
 更重要的功能 是命 名组不 是通过 数字 引用 它们 而 是 可 以通 过名 称引用 组
命 名组的语 法是 python  特 定 的 扩 展之一 pname
 name 显然 是该 组的名称
 命名组的 行为 与 捕 获 组 完全 相 同 并且 还将名 称与组 关联
 处 理捕 获组 的匹配对 象方 法都 接 受按 编号 引用 组的整 数或 包含 所 需组 名的 字符串
 命名 组仍 然是给定 的数 字因此你 可 以通 过两 种方 式 检索有关 组的 信 息 p  re
group 1 lots 此 外你可 以通 过 groupdict 将 命 名 分组 提取 为一 个字 典 m  re
groupdict  first  jane  last  doe  命名 组很 有用 因为 它 们 允 许 你使 用容 易记 住的 名称 而不 必记 住数字
这 是来 自 imaplib 模块的 示 例正 则 internaldate  re
compilerinternaldate  rpday 12309 pmonazazaz  rpyear 09090909 r  phour 0909 pmin 0909 psec 0909 r  pzonenpzoneh 0909 pzonem 0909 r 检 索 m
groupzonem 显 然 要容易得 多 而 不必 记住检索第9组
 表 达式 中的 后向 引 用 语法例如
1指 的是 组的 编号
 当然 有一 种变体使 用组 名而不是 数 字
这 是另 一个 python  扩展 pname  表 示在 当前 点再次 匹配 名 为 name 的 组的内 容
用于查 找双 字 的 正 则 表达 式 bws 1 b 也 可以写 为 bpwordwspwordb  p  re
 前 向断 言
 修改字 符串
 到目 前 为止 我 们只 是针对静 态 字符串 执 行搜索
 正则 表 达式 通 常也用 于以各种 方 式修改 字 符串使 用以下模 式方法方 法属 性 目的 split 将 字符串拆 分为一个 列表在正 则 匹配的 任 何地方 将其拆分 sub  找到 正则 匹 配 的所 有子 字符 串并 用不同的 字符 串替 换它们 subn  与 sub  相 同但 返回 新字 符 串和 替换 次数
 分割 字符串
模 式的 split 方 法在 正则 匹配的任 何 地方 拆分 字符 串返 回一 个 片 段列表
 它 类似于 split  字符串 方 法 但 在 分隔符的 分 隔符中 提供 了 更 多的 通用 性字 符串的 split  仅支 持按空 格或 固定字符 串进行 拆分
 正如你 所期望的 那样还有一 个模块 级 re
split 函 数
splitstring  maxsplit 0 通过 正则 表 达式 的 匹配 拆分 字 符串
 如果 在正 则中 使用捕 获括 号则它们 的内 容也 将 作为结果 列表 的一 部分返 回
如 果 maxsplit 非 零 则 最多 执 行 maxsplit  次 拆 分
 你 可以通 过 传 递 maxsplit  的 值 来 限 制分 割的 数量
当 maxsplit  非零 时将 最多 进行 maxsplit  次拆 分并且 字符 串的其余 部分将 作为 列表 的最 后 一 个 元素 返回
在以 下示 例中分 隔符 是任何非 字母 数 字 字 符 序列
 p  re
 有时 你 不 仅对 分隔 符之间 的 文 本 感兴 趣 而 且还 需要 知道分隔 符 是什么
 如 果 在正 则 中使 用捕 获括号 则它 们 的值 也 将作为 列表 的 一部 分 返回
比 较 以 下调 用 p  re
模块 级函 数 re
split  添加 要 正 则 作为第 一个 参 数 但 在其 他方面 是相 同的
 re
 搜 索和 替换
常见 问题
 正则表 达式 对于某些 应用 程 序 来 说是 一个 强大的 工具 但在 某 些方 面 它 们的 行为 并不直观 有时它 们 的 行为方式与你 的 预 期不 同
本 节将 指出 一些最常 见的陷 阱
 使 用 字符 串方法
 有时使用 re  模块 是一 个 错 误
如果 你匹 配固 定字符串 或单个 字 符类并 且 你没 有使 用任何 re  功能 例 如 ignorecase 标 志那 么正 则表 达式 的全 部 功能可能 不是 必需 的
字 符串 有几 种方法可以使 用 固定 字 符 串 执 行操 作它 们通 常要 快得 多因 为 实 现是 一 个 针对此目 的而 优 化 的单 个小 c 循 环而 不是大 型、 更 通 用的 正则 表达 式引 擎
 一 个例子 可能 是用 另一 个固 定 字符串 替换 一个固定 字 符 串例如你 可以 用 deed  替 换 word 
 re
sub  看 起 来像 是用于此 的函 数 但 请考虑 replace  方 法
注 意 replace  也 会替 换单词 里 面 的 word  把 swordfish  变成 sdeedfish 但 简单的 正 则 word  也 会这 样做
 为了避 免 对单词的 部分进行 替换 模式 必须 是 bwordb  以便要求 word  在 任何 一方都 有一 个单 词 边界
 这使 得 工 作 超出 了 replace  的能 力
另一个 常 见任务是从 字符 串中 删除单 个 字符 的每 个匹配 项或 将其 替换 为另 一 个 字符
 你 可 以用 re
subn  s 之 类的 东 西 来做 这件事 但是 translate  能 够 完成这两项 任务 并且 比任何正 则 表达 式 都快
 简 而 言 之在 转向 re  模块 之 前请 考虑 是否 可以使用 更快 更简 单 的字 符 串 方法 解决 问题
match  和 search
matchsuper  insuperable  none  另一方面 search 将 向前扫描 字符串报告 它 找到的第 一 个匹配 项
 printre
span 27有 时你 会被诱 惑 继续 使用 re
match  只需 在你 的 正 则前 面添 加

 抵 制 这 种诱 惑并 使用 re
search  代替
 正则表 达式 编译 器对 正则 进行一些 分析 以 加快 寻找匹 配的 过程
 其中 一个 分析 可以确 定匹 配的 第一 个特 征 必须 是什 么例如 以 crow 开头 的模 式必须 与 c 匹配
 分 析让 引擎 快速 扫 描字符 串寻 找 起始 字符 只在 找到 c 时 尝试 完 全匹配
添加
会 使这个优 化失 效 需 要扫 描到 字符 串的末尾 然后 回溯以 找 到 正则的 其余 部分 的 匹配
使用 re
search 代 替
 贪 婪 与非 贪婪
 当重 复一个 正则表达 式时就 像在 a  中一 样 最终的 动作 就 是消耗 尽可 能多 的模 式
当你 尝 试 匹 配一 对对称分隔 符例如 html  标记 周围 的尖 括号 时 这个 事实 经常会 让你 感 到 困惑
 因为
 的 贪 婪性 质 用于 匹配 单 个 html 标 记 的简单 模 式不 起作 用
group  htmlheadtitletitletitle  正则匹配 中的 html 和
 消耗 字 符串的 其 余 部分
 正则 中 还 有更 多 的 剩 余东西 并且 在 字符 串 的末尾 不能 匹 配 所以正则 表达 式引擎 必须 逐 个 字 符地回 溯 直 到 它找到匹 配
 最终匹 配 从 html  中 的扩 展 到 title  中的 而 这 并 不是 你想 要 的结果
 在这种情 况下 解 决 方案 是 使用 非 贪 婪的 限 定符、、 或 mn 匹配 为尽 可 能少 的文 字
 在 上 面 的例 子中在 第 一 次匹 配后 立 即尝试 当 它 失 败时 引 擎 一 次前进一 个 字符 每一 步都重试
 这产 生 了正确 的 结果 printre
group  html 请 注意 使用 正 则表 达 式 解析 html  或 xml 很 痛苦
快而 脏的 模 式 将 处 理常 见 情 况但 html 和 xml 有 特 殊 情况会破 坏 明显的 正则 表 达式当 你编 写正 则 表达式 处理 所有 可能 的情况时 模 式 将非 常复 杂
使 用 html  或 xml  解析器 模块 来 执 行 此 类 任务

使 用 reverbose
到目 前 为 止 你 可能 已经注意 到 正则表达式 是 一 种 非常 紧 凑 的表 示法 但 它们并不是 非 常 易 读
 具 有中等 复 杂度的 正则 可能 会 成 为反 斜 杠、 括号 和元 字 符 的 冗 长 集合使 其 难 以 阅读 和理 解
 对于 这样的正 则在 编 译 正则 表 达 式时 指 定 re
verbose  标志可 能 会有 所帮助 因为 它允 许你 更清 楚 地格式化 正 则 表 达 式
re
verbose 标 志 有几 种效 果
 正 则 表 达式 中的 不是在 字符 类中 的空格 将 被忽 略
 这 意味 着 表 达 式 如 dog  cat  等同 于不太 可读 的 dogcat  但 a  b  仍将 匹配 字 符 a 、 b  或空格
 此外 你还 可以 在正 则中放 置注 释 注释 从字 符扩 展到 下 一 个换行 符
当 与三 引号 字符 串 一 起使 用时 这使 正 则的格 式更 加整齐 pat  re
verbose  这 更 具有可 读性 pat  re
 反馈
正则表 达式是 一 个 复杂的 主 题
这份文档 是否有助于 你理解它们？ 是否 存在不 清楚 的部分或 者你遇到的 问题未 在此 处涉及？如 果是请向作 者发送 改进 建议
关于 正则表达 式的最完整 的书几 乎肯 定是由 oreilly 出 版的 jeffrey  friedl 的 mastering  regular  expressions 
不 幸的是它专 注于 perl 和 java  的正 则表达式 并且根本 不包含任何 python  材料因此它 不能用作 python  编程 的参考
第 一版涵盖 了 python  现 在删 除的 regex  模 块 这对你没 有 多大帮 助
 考虑从 你的 图 书 馆 中查 找 它
套 接字编 程 指 南
作 者 gordon  mcmillan  摘 要套 接 字几乎 无处不 在 但是它却 是被 误解 最 严 重的技 术 之 一
 这是 一篇简单 的套 接 字 概述
 并不是一 篇 真 正 的教 程——你 需 要 做 更多的 事 情 才能 让 它工作 起来
 其中 也 并 没有 涵盖细节 细 节会有 很 多但是 我希 望它能提 供足 够 的 背 景知 识让 你像 模 像样的开 始使用套 接 字
套接 字
历史
创 建 套 接字
 进程间通 信
使 用一 个套 接字
二 进 制 数据
通过套 接字 传送二 进 制数 据是可 行 的
 主要 问题在 于并 非所 有机器 都用 同样 的二 进制 数 据格 式
比 如 motorola  芯 片用 两个 十 六 进制字节0001来 表示一 个16 位 整数 值1
 而 intel  和 dec  则会做字 节反 转—— 即用0100来表 示1
 套接字 库 要求 转 换16 位 和32位 整数—— ntohl  htonl  ntohs  htons  其中 的「 n 」表示 network 「 h 」 表示 host 「 s 」 表 示 short 「 l 」表 示 long
 在 网络 序列就 是主机序 列 时它 们什 么都 不做 但 是如 果机 器是字 节反 转 的则 会 适当 地 交换 字节 序
 在现今 的32位 机 器中 二 进制 数据 的 ascii  表示往 往比 二 进制 表 示要 小
这 是 因 为在 非常 多的 时 候所 有 long  的 值均 为0或者1
 字符 串 形式 的0为两 个字 节 而二进制 形式则为 四个
 当然 这不 适 用 于固 定长度 的信 息
自 行决定 请自 行 决定
 断开 连 接
严 格地 讲 你 应该 在 close 它 之 前 将 套接 字 shutdown 
 shutdown 是 发 送给 套接 字另 一 端 的一 种建 议
调 用时参 数不 同意 义也不 一样 它可 能意 味着「 我不 会 再 发送了 但我 仍 然 会 监听」 或者「 我没 有监 听 了真 棒」
然 而 大 多 数 套 接字 库或 者 程序员 都 习惯 了 忽略 使 用 这 种礼 节 因为通 常情 况下 close 与 shutdown  close  是 一 样的
所 以 在大 多数 情 况 下不需 要显 式的 shutdown 
高效 使 用 shutdown 的 一种 方 法是 在 类 似 http 的 交换 中
客户端 发送 请 求 然后执 行 shutdown 1
这 告诉服 务器 此客 户端 已 完成发 送 但仍 可以 接收
服 务器可 以通过接 收0字节 来检 测 eof 
它可 以 假 设它 有完 整的 请求
 服务 器 发送 回复
 如 果 send 成功 完成那么 客户 端仍在 接 收
python 进一步 自动 关 闭 并说 当 一 个 套 接字 被垃 圾收集 时 如 果 需 要 它会自动 执行 close 
 但依 靠 这个机 制是一 个非常 坏的 习惯
 如果 你 的 套 接 字 在 没有 close  的 情况 下就 消失 了那么 另一 端的套 接字 可 能会 无限期地 挂起以为 你只 是慢 了 一步
 完成后 请 close 你的 套接 字
套接字何 时销毁
 使用阻 塞套接 字最 糟糕 的事 情可 能 就 是 当 另一 边 下线 时没 有 close 会 发生什 么
你 的套接 字可 能 会挂 起
 tcp 是一种 可靠的协 议它 会 在放 弃连接 之前等 待很长 时 间
 如果 你正在使 用线 程那么 整个 线程 基本 上已经 死了
你无 能 为 力
只 要 你没 有做 一 些愚 蠢 的事 情 比 如在 进 行阻 塞读取 时持 有一 个锁那 么线 程并 没有真正 消耗掉资 源
不 要尝 试 杀死 线程——线 程 比进 程更有效 的 部分原 因 是它们 避免 了与 自 动 回收资 源相 关 的开销
换 句 话说 如果 你 设 法杀 死线 程 你 的整个进 程很可能被 搞坏
 非 阻塞 的 套 接字
 排序 指南
 作 者 andrew  dalke 和 raymond  hettinger  发 布版 本0
1 python  列表 有 一 个内 置的 list
sort  方法 可 以 直接修 改 列 表
 还有一 个 sorted 内置 函数它会 从一个可 迭 代对象 构建 一 个新 的排序 列表
 在本文档 中我们 将探 索使用 python  对数据进 行排 序的 各 种 技术
 基本排 序
关 键函 数
list
sort  和 sorted 都 有一个 key  形参 用来 指定在 进行 比 较前 要在每 个列 表元 素上 调 用 的函 数或其 他可 调用对 象
例 如下 面是 一个 不区 分 大小 写的字 符串 比较 sortedthis  is  a  test  string  from  andrew
lowera  andrew  from  is  string  test  thiskey  形参 的值 应该 是个函 数或 其 他可 调用对 象它 接 受 一 个参 数并返回 一个 用 于排序 的 键
这 种机 制 速 度很 快因 为对 于每 个输入记 录只会 调用一 次键 函 数
一 种常 见的 模式是 使用 对象 的一 些 索引作为 键对 复 杂对象 进 行排 序
例 如 studenttuples 
 sortedstudenttuples  keylambda  student  student 2 sort  by  agedave  b 10 jane  b 12 john  a 15同 样 的技 术也 适用 于具有命 名属性 的对 象
例如 class  student
operator 模块函 数
上 面显 示的 键 函 数模 式非 常常 见因 此 python 提 供了 便利 功能 使 访 问器功 能 更容 易 更 快捷
 operator 模 块有 itemgetter 、 attrgetter  和 methodcaller  函 数
 使用 这些函 数 上 述 示 例 变得更 简 单 更 快捷 from  operator  import  itemgetter  attrgetter  sortedstudenttuples  keyitemgetter 2 dave  b 10 jane  b 12 john  a 15 sortedstudentobjects  keyattrgetteragedave  b 10 jane  b 12 john  a 15 operator  模块 功 能 允 许多 级排 序
例 如按 grade  排 序 然后按 age 排 序 sortedstudenttuples  keyitemgetter 12 john  a 15 dave  b 10 jane  b 12 sortedstudentobjects  keyattrgettergrade  agejohn  a 15 dave  b 10 jane  b 12
升 序 和降序
list
sort  和 sorted 接受 布尔 值 的 reverse  参数
这 用 于 标记 降序 排 序
例 如 要以 反向 age  顺序获取 学生数 据 sortedstudenttuples  keyitemgetter 2 reversetruejohn  a 15 jane  b 12 dave  b 10 sortedstudentobjects  keyattrgetterage  reversetruejohn  a 15 jane  b 12 dave  b 10
排 序 稳定性 和 排 序 复 杂度
排序 保 证是 稳定 的
 这 意 味 着 当 多个 记 录具 有相 同的键 值时 将 保留 其 原始 顺序
 data  red 1 blue 1 red 2 blue 2 sorteddata  keyitemgetter 0 blue 1 blue 2 red 1 red 2注 意 blue 的 两个 记 录如何 保留它 们 的 原 始顺 序以 便 blue 1 保证 在 blue 2之 前
 这个美 妙 的 属性 允 许你 在 一系 列 排序步骤 中 构建 复杂 的排序
例 如要 按 grade 降 序 然 后 age 升序 对 学 生数 据进行 排 序 请先 age 排 序 然后再使 用 grade 排 序 s  sortedstudentobjects  keyattrgetterage  sort  on  secondary  key  sorteds  keyattrgettergrade  reversetrue  now  sort  on  primary  key  descendingdave  b 10 jane  b 12 john  a 15 这 可 以被 抽象 为一 个包装 函数 该函 数 能 接 受 一个列 表 以及字 段 和 顺序 的元 组 以 对它们 进行多重 排序
 return  xs  multisortliststudentobjects  grade  true  age  falsedave  b 10 jane  b 12 john  a 15 python  中使 用 的 timsort  算 法 可以 有 效地 进行 多种排 序 因 为 它可 以 利 用数据 集中 已存 在的 任 何 排序
使 用 装 饰排 序去 装 饰的旧方 法
这 个三 个步 骤被 称 为 decoratesortundecorate 首 先 初 始列 表使 用控制 排 序 顺 序 的 新值进 行修 饰
然 后装 饰列 表已排序
 最后 删除 装 饰创 建一 个 仅包 含 新排序 中初 始值 的列 表
例 如要 使 用 dsu 方法 按 grade 对学 生数 据进 行排 序 decorated  student
sort  student  for  grade  i  student  in  decorated  undecoratejohn  a 15 jane  b 12 dave  b 10这 方 法 语有 效 是因为 元组 按字 典 顺 序进行 比 较 先比较 第一 项如果 它 们 相 同 则比 较 第 二 个 项目依 此类推
不 一定 在 所有情 况下都 要在 装饰 列表 中 包含 索 引 i 但 包 含它 有两 个好 处排 序 是稳定 的——如 果两 个项具 有相 同的键 它 们 的顺 序 将保 留在 排序 列表 中
 原 始项 目不 必具 有可 比性因 为装饰 元组 的排序 最多 由前 两项 决 定
 因此 例如 原 始列 表可能包含 无法直 接排 序的 复 数
这个方 法的另 一个名字 是 randal  l
 schwartz 在 perl  程 序员中 推广 的 schwartzian  transform
既然 python 排 序 提 供 了 键函 数那么 通 常 不 需 要这 种技术
 使用 cmp  参 数的 旧方法
 本 howto 中 给出 的许 多结 构 都 假定为 python 2
4 或 更 高 版 本
 在此 之 前没有 内置 sorted  list
sort 也 没有 关 键字 参数
 相反 所有 py 2
x  版 本 都支 持 cmp 参数来 处 理用 户指 定 的 比 较函 数
在 py 3
0中 cmp  参 数被完全 删除作为 简化 和 统一语 言努 力 的一 部 分 消 除 了丰富的 比较 与 cmp 魔术 方 法 之间 的冲突
 在 py 2
x  中 sort  允许 一个可选 函 数 可以 调 用它 来进行 比 较
该 函数 应 该采 用两 个 参数 进 行 比较然后 返回负 值为小于如 果它们 相 等则 返 回 零 或 者 返回 大于大 于的正值
 例如 我们可 以这 样做 def  numericcomparex  y
 return  x  y  sorted 52413 cmpnumericcompare 12345 或 者 你可 反转比 较 的 顺序 def  reversenumericx  y
 return  y  x  sorted 52413 cmpreversenumeric 54321将代 码从 python 2
x  移植 到3
x  时如果用 户提 供比 较功 能并 且需要 将其 转换为 键函数则 会出 现 这种 情况
以 下包 装器 使这 很容 易 def  cmptokeymycmp  convert  a  cmp  function  into  a  key  function  class  k  def  initself  obj  args  self
obj 0 return  k  要转换为键 函数只 需包装 旧 的比 较 函 数 sorted 52413 keycmptokeyreversenumeric 54321在 python 3
2 中 functools
cmptokey 函 数 被添 加到标准 库 中的 functools  模块 中
其 它
对 于 区 域 相关的排序 请使 用 locale
strxfrm 作 为 键 函 数 或者 locale
strcoll  作为 比 较函 数
 reverse  参 数 仍然 保持 排序稳 定性 因 此具 有 相 等 键 的记 录 保 留原始 顺序
 有 趣 的 是 通 过使 用 内 置的 reversed 函 数两 次可以在 没有参数的情况 下 模拟该 效果 data  red 1 blue 1 red 2 blue 2 standardway  sorteddata  keyitemgetter 0 reversetrue  doublereversed  listreversedsortedreverseddata  keyitemgetter 0 assert  standardway  doublereversed  standardway  red 1 red 2 blue 1 blue 2在 两个 对象之间进 行 比较时 保 证排 序例 程使用 lt 
 因此 通过 定 义 lt 方法可 以 很 容易地 为类添 加 标 准 排序顺 序 student
age  sortedstudentobjects  dave  b 10 jane  b 12 john  a 15键 函数不需 要 直接 依赖 于被排序 的 对象
 键 函 数还 可以 访 问 外部资源
 例如如果 学 生成 绩 存 储在字 典 中则 可 以 使 用 它们 对单 独的学 生 姓 名列表进 行 排序 students  dave  john  jane  newgrades  john  f  janea  dave  c  sortedstudents  keynewgrades
unicode  指南
 发布版本1
12 本指 南讨 论了 python  对于 表 达文 本数 据的 unicode 规范 的支 持 并且 解 释 了人 们试 图 使用 unicode  时 经 常遇到的 问题
unicode 概 述
定义
 编码
上一段 可 以 归结 为一 个 unicode  字符 串 是一系 列码位 从0到0 x 10 ffff  或者 说 十进 制的1114111 的数字 组成的序列
 这一序 列在内 存 中需 要被表 示为 一组 码元然 后码 元 会对应 到包含八个 二进制 位 的字 节
将 unicode  字符 串 翻译 成字 节序 列 的规 则被称为 字符 编码 或 者编码
 你 可能 会想到的 第一种 编码是使用 一个32 位的 整数 来 代 表一个 代码位 然后 使 用 cpu  对32位 整 数的表 达方 式
在 这 一表 达方 式中 字符 串 python 可 能 看起 来像 是这 样 p  y  t  h  o  n 0 x 500000007900000074000000680000006 f 0000006 e 00000001234567891011121314151617181920212223 这个表 达方式 非 常直 接但同 时也 存在 一些 问 题
 不够 方便 不同的处 理器 对 字 节的排 序 不同
 非常浪 费空 间
 多 数编 码都小于127 或者255所以 很多空间 都 是0 x 00
上 面的 字符 串 takes 24 bytes  compared  to  the 6 bytes  needed  for  an  ascii  representation
 increased  ram  usage  doesnt  matter  too  much  desktop  computers  have  gigabytes  of  ram  and  strings  arent  usually  that  large  but  expanding  our  usage  of  disk  and  network  bandwidth  by  a  factor  of 4 is  intolerable
 引用文 献
pythons  unicode  support
the  string  type
python  comes  with  roughly 100 different  encodings  see  the  pythonlibrary  reference  at  标 准 编 码 for  a  list
 some  encodings  havemultiple  names  for  example  latin 1 iso 88591 and 8859 are  all  synonyms  for  the  same  encoding
converting  to  bytes
unicode  literals  in  python  source  code
unicode  properties
comparing  strings
unicode  regular  expressions
引用 文献
the  str  type  is  described  in  the  python  library  reference  at 文 本 序 列 类型 str
reading  and  writing  unicode  data
unicode  filenames
tips  for  writing  unicodeaware  programs
 引 用文 献
 致 谢
howto  使用 urllib  包获取网 络 资源
作者 michael  foord  注解 这份 howto 文 档的 早期 版 本有 一份 法 语的 译文 可在 urllib 2 le  manuel  manquant 处 查 阅
 概 述
提 取 url
 数据
 有时 候 你 想 要给 一个 url 发 送 数 据 通常这个 url  指向一个 cgi  通用网关 接 口脚本或者其 他 web  应用
 对于 http 这 通常 使 用 一 个 post  请 求来 完 成
比如 在 浏览 器上 提交 一个 html  表 单
但并 不 是 所 有的 post  都来 自表 单你 能使用一个 post  来传 输 任何 数据 到你 自己 的应 用 上
在 使 用 常 见 的 html 表单的 情况下 数据 需要 以 标准 的方 式 编 码然 后再作为 data  参 数传 给 request  对 象
 编码 需要使 用一个 来自 urllib
parse  库 的 函数
 具 体 操 作如 下 import  urllib
headers
 处理 异 常
异 常类从 urllib
error  模块 中导出
urlerror
httperror
包 装起来
数 字1 from  urllib
reason  else  everything  is  fine  注解 the  except  httperror  must  come  first  otherwise  except  urlerror  will  also  catch  an  httperror
info  and  geturl
由 urlopen  或者 httperror 实 例 所返 回的响 应包 含两 个 有 用的 方 法 info  和 geturl 该 响应 由 模 块 urllib
response  定义
geturl  返回 所获 取页 面 的 真 实 url
该方 法 很有 用因为 urlopen 或 者所 使用 的 opener 对 象 可能 回包括一次 重定 向
所 获取 页面 的 url  未必就 是 所请 求的 url 
info 该方 法 返回 一 个 类似 字典 的 对象 描 述了 所 获取 的页 面特别 是由服 务器 送 出 的头 部信 息 headers 
 目前它 是一 个 http
httpmessage  实例
openers  and  handlers
基 本 认证
 代理
installopeneropener  注 解 currently  urllib
注解 httpproxy  will  be  ignored  if  a  variable  requestmethod  is  set  see  the  documentation  on  getproxies
sockets  and  layers
 脚 注
这 篇文 档由 john  lee  审 订
1 例如 google
安 装 python  模块 旧版
作 者 greg  ward 参 见安 装 python 模 块 最新 的模 块 安 装文 档
对于 常规 python  使用你 几乎 肯 定 像 使 用该文 档 而非 这 个
 注 解这 篇文 档只 有在 httpssetuptools
html 上的 setuptools  文档 独立 涵 盖此处 包 含 的 所 有相关 信息 之 前 才 会单 独保 留
 注解 本指南 仅 介 绍 构建 和 分 发 扩展 的基本 工 具这 些扩展 是 作为此 python 版 本 的一部 分 提 供的
第 三方工 具提供 更 易 于 使用 和 更 安全的 替代 方案
 有关 详 细 信息 请参 阅 python 打 包 用户 指南 中的快 速推 荐 部 分
概 述
在 python 2
0 中 distutils  api 首 次 被 添加 到 标准 库 中
这 向 linux  发 行版 维 护者 提供 了一 个将 python 项目 转 换为 发 行 版软 件 包的 标准 方 法 以 及向系 统 管 理员们 提供了直接 将 这些软 件 包 安 装到 目 标 系统的 标 准 方 法
see 安 装 python  模块 and  分 发 python  模 块 for  more  details
distutils  based  source  distributions
standard  build  and  install
platform  variations
splitting  the  job  up
how  building  works
how  installation  works
 onunix  and  mac  os  x  which  is  also  unixbased  it  also  depends  onwhether  the  module  distribution  being  installed  is  pure  python  orcontains  extensions  nonpure  平 台 标准 安装 位置默 认值 注 释单一 unix  prefixlibpythonx
ysitepackages 1 类 unix  execprefixlibpythonx
ysitepackages 1 windows  prefixlibsitepackages  cpythonxylibsitepackages 2 注 释1
 if  youwant  to  customize  your  installation  directories  more  heavily  seesection  自定义 安 装 on  custom  installations
alternate  installation
alternate  installation  the  user  scheme
 here  are  the  values  for  unix  including  mac  os  x 文 件类 型安装 目录模 块 userbaselibpythonx
ysitepackages  脚本 userbasebin 数 据 userbase  c  头文 件 userbaseincludepythonx
yabiflagsdistname 以下 是 windows 上 使用 的值文 件 类 型安 装 目 录模 块 userbasepythonxysitepackages  脚本 userbasepythonxyscripts  数据 userbase  c  头文 件 userbasepythonxyincludedistname  the  advantage  of  using  this  scheme  compared  to  the  other  onesdescribed  below  is  that  the  user  sitepackages  directory  is  undernormal  conditions  always  included  in  sys
alternate  installation  the  home  scheme
 filesare  installed  to  the  following  directories  under  the  installation  baseas  follows  文件 类型 安装 目录 模 块 homelibpython 脚 本 homebin 数 据 home  c  头 文 件 homeincludepythondistname  mentally  replace  slashes  with  backslashes  if  youre  on  windows
alternate  installation  unix  the  prefix  scheme
 files  areinstalled  as  follows 文 件类 型安装目 录 python 模 块 prefixlibpythonx
ysitepackages 扩展模 块 execprefixlibpythonx
ysitepackages  脚本 prefixbin  数据 prefix  c 头文件 prefixincludepythonx
alternate  installation  windows  the  prefix  scheme
 files  are  installed  as  follows  文件 类 型安装 目 录 模 块 prefixlibsitepackages  脚本 prefixscripts 数 据 prefix  c 头文件 prefixincludedistname 
 自定 义安 装
to  create  a  custom  installation  scheme  you  start  with  one  of  thealternate  schemes  and  override  some  of  the  installation  directoriesused  for  the  various  types  of  files  using  these  options  文件 类型 覆盖 选项 python  模 块 installpurelib 扩展模 块 installplatlib 所有 模块 installlib 脚 本 installscripts 数据 installdata  c 头 文件 installheaders  these  override  options  can  be  relative  absolute  or  explicitlydefined  in  terms  of  one  of  the  installation  base  directories
plat  installscriptspythonscripts  installdatapythondata 或 者等价于 python  setup
plat  installscriptspythonscripts  installdatapythondata 或 者等 价于 install  installbasehomepython  installpureliblib  installplatliblib
 注 解 when  a  virtual  environment  is  activated  any  options  that  change  the  installation  path  will  be  ignored  from  all  distutils  configuration  files  to  prevent  inadvertently  installing  projects  outside  of  the  virtual  environment
modifying  pythons  search  path
distutils  configuration  files
location  and  names  of  config  files
 on  unix  and  mac  os  x  the  three  configuration  filesin  the  order  they  are  processed  are 文件 类型位置 和文 件 名 注 释 system  prefixlibpythonverdistutilsdistutils
cfg 3 and  on  windows  the  configuration  files  are 文件类型 位置 和文件 名注 释 system  prefixlibdistutilsdistutils
 注释1
syntax  of  config  files
building  extensions  tips  and  tricks
tweaking  compilerlinker  flags
using  nonmicrosoft  compilers  on  windows
参 见 cbuilder  compiler  information  about  the  free  c  compiler  from  borland  including  links  to  the  download  pages
参 见 building  python  modules  on  ms  windows  platform  with  mingw  information  about  building  the  required  libraries  for  the  mingw  environment
 脚注1 this  also  means  you  could  replace  all  existing  cofflibraries  with  omflibraries  of  the  same  name
2 欲 了解 更多 信息 请查 阅 httpswww
orgcygwin 和 httpwww
org 3 then  you  have  no  posix  emulation  available  but  you  also  dont  need  cygwin 1
安 装 python 模 块
电 子 邮箱 distutilssigpython
org  作为 一个流 行的开 源开 发项 目 python  拥 有一 个活 跃的贡 献 者 和 用户 支持 社区 这 些社 区也可 以让 他 们的 软件可 供其 他 python 开发 人员 在开源 许 可条 款 下 使用
 这允许 python  用 户有效地 共 享和 协作从 其他人 已 经 创 建的解 决 方案中 受益 于常 见 有 时甚 至 是罕见 的问 题 以及可 以提供 他 们自 己的 解 决 方案
 本指 南涵 盖 了分发部分 的流 程
有 关 安 装 其他 python  项 目 的 指南 请 参阅 安装指 南
 注解 对于 企业 和其他 机 构用 户请 注意许 多组 织都 有 自己 的 政策 来使用和 贡献 开源 软 件
在 使用 python 提 供 的分发 和安 装工 具 时请考虑 这些 政策
 关键 术语
 pip  是 首选的 安装 程序
 从 python 3
4开始它默 认 包含在 python  二 进 制安 装 程 序中
 virtual  environment 是 一 种半 隔离 的 python 环 境允 许为 特 定 的应 用 安装各 自 的包 而不 是安 装到 整个 系统
 venv  是创建虚 拟环境 的标 准工具从 python 3
3 开始成为 python 的 组成 部 分
从 python 3
4 开始它会默 认 安装 pip 到所 创建的 全部虚拟 环境
 virtualenv 是 venv  的 第三 方替 代及 其 前身
 它 允 许在 python 3
4 之 前的 版本中 使用 虚 拟 环 境 那 些 版 本或 是 完 全不 提 供 venv 或 是不会 自动 安装 pip  到所 创 建 的 虚拟 环 境
 python  packaging  index  是一个 由 python 用 户 向其他用 户发 布开 源 许可软 件包 的 公 共 仓库
 python  packaging  authority  是负责 标准打包 工 具 以 及 相关 元数据 和 文 件格 式标 准维 护与 改进 的开 发人 员 和文 档 作者 团 队
他 们 基于 github  和 bitbucket 这 两 个 平 台维 护 着各 种工 具、文 档 和问 题追 踪 系统
 distutils  是 最初 的 构建 和分发 系统 于1998年首 次加 入 python 标 准 库
 虽然 直 接 使用 distutils  的 方 式 已被 淘 汰它 仍然 是当 前打 包和 分 发架 构的基 础 而 且 它 不 仅 仍然 是 标准 库 的 一 部分这 个名 称还以其 他方 式存 在例如 用于 协 调 python 打 包标准 开发 流程 的邮件列 表就 以 此 命 名
 在3
5版 更改 现在 推荐 使用 venv  来创 建虚 拟环 境
参 见 python  软件 包用 户指 南创建和 使用 虚拟 环 境
基本使 用
 标准打 包 工 具完全是 针 对 命令行 使 用方 式来设 计 的
以 下命 令将 从 python  packaging  index 安装一 个模 块的最 新版 本 及 其依 赖项 python  m  pip  install  somepackage  注解 对 于 posix  用 户包 括 mac  os  x 和 linux  用 户本指南 中 的示 例假 定使 用了 virtual  environment
对 于 windows  用 户本 指南 中的 示 例假 定 在安 装 python 时选 择 了修 改系 统 path 环境 变 量
在 命令 行 中 指 定一 个准 确 或 最小版本 也是 可 以的
 当 使用 比较 运算 符例 如或其 他 某 些可 以被 终端 所 解析 的 特 殊字 符 时 包名称 与 版 本 号 应当 用双 引号 括 起 来 python  m  pip  install  somepackage 1
4 minimum  version 通 常如 果一个 匹配的模块已安 装 尝试再 次安 装将 不 会有 任何 效果
 要升级 现 有模 块必须 显式地发 出请求 python  m  pip  install  upgrade  somepackage  更多 有 关 pip 及 其 功能的 信息 和 资 源 可以 在 python 软 件包 用 户指 南中 找 到
 虚 拟环 境的 创 建 可 使用 venv  模 块来完 成
 向已 激活 虚 拟环 境 安 装 软 件 包可使 用上 文所介 绍的 命令
 参 见 python 软件 包 用 户 指 南 安 装 python 分 发 包
 我 应 如何？
 这是 一些 常 见任 务的快速解 答或 相 关链 接
在 python 34 之 前的 python  版本中 安 装 pip ？
python  捆绑 pip 是 从 python 3
4才 开始的
对 于更 早的 版本 pip  需 要 引 导 安装 bootstrapped 具 体 说 明参 见 python  软件 包 用 户指南
 参见 python  软件 包 用 户指 南安 装软 件包 的 前提要 求
只 为 当前 用户 安装 软 件包？
 将 user 选 项传 入 python  m  pip  install  将 只 为 当 前用 户 而非为系 统 中 的所 有用 户 安 装软 件包
 安装科学 计算类 python  软 件 包？
许 多 科学计 算 类 python 软 件 包都有 复杂 的 二 进 制 编 译文 件依赖直接 使用 pip  安装 目 前并 不太 容易
 在 当 前 情 况 下通 过 其 他方式 而 非尝试 用 pip 安装 这些软件包 对用户 来说通 常 会更容易
参 见 python 软 件 包 用户指南 安 装科学 计算 类软件 包
使 用并行 安 装的 多个 python  版 本？
在 linux  mac  os  x 以 及 其他 posix 系 统中 使 用带 版本 号 的 python 命 令配 合 m  开 关 选 项来 运 行特 定 版 本的 pip  python 2 m  pip  install  somepackage  default  python 2 python 2
4 也 可以 使用 带特 定版 本号 的 pip  命令
 在 windows  中使 用 py  python  启 动器 命令配 合 m  开关 选项 py 2 m  pip  install  somepackage  default  python 2 py 2
 常见 的 安装 问题
 在 linux 的 系统 python 版本 上 安装
linux  系统 通常会将 某 个 python 版 本 作为 发行版的一 部 分包 含 在 内
将软 件包安 装到 这个 python 版 本上 需 要 系统 root  权限并 可能 会 干扰到 系 统包 管 理 器和其 他 系统 组件的运 作如 果这 些组件 在使用 pip  时 被 意 外升级 的话
 在这 样 的系 统上 通过 pip 安 装软 件 包通 常 最好是使 用 虚拟 环境 或分 用户 安装
 未安装 pip
 安装二进 制 编 译扩 展
python 通 常非 常 依赖 基于 源代码的 发布 方式 也就 是 期望最终 用 户 在 安装 过 程中使 用源 码 来编 译 生 成扩 展模 块
随着对 二进 制 码 wheel  格 式 支持 的引 入 以 及通 过 python  packaging  index  至少 发布 windows  和 mac  os  x 版的 wheel  文件 预计此 问题 将 逐步 得到 解决因 为用户将 能够 更频 繁 地安 装预 编译 扩展而 不再 需要 自 己编 译 它们
 某 些用 来 安装 科 学计 算 类 软件包 的 解 决方 案对 于尚 未提 供预 编译 wheel 文 件 的那 些扩 展模块来 说也 有 助于用户 在无 需 进 行本机 编译 的情 况下 获取 二进 制 码扩展模 块
 参见 python  软件包 用户指南 二进 制码扩 展
to 3自 动将 python 2 代 码转 为 python 3 代码
2 to 3 是一 个 python  程序 它 可 以读取 python 2
x 的 源代 码并使 用 一系 列的修复 器来 将其 转换 为 合法 的 python 3
x 代 码
标 准 库已 包含 了丰 富的 修复器 这足以处 理几 乎所有代 码
 不过2 to 3 的 支持 库 lib 2 to 3是 一个很 灵活 通 用的 库 所以还 可 以 编写 你自 己的2 to 3修 复器
 使用2 to
 修 复 器
lib 2 to 3——2 to 3 支 持 库
源 代码 liblib 2 to 33
10 版后 已移 除 python 3
9将 切 换到 peg 解 析器参见 pep 617 python 3
10 可 能会 包含 lib 2 to 3 的 ll 1 解 析器 所 不能 解 析 的 新语 法
lib 2 to 3模块 可能 会 在未来 的 python 版 本中被 移出 标准 库
请 考 虑使 用 第 三方 替 代例 如 libcst 或 parso
注 解 lib 2 to 3 api  并 不稳定 并 可能 在未 来大 幅修 改
abc  抽 象基 类
aifc 读 写 aiff  和 aifc  文 件
 通 用操 作系 统 服务
数据 压 缩和 存 档
本 章中描 述的模 块 支持 zlib 、 gzip 、 bzip 2 和 lzma 数 据 压 缩 算 法 以 及 创建 zip  和 tar  格式的归 档文件
 参见由 shutil  模块 提供 的 归 档 操 作
 zlib 与 gzip  兼容 的 压 缩 gzip  对 gzip  格式 的支 持 用 法示 例命令行 界 面命令行 选项 bz 2对 bzip 2压 缩算 法的支 持 文件 压 缩和 解压 增量 压缩 和解 压一次 性压 缩或 解 压 缩用 法示 例 lzma 用 lzma  算法 压 缩读 写压 缩文件 在内 存中 压 缩和 解压 缩数据杂 项指 定自 定义的过 滤器 链示 例 zipfile 使 用 zip 存档 zipfile  对象 path 对 象 pyzipfile 对 象 zipinfo  对象 命令行 界面 命令 行选项 解压 缩的障碍 由 于文件本 身文 件系 统 限制资源限 制 中断提 取 的 默认行为 tarfile  读 写 tar 归档文 件 tarfile 对 象 tarinfo 对 象 命 令行 界 面命 令行选项 示例 受支 持 的 tar 格式 unicode  问题
argparse  命令行选 项、参数 和 子命令解 析 器
3
2新版 功 能
源 代码 libargparse
py  教程此 页面 包含该 api  的参 考信 息
有 关 python 命 令行 解 析更 细致的 介 绍 请参阅 argparse  教程
argparse  模块 可以让 人轻 松编 写用 户友 好的命 令行 接口
程序 定 义 它 需 要 的参 数然 后 argparse 将 弄 清如何 从 sys
argv 解 析出 那些 参数
argparse 模 块还 会 自 动 生成 帮助 和 使用 手 册 并 在用 户给 程序传入 无 效参数时 报 出错误 信息
 示 例
 以 下 代码是 一个 python  程序它 获取 一 个整 数列表 并 计 算 总和 或者最 大 值 import  argparse  parser  argparse
integers  假设 上 面 的 python 代 码 保 存在 名为 prog
py  的文 件中它 可以在 命令行运 行并提供 有用 的帮助消 息 python  prog
 positional  arguments  n  an  integer  for  the  accumulator  optional  arguments  h  help  show  this  help  message  and  exit  sum  sum  the  integers  default  find  the  max 当 使用适当 的参 数 运行时它 会输 出 命令行传 入整数 的总和 或 者最大 值 python  prog
py 1234 sum 10 如果 传入无效 参数则会 报出 错 误 python  prog
py  error  argument  n  invalid  int  value  a  以下部 分将引 导你 完 成 这 个 示 例
 创建一 个解 析器
 使用 argparse  的第 一步 是创建 一 个 argumentparser  对象 parser  argparse
argumentparser 对象 包含将 命 令 行解析 成 python 数 据类 型所 需 的 全部信 息
添 加参 数
 给一个 argumentparser  添加 程 序参数信 息 是通过调 用 addargument 方法 完 成 的
通 常 这 些调用 指定 argumentparser  如何 获 取命 令 行字符串 并将其转 换为 对 象
 这些信 息在 parseargs 调 用时被 存 储和 使 用
 例如 parser
 helpsum  the  integers  default  find  the  max 稍 后调 用 parseargs 将 返回 一个 具有 integers  和 accumulate 两个 属 性 的对象
integers 属 性将是 一 个包含一 个或多个 整数 的 列 表 而 accumulate 属性 当命 令行 中指定了 sum  参数时将 是 sum 函 数 否 则则是 max  函数
解 析参数
argumentparser 通 过 parseargs  方 法 解 析 参数
它 将检 查命 令行 把每 个参 数转换 为 适 当的类型 然后调 用相 应 的操 作
在 大多数情 况 下这意 味着一个 简单 的 namespace 对象将 从 命令 行参 数中解析 出的属 性构建 parser
parseargssum 7142 namespaceaccumulatebuiltin  function  sum  integers 7142 在 脚 本中 通 常 parseargs 会被不 带参数 调用而 argumentparser  将 自动从 sys
argv 中确 定命 令行 参 数
argumentparser  对象
prog
默 认情况下 argumentparser 对 象使用 sys
argv 0 来确定如 何 在 帮助消 息中 显 示 程 序 名称
 这 一 默认值几 乎 总 是可取 的 因 为 它 将使 帮助 消 息 与 从命令行 调 用 此程序 的 方式相 匹配
例如对 于有如下 代码的名 为 myprogram
py 的 文 件 import  argparse  parser  argparse
parseargs  该程序 的帮助 信息将显示 myprogram
py  作为 程 序 名 称 无 论程序 从何 处被 调用 python  myprogram
py  h  foo  foo  optional  arguments  h  help  show  this  help  message  and  exit  foo  foo  foo  help  要更 改这 样的默 认 行 为可以使 用 prog 参数 为 argumentparser 提 供 另一 个值 parser  argparse
printhelp  usage  myprogram  h  optional  arguments  h  help  show  this  help  message  and  exit 需要注 意 的是 无论 是从 sys
argv 0或是从 prog  参 数确 定的 程序 名 称都可以在 帮 助 消息里 通 过 progs 格式串来 引用
usage
 默 认情况下 argumentparser 根 据 它 包含的参 数 来构建用法 消息 parser  argparse
 positional  arguments  bar  bar  help  optional  arguments  h  help  show  this  help  message  and  exit  foo  foo  foo  help  可 以通过 usage 关键 字参数 覆盖 这 一默 认消 息 parser  argparse
printhelp  usage  prog  options  positional  arguments  bar  bar  help  optional  arguments  h  help  show  this  help  message  and  exit  foo  foo  foo  help 在用 法 消息中可 以 使用 progs  格 式 说明 符 来填入程序 名称
description
大 多数 对 argumentparser 构 造 方法 的调 用 都 会使 用 description 关 键字参 数
这 个参 数简 要 描述这 个程 度做 什么 以 及 怎么做
 在 帮助 消息 中 这个 描述 会显示 在命令行 用法 字 符串 和 各 种 参数 的帮助消 息 之 间 parser  argparse
py  h  a  foo  that  bars  optional  arguments  h  help  show  this  help  message  and  exit 在 默 认情 况下 description 将 被换 行以便适 应 给 定 的空 间
 如果 想改 变这 种行 为见 formatterclass 参数
epilog
parents
formatterclass
prefixchars
fromfileprefixchars
 有些时 候先 举个 例 子当 处理 一个特 别 长 的参数列表 的 时候 把它存 入 一 个文 件中 而不是在 命 令 行打 出来会 很有 意 义
 如 果 fromfileprefixchars  参数提供 给 argumentparser 构 造函 数 之后 所有 类型 的字 符 的参 数 都 会 被 当 成 文件 处 理 并且会 被 文件包 含 的参数 替代
 举 个栗 子 with  openargs
txt  namespacefbar  从文 件读 取的 参 数在 默认 情况 下必须 一个 一行 但是 可参 见 convertarglinetoargs 并 且它 们被 视 为与 命令行上 的原 始文 件引用参数 位于同一 位置
所 以在以 上 例 子中 f  foo  args
txt  的 表示 和 f  foo  f  bar  的 表示相 同
fromfileprefixchars 参数默认 为 none  意味着参 数 不会 被当 作文 件对 待
argumentdefault
allowabbrev
正 常情 况下 当你 向 argumentparser 的 parseargs  方 法 传入一个参 数 列 表时 它会 recognizes  abbreviations
 这个 特 性可以 设置 allowabbrev 为 false  来 关闭 parser  argparse
parseargsfoon  usage  prog  h  foobar  foonley  prog  error  unrecognized  arguments  foon 3
5 新版功 能
conflicthandler
addhelp
exitonerror
正 常情 况下 当 你 向 argumentparser  的 parseargs 方法 传入 一个 无效 的参数 列 表时它 将 会退 出 并发 出 错 误 信 息
如 果 用户 想要 手 动捕 获 错误可通 过 将 exitonerror  设 为 false  来 启 用 该特 性 parser  argparse
 catching  an  argumenterror 3
9 新版 功能
addargument  方法
name  or  flags
addargument  方 法必 须 知 道 它是 否是 一 个 选项 例如 f  或 foo  或是 一 个 位 置参 数例 如一组文 件名
第 一 个 传递 给 addargument  的参 数必 须是 一系列 flags  或者 是 一 个 简单 的参数 名
例 如 可以 选项可 以被 这 样创建 parser
addargumentf  foo 而 位置参数可 以 这么 创建 parser
addargumentbar  当 parseargs  被 调用 选项 会以 前 缀识 别 剩下 的参 数则会被 假定 为位 置参数 parser  argparse
action
argumentparser 对 象将 命 令行 参数 与动作相 关联
这些 动作可以 做与它 们 相关联 的 命令行参数 的任何 事尽 管大多 数动 作只是简 单的向 parseargs  返 回的 对象 上 添加属 性
action 命名参 数指定了这 个 命 令行 参 数应 当 如 何处 理
供 应 的动作有 store  存储参 数的 值
这 是默认 的动 作
例如 parser  argparse
split  namespacefoo 1 storeconst 存 储被 const  命 名参 数 指定的值
 storeconst  动 作 通 常用 在选项 中来 指定 一些 标 志
 例如 parser  argparse
parseargsfoo  namespacefoo 42 storetrue  and  storefalse 这 些是 storeconst  分别用作存 储 true 和 false  值 的特 殊 用 例
另 外 它们 的 默 认 值分 别为 false 和 true
例如 parser  argparse
split  namespacefootrue  barfalse  baztrue  append  存储 一个列 表 并且 将每 个 参数 值追 加到列表 中
在 允许 多 次 使用选 项时 很有用
例 如 parser  argparse
split  namespacefoo 12 appendconst 这存 储一个 列表 并将 const 命名参数 指定 的 值追 加到 列表 中
 注意 const 命 名 参数默认 为 none
appendconst 动作 一般 在多 个 参 数 需 要在同一列 表中 存 储常 数时会 有用
 例如 parser  argparse
split  namespacetypesclass  str  class  int  count  计算一 个关 键字参 数 出现的 数 目 或 次数
 例如 对于一个增 长 的详 情等 级来说 有 用 parser  argparse
parseargsvvv  namespaceverbose 3 请注 意 default  将 为 none  除非 显式 地 设为0
 help 打 印所有 当前 解析 器 中 的选 项和参 数的完整 帮助信 息然后退出
 默 认 情况下 一个 help  动作 会 被 自动加 入 解析 器
关 于输 出是 如 何创 建 的参 与 argumentparser
 version  期望有 一个 version  命名参 数在 addargument  调 用中并 打印版 本 信息并在 调 用 后退 出 import  argparse  parser  argparse
0 extend  这会存 储一 个列 表 并将 每个参 数值 加 入 到 列 表 中
示 例 用法 parser  argparse
parseargsfoo  f 1 foo  f 2 f 3 f 4 namespacefoof 1 f 2 f 3 f 43
8 新 版功 能
你还 可以 通 过传递一 个 action 子 类或实现相 同接口 的其 他对象来指 定 任意 操作
 booleanoptionalaction  在 argparse 中可 用并会添加 对布尔 型操 作例 如 foo 和 nofoo 的支持 import  argparse  parser  argparse
parseargsnofoo  namespacefoofalse 创建 自 定 义 动作的推 荐方 式是扩 展 action 重载 call  方法以及可 选 的 init 和 formatusage 方法
 一个 自 定 义动 作的例 子 class  fooactionargparse
split  namespacebarnone  foonone 1 none  namespacebar 1 foonone 2 foo  args  namespacebar 1 foo 2更多描 述 见 action
nargs
const
addargument 的 const  参数 用于保存不从 命令 行 中读取但被 各 种 argumentparser 动 作需 求 的常数 值
最 常 用的 两例 为当 addargument 通过 actionstoreconst 或 actionappendconst  调 用时
这些动 作 将 const 值 添 加到 parseargs  返回 的 对 象的属 性 中
 在 action  的 描述 中 查 看案例
 当 addargument  通 过选项例如 f  或 foo 调用并且 nargs  时
这 会创建 一 个 可 以跟 随零个或 一个命令行 参数 的选 项
 当解析 命令 行 时 如 果 选项后没有 参 数 则 将 用 const 代 替
在 nargs  描述 中查 看案 例
对 storeconst  和 appendconst 动 作 const 命 名参 数 必 须给出
 对其 他动 作 默 认为 none
default
type
choices
 某 些 命 令行 参数 应当 从 一 组受 限值中 选择
这 可通 过将 一 个容器对象 作 为 choices 关键字 参 数传 给 addargument  来处理
 当 执 行 命令 行解析 时 参 数 值将 被 检查如果 参数 不 是可接 受的值 之一 就将 显 示错误 消息 parser  argparse
py  error  argument  move  invalid  choice  fire  choose  from  rock  paper  scissors  请 注 意 choices 容 器 包含的内容 会在 执行任 意 type 转 换 之后被 检查 因此 choices  容器 中对象的类 型应 当 与 指 定的 type  相 匹配 parser  argparse
py  error  argument  door  invalid  choice 4 choose  from 123任 何容器都 可 作 为 choices 值 传入 因此 list  对 象 set  对 象 以及 自 定义 容 器都是 受支 持 的
这 也包 括 enum
enum 该对象 可 被 用来 限制 参 数的 选项如 果 我们 重 用之前的 石头布剪 刀游 戏示例就可 以写 成这样 from  enum  import  enum  class  gamemoveenum 
required
通 常 argparse  模 块会 认为 f  和 bar  等 旗标 是指 明 可选的 参数它们 总 是 可 以 在命令行 中 被 忽略
 要让 一个选项 成为 必需的则可以 将 true  作为 required  关 键字 参数 传给 addargument  parser  argparse
parseargs  usage  h  foo  foo  error  the  following  arguments  are  required  foo 如 这个例 子 所示 如果一 个 选项 被标 记 为 required  则当 该选 项未在 命 令行 中出现时 parseargs 将 会报 告 一个 错误
 注 解 必 需 的 选项 通常被 认 为是不适 宜的 因为 用户 会预 期 options 都是可 选 的 因 此在 可 能的情 况 下应当 避免 使 用它们
help
metavar
 当 argumentparser 生成 帮 助消息 时它需 要用 某 种方式 来 引用每 个预期 的 参数
默 认 情况下 argumentparser  对 象使用 dest  值 作 为每个对 象的 name
 默认 情 况下对 于 位置 参数 动作 dest  值 将被 直接 使 用 而对于可 选 参数 动作 dest 值将 被 转为大写 形式
因此 一个 位 置 参数 destbar 的引 用 形式 将 为 bar
 一个 带有 单独命 令行参 数的可 选参 数 foo 的引 用 形 式将 为 foo
 示例如 下 parser  argparse
printhelp  usage  h  foo  foo  bar  positional  arguments  bar  optional  arguments  h  help  show  this  help  message  and  exit  foo  foo  可以 使用 metavar 来 指 定 一个替 代名 称 parser  argparse
printhelp  usage  h  foo  yyy  xxx  positional  arguments  xxx  optional  arguments  h  help  show  this  help  message  and  exit  foo  yyy 请注 意 metavar  仅改 变 显示 的 名称 parseargs  对 象的属 性 名 称 仍然 会由 dest 值 确定
 不 同的 nargs  值可 能 导致 metavar  被多 次 使用
 提供 一个 元组给 metavar 即 为 每个 参数指 定不 同的显 示信 息 parser  argparse
dest
 大 多数 argumentparser 动 作会添加 一些值作 为 parseargs 所 返回对象 的 一个属 性
该 属 性 的 名 称 由 addargument  的 dest 关 键字 参数确 定
 对 于 位 置参 数动 作 dest  通 常 会 作为 addargument  的第一 个参数 提供 parser  argparse
parseargsxxx  namespacebarxxx  对 于可选参数 动作 dest 的值通 常取自 选项 字符 串
 argumentparser 会通 过 接 受第 一个长 选 项字 符串 并 去掉 开 头 的字符 串 来 生成 dest  的 值
如 果没有 提 供 长选 项字 符 串 则 dest 将 通 过接 受第 一个短选项 字 符 串并去 掉 开 头的 字符来获 得
任 何内 部的 字符都将 被 转换为字符 以确 保字符串 是有效的 属性 名称
下面的例子显 示了这种 行为 parser  argparse
split  namespacefoobar 1 x 2 dest  允许提供 自定义属 性名称 parser  argparse
action  类
parseargs 方 法
parseargsargsnone  namespacenone 将 参 数 字符 串转换为 对象 并 将 其设 为命 名空 间 的属 性
返 回带 有成 员的 命名 空 间
 之 前对 addargument  的调 用决 定了 哪 些对 象被 创建 以及 它们如何 被 赋值
请 参阅 addargument 的文 档了解 详 情
 args 要解析 的字 符串 列表
 默认 值 是从 sys
argv 获 取
 namespace  用于获 取 属 性的 对象
 默 认值是 一个 新 的空 namespace 对 象
 选项值 语法
parseargs  方法 支持多种指 定 选项值 的 方 式如 果它接 受 选 项的 话
在 最 简单 的 情 况 下 选 项 和它 的值 是作 为两 个 单 独参 数传入 的 parser  argparse
parseargsfoo  foo  namespacefoofoo  xnone 对 于长 选 项 名 称 长 度超过 一 个字符 的 选项选 项和 值 也可以 作为 单个命令 行参数传 入使 用分 隔它 们即 可 parser
parseargsfoofoo  namespacefoofoo  xnone 对 于短 选项 长度 只有 一 个字符 的选 项 选项 和 它的 值可 以拼 接在 一起 parser
parseargsxx  namespacefoonone  xx 有 些短选项可 以使 用 单个前缀 来 进 行合并 如 果仅 有最 后一 个 选项 或 没有 任 何选项 需要 值 的话 parser  argparse
 无效的参 数
 在解 析命令 行 时 parseargs 会 检 测 多种错 误 包括 有歧义的 选 项、无效 的 类型、无 效的 选项、 错误的位置 参数个 数等 等
当 遇到这 种 错 误 时它将 退 出 并打 印 出错 误 文本同 时 附 带用 法消 息 parser  argparse
 包含 的参 数
 参 数 缩 写 前缀 匹 配
parseargs 方 法 在默 认 情况 下允许 将长选 项缩 写为 前缀 如 果 缩 写 无 歧 义即 前缀 与一 个特 定选 项相匹 配 的话 parser  argparse
split  usage  prog  h  bacon  bacon  badger  badger  prog  error  ambiguous  option  ba  could  match  badger  bacon 可 产生 一 个以上 选项 的参 数 会引发 错 误
此特 定 可通过将 allowabbrev  设 为 false  来禁 用
 在 sysargv 以 外
有时在 sys
argv  以外 用 argumentparser 解 析 参 数 也是 有 用的
 这 可 以通 过 将一 个字 符 串 列表传给 parseargs  来实 现
 它适 用于 在交 互 提示 符 下进 行 检 测 parser  argparse
 命名 空间对 象
namespace 由 parseargs  默 认 使用 的简单 类 可创 建一 个 存 放属 性的对 象并 将其返回
 这个 类被有意 做得 很 简单 只 是一 个 具 有可 读 字符 串表 示 形 式的 object
 如果 你 更喜 欢 类似 字 典的 属性视 图 你可 以 使 用 标 准 python  中 惯常 的 vars  parser  argparse
parseargsfoo  bar  varsargs  foo  bar 另 一 个用处是让 argumentparser 为 一个 已 存在 对 象而 不是 为 一 个新的 namespace 对 象 的 属 性 赋 值
这 可以 通 过指 定 namespace 关 键字 参数 来 实现 class  c 
 其它实 用工 具
子 命 令
filetype 对 象
filetypemoder  bufsize 1 encodingnone  errorsnone  filetype 工 厂类 用于 创建可作为 argumentparser
addargument  的 type 参数 传入 的对 象
以 filetype  对 象 作 为其 类型的参 数将 使用命 令行参 数 以 所请 求模式、 缓冲 区 大 小、编 码格式和 错 误 处理 方式打 开文 件 请 参阅 open  函数了解 详情 parser  argparse
dat  modewb  filetype  对象 能理 解伪 参 数 并会 自 动将其 转换为 sys
stdin  用于可 读 的 filetype 对 象 或 是 sys
stdout 用于可 写的 filetype 对象 parser  argparse
textiowrapper  namestdin  encodingutf 83
4 新版 功能 encodings  和 errors 关 键 字参数
 参 数组
addargumentgrouptitlenone  descriptionnone 在默 认情 况下 argumentparser  会 在显示 帮 助 消 息时 将 命 令 行 参数 分 为位置 参 数 和 可选 参 数两 组
 当 存 在 比默 认 更好的 参数 分组 概 念 时 可以使 用 addargumentgroup 方 法 来创 建 适当的 分 组 parser  argparse
printhelp  usage  prog  foo  foo  bar  group  bar  bar  help  foo  foo  foo  help  addargumentgroup  方 法返回 一个 具有 addargument  方法的 参 数分 组 对 象这 与常规 的 argumentparser 一 样
当 一个 参 数被加 入 分 组时解析 器 会 将它 视 为 一个 正常 的参 数 但 是会 在 不 同的 帮 助消 息 分组中 显示 该参 数
 addargumentgroup  方 法 接 受 title  和 description 参 数它 们可 被用来定 制 显 示内 容 parser  argparse
printhelp  usage  prog  bar  bar  foo  group 1 group 1 description  foo  foo  help  group 2 group 2 description  bar  bar  bar  help 请 注意任 意不 在 你 的自 定义分 组 中的 参数 最终 都将 回 到通 常 的位 置 参 数和 可选参 数 分组 中
互斥
addmutuallyexclusivegrouprequiredfalse  创建一 个 互斥 组
 argparse 将 会确保 互 斥组 中只有一 个参 数在 命令 行中可 用 parser  argparse
parseargsfoo  bar  usage  prog  h  foo  bar  prog  error  argument  bar  not  allowed  with  argument  foo  addmutuallyexclusivegroup 方法也 接受 一个 required  参数表 示在 互 斥组 中至 少 有一个 参 数 是需要 的 parser  argparse
parseargs  usage  prog  h  foo  bar  prog  error  one  of  the  arguments  foo  bar  is  required  注 意 目 前互 斥参数 组不 支 持 addargumentgroup  的 title 和 description 参 数
解 析 器默 认值
setdefaultskwargs 在大 多 数时候 parseargs  所返 回对 象的 属 性将 完全 通过检 查 命令 行参 数和 参数 动作来 确 定
 setdefaults 则允 许加 入 一 些 无 须任 何 命令行 检查 的额外属性 parser  argparse
parseargs 736 namespacebar 42 bazbadger  foo 736 请 注意 解析器层级 的默认 值总是会覆 盖参数 层 级的默 认 值 parser  argparse
parseargs  namespacefoospam 解 析器 层 级 默认值 在需 要多解 析 器时 会特 别有 用
请 参阅 addsubparsers 方 法了 解 此 类型 的一 个 示 例
getdefaultdest 获 取一 个命 名空间属性 的 默 认值 该 值是 由 addargument 或 setdefaults  设 置的 parser  argparse
 打印 帮助
在 大 多 数典 型 应用 中 parseargs 将负 责任何 用法和错误消 息的格 式 化和 打印
 但是 也 可 使用 某些 其他 格式化方 法 argumentparser
printusagefilenone 打 印 一段 简 短描 述说明应 当如何在 命令行 中发 起 调用 argumentparser
如 果 file 为 none 则 默认 使用 sys
stdout
printhelpfilenone 打印 一 条 帮助消 息包 括 程 序 用法 和通过 argumentparser 注 册的 相关参数 信息
 如 果 file  为 none  则 默 认 使 用 sys
stdout
还 存 在这 些 方法的几个 变化形 式它 们 只 返 回 字 符串而 不打印 消息 argumentparser
formatusage  返 回 一 个包 含简短 描述的 字 符串 说 明应 当如 何 在 命 令行中 发起 调用 argumentparser
formathelp  反回 一个包 含 帮 助消息的 字符串包 括 程序用 法 和通过 argumentparser 注册 的 相 关 参数 信息
 部 分解 析
parseknownargsargsnone  namespacenone 有时 一个 脚本 可能只解 析 部分命 令行参 数 而将 其余 的参数继 续传递 给另 一个 脚 本 或程序
 在这种 情况 下 parseknownargs  方 法会很 有用处
它 的作 用方 式很 类似 parseargs  但区 别在 于 当存 在 额外 参数 时它 不会 产生 错误
而 是 会返回 一 个由两个 条目构 成的元 组其 中包含 带成员 的命 名空 间和剩 余参数字 符 串 的列 表
parseknownargsfoo  badger  bar  spam  namespacebarbar  footrue  badger  spam  警告 前缀匹配 规则 应用于 parseknownargs
 一个 选项即 使只是已 知选 项的前 缀部分 解析器也 能识别 该选项 不会将 其放 入 剩余 参数列表
自定 义 文件解 析
convertarglinetoargsargline 从文 件读取的 参数 见 argumentparser 的 fromfileprefixchars  关键 字 参数将 是 一行 读 取一 个参数
 convertarglinetoargs  可 被重 载以 使 用更 复 杂的 读取方式
 此方法 接受 从参数 文件读 取的 字符 串形 式 的单个 参数 argline
它 返 回从 该字 符串解析 出 的 参数 列表
此 方 法将在 每次 按 顺序从 参数 文件 读 取一 行时 被 调 用 一次
此 方法 的一 个 有用的 重载是将每 个以空 格分 隔的单词 视为一 个参 数
 下面 的 例子 演示 了如何 实现此 重载 class  myargumentparserargparse
退 出方法
exitstatus 0 messagenone  此 方法将终 结程序 退 出时 附 带指 定的 status  并 且如 果给 出了 message  则会在退 出前 将其打 印 输出
用户 可重 载此 方法以不 同 方式来 处理 这些步 骤 class  errorcatchingargumentparserargparse
errormessage  此方 法 将向 标准错 误打印 包括 message  的 用 法 消息 并附带 状 态码2 终结 程 序
 混合 解 析
parseknownintermixedargsargsnone  namespacenone 许 多 unix 命令 允许用户 混 用可选参 数与位 置参数
parseintermixedargs  和 parseknownintermixedargs 方法均 支 持这种 解析风格
 这些 解析器并 不支 持 所 有的 argparse  特性并 且当 未 支持 的特 性被 使用 时将 会 引 发异 常
特别地 子解 析 器 argparse
remainder  以 及 同 时包 括可 选与位 置参 数的 互 斥 分 组是 不受 支持 的
 下 面 的 例子显 示了 parseknownargs  与 parseintermixedargs 之 间的差异前者 会 将23返 回 为未 解析 的 参数而 后 者 会 将 所 有 位 置 参 数 收 集 至 rest  中
split  namespacecmddoit  foobar  rest 123 parseknownintermixedargs  返 回由 两个条目 组成的 元 组其中包 含 带成 员 的命 名空 间以 及剩 余参 数字 符串列 表
当 存 在任 何剩余 的未解析参 数 字 符 串时 parseintermixedargs  将引 发 一个 错误
3
7新 版功 能
升 级 optparse 代码
array 高 效 的数值 数组
 此 模块定 义了一 种对 象类 型 可 以紧凑 地表示 基本 类 型 值的数 组字符、整 数、浮点 数 等
 数 组 属于 序 列类 型其 行 为 与列 表 非 常相 似 不同 之处 在于其 中存储 的 对象 类型是 受 限的
 类型 在对 象创 建时 使用 单个 字 符的 类 型码 来指 定
已 定义 的类 型码如 下 类型码 c  类 型 python 类型以 字节 表 示 的最 小尺寸注 释 b  signed  char  int 1 b  unsigned  char  int 1 u  wchart  unicode 字符21 h  signed  short  int 2 h  unsigned  short  int 2 i  signed  int  int 2 i  unsigned  int  int 2 l  signed  long  int 4 l  unsigned  long  int 4 q  signed  long  long  int 8 q  unsigned  long  long  int 8 f  float  float 4 d  double  float 8 注释1
由 于平 台的不 同它可 能为16 位或32 位
在3
9 版 更改 arrayu 现 在使用 wchart  作为 c 类型而 不再 是 已弃 用 的 pyunicode
这 个 改变 不会影响 其行 为因为 pyunicode  自 python 3
3起 就是 wchart 的 别名
值的 实际 表示会 由机器 的架构决 定严格 地说是 由 c 实现 决定
 实 际大 小可通过 itemsize 属性 来 获取
这 个模块 定义了以 下类型 class  array
arraytypecode  initializer  一个 包 含由 typecode  限 制类 型的 条目的 新数组 并由可 选的 initializer 值 进 行初始化 该值必 须 为 一 个 列表、 byteslike  object 或 包 含正 确类 型 元素 的可 迭 代对 象
如 果给 定一个列 表或 字符串 该 initializer  会 被 传给 新数组 的 fromlist  frombytes 或 fromunicode  方法 见 下 文 以 将 初 始 条 目 添加 到数组 中
 否则 会将 可 迭代 对 象 作 为 initializer  传 给 extend  方 法
 引发 一 个审 计 事件 array
new  附 带参 数 typecode  initializer
typecodes 包含 所有 可用 类 型码 的字 符串
数组对象支 持普 通 的序 列 操作如 索引、 切 片、拼 接和重 复 等
当使用 切 片赋值 时所 赋 的值必 须为具 有相 同类 型 码的数组 对 象所 有 其他情 况都将 引 发 typeerror
数组对 象 也实现 了缓 冲区 接口 可以 用于 所有 支 持字 节 类 对 象的 场合
 以下 数据项 和 方法也 受 到支持 array
typecode 用 于创建 数组的 类型 码字符
itemsize  在 内部 表示 中 一 个数 组项 的字 节长 度
appendx 添加 一个值为 x  的新项 到 数 组末 尾
bufferinfo 返 回一 个 元组 address  length 以 给 出用 于存放 数组内容 的 缓 冲区 元 素的 当前内存 地址 和长度
 以字 节表示 的内存缓 冲区 大小可 通过 array
itemsize 来 计算
这在 使用需 要内存 地址的 低层 级 因此 不够安全 io 接口 时 会很有 用例如 某些 ioctl 操作
 只要数 组存 在 并且 没 有应 用改 变长度 的操作 返回数 值就是 有 效的
注解 当在 c 或 c  编 写 的 代 码中使 用 数组 对象 时 这是 有效 使用 此 类 信息 的唯 一 方式使 用 数 组对象所 支持的 缓 冲 区 接 口更为 适宜
此 方 法 仅保 留用 作 向下兼 容 应 避 免 在新代 码中使用
缓冲 区接 口 的 文档参 见缓 冲协 议
byteswap 字 节 对调所 有数组 项
 此方 法 只支 持 大小 为124 或8字 节的 值对于 其他 值类型 将引 发 runtimeerror
 它适用于 从不 同 字 节序机器 所生成的 文件 中读 取 数 据的 情 况
countx 返 回 x 在 数组中的 出 现次数
extenditerable  将 来 自 iterable 的 项添加 到数 组末 尾
如果 iterable 是 另一 个数 组 它必 须具 有完全 相同 的类型 码否 则 将引 发 typeerror
如果 iterable 不 是 一个 数组 则它 必 须 为可 迭代对象 并且 其元 素 必须为可 添加 到数 组的适当 类型
frombytess 添 加 来 自 字符 串 的项 将 字符串 解读 为 机 器值 的数 组相 当 于使 用 fromfile  方法从文 件 中读 取数据
3
2 新版 功能 fromstring  重 命 名为 frombytes  以使其 含义 更 清晰
fromfilef  n  从 file  object  f 中 读取 n 项解 读为机 器 值 并将 它 们添加到 数 组末尾
如 果 可读 取数据 少于 n 项 则将 引 发 eoferror  但 有效 的项 仍 然 会被 插入 数 组
 f 必 须为 一个 真 实的 内置 文件 对象 不 支 持 带有 read  方法的 其 它 对象
fromlistlist 添加 来自 list  的 项
 这 等价 于 for  x  in  list  a
appendx 区 别在 于 如果 发 生 类型 错 误 数组将不 会被 改变
fromunicodes  使 用来 自给 定 unicode  字符 串 的 数 组 扩展 数 组
 数组 必 须 是 类型 为 u 的 数组否 则将 引 发 valueerror
 请 使 用 array
encodeenc 来 将 unicode 数 据添 加 到其 他类 型 的数 组
indexx 返 回最 小的 i 使 得 i 为 x  在 数 组中首次 出现的 序 号
inserti  x 将 值 x  作为 新 项插 入数 组的 i 位置 之 前
 负 值将 被视为相 对 于数 组末尾的 位 置
popi  从 数组中 移 除 序号 为 i 的 项并 将其 返回
 可选参 数值 默 认为1 因 此默认 将 移除并 返回末 尾项
removex 从 数组 中 移 除 首次 出现 的 x
reverse 反 转数 组 中各项 的顺序
tobytes  将数组 转换 为 一个 机器 值数 组并 返回 其 字 节表示 即 相当与 通 过 tofile 方 法 写入到 文件 的字 节 序 列
3
2新版功 能 tostring  被重命 名为 tobytes  以 使 其含义更 清晰
tofilef  将 所有 项作 为 机器 值写入 到 file  object  f
tolist 将数 组 转换为 包含 相同项 的普通 列 表
tounicode 将数组 转换 为一 个 unicode  字 符串
 数组必 须 是类 型 为 u  的 数组否 则将 引发 valueerror
 请 使用 array
decodeenc  来从其他 类型 的数 组 生成 unicode 字 符串
当一 个 数组 对象被 打印 或转换 为字 符串 时 它会 表示 为 arraytypecodeinitializer
如果数 组 为空则 initializer  会 被 省略 否则 如 果 typecode 为 u  则它 是一个字 符串否 则它 是 一个数 字 列 表
使 用 eval  保 证 能将 字符 串 转换回 具有 相同 类型和值 的 数 组只 要 array 类 已通过 from  array  import  array 被 引入
 例如 arrayl  arrayu  hello  u 2641 arrayl 12345 arrayd 1
14参 见模 块 struct 打 包 和解包 异构二 进制 数 据
模 块 xdrlib 打 包和解 包用 于 某些 远程 过程调 用 系统 的 external  data  representation  xdr  数据
 numerical  python 文 档 numeric  python  扩展 numpy 定义 了 另一 种 数 组 类 型 请 访问 httpwww
org 了 解有 关 numerical  python 的 更多 信 息
ast 抽象 语 法 树
源代 码 libast
pyast  模块帮助 python  程序 处 理 python 语 法 的抽 象语法树
 抽象 语法 或许会 随 着 python 的 更新发布 而改变该 模 块能 够 帮助理 解当前语 法在编程 层面 的样貌
抽 象语法 树 可 通过 将 ast
pycfonlyast 作 为旗 标传递给 compile  内置 函 数 来生 成 或是使用 此模 块 中提供 的 parse 辅 助 函数
返回结果 将 是一 个对象树 其 中 的类 都 继 承 自 ast
 抽象语 法 树可被 内 置的 compile  函数 编 译 为 一 个 python 代 码对 象
抽 象 文 法
抽象文 法 目前 定 义如 下 asdls 4 builtin  types  are  identifier  int  string  constant  module  python  mod  modulestmt  body  typeignore  typeignores  interactivestmt  body  expressionexpr  body  functiontypeexpr  argtypes  expr  returns  stmt  functiondefidentifier  name  arguments  args  stmt  body  expr  decoratorlist  expr  returns  string  typecomment  asyncfunctiondefidentifier  name  arguments  args  stmt  body  expr  decoratorlist  expr  returns  string  typecomment  classdefidentifier  name  expr  bases  keyword  keywords  stmt  body  expr  decoratorlist  returnexpr  value  deleteexpr  targets  assignexpr  targets  expr  value  string  typecomment  augassignexpr  target  operator  op  expr  value  simple  indicates  that  we  annotate  simple  name  without  parens  annassignexpr  target  expr  annotation  expr  value  int  simple  use  orelse  because  else  is  a  keyword  in  target  languages  forexpr  target  expr  iter  stmt  body  stmt  orelse  string  typecomment  asyncforexpr  target  expr  iter  stmt  body  stmt  orelse  string  typecomment  whileexpr  test  stmt  body  stmt  orelse  ifexpr  test  stmt  body  stmt  orelse  withwithitem  items  stmt  body  string  typecomment  asyncwithwithitem  items  stmt  body  string  typecomment  raiseexpr  exc  expr  cause  trystmt  body  excepthandler  handlers  stmt  orelse  stmt  finalbody  assertexpr  test  expr  msg  importalias  names  importfromidentifier  module  alias  names  int  level  globalidentifier  names  nonlocalidentifier  names  exprexpr  value  pass  break  continue  coloffset  is  the  byte  offset  in  the  utf 8 string  the  parser  uses  attributes  int  lineno  int  coloffset  int  endlineno  int  endcoloffset  boolop  can  use  left  right  expr  boolopboolop  op  expr  values  namedexprexpr  target  expr  value  binopexpr  left  operator  op  expr  right  unaryopunaryop  op  expr  operand  lambdaarguments  args  expr  body  ifexpexpr  test  expr  body  expr  orelse  dictexpr  keys  expr  values  setexpr  elts  listcompexpr  elt  comprehension  generators  setcompexpr  elt  comprehension  generators  dictcompexpr  key  expr  value  comprehension  generators  generatorexpexpr  elt  comprehension  generators  the  grammar  constrains  where  yield  expressions  can  occur  awaitexpr  value  yieldexpr  value  yieldfromexpr  value  need  sequences  for  compare  to  distinguish  between  x 43 and  x 43 compareexpr  left  cmpop  ops  expr  comparators  callexpr  func  expr  args  keyword  keywords  formattedvalueexpr  value  int  conversion  expr  formatspec  joinedstrexpr  values  constantconstant  value  string  kind  the  following  expression  can  appear  in  assignment  context  attributeexpr  value  identifier  attr  exprcontext  ctx  subscriptexpr  value  expr  slice  exprcontext  ctx  starredexpr  value  exprcontext  ctx  nameidentifier  id  exprcontext  ctx  listexpr  elts  exprcontext  ctx  tupleexpr  elts  exprcontext  ctx  can  appear  only  in  subscript  sliceexpr  lower  expr  upper  expr  step  coloffset  is  the  byte  offset  in  the  utf 8 string  the  parser  uses  attributes  int  lineno  int  coloffset  int  endlineno  int  endcoloffset  exprcontext  load  store  del  boolop  and  or  operator  add  sub  mult  matmult  div  mod  pow  lshift  rshift  bitor  bitxor  bitand  floordiv  unaryop  invert  not  uadd  usub  cmpop  eq  noteq  lt  lte  gt  gte  is  isnot  in  notin  comprehension  expr  target  expr  iter  expr  ifs  int  isasync  excepthandler  excepthandlerexpr  type  identifier  name  stmt  body  attributes  int  lineno  int  coloffset  int  endlineno  int  endcoloffset  arguments  arg  posonlyargs  arg  args  arg  vararg  arg  kwonlyargs  expr  kwdefaults  arg  kwarg  expr  defaults  arg  identifier  arg  expr  annotation  string  typecomment  attributes  int  lineno  int  coloffset  int  endlineno  int  endcoloffset  keyword  arguments  supplied  to  call  null  identifier  for  kwargs  keyword  identifier  arg  expr  value  attributes  int  lineno  int  coloffset  int  endlineno  int  endcoloffset  import  name  with  optional  as  alias
节 点类
 字面值
variables
 表 达 式
statements
control  flow
 注 解 optional  clauses  such  as  else  are  stored  as  an  empty  list  if  theyre  not  present
function  and  class  definitions
async  and  await
ast 中 的辅助 函数
compiler  flags
3
8 新版功能
3
8 新版 功能
commandline  usage
3
9新版 功能
 参见 green  tree  snakes  an  external  documentation  resource  has  good  details  on  working  with  python  asts
asynchat 异 步 socket 指 令响 应 处 理器
py 3
6 版 后已移 除 请 使 用 asyncio 替代
注 解该 模块 仅为 提供 向后 兼容
 我们 推荐 在新代 码中 使用 asyncio 
 term  描 述 string  will  call  foundterminator  when  the  string  is  found  in  the  input  stream  integer  will  call  foundterminator  when  the  indicated  number  of  characters  have  been  received  none  the  channel  continues  to  collect  data  forever  note  that  any  data  following  the  terminator  will  be  available  for  reading  by  the  channel  after  foundterminator  is  called
asynchat  example
高 层 级 api  索 引
这个 页 面列举了所 有 能 用于 asyncwait  的高层 级 asyncio  api 集
tasks
队 列 集
子进程集
 用于 生 成子 进程 和运 行 shell  命令 的工具 包
 await  createsubprocessexec  创 建 一个 子 进 程
 await  createsubprocessshell 运 行一 个 shell 命 令
示 例执 行 一个 shell  命 令
请 参 阅子 进 程 apis 相 关 文 档
 流
用于网 络 io 处 理 的高 级 api 集
 await  openconnection 建 立 一个 tcp 连 接
 await  openunixconnection 建 立 一个 unix  socket  连接
 await  startserver  启动 tcp  服务
 await  startunixserver  启 动 一 个 unix  socket 服务
 streamreader 接收 网 络数 据的高 级 asyncawait 对 象
 streamwriter  发送网 络数据 的 高 级 asyncawait 对象
 示例 tcp 客 户端 样 例
 请参 阅 streams  apis 文 档
同 步
异 常
timeouterror 类 似 waitfor  等函 数在 超 时时候 被 引 发
请 注 意 asyncio
timeouterror  与 内建 异常 timeouterror  无 关
 asyncio
cancellederror 当 一个 task 对 象 被 取消 的时 候被引 发
 请参阅 task
 示例 在 取 消请 求 发生的 运行 代码 中 如 何处理 cancellederror 异 常
 请参阅完 整的 asyncio  专 用异 常 列表
用 asyncio  开发
 异 步 编程 与传统 的 顺序 编程不 同
本 页 列 出常 见的 错误和陷 阱并解释如 何避 免它 们
debug  模式
 默认 情 况下 asyncio 以 生产模 式运 行
为 了 简 化 开发 asyncio  还 有一 种 debug  模 式
有 几 种方法 可以 启 用异 步调 试模 式 将 pythonasynciodebug 环境 变 量 设置为1
使 用 python  开发模式
 将 debugtrue 传 递 给 asyncio
run 
调 用 loop
setdebug 
 除 了启 用 调试模 式外 还要考虑将 asyncio  logger  的日 志级 别 设置 为 logging
debug 例 如 下面的 代码片 段可 以在 应 用 程 序启 动 时运 行 logging
debug 配 置 warnings 模 块 以显 示 resourcewarning  警 告
一 种 方法是使 用 w  default 命 令行 选项
 启用 调试 模式 时 asyncio 检 查 未 被 等 待的 协程 并记 录他 们这 将 消除被 遗忘的 等待 问题
 许多 非 线程安 全的 异步 apis  例如 loop
callsoon 和 loop
callat 方 法如果 从错误 的线程 调 用则会 引发 异常
 如果 执 行 io  操作花费 的 时间太 长 则记录 io 选 择 器的 执 行时间
 执 行时间 超 过100毫秒的 回调将 会 载入 日 志
 属 性 loop
slowcallbackduration 可用于 设 置以 秒为单 位 的 最小执 行持续 时间 这被视为 缓慢
 并 发性和 多 线程
 运 行阻 塞 的 代码
不 应该 直接调 用阻塞 cpu  绑定 代码
 例如如果 一 个 函数执 行1 秒的 cpu  密集 型 计算 那么 所 有并发 异步 任务 和 io  操 作都 将延 迟1秒
 可以用 执 行器 在不 同的 线 程甚 至 不同 的进 程中 运行 任 务以避 免使 用事 件 循环 阻 塞 os 线 程
 请参阅 loop
runinexecutor  方 法了 解详 情
 日志
 检测 neverawaited 协 同程 序
检 测 就再 也没 异常
 如果 调用 future
setexception  但 不等 待 future 对 象将异 常传 播到 用户代 码
在这 种情 况下 当 future 对 象 被 垃 圾收集 时 asyncio 将 发出 一 条 日 志消息
未 处 理 异 常的 例 子 import  asyncio  async  def  bug  raise  exceptionnot  consumed  async  def  main  asyncio
runmain 输 出 task  exception  was  never  retrieved  future  task  finished  corobug  done  defined  at  test
py  line 4 in  bug  raise  exceptionnot  consumed  exception  not  consumed 激 活 调 试模 式以 获 取任 务创 建处 的跟踪信 息 asyncio
runmain  debugtrue  调 试模 式的 输出 task  exception  was  never  retrieved  future  task  finished  corobug  done  defined  at  test
 事 件 循 环
事件 循 环 方法 集
 运 行 和停止 循环
rununtilcompletefuture 运行 直 到 future  future  的实 例 被完 成
如果 参数 是 coroutine  object 将 被隐式 调度为 asyncio
task 来 运 行
返回 future 的 结果或 者 引发相 关异常
runforever  运行 事件循 环 直到 stop  被调 用
如 果 stop  在调 用 runforever  之 前 被调用循 环 将 轮询一 次 io  选择 器 并 设置 超 时 为零 再运行 所 有已加入 计划任 务 的回调 来响应 io  事件 以及 已 加 入计 划任 务的事 件然后 退 出
 如果 stop  在 runforever 运 行期间被 调用循环 将运 行当 前批 次的回调 然后退 出
请 注 意在 此 情况 下 由 回 调 加入计划 任务 的新 回调 将 不会 运 行它 们将会在 下次 runforever  或 rununtilcomplete 被 调用时 运行
stop  停止 事 件循环
isrunning  返回 true 如果 事件 循 环当前 正在 运 行
isclosed 如果事 件循 环已 经被 关 闭 返回 true 
close  关 闭事 件循 环
当 这个 函数被 调 用的 时 候 循 环必须 处于非 运 行状 态
pending 状 态的 回调 将被丢弃
 此 方法清除所有的 队列 并立 即 关闭 执 行器 不 会等 待执 行 器完 成
 这 个 方法是 幂等的 和不 可 逆 的
 事件循 环关 闭后 不应调用其 他 方法
shutdownasyncgens  安 排 所有 当 前 打开 的 asynchronous  generator 对 象通 过 aclose 调 用来关闭
 在调用 此方 法后 如果 有新 的 异 步 生成器被迭 代事 件循 环将 会 发出 警告
这应当 被用 来可靠地完 成所有 已加 入计 划任 务的异步生 成器
请 注意 当使用 asyncio
run  时 不必调用 此 函数
 示例 try  loop
close 3
6 新版 功 能
shutdowndefaultexecutor 安 排 默 认执 行器 的 关闭 并等 待它 合并 threadpoolexecutor 中 的 所有 线程
 在调 用此方法后 如果在 使用默 认执 行器 期 间调 用了 loop
runinexecutor 则将会 引发 runtimeerror
 请注 意当使 用 asyncio
run 时不 必调用 此函数
3
9新 版 功能
 安排回 调
callsooncallback  args  contextnone 安排 callback  callback 在 事 件循环 的下一 次迭代 时附带 args 参数 被调 用
 回调 按其注册顺 序被调用
 每个回 调仅被 调 用一次
可 选的 仅 关键字型 参数 context  允 许为 要运 行的 callback 指定 一个 自定义 contextvars
context 
如 果没 有 提供 context  则 使用当前上 下文
 返 回 一个能用来 取消 回调 的 asyncio
handle 实 例
 这个方法不 是线 程安 全的
callsoonthreadsafecallback  args  contextnone  callsoon  的线 程安全变 体
 必须 被用 于安排 来自其他 线 程 的回 调
查看 并发 和 多 线程 章节的文档
 在3
7 版更改 仅用 于关 键 字 形参 的 参数 context 已经 被添 加
 请参 阅 pep 567查看 更 多 细 节
 注解 大 多数 asyncio  的调 度函 数不让传 递关键字 参数
为 此请 使用 functools
partial  will  schedule  printhello  flushtrue  loop
partialprint  hello  flushtrue  使用 partial 对 象通常 比使 用 lambda 更 方便 asyncio  在 调试和 错误 消息 中能更好 的呈 现 partial  对象
调度 延迟 回调
 事件循 环提供 安 排 调 度函 数在 将 来某 个时 刻调 用的机 制
 事 件循 环使 用单 调 时钟 来跟 踪时 间
calllaterdelay  callback  args  contextnone 安 排 callback  在 给定的 delay 秒 可以是 int  或者 float  后被调 用
返 回一 个 asyncio
timerhandle 实例 该实 例 能用 于取消 回调
 callback 只 被调 用一次
 如果两个回 调被安排 在 同样 的时 间点执行 顺序未 限定
 可 选的 位置 参数 args  在 被调 用的时 候传 递 给 callback  
如果你 想把 关 键字 参数传 递给 callback  请 使用 functools
partial 
可选 的仅 关 键字型 参数 context 允 许 为 要运 行的 callback 指定 一个 自定 义 contextvars
context 
 如 果没 有提供 context 则 使 用当前 上 下 文
在3
7版更 改 仅用 于 关 键字 形参的参 数 context 已 经 被添加
 请 参阅 pep 567 查看 更多 细 节
在3
8版 更改 在 python 3
7和 更早 版本的 默认事件 循环 实现 中 delay 不能 超 过一天
这在 python 3
8 中已 被 修复
callatwhen  callback  args  contextnone  安排 callback  在 给 定的 绝对时 间戳 when  int 或 float  被 调用 使用 与 loop
time 同样 的时 间 参 考
 这 个函数 的行 为 与 calllater  相同
 返 回一 个 asyncio
timerhandle 实 例该 实例 能用 于取 消回调
 在3
7版 更改仅用于 关 键字 形 参的 参数 context 已经 被 添加
 请 参阅 pep 567查看 更多 细 节
 在3
8版 更改 在 python 3
7和 更 早 版本的 默认事件 循环 实现 中 when  和当前 时间相差 不 能 超过一 天
 在这 python 3
8 中 已被修复
time  根据 时 间 循 环内 部的 单调时 钟返 回当 前时 间为 一个 float  值
注 解在3
8 版 更 改在 python 3
7 和更早 版 本 中超 时 相对 的 delay  或绝 对的 when 不 能超 过一 天
这 在 python 3
8中 已被 修复
 参见 asyncio
sleep  函 数
 创建 future 和 task
createfuture 创 建一 个附 加到 事 件循 环中 的 asyncio
future  对 象
 这 是在 asyncio  中创 建 futures  的 首选 方式
 这让 第三方事 件循 环可 以 提 供 future  对象的 替 代实 现更 好 的 性能 或 者功能
3
2 新 版功 能
createtaskcoro  namenone 安排一 个协 程 的执 行
返 回 一个 task 对 象
 三方 的事件 循环 可 以使用 它 们自 己 定义 的 task 类 的 子 类 来 实 现 互操 作性
 这个例 子里 返回 值 的 类型是 task 的 子类
 如果提供了 name 参 数 且不为 none  它会 使 用 task
setname 来 设为 任 务 的名 称
在3
8 版更改 添加 了 name 形 参
settaskfactoryfactory  设置 一 个 任务 工厂 它 将 由 loop
createtask 来 使用
 如果 factory 为 none  则将 设 置默 认的任务 工厂
 在 其他 情况下 factory  必须 为一个 可 调用 对象 且签名 匹配 loop  coro 其中 loop  是 对 活动 事 件循环 的 引用 而 coro 是 一 个协 程 对 象
 该可调 用对象 必须返回 一个 兼容 asyncio
future 的对象
gettaskfactory 返 回一个 任 务工厂 或者 如 果是 使用 默认值 则 返回 none
打 开 网络 连接
创 建网 络服务
aipassive  socknone  backlog 100 sslnone  reuseaddressnone  reuseportnone  sslhandshaketimeoutnone  startservingtrue  创建 tcp  服务 socket  类 型 sockstream 监 听 host 地 址 的 port 端 口
返回一 个 server 对 象
参 数 protocolfactory  必 须 为一个 返 回 协议 实 现 的可 调 用对 象
 host 形参 可被 设为 几 种类 型它 确定了 服务 器所 应 监听 的位置 如 果 host  是一个 字 符串 则 tcp 服 务器 会被绑 定 到 host 所指明 的单 一网 络 接口
如 果 host 是一 个 字 符串序 列 则 tcp 服 务器 会被 绑 定到 序 列 所指 明 的所 有 网 络 接 口
 如 果 host  是一 个空 字 符 串或 none 则 会 应 用所 有 接口并 将返 回包 含多个 套接 字 的列表 通常 是一个 ipv 4 的加 一个 ipv 6 的
 family  可 被 设 为 socket
afinet 或 afinet 6 以 强制 此套 接 字 使用 ipv 4或 ipv 6
 如 果未 设 定则 family  将 通过 主机名 称来 确定 默 认为 afunspec
 flags  是 用 于 getaddrinfo  的位 掩码
 可 以 选择 指 定 sock 以 便使 用 预先存在的 套接 字 对象
如果 指定 了 此参数 则 不可 再 指 定 host 和 port
 backlog  是传 递给 listen 的 最 大排 队 连 接的 数 量 默认为100
 ssl 可 被设 置 为 一个 sslcontext  实例 以 在所 接受的连 接上 启 用 tls 
 reuseaddress  告知 内核要 重用一 个 处于 timewait  状态的本 地套 接字而 不 是等 待其 自然超 时失 效
如 果未 指 定此参 数则 在 unix 上 将自 动设置 为 true
 reuseport 告知 内核只 要 在创建 的时 候都设置 了 这 个标 志 就允 许 此端 点绑 定到其 它端 点列表 所 绑定 的同样的端 口 上
这 个选 项 在 windows 上 是 不 支 持 的
 sslhandshaketimeout 是用于 tls  服 务 器 的在 放 弃连 接 之前 要 等 待 tls 握手 完成的 秒数
 如 果参数为 默认 值 none 则 为60
0秒
 startserving  设 置 成 true 默认值 会导 致 创建 server  并立 即开始 接受 连接
 设置成 false 用 户需 要 等 待 server
startserving  或 者 server
serveforever 以使 server  开 始 接 受连接
3
7新 版功 能 增加 了 sslhandshaketimeout  和 startserving 形参
在3
6 版 更改套 接字 选项 tcpnodelay 默 认已 为 所有 tcp  连接进行 了 设 置
 在3
5版更改 proactoreventloop  类中 添加 ssltls  支 持
在3
1 版 更改 host  形参 可以是 一 个 字符串 的 序 列
参见 startserver  函数 是 一个 高层 级的 替代 api 它 返 回 一 对 streamreader 和 streamwriter 可 在 asyncawait  代 码 中使 用
createunixserverprotocolfactory  pathnone  socknone  backlog 100 sslnone  sslhandshaketimeoutnone  startservingtrue 与 loop
createserver  类似 但是专 用于 afunix  套接 字族
 path  是必 要的 unix  域套接字 名称 除非提 供了 sock  参数
 抽象的 unix 套接 字 str  bytes  和 path  路径都是 受 支持 的
请 查看 loop
createserver  方 法 的文 档 了解 有关 此方 法的参 数的 信息
 可用性 unix
3
7新 版功 能 the  sslhandshaketimeout  and  startserving  parameters
在3
7版 更 改 path 形 参 现 在 可以 是 path  对象
connectacceptedsocketprotocolfactory  sock  sslnone  sslhandshaketimeoutnone  将已被接 受的连接 包 装成一个 传输 协 议对
 此 方 法 可被 服务 器 用 来 接 受 asyncio 以 外的 连 接但是使 用 asyncio  来 处 理它们
 参 数 protocolfactory  必须 为一 个返 回 协议实 现的 可 调用 对象
 sock 是 一个 预先 存 在的套接 字 对象 它是 由 socket
accept  返 回的
 ssl  可 被设 置 为 一 个 sslcontext 以在 接受 的连接上启 用 ssl
 sslhandshaketimeout 是为 一 个 ssl 连 接在 中止连接 前等 待 ssl 握 手完成 的时间【 单位 秒】
如 果为 none 缺 省则 是60
0秒
 返回 一 个 transport  protocol 对
3
7 新 版 功能 sslhandshaketimeout  形参
3
3新 版功 能
传 输 文 件
tls 升 级
starttlstransport  protocol  sslcontext  serversidefalse  serverhostnamenone  sslhandshaketimeoutnone  将现有基 于传 输的 连接 升 级到 tls
返 回一 个新 的 传输实 例其 中 protocol  必须 在 await  之后 立即开 始使 用
传 给 starttls 方法的 transport  实例 应 永远 不会 被再次 使用
 参 数 transport 和 protocol  实 例 的 方 法 与 createserver 和 createconnection 所 返回 的类 似
 sslcontext 一 个已 经配 置好 的 sslcontext  实例
 当服务 端 连接 已 升级 时 如 createserver  所 创建 的对象 serverside  会传 入 true
 serverhostname 设 置或 者 覆 盖目 标服务 器证 书 中 相 对 应 的主 机名
 sslhandshaketimeout  是用 于 tls 连接 的 在放 弃 连 接 之前 要等待 tls  握手 完 成的 秒数
如 果参 数为 none  则 使用 默 认的60
0
3
7新 版 功能
 监控 文 件描述 符
addreaderfd  callback  args  开 始 监 视 fd  文 件 描述符 以 获 取 读 取 的可用 性 一旦 fd  可 用 于读取使 用指定 的 参 数 调 用 callback 
removereaderfd  停 止 对 文件 描述 符 fd 读 取 可用 性的 监视
addwriterfd  callback  args 开 始监 视 fd 文件 描述 符的 写 入 可用性 一 旦 fd 可 用于 写 入 使 用 指 定 的参 数调 用 callback 
使 用 functools
partial 传递关 键 字 参数 给 callback
removewriterfd 停 止 对 文 件描 述符 fd  的 写入 可用 性 监视
 另请 查 看 平台支持 一节了 解 以上 方法的 某 些限制
直 接使 用 socket  对 象
dns
getaddrinfohost  port  family 0 type 0 proto 0 flags 0 异步 版的 socket
getaddrinfo 
getnameinfosockaddr  flags 0 异步 版的 socket
getnameinfo 
在3
7版 更 改 getaddrinfo 和 getnameinfo  方 法 一直 被标 记返回 一 个协 程但 是 python 3
7之 前 实际 返回的 是 asyncio
future 对 象
 从 python 3
7 开 始 这 两 个 方 法 是 协程
使 用管道
connectreadpipeprotocolfactory  pipe  在 事件 循环中 注册 pipe  的读取 端
 protocolfactory 必 须 为 一个返回 asyncio 协 议 实现 的可 调用 对 象
 pipe  是个 类似 文 件 型 对 象
 返回 一对 transport  protocol  其中 transport  支持 readtransport  接口而 protocol  是由 protocolfactory  所实 例 化 的对 象
使 用 selectoreventloop  事 件 循 环 pipe 被 设置 为非 阻 塞 模式
connectwritepipeprotocolfactory  pipe  在事 件循 环 中 注 册 pipe 的 写入 端
 protocolfactory 必 须为 一个返 回 asyncio 协 议实 现 的可 调用 对象
 pipe  是 个类 似文 件 型对 象
返 回一 对 transport  protocol  其 中 transport 支 持 writetransport  接 口而 protocol  是由 protocolfactory 所 实例 化 的对 象
使 用 selectoreventloop 事 件 循环 pipe 被 设 置 为非 阻塞 模式
 注 解 在 windows  中 selectoreventloop 不 支持上 述 方法
 对 于 windows  请 改 用 proactoreventloop
参见 loop
subprocessexec  和 loop
subprocessshell 方 法
unix 信 号
addsignalhandlersignum  callback  args 设 置 callback 作为 signum  信 号 的 处理 程序
 此 回 调将 与该 事 件循 环中 其 他 加 入队 列 的 回调 和可 运行 协程 一起 由 loop  发起调用
不 同 与使 用 signal
signal 注册 的信号 处 理 程序 使用此 函 数注 册 的回 调 可 以 与事件 循 环进行 交互
 如果 信 号 数 字 非 法 或 者 不 可 捕获 就 抛出 一 个 valueerror 
 如 果 建立 处理器 的过 程中出现问 题会抛 出一 个 runtimeerror 
使 用 functools
partial  传递 关键 字参 数 给 callback
 和 signal
signal 一 样这个 函 数只 能 在主 线 程中 调用
removesignalhandlersig 移 除 sig 信 号的 处理程序
 如 果信 号处 理 程序 被移 除 则 返回 true  否则 如 果 给 定 信号 未设 置处理 程 序则 返回 false
 可用 性 unix
参见 signal 模 块
在 线程 或 者 进程 池中 执 行 代 码。
runinexecutorexecutor  func  args 安 排 在 指 定的 执行 器中 调用 func 
 示 例 import  asyncio  import  concurrent
runmain 这 个 方 法返回 一个 asyncio
future 对 象
使 用 functools
partial 传递 关 键字 参数给 func 
 在3
3版 更 改 loop
runinexecutor 不会 再配置 它 所 创 建 的线程 池 执行 器的 maxworkers  而 是 将其留给 线 程池 执 行器 threadpoolexecutor  来设置默认值
setdefaultexecutorexecutor  将 executor  设 为 runinexecutor 所 使用 的 默 认 执行器
 executor  应当 是 threadpoolexecutor  的 实例
3
8 版 后 已 移 除使 用不 是 using  an  executor  that  is  not  an  instance  of  threadpoolexecutor 实 例的 执行器 的 做 法已被 弃 用 并将 在 python 3
9 中 引 起错 误
 executor 必 须 是个 concurrent
threadpoolexecutor  的 实例
 错误 处 理 api
 开启调 试 模式
getdebug  获取事件 循 环 调 试 模式 状态 bool
 如果 环境 变量 pythonasynciodebug 是 一个 非空 字 符 串就 返回 true 否 则就返回 false 
setdebugenabled  bool  设置 事件循 环的调 试 模 式
在3
7 版更 改 现 在也 可以 通过新 的 python 开 发模式来 启用 调 试 模式
 参 见 debug  mode  of  asyncio
运 行子 进程
 回调 处 理
handle 由 loop
callsoon  loop
callsoonthreadsafe 所 返回 的 回调 包装 器对象
 cancel 取 消回 调
如 果 此 回调 已被 取 消 或 已 被执 行此 方法将没 有 任何效果
 cancelled  如果此回 调 已 被取 消则 返回 true
3
7 新版 功能
timerhandle  由 loop
calllater 和 loop
callat 所 返 回 的回 调 包装器对 象
 这个类 是 handle 的 子类
 when  返 回加入 计划 任 务 的回 调 时间以 float  值表 示的 秒 数
时 间值 是 一个绝对时间 戳使 用与 loop
time  相同 的 时间引 用
3
7新 版功能
server 对 象
 事件 循 环实 现
asyncio 带有两 种不同 的事件 循环 实 现 selectoreventloop 和 proactoreventloop
 默认情况下 asyncio  被配 置 为在 unix  上使 用 selectoreventloop  而在 windows  上使 用 proactoreventloop
selectoreventloop 基 于 selectors  模块的事件 循 环
 使 用给定 平台 中最 高效的 可用 selector
 也 可以 手 动 配 置要 使用 的特定 selector  import  asyncio  import  selectors  selector  selectors
seteventlooploop  可 用性 unix  windows
proactoreventloop 用 io  completion  ports  iocp  构建的 专为 windows  的事 件循环
 可用 性 windows
 参见有 关 io  完成 端 口的 msdn 文档
abstracteventloop  asyncio  兼 容事 件 循环 的抽 象基 类
事件 循环方 法 一节列出 了 abstracteventloop 的替 代实 现应当 定义的 所有 方法
 示例
请 注 意本节中 的所有 示例 都 有 意地 演 示 了 如何 使 用低层 级的 事 件 循 环 api 例 如 loop
runforever  和 loop
现 代 的 asyncio 应 用很 少需 要以这 样的方 式编写 请考 虑 使用 高层级 的函 数 例 如 asyncio
callsoon  的 hello  world  示例。
 一个使 用 loop
callsoon 方法 来安排回调 的示例
 回 调会显示 helloworld  然 后停 止 事件 循 环 import  asyncio  def  helloworldloop  a  callback  to  print  hello  world  and  stop  the  event  loop  printhello  world  loop
close 参 见一 个类似 的 hello  world  示 例使用 协程 和 run  函数 创 建
 使 用 calllater  来 展示 当前 的日 期
一 个 每秒刷 新显 示当前 日期的示 例
回 调 使用 loop
calllater 方 法在5秒 后将 自 身重新 加入计划 日 程然 后 停 止事件 循环 import  asyncio  import  datetime  def  displaydateendtime  loop  printdatetime
close 参见 一个 类似 的 current  date 示 例 使 用协 程 和 run  函 数 创建
 监 控 一 个 文件 描 述符的 读事件
 使 用 loop
addreader  方法 等 到文件 描 述符 收到 一些 数据然后关 闭 事件循 环 import  asyncio  from  socket  import  socketpair  create  a  pair  of  connected  file  descriptors  rsock  wsock  socketpair  loop  asyncio
close 参见 一个 类 似的示 例使用 传输、 协 议和 loop
createconnection  方 法创建
 另一个 类似 的 示例 使用了高 层级 的 asyncio
openconnection  函 数 和流
 为 sigint 和 sigterm  设置 信 号处 理器
 这个 signals  示例 只 适用 于 unix
使用 loop
addsignalhandler 方 法 为信 号 sigint 和 sigterm  注册处 理程 序 import  asyncio  import  functools  import  os  import  signal  def  askexitsigname  loop  printgot  signal  s  exit  signame  loop
 异常
futures
 源代 码 libasynciofutures
pyfuture  对 象用 来链接 底层 回调式代码 和 高层异 步等 待 式代 码
future  函数
future 对 象
低层 级 api 索 引
本 页列出所有 低层 级的 asyncio  api
获取事件 循 环
getrunningloop  获取 当前运行 的 事件 循环首选 函 数
 asyncio
geteventloop 获得 一个 事件 循环实 例 当前或 通过 策略
 asyncio
seteventloop  通过 当前策 略将 事 件 循环 设置 当前 事件 循 环
 asyncio
neweventloop  创建一个 新 的事 件循 环
示例 使用 asyncio
事件循 环方法 集
查阅 事件 循 环方 法相关的主要 文档段落
 生命周 期 loop
rununtilcomplete  运行 一 个期程 任 务 可 等待对 象直 到完成
 loop
runforever  一直运 行 事 件 循 环
 loop
stop  停 止事 件循 环
 loop
close 关闭事件循 环
 loop
isrunning 返回 true 如 果 事 件循 环 正在 运行
 loop
isclosed 返回 true  如 果事件 循环已 经 被 关 闭
 await  loop
shutdownasyncgens  关 闭 异 步生 成器
 调试 loop
setdebug  开启或禁 用 调试模式
 loop
getdebug  获取 当 前 测试模 式
调 度 回调 函数 loop
callsoon 尽快 调用 回调
 loop
callsoonthreadsafe  loop
callsoon  方法线程 安全的 变体
 loop
calllater 在 给 定时间 之后调 用 回调 函数
 loop
callat  在指 定时 间调 用回调 函数
线程 进程 池 await  loop
runinexecutor  在 concurrent
futures  执 行 器中 运行 一个 独占 cpu 或 其它 阻塞 函 数
 loop
setdefaultexecutor 设置 loop
runinexecutor  默认 执行 器
 任 务与 期程 loop
createfuture  创建 一个 future  对 象
 loop
createtask  将 协程当 作 task 一 样调度
 loop
settaskfactory  设 置 loop
createtask  使用 的 工厂 它 将用来 创 建 tasks 
 loop
gettaskfactory  获取 loop
createtask 使 用的 工厂 它用来创建 tasks 
 dns  await  loop
getaddrinfo 异 步版的 socket
getaddrinfo 
 await  loop
getnameinfo 异 步版的 socket
getnameinfo 
 网 络和 ipc  await  loop
createconnection 打开一 个 tcp 链 接
 await  loop
createserver 创建 一个 tcp  服务
 await  loop
createunixconnection  打开一 个 unix  socket 连 接
 await  loop
createunixserver  创建一 个 unix  socket 服务
 await  loop
connectacceptedsocket 将 socket 包 装成 transport  protocol  对
 await  loop
createdatagramendpoint  打 开 一 个数 据报 udp 连 接
 await  loop
sendfile 通过 传 输通道发 送一 个文件
 await  loop
starttls 将 一 个已 建立 的链 接升级 到 tls
 await  loop
connectreadpipe 将管道读 取 端 包装成 transport  protocol  对
 await  loop
connectwritepipe  将 管 道写 入 端包 装 成 transport  protocol 对
 套接 字 await  loop
sockrecv 从 socket  接收数据
 await  loop
sockrecvinto 从 socket 接收 数据到 一 个缓 冲区中
 await  loop
socksendall 发 送数据 到 socket 
 await  loop
sockconnect 链 接 await  loop
sockconnect 
 await  loop
sockaccept  接受 一个 socket  链接
 await  loop
socksendfile 利 用 socket 发送一个 文 件
 loop
addreader  开始 对 一 个 文 件描 述符 的 可 读性 的 监视
 loop
removereader 停 止 对一 个文 件描述 符的 可读 性 的 监视
 loop
addwriter 开 始 对一 个 文件 描述符的 可写性 的 监 视
 loop
removewriter 停 止 对一 个 文件 描述 符的 可 写性 的监 视
 unix  信号 loop
addsignalhandler  给 signal  添加一 个处 理 回 调函 数
 loop
removesignalhandler  删除 signal 的处 理回 调 函 数
子 进程 loop
subprocessexec  衍生 一个子进 程 loop
subprocessshell  从 终 端 命令 衍 生 一个 子进 程
错 误处 理 loop
callexceptionhandler 调 用异 常处 理 器
 loop
setexceptionhandler 设 置一 个 新的 异 常 处 理 器
 loop
getexceptionhandler 获 取 当前 异 常处理 器
 loop
defaultexceptionhandler 默 认 异 常 处理 器实 现
示 例 使 用 asyncio
geteventloop  和 loop
使用 loop
 使用 loop
createconnection  实现 echo  客 户端
 使用 loop
createconnection  去 链 接 socket
 使 用 addreader 监 听 fd 文 件描 述符 的读 取 事 件
使 用 loop
使用 loop
addsignalhandler
 传 输
协 议
协议类可 以由下面 回调方 法实 现 callback  connectionmade 链 接建 立 时 被调 用
 callback  connectionlost 链接丢 失或 关 闭 时被 调用
 callback  pausewriting  传 输 的 缓 冲区 超过 高位 标记 位时 被 调用
 callback  resumewriting 传输 的 缓冲 区传 送 到 低位 标记 位时 被调 用
 流协 议 tcp  unix 套接字 管 道 callback  datareceived  接收 到 数据 时被 调用
 callback  eofreceived 接收到 eof  时被调 用
缓 冲 流协 议 callback  getbuffer  调 用 后会分 配 新 的 接收 缓冲区
 callback  bufferupdated  用接 收 的 数 据更新 缓冲区 时被 调用
 callback  eofreceived 接 收 到 eof 时 被调 用
 数 据 报协 议 callback  datagramreceived  接 收 到 数据 报时被 调用
 callback  errorreceived  前 一 个发 送或 接收 操作 引发 oserror 时 被 调 用
子 进程 协议 callback  pipedatareceived  子进 程向 stdout 或 stderr  管 道 写入 数据时被 调用
 callback  pipeconnectionlost 与 子进 程 通信 的其 中 一 个管 道 关闭 时被调 用
 callback  processexited  子 进程 退 出时 被调 用

事件 循环 策略
 策 略是 改变 asyncio
geteventloop  这 类函 数 行为 的一个 底 层 机制
 更多 细 节可 以查 阅策略 部分
 访问策 略 asyncio
geteventlooppolicy 返回 当前 进程 域的策略
 asyncio
seteventlooppolicy  设 置 一 个 新的进 程 域 策 略
 abstracteventlooppolicy  策 略对 象的基类

 平 台 支持
asyncio  模块 被 设计为 可 移 植 的但 由 于平 台的底 层架 构和 功能一 些平台 存 在 细 微的 差 异和限 制
所有 平台
addreader  和 loop
addwriter  不能 用来监 视文 件 io
windows
windows 的 子 进程 支 持
 在 windows  上默 认的 事件 循环 proactoreventloop  支持子进 程 而 selectoreventloop  则 不支 持
也 不 支持 policy
setchildwatcher  函数 proactoreventloop  有 不同 的机 制来 监视 子 进程
macos
 完整 支持 流 行的 macos  版 本
8在 macos 10
7 和10
8上 默认 的 事 件循 环 使用 selectors
kqueueselector  在 这些版 本上 它 并 不 支 持字 符设 备
 可 以手 工 配置 selectoreventloop 来 使用 selectselector 或 pollselector  以 在这 些 较老 版本 的 macos 上支 持字符 设 备
例 如 import  asyncio  import  selectors  selector  selectors
 策 略
事件 循环 策略 是各个 进程 的全 局对象 它控制事 件循 环的管 理
每 个事件循 环 都 有一个 默认策 略可 以 使用 策略 api  更改 和定制该 策略
 策 略定 义 了 上 下文的概 念 每 个上下文 管 理 一个单 独的 事件 循 环
默 认策略 将 context  定 义为 当前 线 程
 通过 使用自定 义 事件 循环 策略 可以 自 定义 geteventloop 、 seteventloop  和 neweventloop  函数 的行 为
 策 略对象 应 该 实现 abstracteventlooppolicy  抽 象基类 中定 义的 api
获 取和 设 置策略
可 以使用下 面函数 获取 和 设 置 当前 进程的 策 略 asyncio
geteventlooppolicy 返 回当 前 进程域 的策 略
seteventlooppolicypolicy  将 policy 设 置为当 前进 程域策 略
如果 policy  设 为 none 将 恢复 默认策略
 策 略对 象
抽象 事 件循 环 策略基 类定义 如 下 class  asyncio
abstracteventlooppolicy 异 步 策略 的抽 象基类
 geteventloop  为当前 上 下文 获 取 事件循 环
返 回一 个实现 abstracteventloop  接口 的事 件 循环 对象
该方 法永 远返回 none
 在3
6版 更改
 seteventlooploop 将当 前 上下文 的事件 循 环设 置 为 loop 
 neweventloop 创 建并 返回 一个 新 的事 件 循 环对 象
该 方法永远 返 回 none
 getchildwatcher 获 取 子进程 监视器 对象
返 回一个实 现 abstractchildwatcher 接 口的 监视 器对象
该 函数 仅支持 unix
 setchildwatcherwatcher 将 当 前子 进程 监视器设 置 为 watcher 
该 函 数仅 支 持 unix
asyncio 附 带下 列内 置 策 略 class  asyncio
defaulteventlooppolicy 默 认的 asyncio 策 略
在 unix 上 使 用 selectoreventloop 而 在 windows 上使 用 proactoreventloop
不 需要手动 安装默 认策 略
asyncio  已配置成 自动使用 默认策略
 在3
8版更改在 windows  上现 在 默认 会使 用 proactoreventloop
windowsselectoreventlooppolicy 一 个使用 selectoreventloop 事 件循 环实现的 替 代事 件 循环策 略
可 用 性 windows
windowsproactoreventlooppolicy 使用 proactoreventloop 事 件循环 实现的 另一 种事件 循环 策略
可用 性 windows
进 程 监视器
进 程 监 视 器 允许定 制 事 件 循 环如 何监视 unix  子进程
具 体来说 事件 循 环 需 要知道 子进 程何 时退 出
 在 asyncio  中 子 进程由 createsubprocessexec  和 loop
subprocessexec 函 数 创 建
asyncio 定 义 了 abstractchildwatcher 抽象 基类子 监 视器 必 须要 实现 它并具 有四种 不 同实 现 threadedchildwatcher  已 配置为 默认 使用 multiloopchildwatcher  safechildwatcher  和 fastchildwatcher
请参 阅子 进程 和 线程部 分
以下两 个函 数可用 于自 定义子进程 监视 器 实现它 将被 asyncio  事件循 环使 用 asyncio
getchildwatcher  返回 当前 策略的 当前 子 监视 器
setchildwatcherwatcher  将 当前 策略 的子监 视器设 置 为 watcher 
watcher 必 须实现 abstractchildwatcher 基类 定义的 方法
 注解 第三方事件循 环 实现 可能不支 持 自定 义子 监视器
对于 这 样的 事 件循 环禁 止使 用 setchildwatcher 或 不 起作 用
abstractchildwatcher  addchildhandlerpid  callback  args 注 册一 个 新的子 处 理回调 函 数
安 排 callbackpid  returncode  args  在进 程的 pid 与 pid 相等 时调 用
指 定 另一 个 同进程的回 调函数替 换 之前 的回调处理 函数
 回 调 函数 callback 必须是 线 程安全
 removechildhandlerpid  删除 进程 pid  与 pid  相等 的进 程的 处理 函 数
处 理函 数 成功 删除时 返 回 true 没 有删 除 时 返回 false 
 attachlooploop  给一 个 事件循环绑 定 监 视器
 如果 监视 器之前 已绑 定另 一 个事件 循环那 么在 绑定 新循环 前 会先 解 绑 原来 的事 件 循环
注 意 循环 有可 能是 none 
 isactive  如果 监 视 器已 准备好 使用则 返回 true
使 用不 活动 的 当 前子 监视 器 生 成子 进程将 引发 runtimeerror
3
8 新版 功 能
 close 关 闭监 视器
 必须 调 用这 个 方 法 以确保 相关 资 源 会被清 理
threadedchildwatcher 此实现 会为 每 个生 成的 子 进程 启动 一 具新 的 等 待线程
 即使 是当 asyncio  事件循 环 运 行在非 主 os  线 程 上 时 它 也能 可靠地 工作
当 处 理 大 量 子 进程时也 不 存 在 显著 的 开销 每个 子进 程结 束时 为 o 1但当每 个 进程 启 动 线程 时则 需 要额 外 的 内存
 此 监视器 会默 认被 使用
3
8新 版功 能
multiloopchildwatcher 此实现 会 在实例 化时 注 册一 个 sigchld 信 号 处 理 程序
这可 能 会 破坏为 sigchld 信号 安装自定 义处理程 序的 第三 方 代码
此 监 视器会在收 到 sigchld 信 号时 通过显 式地 轮 询每 个 进程 来避免 干扰 其他代码 生成 的进 程
 该监 视器一 旦被安装就不会 限 制从 不同线程 运行子 进 程
该解决 方案 是安 全的 但在 处 理大 量进 程时会 有 显著 的开 销每 收到 一个 sigchld  时 为 on
3
8新版 功能
safechildwatcher  该实 现会 使 用 主 线 程 中的活 动事 件 循 环来 处理 sigchld  信 号
如 果主 线程 没有 正在 运 行的 事 件 循 环则其 他线程无 法生 成 子进 程会引 发 runtimeerror
此 监视 器 会在 收到 sigchld 信号 时通 过显 式地 轮 询每 个进 程来 避 免 干 扰 其 他 代 码生成的 进程
 该解 决 方 案与 multiloopchildwatcher  同样 安全 并同 样具 有 on 复 杂度 但需 要主线 程有 正 在 运 行的 事件 循环才能 工作
fastchildwatcher  这种 实现 直接 调用 os
waitpid 1 来获 取所 有已 结束 的 进程 可能 会中 断其 它代 码洐生 进程并 等待它 们结束
 在 处理 大量 子 监视 器 时没有 明 显的开销 o 1 每次子 监 视 器 结束
该 解决方 案需 要主 线 程有 正在 运行 的 事件 循环 才 能工 作这与 safechildwatcher  一样
pidfdchildwatcher 这 个实 现会轮询 处理 文件 描述 符 pidfds 以 等 待子 进 程终 结
 在 某 些方面 pidfdchildwatcher  是一个 理想的子 进程监 视器 实现
 它不 需要使 用 信号 或线程 不会 介入 任何 在 事 件循环以 外发起 的进 程并 能随 事件循 环发 起的子进 程 数量 进行线 性 伸缩
其 主要缺点 在于 pidfds 是 linux  专属 的并且 仅在 较近 版本的 核心5
3 上 可用
3
9 新 版 功能
 自 定义策 略
 传输 和协 议
传输
 源码 libasynciotransports
py  传输属 于 asyncio  模 块中 的 类用 来抽 象各 种通 信通 道
传输 对象总 是由 异步 io  事 件 循 环实例 化
异步 io 实现 tcp 、 udp 、 ssl  和子 进 程管道 的传 输
 传输上 可用的 方法 由传输 的类 型决 定
传输类 属 于线 程 不 安 全
传 输层级
basetransport  所 有传 输 的 基类
包含 所 有异 步 io  传 输 共 用 的方法
writetransportbasetransport  只写链 接的 基 础传输
 writetransport  类的实 例由 loop
connectwritepipe  事件 循 环方 法 返回 也被子进 程相 关 的方 法如 loop
subprocessexec  使 用
readtransportbasetransport  只读 链接 的基 础传 输
 readtransport 类 的 实 例由 loop
connectreadpipe  事件 循环 方法 返回 也 被 子进 程相 关的方 法 如 loop
subprocessexec 使 用
transportwritetransport  readtransport  接口 代 表 一 个双 向传 输如 tcp  链接
用 户 不用 直 接实 例化传 输 调 用一 个功 能函 数 给它 传递 协 议工 厂 和 其 它需要 的 信息 就可 以创 建传 输和 协议
 传 输类 实例 由如 loop
createconnection 、 loop
createunixconnection 、 loop
createserver 、 loop
sendfile 等 这 类 事件 循环 方法 使用或返回
datagramtransportbasetransport 数 据报 udp  传 输 链接
 datagramtransport  类实 例 由事 件循 环 方 法 loop
createdatagramendpoint 返 回
subprocesstransportbasetransport  表示 父进 程 和子进 程 之 间连 接的 抽象
 subprocesstransport 类 的实 例由 事件 循环 方法 loop
subprocessshell 和 loop
subprocessexec 返 回
基 础传输
 只 读传 输
 只写 传输
 数据报 传 输
sendtodata  addrnone 将 data  字节 串 发送 到 addr 基于 传输 的目标 地址 所 给定 的远 端对 等 方
如果 addr 为 none  则将 数据 发 送 到 传 输 创 建 时给 定的目标 地址
 此方法 不 会 阻 塞它 会缓 冲 数 据并安 排其 被异 步 地发 出
abort 立即关 闭 传输 不会 等 待已 提交的 操作 执 行完 毕
已缓 存的 数 据 将会 丢 失
不 会 接收 更 多的 数据
 协议的 protocol
connectionlost  方法 最终 将附带 none  作为 参数 被 调用
 子进 程 传输
getpid  将子 进程 的进程 id  以整 数形 式 返回
getpipetransportfd  返 回对 应 于 整 数文件 描 述符 fd  的通 信管 道的 传输0 标准输 入 stdin 的可 读流 式传 输如果子 进程 创建时 未设置 stdinpipe 则为 none 1 标准 输 出 stdout 的可 写流式传输 如 果 子进程 创 建时 未 设置 stdoutpipe 则 为 none 2标准 错 误 stderr  的 可 写流式 传输 如 果子 进 程创 建时 未 设置 stderrpipe  则 为 none 其 他 fd  nonesubprocesstransport
getreturncode 返回 整数 形式的 进程返 回码 或者 如果还 未返 回则 为 none 这 类 似 于 subprocess
returncode 属 性
kill  杀 死子 进程
 在 posix 系 统中 函 数 会 发送 sigkill  到子进 程
在 windows  中 此 方法 是 terminate 的 别 名
另 请 参见 subprocess
sendsignalsignal 发 送 signal 编 号到 子 进程与 subprocess
sendsignal 一样
terminate  停止 子进程
 在 posix 系 统 中此 方法 会发送 sigterm  到子 进 程
 在 windows 中 则 会调用 windows  api  函 数 terminateprocess 来 停止 子进程
 另请参 见 subprocess
close 通过 调用 kill  方 法 来杀 死子进程
 如 果 子进程 尚未返 回并 关闭 stdin  stdout 和 stderr 管 道的 传 输
协 议
 源码 libasyncioprotocols
pyasyncio 提供 了 一组抽 象基类它 们应 当 被 用 于实现 网络 协议
 这些类 被设 计 为与 传输配合 使用
 抽象基础协 议 类的 子类 可 以 实 现 其 中 的部 分 或全 部方法
所 有 这 些 方 法都是 回调 它们 由传输 或特 定 事件 调用例如 当数 据 被接 收的 时候
 基 础协议 方 法应 当 由相 应的 传输 来调 用
基础 协 议
baseprotocol 带 有 所 有协 议的 共享 方 法 的基 础协议
protocolbaseprotocol  用 于实 现 流 式协 议 tcp  unix 套 接字等等 的 基类
bufferedprotocolbaseprotocol  用 于实 现 可对接 收缓冲 区 进行手动 控制 的流 式协议的 基类
datagramprotocolbaseprotocol  用于 实现 数据 报 udp  协 议 的 基类
subprocessprotocolbaseprotocol  用于实 现与 子进 程通信 单向 管道的协议的 基类
基础 协议
 所有 asyncio  协议 均可 实现基 础 协 议回 调
连 接 回 调 连接回调 会 在所 有 协议 上 被 调用 每 个 成功 的连接将 恰 好调用一 次
所有其他 协 议回调只 能 在以 下 两个方法之 间 被调 用
connectionmadetransport 连接 建立 时被调 用
 transport  参 数 是代表 连接 的传 输
此协 议负责 将引用 保 存至 对应的传 输
connectionlostexc  连接丢失或关闭 时将 被 调用
方法的 参数 是 一个 异常对象 或为 none
后者意味 着收 到了 常 规的 eof  或者连 接被 连接 的一 端取 消或关闭
 流程控 制 回 调 流 程控 制 回调 可由 传 输来 调用 以暂 停 或 恢 复 协议所 执 行的 写入操作
 请 查看 setwritebufferlimits 方 法 的文 档了 解 详情
pausewriting 当 传输 的 缓 冲区 升至高水位 以上 时将被 调 用
resumewriting  当传输 的 缓冲区 降到 低水位 以下时 将 被调 用
如果 缓冲 区大 小等于 高水 位 值 则 pausewriting  不会 被调用缓冲 区大 小必须 要高于 该值
相 反地 resumewriting  会在 缓冲 区大 小 等 于或 小 于低 水 位 值时被 调 用
 这些 结 束 条件 对于 当两 个水 位 取 零值 时也 能 确 保符合预 期的 行为 是很 重要的
流式协议
事 件 方法 例如 loop
createserver  loop
createunixserverloop
createconnection  loop
createunixconnectionloop
connectacceptedsocket  loop
connectreadpipe  和 loop
connectwritepipe  都接 受返 回流 式 协议 的工 厂
datareceiveddata 当 收到数据时 被 调用
 data  为包 含入站数据 的非 空字 节串对 象
数 据是 否 会 被缓 冲、分 块或 重组取 决 于具 体 传 输
通 常你 不应 依 赖 于 特定 的语 义而 应使 你的解 析具 有 通 用性 和灵 活性
 但是 数据 总是 要以 正确 的顺 序被 接收
 此方 法在 连接 打 开 期 间 可 以被 调用 任意 次数
 但是 protocol
eofreceived  最多 只会 被调 用 一 次
 一旦 eofreceived  被调 用 datareceived 就 不 会 再被 调用
eofreceived  当发 出信 号的 另一 端不 再 继续发送 数 据 时例 如通 过调用 transport
writeeof  如果 另 一端 也 使用 asyncio  的话被调 用
此 方法可能返 回假 值 包括 none 在 此情 况下 传输 将 会自 行关 闭
 相反 地如果 此方 法返回 真值 将以 所 用 的协 议来确 定是 否要 关闭 传输
 由于默认实 现是 返回 none 因 此它 会隐 式 地 关闭连 接
某 些传输包 括 ssl 在 内 并不 支持 半关 闭的 连接在 此情 况下 从该 方法 返回 真值将导 致连接 被关 闭
状 态 机 start  connectionmade  datareceived  eofreceived  connectionlost  end
缓冲 流协 议
3
7新 版功能
带 缓冲 的协议 可 与任何 支持 流 式协 议的 事件 循环 方 法配 合使用
bufferedprotocol  实现 允 许显 式手 动分配 和控 制接收 缓冲 区
随 后事件循环 可 以使 用协 议提 供的 缓冲 区来 避免 不 必 要的 数据 复 制
 这对 于接 收大 量 数据 的协议来说 会有 明 显的 性能 提升
 复杂 的协 议 实 现能显著 地 减少 缓 冲区 分 配的 数 量
以下 回 调是 在 bufferedprotocol  实 例 上被 调用 的 bufferedprotocol
getbuffersizehint 调 用后会分配 新 的接收 缓冲 区
 sizehint 是 推荐的返 回缓冲 区 最小 尺寸
 返回小 于或大 于 sizehint 推荐尺 寸的 缓冲 区也 是可 接受 的
当 设 为1时 缓冲 区 尺 寸 可以是任 意的
 返回尺 寸 为 零的 缓 冲 区 则 是 错误的
 getbuffer  必须 返 回一 个 实 现了 缓冲 区协 议的 对象
bufferupdatednbytes  用 接收的 数据更 新缓 冲区 时被调 用
 nbytes 是 被写 入到 缓 冲区的 字 节总数
eofreceived  请 查看 protocol
eofreceived 方 法的 文档
在连接 期 间 getbuffer 可以被调 用任 意 次 数
但 是 protocol
eofreceived 最 多 只能 被调用 一次如 果被 调用则 在此 之后 getbuffer 和 bufferupdated 不能 再 被 调 用
状态机 start  connectionmade  getbuffer  bufferupdated  eofreceived  connectionlost  end
 数据 报 协 议
 子 进程 协议
数据报 协 议实 例应 当 由 传 递 给 loop
subprocessexec 和 loop
subprocessshell 方 法 的 协议 工厂来构造
pipedatareceivedfd  data 当 子进程向 其 stdout 或 stderr 管道写 入数据 时 被调 用
 fd 是 以 整数 表示 的 管 道 文件 描述 符
 data 是包含 已接 收数据的 非空字节串 对象
pipeconnectionlostfd  exc  与子进程通 信的 其中一个管 道 关 闭 时被 调 用
 fd 以 整数 表示 的已 关闭 文件 描述 符
processexited 子进 程退出时 被调用
示例
tcp 回 显服 务器
使 用 loop
createserver  方法 创建 tcp 回显服 务 器 发回 已接收 的数据 并 关闭 连 接 import  asyncio  class  echoserverprotocolasyncio
runmain 参见 使 用 流 的 tcp  回 显 服务 器示例使用了高层 级的 asyncio
startserver  函 数
tcp  回显 客户 端
使用 loop
createconnection  方法 的 tcp 回 显客户 端发送 数 据并 等待 直 到 连接 被 关 闭 import  asyncio  class  echoclientprotocolasyncio
runmain  参 见 使用 流的 tcp  回显 客 户 端 示 例 使 用 了高 层 级 的 asyncio
openconnection  函 数
udp  回显 服务 器
使用 loop
createdatagramendpoint 方 法的 udb  回显 服务 器 发 回 已接 收的 数据 import  asyncio  class  echoserverprotocol  def  connectionmadeself  transport  self
udp  回显 客户 端
 使用 loop
createdatagramendpoint  方法 的 udp  回显 客户 端发 送数 据 并在 收到 回应 时关 闭 传 输 import  asyncio  class  echoclientprotocol  def  initself  message  onconlost  self
链接 已 存 在的 套 接字
附 带一 个 协议 使 用 loop
createconnection 方 法 等待 直到 套 接 字 接收 数 据 import  asyncio  import  socket  class  myprotocolasyncio
runmain 参见 使 用低层级 的 loop
addreader  方法 来注 册一 个 fd 的 监视 文 件描 述符 以 读取 事件 示例
 使用 在协 程中 通 过 openconnection 函 数创 建 的高 层级 流的 注册 一个 打开 的套 接字 以等 待使用 流的数 据示例
loopsubprocessexec  与 subprocessprotocol
一 个使 用子进 程协议来 获取 子进 程 的输 出 并 等待子 进程 退出 的 示 例
这 个子 进程 是由 loop
subprocessexec  方法 创建 的 import  asyncio  import  sys  class  dateprotocolasyncio
rungetdate  printfcurrent  date  date 另 请 参阅 使用 高层 级 api  编 写的 相同示例
 队 列集
源代 码 libasyncioqueues
pyasyncio  队列 被 设 计成 与 queue 模 块类 似
尽 管 asyncio 队 列不 是线 程 安全的 但是 他们 是被 设 计 专用 于 asyncawait 代码
注 意 asyncio 的 队列 没 有 timeout  形参 请 使 用 asyncio
waitfor  函 数 为 队 列添 加超 时操 作
参 见 下面 的 examples 部 分
队 列
优 先级 队列
priorityqueue  queue  的变 体按 优先 级 顺序 取出 条目 最小的 先取 出
条 目 通常 是 prioritynumber  data 形 式的 元 组
 后 进先出队 列
lifoqueue  queue 的变 体先取出最 近添 加的 条 目后 进先出
 异常
queueempty  当队 列 为空 的 时候 调用 getnowait  方法而 引发 这个 异常
queuefull  当 队列 中条 目数 量已经 达到 它的 maxsize 的时候 调用 putnowait 方 法而 引发的 异常
 示例
队列 能 被用于多 个 的 并 发 任务的 工作 量分 配 import  asyncio  import  random  import  time  async  def  workername  queue  while  true  get  a  work  item  out  of  the  queue
流
streamreader
streamwriter
streamwriter 这个 类表示一 个写 入 器 对 象 该对象 提供 api  以 便于写数 据至 io 流 中
不建 议 直 接 实 例化 streamwriter  而 应 改 用 openconnection 和 startserver
 writedata  此 方 法 会 尝 试 立 即 将 data 写 入到 下层的 套接 字
 如果 写 入失败 数据会 被排 入 内 部 写缓 冲队 列直 到可 以 被发 送
 此 方 法应当 与 drain 方 法 一 起 使用 stream
drain  writelinesdata  此 方法 会 立即 尝 试将 一 个 字 节串 列表 或 任何 可 迭代 对 象 写 入到 下层 的 套接 字
 如 果写 入失 败数据 会被 排 入内 部 写 缓冲 队列 直 到可 以被发 送
 此方法 应当 与 drain  方 法 一 起使 用 stream
drain  close 此 方法 会 关闭流 以 及下 层 的套 接字
 此方法 应与 waitclosed  方法 一起 使用 stream
waitclosed  canwriteeof  如 果下 层的 传 输 支持 writeeof  方法 则返 回 true 否 则返回 false
 writeeof  在已 缓冲 的 写入 数据 被 刷 新 后关 闭流 的写 入 端
 transport 返 回下层 的 asyncio  传输
 getextrainfoname  defaultnone  访问 可选 的传 输信 息 详情 参见 basetransport
getextrainfo
 coroutine  drain  等 待直到 可以 适当 地 恢复 写入到 流
 示 例 writer
drain 这是 一 个与 下层的 io  写缓冲区 进 行 交互的 流程 控 制 方 法
 当 缓冲 区 大小 达 到 最高 水位 最大 上 限时 drain  会阻塞 直到 缓冲 区大 小 减少至 最低 水位 以 便 恢复 写入
 当 没有要等 待 的 数据 时 drain  会 立 即返 回
 isclosing 如 果 流 已被 关闭 或正 在被 关闭 则返 回 true
3
7新 版功 能
 coroutine  waitclosed 等 待 直 到流 被关 闭
应 当在 close  之后 被调 用 以便 等 待 直 到 下层 的连接被 关闭
3
7新版 功 能
 示 例
 使用 流的 tcp  回 显 客户 端
使用 asyncio
openconnection 函 数 的 tcp 回 显 客 户端 import  asyncio  async  def  tcpechoclientmessage  reader  writer  await  asyncio
runtcpechoclienthello  world 参 见使 用低 层级 loop
createconnection 方 法的 tcp 回 显 客 户 端 协 议 示例
 使用 流的 tcp  回 显 服 务器
tcp  回显 服 务器使用 asyncio
startserver 函 数 import  asyncio  async  def  handleechoreader  writer  data  await  reader
runmain 参 见 使 用 loop
createserver  方 法的 tcp  回显 服务器协议 示 例
 获 取 http  标 头
查 询命 令行 传 入 url  的 http 标 头的 简 单示 例 import  asyncio  import  urllib
runprinthttpheadersurl 用 法 python  example
html 或 使 用 https  python  example
注 册 一 个 打 开的套 接 字 以 等 待 使用 流的 数据
使用 openconnection  函数 实现 等 待直 到 套接 字接收 到数据的 协 程 import  asyncio  import  socket  async  def  waitfordata  get  a  reference  to  the  current  event  loop  because  we  want  to  access  lowlevel  apis
runwaitfordata 参 见使用 低 层 级 协 议以 及 loop
createconnection  方法 的注 册 一个 打开 的套 接 字 以 等待使 用 协 议 的 数据 示 例
使用 低层级 的 loop
addreader  方 法来 监视 文件 描述 符的 监视 文 件描 述符 以读 取事 件示 例
子进 程
源 代码 libasynciosubprocess
py  libasynciobasesubprocess
py  本节 介绍了 用于 创建 和管 理子 进 程 的 高层 级 asyncawait  asyncio  api
 下 面的 例子演示 了如 何 用 asyncio 运 行一个 shell  命令并获 取其 结果 import  asyncio  async  def  runcmd  proc  await  asyncio
runrunls  zzz  将打 印 ls  zzz  exited  with 1 stderr  ls  zzz  no  such  file  or  directory  由于 所有 asyncio  子进 程 函数 都 是异 步 的并且 asyncio  提供了许 多 工 具 用 来配合 这些 函数使 用因 此并 行地 执行 和监视 多个子 进程十 分容 易
要修 改上面 的例子 来同 时运行 多个 命 令确 实是非 常 简单 的 async  def  main  await  asyncio
runmain 另 请参阅 examples 小 节
创 建子进 程
createsubprocessexecprogram  args  stdinnone  stdoutnone  stderrnone  loopnone  limitnone  kwds 创 建一 个子 进程
 limit  参 数 为 process
stdout 和 process
stderr  设置 streamreader 包 装 器 的缓冲 区 上限 如果将 subprocess
pipe  传 给 了 stdout 和 stderr 参 数
返回 一个 process 实例
 有关 其他形 参的 说 明请 查 阅 loop
subprocessexec 的文 档
10 loop  形参
createsubprocessshellcmd  stdinnone  stdoutnone  stderrnone  loopnone  limitnone  kwds  运行 cmd  shell  命令
 limit 参数 为 process
stdout 和 process
stderr  设 置 streamreader 包装 器的 缓冲 区上 限如 果 将 subprocess
pipe  传给 了 stdout 和 stderr 参 数
 返 回一个 process  实 例
有关其 他 形参的 说明 请查 阅 loop
subprocessshell 的 文档
 重要 应 用 程序 要负 责确保正 确地转 义所 有空白 字符 和 特殊 字 符 以 防止 shell 注 入 漏 洞
 shlex
quote 函 数可 以 被 用来 正确 地转 义 字符 串 中 可以 被用 来 构造 shell  命令的 空白 字符 和特 殊 shell  字符
10 loop  形参
注解 如果 使 用了 proactoreventloop 则子进程 将在 windows  中可用
详 情 参 见 windows  上 的 子 进 程 支持
参 见 asyncio 还 有 下列 低层 级 api 可配 合子 进程使用 loop
connectwritepipe  以及 子 进程传输和 子 进 程协议
 常 数
pipe 可 以 被传递 给 stdin  stdout 或 stderr  形参
 如果 pipe 被传 递给 stdin 参数 则 process
stdin 属 性 将 会 指向一 个 streamwriter 实例
 如 果 pipe  被传递 给 stdout 或 stderr  参数则 process
stdout 和 process
stderr  属性 将 会指 向 streamreader 实 例
stdout 可以 用作 stderr  参 数 的 特殊 值表 示标 准错 误应 当 被重 定向 到标 准输出
devnull 可 以用作 stdin  stdout  或 stderr 参数 来 处理 创建 函数 的特 殊值
它表示 将为 相应 的子 进 程流 使用特 殊 文 件 os
devnull
与 子进 程交 互
createsubprocessexec  和 createsubprocessshell  函 数 都 返回 process 类 的实 例
 process 是 一个高层 级包装 器 它允 许与子 进程 通 信 并 监视 其完成情 况
process 一 个用于 包装 createsubprocessexec  and  createsubprocessshell 函 数创 建的 os  进程的对象
 这 个类 被 设计 为具有 与 subprocess
popen 类相 似的 api  但 两者有 一 些重 要的 差异不 同于 popenprocess  实例没有与 poll  方 法等 价 的 方 法 communicate  和 wait  方法没有 timeout  形参 要使用 waitfor  函数 process
wait 方 法是 异步 的而 subprocess
wait  方 法则 被实现 为阻 塞 型忙循环 universalnewlines  形参 不 被 支 持
这 个类 不是 线程 安全 的
请 参 阅 子 进 程和 线程 部分
 coroutine  wait  等 待 子 进程 终结
设置 并返 回 returncode 属性
 注解当 使用 stdoutpipe  或 stderrpipe 并且子 进程 产生了 足 以 阻 塞 os  管 道 缓 冲区 等 待接 收更 多的 数据 的输 出时此 方法会 发生死锁
 当 使用管 道时 请使用 communicate  方法 来 避免 这种情 况
 coroutine  communicateinputnone  与 进 程交 互1
 发送 数 据 到 stdin  如果 input  不 为 none 2
从 stdout  和 stderr 读 取 数 据 直 至 到达 eof 3
 等 待 进 程 终 结
可 选的 input  参 数 为将被 发 送 到子 进 程的 数 据 bytes 对 象
 返回一 个 元组 stdoutdata  stderrdata
如 果在 将 input 写 入 到 stdin  时引 发了 brokenpipeerror  或 connectionreseterror 异 常 异常 会被忽略
此 条 件会 在进 程先于所 有数 据 被写入 到 stdin 之 前退 出时发 生
 如 果 想要将 数据发 送到进 程 的 stdin 则创 建进程时 必须使 用 stdinpipe
类 似地要在结果 元组中 获得 任何 不为 none  的值则创建 进 程时 必 须 使 用 stdoutpipe 和 或 stderrpipe 参数
 注意数 据读 取 在内存 中是带 缓冲 的因 此如果 数据量 过大 或不 受则 不要使 用此 方法
 sendsignalsignal  将信 号 signal 发送 给 子进 程
注解 在 windows 上 sigterm 是 terminate 的 别 名
 ctrlcevent 和 ctrlbreakevent  可 被 发 送 给 创 建 时设 置 了 creationflags  形 参且其 中包括 createnewprocessgroup 的 进程
 terminate  停止 子进 程
 在 posix 系 统 中 此方 法会发 送 signal
sigterm 给 子进 程
 在 windows 上 会调 用 win 32 api 函 数 terminateprocess 以 停止子 进程
 kill  杀 掉子 进 程
 在 posix 系 统中此 方 法会发送 sigkill  给子进程
 在 windows 上 此方 法是 terminate 的别 名
 stdin  标 准 输 入流 streamwriter  或 者如 果进 程创 建时设 置 了 stdinnone  则为 none
 stdout  标准 输出 流 streamreader 或 者 如果进 程 创建 时 设 置 了 stdoutnone  则 为 none
 stderr  标 准错 误流 streamreader  或者如 果 进 程 创建 时设置 了 stderrnone 则 为 none
警告 使 用 communicate 方法而 非 process
write  await  process
read 或 await  process
这可 以避 免由于流 暂停 读取 或写入并 阻塞 子进 程而导致 的死 锁
 pid 进 程标 识号 pid
 注意 对于由 note  that  for  processes  created  by  the  createsubprocessshell  函数 所 创建 的进 程 这 个 属性 将是所生 成的 shell  的 pid
 returncode 当 进程 退出 时 返回 其代 号
 none 值 表示 进程尚 未终 止
一 个负值 n 表 示 子进 程 被信 号 n  中断仅 posix
 子进 程和 线程
 标准 asyncio  事 件循环默认支 持从 不同线 程 中运行 子进 程
在 windows  上 子进程 默 认只 由 proactoreventloop 提 供 selectoreventloop 没 有 子进 程 支持
 在 unix 上 会使用 child  watchers  来让 子进程 结束 等待 详 情请 参阅 进程 监视 器
在3
8 版更 改 unix 对 于从不同 线程 中 无 限 制 地 生成子进 程 会切换为 使用 threadedchildwatcher
 使 用不 活动 的 当 前 子监 视器 生 成子 进程将 引发 runtimeerror
 请注 意其他的 事件 循环 实 现可能有 其本 身的 限 制 请查看 它 们各自 的 文 档
参 见 asyncio  中 的 并发 和 多 线程章 节
 示例
一 个使 用 process 类 来控 制子进程 并用 streamreader 类来 从 其 标准 输 出 读 取 信息的 示 例
这 个 子 进程是 由 createsubprocessexec 函 数创 建 的 import  asyncio  import  sys  async  def  getdate  code  import  datetime  printdatetime
rungetdate  printfcurrent  date  date  另请 参阅 使 用 低 层 级 api  编写的 相 同示例
 同步 原 语
 源代码 libasynciolocks
pyasyncio 同 步原 语 被 设计为 与 threading 模 块的 类似但 有 两个关键注意 事项 asyncio  原语不是 线程 安全 的因 此它 们 不应 被用 于 os 线 程 同步 而应 当使 用 threading 这 些同步 原语 的方法 不 接 受 timeout 参 数请 使用 asyncio
waitfor 函 数 来执 行带有 超时 的 操作
asyncio  具有下 列 基本 同步 原 语 lock  event  condition  semaphore  boundedsemaphore
lock
lock  loopnone  实现一 个用 于 asyncio 任 务的 互斥 锁
非 线程安 全
 asyncio 锁 可被 用 来保证 对 共享 资源 的独占 访问
 使用 lock  的推荐 方式 是 通 过 async  with 语 句 lock  asyncio
 later  async  with  lock  access  shared  state 这 等价 于 lock  asyncio
10 loop 形 参
 coroutine  acquire 获 取锁
此 方 法会 等 待 直至 锁为 unlocked  将其 设为 locked  并返 回 true 
当 有一 个以 上的 协 程在 acquire  中被阻 塞则会 等待 解锁 最终 只 有一 个协 程会 被 执行
锁 的获取 是公 平的 被执行 的 协程将是第一 个开 始等 待 锁 的协 程
 release  释 放锁
 当锁 为 locked 时 将其 设为 unlocked  并返回
 如果 锁为 unlocked  则 会 引 发 runtimeerror
 locked 如 果 锁 为 locked  则 返回 true
event
event  loopnone  事件 对 象
 该对象 不是 线程 安全的
 asyncio  事件 可被 用来通 知 多 个 asyncio  任务 已经 有事件 发生
 event  对 象会 管理 一个 内 部旗 标可 通 过 set  方 法 将 其设 为 true 并通 过 clear 方法将 其 设为 false
 wait  方 法 会 阻 塞直至该 旗 标 被 设为 true
该旗标初 始时 将被 设为 false
10 loop  形 参
示 例 async  def  waiterevent  printwaiting  for  it 
runmain  coroutine  wait 等待 直至 事件 被设置
如 果事 件已被 设 置则立即 返回 true
 否则 将阻塞 直 至 另一个 事 件调用 set
 set  设置 事件
 所 有等待事 件 被设 置 的任 务将被 立 即唤醒
 clear 清 空 取 消设置事 件
 通过 wait 进 行等 待的 任 务现在 将会阻 塞直至 set  方 法 再次 被 调 用
 isset 如 果 事件 已被 设置 则返回 true
condition
conditionlocknone  loopnone 条 件 对象
 该对象不 是线 程安全 的
 asyncio  条件 原语 可被任 务用 于等 待某个事 件 发生 然 后获 取对共 享 资源 的独占 访 问
 在本 质上 condition  对象合并 了 event  和 lock 的 功 能
多个 condition  对象有 可能共 享 一 个 lock 这 允 许 关注 于 共享 资源 的特 定状态的 不 同任 务实现对 共享 资源的 协 同 独 占 访问
 可 选 的 lock  参数必须 为 lock 对象或 none
 在后 一种 情况 下会 自 动创建 一个新 的 lock 对象
10 loop  形参
 使 用 condition 的 推 荐方式 是通过 async  with 语 句 cond  asyncio
wait 这等价 于 cond  asyncio
release  coroutine  acquire  获取 下层的 锁
 此方 法会 等待直至 下 层 的锁 为 unlocked  将其 设为 locked  并 返回 returns  true
 notifyn 1 唤 醒最 多 n 个 正 在 等 待此 条件的任 务默 认为1个
如 果没 有 任 务 正在 等待则此方 法为空操作
 锁 必须在 此 方法被 调用 前被获 取并 在 随 后 被 快速释 放
如 果 通过 一 个 unlocked 锁 调用则 会 引发 runtimeerror
 locked 如果下层 的 锁已 被获 取 则返回 true
 notifyall  唤 醒 所 有正在 等 待此 条 件的 任 务
 此 方 法的行为 类似 于 notify  但会唤 醒所 有 正在 等待 的任 务
锁必 须 在 此方 法被调用 前被获 取并 在随 后 被快 速 释放
 如果通 过 一个 unlocked  锁 调用则 会 引发 runtimeerror
 release 释 放 下层的 锁
 当在未 锁 定的锁 上 发起调 用 时会引 发 runtimeerror
 coroutine  wait  等待直 至 收到通 知
当此方 法 被调用时 如 果调用 方 任务未 获 得锁则 会 引发 runtimeerror 
这 个方法会 释 放下层 的 锁然后 保 持阻塞 直 到被 notify 或 notifyall  调 用所唤 醒
 一旦被 唤 醒 condition 会重 新 获取它 的 锁并且 此 方法将 返回 true
 coroutine  waitforpredicate  等待 直到 目 标值 变 为 true
目 标必须 为一个可调 用 对 象其 结果 将 被解 读 为一 个布 尔值
最 终 的值 将为 返回 值
semaphore
boundedsemaphore
boundedsemaphorevalue 1 loopnone  绑定 的 信 号 量 对象
 该 对 象不 是 线程 安 全 的
 boundedsemaphore 是 特殊版本的 semaphore  如 果 在 release 中 内部 计数 器 值 增加 到初始 value 以 上 它 将引 发一个 valueerror
10 loop  形参
 在3
9版 更改 使用 await  lock  或 yield  from  lock 以 及或者 with 语 句 with  await  lock  with  yield  from  lock 来 获 取锁 的 操 作已被 移 除
请改 用 async  with  lock
协程 与任 务
本 节将简 述用 于协 程与 任务 的高 层 级 api
协程 可等 待 对 象 运 行 asyncio 程序 创建任 务 休 眠并 发运行 任 务屏 蔽取 消 操作 超时 简单 等 待 在线 程 中运 行来 自 其 他 线程 的日 程安排 内省 task  对象基于 生成 器的 协 程
协 程
协 程 通 过 asyncawait  语 法进 行声 明 是编 写 asyncio 应 用 的 推荐方 式
例 如 以 下代码 段 需要 python 3
7 会 打 印 hello 等 待1秒再 打 印 world  import  asyncio  async  def  main 
runmain  hello  world 注 意简 单地 调用 一个 协程 并 不会 将其加入 执行日 程 main  coroutine  object  main  at 0 x 1053 bb 7 c 8 要 真正 运行一 个协 程 asyncio 提 供了 三种 主要 机制 asyncio
run 函 数用 来 运行 最高 层级的 入口 点 main 函 数 参见 上面 的示 例
等 待一 个 协 程
 以 下 代 码段 会在 等 待1秒 后打印 hello  然 后再次 等待2 秒 后 打印 world  import  asyncio  import  time  async  def  sayafterdelay  what  await  asyncio
runmain  预 期的 输 出 started  at 171352 hello  world  finished  at 171355 asyncio
createtask  函 数 用 来 并发运 行作 为 asyncio  任 务的多 个 协 程
 让我们修 改 以上 示例 并发运行 两个 sayafter  协 程 async  def  main  task 1 asyncio
strftimex  注 意预 期 的 输 出显 示代 码段的运 行 时 间比 之前 快了1秒 started  at 171432 hello  world  finished  at 171434
 可等 待对象
 如果 一 个 对 象可 以 在 await  语句 中使用那 么 它就 是可等待 对象
 许多 asyncio  api  都 被 设 计 为接 受可 等待 对 象
 可 等待 对象有三 种主 要 类型协 程任务 和 future
协 程 python 协程属 于可 等 待对象 因 此 可 以在其他 协程 中 被等待 import  asyncio  async  def  nested  return 42 async  def  main  nothing  happens  if  we  just  call  nested
runmain 重 要 在 本文档 中协程可 用 来 表示两 个紧 密关联 的概 念 协 程函 数定 义形式 为 async  def  的函 数协 程对 象 调 用协 程函数 所返 回的 对象
asyncio 也 支 持旧式的基 于生 成 器的 协 程
 任务 任务 被 用 来设 置 日程 以 便并发 执行 协程
 当一 个协 程通 过 asyncio
createtask 等函 数被 打 包 为 一 个任 务该 协程 将 自动 排入 日程 准 备 立 即运 行 import  asyncio  async  def  nested  return 42 async  def  main  schedule  nested  to  run  soon  concurrently  with  main
runmain  future 对象 future  是 一种 特 殊 的低 层级 可 等 待对 象表 示一个异 步 操作的 最 终 结果
 当一 个 future 对象被 等 待这意 味着 协程将 保持 等 待直到该 future  对 象在其 他地 方操 作完毕
在 asyncio  中 需要 future 对 象以 便允 许通过 asyncawait 使 用 基于回 调的 代码
通 常情 况 下 没 有必要 在应 用层级 的代 码 中创建 future 对 象
future  对象 有 时 会由 库和 某些 asyncio  api 暴 露给 用户 用作 可 等 待对象 async  def  main  await  functionthatreturnsafutureobject  this  is  also  valid  await  asyncio
gather  functionthatreturnsafutureobject  somepythoncoroutine  一 个很 好 的 返回 对 象 的低 层级 函数的 示例是 loop
 运行 asyncio  程 序
runcoro  debugfalse 执 行 coroutine  coro  并 返回 结 果
 此函 数会 运行传 入 的 协程 负 责 管 理 asyncio 事 件 循环 终 结 异步 生成 器 并关 闭线 程 池
 当有其他 asyncio  事 件循 环在同 一线程中 运行 时 此函 数 不能 被调 用
如果 debug 为 true  事件循环将以 调试 模式 运行
 此函 数总 是会 创 建一 个新 的事 件循 环 并 在 结 束时 关 闭之
 它 应当 被用 作 asyncio 程序 的主入口点理 想 情况 下 应当 只被 调 用一 次
示 例 async  def  main  await  asyncio
runmain 3
7新版 功能
 在3
9 版 更 改更 新为 使 用 loop
 注解 asyncio
run  的源 代码可 以在 libasynciorunners
py  中 找 到
 创建 任务
 休眠
sleepdelay  resultnone  loopnone  阻塞 delay 指 定的 秒数
 如果 指定了 result  则当 协程 完 成时 将其 返回 给调用 者
 sleep 总是 会挂 起当 前 任 务以 允许其他任 务运行
10 loop 形 参
 以 下 协程示 例 运行5 秒每 秒显示 一次 当 前日 期 import  asyncio  import  datetime  async  def  displaydate  loop  asyncio
并发运 行任务
gatheraws  loopnone  returnexceptionsfalse  并发运 行 aws 序 列 中 的 可等 待对象
如 果 aws 中 的 某 个 可 等待 对象为 协程它 将 自动 作为 一 个任 务加入 日程
如 果 所有 可等待对象 都成功完成结 果将 是一个由 所 有返 回 值聚合而 成 的列 表
 结 果值 的 顺 序与 aws  中 可等 待对 象的 顺序 一致
如果 returnexceptions 为 false  默 认所 引发 的 首 个 异 常会立即 传播 给等待 gather  的任 务
aws 序 列中的 其他可等 待 对象 不 会 被取消 并 将 继 续 运 行
 如果 returnexceptions  为 true 异 常会和成 功 的结 果 一 样 处理 并 聚合 至结 果列 表
 如 果 gather 被 取消 所 有 被 提交 尚 未 完成的 可 等 待 对象 也会被取 消
如果 aws 序列 中 的任 一 task 或 future  对象 被取 消它 将被 当作 引发 了 cancellederror 一样 处 理 在此 情 况下 gather 调 用不 会被 取消
 这 是 为了 防止 一个 已提 交 的 taskfuture 被 取消 导致其 他 tasksfuture 也 被取消
10 loop 形 参
 示例 import  asyncio  async  def  factorialname  number  f 1 for  i  in  range 2 number 1 printftask  name  compute  factoriali
 task  c  factorial 424 注解如 果 returnexceptions 为 false  则在 gather 被 标 记 为已 完成 后 取消 它 将 不会取消任 何 已 提交的 可等 待对 象
 例 如在 将一个异常 传 播 给 调用 者 之后 gather 可被 标记为已 完 成因 此在 从 gather 捕 获 一个由 可 等 待对象 所引 发的 异常 之 后 调用 gather
cancel  将不 会 取消 任何其 他可 等待 对象
 在3
7 版更 改如 果 gather 本 身 被 取 消 则无 论 returnexceptions  取值为 何消 息都 会被 传播
屏 蔽 取消 操作
 超时
waitforaw  timeout  loopnone  等 待 aw 可 等待 对象 完 成 指 定 timeout 秒 数 后 超时
 如果 aw  是一 个 协 程它将 自 动作 为任 务加 入 日 程
 timeout  可以为 none  也 可以 为 float  或 int 型 数值 表 示的 等 待 秒 数
如 果 timeout 为 none  则等待 直 到完 成
 如果 发生 超时任 务 将取消 并引发 asyncio
要 避免任务 取消 可 以 加上 shield
 此函 数 将等 待 直到 future 确 实 被 取消 所以 总等 待 时间可能 超 过 timeout
 如果 在取 消期间 发生 了 异常异常 将会被传 播
如果等 待 被取消 则 aw 指定 的 对象也 会 被取 消
10 loop 形 参
 示例 async  def  eternity  sleep  for  one  hour  await  asyncio
runmain  expected  output  timeout  在3
7版更 改当 aw 因 超时被取 消 waitfor 会 等 待 aw 被 取消
之前 版 本则 将立即 引发 asyncio
timeouterror
简单 等待
返回 两 个 taskfuture 集合 done  pending
用 法 done  pending  await  asyncio
waitaws 如 指定 timeout  float 或 int  类型 则它 将 被用 于控制返回 之 前等 待的 最长秒数
请 注意此函 数不 会引 发 asyncio
当超 时发 生 时 未完 成的 future 或 task  将在 指定 秒数 后被 返回
 returnwhen 指定 此函数 应在何 时返回
 它 必须为以 下 常数之一 常 数描 述 firstcompleted  函数将 在 任意 可等 待对象 结 束或取 消时 返 回
 firstexception  函 数将 在 任意 可等待对象 因引发异 常而 结束 时返回
 当没 有 引 发任 何异 常时它 就相 当于 allcompleted
 allcompleted  函数 将在所有 可等 待 对 象结束 或取消 时 返回
与 waitfor 不 同 wait 在超时 发 生 时不会 取消 可 等 待对 象
3
8版 后已移 除如果 aws  中 的 某 个 可等 待对 象 为 协 程 它 将自 动 作为 任 务 加入 日程
 直接 向 wait 传 入 协程 对 象 已弃 用因 为 这 会 导致令 人迷 惑的 行为
10 loop  形参
 注 解 wait  会 自动 将 协程作 为 任务 加入 日程 以后 将以 done  pending  集 合形式 返回 显 式 创 建的任 务对象
 因此 以 下 代码 并不 会 有预 期的行 为 async  def  foo  return 42 coro  foo  done  pending  await  asyncio
waitcoro  if  coro  in  done  this  branch  will  never  be  run  以上 代码 段的修 正 方法如 下 async  def  foo  return 42 task  asyncio
11 直 接向 wait  传 入 协程 对象的 方 式 已弃 用
如 果在 所有 future  对象 完 成前 发生 超 时则将 引发 asyncio
timeouterror 
10 loop 形 参
示 例 for  coro  in  ascompletedaws  earliestresult  await  coro 
 在 线 程中 运行
tothreadfunc  args  kwargs 在 不同 的线程中 异步 地运 行函 数 func
向此函 数 提供 的任 何 args  和 kwargs 会 被 直 接 传给 func
 并且当 前 contextvars
context 会 被传播允许 在 不同 的 线 程 中访 问 来 自事件循 环 的上 下 文 变量
 返回一 个可被 等待 以 获取 func 的 最 终 结果的 协 程
这个 协 程函 数主 要是 用 于执行 在 其他 情况下 会 阻 塞 事 件 循 环的 io  密 集型 函数 方法
例 如 def  blockingio  printfstart  blockingio  at  time
runmain  expected  output  started  main  at 195053 start  blockingio  at 195053 blockingio  complete  at 195054 finished  main  at 195054 在任 何协程中 直接 调用 blockingio 将 会在调用 期 间阻 塞 事件循 环导 致 额外 的1秒运行 时 间
 而通过改 用 asyncio
tothread  我们 可 以在 不 同的 线程 中 运 行 它从 而 不会 阻塞事件 循环
 注解 由 于 gil  的 存 在 asyncio
tothread 通常 只能 被用 来将 io 密 集型 函 数 变 为 非阻 塞的
但 是对 于会 释 放 gil  的扩 展模 块 或无 此限制的 替代 性 python  实 现来说 asyncio
tothread 也可 被用 于 cpu 密集型函 数
3
9新 版功 能
来 自 其 他线 程 的日 程 安 排
runcoroutinethreadsafecoro  loop 向 指定 事件循 环提交 一个协程
线 程 安全
 返回一 个 concurrent
future  以等 待 来自其 他 os 线 程的结 果
此 函 数 应 该 从另 一个 os  线程 中 调用而非事 件 循环 运行 所 在线 程
示 例 create  a  coroutine  coro  asyncio
resulttimeout 3 如果 在协程内 产 生了异 常将 会通知返回 的 future 对 象
它 也可被 用来取消 事件 循环 中 的任 务 try  result  future
cancel  except  exception  as  exc  printfthe  coroutine  raised  an  exception  excr  else  printfthe  coroutine  returned  resultr 查 看并发 和多 线程 章 节 的 文 档
不 同 与其他 asyncio  函数此 函 数 要 求 显 式地 传 入 loop 参 数
3
1新 版功 能
内省
currenttaskloopnone  返回 当前 运行的 task 实 例如果 没有 正在 运行 的任 务则返 回 none
如 果 loop 为 none  则 会 使用 getrunningloop  获取当 前事件循 环
3
7 新版 功能
alltasksloopnone 返 回事 件 循 环 所 运 行的 未完成 的 task 对象的集 合
如果 loop 为 none 则 会使 用 getrunningloop  获 取当 前事 件循 环
3
7新 版功能
task  对象
taskcoro  loopnone  namenone  一个与 future  类 似 的 对象 可运 行 python 协 程
 非线 程 安全
 task  对象 被用 来在事 件循 环中 运行协程
 如 果一 个 协程 在等 待一 个 future  对 象 task  对象 会 挂起 该 协 程的 执 行 并 等待该 future  对 象完成
 当 该 future  对 象 完成 被 打 包 的协 程将 恢 复执 行
 事 件 循 环 使用协 同日程 调度一 个 事 件 循 环每 次 运 行 一 个 task  对 象
而 一 个 task  对象 会 等待一 个 future 对象完 成该 事 件 循环会 运行 其他 task 、回 调 或执行 io 操 作
使 用高 层级 的 asyncio
createtask 函数来 创 建 task 对象 也 可用低 层 级的 loop
createtask  或 ensurefuture  函数
 不 建 议 手动 实例 化 task 对 象
要取消 一 个正在运 行的 task  对 象 可 使用 cancel  方 法
 调用此 方 法将 使 该 task 对象抛 出一个 cancellederror 异常 给打 包的 协程
如 果 取消期 间一 个 协程 正在等待 一个 future  对 象该 future  对 象 也将 被 取消
 cancelled  可被用 来检 测 task 对 象 是 否被取 消
 如果 打 包 的协 程 没有 抑 制 cancellederror 异 常 并且 确实被 取消该 方 法 将 返回 true
task 从 future  继承 了其除 future
setresult  和 future
setexception 以 外 的 所 有 api
 task  对象 支持 contextvars  模 块
 当 一 个 task 对 象被 创 建 它将 复制 当前 上下 文然 后 在复 制的上 下 文中 运 行 其 协 程
在3
7 版更 改加 入 对 contextvars 模 块的 支持
在3
8 版 更改 添加 了 name 形 参
10 loop 形 参
 cancelmsgnone 请 求 取 消 task  对 象
这将 安 排 在 下一 轮事件 循环中 抛出 一 个 cancellederror  异 常给 被 封 包 的 协 程
 协 程在 之后 有 机会 进行清 理 甚至使 用 try 
 except  cancellederror 
 finally 代 码 块 抑 制异 常来 拒 绝 请求
 不同 于 future
canceltask
cancel  不 保 证 task  会 被取消 虽 然 抑制完全取 消 并 不常见 也 很 不 鼓励 这样做
 在3
9版 更改增加 了 msg  形 参
 以 下示例 演示 了 协 程是如 何 侦 听 取消 请求 的 async  def  cancelme  printcancelme  before  sleep  try  wait  for 1 hour  await  asyncio
runmain  expected  output  cancelme  before  sleep  cancelme  cancel  sleep  cancelme  after  sleep  main  cancelme  is  cancelled  now  cancelled 如 果 task  对 象被 取消 则 返回 true
 当使 用 cancel 发 出 取 消请 求 时 task 会被 取消 其 封 包 的协程 将传 播 被抛入 的 cancellederror 异 常
 done 如 果 task  对象已完 成 则 返 回 true
 当 task 所 封包 的 协程 返 回一个 值、引 发 一个 异常 或 task 本 身被 取消 时 则 会被认 为 已 完 成
 result  返 回 task  的结 果
 如 果 task 对 象已完 成 其封 包的 协 程的结 果会 被 返回 或者 当协 程引 发异常时 该 异常 会被 重新引 发
 如 果 task  对象被 取消此方 法会 引发一 个 cancellederror  异 常
 如 果 task 对 象 的 结果 还不 可用此 方法会 引发一 个 invalidstateerror  异常
 exception  返回 task 对 象的异常
 如果所封 包 的协 程引发了 一 个异常 该异常 将 被返 回
如果 所封 包 的协 程正常 返回 则 该方 法将 返回 none
 如 果 task  对 象 被取 消此 方法会 引发一个 cancellederror  异常
 如果 task 对 象尚 未 完成 此方 法将 引发一 个 invalidstateerror 异 常
 adddonecallbackcallback  contextnone 添加 一 个回 调 将 在 task 对 象完 成 时 被 运行
 此方 法应该 仅 在 低层级 的 基 于回 调的代 码中使 用
要 了 解更 多 细节 请查 看 future
adddonecallback 的 文 档
 removedonecallbackcallback 从 回调列 表 中 移 除 callback  指定的 回调
 此 方法 应该 仅在 低 层 级的 基于 回调 的 代 码中 使 用
 要了 解更多 细节 请查 看 future
removedonecallback 的 文档
 getstack  limitnone 返回 此 task 对 象的 栈框架 列 表
如 果 所 封包的 协程 未完 成这 将 返 回 其挂起 所在 的栈
如果 协 程已 成 功 完成或 被取 消这 将返回一 个空 列 表
 如果 协程 被一个 异常 终止 这 将 返 回回溯 框架 列 表
框架 总是从按 从旧 到新排 序
 每个 被 挂起的协 程只 返 回 一 个 栈框架
 可选的 limit  参数指定 返回 框 架 的 数量 上限默 认返回所 有框 架
返 回列 表 的顺 序要 看 是 返回 一 个 栈还 是一 个 回溯 栈 返 回最 新的框 架回 溯返回 最旧 的 框 架
这 与 traceback 模 块的 行为保 持一 致
 printstack  limitnone  filenone 打 印 此 task 对 象的栈 或回 溯
此 方法产生 的输 出 类似 于 traceback 模 块 通 过 getstack  所 获 取 的 框 架
 limit  参 数会直 接 传 递给 getstack
 file  参数是输 出所写入 的 io  流默 认情 况下输 出 会 写 入 sys
 getcoro 返回 由 task  包装 的 协程 对象
3
8新 版 功 能
 getname  返 回 task 的 名称
 如 果没 有 一个 task 名 称被显 式地赋值 默认 的 asyncio  task 实现 会在实例 化期间生 成 一个 默认名称
3
8 新版 功 能
 setnamevalue 设置 task  的 名称
 value  参 数 可以 为任 意 对 象 它 随后 会被 转换 为字 符 串
在 默认的 task  实现 中 名称将 在任 务 对 象 的 repr  输出中可 见
3
8新版 功 能
基 于生 成器的 协程
 注 解对 基 于 生 成 器 的 协程 的 支持 已 弃 用 并 计 划 在 python 3
10中 移 除
 基 于 生 成 器 的 协 程 是 asyncawait 语 法的前身
 它们是使 用 yield  from 语 句 创建 的 python  生 成器 可 以 等 待 future 和其 他 协程
基 于 生 成 器 的协 程 应 该 使用 asyncio
coroutine  装饰 虽然 这并非 强 制
coroutine  用 来标记基 于生 成器 的 协程 的装 饰 器
 此装 饰 器使得 旧式的基 于生 成 器 的协程 能与 asyncawait  代码相 兼 容 asyncio
sleep 1 async  def  main  await  oldstylecoroutine 此装饰 器不 应该 被 用 于 async  def 协程
10请 改 用 async  def
iscoroutineobj  如 果 obj  是一 个 协 程 对象则返回 true
 此方 法不同 于 inspect
iscoroutine 因 为 它 对基 于生 成器 的协 程 返回 true
iscoroutinefunctionfunc  如 果 func  是 一 个 协程函数 则返回 true
此 方法 不同于 inspect
iscoroutinefunction  因为它 对 以 coroutine 装 饰 的 基于 生 成器 的协 程函 数返 回 true
asyncio  异 步 io
runmainasyncio  是 用 来 编写 并 发代码的 库使 用 asyncawait 语 法
asyncio 被 用作 多个 提供 高性 能 python 异 步 框架 的 基础 包 括 网络 和网 站服 务数 据库 连接 库分 布式任 务 队列等 等
asyncio 往 往 是 构 建 io  密 集 型和高 层级 结 构 化网 络代 码的 最佳选 择
asyncio 提供 一 组 高 层级 api 用 于并 发地运 行 python  协程 并对其执行 过程实现 完全控 制执行 网络 io  和 ipc 控 制子 进程 通 过 队列 实现 分布 式任务同 步并 发 代码 此 外还有 一些 低层级 api  以支 持库和 框架的 开发 者实现 创 建 和管 理 事 件循 环以提 供异 步 api 用 于网络化 运行 子 进 程处理 os 信 号等 等使 用 transports 实现 高 效 率 协 议 通过 asyncawait 语 法桥 接 基于回 调的 库 和 代 码
 参考 引 用高层 级 api 协 程与 任务流 同步 原 语子进 程队列 集 异常 低层 级 api 事件 循 环 futures  传输 和协 议策略平 台支持 指 南与教程高层 级 api 索引 低层 级 api  索 引用 asyncio 开发 注 解 asyncio 的 源代 码可以 在 libasyncio  中 找到
asyncore  异步 socket  处理器
源 码 libasyncore
py 3
6版后 已 移 除 请 使 用 asyncio 替代
注 解 该模块仅 为提 供 向后兼 容
我们 推荐 在新 代码中 使用 asyncio 
 该模 块提 供用 于编 写异 步套 接字服务 客 户 端与服 务端 的基 础构 件
只 有两种 方法让 单个 处理 器上的 程序同 一时 间 完 成 不止 一件事
 多线 程编 程 是 最简单 和 最 流行 的方 法但是 还有另 一种 非 常不同 的 技术 它可 以让 你拥有多线程 的几 乎所 有 优 点 而无 需 实 际 使 用多 线 程
 它 仅仅 在你 的 程 序 主 要 受 io 限 制 时 有 用 那 么
如果 你 的 程 序受 处理 器 限 制 那 么先 发 制人 的 预 定 线 程 可 能 就 是你真 正 需 要 的
 但是网络 服务 器很少受处 理 器 限制
 如果 你 的 操作系 统在 其 io 库中支 持 select 系 统调用几 乎所 有 操作 系 统 那 么 你可 以使用它 来同时处 理 多 个 通 信通 道 在 io 正 在 后台 时 进 行 其 他 工作
 虽 然 这种 策略看 起来 很奇 怪和 复 杂特 别 是 起 初它在 很 多 方面 比多线程 编程 更容 易理 解和控 制
 asyncore 模 块为您 解 决 了许多 难题 使 得构 建 复杂 的 高 性 能 网 络服务 器 和 客户 端 的任 务 变 得 轻而 易举
 对于会 话应 用程 序 和 协 议伴侣 asynchat  模 块是非常 宝贵 的
 这 两 个模 块 背 后 的基 本 思 想是 创 建 一个 或多 个 网络通 道 类的 实例 asyncore
dispatcher  和 asynchat
asyncchat 
创建 通 道会将 它们 添 加 到全 局映射 中如 果你 不 为它提 供自己 的映 射则由 loop  函数 使 用
一 旦 创建 了 初 始 通道 调用 loop  函 数将 激活通 道 服 务 该 服务 将一 直持 续 到 最后 一个 通 道包 括在异 步 服 务 期 间已 添加 到映 射 中 的 任 何通 道 关闭
looptimeout  usepoll  map  count  进入一 个 轮 询 循 环 其 在循 环计 数 超 出 或 所 有打 开的通 道关 闭后终 止
 所 有参 数 都 是 可 选 的
 count  形 参 默 认 为 none  导 致循 环 仅 在 所 有 通 道 关 闭 时终 止
 timeout 形 参为适 当 的 select  或 poll 调 用设置 超时参 数以 秒为 单 位默 认 值 为30秒
 usepoll  形 参 如 果 为 true  则表 示 poll 应 优 先 使用 select  默认 为 false
 the  implied  higherlevel  events  are  event  描 述 handleconnect  implied  by  the  first  read  or  write  event  handleclose  implied  by  a  read  event  with  no  data  available  handleaccepted  implied  by  a  read  event  on  a  listening  socket  during  asynchronous  processing  each  mapped  channels  readable  and  writable  methods  are  used  to  determine  whether  the  channels  socket  should  be  added  to  the  list  of  channels  selected  or  polled  for  read  and  write  events
3
2 版后已 移 除
3
2 新 版 功能
 在3
3 版更 改 family  and  type  arguments  can  be  omitted
asyncore  example  basic  http  client
asyncore  example  basic  echo  server
atexit 退 出处理 器
atexit 模块定 义 了清理 函数 的注 册 和反 注册函数
被 注 册 的函 数会在 解释器正 常终 止 时 执 行
 atexit  会 按 照注 册 顺 序 的 逆序 执行 如 果 你 注 册了 ab  和 c 那么在 解 释 器 终止时会 依序 执 行 c  b  a
 注 意 通 过该 模块 注册 的 函 数 在 程 序 被 未 被 python  捕获的 信号杀 死 时 并 不 会执 行在检 测到 python  内 部致 命 错 误 以及 调用 了 os
exit  时 也不 会执 行
在3
7 版 更 改 当 配合 capi  子解 释 器使 用 时已 注册函 数 是 它 们所 注 册 解 释器中 的局 部对 象
registerfunc  args  kwargs 将 func  注册 为终 止时执 行的 函 数
任 何 传 给 func  的 可 选的 参数 都应 当作 为 参 数传 给 register
 可以 多次 注 册 同样 的 函数 及参 数
 在 正常 的 程 序 终止 时 举例 来 说当 调用 了 sys
exit  或是 主 模块 的执 行 完成 时 所 有 注册 过的 函数 都 会 以后 进先出 的顺 序执行
 这样 做是 假 定更 底层 的模块通 常会比高 层模 块 更 早 引 入 因 此需 要 更 晚清 理
如 果在 exit 处 理 程 序 执 行 期 间 引 发 了 异 常将 会打印 回溯信 息 除 非 引发的是 systemexit  并且 异 常 信 息 会被 保 存
在所有 exit  处理 程序 获 得运行 机 会之 后 所 引发的最 后 一 个异常 会被重新引 发
这 个函数 返回 func  对 象可以 把它 当作装饰器 使用
unregisterfunc 从解 释器 关闭 前要 运行 的函 数列 表 中 移 除 func
在调 用 unregister  之后当 解 释 器 关 闭 时 会确 保 func  不会 被 调 用 即 使它 被多 次注 册
如 果 func 之 前 没 有 被 注册 unregister 会静 默地 不做任 何操 作
参 见模块 readline  使用 atexit  读写 readline 历 史文 件 的有 用的 例子
atexit  示例
 以 下简单 例子 演 示了 一个模块 在被 导入 时如 何 从文 件初 始 化一个 计数 器并 在程 序终 结 时 自动 保 存 计数 器 的更新 值此 操作 不 依赖 于应 用在 终 结 时 对此 模块进 行显 式 调用
 try  with  opencounterfile  as  infile  count  intinfile
registersavecounter  位 置 和关 键字 参数 也 可 传入 register  以便 传递 给被 调用的 已注 册函 数 def  goodbyename  adjective  printgoodbye  s  it  was  s  to  meet  you
registergoodbye  adjectivenice  namedonny 作为 decorator  使用 import  atexit  atexit
 只有 在函 数不 需要 任何 参 数调 用 时 才 能 工 作
audioop 处 理 原 始音 频数据
 审计 事件 表
下 表包含 了在 整个 cpython  运 行时 和 标准 库 中 由 sys
audit  或 pysysaudit  调用 引 发的 所 有 事 件
 这 些 调 用是 在3
0或更 高版 本中添 加 的
请参阅 sys
addaudithook  和 pysysaddaudithook 了解有关 处理 这些 事件 的 详 细信息
cpython  implementation  detail  此表 是 根据 cpython 文 档 生成的可 能无 法表 示 其他 实 现所 引 发 的 事件
 请参 阅你 的 运 行 时专 属的 文 档了 解实 际 引发的事件
setvalue  key  subkey  type  value 12 下列 事 件 只 在 内部被 引发 而不 会回应 任 何 cpython 公 共 api 审 计事件 实参 winapi
base 64 base 16 base 32 base 64 base 85 数据 编码
bdb  debugger  framework
 定 义 了 以 下 异常 exception  bdb
3
2 新 版功 能
3
1新 版 功能 skip  参数
 for  more  information  on  code  and  frame  objects  refer  to  标准类 型层 级结构
3
2 新版 功 能
 二 进制 数据 服务
 本章 介 绍 的 模 块 提 供了 一 些操 作二进 制数 据的 基本 服务操 作
有 关 二进 制数 据的 其 他操 作特 别是 与文 件格 式和网 络协 议有 关 的 操作 将在 相关 章 节中 介绍
 下 面描述 的一 些库 文 本 处 理 服务也 可以 使 用 ascii 兼 容 的 二 进 制 格 式例 如 re  或所 有二 进制 数据 例如 difflib 
 另外 请参阅 python  的内 置二 进 制 数 据 类型 的 文档 二进 制 序 列类 型 bytes  bytearray  memoryview 
 struct 将 字 节串 解读 为 打 包的二 进制 数据 函 数和异常格 式 字符 串字 节顺 序大 小和对齐 方式格式 字符 示例类 codecs  编解 码器 注册 和 相 关 基类 编解 码器 基类 错误 处理方案无 状态 的 编 码和解 码增量 式 的编 码和 解码 incrementalencoder  对象 incrementaldecoder  对象 流式 的 编 码 和 解 码 streamwriter 对 象 streamreader 对象 streamreaderwriter  对象 streamrecoder 对象 编码格 式与 unicode 标准 编码 python 专 属的 编码 格式 文 字编码 二进制转 换文 字转换 encodings
idna 应用 程 序中的国际 化域 名 encodings
mbcs  windows  ansi 代 码页 encodings
utf 8 sig 带 bom  签名的 utf 8编 解 码器
binascii  二进 制和 ascii  码 互 转
binhex 对 binhex 4 文件 进行编码和 解 码
源代码 libbinhex
py 3
9版 后已 移除
此模块 以 binhe 4 格式对 文 件进行编 码和解 码该格 式允许 macintosh 文 件以 ascii  格式表示
仅 处理 数据 分支
binhex  模块 定义 了 以下 功能 binhex
binhexinput  output  将带 有文 件 名输入 的二 进制文 件转换为 binhex 文 件 输 出
输出 参 数 可以是文件 名或类 文件对 象 write 和 close  方法的 任何 对象
hexbininput  output  解码 binhex 文 件输 入
输 入 可 以 是 支 持 read 和 close 方 法 的 文 件 名或 类文件对象
生 成 的 文件将 写 入名 为 output 的 文件除 非参 数为 none  在 这 种 情 况 下从 binhex 文 件 中 读 取 输出 文件名
还定义 了 以 下异常 exception  binhex
error  当 无法使 用 binhex  格式编 码某些 内容 时 例如文 件名 太长而 无法放入 文件 名字 段 中或者 输入 未正确编 码 的 binhex 数 据时 会引发异 常
参 见模 块 binascii 支 持模 块 包 含 ascii  到二 进制 和二进 制到 ascii  转换
 注释
还有 一个 替代 的、 功能 更强大的 编码器和解 码器 接 口详 细信息 请参 见 源代 码
如 果您 在 非 macintosh 平 台 上编 码或 解 码 文 本文 件它们仍 将使 用旧 的 macintosh  换行 符约 定回 车 符 作为行 尾
bisect  数 组二 分查 找 算法
搜索 有 序 列 表
上 面的 bisect  函 数对 于找到 插 入 点 是有 用 的但在一 般的 搜索 任务 中 可 能会有 点尴 尬
下 面5 个 函 数 展 示了如 何将 其 转变 成有序 列表 中 的 标 准查 找 函 数 def  indexa  x  locate  the  leftmost  value  exactly  equal  to  x  i  bisectlefta  x  if  i  lena  and  ai  x  return  i  raise  valueerror  def  findlta  x  find  rightmost  value  less  than  x  i  bisectlefta  x  if  i  return  ai 1 raise  valueerror  def  findlea  x  find  rightmost  value  less  than  or  equal  to  x  i  bisectrighta  x  if  i  return  ai 1 raise  valueerror  def  findgta  x  find  leftmost  value  greater  than  x  i  bisectrighta  x  if  i  lena  return  ai  raise  valueerror  def  findgea  x  find  leftmost  item  greater  than  or  equal  to  x  i  bisectlefta  x  if  i  lena  return  ai  raise  valueerror
 其 他示 例
builtins 内 建 对象
 该模块提 供对 python  的 所有 内置 标识 符的 直接 访 问 例如 builtins
open  是内置 函数 的全 名 open 
 请 参阅 内 置函数和 内置 常量的文 档
大多数 应 用程序通常 不会显 式 访 问此模 块但 在提供与 内置值同 名 的对象 的模 块中 可能很 有用但其 中 还 需 要内 置 该名 称
 例如 在 一个 想 要实 现 open  函数 的模块中 它包装 了内置 的 open 这 个 模 块可 以直 接使 用 import  builtins  def  openpath  f  builtins
 作为一 个实 现 细节大 多数 模块 都将名 称 builtins 作为其 全 局 变 量的 一 部分 提 供
 builtins 的 值 通常 是 这个 模 块或者这 个 模块的 值 dict  属性
 由 于这是一 个实 现细节 因 此 python  的 替 代实 现可 能不 会 使 用它
bz 2 对 bzip 2 压缩算 法的支 持
 源 代 码 libbz 2
py  此模 块提 供 了使 用 bzip 2 压缩 算 法压缩 和 解 压 数据的 一 套完 整 的接 口
bz 2 模 块 包含用 于读写 压 缩文件的 open  函数 和 bz 2 file 类
 用于增量压 缩和解 压的 bz 2 compressor  和 bz 2 decompressor  类
 用 于 一 次性压 缩和 解 压 的 compress 和 decompress  函 数
此 模块中 的所有类 都能安 全 地从 多个 线程访问
文 件 压缩 和 解压
 增量 压 缩和解 压
一 次 性 压 缩或 解压 缩
compressdata  compresslevel 9压缩 data 此参 数 为一个 字 节类对 象
如果给定 compresslevel  它 必须为1至9 之间 的 整 数
默认 值 为9
对于增 量压 缩 请 改用 bz 2 compressor
decompressdata  解压缩 data  此参 数 为一 个字节类对象
 如 果 data 是多 个压 缩数据 流的 拼接 则 解压 缩所 有数 据流
对于 增 量解 压缩 请改 用 bz 2 decompressor
 在3
3 版 更改 支持了 多 数据 流 的输 入
用法 示例
 以下 是 bz 2模块 典型 用法 的一 些 示例
使用 compress  和 decompress  来显 示 往复 式的 压缩 import  bz 2 data  b
decompressc  data  d  check  equality  to  original  object  after  roundtriptrue  使用 bz 2 compressor  进 行 增量 压 缩 import  bz 2 def  gendatachunks 10 chunksize 1000
flush  上 面 的示 例 使 用了 十 分 非 随机的 数据 流即 bz 块数据 流
随 机 数据 的 压 缩 率 通 常很 差 而有 序、重 复 的数 据 通常会产生 很高 的 压 缩 率
 用 二 进 制 模 式 写 入 和 读 取 bzip 2压 缩 文 件 import  bz 2 data  b
calendar  日 历 相 关函 数
cgi  common  gateway  interface  support
 源代码 libcgi
概述
 使用 cgi  模 块。
 通 过敲 下 import  cgi  来开始
当你 在写 一 个新 脚 本 时 考虑 加上这 些语句 import  cgitb  cgitb
在3
4 版 更 改 the  file  attribute  is  automatically  closed  upon  thegarbage  collection  of  the  creating  fieldstorage  instance
 在3
5 版更 改 added  support  for  the  context  management  protocol  tothe  fieldstorage  class
higher  level  interface
 函数
 在3
7 版 更改 added  the  encoding  and  errors  parameters
 for  nonfile  fields  the  value  is  now  a  list  of  strings  not  bytes
caring  about  security
installing  your  cgi  script  on  a  unix  system
testing  your  cgi  script
debugging  cgi  scripts
common  problems  and  solutions
脚 注1 note  that  some  recent  versions  of  the  html  specification  do  state  what  order  the  field  values  should  be  supplied  in  but  knowing  whether  a  request  was  received  from  a  conforming  browser  or  even  from  a  browser  at  all  is  tedious  and  errorprone
cgitb 用于 cgi 脚 本 的 回 溯 管 理 器
源 代 码 libcgitb
pycgitb  模块提 供了用于 python  脚 本 的 特 殊 异常 处 理 程 序
这 个 名称有一点 误导 性
 它 最 初是 设 计用来显示 html  格式 的 cgi  脚 本详细回溯 信息
 但 后 来 被 一般 化为 也可显 示纯 文 本 格式的 回 溯 信息
激 活 这 个模块之 后如 果发 生了未被 捕 获的异 常 将会 显 示详细 的 已格 式 化 的报告
 报告显示 内 容 包 括 每 个层 级 的源 代 码 摘录还 有当前正 在 运 行 的 函 数的 参数 和 局部 变 量 值以帮 助 你 调 试 问 题
 你 也可以 选择 将 此信 息 保存 至 文 件 而不是 将 其 发 送 至浏览器
要 启用 此 特 性 只 需 简 单地 将此 代 码添 加 到 你的 cgi 脚 本 的 最 顶 端 import  cgitb  cgitb
enableenable  函 数 的选项 可 以 控 制是将 报告 显 示 在 浏览器 中 还 是 将 报告 记 录 到文 件供以后进 行分 析
enabledisplay 1 logdirnone  context 5 formathtml 此 函 数 可通 过设 置 sys
excepthook 的 值以 使 cgitb  模 块接 管解 释器 默认 的 异常 处 理 机制
 可 选 参 数 display 默 认 为1并 可被设 为0来停 止将 回溯 发送至浏 览 器
如果 给出 了 参数 logdir  则回 溯会 被写 入文 件
 logdir  的 值 应当 是一 个 用 于存放 所写 入 文件 的目录
可选 参数 context  是 要在 回 溯 中 的当 前 源 代码 行前 后 显示的上下 文行 数 默认 为5
 如果 可 选参 数 format  为 html  输出将 为 html  格 式
 任 何其 它 值 都 会强 制启 用纯 文本输 出
 默 认取值为 html
textinfo  context 5 此 函 数 用 于处 理 info 一 个包 含 sys
excinfo 返 回 结果 的3元 组 所 描 述 的异常 将其 回 溯格 式化 为文 本并 将结 果作 为 字符 串返回
 可 选 参数 context  是 要在 回溯中 的 当前 源码 行前 后 显 示的 上下文 行数默 认 为5
htmlinfo  context 5 此函 数用 于 处理 info  一 个 包含 sys
excinfo  返 回 结 果的3 元 组所 描述 的异常 将 其 回溯格 式 化为 html  并将 结 果作 为字符串 返回
 可选 参数 context  是 要在回 溯中 的当前源 码行前 后 显示 的上 下文 行数 默 认为5
handlerinfonone 此 函数 使用 默认 设置 处理 异 常即 在浏 览 器中 显示 报 告 但 不记 录 到文 件
当 你 捕获 了一个 异常 并希 望使 用 cgitb 来 报告 它 时可 以 使 用 此 函 数
可 选的 info  参 数应为 一 个包 含异 常类型 异常值和 回溯对 象 的3 元组 与 sys
excinfo 所返回 的元组 完全一致
 如果未提 供 info 参数则 会从 sys
excinfo  获 取当前 异 常
chunk  读取 iff 分 块数 据
源 代 码 libchunk
py  本 模块提 供了 一个 读 取使 用 ea  iff 85分块的 数据 的 接 口 chunks
1这 种 格 式使 用的 场 合 有 audio  interchange  file  format  aiffaiffc 和 realmedia  file  format  rmff  等
 与它们 密切相 关的 wave  音 频 文件也可 使用此模 块来读取
 一个分块 具有 以下 结构 偏 移长 度内容04区块 id 44大端字 节顺 序 的块 大小 不包 括头8 n  数据 字 节其 中 n 是前 一字 段中 给 出的大小8 n 0 或1 如果 n  为奇 数 且使用 块对 齐 则需 要 填充 字节 id 是一 个4字节的字 符串用于标 识 块的 类型
大 小字 段32位 的值使用大 端字 节序编码给 出分块 数据 的 大小不 包括8字节 的 标头
 使用 由一 个或更多 分块组成 的 iff 类型文 件
此处定 义的 chunk  类的 建议使 用 方式是在 每个 分块 开始 时实 例化 一个 实例 并从实例读 取直到其末 尾在那 之 后 可 以 再 实例 化新 的实例
到 达文 件末 尾时 创建 新实 例 将会失败 并引 发 eoferror 异 常
chunkfile  aligntrue  bigendiantrue  inclheaderfalse 代 表一 个分 块的类
 file 参数 预期为一个 文件 类对象
特 别地 也允 许该 类的 实例
唯 一 必需的 方法 是 read
如 果存 在 seek 和 tell  方 法并且 没 有引发 异 常它们 也 会 被 使用
如 果 存在这 些方 法并 且 引发了 异 常则它 们不 应改 变目 标对象
 如果可选参 数 align 为真 值则分块 应当 以2 字节 边界 对 齐
如果 align 为假值 则 不使用对 齐
此 参数 默 认为 真值
 如果 可 选 参数 bigendian  为假 值分 块大小 应 当为 小端 序
这对于 wave  音 频文件 是必 须的
 此参 数默认为真值
 如 果 可选 参 数 inclheader 为真值 则 分块 标 头中 给 出的 大小将 包括 标头的大 小
 此参 数 默认为 假 值
 chunk 对 象 支持 下 列 方 法 getname 返 回 分块 的名 称 id
这是 分块 的头4个 字节
 getsize  返回 分块 的大 小
 close  关 闭并 跳转到 分 块的末 尾
 这 不 会 关闭下 层 的 文件
 在 close 方 法已 被调用 后 其余方法 将 会 引发 oserror
 在 python 3
3 之前它 们 曾会 引发 ioerror  现 在 这是 oserror  的一个 别 名
 isatty  返回 false
 seekpos  whence 0 设置 分 块 的当 前 位置
 whence  参数 为可 选项 并 且 默认 为0绝 对文 件定 位其他 值还 有1相对 当前位置 查找和2相对 文件 末尾查找
 没 有返 回值
 如 果下 层 文 件不 支 持 查找则 只 允许 向前查 找
 tell 将 当前位置返 回到 分 块
 readsize 1从 分块 读取 至多 size  个字节如果在 获得 size 个字 节之前已 到 达分块 末 尾 则读取 的 字节 会 少 于此 数 量
如 果 size  参 数 为 负值 或被省 略则读 取所 有 字 节直到分块 末尾
 当立 即遇 到分块末 尾则返回 空字节串 对象
 skip 跳 到分块 末尾
 此 后 对分块 再次调用 read  将返 回 b
如果 你对 分块 的 内容 不感 兴趣 则 应当 调 用此方 法以 使文 件 指 向 下 一 分块的 开头
脚注1 ea  iff 85 交换 格 式 文件标准 jerry  morrison  electronic  arts 1985 年1月
cmath 关于 复数 的 数学函 数
这一模 块 提供了 一些关于复 数的数 学函数
 该模 块的 函数的 参 数为 整 数、 浮点 数 或 复数
这 些函 数的 参数也可 为一 个 拥有 complex  或 float  方法 的 python 对象 这些 方 法分 别用 于 将 对象 转换 为复数和 浮 点 数 这 些 函 数作 用于 转换 后的结果
 注 解在 具 有 对于 有符 号零的 硬件和 系统 级支持 的平台上 涉 及支 割线的 函数 在支割 线的两侧都 是连续 的 零的 符 号 可用 来区 别支 割线的 一侧和 另一 侧
 在 不支 持有 符 号 零的平 台上 连续 性的 规则 见下 文
 到 极坐标和 从极 坐标 的转 换
 使用 矩形 坐标 或 笛卡尔坐 标在 内 部 存 储 python 复 数 z
 这完全取决 于它的实 部 z
real  和虚 部 z
换 句话 说 z  z
imag 1 j  极 坐标 提 供了 另一 种复 数的表示 方法
在极 坐标中一个 复 数 z  由 模 量 r 和相 位 角 phi 来 定 义
 模量 r 是从 z  到 坐标 原 点 的距离而相 位角 phi 是以弧 度 为单 位的 逆时针 的 从正 x  轴 到 连接 原点 和 z  的线段 间 夹角 的角 度
 下 面的 函 数 可 用于原 生 直角 坐标与 极 坐标的 相 互转 换
phasex 将 x 的 相位 也称为 x  的 参数 返 回为一个 浮 点数
phasex  相当 于 math
 结果处 于ππ 之间 以 及 这 个操 作 的 分支切 断处 于负 实轴 上 从上方 连续
 在支持 有符 号零 的系 统 上这 包 涵 大多数当 前的 常用系统 这意 味 着结果 的 符号与 x
imag 的符 号相 同 即使 x
imag  的值是0 phasecomplex 1
141592653589793 注 解一 个 复数 x  的 模数 绝对 值可 以通 过内置 函 数 abs  计 算
没有 单独的 cmath  模块 函 数 用于 这个操 作
polarx 在 极坐 标 中返 回 x  的表达方 式
返回一 个 数对 r  phir 是 x  的 模 数 phi  是 x 的 相位 角
 polarx  相 当于 absx  phasex
rectr  phi 通 过 极坐标 的 r 和 phi  返 回 复数 x
相 当于 r  math
cosphi  math
幂 函 数 与对 数函数
expx  返回 e 的 x 次 方 e  是 自 然对数的 底 数
logx  base 返回 给 定 base  的 x  的 对 数
如 果没 有给定 base 返回 x  的 自 然对数
 从0到∞存在 一条支 割线 沿负 实 轴 之 上连 续
log 10 x 返 回底 数 为10 的 x 的对数
 它具有 与 log  相同 的支 割线
sqrtx  返回 x  的平 方根
它 具有与 log  相同 的支 割线
 三角函 数
acosx  返回 x  的反 余弦
 这里 有两条 支割 线 一 条沿 着 实轴从1向 右延伸 到∞ 从 下面 连续 延 伸
另外一条 沿着 实轴 从1向左 延伸 到∞ 从 上面连 续延 伸
asinx 返回 x  的反 正 弦
 它与 acos  有 相 同的 支割 线
atanx  返回 x  的反 正切
 它 具有两 条支割 线一 条 沿 着 虚轴 从1 j  延伸 到∞ j 向右 持续 延 伸
 另 一条是 沿着 虚轴从1 j 延 伸 到∞ j 向左 持续 延伸
cosx  返 回 x 的 余弦
sinx 返 回 x 的 正 弦
tanx  返回 x  的正切
 双曲 函数
acoshx 返 回 x  的 反双曲 余 弦
 它有一 条 支割 线沿着 实轴 从1到∞ 向 左延 伸从上方 持续 延伸
asinhx  返 回 x 的 反 双曲 正弦
 它有两 条支 割 线一 条沿 着虚轴从1 j  向 右 持续延 伸 到∞ j
 另 一条 是 沿着 虚轴从1 j  向 左持 续延 伸 到∞ j
atanhx 返回 x  的 反双 曲正切
 它有 两条 支 割 线一 条是 沿 着实 轴从1延 展到∞ 从下面 持续 延展
另 一条 是 沿 着实 轴 从1延展到∞ 从上面 持 续 延 展
coshx 返回 x 的 双曲 余弦 值
sinhx 返回 x  的 双曲 正弦值
tanhx 返 回 x  的双 曲 正切值
分类函 数
isfinitex 如果 x  的实部 和虚 部都 是有 限 的 则返回 true  否则 返回 false
3
2 新 版 功 能
isinfx 如果 x 的实部 或者 虚部是无 穷大 的则 返回 true  否则 返 回 false 
isnanx  如果 x 的实部 或 者虚部是 nan  则返 回 true  否 则 返回 false
0 若 a 和 b  的 值 比较 接 近则 返回 true  否则 返回 false
 根据 给 定的 绝 对 和相对容差 确定 两个 值 是否 被 认 为是 接近 的
 reltol 是 相对 容差—— 它 是 a 和 b  之间 允许 的最大 差值相 对于 a  或 b 的 较大绝 对值
例如 要设置5％的容 差请 传递 reltol 0
05
 默 认容差 为1 e 09 确保两 个 值在大 约9位 十进 制 数字内 相同
 reltol  必 须大于 零
 abstol 是 最小 绝 对 容 差—— 对于接近 零 的 比 较很有 用
 abstol  必须 至少为 零
 如果没有 错 误 发生 结果 将 是 absab  maxreltol  maxabsa  absb  abstol 
 ieee 754特 殊值 nan  inf  和 inf 将 根据 ieee  规 则 处理
具 体来 说 nan 不被 认 为接近 任 何其他值 包括 nan 
 inf  和 inf 只 被认 为接近自己
3
5 新 版 功 能
参 见 pep 485——用 于测 试 近似相等 的函 数
常 数
pi 数 学常数π作 为一 个浮点 数
e  数 学常数 e  作为一 个浮 点数
tau  数学 常数τ 作 为一 个浮 点数
3
6 新 版功能
inf  浮点正 无穷大
 相 当 于 floatinf
3
6新 版功 能
infj 具有零 实 部 和正 无穷 虚部的 复数
相 当于 complex 0
3
6新 版功 能
nan  浮点 非数 字 nan 值
 相当 于 floatnan
3
6 新 版功 能
nanj 具 有零实部 和 nan 虚 部的复 数
 相当 于 complex 0
3
6新 版功 能
 请注 意函 数的 选 择与 模 块 math 中 的 函数选 择相 似 但不完全 相 同
拥 有两个模块的原因 是因 为 有 些 用 户对复 数不 感兴 趣 甚 至根 本不知 道它 们是什 么
它 们宁 愿 math
sqrt 1引发 异常 也 不 想返 回一 个复数
 另请 注意 被 cmath 定 义 的 函数 始 终会返 回一个 复数尽管 答案 可以 表 示为 一 个实数在 这种 情况下 复数 的虚 数部 分为 零
关于 支割 线的 注释 它们 是沿着 给定 函数 无法 连续 的 曲 线
它 们是 许多 复变 函数 的 必 要 特 征
 假设 您需 要 使用复 变 函数进 行计算 您将会了 解支 割 线 的概 念
请 参阅几 乎所 有关于复变 函数的不 太基 本的 书 来获 得启 发
对 于如 何 正确 地基 于 数值 目的来 选 择支 割线 的 相关信息 一 个 良好 的 参 考如 下参见 kahan  w  branch  cuts  for  complex  elementary  functions  or  much  ado  about  nothings  sign  bit
 in  iserles  a
 eds
 the  state  of  the  art  in  numerical  analysis
 clarendon  press 1987 pp 165211
cmd  支 持面 向行 的命 令 解释 器
源 代码 libcmd
pycmd 类提 供 简单 框架 用于 编 写面 向 行 的 命 令 解释 器
 这 些 通常对测 试工 具 管 理工 具和 原型 有 用这 些 工 具随 后将 被包 含在更 复 杂的 接 口 中
cmdcompletekeytab  stdinnone  stdoutnone  一个 cmd  实 例或子 类实 例是 面向 行的 解 释 器 框架 结构
 实例 化 cmd 本 身 是 没有 充分 理由 的它 作 为自定 义 解释 器类的超 类是 非 常 有用的 为了继 承 cmd 的方法 并 且 封装 动作 方 法
可 选 参数 completekey 是完 成 键的 readline  名称默 认 是 tab 
如 果 completekey 不是 none  并且 readline  是 可 用的 命令 完 成 会 自动完 成
 可 选参数 stdin  和 stdout 指定 了 cmd 实 例 或 子类 实 例将 用于输 入和 输出 的输 入和 输 出文 件对 象
如果没 有指 定 他 们 将 默认 为 sys
stdin  和 sys
stdout 
 如果 你想要 使用 一 个给 定的 stdin 确保 将实 例 的 userawinput 属性设置 为 false  否 则 stdin 将 被 忽略
cmd  对象
cmd 例子
 这部 分提供 了一 个 简单的 例子 来介 绍 如 何使用 一部 分 在 turtle 模 块中的命 令构 建一 个 shell 
基 础 的 turtle 命 令 比 如 forward 被添加 进一 个 cmd 子 类 方法名 为 doforward 
参 数被转 换成 数 字 并且分 发至 turtle  模组 中
 docstring 是 shell  提供 的帮 助 实 用 程序
例子也 包 含使 用 precmd 方法实 现基 础的记 录 和 回放的 功能 这 个 方法负责 将 输入转换为 小写 并且 将命 令 写 入文件
 doplayback 方法 读取文件并 添加 记录 命令 至 cmdqueue  用于 即时回 放 import  cmd  sys  from  turtle  import  class  turtleshellcmd
cmdloop 这 是一 个示 例会 话其 中 turtle  shell 显 示 帮 助 功 能使用空 行 重 复命 令 以 及 简 单的记录 和回 放功 能 welcome  to  the  turtle  shell
code  解释器基 类
 交 互解 释 器对象
runsourcesource  filenameinput  symbolsingle  在解 释器 中 编译 并运 行 一段 源 码
所 用 参数 与 compilecommand 一样 filename 的 默认值 为 inputsymbol 则 为 single
可 能 发生 以下 情 况之 一输 入不 正 确 compilecommand  引 发了 一个异 常 syntaxerror  或 overflowerror
 将 通过 调用 showsyntaxerror  方法打印 语 法 回 溯 信息
 runsource 返回 false
 输 入不完 整 需要更 多输 入函 数 compilecommand 返回 none 
 方 法 runsource  返 回 true 
输 入完整 compilecommand  返回 了一 个 代 码对 象
将 通过调 用 runcode 执 行 代码 该方法也 会处理运 行 时异常 systemexit  除 外
 runsource 返 回 false
 该返 回值 用于决 定 使 用 sys
ps 1还是 sys
ps 2 来作 为下一 行的输入 提 示符
runcodecode  执 行一 个代码对 象
当 发 生异 常时 调用 showtraceback 来显 示 回 溯
除 systemexit  允许传 播 以外 的所 有异 常 都 会被捕 获
有 关 keyboardinterrupt  的说 明该异常 可能发 生 于此 代 码 的其 他位 置 并且 并 不总能 被捕 获
 调用 者 应当 准 备好处理 它
showsyntaxerrorfilenamenone 显 示 刚 发生 的语法 错误
 这 不 会 显示 堆栈回 溯 因为语法错 误 并无 此 种 信息
 如果 给 出 了 filename 它 会被 放入 异常 来 替代 python  解析器 所 提供 的 默 认 文件 名因为它 在从 一 个字 符 串 读 取时总是会 使 用 string
 输出 将 由 write 方法来 写入
showtraceback 显 示刚 发生的异 常
我 们移 除了 第一个堆栈 条 目 因 为它 从属 于 解释 器对 象 的 实现
 输出 将 由 write  方法 来写 入
在3
5 版更 改将显示 完整的链 式 回溯 而不 只 是主 回溯
writedata 将一 个 字符串 写入到 标 准 错 误 流 sys
所 有派 生 类 都应重载此 方法 以 提供必要 的正 确输出处理
 交互式 控制台 对象
codecs 编 解码器注册 和相关基 类
编 解码 器基类
codecs 模块定 义 了 一 系列 基类 用来定 义配 合 编 解码 器对象 进 行工 作的接 口 并 且 也 可用作 定制 编 解 码器实 现 的基 础
每 种编 解码 器必 须定 义 四 个 接 口 以便 用作 python  中 的编 解 码器 无状 态编码器、无 状态解 码器、流 读 取 器 和 流写 入器
流读 取 器和 写 入 器通 常 会 重 用无状态 编 码器解码 器 来 实 现文件协 议
 编 解 码器作者 还需 要 定义编 解 码器 将 如 何 处理 编 码和解 码错 误
 错误 处 理方 案
 无状 态的 编码 和 解 码
 增量式 的 编码 和 解 码
流式的 编 码 和解 码
 编 码格 式与 unicode
 标准编码
python  专属的编 码格 式
有一些预定义 编解 码 器是 python 专属的 因此 它们 在 python  之 外 没有意义
 这 些编 解码器 按其所预 期的输入 和输 出类型在下 表中列出 请注 意虽 然文本编码 是编 解码 器最常 见 的使 用 场 景 但下 层的 编 解码 器 架构 支 持 任意数 据 转换 而不 仅 是文 本编码
 对于非对 称 编解码 器该列 描述 的含义 是编 码 方向
文 字编 码
 二 进制 转换
 文 字转换
encodingsidna  应 用 程序 中的 国际 化域名
此 模 块 实现 了 rfc 3490应 用 程序 中的国际 化 域名和 rfc 3492 nameprep  用于 国际化 域 名 idn 的 stringprep 配置 文件
它 是在 punycode  编码 格 式和 stringprep  的基 础上构建的
这 些 rfc 共 同 定义 了一 个在 域 名中支 持非 ascii  字符 的 协 议
一个 包含 非 ascii 字 符的 域 名 例如 www
nu  会被转 换 为兼容 ascii 的 编 码格式 简 称 ace 例 如 www
随后此 域 名 的 ace 形 式可以 用于所有 由于特定协 议而 不允 许 使 用任意 字 符的场 合例 如 dns 查询 http  host  字 段等 等
 此转换是 在应 用中 进行的 如有可 能将对 用 户可 见应 用应当 透明 地 将 unicode 域 名标 签 转 换为 线 上的 idna  并 在 ace 标 签被呈 现给 用户 之前 将其 转换 回 unicode
python  以 多种 方 式支持 这种 转换 idna  编 解码 器执行 unicode 和 ace  之间的转 换基 于在 section 3
1 of  rfc 3490中 定义的 分 隔 字 符 将输 入 字符串 拆分 为标签 再根据 需 要 将 每 个标 签转换为 ace  相反 地又会 基于
 分 隔符将 输 入字 节串拆分 为标签再 将找 到 的 任 何 ace 标签转 换 为 unicode
此外 socket  模 块 可 透明 地将 unicode 主机 名 转换为 ace  以 便应 用在 将 它们 传 给 socket 模 块 时无须 自行 转 换主 机名
除 此 之外许 多包含 以主 机名 作 为函 数参 数的 模块 例如 http
client  和 ftplib 都接 受 unicode 主 机 名 并且 http
client  也 会 在 host 字 段中透明 地发送 idna 主 机 名如果 它 需要发 送 该字 段的 话
 当从 线 路接收主 机 名 时例 如反向名 称 查 找 到 unicode  的转 换不 会 自动 被 执行 希望 向用 户提 供 此种 主机名的 应 用应 当 将 它 们 解 码为 unicode
encodings
idna  模块还 实现 了 nameprep 过程 该过程 会对 主 机名 执 行特定 的 规范 化 操 作 以 实现国 际域名 的大 小写 不 敏感特 性 与合 并 相 似的 字 符
如果 有需 要可以 直接 使用 nameprep 函 数
namepreplabel 返 回 label 经 过 名 称 处理操作 的 版 本
该 实现 目 前基 于查询字符串 因 此 allowunassigned 为 真值
toasciilabel  将标 签 转换 为 ascii  规则定 义见 rfc 3490
 usestd 3 asciirules  预设为 假值
tounicodelabel 将 标签 转换为 unicode  规 则 定 义见 rfc 3490
encodingsmbcs  windows  ansi 代 码 页
encodingsutf 8 sig 带 bom  签名的 utf 8编 解码器
codeop 编 译 python 代 码
 源 代 码 libcodeop
pycodeop 模块提 供 了可以 模 拟 python 读取 执 行打 印 循环 的实用 程 序就 像 在 code 模 块中一 样
 因此您 可 能 不希 望 直 接使 用该模块 如 果 你 想在程 序中 包含 这 样一个 循 环你可 能需 要使 用 code 模 块
 这 个 任 务有两个 部 分1
 能够 判断 一 行 输入 是否完 成 了 一 个 python  语句简而 言 之告诉我 们 是 否 要打印或

 记住用 户 已 输 入了哪些 future  语 句 这样后 续 的输入 可 以在 这些 语 句被 启 用的状态 下 被编译
codeop  模 块提 供 了分别以 及同 时执 行这 两 个部 分的 方 式
只 执行 前 一 部 分 codeop
compilecommandsource  filenameinput  symbolsingle 尝 试编 译 source 这应 当是 一个 python 代码 字 符串 并且在 source  是 有 效的 python 代 码时返 回一 个代码 对 象
在 此 情况 下代 码对象的 filename  属性 将为 filename 其 默 认值为 input
 如 果 source 不 是有效的 python  代码而是 有效 的 python  代码 的一 个前 缀 时将返 回 none
 如果 source 存在 问 题 将 引发异常
如 果 存在无 效的 python 语 法将 引 发 syntaxerror 而如果 存在 无 效 的 字 面 值则将引 发 overflowerror  或 valueerror
 symbol 参数确 定 source  是 作 为 一 条 语 句 对 应默 认 值 single 作为 一 系列 语句 exec  还 是作 为一个 expression  eval  进行 编 译
任何 其 他值 都将导致 引发 valueerror
注解 解析 器 有可 能但很不 常见 会在 到达源 码 结 尾 之前停 止 解析 并 成功 输 出 结 果 在这 种情况下 末 尾的符号 可 能会被 忽 略而 不是 引 发错 误
例 如一个 反斜杠 加两 个 换 行符 之后 可以 跟 随任何 无意 义 的 符 号
一 旦 解析 器 api  得 到改 进 将修正 这 个问 题
compile  这个 类 的 实 例 具有 call  方法 其签 名与 内置函数 compile  相似 区别 在于如 果该实 例编 译了包 含 future 语 句 的程 序 文 本则 实 例会‘ 记住’ 并 使 用已生 效 的 语 句编译 所有后续 程序 文本
commandcompiler 这个 类 的 实例具有 call 方 法其 签名 与 compilecommand 相 似 区 别在 于如 果该 实例 编 译 了 包含 future  语句 的 程 序文 本则 实例 会‘记 住’ 并 使用 已 生 效 的语 句 编 译编 译 所 有后 续程序 文本
collectionsabc  容器 的 抽象 基类
3
3新 版功 能该模块曾是 collections  模块 的组 成部 分
源代码 libcollectionsabc
py 该 模块 定义 了 一 些 抽象基类它们 可用于 判断 一个具体 类 是否 具 有 某一 特 定的 接口 例如这个 类是否 可哈 希 或其 是否为 映射 类
容 器抽 象基 类
collections 容器数据类 型
py  这个 模 块实现 了特 定目 标 的 容器 以 提 供 python  标准 内 建容 器 dict  list  set  和 tuple  的替代选 择
 namedtuple  创建命 名 元组 子类 的 工 厂函数 deque  类 似列表 list 的 容器 实 现了 在两 端快 速添 加 append 和 弹出 pop  chainmap  类似 字 典 dict 的 容器 类将多个 映射 集 合 到 一个 视图里面 counter  字典 的子 类提 供了 可哈希 对象的 计数 功 能 ordereddict 字 典的 子 类保 存了 他 们 被添 加的 顺序 defaultdict  字 典 的 子类 提供 了 一个 工 厂函数 为字典 查询 提供一 个默 认值 userdict  封装 了字 典 对象 简化 了字 典子 类 化 userlist 封 装了 列 表对 象简 化了 列表 子 类 化 userstring  封装 了列表对 象 简 化 了字 符串子 类化 deprecated  since  version 3
10已 将容 器抽 象基 类移 至 collections
abc 模 块
为 了保 持向 下兼容 性它 们在 python 3
9版 的这 个模 块中仍 然存在
chainmap  对象
3
3 新 版功 能
一 个 chainmap 类是 为 了将多个 映射 快速的链接 到一 起这 样 它们就 可以 作为一 个单元处 理
它通常 比 创建 一个 新字典 和 多次 调用 update 要 快很多
 这个 类可 以用 于 模 拟嵌套 作用 域并且 在模版化 的 时 候 比较 有用
chainmapmaps 一 个 chainmap  将多 个字 典 或 者其 他映 射 组 合 在一 起创 建一 个单独 的可更 新的 视 图
如 果没有 maps 被 指定 就 提供一 个默认 的空 字 典 这样 一 个新 链至 少 有一 个映 射
 底层映射 被存 储 在一 个 列 表中
 这个 列 表 是公开 的可 以 通 过 maps 属性存 取和 更新
没 有其 他 的状态
 搜索 查 询 底 层 映 射 直到 一 个键 被找到
 不同 的 是 写更 新和删 除只 操作 第一个映 射
一 个 chainmap 通 过引 用 合并 底层映 射
 所 以 如果 一个 底 层 映 射更 新了 这 些更 改会反 映 到 chainmap 
 支 持 所有常 用字 典方法
 另外 还有 一 个 maps  属 性 attribute 一 个 创 建子 上下文 的 方法 method  一 个存取 它们 首个映射 的属性 property  maps 一 个 可 以更 新的映射列表
 这个 列 表是 按 照第 一次 搜索到 最后 一次搜 索的 顺 序组织 的
它是 仅 有的 存 储 状态 可以 被修 改
列 表最 少包含 一个映 射
 newchildmnone 返 回 一 个新的 chainmap  类包含 了 一 个新映 射 map 后面 跟随 当前 实例 的 全 部映射 map
 如 果 m 被 指 定它 就成 为 不 同 新 的 实例 就 是 在所 有映 射前 加 上 m  如 果 没 有 指 定 就加 上一 个空字 典这样 的 话 一 个 d
newchild 调 用 等价于 chainmap  d
maps 
这个 方 法 用于 创 建 子上 下 文不 改变任 何父映射 的值
在3
4 版更 改 添加 了 m 可选 参数
 parents 属 性返 回一 个 新的 chainmap  包含所 有的当前 实例 的映 射除了 第一 个
 这样可 以在 搜 索的 时候 跳过 第一 个 映 射
 使 用 的场景类 似 在 nested  scopes  嵌 套 作 用域中 使 用 nonlocal 关 键词
 用 例 也可以类 比 内 建 函 数 super 
 一个 d
parents 的 引 用等 价于 chainmapd
maps 1
注 意一 个 chainmap 的迭 代 顺 序 是 通 过扫 描 最后 的映 射来 确 定的 baseline  music  bach  art  rembrandt  adjustments  art  van  gogh  opera  carmen  listchainmapadjustments  baseline  music  art  opera  这 给 出了与 dict
update  调用 序 列 相同 的顺 序 从最 后一 个 映射 开始 combined  baseline
updateadjustments  listcombined  music  art  opera  在3
9版 更 改 增加 了对和 运算 符的 支 持相关 说明 见 pep 584
参 见 multicontext  class 在 enthought  codetools  package  有 支 持写映 射 的 选项
 django 的 context  class 模 版 是只 读 映射
它 的上 下 文的 push  和 pop  特性也 类 似 于 newchild 方 法 parents 属性
 nested  contexts  recipe  提供了 是 否 对第 一个映 射或 其 他映 射进 行 写和 其 他 修改 的 选项
 一个极简 的只读 版 chainmap
chainmap 例子和方法
这 一节 提 供了 多个 使 用链 映射 的案 例
模 拟 python  内 部 lookup 链 的 例 子 import  builtins  pylookup  chainmaplocals  globals  varsbuiltins  让 用 户 指定 的命 令行参 数优 先于环 境变量 优先 于默认 值 的 例子 import  os  argparse  defaults  color  red  user  guest  parser  argparse
environ  defaults  printcombinedcolor  printcombineduser 用 chainmap  类 模 拟 嵌 套 上 下文的 例 子 c  chainmap  create  root  context  d  c
items  all  nested  items  dictd  flatten  into  a  regular  dictionarychainmap 类只 更新链 中 的 第一 个映 射 但 lookup  会 搜索 整个 链
 然 而如 果需 要深 度 写和删 除也 可以 很 容 易的 通 过定义一 个子 类 来 实现 它 class  deepchainmapchainmap  variant  of  chainmap  that  allows  direct  updates  to  inner  scopes  def  setitemself  key  value  for  mapping  in  self
counter 对 象
一 个计 数器 工具 提供快 速 和 方 便的 计数
 比如 tally  occurrences  of  words  in  a  list  cnt  counter  for  word  in  red  blue  red  green  blue  blue 
counteriterableormapping  一 个 counter 是 一个 dict  的 子类 用于 计数 可哈 希 对 象
它 是一 个集 合 元素 像字典键 key  一样 存储 它们 的计 数 存储 为值
 计数 可以 是任何 整数 值包 括0和 负数
 counter  类 有点 像 其 他语 言 中的 bags 或 multisets 
 元 素 从 一个 iterable  被 计 数 或从 其他的 mapping  or  counter  初 始化 c  counter  a  new  empty  counter  c  countergallahad  a  new  counter  from  an  iterable  c  counterred 4 blue 2 a  new  counter  from  a  mapping  c  countercats 4 dogs 8 a  new  counter  from  keyword  args  counter 对 象有一 个字 典 接口 如 果 引用 的键没 有 任何 记录 就返 回一 个0而 不是弹出一个 keyerror  c  countereggs  ham  cbacon  count  of  a  missing  element  is  zero 0 设置一个 计数为0 不 会 从计 数 器 中移 去一 个元 素
 使 用 del 来 删除 它 csausage 0 counter  entry  with  a  zero  count  del  csausage  del  actually  removes  the  entry 3
1 新版 功能
 在3
7版更 改作 为 dict 的 子类 counter  继承 了 记 住 插入顺 序的 功能
 counter  对象 进行数 学 运算时同 样会保 持顺 序
结果 会先 按 每个 元素 在运算 符左 边 的出现时 间排 序然 后再 按其在 运算 符右 边的 出现 时间 排 序
计 数器 对象 除了 字典方 法以 外还 提供了 三 个 其他 的 方 法 elements 返回 一 个迭 代 器其 中每 个 元素 将 重 复 出现 计数 值所指 定次
 元素 会 按 首次出现的 顺序 返回
如 果一 个 元素 的计 数值 小于 一 elements 将 会忽 略 它
elements  a  a  a  a  b  b  mostcommonn 返 回一个 列 表 其 中 包 含 n 个 最 常见 的 元素及出 现次数 按常见程 度由高到低 排序
 如 果 n 被省略 或 为 nonemostcommon 将 返回 计 数器中的 所有元 素
计数 值相等的 元素 按首次 出现的 顺序排 序 counterabracadabra
mostcommon 3 a 5 b 2 r 2 subtractiterableormapping 从迭 代 对象 或映 射 对象减去 元 素
 像 dict
update 但是是 减 去 而不是替 换
输入 和输出 都可以是0 或者负 数
subtractd  c  countera 3 b 0 c 3 d 63
2新 版功 能
 通 常 字典 方法 都 可用于 counter  对象 除了 有两 个方 法工 作方 式 与 字典并 不相 同
 fromkeysiterable 这 个类方 法 没有在 counter  中实 现
 updateiterableormapping 从迭代 对象 计 数 元 素 或 者 从另 一个 映射 对象 或计 数 器 添加
像 dict
update  但 是 是 加 上而 不是 替换
 另外迭 代对象应 该是 序列元 素而 不是一 个 key  value 对
counter 对 象的 常用 案例 sumc
mostcommonn 11 n  least  common  elements  c  remove  zero  and  negative  counts 提 供 了几个 数学 操作 可 以结 合 counter 对象 以 生产 multisets  计数 器 中 大 于0的 元 素
 加和 减 结 合计 数器 通过 加上或 者 减去元 素 的相应计 数
交 集和 并集 返回 相应 计数 的最 小或 最大 值
每种操 作都 可以 接 受 带符号 的计数 但是输出 会 忽略掉 结 果为 零或 者小 于零的 计 数
 c  countera 3 b 1 d  countera 1 b 2 c  d  add  two  counters  together  cx  dxcountera 4 b 3 c  d  subtract  keeping  only  positive  countscountera 2 c  d  intersection  mincx  dx  countera 1 b 1 c  d  union  maxcx  dxcountera 3 b 2单目 加和 减一 元操 作符意 思 是从 空计 数 器 加或 者减 去
 c  countera 2 b 4 ccountera 2 ccounterb 43
3 新版 功能添 加了 对一元 加一元 减和位 置集 合操作的 支持
注 解计 数器主 要是为 了表 达 运行 的正 的计 数而设 计但 是小 心不要 预 先排除 负数 或者 其 他 类 型
 为 了帮助 这些 用 例这 一节 记录 了最 小范围 和类 型限 制
 counter 类是 一个字 典的 子类不 限制 键和 值
值用 于 表 示计数 但你实 际上 可 以存储 任何 其 他 值
 mostcommon  方法 在值需 要排 序的 时候用
 原地 操作 比 如 ckey 1值 类型只 需要支 持加 和减
所 以分 数小 数和 十 进制都 可以用负 值也 可以 支持
 这 两个 方法 update  和 subtract 的输 入 和 输出 也 一样 支 持负 数和0
 multiset  多集 合方法只 为 正值 的使 用情况 设计
 输入 可以 是负 数 或 者0但 只输 出计数 为正的 值
没 有类 型 限制 但值 类型 需 要 支持 加减 和 比较 操 作
 elements 方 法要 求 正 整数 计数
忽略0 和 负 数 计数
 参见 bag  class 在 smalltalk
 wikipedia  链接 multisets
 c  multisets  教程 和例 子
 数学操 作和多 集 合用 例参 考 knuth  donald
 the  art  of  computer  programming  volume  ii  section 4
3 exercise 19
在 给 定 数量 和 集合 元素枚举 所 有 不 同的多集 合参 考 itertools
combinationswithreplacement  mapcounter  combinationswithreplacementabc 2 aa  ab  ac  bb  bc  cc
deque 对象
deque  用 法
 这 一节 展示了 deque  的多 种用 法
 限 长 deque 提 供了类 似 unix  tail 过 滤 功 能 def  tailfilename  n 10 return  the  last  n  lines  of  a  file  with  openfilename  as  f  return  dequef  n 另 一个 用 法 是维护 一个 近期 添加元素 的序 列通过从 右 边添 加 和从左 边弹出 def  movingaverageiterable  n 3 movingaverage 40305046394440
appendelem  yield  s  n  一个 轮询 调度器 可以 通过 在 deque 中 放入 迭代器来 实 现
值 从当前 迭 代 器的 位 置0 被取出 并暂存 yield
 如果这个 迭代器 消耗 完毕 就用 popleft  将其 从对 列中 移 去否 则就 通 过 rotate 将 它移 到 队 列 的 末 尾 def  roundrobiniterables  roundrobinabc  d  ef  a  d  e  b  f  c  iterators  dequemapiter  iterables  while  iterators  try  while  true  yield  nextiterators 0 iterators
popleftrotate 方 法 提供 了一种方 式来 实现 deque 切片和 删除
 例如 一个 纯的 python  del  dn  实 现 依 赖 于 rotate 来 定位 要弹 出的 元素 def  deletenthd  n  d
rotaten  要实 现 deque 切 片使 用 一个类 似的 方法 应用 rotate 将目 标 元素 放到 左 边
 通过 popleft  移去老的条目 entries 通过 extend  添加 新的 条目 然后 反向 rotate
 这个 方 法可 以最 小 代价 实现 命令式的 栈操作 诸如 dup  drop  swap  over  pick  rot  和 roll 
defaultdict 对象
defaultdict  例子
 使 用 list  作为 defaultfactory  很轻 松地将 键值 对组成的 序列转 换 为 键列 表组 成的 字 典 s  yellow 1 blue 2 yellow 3 blue 4 red 1 d  defaultdictlist  for  k  v  in  s
itemsblue 24 red 1 yellow 13当 每个 键第一次 遇见时 它还 没有 在字 典里 面所 以自 动创建该 条 目 即 调 用 defaultfactory 方 法返 回一 个 空的 list
 list
append  操作 添加值到 这个新的 列 表 里
 当再 次 存 取该 键时 就正 常 操 作 list
append  添 加另 一个值 到列 表中
 这个 计 数 比它 的等 价方 法 dict
setdefault 要快 速 和 简单 d  for  k  v  in  s
itemsblue 24 red 1 yellow 13设 置 defaultfactory 为 int  使 defaultdict  用 于计 数 类 似其 他语 言中 的 bag 或 multiset  s  mississippi  d  defaultdictint  for  k  in  s
itemsi 4 m 1 p 2 s 4 当一个 字母 首次 遇到时 它 会查 询失 败 则 defaultfactory 会 调 用 int  来 提供一个整 数0作为默 认值
后续 的 自增操 作建 立起 对 每个 字母的 计数
 函数 int  总 是返回0这 是常 数函数的特 殊情况
 一个 更 快和 灵活 的方 法是 使用 lambda  函 数可 以提 供任 何常量 值不 只是0 def  constantfactoryvalue
updatenamejohn  actionran  names  actions  to  objects  djohn  ran  to  missing 设置 defaultfactory  为 set 使 defaultdict 用 于构 建 set  集 合 s  red 1 blue 2 red 3 blue 4 red 1 blue 4 d  defaultdictset  for  k  v  in  s
namedtuple 命 名元 组 的工厂 函 数
命 名元组 赋予 每个 位 置 一个含 义提 供可读性 和自 文档 性
 它 们可 以用于任 何普 通元组并 添加了通 过名 字获取 值的 能 力通过索引值 也是 可以 的
namedtupletypename  fieldnames  renamefalse  defaultsnone  modulenone 返 回一个 新的 元组 子类 名 为 typename 
 这个 新的 子 类用于创 建类 元 组的 对 象可 以 通过 字段 名 来获 取属性 值 同 样也 可以 通过 索引 和迭 代获取 值
子 类 实例同 样有文档字 符串类名 和字 段名 另 外一 个有 用 的 repr 方 法以 namevalue  格 式列 明了元组 内容
 fieldnames  是 一个 像‘ x ’‘ y ’一样的 字 符串 序列
另 外 fieldnames 可 以是 一个 纯 字 符串 用空 白或 逗号 分隔 开元 素名 比如 x  y  或 者 x  y 
任 何有效的 python 标 识 符都可 以 作为 字段 名除了下 划线 开头 的那 些
 有 效 标 识 符 由字 母 数 字 下划 线 组 成但首字母 不能 是数 字 或下 划线 另 外不能 是关 键 词 keyword 比 如 class  for  return  global  pass  或 raise 
如 果 rename 为 真无 效 字段名会 自动转换 成位 置名
比 如 abc  def  ghi  abc 转 换成 abc 1 ghi 3 消除 关键词 def 和 重复 字段名 abc 
 defaults 可以 为 none  或者 是一 个 默 认值的 iterable 
 如果一个 默认值 域必须 跟其他 没 有默 认 值 的域在 一起 出 现 defaults 就应用 到 最 右边的参 数
比 如 如果 域名 x  y  z 和 默认值12那么 x 就 必须指定 一 个 参数 值 y  默认 值1 z  默 认值2
 如果 module 值 有定 义 命 名 元 组 的 module  属 性值就 被设 置
 命 名元组实 例没 有字典所 以 它们要 更轻量 并且 占用 更 小内存
 在3
1版更 改添加 了对 rename  的支 持
 在3
6 版更 改 verbose 和 rename  参 数成 为仅限关键 字 参 数
在3
6 版更 改 添 加 了 module 参数
 在3
7版更 改移除 了 verbose 形 参和 source  属性
 在3
7版更 改添 加了 defaults  参数 和 fielddefaults 属 性
y  fields  also  accessible  by  name 33 p  readable  repr  with  a  namevalue  style  pointx 11 y 22 命 名元 组尤 其有 用 于 赋 值 csv  sqlite 3模 块返 回的 元组 employeerecord  namedtupleemployeerecord  name  age  title  department  paygrade  import  csv  for  emp  in  mapemployeerecord
title  除 了 继承 元组 的 方 法命 名元组 还 支持三个额 外的 方 法和两 个属性
为了 防 止字 段 名冲突 方法和属 性以 下划 线开 始
makeiterable 类方 法 从存在的序 列 或迭 代实 例创 建一个新 实 例
asdict 返 回一个 新 的 dict  它 将字段 名 称映射 到它们 对 应 的值 p  pointx 11 y 22 p
asdict  x 11 y 22在3
1版更 改返回 一个 ordereddict  而不 是 dict 
 在3
8版 更改返回 一 个 常规 dict  而 不是 ordereddict
 因为 自 python 3
7 起常 规 字典 已经保 证有序
 如果需要 ordereddict 的 额外特 性推 荐 的 解决 方案 是将 结 果转 换 为 需要 的类型 ordereddictnt
replacekwargs  返回 一个 新 的 命 名 元组 实例 并将 指定域 替换 为 新的 值 p  pointx 11 y 22 p
fields 字 符串 元 组列出了字 段名
 用于提 醒和 从现 有元组 创 建 一个 新的命 名 元 组类型
fielddefaults  字 典 将 字段 名称 映射到默认 值
fielddefaults  balance 0 accountpremium  accounttypepremium  balance 0要 获 取 这个名 字 域的值 使用 getattr  函数 getattrp  x 11 转 换一 个 字典到 命名 元组 使 用两星 操作 符所 述如 解包 参 数 列 表 d  x 11 y 22 pointdpointx 11 y 22 因为一 个 命名元 组是 一 个正常 的 python 类 它可 以 很容 易 的通过子类 更改 功 能
 这里是如 何添 加 一个计 算域 和 定 宽输出 打 印格 式 class  pointnamedtuplepoint  x  y 
018上面 的 子类 设置 slots  为 一个空元组
 通 过阻止创建 实例 字典 保持了 较低 的 内存开 销
子类化对 于 添加和 存储 新的 名字域 是 无效 的
应 当 通 过 fields 创 建一个 新的 命名 元组 来实 现它 point 3 d  namedtuplepoint 3 d  point
fields  z  文档 字符串可以 自定 义通 过直 接 赋值 给 doc 属 性 book  namedtuplebook  id  title  authors  book
doc  list  of  authors  sorted  by  last  name  在3
5版更改 文 档字符 串属 性变 成可 写
参 见请参 阅 typing
namedtuple 以获 取 为 命 名元 组添 加 类型 提示 的方 法
 它 还使用 class 关 键字 提供 了一 种优 雅的 符 号 class  componentnamedtuple  partnumber  int  weight  float  description  optionalstr  none 对 于 以字 典 为底 层的 可变 域名 参考 types
simplenamespace 
 dataclasses  模 块提 供 了一个装 饰器 和一些 函 数 用 于自 动将 生成 的特 殊方法 添加 到用户定 义 的类 中
ordereddict 对 象
 有 序词典 就像 常规 词典一 样 但有 一 些与 排序 操作相 关的 额外 功 能
由于 内 置 的 dict 类 获得了 记住插 入顺序 的能力在 python 3
7 中 保 证了 这种 新行 为它 们变 得不 那么 重 要 了
 一些 与 dict  的不 同 仍 然 存在常 规的 dict  被设 计为 非常 擅 长 映 射操 作
跟踪插 入顺 序 是次要 的
 ordereddict  旨在 擅长重 新 排序 操 作
 空 间 效率、 迭代 速 度 和更 新操 作 的性 能 是 次 要的
算 法上 ordereddict 可 以 比 dict  更 好 地 处理 频 繁 的重 新排 序 操 作
这 使其适用于 跟踪 最 近的 访问例 如在 lru  cache  中
 对 于 ordereddict 相 等操作检查 匹 配顺序
 ordereddict 类 的 popitem  方法 有 不同 的 签名
 它接 受一 个可 选 参 数 来指定 弹出 哪 个元素
 ordereddict  类有一个 movetoend 方 法可 以 有效 地将元 素 移动 到 任一 端
 python 3
8之前 dict  缺 少 reversed  方法
ordereddictitems  返回一个 dict 子 类的实例它 具有 专 门用于 重新排列字 典 顺序 的 方法
3
1新 版功 能
 popitemlasttrue  有 序字 典的 popitem  方法 移 除并 返回一个 key  value  键值对
 如果 last  值 为真则 按 lifo  lastin  firstout 后 进 先 出 的顺 序返 回键 值对否 则 就按 fifo  firstin  firstout  先进 先出 的顺 序返 回 键 值 对
 movetoendkey  lasttrue  将现 有 key 移动到 有序 字典 的 任一 端
如 果 last 为 真值默认 则将元 素 移至末 尾如 果 last  为 假值则 将 元素 移至 开 头
 如果 key  不 存在 则会触发 keyerror  d  ordereddict
keys  bacde 3
2 新版功 能
相对 于通常 的映 射方 法有 序 字典 还另 外提供了 逆序 迭代 的 支持通 过 reversed 
ordereddict 之 间的相等 测试是 顺序 敏 感的 实现 为 listod 1
items 
 ordereddict  对 象和 其他的 mapping  的相 等 测 试是顺 序敏 感的 字 典 测 试
这允 许 ordereddict 替 换为任何 字典可 以使 用的 场所
在3
5 版 更 改 ordereddict 的项 item 键 key 和 值 value 视 图现 在 支 持逆 序迭代 通 过 reversed 
在3
6 版更改 pep 468 赞成 将 关 键词参数 的顺 序保留 通过 传递给 ordereddict 构造器 和它的 update  方法
在3
9版 更 改增 加 了 合 并与 更新 运算符 相关 说 明见 pep 584
ordereddict 例子 和 用 法
 创建 记住 键值 最后插入 顺 序 的有序 字 典变 体很 简 单
如 果 新 条目覆盖 现有条目 则原始 插入 位 置 将更改 并移 至末尾 class  lastupdatedordereddictordereddict  store  items  in  the  order  the  keys  were  last  added  def  setitemself  key  value  super
movetoendkey 一 个 ordereddict 对 于 实 现 functools
lrucache  的 变 体也 很有 用 class  lruordereddict  limit  size  evicting  the  least  recently  lookedup  key  when  full  def  initself  maxsize 128 args  kwds  self
userdict 对象
userdict  类 是用 作 字典 对 象 的外包 装
 对 这个类 的 需求 已部分由直 接 创 建 dict  的子 类 的功 能 所替 代不 过 这个类处 理起 来 更容 易因为底 层的 字典可以 作 为属 性来 访 问
userdictinitialdata 模 拟一个字 典类
 这个实例 的内容保 存为 一个 正 常字 典可 以通 过 userdict 实 例的 data 属 性 存取
 如果 提 供了 initialdata 值 data  就被初 始化 为它 的内容注 意一 个 initialdata  的 引用 不会 被保留 作为 其 他用 途
 userdict  实例 提 供 了以 下属 性 作为 扩 展 方法和操 作 的 支持 data 一个 真 实 的字 典用 于 保 存 userdict  类的内 容
userlist 对 象
 这个 类封 装了列 表对 象
 它是 一个 有用的 基础 类对 于你想自 定 义 的类似列 表的 类 可以 继承和覆 盖现有的 方 法也 可以添 加新 的 方法
这样 我们 可以 对列表 添 加新的行 为
对 这个类的 需 求已 部 分 由直 接 创建 list  的 子类 的功 能 所替代不 过这 个类 处理起 来 更容易因 为底 层的 列 表可 以作为属 性来 访问
userlistlist  模 拟一个列 表
这 个实例 的 内容被保 存 为一 个正 常列表通 过 userlist 的 data  属 性存 取
实 例内 容被 初 始化 为 一个 list  的 copy  默认 为 空列 表
 list  可以 是迭 代 对 象比 如一 个 python  列表或 者一 个 userlist  对象
 userlist  提供 了以下属 性作 为 可 变序 列的 方法 和操作的 扩展 data  一个 list  对象 用于 存 储 userlist  的 内容
 子类化 的要 求 userlist 的 子类 需 要提供一 个 构造 器可 以无 参 数调 用或 者一 个参数调 用
返 回一个 新序 列的 列 表 操作需 要 创建 一 个实 现类 的 实例
 它假 定 了构 造器 可以以一 个 参数 进 行调 用这 个参数是一 个 序 列 对象 作为数据 源
如 果 一个分 离的 类不 希望 依照 这个需求 所有的特 殊方 法就 必 须重 写 请 参照源 代码进行 修改
userstring  对象
userstring 类是 用作字 符串 对象的 外包 装
对 这 个 类的 需求 已部 分由直 接创建 str  的 子类 的 功能 所 替 代 不 过这个 类处 理起 来更 容易 因 为底 层的 字符串 可 以 作为 属性来访问
userstringseq  模拟 一 个字 符 串对象
这 个实 例 对象 的 内容保 存为 一 个正 常 字符 串 通过 userstring 的 data  属性存 取
实 例内 容初 始化 设置 为 seq  的 copy 
seq  参数 可 以 是 任 何可通过 内 建 str 函数转 换为 字 符 串 的 对 象
 userstring 提 供了 以 下属 性 作 为 字符 串方 法和 操作 的额外 支 持 data  一个 真 正 的 str  对象 用来存 放 userstring 类的 内 容
在3
5版 更改 新 方 法 getnewargs  rmod  casefold  formatmap  isprintable 和 maketrans
colorsys  颜色 系 统 间的 转 换
 源 代 码 libcolorsys
pycolorsys  模块定 义 了计算 机显示 器所 用的 rgb  red  green  blue 色彩 空间与 三种 其他色 彩 坐 标系 统 yiq  hls  hue  lightness  saturation 和 hsv  huesaturation  value 表 示的 颜色 值之间 的双向 转换
所 有这 些色 彩空 间 的 坐 标都 使 用 浮 点 数值 来 表示
 在 yiq  空 间 中 y  坐标 取值 为0和1 之 间而 i  和 q 坐标 均 可 以 为 正 数或 负数
 在所 有 其他空间 中坐 标 取值 均为0和1 之 间
 参 见有关 色 彩空 间的 更多信 息可 访问 httpspoynton
html  和 httpswww
colorsys  模块 定 义 了 如 下函 数 colorsys
rgbtoyiqr  g  b  把颜色 从 rgb  值转 为 yiq 值
yiqtorgby  i  q  把 颜色 从 yiq 值转为 rgb  值
rgbtohlsr  g  b  把 颜色从 rgb 值 转为 hls 值
hlstorgbh  l  s 把 颜色 从 hls 值 转为 rgb 值
rgbtohsvr  g  b  把颜色从 rgb  值转为 hsv 值
hsvtorgbh  s  v  把颜 色从 hsv  值转 为 rgb 值
示 例 import  colorsys  colorsys
compileall  bytecompile  python  libraries
commandline  use
 see  已缓存 字节码的 失效 for  more  information  on  how  python  validates  bytecode  cache  files  at  runtime
在3
2版 更改 added  the  i  b  and  h  options
 在3
5版 更改 added  the  j  r  and  qq  options
 q  optionwas  changed  to  a  multilevel  value
 b  will  always  produce  a  bytecode  file  ending  in 
 在3
7 版更 改 added  the  invalidationmode  option
在3
9版 更 改 added  the  s  p  e  and  hardlinkdupesoptions
public  functions
 在3
2 版更 改 added  the  legacy  and  optimize  parameter
在3
5版 更改 added  the  workers  parameter
在3
5版 更改 quiet  parameter  was  changed  to  a  multilevel  value
在3
5 版 更 改 the  legacy  parameter  only  writes  out 
pyc  files  not 
pyo  files  no  matter  what  the  value  of  optimize  is
在3
6 版更改 接 受 一 个类 路径 对象
 在3
7 版更改 the  invalidationmode  parameter  was  added
 在3
2 版更 改 the  invalidationmode  parameters  default  value  is  updated  to  none
在3
8 版更 改 setting  workers  to 0 now  chooses  the  optimal  number  of  cores
在3
9版 更改 added  stripdir  prependdir  limitsldest  and  hardlinkdupes  arguments
 default  value  of  maxlevels  was  changed  from 10 to  sys
3
2新版 功能
在3
5版 更改 quiet  parameter  was  changed  to  a  multilevel  value
 在3
5版 更改 the  legacy  parameter  only  writes  out 
pyc  files  not 
pyo  files  no  matter  what  the  value  of  optimize  is
 在3
7版 更改 the  invalidationmode  parameter  was  added
 在3
2版更改 the  invalidationmode  parameters  default  value  is  updated  to  none
 在3
9版更改 added  stripdir  prependdir  limitsldest  and  hardlinkdupes  arguments
 在3
2版 更改 added  the  legacy  and  optimize  parameter
在3
5版 更改 quiet  parameter  was  changed  to  a  multilevel  value
 在3
5 版 更改 the  legacy  parameter  only  writes  out 
pyc  files  not 
pyo  files  no  matter  what  the  value  of  optimize  is
 在3
7版 更 改 the  invalidationmode  parameter  was  added
 在3
2版 更改 the  invalidationmode  parameters  default  value  is  updated  to  none
pathlib  forcetrue 参 见模 块 pycompile  bytecompile  a  single  source  file
并 发执行
本 章中 描述 的 模块支持并 发 执行 代码
适当 的工具 选 择取 决 于要 执行 的任务 cpu  密集 型或 io 密 集型和 偏好 的开 发风格事 件驱 动的 协 作式多任务 或 抢占 式多任务 处理
这 是 一个 概述 threading  基 于线 程 的 并行 线程 本地数 据 线 程 对象 锁 对象 递 归 锁对 象 条件 对象信 号 量对 象 semaphore 例 子 事件 对 象 定 时器对 象 栅栏对象在 with  语句中 使用 锁、条 件 和信号量 multiprocessing  基于 进 程 的并 行概 述 process 类 上下 文和 启动 方 法 在 进 程 之 间交 换对 象 进程 间 同步 进 程间 共享 状 态使 用工作 进程参考 process  和异 常管 道和队 列杂 项连 接 connection 对 象同 步原 语 共 享 ctypes 对 象 multiprocessing
sharedctypes 模块 管 理 器 自定 义管 理 器使 用远 程管 理 器代 理对象 清理 进程 池监 听 器 及 客户 端 地 址格 式 认证 密码 日志 multiprocessing
dummy  模块 编 程指 导 所 有 start  方法 spawn  和 forkserver 启动 方式 示 例 multiprocessing
sharedmemory 可 从进程 直接 访问 的 共享 内 存 concurrent 包 concurrent
futures  启动 并行任 务 executor 对象 threadpoolexecutor  threadpoolexecutor  例子 processpoolexecutor  processpoolexecutor  例 子 future 对 象 模块函 数 exception  类 subprocess 子进程管 理使 用 subprocess  模块 常用 参 数 popen 构 造 函数异常 安全考量 popen  对象 windows  popen  助 手 windows 常 数较旧的 高阶 api  使用 subprocess  模 块替换 旧函 数替 代 binsh  shell  命令 替 换 替代 shell 管 道替 代 os
system 替代 os
spawn 函 数族 替代 os
popen 3 来自 popen 2模块 的替 代 函数 旧式的 shell 发 起 函数 注释 在 windows  上将 参 数 列表转换为一 个 字符 串 sched  事件 调 度器 调 度 器对 象 queue 一 个 同步 的 队 列 类 queue 对象 simplequeue 对 象以下是上述某些 服务 的 支持模块 thread 底层多线 程 api
concurrentfutures  启动 并行任 务
3
2 新版 功 能
源码 libconcurrentfuturesthread
py  和 libconcurrentfuturesprocess
pyconcurrent
futures 模块提供异步执 行 回调 高 层 接 口
异步 执行 可以 由 threadpoolexecutor 使 用 线程或 由 processpoolexecutor 使 用单 独的进 程来 实现
两者都是实现 抽像类 executor 定 义的 接口
executor  对 象
threadpoolexecutor
threadpoolexecutor 例 子
processpoolexecutor
processpoolexecutor 类 是 executor 的 子类 它使用进程池来异 步 地执行 调 用
 processpoolexecutor 会使 用 multiprocessing 模 块这 允 许它绕过全局解释 器 锁 但也 意 味着 只 可以处 理和返 回可封 存的 对象
main  模 块必 须可以 被工作者 子进程 导入
这 意味着 processpoolexecutor  不可以 工 作在交互式解释器 中
从 提交 给 processpoolexecutor 的回 调中调用 executor  或 future 方法 会导致 死锁
在3
3 版更改 如 果 其中 一 个工作进程被突然 终止 brokenprocesspool 就会 马上触 发
 可 预 计的 行为 没有 定义 但 执行 器上 的操 作 或它的 future 对象 会被 冻结 或死 锁
 在3
7版更改 添加 mpcontext  参 数 允许用 户控 制由 进程 池创建给 工 作 者 进 程 的 开 始方 法
 加入 initializer  和 initargs  参 数
processpoolexecutor 例 子
future  对象
模 块 函 数
exception  类
cancellederror  future  对象被 取消 时会 触 发
timeouterror  future  对 象 执 行 超出 给定的 超时 数值时 引 发
brokenexecutor  当执行 器被 某些 原因 中 断而 且 不能 用来提 交或 执 行 新 任务时 就会 被 引发派生于 runtimeerror  的异常 类
3
7新版 功能
invalidstateerror  当某 个操 作在 一个当 前 状态 所不允许 的 future 上 执行 时 将被 引 发
3
8新 版 功 能
brokenthreadpool  当 threadpoolexecutor  中的 其 中 一个工 作者初 始 化失 败时 会 引 发派生 于 brokenexecutor 的异 常 类
3
7新版 功能
brokenprocesspool  当 threadpoolexecutor 中 的 其 中 一个 工 作 者 不完 整 终止 时比 如 被外 部杀 死会引 发派 生于 brokenexecutor  原名 runtimeerror 的 异常 类
3
3新 版功能
concurrent  包
 目 前 此包中只有 一 个模 块 concurrent
futures ——启动 并行任务
configparser  配置文 件解析 器
源 代 码 libconfigparser
py 此模 块 提 供了 它 实 现一 种基本 配置 语 言 configparser  类 这 种 语言 所提 供的 结 构 与 microsoft  windows  ini  文 件 的 类 似
你 可 以 使 用这种语 言来 编 写能 够由 最终用 户 来自定 义 的 python 程 序
 注 解 这个库并不 能够 解析或 写入 在 windows  registry 扩 展版本 ini  语法 中所使 用的值 类 型前 缀
 参见 模块 shlex  支持创 建可 被 用作应 用 配置文件的 替 代 的 unix 终 端 式微 语 言
模 块 json  json 模 块 实现 了一 个 javascript 语 法的 子 集 它 也 可被 用 于 这 种目 的
 快速起 步
让 我们 准 备一 个 非常 基本 的配 置 文件 它 看起来 是这 样的 default  serveraliveinterval 45 compression  yes  compressionlevel 9 forwardx 11 yes  bitbucket
com  port 50022 forwardx 11 noini  文件 的结 构 描述见以 下 章节
 总的来说 这种 文 件 由 多个 节 组成 每个 节 包含 多个 带有 值的 键
 configparser  类可 以读取 和写 入这 种文 件
 让 我 们先通 过 程序 方式来 创建 上 述 的配 置 文 件
如 你 所见 我们 可以 把 配 置解析 器当 作一 个字 典来 处 理
两 者确 实 存 在 差异将在 后文 说明但 是 其行 为非常接 近于字典所 具 有 一般 行为
 现 在 我们 已 经创 建 并 保 存 了一 个配 置 文 件 让我 们 再 将它 读取 出 来并探究 其 中包 含的 数 据
orgforwardx 11 yes 正 如 我 们在 上 面所 看 到的 相 关的 api 相 当 直观
 唯一 有些 神奇 的 地 方是 default  小节 它为 所有其 他小 节提 供了 默认 值1
还 要注意 小节 中 的键 大小 写 不 敏感 并且 会存 储为 小写 形式1
 支 持 的数 据类 型
配置解 析器 并不 会 猜测 配置文件 中 值的 类型 而总 是将它们 在内部 存储 为 字符串
 这意 味着如 果你需要 其他 数 据类 型 你 应当 自己 来转换 inttopsecretport 50022 floattopsecretcompressionlevel 9
0由 于这 种 任务 十分 常用配 置解 析器 提 供 了一 系列便 捷的 获取 方法 来处 理 整数、浮 点 数和布尔 值
最 后 一 个 类型的 处理 最为 有 趣 因 为简 单地 将值 传给 bool  是没 有用的 boolfalse  仍然会 是 true
为 解决 这个 问题 配置 解析 器还 提 供 了 getboolean
 这个 方 法对大小 写不 敏感 并可识别 yesno  onoff  truefalse 和101 等 布尔值
例 如 topsecret
org  compression  true  除了 getboolean  配置 解 析器 还 提供 了同 类 的 getint  和 getfloat 方法
 你可 以注册 你自己 的 转换 器并 或是定 制已 提 供的转 换器
1
 回退 值
 与字 典 类似你 可以 使 用 某个 小节 的 get 方法来 提供 回退 值 topsecret
getcipher 3 descbc 3 descbc  请注 意默 认 值会 优 先 于 回 退 值
 例如 在我 们的示 例中 compressionlevel 键仅 在 default  小 节 被 指 定
如果 你 尝试 在 topsecret
com 小 节 获取 它我 们将总是获 取到默认 值 即使我 们 指 定 了一 个 回 退 值 topsecret
getcompressionlevel 39还 需要注 意的 一 点是 解析 器层级的 get  方法提 供 了 自 定义 的更 复 杂接 口 它被 维护 用 于向下兼 容
当使 用此方 法 时回退 值 可 以 通 过 fallback  仅限关 键字 参 数来 提供 config
 fallbackno  such  things  as  monsters  no  such  things  as  monsters 同样 的 fallback  参 数也可在 getint  getfloat 和 getboolean  方 法 中 使 用 例如 batchmode  in  topsecret  false  topsecret
受支持 的 ini 文 件结 构
配 置文 件 是由 小节 组 成的 每 个 小节都 有 一 个 section 标头 加上多 个由 特 定字 符 串 默 认为或1分 隔的键值 条 目
 默认 情况 下小 节名对大小 写 敏感 而键 对大 小写 不敏 感1
键 和值开 头和末尾 的空格 会 被 移除
值 可 以被 省略 在此情况 下键 值 分 隔符也 可以 被省略
 值还可 以 跨 越多 行只要 其他 行带 有比 值的第一行 更深 的 缩 进
 依据 解析器 的 具 体 模 式空 白行 可 能被视 为多 行值 的 组 成部 分也可 能 被忽 略
 配 置文 件可 以包 含注 释 要带 有指 定 字符 前缀 默认 为和1
 注释 可以 单独 出现 于原 本的 空白行并 可使 用缩 进
1 例 如 simple  values  keyvalue  spaces  in  keysallowed  spaces  in  valuesallowed  as  well  spaces  around  the  delimiter  obviously  you  can  also  use  to  delimit  keys  from  values  all  values  are  strings  values  like  this 1000000 or  this 3
 值 的 插值
 在核心 功能 之上 configparser  还支 持 插 值
 这 意 味 着 值可 以在 被 get 调用 返回之 前进 行 预 处 理
basicinterpolation 默 认实现 由 configparser  来使用
 它允 许值 包 含引 用 了相 同小 节中其 他 值或 者 特殊的 默认 小节 中的 值的格 式字 符串1
 额外 的默 认 值可 以在初始化 时提 供
例 如 paths  homedir  users  mydir  homedirslumberjack  mypictures  mydirspictures  escape  gain 80 use  a  to  escape  the  sign  is  the  only  character  that  needs  to  be  escaped  在上 面的例子里 configparser  的 interpolation 设 为 basicinterpolation  这会 将 homedirs  求解 为 homedir 的值在 这 里是 users
 mydirs  的将 被实际 求 解 为 userslumberjack
 所 有插 值都是按 需进 行的 这样引 用链中使 用的 键不 必以 任何 特定 顺序在配 置文 件中指 明
当 interpolation  设为 none 时 解析 器 会简单 地返 回 mydirspictures 作为 mypictures 的 值并 返回 homedirslumberjack 作 为 mydir 的 值
extendedinterpolation  一 个 用于插 值的替 代 处理 程 序实 现了 更高 级的 语法它 被 用于 zc
buildout  中的 实例
 扩展插 值使 用 sectionoption 来表 示来 自 外部 小节 的 值
 插值 可以 跨越多个 层 级
 为 了方 便使 用 section 部 分可被 省 略插 值 会默认作 用 于当 前 小 节 可 能 会 从 特 殊 小 节 获 取 默认 值
 例 如 上 面 使用 基本插 值描述 的 配置 使用 扩展 插值 将是 这 个 样 子 paths  homedir  users  mydir  homedirlumberjack  mypictures  mydirpictures  escape  cost 80 use  a  to  escape  the  sign  is  the  only  character  that  needs  to  be  escaped 来 自其 他小节的 值 也 可以 被 获 取 common  homedir  users  librarydir  library  systemdir  system  macportsdir  optlocal  frameworks  python 3
映 射协 议访 问
 定 制解析器行 为
 旧 式 api  示 例
主要 出 于向下 兼容性 的考 虑 configparser  还 提供 了一 种采 用 显式 getset 方 法 的 旧式 api
虽 然以 下介绍 的方 法 存在有 效的 用 例 但 对 于新 项 目 仍 建 议 采用 映射 协议 访问
 旧 式 api  在 多数 时候都 更复 杂、更 底 层并 且 完 全 违 反直 觉
 一个 写入 配 置文件 的 示 例 import  configparser  config  configparser
writeconfigfile  一 个 再次 读取配 置文 件 的示例 import  configparser  config  configparser
getsection 1 foo 要 获取 插值请使 用 configparser  import  configparser  cfg  configparser
getsection 1 monster  fallbacknone  none 默 认 值在两 种 类 型 的 configparser 中 均可用
 它们 将在当某个 选 项未在 别 处 定义 时被 用于插值
configparser 对 象
defaultsect  interpolationbasicinterpolation  converters  主配 置 解析器
 当给 定 defaults  时它 会被 初 始化为包 含固有默认 值的 字 典
当 给 定 dicttype 时它 将被 用来创 建包 含节、 节中 的选项 以 及默 认 值的 字 典
 当给 定 delimiters 时它会被 用作 分隔键 与值 的子 字符 串的 集合
 当给 定 commentprefixes 时 它 将被 用作在 否则 为空 行 的注释的 前 缀子 字符 串的集 合
注释可 以被 缩进
 当 给 定 inlinecommentprefixes 时 它 将 被 用作 非空 行的 注释 的 前缀子字 符 串的 集合
当 strict  为 true 默 认 值时 解 析器在 从单 个 源文 件、 字符 串 或字典 读取时 将 不 允 许 任 何节 或选项 出现 重 复否 则 会引 发 duplicatesectionerror 或 duplicateoptionerror
当 emptylinesinvalues  为 false  默 认 值 true  时每个 空行均 表 示 一 个选 项的 结 束
 在其他 情 况下 一个 多行选 项 内 部的 空行 会被 保留 为 值 的 一 部 分
当 allownovalue  为 true  默 认值 false  时将 接受 没 有值 的 选项此 种选项 的 值将 为 none 并 且 它们 会 以不 带末尾 分隔 符的形 式 被 序列化
 当 给定 defaultsection  时 它将指定 存 放其 他节 的默 认值 和 用于 插值的 特殊 节的名称 通 常命 名为 default
该 值 可通 过使 用 defaultsection  实例 属性在 运 行时被 读取 或 修 改
插值行 为 可通 过给 出 interpolation 参 数提 供 自 定 义处 理 程序的 方 式 来定 制
 none 可 用来 完全禁 用插值 extendedinterpolation 提 供了一 种更 高级 的变 体形 式它 的 设计 受到 了 zc
buildout 的启发
有 关该 主 题的更 多信 息 请参 见 专 门 的 文 档 章 节
 插 值中 使用 的所 有选 项 名称将 像任 何 其 他 选项 名称 引用 一样通过 optionxform  方法 来传递
 例如 使 用 optionxform 的默 认 实现 它会 将 选 项名称转 换为小 写形 式时 值 foo  bars  和 foo  bars  是等 价的
 当 给 定 converters 时 它 应 当 为一 个 字典其 中 每 个键 代 表 一 个 类型转换 器的 名称 而每 个 值则 为实 现从 字符串 到目 标数 据类 型的 转 换的 可调 用 对象
 每 个转 换 器会 获得 其 在解 析器 对象 和节 代理 上 对 应的 get  方法
 在3
1版 更改 默 认 的 dicttype 为 collections
在3
2 版 更改 添加了 allownovalue  delimiters  commentprefixes  strict  emptylinesinvalues  defaultsection  以及 interpolation
 在3
5版 更改 添加 了 converters 参数
 在3
7 版更 改 defaults 参 数会通过 readdict  来读取 提供全解 析 器 范 围 内 一致 的行 为非 字 符串类 型 的键和 值 会 被隐式地 转 换为 字符 串
在3
8版 更改默 认的 dicttype  为 dict  因为 它现在会 保 留插入 顺序
 defaults  返 回包 含实例 范围 内 默认 值的 字典
 sections  返回 可用节的列 表 default  section 不 包 括在该 列表中
 addsectionsection 向 实 例 添加 一 个名 为 section  的节
 如果 给 定名 称的 节 已 存在将 会 引发 duplicatesectionerror
 如 果传入了 default  section  名 称则会 引发 valueerror
节 名称必须 为字符串如 果不 是 则 会引 发 typeerror
在3
2版更改非 字 符 串的 节 名 称将引发 typeerror
 hassectionsection 指明 相 应 名称 的 section 是否存在于 配 置 中
 default  section 不 包 含 在 内
 optionssection 返回指定 section 中 可用 选 项的 列表
 hasoptionsection  option 如果给 定的 section 存 在并 且包含 给定 的 option 则返 回 true 否 则 返回 false
 如 果指 定的 section  为 none 或 空字 符串 则会 使用 default
 readfilenames  encodingnone  尝 试 读取 并解 析一 个包 含文件名的可 迭 代对 象返 回一个 被成 功解析的 文 件名列表
 如 果 filenames 为 字符 串、 bytes 对象 或 pathlike  object 它会 被 当 作 单个 文件 来处理
如 果 filenames 中 名称对 应的某 个文 件无法 被打 开 该文 件 将被 忽略
 这样 的设 计使 得你 可以 指 定 包含 多个 潜在 配置 文件位置的可 迭 代对 象例 如当前 目 录、用 户家 目录 以 及某 个系 统级 目录 存在于该 可迭代 对象 中的所 有配 置文 件 都将 被 读取
 如果 名 称 对应 的文 件全 都 不 存在 则 configparser  实 例 将包含 一个 空数据 集
一 个要 求 从文 件 加载 初始 值的 应用 应当 在调 用 read 来 获取任何可选 文件之 前 使用 readfile  来加载 所 要求的一个或 多个文 件 import  configparser  os  config  configparser
cfg  encodingcp 12503
2新 版功 能 encoding 形参
 在之 前的版 本中 所 有文 件 都将 使用 open  的默 认编 码格 式来 读取
3
1 新 版 功能 filenames  形参 接受 一个 pathlike  object
3
7 新版功能 filenames 形参 接 受一 个 bytes 对 象
 readfilef  sourcenone 从 f 读 取并解析 配置 数 据它 必 须 是一 个 产 生 unicode 字 符串 的可迭代 对象 例如 以 文本模 式打开 的文件
可 选 参 数 source 指 定要 读 取的 文 件 名 称
如果未给 出 并 且 f  具有 name  属性 则该 属性 会被用 作 source 默认值 为
3
2新版 功 能 替代 readfp
 readstringstring  sourcestring 从 字 符串 中 解 析配 置 数据
 可选 参 数 source 指定一 个 所传 入字符串 的上 下文 专 属 名称
 如 果 未 给 出则 会使 用 string
这通常 应 为一 个 文 件 系统 路径或 url
3
2 新版 功能
 readdictdictionary  sourcedict  从任 意一 个 提 供 了 类似于 字典的 items 方 法的对象 加载配 置
键 为 节名称值 为 包含节中所 出现的 键 和值的 字 典
如果所用 的字 典类型 会保留 顺 序则节 和其中的键 将按 顺序 加入
 值会被 自 动转换 为字符串
 可选参 数 source 指 定 一个 所传入字 曲的上下文 专 属 名 称
 如 果未给 出 则会使 用 dict
此方法可 被用 于在 解析器之 间拷贝状 态
3
2新 版 功 能
 getsection  option  rawfalse  varsnone  fallback 获取 指 定名称的 section  的一 个 option  的 值
 如果 提供 了 vars 则它必须 为一 个字典
 option  的查找顺 序为 vars 如果有 提 供、 section 以 及 defaultsect
如果未 找到该键 并且提供 了 fallback  则它 会 被 用作回 退值
可以 提供 none  作为 fallback 值
所 有插 值 会 在 返回 值中被 展开 除非 raw 参数 为真 值
插 值 键所 使用的值 会按 与选 项 相 同 的方式 来查 找
在3
2版 更 改 raw  vars 和 fallback  都是 仅 限关键字 参数 以 防止 用 户试图 使 用第 三 个 参 数作业为 fallback  回退 值特 别是在 使用 映 射协 议的 时候
 getintsection  option  rawfalse  varsnone  fallback  将在 指定 section  中的 option 强制 转换 为 整数的 便捷方 法
参 见 get 获取对 于 raw  vars  和 fallback  的解释
 getfloatsection  option  rawfalse  varsnone  fallback 将 在指 定 section 中 的 option  强 制 转换 为浮 点 数的便 捷 方法
 参见 get 获 取对于 raw  vars  和 fallback 的解释
 getbooleansection  option  rawfalse  varsnone  fallback  将在指 定 section 中的 option 强 制转 换 为 布尔值 的便 捷 方法
请注 意选项 所接 受的值 为1 yes  true 和 on 它 们会 使得此 方 法返 回 true  以及0 no  false  和 off 它们 会使 得此方法 返 回 false
 这些字符 串值 会以 对 大 小 写不敏 感的 方式 被 检 测
任何 其 他 值 都将 导 致引 发 valueerror
参 见 get  获取 对于 raw  vars  和 fallback 的 解释
 itemsrawfalse  varsnone  itemssection  rawfalse  varsnone 当 未给 出 section 时 将返 回 由 sectionname  sectionproxy 对 组成 的 列表 包 括 defaultsect
在其 他情况 下将 返回给 定 的 section 中 的 option 的 name  value  对 组 成 的列 表
可 选参 数具有 与 get 方 法的参 数相 同的 含 义
在3
8 版更 改 vars  中的 条目 将不 在结果 中出 现
之 前的 行 为混 淆了 实 际的 解 析器选 项和为 插值 提供的 变 量
 setsection  option  value 如 果给 定 的 节 存在 则将 所给 出的选 项设 为指定 的值 在其 他情 况 下将引 发 nosectionerror
 option 和 value 必须 为字符串 如果不 是则将 引发 typeerror
 writefileobject  spacearounddelimiterstrue  将配 置的 表示 形式写 入 指 定 的 file  object 该对 象必须 以文 本模式打开 接 受字符 串
此 表 示形式 可由将来 的 read 调用进 行解析
 如果 spacearounddelimiters 为 真值 键和 值之 前的 分隔符 两 边 将 加上空 格
 removeoptionsection  option 将指 定的 option  从指定的 section 中 移 除
如果 指定的 节不存 在 则会 引发 nosectionerror
 如 果要移除的选 项 存在 则 返回 true 在 其他情况下将 返 回 false
 removesectionsection  从配置 中移除 指定 的 section
 如果 指定 的 节确 实存在 则 返回 true 
在 其他情 况下 将返回 false
 optionxformoption 将 选项名 option  转 换为 输入 文件 中的 形 式 或 客户端 代码 所传 入 的应当 在 内部 结 构中 使 用 的 形式
 默 认 实现 将返 回 option 的 小 写 形 式 版 本 子类 可 以 重载 此 行 为或 者客户端代 码也 可以在 实 例上设 置 一 个 具 有 此名称的属 性来 影响 此行为
 你不 需要子 类化 解 析器来使 用 此方 法你 也可 以 在一个实 例 上 设 置它 或 使用 一 个接受字 符 串 参数 并 返回字符 串 的 函数
 例 如将它设 为 str  将 使 得选 项 名称 变 得大小写 敏 感 cfgparser  configparser  cfgparser
optionxform  str  请注 意 当读 取 配置文件 时 选项 名称 两 边的空格 将 在 调 用 optionxform 之 前被 去 除
 readfpfp  filenamenone 3
2版后已 移除 使用 readfile  来 代 替
在3
2 版更 改 readfp  现在将在 fp  上执行 迭代 而不 是调用 fp
对于调 用 readfp 时传 入不支 持迭 代的 参数 的 现 有代 码 可 以 在 文件 类对 象外 使用 以下生 成器 作为 包 装器 def  readlinegeneratorfp  line  fp
readline  不 再使 用 parser
readfpfp  而是改用 parser
maxinterpolationdepth  当 raw 形 参 为 假 值 时 get  所采 用 的 递归插 值的最 大深度
 这只 在使 用 默 认 的 interpolation  时会 起 作 用
rawconfigparser 对 象
defaultsect  interpolation 旧 式 configparser
 它默 认禁 用插 值并 且允许 通过不 安全的 addsection  和 set 方 法以及 旧式 defaults 关 键字参 数 处 理 来设 置非 字 符 串的节名、 选项名和 值
 在3
8版 更改 默认 的 dicttype 为 dict  因 为 它现 在会 保留 插入顺序
 注 解 考虑 改用 configparser 它会 检查 内部保 存 的值的 类 型
 如 果你 不想要 插值 你 可以 使用 configparserinterpolationnone
 addsectionsection  向实 例添 加一 个 名 为 section 的 节
如 果给定名 称的节 已 存 在 将 会引 发 duplicatesectionerror
 如果 传 入了 default  section  名称 则 会引发 valueerror
 不 检查 section  以 允许 用 户 创 建以 非 字 符 串命名的 节
 此行 为 已不 受 支 持 并可能 导致 内 部 错误
 setsection  option  value  如果 给定的节 存 在 则 将给定 的 选项 设 为 指定 的值 在 其他情 况下 将 引发 nosectionerror
 虽 然 可 能使 用 rawconfigparser  或 使用 configparser  并将 raw 形 参 设 为真 值以 便实现 非 字符 串 值 的 internal 存储 但是 完 整功能包括插 值 和 输 出 到文件只能使 用字符串 值来 实现
 此 方 法允许 用户在内部将 非字符 串 值赋 给键
此 行 为已 不受支持并会 在尝试写 入到 文 件 或 在 非 原 始模 式下获取数据 时 导 致 错 误
请 使 用 映射 协 议 api  它 不 允 许出现 这样的赋值
异 常
 内 置 常 量
 由 site 模 块添 加 的 常量
site  模块在启 动期 间自动导入除 非给出 s  命 令 行 选项 将 几 个常 量添 加 到内 置命名空 间
它们 对 交互 式解 释器 shell 很 有用 并且不 应在 程 序中 使 用
quitcodenoneexitcodenone 当 打印 此对 象时 会打 印出 一条 消 息 例如 use  quit  or  ctrld  i
 eof  to  exit  当调 用此 对象 时将使用指定 的 退出 代码 来引发 systemexit
copyrightcredits  打印 或调用的对象 分别 打印版权或作 者 的 文本
license 当 打印 此对象 时会打 印 出 一条消息 type  license  to  see  the  full  license  text 当调 用 此 对象时 将以分页形式 显示完 整的 许可 证文本每次显 示 一 屏
contextlib  为 with  语句上下文提 供的工具
 源代 码 libcontextlib
py 此 模 块 为涉及 with  语句的常见任 务提供 了 实用的 工 具
更 多信息 请参见 上下文管 理器 类 型和 with  语 句 上 下文 管理器
工具
例 子 和 配 方
supporting  a  variable  number  of  context  managers
catching  exceptions  from  enter  methods
cleaning  up  in  an  enter  implementation
replacing  any  use  of  tryfinally  and  flag  variables
using  a  context  manager  as  a  function  decorator
 参见 pep 343 with  语 句 python  with  语句 的 规 范 描 述、 背景 和示例
single  use  reusable  and  reentrant  context  managers
reentrant  context  managers
reusable  context  managers
contextvars  上 下文 变量
本模块提 供了相 关 api  用 于 管理、 存储 和访 问上 下 文相 关 的状 态
 contextvar  类用 于声 明上下文变量 并与其一 起 使 用
函数 copycontext  和 类 context  用 于管 理 当 前 上下 文 和异步 框 架 中
 在 多 并 发 环境中 有 状 态上 下文 管理 器 应 该 使 用上 下文 变量而 不 是 threading
local 来 防止 他 们的 状态意外 泄 露到其 他 代码
 更多 信息 参见 pep 567
3
7 新 版 功 能
 上下文 变量
 手动上 下文管理
asyncio  支持
 上下 文变 量在 asyncio 中有 原生 的支 持 并且无 需任 何额 外配置即 可被 使 用
 例 如以 下是一个 简单 的 回显服 务器它 使用上下文 变 量来 让远 程客户端 的 地址在处 理 该客户端 的 task 中可 用 import  asyncio  import  contextvars  clientaddrvar  contextvars
copy 浅层 shallow 和 深层 deep  复 制 操作
copyreg  注 册配 合 pickle 模块 使 用 的 函数
 源 代码 libcopyreg
pycopyreg 模块 提供了可 在封 存特 定对象时 使 用的一种定 义 函数 方式
pickle  和 copy 模 块会在 封 存拷 贝特 定 对象时 使用 这些函 数
此 模块提 供 了 非 类 对 象构 造 器的 相 关 配置 信息
 这 样的 构 造器 可 以是工 厂函 数或类 实 例
constructorobject 将 object 声明 为一个 有效 的构 造器
 如果 object  是不 可调 用的 因而 不 是一 个有 效的 构造 器 则会 引 发 typeerror
pickletype  function  constructornone  声明该 function  应当 被用 作 type  类型对象 的归约函数
 function  应 当返 回 字符 串或包 含 两到 三个 元素 的元 组
 如果提供了 可 选的 constructor  形参 它 应当是一个 可 用 来重建相 应对 象的 可 调用对 象在 调用 该对 象时应 传入 由 function 所 返回的参数元 组
 如 果 object  是一 个类 或 constructor  是 不可 调用 的 则将引发 typeerror
请 查 看 pickle  模 块了 解 function 和 constructor  所 要 求的 接口 的 详情
 请注意 一个 pickler 对 象或 pickle
pickler 的 子类 的 dispatchtable 属性 也可以被 用来声明归 约 函数
 示例
 以下 示例将会 显 示 如何 注册 一 个 封 存函 数以 及如 何来 使 用 它 import  copyreg  copy  pickle  class  c
crypt  function  to  check  unix  passwords
hashing  methods
3
3新 版功能
3
7 新版功 能
module  attributes
3
3 新 版功能
 模块 函数
 在3
3 版 更 改 accept  crypt
method  values  in  addition  to  strings  for  salt
3
3新版 功能
在3
7 版更 改 added  the  rounds  parameter
示 例
加密服 务
本 章 中 描 述的模 块实现 了 加 密性质 的各 种算 法
它 们可以在 安装 时自行 选择
 在 unix  系 统 上 crypt 模 块 也 可以 使用
 以下 是为 内容 概要 hashlib  安全 哈希 与 消 息摘 要 哈 希算 法 shake 可变 长度 摘 要密钥 派生 blake 2创 建哈 希对 象常数 示 例 简单哈 希使 用不 同的 摘要大小 密钥 哈希随 机哈 希 个 性 化树 形 模 式开 发人 员 hmac 基 于 密钥 的消 息验 证 secrets 生成 安全 随机 数 字用于管理 密 码 随机 数 生成 凭 据凭据 应当使 用多 少个字 节？ 其 他 功 能 应用技巧 与最佳 实践
csv  csv 文 件读 写
 模块 内 容
变种与格 式 参 数
reader  对象
writer  对 象
示 例
 读 取 csv  文件 最简 单 的一个 例 子 import  csv  with  opensome
readerf  for  row  in  reader  printrow 读取 其 他 格 式的文 件 import  csv  with  openpasswd  newline  as  f  reader  csv
quotenone  for  row  in  reader  printrow  相应 最简 单的 写入 示例 是 import  csv  with  opensome
writerowssomeiterable 由 于使用 open  来 读 取 csv 文 件因此 默认情况 下 将使用 系 统默认 编 码来解 码 文件并 转换为 unicode  请参 阅 locale
getpreferredencoding
 要使 用其 他 编码 来解 码文 件请 使用 open  的 encoding  参数 import  csv  with  opensome
readerf  for  row  in  reader  printrow  这同样 适用于 写 入非 系 统默 认编 码 的内 容打 开输 出 文 件时 指定 encoding  参数
 注册 一 个 新的 变 种 import  csv  csv
readerf  unixpwdreader  的更 高级用 法——捕 获并报 告错 误 import  csv  sys  filename  some
linenum  e  尽管该 模 块 不直接 支 持解 析字 符串但 仍可 如下轻 松 完成 import  csv  for  row  in  csv
readeronetwothree  printrow 脚注1 如 果 没 有指 定 newline 则 嵌 入 引号中 的换 行符将 无法 正确解 析并 且在写 入时使用 rn  换行的 平台会有多 余的 r 写 入
由 于 csv 模 块会 执行自 己 的 通 用 换行 符处理 因此 指定 newline  应该总 是 安 全 的
ctypes  python 的 外部 函数 库
ctypes  是 python 的 外部函 数 库
它 提 供 了与 c  兼 容的数据 类 型并允 许调用 dll  或共 享 库 中的 函 数
可使 用该 模块 以 纯 python 形 式对 这 些库 进 行封 装
ctypes 教 程
注 意 在本教 程中 的 示例 代 码 使用 doctest  进 行过 测试 保 证 其 正确 运 行
由 于有 些代码 在 linuxwindows 或 mac  os  x 下 的 表现不 同这 些 代 码会在 doctest  中包含 相 关 的 指 令注 解
 注 意部 分 示例代码 引 用 了 ctypes  cint 类 型
在 sizeoflong  sizeofint  的 平台 上 此类型 是 clong  的一个 别 名
 所 以 在程序 输 出 clong 而 不是 你 期 望的 cint 时不 必 感到 迷惑它 们实 际 上 是 同一 种 类 型
 载入 动态 连接 库
 操作导 入的 动 态 链 接 库 中的 函数
 调 用函 数
基 础 数 据类 型
ctypes 定义了 一 些 和 c  兼 容 的 基 本 数据 类型 ctypes  类型 c  类型 python  数 据 类型 cbool  bool  bool 1 cchar  char  单字 符 字节 串对 象 cwchar  wchart 单字 符字 符串 cbyte  char  int  cubyte  unsigned  char  int  cshort  short  int  cushort  unsigned  short  int  cint  int  int  cuint  unsigned  int  int  clong  long  int  culong  unsigned  long  int  clonglong  int 64 或 long  long  int  culonglong  unsigned  int 64 或 unsigned  long  long  int  csizet  sizet  int  cssizet  ssizet  或 pyssizet  int  cfloat  float  float  cdouble  double  float  clongdouble  long  double  float  ccharp  char  nul  terminated  字节 串对 象或 none  cwcharp  wchart  nul  terminated  字 符 串或 none  cvoidp  void  int  或 none 1
构 造 函 数 接 受任 何 具 有真值的 对象
 所有 这些类 型都 可 以 通过 使用正 确类型和 值的 可 选 初始 值调 用它 们来 创建 cint  clong 0 cwcharphello  world  cwcharp 140018365411392 cushort 3 cushort 65533由 于这些 类型是 可变的 它 们 的值 也可 以 在 以后 更 改 i  cint 42 printi  clong 42 printi
value 99 当 给指 针类型 的 对象 ccharp  cwcharp  和 cvoidp 等赋值 时将改 变它 们所 指向的 内 存 地址 而 不 是它 们 所指 向 的内 存区域 的内容这 是理 所 当 然的 因为 python 的 bytes  对象 是 不可 变的 s  hello  world  cs  cwcharps  printcs  cwcharp 139966785747344 printcs
value  hi  there  prints  first  object  is  unchanged  hello  world 但 你要 注意不 能将 它们 传 递给会 改变 指针 所指 内存的函 数
如 果你需 要 可改 变的 内存 块 ctypes 提 供 了 createstringbuffer 函 数它 提供 多种方式创 建这 种 内存 块
当 前的内 存 块内容 可以 通 过 raw 属性 存取如 果你 希望 将它 作 为 nul 结 束 的 字 符 串 请使 用 value 属 性 from  ctypes  import  p  createstringbuffer 3 create  a 3 byte  buffer  initialized  to  nul  bytes  printsizeofp  reprp
raw 10 bhix 00 lox 00 x 00 x 00 x 00 x 00 createstringbuffer 函数 替代以 前 的 ctypes 版 本中 的 cbuffer 函 数 仍 然 可 当 作别 名使用 和 cstring 函 数
createunicodebuffer 函数 创 建包含 unicode  字符 的可 变内 存块 与之 对应 的 c 语 言类型 是 wchart
 调 用 函数 继 续
使 用自 定 义的数 据类型 调用 函 数
指 定 必选 参数的 类 型 函 数原型
 可 以 通过 设置 argtypes  属性的 方法指 定从 dll  中导 出 函 数的必 选参 数类 型
argtypes 必须是一 个 c 数据 类 型的序 列 这里 的 printf  可能 不是个 好 例子因 为它 是变长 参数而且每个 参数 的 类 型依 赖于 格 式化 字符串 不过 尝 试 这个 功能 也很方 便 printf
20000037 指定 数据 类型 可以 防 止不 合 理的 参 数传 递 就像 c 函数 的原 型并 且会 自 动 尝 试 将参 数 转换 为 需要的 类 型 printfbd  d  d 123 traceback  most  recent  call  last  file  stdin  line 1 in  module  argumenterror  argument 2 exceptions
00000013如 果 你想 通过 自定 义 类 型 传 递 参 数给 函数 必须 实 现 fromparam  类方 法 才能 够将此 自定 义类 型用 于 argtypes  序 列
fromparam 类 方法接受 一 个 python  对象 作为 函 数输 入它 应 该进行类型 检 查或 者其 他必 要 的 操作 以保证 接 收 到 的 对象 是合法 的然后 返回 这个对象 或者它 的 asparameter  属 性或 者 其 他 你想要 传递 给 c 函 数的 参数
这里 也一 样 返 回 的结 果必 须 是整 型、 字 符串、 二进 制字 符 串、 ctypes 类型或 者一个 具有 asparameter  属性 的 对象
返回 类 型
传 递 指针 或以 引用方式 传 递形参
结 构 体和 联 合
结 构体 联合字段 对齐 及字 节顺 序
默认 情况 下 结 构体 和联合 的字 段与 c  的 字节 对齐 是 一样 的
 也 可以在 定义 子 类 的时候 指 定 类的 pack 属 性来 覆盖 这 种 行 为
它必须 设 置为 一个 正整 数表 示 字 段 的 最大对 齐字 节
 这和 msvc  中 的 pragma  packn 功能 一样
ctypes 中的 结构 体 和联 合 使用的 是本地字 节序
 要 使用 非 本地字 节序可以 使用 bigendianstructure  littleendianstructure  bigendianunionand  littleendianunion  作 为 基类
这 些类不能 包含 指 针字 段
结构体 和联合中 的位 域
 结构 体和联 合中是可 以 包 含位域字 段的
位域 只能 用 于整 型字段 位长度通 过 fields 中 的 第 三个 参数指定 class  intstructure 
 数组
指针
 可以 将 ctypes 类型 数据 传入 pointer 函数 创建 指 针 from  ctypes  import  i  cint 42 pi  pointeri 指 针 实 例 拥有 contents  属性 它 返 回指 针 指 向 的真 实对象如 上面 的 i 对象 pi
contents  clong 42 注 意 ctypes 并没有 oor  返回 原 始 对 象每 次访问这 个 属 性时都会 构 造 返 回一个新 的相 同 对 象 pi
contents  false  将这 个指针的 contents  属 性赋值为 另一 个 cint  实 例 将会 导致该指 针 指向该 实例 的内 存地 址 i  cint 99 pi
contents  clong 99指针对 象 也可以 通 过 整数下 标进 行访 问 pi 099通 过 整 数下 标赋 值 可以改 变指 针所 指向 的真实内 容 printi  clong 99 pi 022 printi  clong 22 使用0以 外 的 索引也 是合 法的 但是 你 必 须确 保知 道自己 为 什 么 这 么做 就 像 c  语言中 你可 以 访 问或 者修 改 任 意 内存 内容
 通常只 会在 函数接收 指针 是才 会使用 这种 特性而且 你知 道 这 个 指 针指向的 是一 个 数 组 而 不是 单个 值
内 部 细 节 pointer  函数 不只是 创 建 了 一 个指 针 实 例它首 先创 建 了 一个 指针类 型
 这是 通过调 用 pointer 函 数 实现 的它接 收 ctypes  类 型为 参数 返回 一 个 新 的类型 pi  pointercint  pi  class  ctypes
无 参 调 用 指 针 类 型可 以 创 建一个 null 指 针
 null  指针 的布 尔值是 false  nullptr  pointercint  printboolnullptr  false  解 引用指 针的 时候 ctypes  会帮你 检 测是否 指针 为 null  但 是 解 引 用 无效 的非 null  指针 仍会导 致 python  崩 溃 nullptr 0 traceback  most  recent  call  last 
类型 转换
通 常 情况下 ctypes 具 有 严格的 类型 检 查
 这 代表着 如 果在函 数 argtypes 中 或者结 构 体定 义 成员中 有 pointercint  类型只 有 相同类 型的 实例 才 会 被接 受
 也有 一些 例 外
 比如 你可以 传递 兼 容 的数 组 实 例给 指 针类 型
所 以对于 pointercint  ctypes  也 可 以接 受 cint 类型的 数 组 class  barstructure 
123另 外 如 果一个函 数 argtypes 列表 中 的 参 数 显 式的定 义为 指针类型 如 pointercint 指 针 所 指向 的类型 这 个例 子 中是 cint 也 可以 传 递给 函数
ctypes 会自 动 调 用对 应 的 byref  转换
 可 以给指 针内 容赋 值为 none  将其 设置 为 null  bar
values  none  有时候 你 拥 有 一个 不兼 容 的类 型
在 c  中你可 以 将 一个 类 型强制 转 换为 另一个
 ctypes  中的 a  cast  函数 提供 了 相同 的 功 能
上 面的 结 构体 bar  的 value  字 段 接收 pointercint  指针 或者 cint  数组 但是 不能 接 受 其 他类型 的实 例 bar
values  cbyte 4 traceback  most  recent  call  last  file  stdin  line 1 in  module  typeerror  incompatible  types  cbytearray 4 instance  instead  of  lpclong  instance 这 种情况 下需要 手动使 用 cast  函数
cast  函 数 可以将 一个 指针 实 例 强 制转换 为另 一 种 ctypes  类型
 cast  接 收两 个 参 数 一个 ctypes  指 针 对象或 者可 以被 转 换 为 指针的 其他类 型对象和 一个 ctypes 指针类 型
 返回第二 个类 型的一个实例 该返 回实例 和 第一个 参数指向 同一 片 内 存 空间 a  cbyte 4 casta  pointercint  ctypes
所 以 cast  可以 用来 给结构 体 bar 的 values 字 段赋 值 bar  bar  bar
 不完 整 类 型
 不完整类型即 还没有定 义 成 员的结构 体、 联 合或 者 数 组
 在 c 中 它 们通常 用 于 前 置 声 明 然 后在后 面 定 义 struct  cell  forward  declaration  struct  cell  char  name  struct  cell  next 直 接翻 译成 ctypes  的 代 码 如 下但 是这 行不通 class  cellstructure 
 traceback  most  recent  call  last  file  stdin  line 1 in  module  file  stdin  line 2 in  cell  nameerror  name  cell  is  not  defined  因 为新 的 cell 类 在 class  语句结 束之前还 没有 完成 定义
 在 ctypes  中 我们可以 先定义 cell 类在 class 语 句 结 束之 后 再设置 fields  属 性 from  ctypes  import  class  cellstructure 
 next  pointercell  让我 们试 试
我们 定 义两个 cell  实 例让 它 们互 相指向 对 方 然后 通 过指针 链式 访 问 几次 c 1 cell  c 1
 回调 函数
 访问 dll 的导出 变量
一些 动态 链 接库 不仅 仅导 出 函数 也 会导 出变 量
一 个例子 就是 python  库本 身的 pyoptimizeflag 根 据启 动 选 项 o 、 oo  的 不同它 是值 可能为0、1、2 的整 型
ctypes  可 以 通 过 indll 类 方法访问 这类 变量
 pythonapi 是 用 于访问 python  c 接 口的 预定 义 符号 optflag  cint
indllpythonapi  pyoptimizeflag  printoptflag  clong 0 如果 解释 器使 用 o 选 项 启动这 个例子会 打 印 clong 1如 果使 用 oo  启动 则会 打印 clong 2
 一个扩 展例子同 时 也展 示了 使 用指针 访问 python 导出 的 pyimportfrozenmodules  指 针对象
 对文档中 这 个值 的解 释 说明该 指 针 被 初始 化为指 向 struct  frozen  数 组 以 null 或 者0作 为结束 标 记
 当 一 个冻 结模 块 被 导 入 首先要 在 这 个 表中 搜索
 第三 方库 可以 以此 来提 供动 态 创建 的冻 结模 块 集合
 这足 以证 明修改 这个 指针是 很有 用 的
为 了让实 例大 小不 至 于太长 这里 只 展 示如 何使 用 ctypes 读 取 这 个 表 from  ctypes  import  class  structfrozenstructure 
 我 们定 义了 struct  frozen   数据 类 型 接 着就 可以 获 取这 张表 的指 针了 frozentable  pointerstructfrozen  table  frozentable
indllpythonapi  pyimportfrozenmodules  由于 table  是指 向 structfrozen 数 组 的指 针我 们 可 以遍 历 它只 不 过需 要自 己判 断循 环是 否结 束因为 指针 本 身 并 不包含 长 度
它 早晚 会 因 为访 问到野 指针或 者什 么的把 自己搞崩 溃所以 我 们 最好 在 遇 到 null 后 就 让它 退出 循环 for  item  in  table 
spam 161 python 的 冻结 模块 和冻 结 包 由 负 size 成 员表 示并 不是 广为 人 知 的事 情 它 们仅 仅用于 实 验
 例如 可以使 用 import  hello  尝试 一下这个 功能
意 外
ctypes  也 有 自己 的 边 界 有 时 候 会 发 生一 些意 想不 到的 事 情
比 如下 面的 例子 from  ctypes  import  class  pointstructure 
y 3434嗯
我们 预 想应 该 打 印3412
 但 是 为什 么 呢 这 是 rc
b  rc
a  这 行 代 码 展 开 后的 步 骤 temp 0 temp 1 rc
b  temp 1 注意 temp 0 和 temp 1 对 象始终 引用了 对象 rc  的内 容
然 后 执 行 rc
a  temp 0会把 temp 0 的 内容 拷 贝 到 rc 的 空 间
这 也改变 了 temp 1的 内 容
 最终 导致赋 值语 句 rc
b  temp 1 没有产 生 预想的 效 果
记 住 访 问 被包 含在 结构体、 联 合、数 组中 的对象 并 不会 将 其复 制出 来 而是 得到了 一个 代理 对 象它是 对根 对象 的 内部 内容的 一层 包装
 下面 是 另一 个 可能 和 预期 有 偏差 的例 子 s  ccharp  s
value  false 注 解使用 ccharp   实例化 的 对 象只 能将 其 值设 置为 bytes  或 者整 数
为 什么 这里打 印了 false ？ ctypes  实例是 一 些内 存块 加 上一些 用 于访 问这些内 存块 的 descriptor 组 成
将 python  对 象存 储 在内存 块并 不会存 储 对 象本 身 而是 存 储了对 象 的内容
 每 次访 问对象 的内 容 都 会 构造一 个新 的 python 对 象
变 长数 据类 型
ctypes  对 变 长 数组和 结 构体 提供 了一些 支 持
 valueerror  minimum  size  is 8 resizeshortarray 32 sizeofshortarray 32 sizeoftypeshortarray 8 这 非 常 好但 是 要怎 么 访问数 组 中额 外的 元 素 呢？ 因为 数 组类型已 经 定义 包 含4 个元 素导致 我 们 访问 新 增元 素时 会 产 生 以 下 错误 shortarray 0000 shortarray 7 traceback  most  recent  call  last 
 indexerror  invalid  index  使用 ctypes 访 问 变长 数 据 类 型 的 一 个可 行方法 是 利用 python  的动态 特 性根 据 具 体 情 况 在知 道 这个数据 的大 小后 重新 指定 这个 数据的 类 型
ctypes  参考 手 册
寻 找 动态 链接 库
加 载 动态 链接 库
有很 多 方式 可以 将 动态链 接 库加 载 到 python  进 程
其 中之 一 是实 例 化以 下类 的其 中 一个 class  ctypes
cdllname  modedefaultmode  handlenone  useerrnofalse  uselasterrorfalse  winmode 0此 类的 实 例 即已加 载 的动 态链 接库
 库 中的 函 数 使用 标准 c  调 用约 定 并 假定 返 回 int 
 在 windows  上创 建 cdll  实例 可能 会失 败 即 使 dll 名 称 确实存 在
当 某 个被 加 载 dll 所依 赖的 dll  未找 到 时将 引发 oserror  错误 并 附 带 消息 winerror 126 the  specified  module  could  not  be  found
 此错 误消息不包含 缺 失 dll 的 名称因 为 windows  api  并 不会 返回 此类 信 息这 使 得此 错误 难 以诊断
 要解 决此 错 误并确 定 是 哪 一 个 dll 未 找 到你 需 要找出所 依赖的 dll  列表 并使 用 windows 调 试与 跟 踪工 具确 定是 哪一 个未找 到
参见 microsoft  dumpbin  工具 一个 用于查 找 dll 依 赖的 工 具
oledllname  modedefaultmode  handlenone  useerrnofalse  uselasterrorfalse  winmode 0仅 windows  此类 的实 例 即加 载好的 动 态链 接库 其中 的 函数 使 用 stdcall  调用 约定并 且假 定 返回 windows  指定的 hresult 返 回码
 hresult  的值 包含 的信 息 说明 函数 调 用成 功还 是 失 败 以 及 额外 错 误 码
 如果 返回 值表 示失败 会自 动抛出 oserror  异常
 在3
3 版更 改 以前是 引 发 windowserror
windllname  modedefaultmode  handlenone  useerrnofalse  uselasterrorfalse  winmode 0仅 windows  此 类 的 实例 即加 载好 的动 态 链 接 库其 中 的 函数 使 用 stdcall 调 用 约定 并 假定默认 返 回 int 
 在 windows  ce  上只 能使 用 stdcall 调用 约定为 了 方便 windll  和 oledll 在 这 个 平台 上 都使 用标 准调用约定
 调用 动 态 库导 出的 函数 之前 python  会 释放 global  interpreter  lock 并 在调用后 重新获 取
pydllname  modedefaultmode  handlenone 这 个类实例 的 行为 与 cdll 类 似只 不 过不 会 在 调 用 函数 的时候 释 放 gil  锁且 调用 结 束后会检查 python  错误码
 如果 错误 码被设 置会 抛出 一个 python 异 常
所 以它只 在直接 调用 python  c 接 口 函 数的 时 候 有 用
 通过使 用至少一 个参数 共享库 的 路 径 名 调 用 它们 可以 实例化 所有 这些类
 也可以 传入 一个 已 加 载 的动态 链接 库作为 handler  参数 其他情 况会 调 用系统 底层的 dlopen 或 loadlibrary  函数 将 库加 载到进程 并获取其 句柄
mode  可以指 定库 加载 方式
详情 请参 见 dlopen 3手册 页
 在 windows 上 会忽 略 mode  在 posix 系 统 上总 是会 加 上 rtldnow  且 无 法配 置
useerrno  参数如 果设 置为 true 可 以启 用 ctypes 的 机 制 通 过 一种 安全 的 方 法 获取 系 统的 errno 错 误 码
 ctypes 维护 了 一 个线 程局 部变量 它是系 统 errno 的 一 份拷 贝如 果调 用了使 用 useerrnotrue 创 建的 外 部 函数 errno 的 值会 与 ctypes  自己拷 贝的 那一份 进行 交换 函 数 执 行完 后立 即再 交换 一次
the  function  ctypes
geterrno  returns  the  value  of  the  ctypesprivate  copy  and  the  function  ctypes
seterrno  changes  the  ctypesprivate  copy  to  a  new  value  and  returns  the  former  value
uselasterror  参数 如果 设置 为 true  可以在 windows 上 启用相 同的策略 它 是通 过 windows  api 函数 getlasterror   和 setlasterror  管理 的
 ctypes
getlasterror  和 ctypes
setlasterror 可 用 于获取 和设 置 ctypes  自 己 维 护的 windows  错 误码 拷 贝
winmode 参数 用 于 在 windows 平 台 上 指定 库 的 加载方 式因 为 mode 会 被 忽略
 他 接 受 任 何与 win 32 api  的 loadlibraryex 的标 志兼 容 的值 作为 参 数
省略 时默认设 置使 用 最安 全的 dll  加 载的标 志以避 免 dll  劫 持等问题
 传入 dll  的全路 径是 保 证正确 加 载 库及 其依赖 最 安 全的方 法
在3
8 版更 改 增 加 了 winmode  参数
rtldglobal  用于 mode  参数 的标 识值
 在 此标 识不 可用 的 系统 上 它 被 定 义 为整 数0
defaultmode 加 载动 态链 接库的 默 认模 式
 在 osx 10
3上 它 是 rtldglobal 其余 系 统上 是 rtldlocal 
这 些 类的 实例 没有 共用 方法
 动态链 接 库的 导出 函 数 可以通 过属 性或 者 索 引的方 式访 问
注 意 通 过 属 性 的方式访 问会 缓 存这个 函数 因而 每次 访 问它时 返 回的 都 是 同一个 对 象
另 一 方面 通 过 索 引访 问 每次都 会返回一 个新的 对象 from  ctypes  import  cdll  libc  cdlllibc
time  true  libctime  libctime  false  还有 下 面 这 些 属性 可 用他 们的 名称 以 下 划 线 开 头 以 避 免 和 导出 函数 重名 pydll
handle 用于 访 问 库 的系 统 句 柄
name 传 入构 造函 数 的 库 名称
共 享 库 也 可 以 通用 使用 一个 预 制对象 来加 载这 种对象 是 libraryloader 类 的实 例具 体做 法或是 通过调 用 loadlibrary 方 法或 是通 过将库 作为 加 载 器实 例的属性 来提 取
libraryloaderdlltype  加 载 共享库的类
 dlltype  应 当为 cdll  pydll  windll  或 oledll 类 型之 一
 getattr 具有 特殊 的行 为它 允 许 通过将 一个共享库作 为库加 载器实 例的属 性进 行 访 问来加 载它
 加 载结果将 被 缓存 因此重 复 的属 性访问 每次 都会 返回 相 同的 库
 loadlibraryname 加 载一 个 共享 库到 进 程 中并将其 返回
 此方 法 总是 返回一 个新 的库 实例
 可用 的 预制 库加 载 器有 如下 这 些 ctypes
cdll 创建 cdll  实 例
windll  仅限 windows  创建 windll  实 例
oledll  仅限 windows 创 建 oledll 实 例
pydll  创 建 pydll 实 例
要 直 接 访 问 c  python  api 可 以使用 一个 现 成的 python 共 享库 对象 ctypes
pythonapi 一个 pydll  的实例 它将 python  c  api 函数 作为 属性 公开
 请注 意 所有这 些 函 数 都 应返 回 c  int 当 然 这也 不是 绝对 的 因 此你 必须分 配 正 确的 restype  属性以 使用 这些函 数
引 发 一 个审 计事 件 ctypes
dlopen  附带 参数 name
 引发 一个 审 计事 件 ctypes
dlsym  附带 参数 library  name
 引 发一个审 计事 件 ctypes
dlsymhandle 附带 参数 handle  name
 外部 函数
 正 如 之前 小节 的说 明外 部 函数 可作为 被加载 共享 库的 属性 来访问
用此 方 式创建 的 函数对 象 默认接 受 任 意数 量的 参数 接受 任 意 ctypes 数据 实 例作为 参数 并且 返回 库加 载器 所指 定的默认结 果类型
它 们是一个私 有类的 实例 class  ctypes
funcptr  c 可调用 外部 函 数的 基类
 外部 函数的实例 也是兼容 c 的数 据类 型 它 们代 表 c  函数 指 针
此 行为 可通 过对外 部函数 对象的 特殊属性 赋值 来自 定义
 restype 赋 值 为一个 ctypes 类型 来 指定 外部 函数 的 结果 类 型
使 用 none 表示 void  即不 返 回任何结果 的函 数
赋 值为 一 个不 为 ctypes 类 型的 可 调用 python 对 象也 是可以 的在 此情 况 下函 数 应返 回 c  int 该可 调用 对象将附带 此整 数被 调 用以允许 进一 步的处 理或 错误检测
这 种 用 法 已被 弃 用为了更 灵活 的后 续处 理 或错 误 检测 请使 用一 个 ctypes 数据 类型 作为 restype  并将 errcheck  属 性赋 值为 一个 可调 用对 象
 argtypes 赋 值为一个 ctypes 类 型的 元组 来 指定 函数 所接 受 的参 数类 型
使 用 stdcall 调 用规范 的函 数只 能 附带 与 此元 组长 度相 同 数 量的 参数 进行 调用 使用 c  调用 规 范的 函 数还 可接 受额 外的 未指 明参数
当 外部 函 数被 调 用 时每 个 实际 参数 都会 被传给 argtypes 元 组中 条目 的 fromparam 类 方法此方 法允 许将 实际 参 数适 配为 此 外部 函数所接 受的 对 象
例 如 argtypes 元组中 的 ccharp 条 目 将使 用 ctypes 约 定规 则把 作 为 参数传 入 的 字 符 串转换为 字节 串对 象
 新增 现 在可以 将 不是 ctypes  类 型的 条 目放 入 argtypes 但 每 个 条目 都 必 须具有 fromparam  方 法用 于返 回可 作为 参数 的 值整 数、 字符 串、 ctypes  实 例
这 样就 允 许定义 可将 自定 义 对 象适 配 为函 数 形 参的 适配 器
 errcheck  将一 个 python  函数或 其 他可 调 用 对象 赋值 给此 属 性
该可 调用 对象将 附 带 三 个及 以上 的 参数 被调 用
 callableresult  func  arguments  result 是 外部 函数 返 回 的 结 果由 restype  属 性 指明
 func  是外部函 数 对象 本 身 这样 就允 许 重新使用 相同 的可 调用 对 象 来对 多 个函 数进 行 检查 或 后续处 理
 arguments 是 一个 包 含 最初 传 递给函 数 调用 的形参 的元 组 这 样就 允许 对 所用 参数 的行 为 进行 特别处 理
此 函数 所返 回的 对 象 将 会 由外 部函 数 调用返 回但 它还可 以在 外 部 函 数 调用 失 败时 检查结 果 并引 发 异 常
exception  ctypes
argumenterror 此 异 常会在 外部 函数无 法对 某个传入 参 数执 行转 换 时被引 发
 引 发 一个 审计 事件 ctypes
sehexception  并 附 带 参数 code
引发 一个 审计 事件 ctypes
callfunction  附带 参数 funcpointerarguments
函数原 型
工 具函 数
addressofobj  以 整数 形 式返 回内存缓 冲区 地址
 obj  必 须为 一个 ctypes  类型 的 实例
 引 发一 个审 计事件 ctypes
addressof 附 带参数 obj
alignmentobjortype  返回 一个 ctypes  类 型的 对 齐 要 求
 objortype 必 须为 一 个 ctypes 类 型 或实 例
byrefobj  offset  返回 指向 obj  的 轻 量 指针 该对 象必 须为 一个 ctypes  类型的实 例
 offset  默 认 值 为 零 且必 须 为 一个 将 被 添 加到 内部指针 值的 整 数
 byrefobj  offset  对应 于这段 c  代 码 char  obj  offset 返 回的 对 象 只能 被 用作 外部 函数 调用 形 参
 它的行为 类似 于 pointerobj 但构 造 起来 要快 很 多
castobj  type  此函 数类 似于 c  的强 制转换运 算符
它 返回 一个 type  的 新实例 该实 例 指向 与 obj 相 同的 内存 块
 type  必须 为 指 针类 型 而 obj 必须 为 可以 被作 为指 针来解 读的 对象
createstringbufferinitorsize  sizenone 此 函数 会 创建 一个 可 变 的 字 符缓 冲区
 返回的对 象是 一个 cchar  的 ctypes  数 组
 initorsize 必 须是 一个 指明 数组 大 小的整数 或者 是一个将 被 用来 初始化数 组 条目 的 字 节串 对象
如果 将 一个 字 节串对 象 指 定为 第一 个 参数 则 将 使 缓 冲区大小比 其长 度多 一项以 便数 组 的最后 一 项为 一个 nul 终结 符
可以传 入 一 个整 数作 为第 二个 参 数 以允 许在 不使用 字节串 长度 的 情况 下 指定 数组大小
 引发 一个 审计 事件 ctypes
createstringbuffer 附 带参 数 init  size
createunicodebufferinitorsize  sizenone 此 函数会 创 建 一 个可 变 的 unicode 字 符 缓冲区
返 回的对 象是 一 个 cwchar 的 ctypes 数组
 initorsize  必须 是一 个指 明数 组大 小 的 整 数 或 者 是一 个将被用 来初 始化数 组条目的字 符串
 如果将一 个 字 符串 指定 为第 一个参 数 则将使 缓冲 区大 小比其 长 度多 一 项以 便数 组的 最后一 项为 一 个 nul 终 结符
 可以 传入 一 个整数 作 为 第 二个 参 数 以允许 在 不 使用 字符 串长度 的情 况下指 定 数 组 大 小
 引 发 一 个 审计 事 件 ctypes
createunicodebuffer  附带参 数 init  size
dllcanunloadnow 仅 限 windows 此函 数是 一个 允 许使用 ctypes 实 现 进程内 com  服务的 钩子
它 将由 ctypes  扩 展 dll  所 导 出的 dllcanunloadnow  函数 来 调 用
dllgetclassobject 仅 限 windows  此 函 数 是 一个允 许 使 用 ctypes 实 现进 程 内 com  服务 的 钩子
 它将 由 ctypes 扩 展 dll  所 导 出的 dllgetclassobject  函数来 调用
findlibraryname  尝试 寻 找一个库 并返 回路径 名称
 name  是库 名 称 并 且 不 带 任 何前 缀 如 lib  以及后缀 如
so
dylib  或版 本 号形式 与 posix 链接器选 项 l 所 用的 一 致
如 果找 不 到 库 则 返 回 none
 确 切 的功 能 取 决于系 统
findmsvcrt 仅限 windows  返回 python  以及 扩展 模块 所使 用的 vc  运行时库 的文件名
如 果 无法 确定 库名称则 返 回 none
如 果 你 需 要 通 过调 用 freevoid 来释 放内 存例 如某 个扩展 模 块所 分配 的 内存 重要 的一 点 是你 应当 使用 分 配内 存 的 库 中的 函 数
formaterrorcode 仅 限 windows  返 回错 误 码 code 的 文本 描 述
 如果 未 指定 错 误码 则会 通 过 调用 windows  api  函数 getlasterror  来获 得 最 新的 错 误码
getlasterror  仅 限 windows  返回 windows  在 调用 线程 中设 置的 最 新 错误码
 此 函数 会直 接 调用 windows  getlasterror  函 数它 并 不 返 回错 误 码 的 ctypes  私 有副 本
geterrno  返回调用 线程 中系统 errno  变 量的 ctypes  私 有副 本 的当前 值
 引发一 个 审计事 件 ctypes
geterrno 不 附带 任 何参数
getlasterror  仅限 windows 返 回调 用线 程 中系统 lasterror  变量的 ctypes  私有 副本 的当 前值
 引发 一个 审计 事件 ctypes
getlasterror  不附带 任何 参 数
memmovedst  src  count 与标准 c  memmove 库 函数 相同将 count  个字节 从 src 拷 贝到 dst 
 dst  和 src 必 须为整数 或可 被 转 换为指 针的 ctypes  实例
memsetdst  c  count 与标 准 c  memset  库函 数相同将 位于地址 dst  的内存 块用 count 个字节 的 c 值 填充
 dst  必须为指 定 地 址 的整 数或 ctypes 实 例
pointertype 这 个工厂函数 创建 并 返 回 一 个新 的 ctypes  指针 类型
 指 针类 型 会 被缓 存并 在 内 部重 用因 此 重 复 调用 此函 数 耗费 不大
 type  必须 为 ctypes 类型
pointerobj  此 函 数会 创建 一 个新的 指向 obj  的 指针 实 例
返 回 的对 象 类型 为 pointertypeobj
 注 意如果 你 只是 想向外 部 函 数 调用 传递 一个对象 指针你 应 当使 用更 为快 速 的 byrefobj
resizeobj  size 此 函 数 可 改 变 obj 的 内部内 存缓 冲区大小其 参 数必 须 为 ctypes 类 型的 实例
 没有 可 能将 缓 冲 区设为 小于 对象 类型的 本机大 小 值 该 值由 sizeoftypeobj  给出 但将 缓 冲区 加大 则是可能 的
seterrnovalue 设置调用线 程中系 统 errno 变 量 的 ctypes  私 有 副本的 当前值为 value  并返回原 来的 值
引发一个 审计 事件 ctypes
seterrno  附带 参数 errno
setlasterrorvalue 仅限 windows  设 置 调用 线程中系 统 lasterror 变 量 的 ctypes  私有 副 本的 当前值 为 value 并 返回原来 的值
 引发 一个 审计 事件 ctypes
setlasterror  附 带 参数 error
sizeofobjortype  返回 ctypes 类 型或 实例的内 存 缓 冲 区以 字节表 示的 大 小
其 功 能 与 c  sizeof 运 算符 相同
stringataddress  size 1 此 函数 返回从内 存地 址 address  开始 的 以 字 节 串表 示的 c 字符 串
 如果指 定 了 size 则 将其用 作长 度否 则将 假 定字 符串 以 零 值 结 尾
 引 发一个 审计事 件 ctypes
stringat 附 带参 数 address  size
winerrorcodenone  descrnone 仅 限 windows 此函 数可 能是 ctypes  中名 字 起 得最差 的函 数
它会 创建 一个 oserror 的 实例
 如 果 未指 定 code  则 会调 用 getlasterror 来 确定错 误码
 如果 未指定 descr 则 会调用 formaterror 来 获取错误 的文 本描 述
在3
3 版更改 以前 是会 创 建 一 个 windowserror 的 实 例
wstringataddress  size 1此 函数返 回 从 内 存地 址 address  开始的以 字符 串表 示的 宽字 节 字 符串
 如果指 定了 size  则将 其用作 字符 串中 的字 符数量否 则 将假 定字符串 以零值结 尾
 引发 一 个审 计事件 ctypes
wstringat 附 带参数 address  size
 数据 类型
cdata  这个 非公有 类 是 所 有 ctypes 数 据类 型 的共 同基 类
另 外所 有 ctypes 类型 的 实 例都 包 含一 个 存放 c  兼容 数 据的内 存 块 该内存块 的 地址 可由 addressof  辅 助函 数返 回
还 有 一个 实 例变 量 被公开 为 objects  此 变量包含 其他在内 存 块包 含指 针的 情 况下 需 要保 持 存活 的 python 对象
 ctypes  数 据类 型的 通用 方法 它 们 都是 类方法严 谨地说 它们是 metaclass  的 方法 frombuffersource  offset  此方 法返回 一个共享 source 对 象缓 冲 区 的 ctypes  实例
 source  对象 必 须 支持 可写 缓 冲区 接口
 可选的 offset  形参指定 以字 节表示的 源缓 冲区 内偏 移量默认值 为零
如果 源 缓冲 区 不够大 则 会引发 valueerror
 引 发 一个 审计 事件 ctypes
cdatabuffer  附带 参数 pointer  size  offset
 frombuffercopysource  offset  此 方法 创建一 个 ctypes 实 例从 source 对 象缓冲区 拷贝缓冲区该 对象 必须是可 读 的
可选的 offset  形 参指 定 以字 节表 示的 源缓 冲区 内偏 移 量默 认 值 为零
如果 源 缓冲 区 不够 大则 会 引发 valueerror
 引发一个 审计 事件 ctypes
cdatabuffer  附带 参数 pointer  size  offset
 fromaddressaddress 此方 法会 使 用 address 所 指 定的 内存 返回一 个 ctypes 类型 的实例该参 数 必须 为一 个整 数
引 发 一个 审 计事 件 ctypes
cdata  附带 参 数 address
 fromparamobj 此 方法 会将 obj 适配 为一个 ctypes  类 型
它 调 用时 会在 当该类型存在 于外 部函数的 argtypes  元组 时 传入外部 函数 调用 所 使 用 的实 际 对象 它必 须返 回 一个 可 被 用作 函 数 调用 参数的对 象
所 有 ctypes 数据 类 型都 带 有 这 个 类方 法的 默认 实 现它 通常 会返 回 obj  如果 该对 象是 此类型 的实 例的话
某 些 类型 也能 接 受 其他 对 象
 indlllibrary  name 此 方法 返 回一 个 由 共享 库导 出的 ctypes 类 型
 name 为 导出 数 据 的符 号名称 library 为 所加载的 共享库
 ctypes 数 据类 型的 通 用实 例 变量 bbase  有 时 ctypes 数据实 例 并不 拥 有它 们所包 含的内 存 块 它 们只是共享了 某个 基对 象的部分 内存 块
 bbase 只 读成员是拥 有内存 块 的 根 ctypes 对 象
 bneedsfree 这个只读 变量 在 ctypes 数据 实 例自身已分 配了内存块 时 为 真值否则为 假 值
 objects 这 个成 员或者为 none  或者 为一 个包 含需要 保持存活以使 内存 块的内 存保 持有效的 python  对象 的字 典
这 个对象只是 出于调 试目 的而 对外公开绝 对不 要修改 此 字典的内容
 基础数据类 型
simplecdata  这 个非公有类 是 所有 基本 ctypes  数据类型 的基 类
它 在这 里被提 及是因为 它包含 基 本 ctypes  数 据 类型共有 的 属 性
 simplecdata 是 cdata  的子类 因此 继承 了 其 方 法 和 属 性
非 指 针及 不包 含 指 针 的 ctypes 数 据类 型现 在 将可以 被封 存
 实例 拥 有一 个属 性 value 这 个属 性 包含 实 例 的实 际值
 对于 整数 和 指 针 类 型 它 是 一个 整数对于 字符类型它是 一个单字 符字符 串对 象或 字符串对于 字 符指 针类型它 是一 个 python 字 节串 对象或 字符串
当从 ctypes 实 例提 取 value 属 性时 通常 每次 会返回 一个 新的对 象
 ctypes 并 没有 实现原始对 象返 回它总 是 会构造一个 新的对象
所 有 其 他 ctypes 对象实例 也 同样 如此
 基本数据 类型 当作 为外 部函数 调用结果被返 回或 者 作为结 构字 段成 员或 数 组项被 提取 时会透明地 转换 为 原生 python  类型
换句话 说如 果某个 外 部函数具有 ccharp  的 restype 你将总是 得 到 一个 python 字节串 对 象而 不是 一个 ccharp 实例
 基本 数据 类型 的子类 并没有继 续此行为
 因 此如 果一 个外 部 函数 的 restype 是 cvoidp 的一个 子类你 将 从 函数调用得 到一 个该子 类 的实例
当然 你可以通过 访 问 value  属性来获取 指 针的 值
这 些是基本 ctypes  数据 类型 class  ctypes
cbyte  代表 c  signed  char  数据类 型并将值解读 为一个小 整数
 该 构造 器接 受一 个可选的整 数初始 化器 不会执行溢 出检 查
cchar 代表 c  char  数 据类型并将 值解读为单 个 字 符
该构造器 接 受一 个可 选的字符 串初 始化 器字 符串的 长 度必须恰 好为 一个 字 符
ccharp 当 指 向一 个 以 零为 结 束符 的 字符 串 时 代表 c  char  数据 类型
 对于 通用字 符指 针来 说 也可能 指向 二 进制数 据必 须要 使 用 pointercchar
该 构造器接 受 一个 整数 地 址或 者一个 字节串 对 象
cdouble 代表 c  double  数据类 型
 该 构造 器接 受一个可选的 浮点数初 始 化 器
clongdouble 代 表 c  long  double 数据类 型
 该构 造器接 受一 个可选的 浮 点数 初 始 化器
 在 sizeoflong  double  sizeofdouble 的 平台上它是 cdouble 的 一个别名
cfloat  代 表 c  float  数据 类型
该构 造器接 受一 个 可选 的 浮 点数 初始 化 器
cint 代 表 c  signed  int 数据类 型
 该 构 造 器接受一 个 可 选的 整 数初 始化 器不 会 执行 溢出 检查
在 sizeofint  sizeoflong 的 平台 上它是 clong  的一 个别 名
cint 8 代表 c 8 位 signed  int 数据 类 型
 通常 是 cbyte 的 一 个别 名
cint 16 代表 c 16 位 signed  int 数据 类型
通 常 是 cshort 的 一个 别名
cint 32代 表 c 32 位 signed  int  数据 类型
 通 常 是 cint  的一 个别 名
cint 64 代表 c 64 位 signed  int  数据类 型
 通 常 是 clonglong 的 一个别 名
clong  代表 c  signed  long  数据 类 型
该 构 造 器接 受一个 可选的整 数初 始化 器 不 会执 行溢出检 查
clonglong  代表 c  signed  long  long 数 据 类型
 该构 造器接 受一个可 选的 整数 初 始 化 器 不 会 执行 溢出 检查
cshort  代表 c  signed  short  数 据类型
 该构 造器接 受一 个可选的 整 数初 始化 器不会 执行 溢 出 检 查
csizet 代 表 c  sizet 数 据类 型
cssizet  代表 c  ssizet  数 据类 型
3
2 新版功能
cubyte  代 表 c  unsigned  char 数 据 类型 它将值 解读为 一 个 小 整数
该 构造 器 接受一个 可选的整 数 初始 化 器不会 执行 溢出检查
cuint  代 表 c  unsigned  int 数据类型
 该构 造器接受 一 个可 选 的整 数 初始 化器 不会 执 行 溢出 检查
 在 sizeofint  sizeoflong 的 平 台 上它是 culong  的一 个别 名
cuint 8代表 c 8位 unsigned  int  数据 类型
通常 是 cubyte 的一个 别名
cuint 16 代 表 c 16位 unsigned  int 数据 类型
通常 是 cushort  的一 个 别名
cuint 32 代 表 c 32位 unsigned  int  数据类型
 通 常是 cuint 的一个别 名
cuint 64代 表 c 64 位 unsigned  int 数 据 类 型
通 常 是 culonglong  的 一 个别 名
culong 代 表 c  unsigned  long 数 据类 型
 该构 造器 接 受一个 可选的 整数 初始 化器不会执行 溢出 检查
culonglong 代 表 c  unsigned  long  long 数据类 型
该 构造 器接受 一个 可 选的整数 初始化器 不 会执行 溢 出检查
cushort  代表 c  unsigned  short  数据 类型
 该 构 造 器接受 一个 可 选的 整 数初始 化器不 会执行 溢出 检 查
cvoidp  代表 c  void  类 型
该值 被表 示 为整 数形式
该 构 造器接受一个 可选 的 整数 初始 化器
cwchar 代表 c  wchart  数据 类型 并 将值 解 读为一 单 个字 符 的 unicode 字 符串
 该构 造器接 受一 个 可选的字 符串初始 化 器字符 串 的长度 必须 恰好 为一 个 字 符
cwcharp  代表 c  wchart 数 据类 型 它必 须 为指向 以零为 结束符 的宽 字 符 串的 指 针
该 构造 器 接受 一个 整数地址 或者 一 个 字符串
cbool 代 表 c  bool 数 据 类 型 更准 确地 说 是 c 99 bool
它 的值 可 以 为 true  或 false 并 且该构造器 接受 任 何 具 有逻 辑值 的 对 象
hresult  windows 专 属 代 表一个 hresult  值 它包 含某 个函 数或 方法 调用的 成 功或 错误 信 息
pyobject  代 表 c  pyobject  数 据类型
 不带 参数 地 调用 此构 造器 将 创建 一个 null  pyobject 指针
ctypes
wintypes  模块 提供 了其他 许多 windows  专属的 数 据 类 型例 如 hwnd  wparam 或 dword
 还 定 义了一 些有 用的 结构体 例如 msg 或 rect
结 构化数据 类型
unionargs  kw 本机 字节 序 的联 合 所对 应的抽 象 基 类
bigendianstructureargs  kw 大 端 字节 序的 结构 体 所对应 的抽象 基类
littleendianstructureargs  kw  小端字 节序的结 构 体所 对 应的 抽象 基类
非 本 机字节 序 的 结 构体 不能 包含 指针 类 型字 段或任何 其 他 包含 指针 类 型字 段的数据类 型
structureargs  kw  本 机字 节序 的 结 构 体所对 应的 抽 象基类
 实际的 结 构 体 和 联合类型 必须 通过 子类化 这 些 类型 之 一 来创建 并且 至少 要 定义 一个 fields 类变 量
 ctypes  将 创 建 descriptor  它允许通 过 直 接属 性 访问 来读 取 和写 入 字段
 这些 是 fields 一个定 义结 构体字 段 的 序 列
其 中 的 条目 必须 为2 元 组 或3元 组
元 组的 第一项 是字 段名 称 第 二项 指 明字 段 类型它可 以是任何 ctypes 数据 类型
 对 于 整数 类型 字段例 如 cint 可 以 给定 第三个可选 项
它必须 是一 个定义字 段比 特位宽度 的 小正 整 数
字 段名 称 在一个 结构体 或联 合中必须 唯一
 不会 检 查这 个 唯 一性 但当名称 出 现重 复 时将只有一 个字 段可 被 访问
 可以 在定义 structure  子 类 的类 语 句 之后 再定义 fields 类 变 量这 将 允许 创建直接 或间 接 引用 其自身 的数 据类 型 class  liststructure  pass  list
 但 是 fields 类 变量 必须 在类型 第 一 次被 使用创建 实例调 用 sizeof 等 等之前 进行定 义
在此之 后 对 fields  类 变 量赋 值 将会 引 发 attributeerror
 可以 定义 结 构体 类型 的 子 类 它 们 会 继承 基类 的字 段 再 加上 在 子 类中 定义 的任 何 fields
 pack  一 个可 选 的小整数 它允许 覆 盖实体中 结构 体 字 段的对 齐方 式
当 fields  被赋 值 时必 须已 经定义 了 pack  否 则它 将没 有效果
 anonymous  一个 可选 的序 列它会列出 未命 名 匿 名 字段 的 名 称
当 fields  被赋 值时 必 须已 经定 义 了 anonymous  否则它 将没 有 效果
在 此变 量中 列 出的 字段 必须 为结 构体 或联合 类 型字 段
 ctypes 将 在结 构体类 型中创 建描述 器以 允许 直接 访问嵌 套 字 段而 无需创 建对 应 的 结构 体或 联 合字段
 以 下是一个 示 例 类型 windows  class  uunion  fields  lptdesc  pointertypedesc  lpadesc  pointerarraydesc  hreftype  hreftype  class  typedescstructure  anonymous  u  fields  u  u  vt  vartype  typedesc  结 构体 描 述 了 一 个 com 数 据类型 vt 字 段 指 明 哪 个联 合 字段 是 有 效的
 由于 u  字段 被定义 为匿 名字 段现 在可以直 接从 typedesc  实 例 访问 成员
 td
lptdesc  和 td
lptdesc  是等 价的 但 前者 速度 更 快 因 为 它不需要 创建临 时的 联 合 实 例 td  typedesc  td
lptdesc  pointersometype 可以定 义结 构体 的子 类 它们会 继 承 基类 的 字段
 如 果子类定义具 有单 独的 fields  变 量在 其中 指定 的字 段 会 被添 加到 基类 的字段中
 结构 体 和 联合 的 构造 器 均可接 受 位 置和 关 键字 参 数
 位置 参 数 用 于按 照 fields  中的 出现 顺 序来初始化 成 员字段
构 造 器中的 关 键 字参 数会 被解 读为 属性赋值 因 此它 们将 以相应的 名称 来 初始化 fields 或 为不存 在 于 fields 中的名称创 建新 的属 性
数组与 指针
arrayargs  数组 的 抽象 基类
创建 实际数组 类型的推 荐方式是 通 过将任 意 ctypes 类 型 与一个 正整 数 相乘
作 为替代方 式你 也可 以 子类化 这 个类型 并 定义 length 和 type  类变 量
数 组 元素可 使 用标准 的抽 取 和切片 方 式来读 写 对于切 片 读取结 果 对象本 身并非一 个 array
 length 一个指明 数组中元素 数量的正整 数
超出范围 的抽 取会导致 indexerror
该 值将 由 len 返回
 type 指明 数 组中每个 元 素 的 类型
 array  子类 构 造 器可 接受位 置参数用 来 按顺 序初 始 化元 素
pointer 私 有对象指针 的 抽象 基类
 实际 的指 针 类 型 是通 过 调 用 pointer 并 附带 其 将指向的类 型来 创 建的这会 由 pointer 自 动完 成
如果 一个 指针指 向的 是 数 组则 其 元素 可使用 标准 的抽取 和切片 方式 来读写
指针 对象 没有 长度因 此 len 将 引发 typeerror
 抽取 负 值将 会从 指针之 前的 内存中 读 取与 c 一 样并且 超 出范围的 抽 取 将可 能 因 非法 访问 而 导致 崩溃 视 你的 运 气 而定
 type  指 明 所指 向的 类 型
 contents  返 回指 针所 指向 的 对象
 对此 属性 赋 值会使 指针改为指向 所赋 值 的 对象
cursesascii  用于 ascii 字 符 的 工具
curses
ascii  模 块 提供 了一些 ascii  字符 的 名称常量 以及 在各种 ascii  字符 类中 执行 成 员检 测的 函 数
所 提供 的控 制字符 常量 如 下 名 称 含义 nul  soh  标题 开 始 控制台 中断 stx  文 本开 始 etx 文 本结束 eot 传 输结 束 enq 查询附 带 ack 流量控 制 ack 确 认 bel 蜂 鸣器 bs  退 格 tab 制表 符 ht  tab 的 别 名水 平 制 表 符 lf  换 行 nl  lf 的 别名 新行 vt  垂直 制表 符 ff  换 页 cr  回车 so  shiftout  开 始 替换 字符 集 si  shiftin 恢复 默 认字符 集 dle  datalink  escape 数据链接 转义 dc 1 xon 用于 流 程控制 dc 2 device  control 2 块模式流程 控 制 dc 3 xoff 用于 流 程控制 dc 4 设备控制4 nak 否 定确认 syn 同步 空 闲 etb 末端 传输块 can 取消 em  媒 体结束 sub  替换 esc 退出 fs 文 件 分隔符 gs  组分隔符 rs  record  separator 块 模式终止符 us  单位分隔符 sp  空格 del 删除请 注意其中有 许多在现今 已经没有实 际 作用
这 些助记符是 来源 于数 字 计算 机之 前的 电传打印 机规 范
此 模块 提供 了下 列函数对 应 于标 准 c 库 中 的 函 数 curses
isalnumc 检 测 ascii 字 母 数 字类 字 符 它 等价 于 isalphac  或 isdigitc
isalphac 检 测 ascii  字母类 字 符它等价于 isupperc  or  islowerc
isasciic  检测 字符 值 是 否 在7 位 ascii  集 范 围内
isblankc  检 测 ascii 空 白字符 包括 空 格 或水 平制 表符
iscntrlc  检 测 ascii  控 制 字 符在0 x 00 到0 x 1 f 或0 x 7 f  范围内
isdigitc  检测 ascii  十进制 数码即0 至9
 它 等价于 c  in  string
isgraphc  检测任 意 ascii  可打 印字 符 不包 括 空 白 符
islowerc  检 测 ascii 小 写 字 母字 符
isprintc  检测 任 意 ascii 可 打印 字符包 括空 白符
ispunctc 检测 任 意 ascii  可 打 印 字符 不 包括 空白符 或字 母数 字类 字符
isspacec  检 测 ascii 空 白 字 符 包括 空格换 行回 车进 纸水 平制 表 和 垂 直 制表
isupperc  检 测 ascii 大 写 字母字 符
isxdigitc  检测 ascii  十 六进 制 数 码
这 等价于 c  in  string
isctrlc  检 测 ascii  控制 字符 码位 值0至31
ismetac  检测 非 ascii 字 符 码 位 值0 x 80及以 上
 这些 函数 接 受 整 数 或 单 字 符 字符 串 当参 数 为字 符串 时会 先使 用内 置函 数 ord 进 行转 换
请 注意所有 这些函数 都是检测 根据你传 入的字符 串的字符 所生成的 码位值它 们实际上 完全不会 知晓 本机 的字 符编 码格 式
以 下两 个函 数接 受单 字符 字符 串或 整数 形式的字 节 值 它们 会返 回相 同 类 型的 值
asciic 返回 对应 于 c  的 下个7 比特 位的 ascii  值
ctrlc 返 回对应 于给 定 字符 的 控制 字 符字 符比 特值 会 与0 x 1 f 进 行按 位 与运 算
altc 返回对应 于给 定 ascii 字 符的8 比 特 位字 符 字 符比 特值 会与0 x 80 进行 按 位或 运算
 以下 函数 接受 单 字 符字 符串 或 整 数值 它会 返回 一个字 符串
unctrlc  返回 ascii  字符 c  的字 符串表示 形 式
如果 c  是 可 打 印字 符则 字 符 串 为字 符 本身
 如果 该字 符 是控 制 字 符0 x 000 x 1 f  则 字符 串由 一 个 插 入 符加 相应的 大写 字 母 组 成
 如果 该字 符 是 ascii  删 除 符0 x 7 f  则字 符 串 为
 如 果 该 字 符 设置 了元比特 位0 x 80 元 比特位会 被 去 除应 用以 上 规 则后 将在 结果 之前 添加
controlnames  一个33 元素 的字 符串 数据 其 中按从0 nul  到0 x 1 f  us  的 顺序 包含 了三十二 个 ascii  控 制字 符 的 ascii 助 记符 另加 空格符 的助 记符 sp
cursespanel  curses  的面 板 栈扩 展
 面 板是具 有添 加深 度 功 能的 窗口因 此它们 可以从 上 至 下堆 叠 为栈 只有 显示 每个 窗口 的可 见 部分 会 显示 出来
 面板 可以 在栈 中被 添加、上 移或 下 移 也 可 以被移 除
函 数
curses
panel 模 块定 义 了 以 下函 数 curses
bottompanel 返 回 面 板 栈中 的 底部 面 板
newpanelwin  返 回 一个 面 板对 象将其 与 给定的 窗口 win  相 关联
 请注 意 你 必须显 式 地 保持 所返 回的 面板 对象
 如果 你 不 这样做面板 对象 会被 垃 圾回 收 并从面 板 栈中被 移 除
toppanel 返 回面板 栈中的 顶部面 板
updatepanels 在面 板 栈发生 改变 后更 新 虚 拟 屏幕
 这 不 会调 用 curses
doupdate 因 此 你 不 必自 己 执行 此操作
panel  对象
panel  对象 如上 面 newpanel  所返 回 的 对象是 带有栈顺 序的 多个 窗口
 总 是 会 有 一个 窗口 与 确定 内容 的面板相 关 联面 板方法 会负 责窗口 在面板 栈中的 深 度
panel 对 象具 有 以下 方法 panel
above  返回当 前 面 板之上 的面板
below 返回当 前 面板之下的面 板
bottom 将 面 板推 至栈底部
hidden 如果 面板 被隐 藏 不 可 见则 返回 true  否则 返回 false
hide 隐 藏面 板
这 不 会删 除对 象它只 是让 窗口 在 屏 幕上 不可见
movey  x 将面 板移 至屏幕 坐标 y  x
replacewin  将与 面板相 关 联的窗口改 为窗口 win
setuserptrobj  将面板 的 用户 指向设为 obj
 这 被用 来将 任 意数 据与 面 板相 关 联数 据可以是 任何 python  对象
show 显 示面板面板 可能 已 被隐藏
top  将面板推 至栈顶 部
userptr 返 回面板的 用户 指针
这 可 以 是 任何 python  对 象
window  返 回 与 面板 相 关联 的窗口对 象
curses 终 端字符 单 元显 示 的处 理
curses  模 块 提 供 了 curses  库的 接 口 这是可 移植高 级终 端处理 的 事 实 标 准
虽 然 curses  在 unix  环境中 使 用最 为 广泛但也 有适 用 于 windowsdos  以及 其 他可 能 的 系统 的 版 本
 此扩 展 模块 旨在 匹 配 ncurses  的 api 这 是 一 个 部 署在 linux  和 unix 的 bsd 变 体上 的开 源 curses  库
注 解每当 文 档 提 到 字 符时 它可以被 指 定为 一个整 数一个 单字符 unicode  字符 串或 者 一 个单 字 节的 字节 字 符 串
 每 当 此 文 档 提到 字 符 串 时 它 可以 被 指 定 为一 个 unicode  字 符 串 或 者 一个 字节字 符 串
 注 解 从5
4 版 本 开 始 ncurses  库使 用 nllanginfo  函 数 来 决 定 如 何 解 释 非 ascii 数 据
这意 味着 你需要 在程 序 中 调用 locale
setlocale  函 数 并使 用 一种 系统 中 可 用 的 编 码方 法 来编 码 unicode 字 符 串
这个例子 使用了 系统 默认 的编 码 import  locale  locale
getpreferredencoding  然 后 使用 code 作 为 str
encode  调 用 的 编 码
参 见 模 块 curses
ascii  在 ascii  字 符 上 工作 的 工具 无 论你 的 区 域设 置 是 什 么
 模块 curses
panel 为 curses  窗口添 加 深 度的 面板栈扩 展
模 块 curses
textpad 用于 使 curses  支 持 emacs 式 绑定 的可 编辑文 本部 件
用 python  进行 curses  编 程 关 于配合 python  使用 curses 的教 学材料由 andrew  kuchling  和 eric  raymond 撰 写
 python 源 码发 布 包的 toolsdemo  目录包含 了 一些使 用 此 模块 所 提供 的 curses  绑定 的示 例程 序
函 数
window  对 象
 常 量
 自 定 义 python  解 释 器
 本章中 描述 的 模块 允 许 编写 类似 于 python 的交 互 式解 释 器 的 接口
 如果 你 想 要 一 个支 持 附 加 一 些 特殊功能 到 python  语 言 的 python  解释器你应 该 看看 code  模 块
 codeop 模 块 是 低 层 级的用 于 支持编 译 可 能 不 完 整 的 python 代 码块
 本 章 描 述 的 完 整 模 块列表 如下 code  解 释器基 类交 互 解释 器 对 象交互 式控 制 台对象 codeop  编 译 python  代码
dataclasses  数据 类
 源 码 libdataclasses
py  这 个模块 提 供 了一个 装饰 器和 一 些 函 数 用 于自 动 添 加生 成的 specialmethods  例如 init  和 repr 到 用户 定义 的 类
 它 最初 描述 于 pep 557
 在 这些 生成 的 方 法中 使 用 的 成 员 变 量使用 pep 526类 型注释 定义
 例 如 这 段 代 码 from  dataclasses  import  dataclass  dataclass  class  inventoryitem  class  for  keeping  track  of  an  item  in  inventory
quantityonhand 除 其 他 事情外 将添 加 init 其 看 起 来 像 def  initself  name  str  unitprice  float  quantityonhand  int 0 self
quantityonhand  quantityonhand 请 注 意 此 方法 会自 动添 加 到 类中 它 不 会 在上 面 显示 的 inventoryitem  定 义中 直接 指 定
3
7 新 版功 能
 模 块 级装 饰 器、 类 和函 数
初 始化 后 处 理
生 成 的 init  代 码 将调 用一个 名为 postinit  的 方 法 如 果在 类上 已 经 定 义了 postinit 
 它通 常被 称 为 self
postinit 
 但是 如 果 定 义了 任 何 initvar 字段 它们 也将 按 照 它 们 在 类中 定义 的 顺序 传 递 给 postinit 
如 果 没 有 init  方法 生成 那么 postinit  将 不会 被 自 动调 用
 在 其 他用 途 中这允 许初 始 化依 赖 于 一 个 或 多 个 其他 字段 的 字 段值
 例 如 dataclass  class  c  a  float  b  float  c  float  fieldinitfalse  def  postinitself  self
b  有关 将 参 数 传 递 给 postinit  的 方法 请 参 阅 下 面有 关 仅初 始 化变 量的 段 落
另 请 参阅 关于 replace  处 理 initfalse 字 段 的 警 告
 类 变量
 两个 地 方 dataclass  实 际 检查 字 段 类型 的 之一是 确定字段 是否是如 pep 526 所定 义 的 类 变量
 它通 过 检查字 段 的类型 是否为 typing
classvar 来 完成 此 操 作
 如果 一个 字 段是一 个 classvar 它将被 排 除 在 考 虑范 围之 外并被 数据类机 制忽 略
这样 的 classvar 伪 字 段不 会由 模块 级的 fields 函 数返 回
仅初 始 化变 量
 另 一个 dataclass  检查 类 型 注 解地 方是 为了确 定 一 个字段 是 否 是一 个仅初 始化变 量
它 通 过查 看 字段 的类 型是 否 为 dataclasses
initvar 类 型来实 现
 如 果 一 个字段 是一 个 initvar  它被 认为 是一 个 称 为仅 初始 化字 段 的 伪字 段
 因 为它 不是一 个真 正的 字段 所以它不 会被 模块 级的 fields 函 数 返回
 仅 初 始化字 段作 为参 数添 加到 生 成的 init 方 法中 并传递给 可 选的 postinit  方 法
 数据类 不会 使用 它们
例如 假设 一 个 字段 将从 数据库 初始 化 如 果在 创 建 类时未提 供其值 dataclass  class  c  i  int  j  int  none  database  initvardatabasetype  none  def  postinitself  database  if  self
lookupj  c  c 10 databasemydatabase  在这 种 情 况下 fields 将返 回 i 和 j 的 field  对象 但 不 包括 database 
冻结 的实例
 无法创建 真正 不 可变的 python  对象
但 是通过将 frozentrue  传递 给 dataclass  装 饰 器 你 可以 模拟 不 变性
 在这种 情况下数 据类 将 向类 添 加 setattr 和 delattr 方 法
些方法 在调 用 时 会 引 发 frozeninstanceerror 
使 用 frozentrue  时会 有很小 的性能损 失 init 不能 使用 简 单的 赋 值来 初始化字 段并 必须 使用 object
 setattr 
 继承
 当数 组 由 dataclass 装饰 器创 建时它 会查看 反 向 mro  中的 所 有类 的 基类即 从 object 开 始 并 且 对于 它找到 的每 个数 据 类 将该基类 中的 字 段添 加到 字段 的 有序映 射 中
添 加 完所 有基 类字段后它 会将 自己 的 字 段添 加到有 序映 射 中
 所有生成的方 法都将 使 用 这种 组合 的计 算的有 序 字段 映射
由 于字 段是 按插 入顺 序排 列 的 因 此派生 类会 重 载 基类
 一 个例 子 dataclass  class  base  x  any 15
0 y  int 0 dataclass  class  cbase  z  int 10 x  int 15最 后的 字 段列表依 次 是 x 、 y 、 z 
 x  的最 终类 型是 int  如 类 c  中 所指 定的那 样
为 c 生 成的 init 方 法看起来 像 def  initself  x  int 15 y  int 0 z  int 10
默 认 工 厂函 数
 如果 一个 field 指 定 了 一个 defaultfactory  当 需 要 该 字段 的默认 值时 将使 用 零 参 数调 用它
例 如 要创建列 表的 新 实 例 请使 用 mylist  list  fielddefaultfactorylist  如 果一 个字段 被 排除在 init 之 外使 用 initfalse 并 且字 段也 指定 defaultfactory  则默 认的 工厂 函数 将始 终 从 生成 的 init 函 数 调 用
 发生 这种 情 况是 因 为没 有其 他方 法可 以为 字段 提供 初 始 值
可变的 默 认值
python  在类 属性中存 储 默 认成 员变 量值
 思考这个 例子 不使 用数 据 类 class  c  x  def  addself  element  self
x  请 注 意类 c 的 两个 实例 共享 相同 的类 变 量 x 如预 期的那 样
使 用数 据类 如果 此代码 有效 dataclass  class  d  x  list  def  addself  element  self
x  element  它 生成的 代码类 似于 class  d  x  def  initself  xx  self
x  这与 使用类 c  的原 始示 例具有 相同 的 问题
 也就 是 说在 创 建 类实例 时 没有为 x  指 定 值 的类 d  的 两个实 例将 共享相 同的 x  副本
由 于数据 类 只使用 普通 的 python 类 创建因 此它 们 也 会共享此 行为
 数据 类没 有通 用的 方 法来检 测这 种情 况
 相反 如 果 数 据 类检测 到类 型为 list 、 dict 或 set 的 默 认参 数则会 引发 typeerror 
 这 是 一个 部分解 决方 案 但它 可以 防止 许多常 见 错误
 使 用默 认 工厂函数是 一 种 创建 可 变类 型新 实 例的 方法并将 其 作 为 字段的 默认 值 dataclass  class  d  x  list  fielddefaultfactorylist  assert  d
异 常
frozeninstanceerror 在 使用 frozentrue 定 义的 数据 类上 调用 隐 式 定义 的 setattr  或 delattr  时 引 发
 数 据 类 型
datetime  基本 的 日期和 时 间类 型
 感知型对 象和 简单 型对 象
日期 和时 间 对象 可以 根据 它们 是 否 包 含时区信 息而分 为 感 知型和 简 单型两 类
充 分掌握应 用性 算法和政 治性时间 调 整信 息例 如时区 和夏 令 时的 情况 下一 个感知 型对象 就 能相 对 于 其 他 感 知 型对象 来 精确 定位自 身时 间 点
感知 型对 象是 用来表 示一 个没有 解释 空间 的固 定时 间 点
1简 单型 对象 没有 包含足 够 多的 信息来 无歧 义地相对 于其 他 datetime 对 象 来定 位自 身时间 点
不论一 个简单 型对 象所代表 的是 世界标准 时间 utc 、当 地时 间还是某 个其 他时区的 时间完 全取决于 具体 程序 就像 一个 特定数字所代 表的 是米、 英里还是 质量 完全 取决于具 体程 序一 样
简 单型 对象 更易于理 解和 使用 代价 则是忽 略了某 些现 实性考量
对 于要 求感 知型对 象的 应用 datetime  和 time 对 象具有一 个 可选 的时区 信 息 属 性 tzinfo 它可 被 设 为抽 象 类 tzinfo 的子类 的一个实例
 这些 tzinfo  对 象会捕 获与 utc 时 间的差 值、时区名称 以及夏令 时是 否 生效 等信 息
datetime 模块只 提供了 一个具体的 tzinfo  类即 timezone  类
timezone 类 可以 表 示 具有 相对 于 utc 的 固定时差 的简 单时区例如 utc  本 身或 北美 的 est 和 edt  时 区 等
支 持时 间的 详 细程 度取 决于具 体的 应用
 世界 各 地的时间 调整 规 则 往 往 是 政治 性多 于合 理性 经常 会发生 变化 除 了 utc 之 外 并没 有一 个 能适 合所 有应 用的标准
常 量
minyear  date 或 者 datetime 对 象允 许的最 小年 份
常 量 minyear 是1
maxyear  date 或 datetime  对 象 允 许最 大的 年 份
 常量 maxyear  是9999
有效 的 类型
date  一个 理想 化的简单型 日期 它 假设 当今 的 公历 在过去 和 未来 永远 有效
 属 性 year  month  and  day
time 一个独立 于 任 何特 定日 期的理 想化 时间 它假设每一 天都 恰好等于246060 秒
 这里 没有闰秒 的 概 念
包 含属 性 hour  minute  second  microsecond 和 tzinfo
datetime  日期 和时 间的 结 合
 属 性 year  month  day  hour  minute  second  microsecond  and  tzinfo
timedelta 表 示两 个 date 对 象 或者 time  对 象或 者 datetime 对 象之 间的时间间 隔精 确到微 秒
tzinfo 一 个描 述时区 信息 对象 的抽 象基 类
用 来 给 datetime 和 time  类提 供自 定义 的时间 调整 概念例 如处 理时 区和 或夏 令 时
timezone 一 个实 现了 tzinfo 抽 象基 类的 子类用 于表示 相对 于世界 标准 时间 utc  的偏 移量
3
2 新 版功 能
 这些类 型的 对 象都 是 不可 变 的
子 类关系 object  timedelta  tzinfo  timezone  time  date  datetime
 通用 的 特征 属性
date  datetime  time  和 timezone 类 型共 享这 些通 用特 性这些类 型的 对象 都是不可 变的
这 些类 型的 对象是可哈 希的 这意 味 着它 们可 被作 为字 典的 键
这 些 类型 的对 象支 持通 过 pickle  模块 进行 高效 的封 存
确 定一 个 对 象是 感知 型 还 是简单型
date  类型 的对 象都是简 单型 的
time 或 datetime  类 型 的对 象可 以是 感 知型 或 者简 单型
一个 datetime 对 象 d 在 以 下 条件 同时成 立时将 是感知型的1
tzinfo  不为 none 2
utcoffsetd 不 返回 none 在其他 情况 下 d 将是简 单型 的
一 个 time 对象 t 在 以 下 条 件同 时成 立时 将是 感知 型的1
tzinfo  不为 none 2
utcoffsetnone  不 返回 none
 在 其 他情 况 下 t 将 是简 单型 的
 感 知型 和简单 型 之间 的 区别 不适 用于 timedelta  对象
timedelta  类 对象
classtimedelta  用法 示例
 一个 标准 化 的附加示 例 components  of  anotheryear  add  up  to  exactly 365 days  from  datetime  import  timedelta  year  timedeltadays 365 anotheryear  timedeltaweeks 40 days 84 hours 23
0 timedelta  算 术 运算 的示 例 from  datetime  import  timedelta  year  timedeltadays 365 tenyears 10 year  tenyears  datetime
date 对 象
classdate  用 法 示例
 计算 距 离 特 定 事 件天 数的例子 import  time  from  datetime  import  date  today  date
days 202 使 用 date 的更多 例 子 from  datetime  import  date  d  date
datetime 对 象
 用 法示 例 datetime
使用 datetime  对象 的例 子 from  datetime  import  datetime  date  time  timezone  using  datetime
以 下 示例 定义 了 一个 tzinfo  子 类它 捕获 kabul  afghanistan 时 区的信息该 时区使用4 utc 直 到1945年 之后则使用430 utc  from  datetime  import  timedelta  datetime  tzinfo  timezone  class  kabultztzinfo  kabul  used 4 until 1945 when  they  moved  to 430 utcmovedate  datetime 1944123120 tzinfotimezone
utcmovedate  return 0430 return 04 上述 kabultz  的用 法 tz 1 kabultz  datetime  before  the  change  dt 1 datetime 190011211630 tzinfotz 1 printdt 1
time  对象
 用 法示 例 time
使 用 time 对 象的 例子 from  datetime  import  time  tzinfo  timedelta  class  tz 1 tzinfo 
tzinfo  对象
timezone 对 象
timezone 类 是 tzinfo  的子类 它的 每个 实例 都 代 表 一个 以与 utc 的 固定 时差 来定 义的时 区
此 类的 对象 不可被用 于代 表某 些特 殊地 点的时 区信 息这 些地点在 一 年的 不 同日期会使 用 不同 的时 差或 是在 历 史上对民 用时间进行 过调整
timezoneoffset  namenone  offset  参 数 必 须 指定为一个 timedelta  对象 表 示 本 地时间 与 utc 的 时 差
它必须 严格限制于 timedeltahours 24 和 timedeltahours 24之间 否则 会引 发 valueerror
 name 参 数 是可 选的
 如果 指定 则必须 为 一个字 符串 它将 被 用作 datetime
tzname  方法 的返 回值
3
2新 版功能
 在3
7版 更 改 utc 时 差不再 限制为 一个整 数 分 钟值
utcoffsetdt  返 回当 timezone  实例被 构造 时指 定 的 固定 值
 dt  参数会 被 忽略
 返 回 值是一个 timedelta 实 例 其值等于本地 时间 与 utc 之 间的时 差
在3
7 版更改 utc  时差 不再限 制为一 个整数 分钟 值
tznamedt 返 回当 timezone 实 例 被构 造时 指 定 的固定 值
如 果没 有 在 构 造 器中 提供 name  则 tznamedt 所 返回 的名 称将 根 据 offset 值 按以 下规 则生 成
如 果 offset 为 timedelta 0 则名 称为 utc  否则 为字 符串 utc ± hhmm  其 中± 为 offset 的 正 负 符号 hh  和 mm 分 别 为 表 示 offset
hours  和 offset
minutes 的 两 个数 码
在3
6版 更 改 由 offsettimedelta 0 生成的 名称 现在为 简单 的 utc 而 不再 是 utc 0000
dstdt 总 是返 回 none
fromutcdt 返 回 dt  offset
 dt 参 数 必 须为 一个感 知型 datetime  实例其中 tzinfo  值 设为 self
 类属 性 timezone
utc  utc 时 区 timezonetimedelta 0
strftime 和 strptime 的 行 为
date  datetime  和 time 对 象都支 持 strftimeformat 方 法可 用来 创 建 由一 个 显 式格 式字 符串 所 控 制的 表示 时间的字 符 串
相 反地 datetime
strptime  类会 根据 表示 日期 和时间 的 字 符 串和 相应 的格 式字 符 串 来创 建一 个 datetime 对 象
下 表提 供 了 strftime  与 strptime  的高 层级比 较 strftime  strptime 用 法 根 据给 定 的 格式 将 对象 转 换为 字符串将 字 符 串解析 为给定 相应 格 式的 datetime  对象 方 法类 型实 例方 法类 方法 方法 date  datetime  time  datetime  签名 strftimeformat  strptimedatestring  format 
strftime 和 strptime  format  codes
以 下列 表显 示 了1989版 c  标准所 要求 的全 部格式代码它 们在带 有标 准 c 实 现的所 有平 台 上均 可用
 指令 意 义 示例 注释 a  当地工 作 日的 缩写
 sun  mon 
 sat 1 enus  so  mo 
 sa  dede  a 本 地化 的星期 中每日的 完整 名称
 samstag  dede  w 以 十进 制 数显 示 的工作 日其 中0表01
6 示星期日6 表 示星 期六
 d  补零 后以 十 进 制数 显示 的月份 中的0102
319一 天
 b 当地 月份 的缩 写
 jan  feb 
 dec 1 enus  jan  feb 
 dez  dede  b 本 地化的月 份 全名
 january  february 
 dezember  dede  m  补 零后以十 进 制数 显示 的月 份
0102
129 y 补 零后 以 十进 制 数表 示的 不带 世0001
999纪 的年份
 y  十进 制数 表 示 的带世 纪的年份
00010002
201322014
99989999 h  以补零 后 的十进 制数表示 的小时240001
239 小 时 制
 i 以补 零 后的 十进 制 数表 示的小 时120102
129 小 时制
 p  本地 化的 am  或 pm 
 am  pm  enus  am  pm 1 dede 3 m 补零 后以 十进 制数显 示的分 钟
0001
599 s 补零 后 以十进 制数显 示的 秒
0001
5949 f 以 十 进 制数表 示的 微秒 在左 侧补 零000000000001
5
999999 z  utc 偏 移量格 式为空000004006± hhmmss
ffffff  如 果 是简1030063415单 型对 象 则 为空 字符串
030712
345216 z 时 区名称如 果对 象为 简单型 则 为空空 utc  gmt 6 字符串
 j  以补 零后 的十 进制 数 表示 的一 年中 的001002
3669日 序号
 u  以 补 零 后的 十 进 制 数 表 示 的 一年 中的0001
537周 序 号星期日作 为 每周 的第 一 天9
在 新的 一年 中第 一个星期 日之前的 所有日子 都被视为 是在第0周
 w  以十 进制 数表示的 一年中 的 周序 号0001
537 星期 一作 为每 周的 第一 天
在新9 的一 年中 第 一 个第 期一之前 的所 有日 子 都 被 视为是在 第0 周
 c 本地 化的适当 日期和 时 间表 示
 tue  aug 1621300019881 enus  di 16 aug 2130001988 dede  x 本地化 的 适 当日期表 示
081688 none 108161988 enus 16
1988 dede  x  本地 化的 适当 时 间 表 示
213000 enus 1213000 dede 字 面的字 符
为了方 便 起 见还 包 括 了 c 89标准 不需 要 的 其 他一些指令
 这些 参数都 对应于 iso 8601 日期 值
 指令 意义示例注 释 g 带 有 世纪 的 iso 8601年 份表 示包00010002
20138 含 大部分 iso 星期 v  的年份2014
99989999
 u 以十进 制 数显示的 iso 8601星 期 中12
7的 日 序 号 其中1 表示星期 一
 v 以 十进制数显示 的 iso 8601 星期0102
538 以星期一作 为每 周的第 一 天
第019周 为包 含1月4日 的星 期
这 些代 码 可能不 是 在所有 平 台 上都可与 strftime  方法 配合 使用
 iso 8601年份 和 iso 8601 星期指 令 并不能 与 上 面的年份 和 星 期序号 指令 相 互替代
 调用 strptime  时 传 入不 完 整 或 有歧 义的 iso 8601 指令 将 引 发 valueerror
对完整 格式代 码集 的 支持 在 不 同 平 台上 有所差 异因 为 python  要调 用所 在 平 台 的 c  库 的 strftime 函 数 而 不 同平台 的差 异是 很常见的
 要查看你 所 用 平台 所 支 持 的完 整 格 式代码 集请 参阅 strftime 3文 档
3
6新版 功 能 增加了 g  u 和 v
 技 术 细 节
dbm  unix 数据 库 接口
dbmgnu  gnu  对 dbm 的重 解 析
 源代码 libdbmgnu
py  此模 块与 dbm 模块很 相似但是 改用 gnu 库 gdbm  来提供 某 些附加 功能
 请注意 由 dbm
gnu  与 dbm
ndbm 所创建 的文件 格 式是 不 兼 容的
dbm
gnu 模块 提 供 了 对 gnu  dbm 库的接 口
 dbm
gdbm 对 象 的 行 为类 似 于映射字 典区别 在于 其 键 和 值总是会在 存储 之 前被 转换 为 字 节 串
打 印 gdbm  对象 不会 打印 出键 和值并且 items 和 values  等 方法 也不 受 支持
error  针对 dbm
gnu 专 属 错 误例 如 io 错 误 引发
 keyerror 的引发 则针对一 般映 射 错 误 例如指 定 了 不正确的 键
openfilename  flag  mode  打开一个 gdbm  数据 库并返回 gdbm  对 象
 filename  参数 为 数 据 库 文 件名称
 可选 的 flag  参数可以是 值意 义 r  以只 读 方 式打开现有 数据库 默认 w 以读 写方式打 开现 有 数据 库 c 以 读 写方式 打开 数据库 如 果 不存 在则创建 它 n 始 终 创建一 个新的 空数 据库 以读 写 方式打开 下 列附 加字符可 被添加 至旗 标 以 控 制数据库 的打开 方 式值 意 义 f 以快速 模式 打 开 数据库
 写入 数 据 库将 不会同步
 s  同步 模式
 这将导致数 据库的 更 改立即写 入文 件
 u 不要 锁 定数据库
 不是 所有旗标 都 可 用于 所有 版本 的 gdbm
模 块 常量 openflags  为包 含 受支持 旗标字 符的 字 符串
如果指 定了无效 的旗标则 会引发 error
可选 的 mode 参数 是文 件 的 unix  模 式 仅在 要 创 建数 据库时才 会 被使 用
其默认 值为 八进 制数0 o 666
除 了与 字 典类 似的方 法 gdbm 对 象还 有以 下方 法 gdbm
firstkey 使 用此 方法和 nextkey  方法可 以循 环遍 历 数 据 库中 的每 个 键
 遍历的顺序 是 按 照 gdbm 的 内 部 哈希 值而 不 会根 据 键 的 值排 序
此 方 法将返 回起 始键
nextkeykey 在遍 历 中返 回 key  之后 的的 下 一个 键
以 下代 码将打印 数 据库 db  中 的 每个 键 而不 会 在 内 存中创建 一 个包 含 所有 键 的 列表 k  db
reorganize 如果你 进 行了 大 量 删除 操作并 且 想要 缩 减 gdbm 文 件所 使用的 空间 此 例 程 将可重新 组 织数 据 库
 除 非 使 用此重组 功能 否则 gdbm 对 象不会缩 减数据 库文件 大小 在 其 他情况下 被删除 的 文件 空间 将 会保 留并 在添加新的 键 值对 时被 重 用
sync 当 以快速 模 式 打开数据 库 时此方法会 将任何未 写入 数 据 强 制写入 磁 盘
close  关闭 gdbm 数据 库
dbmndbm  基于 ndbm 的接 口
源 代码 libdbmndbm
pydbm
ndbm 模 块 提供 了对 unix  ndbm  库 的 接 口
 dbm  对 象的行 为类 似 于映射字典 区别 在 于其 键 和 值 总是被存 储为字 节串
打印 dbm  对象不会 打印 出 键和 值并 且 items  和 values 等方 法也 不受支 持
 此 模块 可与经典 classic  ndbm  接口 或 gnu  gdbm  兼容接 口一同 使用
 在 unix 上 configure  脚本 将尝 试 定位 适当 的 头文 件 来 简化 此 模块 的构 建
error  针对 dbm
ndbm  专属 错 误例如 io  错误引 发
 keyerror  的 引发则针 对 一般 映 射 错 误例 如指定了 不 正确的键
library  所 使用 的 ndbm  实现库的 名 称
openfilename  flag  mode 打 开 一个 dbm  数据 库 并返 回 ndbm 对 象
 filename  参数为 数据 库 文 件名称不带
dir  或
pag 扩 展名
可 选的 flag  参数必 须是 下列值之 一 值意义 r  以只 读方 式打开现有 数据库 默认 w  以 读写 方 式打 开现有 数据 库 c 以 读写 方式 打 开数据 库如 果不 存 在 则创 建它 n 始 终创 建一个 新 的空数 据库以读写方 式 打开可选的 mode  参数是 文件 的 unix 模式 仅 在要 创 建数 据库 时才 会被 使 用
 其默认 值为 八 进 制数0 o 666 并将被 当前 的 umask 所 修 改
 除 了与 字 典类似 的方 法 ndbm 对 象 还有 以下 方 法 ndbm
close  关闭 ndbm  数据 库
dbmdumb  便携 式 dbm  实 现
源 代 码 libdbmdumb
py  注解 dbm
dumb  模 块 的目 的是 在 更健 壮 的模块 不可 用时 作 为 dbm 模块的 最 终回 退 项
 dbm
dumb 不 是为高 速 运行 而编 写的 也 不像 其他 数据 库 模 块 一 样被 经 常使 用
dbm
dumb 模 块提供了 一个 完全 以 python 编写 的 持久化 字典 类接 口
 不同于 dbm
gnu  等 其他 模块 它 不需要 外部库
与其 他持久 化 映射 一 样它 的键 和值 也 总是 被存 储为 字 节串
该 模块 定义以 下内 容 exception  dbm
error  针对 dbm
dumb  专属 错误例 如 io 错 误引 发
 keyerror 的引 发 则针 对 一般映 射例如 指定 了不 正 确 的键
openfilename  flag  mode  打开 一 个 dumbdbm 数据 库 并 返回 dumbdbm  对象
 filename  参数为 数 据库 文件的主名 称 不带 任 何特 定扩展 名
创 建一个 dumbdbm 数据 库 时将 创建 多个 带有
dat  和
dir 扩 展 名的 文 件
可 选的 flag  参数 可以是值 意 义 r 以 只 读方 式打 开现 有 数据 库默 认 w  以读 写 方 式打开 现有数 据库 c 以 读 写方 式打开 数 据库 如 果不存 在则创 建它 n  始 终创 建一 个新 的空 数据库 以 读 写方 式 打 开可选 的 mode 参 数是文件 的 unix 模式 仅在要 创 建数 据 库 时 才会 被使 用
其 默 认值 为 八 进制数0 o 666 并将被当 前 的 umask 所 修 改
 警告 当载 入 包含 足 够巨 大复 杂 条 目的 数 据 库时 有 可 能导致 python  解释 器的 崩溃 这是 由于 python  ast  编译 器 有 栈深 度限 制
在3
5版 更改 open  在 flag 值 为 n  时 将总是 创建 一个 新的 数据 库
在3
8 版更 改附带 r 旗 标 打开 的 数 据 库 现 在将 是只 读 的
附带 r  和 w  旗标的 打 开操 作不会再 创建 数据 库
除 了 collections
mutablemapping 类 所提供 的 方 法 dumbdbm 对象还 提供 了以 下方法 dumbdbm
sync  同 步磁盘上 的目 录和 数据 文 件
 此方法会 由 shelve
sync 方法 来调 用
close 关 闭 dumbdbm 数据 库
 调试 和分 析
decimal 十 进制定点 和 浮点 运算
 源码 libdecimal
pydecimal  模块 为 快 速正 确舍 入 的 十进 制浮 点 运算 提供 支持
 与 float 数据 类型 相 比它具 有以 下几 个优点 decimal  基于 一个浮点 模型 它是 为人 们设计的并 且必然 具有 最 重要 的 指导 原则——计 算机 必须 提供 与人 们 在学校 学习 的算 法 相 同的 算法
——摘 自十 进制算 术 规范
 decimal 数 字的表示是完 全 精确的
相比 之下1
1和2
2 这 样的 数 字在 二进 制浮 点中 没 有 精确的 表示
 最 终 用户 通常不 希望1
2 如二 进 制 浮 点数 表 示那样 被显 示为3
3000000000000003
 精 确 性 延续 到 算 术中
 在十 进 制浮 点 数中0
3恰 好等 于零
在 二进 制 浮 点 数 中结 果 为5
5511151231257827 e 017
虽然接 近于零 但 差异 妨 碍 了可靠 的相等 性检验 并 且差 异可能 会 累积
 因 此在具 有严格 相等 不变量 的会 计 应用 程序中 decimal 是首 选
十进制 模 块包 含 有效 位的 概念 因此1
20的结果 是2
50
保 留 尾随 零 以表 示有 效位
 这是货 币的 惯用 表示 方 法
 乘法则沿用 教 科书 中 保留 被 乘数中 的所 有数字 的方 法
例 如1
2结果 是1
56而1
20 结果是1
5600
 与基 于硬件的二 进制浮 点不 同十进制模块 具 有用 户 可更改 的 精度默认 为28 位可以与给 定 问题 所需 的 一样大 from  decimal  import  getcontext
1428571428571428571428571429 二进 制和 十 进制 浮点都 是 根据已发 布 的标准实 现的
虽 然 内置浮点 类型只 公开 其功 能 的 一 小部 分但 十进 制模 块 公开 了 标 准的所 有必需 部 分
在需 要时程 序员 可 以完 全 控 制 舍入和信 号处 理
这 包括通过使用 异 常来 阻 止任何 不 精 确操 作来强制 执行 精 确算术 的选 项
 十进 制模 块 旨 在支 持 无 偏 见 精 确 的非连 续十 进 制 算术 有时 称 为定 点算术 和舍 入浮点 算 术
——摘自十 进制 算术规 范
模块 设计 以 三个概 念 为中心十 进制 数算术 上下 文 和 信 号
 十 进制 数是不 可 变 的
 它有一 个符号 系数 数字 和一 个指 数
 为了保 持重 要 性 系数数 字不 会截断 尾随零
 十进制数 也包 括特 殊 值 例 如 infinity  infinity  和 nan 
 该标准 还区分0 和0
 算术的 上下 文 是 指 定精度、舍 入规 则、 指数 限制、 指 示操 作结 果 的标 志以 及确 定符 号是 否被 视 为异 常的 陷阱 启用 器的 环 境
舍 入 选项 包括 roundceiling 、 rounddown 、 roundfloor 、 roundhalfdown  roundhalfeven 、 roundhalfup 、 roundup  以 及 round 05 up
信号 是 在计算 过程 中 出 现的 异常 条件 组
 根 据 应用 程序 的需 要信 号可 能会被 忽略被 视为信 息或 被 视为异 常
十 进制 模 块 中 的 信号 有 clamped 、 invalidoperation 、 divisionbyzero 、 inexact 、 rounded 、 subnormal 、 overflow 、 underflow  以 及 floatoperation 
对 于每 个信 号都有一 个标 志 和 一 个 陷 阱 启 动器
遇到 信号 时其 标志 设置 为1 然后 如 果陷阱 启用 器设 置为1则引 发 异常
 标 志 是粘 性的 因 此用 户 需要在 监 控计 算 之 前重 置 它们
 参见 ibm  的通 用十 进 制 算 术规 范 the  general  decimal  arithmetic  specification
 快 速 入门 教 程
通 常 使 用小 数的 开 始 是导入 模块 使 用 getcontext  查 看 当前 上下文 并 在必 要时 为精度、舍 入或 启用 的 陷阱 设 置 新 值 from  decimal  import  getcontext  contextprec 28 roundingroundhalfeven  emin 999999 emax 999999 capitals 1 clamp 0 flags  trapsoverflow  divisionbyzero  invalidoperation  getcontext
prec 7 set  a  new  precision 可以从 整数、 字 符 串、 浮点数 或元 组 构 造十 进制实 例
从 整数 或浮 点构 造 将 执 行该 整 数或 浮点 值 的精 确 转 换
 十 进制 数 包括 特殊 值例 如 nan  代 表非数 字正的和 负的 infinity  和0 getcontext
414213562373095048801688724 decimalnan  decimalnan  decimalinfinity  decimalinfinity 如果 floatoperation  信号 被捕 获构造 函数 中的小 数 和 浮 点 数 的意外 混合 或 排 序比 较 会引发 异常 c  getcontext  c
5 true 3
3 新 版功能
新 decimal  的重要 性仅 由输入 的位 数决 定
上 下文精 度 和舍入 仅在算术 运算 期 间发 挥作 用
85988如果超出 了 c 版 本的 内 部 限 制则构 造一 个 十进制 将 引发 invalidoperation  decimal 1 e 9999999999999999999 traceback  most  recent  call  last  file  stdin  line 1 in  module  decimal
invalidoperation 在3
3 版 更 改
 小 数与 python 的 其余 部分很 好地 交 互
 这 是 一 个小 的十 进制浮 点飞 行 杂技团 data  listmapdecimal 1
77 decimal 也可 以使 用一些数 学 函数 getcontext
log 10 decimal 1 quantize 方 法将 数字舍 入为固定指 数
 此 方法对于 将结 果舍 入 到固 定 的 位置 的 货币应用 程序非常有 用 decimal 7
 roundingroundupdecimal 8如 上所 示 getcontext  函 数访问 当前 上 下文 并 允 许更改设 置
这 种方法满 足 大多数 应用 程 序的 需求
对于更 高级的工 作 使用 context  构 造函 数创 建 备 用上 下 文可 能很有 用
要 使 用备 用活 动请 使用 setcontext 函数
根 据标 准 decimal 模 块提供 了两 个现 成 的标准 上下 文 basiccontext  和 extendedcontext 
前 者 对调 试特 别有用 因为许 多陷 阱都 已启 用 myothercontext  contextprec 60 roundingroundhalfdown  setcontextmyothercontext  decimal 1 decimal 7 decimal 0
142857143 decimal 42 decimal 0 decimalinfinity  setcontextbasiccontext  decimal 42 decimal 0 traceback  most  recent  call  last  file  pyshell 143 line 1 in  toplevel  decimal 42 decimal 0 divisionbyzero  x 0 上下文 还具 有 用 于监 视计 算 期 间遇到 的异 常情 况的 信 号标志
 标志保持 设 置直 到 明确 清除 因 此最 好通 过使用 clearflags  方法 清除 每组 受 监控计 算之前的 标志
 setcontextextendedcontext  getcontext
14159292 getcontext  contextprec 9 roundingroundhalfeven  emin 999999 emax 999999 capitals 1 clamp 0 flagsinexact  rounded  trapsflags  条 目 显 示 对 pi  的有理 逼 近被 舍入 超出 上下 文精 度 的数字 被抛 弃并 且结果 是不 精 确 的 一 些丢 弃的数 字 不 为零
 使用 上下文 的 traps  字段 中的 字典设置 单个 陷阱 setcontextextendedcontext  decimal 1 decimal 0 decimalinfinity  getcontext
trapsdivisionbyzero 1 decimal 1 decimal 0 traceback  most  recent  call  last  file  pyshell 112 line 1 in  toplevel  decimal 1 decimal 0 divisionbyzero  x 0 大 多 数程 序 仅 在程 序 开始时调 整 当 前 上下文 一 次
并且 在许多 应用 程序 中数 据在 循环 内单个 强制 转 换 为 decimal 
通过 创建上 下 文 集和 小 数程 序的大 部分 操 作数 据与 其他 python  数 字 类型 没有 区别
decimal  对象
decimalvalue 0 contextnone 根 据 value  构造 一个新 的 decimal 对象
 value  可以 是整 数字 符串元 组 float 或另 一个 decimal  对象
 如果 没有 给 出 value 则 返回 decimal 0
 如果 value  是 一个 字符 串 它应 该在 前 导和 尾随 空 格字 符以 及下划 线被 删除 之后符合 十进 制 数 字字符串语 法 sign  digit 0123456789 indicator  e  e  digits  digit  digit
 digits  exponentpart  indicator  sign  digits  infinity  infinity  inf  nan  nan  digits  snan  digits  numericvalue  decimalpart  exponentpart  infinity  numericstring  sign  numericvalue  sign  nan  当上 面 出现 digit  时也 允许 其 他十 进制 数码
其 中包 括来 自各种其 他语 言 系 统的十进制 数 码例 如 阿拉 伯印地语 和 天城 文的数 码以 及 全宽 数 码 uff 10到 uff 19
如果 value  是一个 tuple 它 应该有三 个 组 件一 个符号0表示 正数或1表 示负 数 一 个数 字的 tuple 和整数 指数
 例 如 decimal 014143返回 decimal 1
如 果 value  是 float 则 二 进制 浮点 值 无 损地转 换为 其精 确 的十 进制等效值
 此转换通 常需 要53位或更多 位 数的 精度
例如 decimalfloat 1
1转 换为 decimal 1
100000000000000088817841970012523233890533447265625
 context  精度 不会影响存 储的 位数
这 完全 由 value 中的位 数决 定
例 如 decimal 3
00000记 录所 有五个 零即 使 上下 文 精度 只 有 三
 context 参数 的目 的是确 定 value 是 格 式错 误的字符串 时该 怎么 做
如果 上下 文陷阱 invalidoperation 则 引发 异常 否则 构造函数返 回一个 新的 decimal  其值为 nan
构 造 完 成 后 decimal  对 象 是 不可 变 的
在3
2 版 更改 现在允 许构造 函数的参数 为 float  实例
 在3
3 版 更 改 float 参 数在 设置 floatoperation 陷 阱时 引发 异常
 默 认 情况下陷阱 已关闭
在3
6版 更改允许 下划 线进 行分组 就 像代码 中的 整数 和浮点 文字一样
 十进 制浮 点对 象 与其 他内 置数 值类 型 共享许多 属性 例如 float  和 int 
所 有 常 用 的 数学运 算和 特殊 方 法都 适用
同 样十 进制 对 象 可以复 制、 pickle 、打印、 用作字典键、 用作 集合元 素、 比 较、 排序和 强制转换为 另一 种类 型 例 如 float  或 int 
算 术 对 十进 制 对象 和 算术对 整数 和浮点数 有一些 小 的差别
 当 余数 运算 符应 用于 decimal  对象时结 果的符 号是 被 除数 的符 号而不 是除数 的符号741 decimal 7 decimal 4 decimal 3 整数 除法运 算符的行为 类似返回 真商 的整 数 部分 截 断 为零而不是 它的向 下取 整 以便 保留通常 的标 识 x  x  y  y  x  y 742 decimal 7 decimal 4 decimal 1和运算 符 实 现 了 remainder  和 divideinteger  操作 分 别如规范 中 所述
 十 进 制对象 通 常不能 与 浮 点 数或 fractions
fraction  实例 在算术 运算 中结 合使 用例如 尝试 将 decimal  加 到 float 将引 发 typeerror
但是 可以 使用 python  的比 较 运 算 符来比较 decimal  实例 x  和另一个 数 字 y 
这 样可 以避免在 对不同 类 型 的数字进 行 相等 比较时 混淆 结果
 在3
2版 更改 现在 完全 支 持 decimal 实例 和其他 数字 类型 之间 的 混 合 类型比 较
除了 标准的数 字属 性 十 进制 浮 点 对象还 有许 多 专门 的方法 adjusted  在移出 系数 最右边的 数 字 之后 返回调 整后的 指数直 到只剩下前 导数字 decimal 321 e 5
adjusted  返回7
用 于 确定 最高 有 效位 相对 于 小数点 的位 置
 asintegerratio 返 回一对 n  d  整 数 表 示 给定的 decimal  实例 作为分数、最 简 形式 项并带 有 正 分 母 decimal 3
asintegerratio 15750转 换是 精确 的
在 infinity 上引发 overflowerror  在 nan 上引 起 valueerror 
3
6新 版功 能
 astuple  返回一个 named  tuple 表 示 的数 字 decimaltuplesign  digits  exponent
 canonical  返回 参数 的 规范编 码
目 前一个 decimal  实 例的 编码始终是 规范的 因 此 该操作返 回其参数 不 变
 compareother  contextnone  比较 两个 decimal  实例 的 值
 compare 返 回一 个 decimal 实 例如 果 任 一 操作数是 nan  那么结 果 是 nan  a  or  b  is  a  nan  decimalnan  a  b  decimal 1 a  b  decimal 0 a  b  decimal 1 comparesignalother  contextnone  除 了所 有 nan 信号 之外此操作 与 compare  方 法 相 同
 也 就是说如 果两个 操 作 数都不 是信令 nan  那么任 何静 默的 nan  操 作数都 被视为 信令 nan
 comparetotalother  contextnone  使用 它们 的抽 象 表 示而 不是它 们 的 数值 来 比 较 两个 操 作数
 类似于 compare  方法 但结果给 出 了 一个 总 排序 decimal 实 例
两个 decimal  实例具 有 相 同 的数 值但不同的 表示形 式在 此 排序中比较 不相 等 decimal 12
comparetotaldecimal 12 decimal 1 静默和发 出 信号 的 nan 也包括 在总 排序中
 这个 函 数 的 结 果 是 decimal 0如 果 两个操 作数 具有相同 的表示 或是 decimal 1 如 果第 一 个操 作数 的总 顺序低于 第二 个操 作 数 或是 decimal 1 如 果第 一 个操 作数 在 总顺序 中高于 第 二个 操作 数
 有关总 排序 的 详细 信 息请参阅规 范
此操作 不受 上下 文 影响 且静 默 不更改任 何标志且 不 执 行 舍 入
 作 为例 外如 果无 法 准 确转 换第 二个 操 作数 则 c 版本 可 能会引发 invalidoperation
 comparetotalmagother  contextnone  比 较 两个 操作数使 用 它们 的抽象 表示 而 不是 它们 的 值 如 comparetotal 但忽略 每 个操作 数的 符 号
 x
comparetotalmagy 相当 于 x
 此操 作不 受上下 文 影 响且 静 默不 更改任何 标志 且不执 行舍 入
作 为 例 外 如果 无法 准确 转换 第二 个 操 作 数则 c 版 本可 能 会引 发 invalidoperation
 conjugate 只 返回 self  这种方法只 符合 decimal 规 范
 copyabs 返回 参 数 的绝对值
 此操 作 不受 上下 文影 响 并 且是静默 的没有更 改标 志且 不执 行舍 入
 copynegate  回到参 数 的否 定
此 操作不受上 下文 影响并 且是静 默 的 没有 标志 更改 且 不执 行舍入
 copysignother  contextnone 返 回 第 一个 操作 数的 副 本其 符号 设置 为与 第 二 个 操 作数的符 号 相同
例如 decimal 2
3 此操作 不 受上 下文 影响 且 静 默 不更 改任 何 标志 且不执 行 舍入
作 为例 外 如果 无法准确 转 换第 二 个操 作 数则 c  版本可能 会引发 invalidoperation
 expcontextnone 返回 给 定 数字的 自然指 数函 数 ex 的 值
结 果 使用 roundhalfeven  舍入 模式正 确舍 入
561702493119680037517373933 e 139 fromfloatf 将 浮点 数 转换为 十进制 数的 类 方法
 注 意 decimal
1 与 decimal 0
1不 同
由 于0
1在二 进制 浮点中不 能精 确表 示因 此该 值存储为最 接近 的可 表示值 即0 x 1
999999999999 ap 4
十进 制 的等 效值 是0
1000000000000000055511151231257827021181583404541015625
 注解从 python 3
2 开 始 decimal 实 例也可以直 接从 float  构造
fromfloatfloatinf  decimalinfinity 3
1 新 版功 能
 fmaother  third  contextnone  混合 乘 法加 法
返 回 selfotherthird 中 间乘积 selfother  没有 舍入
fma 35 decimal 11 iscanonical 如果参 数 是规 范的则为 返回 true 否 则 为 false 
目 前 decimal  实 例 总 是规 范的所以 这个 操作 总是 返 回 true 
 isfinite 如果 参 数是 一个 有限的 数则 返回 为 true 如 果参数 为无穷 大或 nan  则返 回为 false
 isinfinite 如果 参 数为 正负 无 穷大 则 返回 为 true 否 则为 false 
 isnan  如果参数 为 nan  无论 是否 静 默则返回为 true  否则 为 false 
 isnormalcontextnone 如 果 参数是 一个 标准 的 有 限数 则 返回 true
 如果 参 数为 零、次 标准 数、无 穷 大或 nan 则 返回 false
 isqnan  如果 参数 为静 默 nan 返 回 true  否则 返回 false
 issigned  如果 参数带 有 负 号则返回 为 true  否则 返回 false
 注意0和 nan  都可 带有符号
 issnan 如 果 参数为 显式 nan 则 返回 true  否 则 返 回 false
 issubnormalcontextnone 如果 参数为 次标准 数则 返 回 true 否 则返 回 false
 iszero 如 果参 数 是0正 负皆 可 则返 回 true  否则 返 回 false
 lncontextnone 返 回操作数的 自然 对数 以 e 为底
 结果是 使 用 roundhalfeven 舍 入模 式 正确舍 入 的
 log 10 contextnone 返 回操 作数的 以十为底 的对 数
结 果是使用 roundhalfeven  舍入 模 式正 确舍 入的
 logbcontextnone 对于 一个 非 零数 返 回 其 运算 数的 调整 后 指数作为一 个 decimal 实 例
 如 果 运 算 数为 零将返 回 decimalinfinity 并 且 产生 the  divisionbyzero  标志
如 果 运算 数 是 无 限大 则返回 decimalinfinity 
 logicalandother  contextnone  logicaland 是 需要 两个 逻辑 运算 数的 逻辑 运 算参 考逻 辑操 作数
 按位 输出 两运 算数 的 and 运 算的 结果
 logicalinvertcontextnone  logicalinvert  是一 个逻 辑运 算
结 果 是 操作 数 的 按位 求反
 logicalorother  contextnone  logicalor  是 需 要 两 个 logical  operands 的 逻 辑运 算 请参 阅 逻辑 操作数
结 果是两 个运 算 数 的 按位 的 or 运 算
 logicalxorother  contextnone  logicalxor 是需要 两 个逻 辑运算数 的逻辑 运算参 考逻辑操 作 数
结 果是按 位 输出 的两 运 算 数的 异或 运算
 maxother  contextnone  像 maxself  other 一 样 除了在 返 回之 前应用上 下文 舍 入规则 并且 用信 号 通知或 忽略 nan  值取 决 于 上 下文 以及 它们是发 信 号 还 是安 静
 maxmagother  contextnone 与 max  方法 相似但 是操 作 数使用 绝对 值 完 成比 较
 minother  contextnone 像 minself  other 一样 除 了在返回之 前应 用上 下 文舍 入规则并 且用 信号 通 知 或 忽 略 nan 值 取决 于 上下文 以及它们是 发信号 还 是安 静
 minmagother  contextnone 与 min  方 法 相似 但是操作 数使 用绝 对值完 成比 较
 nextminuscontextnone 返 回小于 给定 操 作 数的 上下 文 中可 表示的最 大数 字或者 当 前线 程的 上 下文 中的可表 示 的最 大数 字如果 没有 给定 上下文
 nextpluscontextnone  返回 大 于给 定 操 作 数的 上下 文中 可表 示的 最小数 字 或者 当前线程 的上 下文 中 的可 表示 的最小 数字 如果 没有给 定上 下 文
 nexttowardother  contextnone 如 果 两 运 算数 不相 等 返 回在第 二 个操 作 数 的方 向上 最接近 第一 个操 作 数的 数
 如果两操 作数 数 值上 相等返 回将符 号 设置为与第 二个 运 算 数相 同的第一 个运算数 的 拷贝
 normalizecontextnone 通过 去除 尾随 的 零并 将 所有 结果 等于 decimal 0的转 化 为 decimal 0 e 0 来标 准化数 字
用 于 为等效类的 属性 生成 规 范值
 比如 decimal 32
100 和 decimal 0
321000 e 2都 被标 准化 为 相同的 值 decimal 32
 numberclasscontextnone 返回 一个 字符串 描述 运算 数的 class 
返回 值是以 下 十个 字符 串 中 的一 个
 infinity  指 示运算 数为 负无 穷 大
 normal 指 示 该运算 数 是 负正 常数 字
 subnormal 指 示 该 运算 数 是负 的 次标 准数
 zero  指示 该运 算数 是负 零
 zero  指示该 运算数 是正 零
 subnormal 指 示该 运算 数是 正 的 次 标 准数
 normal  指 示 该 运 算 数是 正的标准数
 infinity  指 示 该 运 算数 是正无 穷
 nan 指示 该运 算数 是肃 静 nan 非 数 字
 snan 指 示 该运 算 数是 信号 nan 
 quantizeexp  roundingnone  contextnone 返回的 值 等 于舍 入后的第 一 个运 算数 并且 具有 第二个操 作数 的指 数
414与 其他 运算 不同 如果 量化运 算后的系 数长 度大 于精 度 那么会发 出 一个 invalidoperation  信 号
 这保 证了 除非 有一 个错误 情 况量 化 指数 恒等于 右 手 运算 数的指 数
与 其他运算 不同 量化 永不 信号 下溢 即使结果 不 正常且不 精确
 如果 第 二个 运 算数 的指 数 大 于第 一个 运算 数的指数 那 或 许需 要 舍入
在这 种 情况 下 舍入模 式由 给定 rounding  参 数 决定 其余 的 由给 定 context 参 数决定如 果参 数 都未 给定 使 用当 前 线 程 上 下文 的 舍 入模 式
每当 结 果的 指数 大 于 emax  或小 于 etiny 就 会 返回错 误
 radix 返 回 decimal 10即 decimal  类进 行所 有 算术运算 所 用的 数制 基 数
这是 为保持与 规 范描 述的 兼容 性 而加 入的
 remaindernearother  contextnone  返回 self  除以 other 的余 数
这 与 self  other  的 区别 在于 所 选择 的余 数要 使 其 绝对 值最 小化
更 准 确地 说返 回值 为 self  n  other 其 中 n 是最 接近 self  other  的实 际值 的整 数并且 如 果两 个整 数与 实际 值的差 相等 则会 选择 其中的 偶数
 如果结 果为零 则其符 号将 为 self  的符号
remainderneardecimal 10 decimal 5 rotateother  contextnone  返 回 对第 一 个操 作 数的 数码按 第二个 操作 数 所指 定的 数量进 行 轮 转的 结果
 第二 个操 作 数 必须 为 precision 至 precision  精度范 围 内的整 数
第 二个 操作 数的绝 对值 给 出要 轮转 的 位数
 如果 第二 个操 作 数为 正值 则向左 轮转 否 则向右轮 转
如有 必要 第一 个操 作数 的系数会 在 左侧填 充零 以达 到 precision 所 指定 的长 度
第 一个操 作数 的符 号和指 数 保 持 不变
 samequantumother  contextnone  检测 自 身与 other  是 否具有 相同 的 指数或 是否 均为 nan
 此操 作不 受上 下文 影 响且 静 默不 更改任何 标志且 不执 行舍 入
作 为例外如果 无法准 确 转 换第 二个操作 数则 c  版本 可能会引 发 invalidoperation
 scalebother  contextnone  返回 第一 个操作 数使 用第二个 操 作 数对 指数 进 行 调 整的 结果
 等价于返 回 第一个 操作 数 乘以10 other  的 结 果
 第二个 操作 数必须 为整 数
 shiftother  contextnone 返 回第 一 个 操作 数 的 数码按 第二 个操作 数所 指 定 的数量进 行移位的 结果
 第二个 操作数 必 须 为 precision 至 precision  范围 内的整数
 第二个 操 作 数的绝 对值 给出 要移 动 的 位数
 如 果第二个 操作 数 为正 值 则向 左移 位 否则 向 右移 位
移入 系数 的数 码为零
 第一 个操 作数 的符 号和指 数保持不 变
 sqrtcontextnone 返 回 参数 的平方根 精 确到完整 精 度
 toengstringcontextnone 转换 为 字 符串 如 果需 要指 数则 会 使 用工 程标 注法
 工 程 标注 法 的 指 数是3 的 倍数
 这 会在十 进 制位 的左 边保留至 多3 个数码并 可能 要求 添加 一 至两 个末 尾 零
例 如 此方 法会 将 decimal 123 e 1 转换 为 decimal 1
23 e 3
 tointegralroundingnone  contextnone 与 tointegralvalue  方 法 相同
保 留 tointegral 名 称 是为 了与 旧版 本 兼 容
 tointegralexactroundingnone  contextnone  舍入到 最 接 近的 整 数 发出 信 号 inexact 或 者如 果 发 生舍 入则 相应 地发 出 信号 rounded
 如果 给 出 rounding  形 参则 由其 确 定 舍入 模式 否则 由 给 定的 context  来确 定
如果 没有 给定 任何形 参则 会使 用 当前 上 下文的 舍 入 模式
 tointegralvalueroundingnone  contextnone  舍入到最 接近的 整 数而 不发 出 inexact  或 rounded 信号
 如 果给 出 rounding 则 会应用 其 所 指定 的舍 入模式 否 则 使用 所提 供 的 context 或当 前上 下文的 舍入 方 法
逻辑 操 作 数
logicaland  logicalinvert  logicalor 和 logicalxor 方法期 望 其参 数为 逻辑 操作数
 逻 辑 操作数 是 指数位 与 符号 位 均为 零 的 decimal 实 例并 且 其数 字 位 均 为0或1
 上下 文对象
上 下文是 算术 运算 所在 的环 境
它们管理 精 度、设置 舍入 规则、 确定 将哪些 信号 视为异 常 并 限制 指数的 范 围
 每 个线 程 都有自 己的 当前 上下 文可 使 用 getcontext  和 setcontext 函 数 来 读取或 修改 decimal
getcontext  返回 活 动线程 的当 前上 下文
setcontextc  将 活 动线程 的当 前上下文 设为 c
 你 也 可以 使用 with 语 句和 localcontext  函数来临 时改 变活动 上下 文
localcontextctxnone 返 回一 个上下文 管理器 它将在 进 入 with 语 句 时将 活动 线程 的 当前上 下文 设为 ctx 的 一 个副本 并在 退出 with  语句 时 恢复之前 的上 下文
如 果未指定上 下 文 则会使用 当前上 下文的 一个副本
 例如 以下 代码会将 当前 decimal  精 度设 为42位 执行 一 个 运算 然后 自动 恢复之 前 的 上 下 文 from  decimal  import  localcontext  with  localcontext  as  ctx  ctx
prec 42 perform  a  high  precision  calculation  s  calculatesomething  s  s  round  the  final  result  back  to  the  default  precision 新的 上 下文 也可 使 用下 述的 context  构造器 来创 建
此 外模 块 还 提 供了 三种 预设的 上下 文 class  decimal
basiccontext  这是由通 用十 进 制算术 规范 描 述 所 定 义的标 准上 下 文
 精度 设为 九
舍 入 设 为 roundhalfup
清除 所有旗标
 启 用所有 陷阱 视 为异常但 inexact  rounded  和 subnormal  除外
 由于 启用了许 多 陷阱 此 上 下 文 适用于 进 行 调 试
extendedcontext 这 是 由 通用 十 进制 算 术规范 描述 所定 义的 标准 上下 文
 精度 设为九
 舍 入设 为 roundhalfeven
 清除 所有旗 标
不 启用 任 何陷 阱因此 在计算 期 间 不会 引发 异 常
 由于禁 用了 陷阱此上 下 文 适 用于 希 望结 果 值为 nan  或 infinity 而不 是引 发 异常的应 用
这 允许应 用在出 现当其 他情 况下 会中 止程 序的条 件 时仍 能完 成 运 行
defaultcontext  此 上下 文 被 context  构造器 用作 新 上 下文 的 原 型
 改 变一 个字 段 例如 精度 的效 果将是 改变 context 构 造器 所创建 的新 上下 文的默认 值
此 上下 文 最适 用于 多线程环 境
在 线程 开始 前改 变一 个 字段 具有 设置 全系 统默 认值 的 效果
 不推 荐在 线程 开始后改 变字段因 为这 会要 求线 程同 步 避 免竞 争 条件
 在单 线程 环 境中最 好完 全 不使用此 上 下文
 而是 简单地 电显 式创建 上下 文具 体如 下 所述
默 认 值 为 prec 28 roundingroundhalfeven 并 为 overflow  invalidoperation 和 divisionbyzero  启 用陷 阱
在 已提 供的 三种 上下文之 外还 可以使用 context  构造 器创 建新 的上 下文
contextprecnone  roundingnone  eminnone  emaxnone  capitalsnone  clampnone  flagsnone  trapsnone  创建 一个 新上 下 文
如 果某 个字 段未 指 定 或为 none  则从 defaultcontext 拷 贝默 认值
 如果 flags 字 段 未 指 定或 为 none 则清空 所有 旗标
 prec  为 一个1 maxprec  范围 内的 整 数 用于设 置该上 下文 中算术 运算 的精 度
 rounding 选项应 为 rounding  modes 小节 中 列出 的常量 之一
 traps  和 flags  字段列出要设 置的 任 何信 号
通 常 新上 下 文 应 当只 设 置 traps 而让 flags  为空
 emin  和 emax 字 段给定指 数所 允 许的外 部上 限
 emin 必 须 在 minemin 0 范围内 emax 在0 maxemax  范围内
 capitals 字 段为0 或1 默认值
 如果 设为1 指 数 将附带打 印大写 的 e 其他 情况则 将 使 用小写的 e  decimal 6
 clamp  字 段为0默 认 值 或1
如 果 设为1 则 decimal  实例的 指数 e 的 表 示范围 在此上 下文 中 将严 格限制 为 emin  prec 1 e  emax  prec 1
如果 clamp  为0则 将 适 用 较 弱 的条件 decimal  实例调 整 后 的指 数最大 值为 emax
当 clamp  为1 时 一个 较大 的普 通 数 值 将 在 可 能 的 情 况下减 小其指 数并为其系统 添加相 应数量 的零以便 符合指数 值限制这 可以 保持 数字 值但 会丢 失 有 效末尾 零的信 息
例如 contextprec 6 emax 999 clamp 1
23000 e 999 clamp 值 为1 时即允 许与 在 ieee 754中描 述的 固定 宽 度十 进制交 换 格式 保持兼容 性
 context 类定义了几 种通 用 方法 以及 大量 直接 在 给 定 上下 文中进行算 术运算的方 法
 此外 对 于 上述 的 每种 decimal 方法不 包 括 adjusted 和 astuple  方法 都有 一 个相应 的 context  方法
例 如对于一个 context  的实 例 c 和 decimal 的 实例 xc
expx 就等 价于 x
 每 个 context 方 法都 接受 一 个 python 整数 即 int 的 实 例 在任 何 接受 decimal 的实例 的地方使 用
 clearflags 将 所有旗标 重置为0
 cleartraps  将所 有陷阱重 置为零0
3
3 新版 功 能
 copy  返 回 上下 文的 一 个副 本
 copydecimalnum 返 回 decimal 实 例 num  的 一个副 本
 createdecimalnum 基 于 num 创 建 一 个 新 decimal 实例 但 使 用 self  作为 上下 文
 与 decimal 构 造器 不 同该 上 下 文的 精度、 舍入 方 法、旗 标和 陷阱 会被 应 用于转 换过 程
此 方 法很 有用 处 因为 常量 往往 被给予高于 应 用所需的精 度
另一 个好 处 在 于 立即 执 行舍入 可 以 消 除超 出当前 精 度的 数位 所导 致的意 外 效果
 在 下面 的示 例中 使用 未舍 入的 输入 意味 着在总和 中 添 加零 会改 变结 果 getcontext
44此 方法 实现 了 ibm 规 格 描述中 的转换为 数 字操作
如 果参数 为 字 符串则 不允许有 开头 或末 尾 的 空格或 下 划线
 createdecimalfromfloatf  基于 浮 点 数 f  创建一个 新的 decimal 实例但 会 使用 self 作 为 上下 文来 执行舍入
 与 decimal
fromfloat 类 方法 不同 上 下文的 精度、 舍 入方法、 旗标 和 陷 阱 会应 用 到转 换中
inexact  none 3
1新 版 功 能
 etiny 返 回一个等于 emin  prec 1 的值 即次 标准化 结果 中 的最 小 指 数值
当 发生向 下溢出 时指 数 会 设 为 etiny
 etop  返回一个 等 于 emax  prec 1的 值
使用 decimal  的通常 方 式是 创 建 decimal  实 例然后对 其 应用 算 术运算 这 些运算发 生在 活 动线 程 的当前 上 下文中
一种 替代方 式则 是 使 用上 下文 的方 法 在 特 定上 下文 中进行计 算
这 些方 法类似于 decimal  类的 方 法 在此仅 简单 地重 新 列出
 absx  返回 x  的绝对 值
 addx  y 返 回 x 与 y  的和
 canonicalx 返回 相同 的 decimal 对象 x
 comparex  y  对 x 与 y 进 行数 值 比 较
 comparesignalx  y  对两 个 操 作数进行 数值比 较
 comparetotalx  y 对两个 操 作 数 使用 其抽 象表 示进 行 比较
 comparetotalmagx  y 对 两个 操 作数 使用其 抽 象 表示进行 比 较忽略符 号
 copyabsx 返 回 x  的 副本 符号 设为0
 copynegatex  返回 x  的 副本符号取 反
 copysignx  y  从 y  拷贝符号至 x
 dividex  y  返 回 x 除 以 y 的 结 果
 divideintx  y 返 回 x 除 以 y  的 结果 截短为整 数
 divmodx  y 两个数 字相除并返 回结 果的 整数 部分
 expx 返 回 e  x
 fmax  y  z  返 回 x  乘以 y  再 加 z 的 结果
 iscanonicalx  如 果 x 是 规范 的则 返回 true  否则 返回 false
 isfinitex  如果 x  为有 限的 则返 回 true  否 则返回 false
 isinfinitex  如果 x 是无 限 的则返 回 true 否 则返 回 false
 isnanx 如 果 x 是 qnan  或 snan 则 返回 true  否 则返回 false
 isnormalx  如 果 x 是 标准 数则 返 回 true 否 则返回 false
 isqnanx  如果 x  是静 默 nan 则 返回 true  否则返回 false
 issignedx  x  是负 数 则返 回 true  否则返回 false
 issnanx  如 果 x 是 显式 nan  则返 回 true  否 则返 回 false
 issubnormalx 如 果 x 是次标准 数则 返回 true  否则 返 回 false
 iszerox  如果 x  为零 则返 回 true  否则返回 false
 lnx 返 回 x  的自然 对数 以 e 为 底
 log 10 x 返 回 x 的 以10 为 底的 对数
 logbx  返 回 操作 数 的 msd  等级 的指数
 logicalandx  y 在操 作数 的 每个数 位间应用逻辑 运算 and
 logicalinvertx  反转 x 中的 所有 数位
 logicalorx  y  在操作 数的 每 个 数 位间应 用 逻辑 运算 or
 logicalxorx  y 在 操 作 数的 每个 数 位间 应用 逻辑 运算 xor
 maxx  y  对两个 值执行数 字 比 较并 返回 其中的 最大 值
 maxmagx  y 对 两 个 值执 行忽略 正负 号 的 数字 比较
 minx  y  对 两个 值执 行数 字 比 较并 返回 其 中的 最 小 值
 minmagx  y  对两个 值执 行忽略 正负 号的 数字 比较
 minusx 对 应于 python  中 的单 目前 缀取 负运算 符 执行 取负 操 作
 multiplyx  y  返回 x 和 y 的积
 nextminusx  返回小于 x 的 最 大数字 表 示形 式
 nextplusx 返 回大于 x  的最 小数字 表 示形 式
 nexttowardx  y 返 回 x 趋向于 y  的 最接近 的数字
 normalizex  将 x  改写为 最简形式
 numberclassx 返回 x  的 类 的表 示
 plusx 对 应 于 python  中的 单目 前缀取 正运算 符执 行取 正 操作
 此操 作将 应用 上下 文精 度和舍 入 因此它 不 是 标 识运 算
 powerx  y  modulonone  返回 x 的 y  次方 如果 给出 了模 数 modulo 则取 其 余 数
如 为两 个参 数则 计 算 xy
 如 果 x 为 负 值 则 y 必 须为 整数
除 非 y 为 整 数且结 果为 有限 值 并 可 在 precision 位 内 精 确表 示否 则结 果 将是不 精确 的
 上下 文的 舍 入模 式将被 使用
 结 果 在 python 版 中总 是 会 被 正 确地 舍入
 decimal 0 decimal 0 结果 为 invalidoperation  而如 果 invalidoperation 未 被 捕 获则结果 为 decimalnan
在3
3 版 更 改 c  模 块 计 算 power 时 会使 用 已 正确 舍入的 exp  和 ln 函 数
结 果 是 经 过良 好 定 义 的但仅 限于 几乎总 是正 确地 舍入
 带有 三个 参数 时 计算 xy  modulo
 对 于三 个 参 数的 形式 参数 将会 应用以下限制 三个 参数 必 须都是 整数 y  必 须 是非负数 x  或 y 至 少有一 个 不 为零 modulo  必须 不为 零且 至多 有 precision 位 来 自 context
powerx  y  modulo  的 结 果 值等 于使 用无 限 精 度 计 算 xy  modulo 所 得到 的值但其 计算 过 程 更 高 效
 结果 的指 数为 零 无论 x  y  和 modulo  的指 数 是 多少
 结果值 总是 完全 精确的
 quantizex  y  返回 的值 等于 x  舍 入后 并且指数 为 y
 radix 恰 好返 回10 因为 这 是 decimal  对象 remainderx  y  返回 整除 所 得到 的余 数
 结 果的 符号 如果不 为零则 与原始 除 数的符号 相同
 remaindernearx  y  返 回 x  y  n  其中 n  为 最 接近 x  y  实 际值 的整数 如 结果 为0 则 其符号 将与 x  的 符号 相同
 rotatex  y  返回 x  翻 转 y 次 的副 本
 samequantumx  y 如 果 两个操 作数具 有相 同的 指 数则 返 回 true
 scalebx  y  返回 第一个 操作 数 添 加第二个 值 的 指数 后的结 果
 shiftx  y  返回 x  变换 y  次的副 本
 sqrtx 非 负数 基 于 上 下文 精度 的 平 方 根
 subtractx  y  返 回 x 和 y  的差
 toengstringx 转换 为字 符串 如果 需要 指数 则 会使用工 程 标 注 法
 工程标注 法 的指数 是3的倍 数
这会在 十进 制 位的左 边保留 至多3 个数码并 可能 要求 添 加一 至两个末 尾 零
 tointegralexactx 舍入到 一个 整数
 toscistringx  使用科 学计 数 法将一个 数 字 转换为字 符串
 常 数
 本 节 中 的 常 量仅 与 c 模 块相关
 它 们也被 包含在纯 python  版本 以 保持 兼 容性
32位64 位 decimal
havethreads 该 值 为 true
已弃 用因为 python  现在 总是启用 线程
3
9版 后已 移除
havecontextvar  默 认值 为 true
如 果 python  的编译 带有 withoutdecimal  contextvar  选项 则 c 版 本会 使用线 程局部 而不是协程 局部上下文 并 且该 值为 false
 这 在 某些 嵌套 上 下 文场 景中 将稍快 一 些
3
9 新 版功 能 向下移 植 到3
7和3
 舍 入 模式
roundceiling 舍入 方向 为 infinity
rounddown 舍 入方 向 为 零
roundfloor  舍入 方向为 infinity
roundhalfdown 舍 入到 最接 近 的 数同 样 接近则 舍入方 向为 零
roundhalfeven 舍 入 到 最 接近的 数 同样接 近 则 舍 入到最 接 近的 偶数
roundhalfup  舍 入 到 最接 近 的 数 同 样接近 则 舍入到 零 的 反 方向
roundup 舍 入 到 零 的反 方向
round 05 up  如 果 最 后 一 位 朝零的方 向 舍入 后为0 或5则 舍入 到零 的反方向 否则 舍入方 向为 零
 信号
 信号 代表在 计算 期 间 引发的 条 件
每个 信号 对应 于一 个 上下 文 旗标 和 一 个上下 文陷阱启用 器
上 下 文旗 标将 在遇到特定 条件 时被设 定
 在完 成计 算之 后将 为 了获 得信息 而检测旗 标例 如 确定 计算 是否精 确
在 检测 旗 标后请 确 保在 开始 下 一次 计算 之 前清 除所有 旗标
如 果为 信号设 定了 上下 文 的陷阱 启 用器 则条件 会导 致特 定 的 python 异常 被 引发
 举例来说 如果 设定 了 divisionbyzero  陷阱则 当 遇到 此条 件时就将 引发 divisionbyzero  异 常
clamped  修 改 一 个指数以 符合 表示 限 制
通常 限 位将 在一 个指数超 出上 下 文 的 emin  和 emax  限 制时 发 生
 在可 能的情况下会 通 过 给系数添 加零来将 指 数缩 减至 符 合限 制
decimalexception 其 他信 号 的基 类 并且 也 是 arithmeticerror 的一个 子类
divisionbyzero  非无 限数被 零除 的信 号
 可在 除法、取余 队 法或对 一个 数 求 负数次 幂 时 发 生
如果 此信 号未 被 陷阱 捕获则 返回 infinity 或 infinity  并且由 对 计 算的 输入来 确定正负 符 号
inexact 表 明发 生 了 舍入 且 结果 是不 精 确 的
 有 非 零 数位 在舍 入 期间 被丢 弃的 信 号
 舍 入 结 果 将被 返 回
此 信号旗标或陷 阱 被用 于检测结 果不 精确 的 情 况
invalidoperation  执 行了 一 个无 效的 操 作
表 明 请求 了一 个 无意 义 的 操 作
 如未 被 陷阱 捕 获 则 返 回 nan
 可 能 的 原 因包 括 infinity  infinity 0 infinity  infinity  infinity  x 0 infinity  x  sqrtx  and  x 000 x  noninteger  x  infinityclass  decimal
overflow 数 值 的溢出
 表明在 发 生 舍 入之 后的指 数 大于 emax
 如果 未 被陷阱 捕 获 则 结果 将 取决 于舍 入 模式 或者向 下 舍 入为最 大 的 可表示 有限 数 或者 向 上 舍入 为 infinity
无 论哪种情 况 都将 引发 inexact  和 rounded 信号
rounded  发 生 了 舍入 但 或许 并 没 有信 息 丢 失
 一旦 舍 入 丢 弃 了 数位 就 会 发出 此 信号 即使 被 丢弃 的数 位是零 例如 将5
00舍 入 为5
如 果 未被 陷阱捕获 则 不经 修改 地返回 结 果
 此信号用 于检 测 有效 位数 的丢弃
subnormal  在 舍 入 之前指 数 低于 emin
 当操作 结果 是次 标 准 数即 指 数过小 时就 会发出 此信 号
如果 未 被 陷阱 捕获 则不 经 修 改 过返 回 结果
underflow 数 字 向 下溢 出导 致结 果 舍 入到 零
当一个 次标准 数结 果通 过舍 入 转为 零时 就会发 出此信号
同时 还 将引 发 inexact 和 subnormal  信 号
floatoperation  为 float  和 decimal 的 混 合启 用 更严 格的语 义
如 果信 号未 被 捕 获默 认则在 decimal 构造器、 createdecimal  和 所 有比较运 算中允许 float  和 decimal  的混 合
转 换 和比 较都 是完 全 精 确 的
 发生 的 任 何 混合 运 算 都 将通 过在 上 下文 旗 标 中 设置 floatoperation 来 静默地记录
通 过 fromfloat 或 createdecimalfromfloat 进 行 显 式转换 则 不会设 置 旗 标
 在 其他 情 况 下即 信号 被 捕获 则只 静 默执行 相等 性比 较 和 显 式 转 换
所有 其他 混 合 运 算 都将 引 发 floatoperation
以 下表 格总 结了 信号 的层 级结 构 exceptions
浮 点 数说 明
通 过 提升 精度来 解 决舍 入 错误
 使用十进制浮点 数 可以 消 除十进 制表 示错 误即能 够 完 全 精 确地 表示0
1这 样 的 数 然 而 某些 运算 在 非零 数位 超出给 定的 精 度 时仍然可 能 导致 舍 入错 误
舍 入错 误 的影 响可 能因 接近 相互 抵 销的 加减 运算 被 放 大从 而 导致 丢失 有效 位
knuth 提 供了 两个 指 导性 示例 其中 出 现了 精 度不 足的 浮点 算术 舍 入 导 致 加 法的 交换 律和 分 配律被打 破 examples  from  seminumerical  algorithms  section 4
0060000 decimal 模块 则 可 以 通过 充分 地扩 展 精度 来避免 有效 位的 丢失 getcontext
 特殊的值
decimal  模块 的数 字系统 提供了一 些特 殊 的值 包括 nan  snaninfinity  infinity  以 及两 种零 值0 和0
无 穷 大 可以 使用 decimalinfinity  来构 建
 它们 也可以 在不 捕获 divisionbyzero  信号捕获 时 通 过除以零 来 产生
类似 地 当不 捕 获 overflow 信号时 也 可以通过 舍入 到 超出 最大 可表 示 数字 限 制的方式 产 生无穷 大的 结 果
无穷 大是 有 符号 的仿 射并可 用于 算术 运算 它们 会 被当作 极其 巨大的不 确 定数字 来处 理
例 如无 穷大 加一 个常 量结 果也 将为 无穷 大
某 些不 存在 有效 结 果 的 运算 将会返 回 nan 或 者 如 果 捕 获了 invalidoperation  信号 则 会 引 发 一个 异常
 例 如00会 返回 nan  表 示结 果不是 一 个 数字
 这样 的 nan 是 静默产生 的并 且在产生 之 后参 与其它 计算 时总 是会 得到 nan  的结 果
这 种行 为对 于偶 而缺少输 入的 各类计 算都 很 有用 处它 允许 在将 特定 结果标记 为无 效的同 时让 计 算继 续运 行
 另一 种变 体形 式是 snan  它在 每次 运算 后会 发出 信号 而 不 是 保持 静 默
当 对于无 效 结 果需 要 中断 计算进 行特 别 处理 时这 是 一个很有 用的 返回 值
python 中 比较 运算符 的行 为在 涉及 nan  时可 能会 令人 有点惊讶
 相等 性检 测 在操 作 数中 有静 默型 或信 号型 nan  时总 是会 返回 false 即使 是执 行 decimalnandecimalnan 而 不 等性 检 测总 是会 返回 true
 当尝 试使 用或 运算 符中的任 何一 个来 比较 两个 decimal  值时 如果 运算 数中 有 nan 则 将引 发 invalidoperation 信 号如 果此 信 号 未 被捕 获 则将 返 回 false
请注 意 通用 十进 制 算 术规 范并未 规定 直接比较 行为 这些 涉 及 nan 的 比较 规则 来自 于 ieee 854标 准见第5
7节 表3
 要确 保严 格 符合 标准 请改 用 compare 和 comparesignal  方法
 有符号零 值可 以由 向下 溢出 的运 算产 生
它 们 保 留 符号 是 为了 让 运算结 果能以 更 高 的精 度传 递
 由于它 们的 大 小 为 零正 零 和 负 零 会 被视 为相 等 且 它 们的 符号 具 有 信息
 在这 两 个不 相 同 但却 相等 的有符 号 零之外 还存 在 几 种零 的不同 表 示形 式 它 们的 精度不 同但 值也都相 等
这 需要 一 些时 间来 逐渐 适应
 对于 习惯 了标 准浮点表 示 形式 的眼 睛 来说 以下 运算 返回 等于 零的值并 不是 显而 易见 的1 decimalinfinitydecimal 0 e 1000026
使 用线 程
getcontext 函 数会 为每 个线 程访 问 不 同 的 context 对 象
 具有 单独线 程 上 下文 意 味着 线程可 以修 改 上下 文例 如 getcontext
prec 10 而不影响 其他 线程
 类似 的 setcontext 会 为当前 上下 文的 目标 自动 赋值
 如果 在调用 setcontext 之 前调 用了 getcontext  则 getcontext  将自 动 创建 一个 新的 上下 文在 当前 线程 中使用
新 的上 下文 拷 贝自 一 个名 为 defaultcontext 的 原型 上下 文
要 控制 默认 值以便每 个线 程在 应用 运行 期间 都使 用相 同的 值可 以直 接修 改 defaultcontext 对 象
这 应当在 任何 线 程启 动之前完成 以 使得调 用 getcontext 的 线 程 之间不会产 生竞争 条件
例 如 set  applicationwide  defaults  for  all  threads  about  to  be  launched  defaultcontext
例 程
以下 是 一些 用作工具 函 数 的例 程它们演 示 了使 用 decimal 类 的各种方 式 def  moneyfmtvalue  places 2 curr  sep  dp
decimal  常见 问 题
 开发 工 具
本 章 中 描述的各模 块 可帮 你编写 python  程序
例 如 pydoc 模块 接受 一个模块 并根据 该模 块的 内 容来生 成 文档
doctest 和 unittest  这两个 模 块 包 含了 用 于编写单 元测试的框 架并可 用于自动 测 试所 编 写的 代 码验证 预 期 的 输出是否 产生
2 to 3 程 序能够 将 python 2
x 源 代码 翻译 成有 效的 python 3
x  源 代 码
本 章中描 述的 模块 列 表是 typing  类型 标 注 支持类 型 别 名 newtype  callable 泛型 generic  用 户定 义的 泛型类 型 any  类型 名 义性子 类型区 别于 结 构 性子 类型 模 块内容 特殊 类型原 语特殊 类型 特 殊形式 building  generic  types  other  special  directives  generic  concrete  collections  corresponding  to  builtin  types  corresponding  to  types  in  collections  other  concrete  types  abstract  base  classes  corresponding  to  collections  in  collections
abc  asynchronous  programming  context  manager  types 协 议 functions  and  decorators  introspection  helpers  常数 pydoc  文 档 生成 器和在 线 帮助 系 统 python  development  mode  effects  of  the  python  development  mode  resourcewarning  example  bad  file  descriptor  error  example  doctest 测 试 交互 性 的 python  示 例简 单 用 法 检查 docstrings  中 的示例 simple  usage  checking  examples  in  a  text  file  how  it  works  which  docstrings  are  examined  how  are  docstring  examples  recognized  whats  the  execution  context  what  about  exceptions  option  flags  directives  警告 basic  api  unittest  api  advanced  api  doctest  对 象 example  objects  doctestfinder  对象 doctestparser  对 象 doctestrunner  对 象 outputchecker 对 象 调试 soapbox  unittest  单 元测 试框 架 基本实 例命 令行界 面 命 令行 选项 探索 性测 试 组织你的测试 代码 复用 已 有的测 试代 码 跳过 测试 与 预计 的失 败 distinguishing  test  iterations  using  subtests 类 与函数 测试 用 例 deprecated  aliases  grouping  tests  loading  and  running  tests  loadtests  protocol  class  and  module  fixtures  setupclass  and  teardownclass  setupmodule  and  teardownmodule  signal  handling  unittest
mock  mock 对 象库 快速 上手 mock  类 calling  deleting  attributes  mock  names  and  the  name  attribute  attaching  mocks  as  attributes  the  patchers  patch  patch
mock 上 手指南 使用 mock  模拟 方法调 用对 象 上的 方 法调用 的 mock  mocking  classes  naming  your  mocks  tracking  all  calls  setting  return  values  and  attributes  raising  exceptions  with  mocks  side  effect  functions  and  iterables  mocking  asynchronous  iterators  mocking  asynchronous  context  manager  creating  a  mock  from  an  existing  object  patch  decorators  further  examples  mocking  chained  calls  partial  mocking  mocking  a  generator  method  applying  the  same  patch  to  every  test  method  mocking  unbound  methods  checking  multiple  calls  with  mock  coping  with  mutable  arguments  nesting  patches  mocking  a  dictionary  with  magicmock  mock  subclasses  and  their  attributes  mocking  imports  with  patch
dict  tracking  order  of  calls  and  less  verbose  call  assertions  more  complex  argument  matching 2 to 3自 动将 python 2 代码 转为 python 3代 码 使用2 to 3 修复 器 lib 2 to 3——2 to 3支持 库 test  python 回 归 测试 包 writing  unit  tests  for  the  test  package  running  tests  using  the  commandline  interface  test
python  development  mode
3
7 新版功 能
tkinter 对 话 框
tkintersimpledialog 标 准 tkinter  输入 对话 框
源 码 libtkintersimpledialog
askstringtitle  prompt  kw  以上 三 个函数 提供 给 用户 输入 期望值 的类 型的 对 话框
dialogparent  titlenone  自 定 义对 话 框的基 类
 buttonbox 加 入 ok 和 cancel  按钮 的默 认 行 为
重写 自定 义按 钮 布局
tkinterfiledialog 文件选 择对 话框
 源 码 libtkinterfiledialog
原生 加载 保 存 对 话框
tkintercommondialog  对 话窗 口 模板
 源码 libtkintercommondialog
dialogmasternone  options  showcolornone  options  渲染 对话 窗口
 参 见 modules  tkinter
messagebox 读 写文件
difflib 计算 差 异 的辅 助工 具
源代 码 libdifflib
py 此 模块 提供 用 于比 较序 列的 类 和函数
 例如 它 可 被用 于比 较 文件并 可 产生多 种格式 的不 同 文件 差 异信息包 括 html 和 上下 文 以及统一 的 diff  数 据
 有 关 比较 目 录 和文 件 另请 参 阅 filecmp  模块
sequencematcher  这 是 一个 灵 活的类 可 用于 比 较任何类 型的 序 列对 只要序 列元素为 hashable  对 象
其 基 本算 法要早 于 由 ratcliff  和 obershelp  于1980年 代 末 期发表 并 以 格 式 塔 模式 匹 配的 夸张名 称命名的 算法 并且更 加有 趣 一些
 其思 路 是找 到不包 含垃 圾元 素的 最 长连 续匹配子 序列所 谓垃圾元 素是 指其 在 某种 意义 上没有 价值例 如空 白行或 空白 符
处理 垃圾元素 是对 ratcliff 和 obershelp  算 法 的一 个 扩展
 然后 同样 的思 路将 递 归地 应用 于匹 配 序列 的 左右 序列片 段
这 并 不 能产生最 小编辑 序列 但 确实 能产 生在 人 们看 来 正确 的匹 配
 耗 时 基本 ratcliffobershelp  算 法在 最 坏 情况 下为 立 方 时 间而 在一 般情 况下 为平 方 时 间
 sequencematcher  在 最 坏 情 况下 为平 方时 间 而 在一 般情况 下的 行为 受到序 列中有多 少相 同 元素 这一 因素 的微 妙影 响在 最佳 情况 下则为 线性时间
自 动 垃圾 启发 式计算 sequencematcher  支 持使 用 启发 式计 算 来 自动 将特 定 序列项 视为 垃 圾
 这种 启发式 计算会 统计 每个 单 独 项在 序 列 中出 现的 次数
如果某一项 在 第 一 项之 后 的重 复次 数超 过序 列长 度的1 并 且序列长 度 至少 有200项 该项 会被 标 记为 热门 并被视为序列 匹配 中 的垃 圾
这 种启 发式计算 可以 通过 在创 建 sequencematcher 时 将 autojunk 参 数 设为 false  来关 闭
3
2 新版 功 能 autojunk  形参
differ  这 个 类的作 用 是比 较 由 文 本行 组成 的 序列 并 产生 可 供 人 阅 读的 差异 或增量信 息
 differ 统 一使 用 sequencematcher 来完成行 序列的 比较 以及 相似 接 近匹 配行 内部 字符序 列的 比较
 differ 增 量 的每 一行 均 以双 字 母代码打 头 双字 母代 码 意义 行为序列1所 独有行 为序 列2 所 独有 行在 两 序 列中 相同 行不 存在 于任 一输 入序列 以打头 的行 尝试将 视 线引 至行 以 外而不 存在于任 一 输入 序列 的 差异
 如果序列包 含制表 符则 这 些 行可 能会 令 人 感到 迷惑
htmldiff  这个 类可 用于 创建 html  表 格或 包含 表格的完 整 html 文 件以并 排地 逐行 显示 文 本比 较行 间与 行外的更改 将突 出 显示
 此 表 格可 以基于完全 或上下 文差 异模 式来生成
 这个 类的 构 造函 数 inittabsize 8 wrapcolumnnone  linejunknone  charjunkischaracterjunk  初始 化 htmldiff 的 实 例
 tabsize  是一 个可选 关键字参数 指定制 表位 的 间隔默 认 值 为8
 wrapcolumn 是 一 个可 选关 键 字 参数 指定 行 文本 自 动打 断 并换行 的 列 位置 默认值为 none  表 示 不自 动 换行
 linejunk  和 charjunk  均是 可选关 键 字参数 会 传入 ndiff 被 htmldiff  用来 生成 并 排 显示 的 html  差 异
请 参 阅 ndiff 文档 了 解 参 数默 认 值及其说 明
下列 是公 开的 方法 makefilefromlines  tolines  fromdesc  todesc  contextfalse  numlines 5 charsetutf 8 比 较 fromlines 和 tolines  字符 串列 表 并 返回 一个字符串 表 示一 个 完整 html 文件其 中 包 含各 行 差异 的 表 格 行 间 与 行外 的 更 改 将 突 出 显示
 fromdesc  和 todesc  均 是 可 选 关 键字 参 数 指 定 来 源 目标 文 件 的 列 标 题 字符 串 默 认 均 为 空白 字符 串
 context  和 numlines 均 是 可选 关键 字参 数
当 只要 显示 上下文 差异时 就 将 context 设为 true  否 则默 认值 false  为 显示 完整 文 件
 numlines  默认 为5
 当 context  为 true  时 numlines  将 控 制 围绕 突 出 显 示 差异 部分 的 上下 文行 数
当 context  为 false  时 numlines  将控制 在使 用 next 超链接时 突出 显 示 差异 部 分之前 所显 示的 行 数设为 零则会 导 致 next  超 链接 将 下 一个突 出 显 示差 异 部 分 放 在 浏 览器 顶 端不添 加任 何前 导上下 文
 注解 fromdesc  和 todesc 会被 当 作未 转 义的 html 来 解读 当接收 不 可信 来源 的 输入 时应该 适当 地进 行 转义
 在3
5版 更改增 加了 charset 关 键 字参数
 html  文档 的默 认 字 符集 从 iso 88591更 改为 utf 8
 maketablefromlines  tolines  fromdesc  todesc  contextfalse  numlines 5 比 较 fromlines 和 tolines  字 符串 列表 并 返回 一个字 符串 表示 一个 包含各 行 差 异 的 完 整 html 表 格 行间 与 行外 的更改 将突 出显 示
此 方法 的参数 与 makefile  方法的 相同
py  是这 个类 的命 令行 前端其中 包 含一个很好 的使 用示 例
contextdiffa  b  fromfile  tofile  fromfiledate  tofiledate  n 3 linetermn 比较 a  和 b 字 符串列表 返回上 下 文 差异 格式 的增量 信 息一 个产 生增 量 行 的 generator
所 谓上 下文差异 是 一 种只 显 示 有 更 改的 行 再 加 几个 上下 文行 的紧 凑 形 式
更改 被显 示 为之 前 之 后 的 样式
上 下 文行 数 由 n 设 定默 认 为 三行
 默认 情况 下 差 异 控 制行 以 or 表示 是通 过末 尾 换 行符 来 创 建 的
 这 样 做 的 好 处 是从 io
readlines  创建 的 输 入 将 得 到 适用 于 io
writelines 的 差 异信 息因 为 输入 和输 出 都带有 末尾 换 行符
对 于没有末 尾 换行符 的 输入应 将 lineterm  参数设 为这 样输 出 内容 将统 一不 带换 行符
 上下文差 异 格式 通常 带有 一个 记录 文件 名和 修改 时 间的 标头
这些 信息的 部分 或全 部 可以使 用字 符 串 fromfile  tofile  fromfiledate 和 tofiledate  来指 定
修改 时 间通 常 以 iso 8601格式 表示
 如果 未指 定 这些 字符 串默认 为空
py 14 bacon  eggs  ham  guido 14 python  eggy  hamster  guido  请参 阅 difflib 的 命令行 接口 获取更 详 细的 示例
6 返 回 由 最佳 近 似 匹配 构成的 列表
 word  为一个指 定 目标近似匹 配 的序 列 通 常为字 符串 possibilities 为 一个 由 用于 匹配 word  的序 列构成 的列 表通常为 字 符串列表
可选 参数 n  默 认 为3指定 最多返 回多 少 个近 似匹 配 n 必须大 于0
 可 选参 数 cutoff  默认 为0
6是 一 个01 范围 内的浮 点数
 与 word 相 似度 得分 未达 到 该 值的 候选 匹配 将 被 忽 略
 候 选 匹配 中不超 过 n 个 的最 佳 匹配 将以 列表形 式 返 回 按 相 似度得分排序 最相 似 的排 在最 前 面
ndiffa  b  linejunknone  charjunkischaracterjunk 比 较 a 和 b  字符串 列 表返回 differ 形式的 增量 信息 一 个产 生 增量行 的 generator
可 选关 键 字形 参 linejunk 和 charjunk 均为 过 滤函数或为 none  linejunk 此 函 数接 受单 个字 符串 参数 如 果 其为 垃圾 字 符串 则 返回真 值否则 返回 假值
默 认为 none
 此外 还 有一个 模 块 层 级 的 函数 islinejunk  它 会 过 滤掉 没有可 见字 符的行 除非该 行添 加了 至多一 个 井号符 但 是 下层 的 sequencematcher 类会 动态 分 析 哪些 行 的重 复频 繁到 足以 形 成噪音 这 通常 会 比使 用此 函数 的 效果 更 好
 charjunk 此 函 数 接受 一 个 字符 长度为1 的字 符串 如 果其 为垃 圾 字符 则返回真 值否则 返回假 值
默 认 为模块 层 级的 函 数 ischaracterjunk 它 会过滤掉 空白 字符空 格符 或制表符但 包 含换 行符 可 不是 个好主意
py  是 这个 函数 的命 令行 前端
restoresequence  which 返 回两个 序 列中 产 生 增量的那 一 个
 给 出一 个由 differ
compare  或 ndiff 产 生的序 列提取 出 来自 文 件1 或2 which 形参的 行 去 除 行前 缀
示 例 diff  ndiffonentwonthreen
unifieddiffa  b  fromfile  tofile  fromfiledate  tofiledate  n 3 linetermn 比 较 a 和 b 字 符串列 表 返回 统 一 差异 格式 的增 量信 息 一个 产生 增 量行的 generator
所 以 统 一差 异 是 一 种只显 示有 更 改 的行再 加 几个上 下文 行 的紧 凑 形式
更 改 被 显示 为 内 联的样 式而不 是 分开 的之 前 之后文 本 块
 上 下文 行数由 n  设 定默认 为三行
默 认情 况 下差异 控 制 行 以 或表 示是 通 过末 尾换行 符来创 建 的
这样做 的好处 是 从 io
readlines  创建的 输入 将得到 适用 于 io
writelines 的 差 异信 息 因为 输 入和 输出 都带 有末尾换 行 符
对于没 有末 尾换行 符的输入 应将 lineterm  参数 设为这 样输出内 容 将统 一不 带换 行符
 上下 文差 异 格式通 常带 有一 个记录 文件 名 和修 改时 间的标头
 这些信 息 的部 分或 全 部可 以 使用 字符 串 fromfile  tofile  fromfiledate 和 tofiledate  来指 定
 修改 时 间通 常以 iso 8601格 式表 示
如 果未 指定 这 些字符 串默 认 为空
py 1414 bacon  eggs  ham  python  eggy  hamster  guido  请参 阅 difflib 的 命令 行接 口获 取 更详 细的 示例
diffbytesdfunc  a  b  fromfileb  tofileb  fromfiledateb  tofiledateb  n 3 linetermbn 使 用 dfunc 比 较 a 和 b 字节 串对 象列 表产生 以 dfunc 所 返 回格 式表示的 差 异 行列 表也是 字节 串
 dfunc 必 须是 可 调用 对象 通 常为 unifieddiff  或 contextdiff
允许你 比较 编 码未 知 或不 一致的数 据
 除 n 之外 的所 有 输 入都 必 须为 字 节串 对象 而非 字符 串
作 用方 式为 无损 地将 所有 输入 除 n 之 外转 换为 字 符串并 调用 dfunca  b  fromfile  tofile  fromfiledate  tofiledate  n  lineterm
 dfunc  的 输出会 被随 即转 换 回字 节 串这 样你所得 到的增量 行将 具有 与 a 和 b  相同的 未知不一 致编 码
3
5新版 功能
islinejunkline  对于 可忽略的 行返 回 true
 如果 line  为空 行 或只 包 含单 个则 line  行 就是 可忽 略 的否则 就是 不可 忽略 的
 此函 数 被 用作较 旧版 本 ndiff  中 linejunk 形 参 的默认值
ischaracterjunkch  对于 可 忽 略的 字符返 回 true
字 符 ch  如果 为 空格 符或 制 表符 则 ch  就 是 可忽 略 的否 则 就是不 可忽 略 的
此函 数被 用 作 ndiff  中 charjunk 形 参 的默 认 值
 参 见 模式 匹配 格 式塔 方 法 john  w
 ratcliff 和 d
 metzener  对于 一种类 似算 法 的讨 论
此文于1988 年7 月发表 于 dr
 dobbs  journal
sequencematcher 对象
sequencematcher  的 示 例
 以 下 示 例 比 较 两个字 符 串并将 空格视 为 垃 圾 s  sequencematcherlambda  x  x 
 private  volatile  thread  currentthreadratio  返 回 一 个01 范 围 内的整 数作 为两个序列 相似 性 的 度 量
 根 据经验 ratio  值超 过0
6就意味着 两个 序 列 是 近似 匹配 的 printrounds
866 如 果 你只对两个 序列 相 匹配 的 位 置 感 兴趣则 getmatchingblocks 就 很方 便 for  block  in  s
 printad  and  bd  match  for  d  elements  blocka 0 and  b 0 match  for 8 elementsa 8 and  b 17 match  for 21 elementsa 29 and  b 38 match  for 0 elements 请 注意 getmatchingblocks  返 回 的 最后 一 个 元 组总 是 只 用 于占 位的 lena  lenb 0 这也是 元组 末 尾元素 匹 配的 元素 数量 为0的 唯一 情 况
 如果 你想 要知 道如 何将第 一 个序 列转 成第二个 序 列可 以 使 用 getopcodes  for  opcode  in  s
 print 6 s  add  bdd  opcode  equal  a 08 b 08 insert  a 88 b 817 equal  a 829 b 1738参 见 此模 块中的 getclosematches 函数 显示 了如 何 基 于 sequencematcher 构 建简 单 的 代 码来执 行有 用的 功能
 使 用 sequencematcher 构 建小型 应用 的 简易 版 本 控 制 方 案
differ 对 象
请 注 意 differ  所 生 成的 增 量并 不保 证是 最 小 差异
相 反 最 小 差异 往往是 违 反直 觉的 因为 它们 会同步 任何 可 能 的地 方有 时甚 至 意外产生 相距100 页的匹 配
 将同步 点限制 为 连续 匹配 保留了 一 些局 部性 概念 这偶 尔 会带 来产生更 长差 异的 代 价
differ  类具 有这 样的构 造器 class  difflib
differlinejunknone  charjunknone 可 选关 键字 形参 linejunk  和 charjunk 均 为过滤函数 或为 none  linejunk  接 受 单 个 字符 串作 为 参数的 函数 如果其为 垃 圾 字符串 则返 回真值
 默认 值 为 none 意 味着 没 有 任 何行会 被 视为 垃圾行
 charjunk  接 受单个 字符 长度 为1的 字符 串作 为 参 数 的函数 如 果其 为 垃圾 字符则返回 真 值
默认 值 为 none 意味 着没有 任何 字符会 被视 为 垃圾 字 符
这 些垃圾过 滤 函数 可 加快 查 找 差异 的匹 配速 度并 且 不会导致任何 差异 行或 字符 被忽 略
请 阅读 findlongestmatch  方法 的 isjunk  形参 的描 述了解 详情
 differ  对象是通 过一个单 独方 法来使 用生成 增量的 comparea  b  比 较两个 由行 组成 的 序 列 并生 成增 量一 个 由行 组成 的 序 列
每 个序列 必须 包含一 个以 换行 符 结 尾 的 单行 字符串
 这样 的序列 可 以 通过 文 件 类对 象 的 readlines 方法 来 获取
 所 生 成的 增 量 同样 由以换 行 符结尾 的字 符串构 成可 以通 过文 件类 对 象的 writelines  方法 原样 打 印出来
differ  示例
 此示例 比 较 两 段 文 本
首先 我们 设置文 本为 以 换行 符结 尾的 单 行字符 串 构 成的 序 列这样的 序列 也可以 通过文 件类 对 象的 readlines  方 法来 获 取 text 11
splitlineskeependstrue 接 下来 我们实 例化一个 differ  对 象 d  differ  请注意 在实例 化 differ  对象 时 我 们可以 传入 函 数来 过 滤掉 垃圾 行和 字符
详 情参 见 differ  构 造器 说明
 最后 我 们比较两 个序 列 result  listd
comparetext 1 text 2 result 是一 个 字 符 串列 表 让 我 们 将其美 化打 印 出来 from  pprint  import  pprint  pprintresult 1
n  作 为单 独的多 行字 符串 显 示出 来则 是这 样 import  sys  sys
difflib  的命令 行 接口
 这 个实 例演 示 了如 何 使用 difflib 来 创建 一 个类 似于 diff  的工 具
它同样 包 含 在 python 源码发 布 包中 文件名为 toolsscriptsdiff
dis  python 字 节码反 汇 编器
pydis  模块 通 过反 汇编支持 cpython 的 bytecode  分 析
该模 块作 为 输入的 cpython 字 节码 在文 件 includeopcode
h 中定义 并 由编译器 和 解 释器 使用
cpython  implementation  detail 字节码 是 cpython 解释 器的 实现细节
 不保 证不 会在 python 版 本之 间添 加、删 除或 更改字 节 码
 不 应考 虑 将此模 块的 跨 python  vm 或 python  版本 的使 用
 在3
6 版更 改每条 指令 使用2个 字节
以前 字节 数因 指令而 异
示 例给 出 函数 myfunc  def  myfuncalist  return  lenalist  可以使 用以 下命令 显示 myfunc 的反 汇编 dis
dismyfunc 20 loadglobal 0 len 2 loadfast 0 alist 4 callfunction 16 returnvalue 2 是行号
 字节 码分 析
3
4 新 版功 能
字节 码分 析 api 允许 将 python 代码片 段包 装在 bytecode  对象中 以便 轻松 访 问已 编译代 码 的 详 细信 息
bytecodex  firstlinenone  currentoffsetnone  分析 的字 节码对 应于 函数、 生 成器、 异步生 成器、 协程、方 法、 源代 码 字 符 串或 代码 对象 由 compile 返回
 这 是下面 列出 的许 多函 数的 便利 包装最值 得注意 的是 getinstructions  迭代 于 bytecode 的 实例 产生字节 码操作 instruction  的实例
如 果 firstline  不是 none  则表示应该 为 反汇 编代 码中 的第 一 个源 代 码行 报告的行 号
否则源 行 信 息如果有 的 话 直 接来自 反 汇编 的代 码 对 象
如 果 currentoffset 不 是 none  则它 指的 是反汇 编代 码中的 指令偏 移 量
设 置 它意 味着 dis 将 针对 指 定的 操 作 码显示 当 前 指令 标记
 classmethod  fromtracebacktb  从 给定回溯 构造 一个 bytecode 实 例将 设 置 currentoffset 为 异常 负 责的指 令
 codeobj 已编译 的代码 对象
 firstline 代 码对象的第 一个源代 码行如 果可 用 dis 返 回字 节码操 作 的格式 化视 图与 dis
dis  打印 相同 但作 为多 行字 符串返 回
 info 返回 带 有 关于 代码对 象 的详 细信 息的格式 化 多行 字符 串 如 codeinfo 
在3
7 版更 改现 在 可以 处理协 程和 异步生 成 器 对象
 示例 bytecode  dis
 分析 函数
python  字节 码 说明
操作码 集合
软 件打 包和分发
distutils  构建和 安装 python 模块
distutils  包为 将待构 建和 安装 的 额 外的模块打包 成 python 安 装 包提 供支 持
 新模 块既可 以是百 分百 的纯 python  也 可 以 是 用 c 写的 扩展模 块或 者 可以 是一 组包含了 同时 用 python  和 c 编码 的 python  包
大 多 数 python 用 户不会 想要直 接使 用 这 个包 而是 使用 python  包官 方 维 护 的跨版 本工 具
 特 别地 setuptools 是 一个对 于 distutils 的增强 选项 它 能提供 对 声明项目 依 赖 的支持额 外 的用于 配置 哪些文 件 包 含在源 代码发 布中的 机 制包 括与版 本控制 系统 集成 需 要的插 件 生 成项 目 进 入 点 的能力 进入 点可用 作应 用 插 件系统 的基 础 自动在 安装 时间生 成 windows 命 令行 可 执行文 件 的能力而 不 是 需要 预 编 译它们跨所 有 受 支持 的 python 版本 上的一致 的 表 现推 荐的 pip  安装 器 用 setuptools 运行 所有的 setup
py  脚本即 使脚 本本身 只引了 distutils 包
 参 考 python  packaging  user  guide  获 得 更多 信 息
 为了 打 包工 具的 作 者 和用 户 能 更好理 解 当前 的 打 包 和分 发 系统 遗留 的 基于 distutils  的 用户 文档和 api  参 考 保持 可 用安装 python  模 块 旧版分 发 python  模块遗 留版本
doctest 测 试 交互 性的 python  示 例
源 代码 libdoctest
pydoctest 模块 寻找 像 python  交互 式代码 的 文 本然 后 执行这 些 代码 来确 保它 们 的确就像 展示 的 那样 正确 运行 有 许多方 法 来使 用 doctest 通 过验证 所有交互式示 例仍然按 照记 录的 方式 工作 以此 来检 查模 块的 文档字 符串 是 否是 最新 的
 to  perform  regression  testing  by  verifying  that  interactive  examples  from  a  test  file  or  a  test  object  work  as  expected
 to  write  tutorial  documentation  for  a  package  liberally  illustrated  with  inputoutput  examples
 depending  on  whether  the  examples  or  the  expository  text  are  emphasized  this  has  the  flavor  of  literate  testing  or  executable  documentation
下面 是一 个 小却 完 整的示 例模 块 this  is  the  example  module
 the  example  module  supplies  one  function  factorial
 for  example  factorial 5120 def  factorialn  return  the  factorial  of  n  an  exact  integer 0
 factorialn  for  n  in  range 6112624120 factorial 30265252859812191058636308480000000 factorial 1 traceback  most  recent  call  last 
 valueerror  n  must  be 0 factorials  of  floats  are  ok  but  the  float  must  be  an  exact  integer  factorial 30
1 traceback  most  recent  call  last 
 valueerror  n  must  be  exact  integer  factorial 30
0265252859812191058636308480000000 it  must  also  not  be  ridiculously  large  factorial 1 e 100 traceback  most  recent  call  last 
 overflowerror  n  too  large  import  math  if  not  n 0 raise  valueerrorn  must  be 0 if  math
floorn  n  raise  valueerrorn  must  be  exact  integer  if  n 1 n  catch  a  value  like 1 e 300 raise  overflowerrorn  too  large  result 1 factor 2 while  factor  n  result  factor  factor 1 return  result  if  name  main  import  doctest  doctest
testmod  如果 你 直 接在 命 令 行里 运行 example
py  doctest  将发 挥 他 的 作 用
 python  example
简 单用 法检 查 docstrings 中的示 例
开始使用 doctest  的最简单方 法但不一定 是你将继 续这样做 的方 式是结 束每 个模 块 m 使用 if  name  main  import  doctest  doctest
simple  usage  checking  examples  in  a  text  file
how  it  works
which  docstrings  are  examined
how  are  docstring  examples  recognized
whats  the  execution  context
what  about  exceptions
option  flags
3
4 新版功能 the  o  command  line  option
在3
2版 更改 ignoreexceptiondetail  now  also  ignores  any  information  relating  to  the  module  containing  the  exception  under  test
3
4新 版 功 能
directives
 警告
 another  is  to  do  d  sortedfoo  d  harry  hermione  注 解 before  python 3
basic  api
 for  a  lessformal  introduction  to  these  two  functions  see  sections  简单用 法检查 docstrings 中的 示例 and  simple  usage  checking  examples  in  a  textfile
unittest  api
 在3
5版 更 改 doctestsuite  returns  an  empty  unittest
advanced  api
doctest 对 象
example  objects
doctestfinder 对 象
doctestparser 对 象
doctestrunner 对 象
outputchecker  对 象
 调试
soapbox
formatfail  total 脚注1 examples  containing  both  expected  output  and  an  exception  are  not  supported
emailcharset  representing  character  sets
 本段 落中 的 剩 余文 本是 该模 块的 原始文档
emailmessagemessage  representing  an  email  message  using  the  compat 32 api
emailcontentmanager  managing  mime  content
py 3
6 新版功能1 class  email
content  manager  instances
 注解 a  cte  of  binary  does  not  actually  work  correctly  yet
 脚注1 originally  added  in 3
emailencoders 编码 器
emailerrors 异 常和缺陷 类
email  示 例
 以 下是 一 些 如何使 用 email 包 来 读 取、 写入 和 发送简 单 电子 邮件 以 及更复杂 的 mime 邮 件的示 例
首先 让 我 们 看 看如何 创 建 和 发 送简单 的文 本消 息文本 内容 和地 址 都可 能包含 unicode  字 符 import  smtplib  for  the  actual  sending  function  import  smtplib  import  the  email  modules  well  need  from  email
quit 解 析 rfc 822标 题可以 通 过使 用 parser  模 块中 的类来轻 松完 成 import  the  email  modules  well  need  from  email
displayname  以下是 如 何 发 送 包含可能 在 目录 中 的一 系列 家庭照 片的 mime  消息 示例 import  smtplib  for  the  actual  sending  function  import  smtplib  and  imghdr  to  find  the  types  of  our  images  import  imghdr  here  are  the  email  package  modules  well  need  from  email
sendmessagemsg 以 下是 如 何将 目录 的全 部内 容作 为电子 邮 件 消 息发送的 示例1 usrbinenv  python 3 send  the  contents  of  a  directory  as  a  mime  message
sendmessagemsg  if  name  main  main  以下是 如何 将 上述 mime  消息 解 压缩到 文 件 目录 中的 示 例 usrbinenv  python 3 unpack  a  mime  message  into  a  directory  of  files
getpayloaddecodetrue  if  name  main  main 以 下是如何 使用备 用纯文本 版 本创 建 html 消息 的 示例
 为了让 事情 变得 更有 趣我 们 在 html  部分 中 包含了 一个 相 关的图 像 我们 保存 了一份 我们 要 发送 的 内容到 硬 盘 中然 后 发 送它
sendmessagemsg  如果 我们 发送最 后一个示例中 的消 息 这 是我 们可 以处 理它 的一 种方 法 import  os  import  sys  import  tempfile  import  mimetypes  import  webbrowser  import  the  email  modules  well  need  from  email  import  policy  from  email
 直到输 出提 示上 面的 输出 是 to  penelope  pussycat  penelopeexample
 脚注1感 谢 matthew  dixon  cowles 提 供最 初 的 灵感 和示例
emailgenerator  generating  mime  documents
3
2 新版 功能
 在3
3 版更改 添加 了 policy  关键 字
在3
6 版更 改 the  default  behavior  of  the  manglefrom  and  maxheaderlen  parameters  is  to  follow  the  policy
在3
3 版更 改 添加 了 policy 关键 字
 在3
6版 更改 the  default  behavior  of  the  manglefrom  and  maxheaderlen  parameters  is  to  follow  the  policy
 在3
2 版更 改 added  support  for  reencoding 8 bit  message  bodies  and  the  linesep  argument
脚 注1 this  statement  assumes  that  you  use  the  appropriate  setting  for  unixfrom  and  that  there  are  no  policy  settings  calling  for  automatic  adjustments  for  example  refoldsource  must  be  none  which  is  not  the  default
emailheader  internationalized  headers
本 段落中 的剩余 文本 是该 模块 的原 始文档
 在3
2版 更改 added  the  linesep  argument
 在3
2版 更改 added  handling  for  the  unknown 8 bit  charset
emailheaderregistry  custom  header  objects
py 3
6 新版功 能1 headers  are  represented  by  customized  subclasses  of  str
 the  default  mappings  are  subject  uniqueunstructuredheader  date  uniquedateheader  resentdate  dateheader  origdate  uniquedateheader  sender  uniquesingleaddressheader  resentsender  singleaddressheader 到 uniqueaddressheader  resentto  addressheader  cc  uniqueaddressheader  resentcc  addressheader  bcc  uniqueaddressheader  resentbcc  addressheader  从 uniqueaddressheader  resentfrom  addressheader  replyto  uniqueaddressheader  mimeversion  mimeversionheader  contenttype  contenttypeheader  contentdisposition  contentdispositionheader  contenttransferencoding  contenttransferencodingheader  messageid  messageidheader  headerregistry  has  the  following  methods  maptotypeself  name  cls  name  is  the  name  of  the  header  to  be  mapped
 the  general  form  of  an  address  is  displayname  usernamedomain  或 者 usernamedomain  where  each  part  must  conform  to  specific  syntax  rules  spelled  out  in  rfc 5322
 脚注1 originally  added  in 3
emailiterators  迭代器
源代 码 libemailiterators
py  通过 message
walk  方法 来 迭代消 息对象树是 相 当 容易的
email
iterators  模块 提供 了一些 适用 于消息对 象 树的 高 层 级 迭 代器
bodylineiteratormsg  decodefalse 此 函数 会 迭 代 msg 的 所 有 子部 分中 的所 有 载荷逐 行返 回 字符串 载 荷
 它 会跳 过所有 子 部分的 标头 并且它也 会跳 过任何包 含 不为 python 字 符串的载 荷的 子部 分
这 基 本 上等 价 于 使用 readline  从 一个文 件读 取消 息的 纯文 本表 示形 式并 跳 过所 有 中间 的标头
可 选的 decode  会被传递 给 message
typedsubpartiteratormsg  maintypetext  subtypenone 此 函数 会迭 代 msg 的 所有 子部 分只返 回其 中与 maintype  和 subtype 所 指定 的 mime 类型 相匹配 的子 部分
 请注 意 subtype 是 可选 项 如果 省略则 仅使 用主 类型来进行 子部分 mime 类型 的匹配
 maintype  也是可选项 它 的 默认值为 text
因 此在默 认 情况 下 typedsubpartiterator  会返 回每一 个 mime 类 型为 text  的 子部分
 增加 了以下函 数 作 为有 用 的 调试工具
它 不应 当被视为该 包所 支持的 公 共接 口的 组成 部 分
structuremsg  fpnone  level 0 includedefaultfalse 打印消息 对象 结构的 内 容 类型 的缩 进 表示 形 式
例 如 msg  email
messagefromfilesomefile  structuremsg  multipartmixed  textplain  textplain  multipartdigest  messagerfc 822 textplain  messagerfc 822 textplain  messagerfc 822 textplain  messagerfc 822 textplain  messagerfc 822 textplain  textplain 可 选 项 fp  是一 个 作为 打 印 输 出 目标 的文 件类 对象
 它 必须适 用于 python 的 print  函数
 level  是供 内部使用 的
 includedefault 如 果为真 值则会同时 打印 默认 类 型
emailmessage 表 示 一 封电 子邮 件 信息
emailmime  creating  email  and  mime  objects  from  scratch
在3
6 版更 改 added  policy  keywordonly  parameter
 在3
6 版更改 added  policy  keywordonly  parameter
 在3
6版 更改 added  policy  keywordonly  parameter
 在3
6 版更 改 added  policy  keywordonly  parameter
 在3
6版 更改 added  policy  keywordonly  parameter
 在3
6版 更 改 added  policy  keywordonly  parameter
 在3
5 版更 改 charset  also  accepts  charset  instances
在3
6版 更改 added  policy  keywordonly  parameter
emailparser  解 析 电子 邮 件信息
 源代 码 libemailparser
py  使 用 以 下两 种方 法的 其中一 种以创 建消 息 对象 结 构直 接创 建 一个 emailmessage  对 象 使 用字典 接口 添 加消息 头并 且 使 用 setcontent 和 其他 相关 方 法 添 加消息负 载 或者通 过 解析 一 个电子 邮件 消 息 的序 列化 表 达来创 建消 息对象结 构
email 包提 供了 一 个可 以 理解 包 含 mime 文 档 在内 的绝 大多 数 电子邮 件文档 结 构 的标准语 法分 析程 序
你 可以 传递给 语法 分 析程 序 一个字 节串、 字符 串 或者文件 对 象语 法 分 析 程序会 返 回 给 你对 应 于该 对象 结 构 的根 emailmessage  实例
 对 于 简单的、 非 mime 的消 息这 个根对 象 的负 载 很可 能 就是 一个包 含 了该 消息 文字 内容 的字 符串
对 于 mime  消息 调用根 对象的 ismultipart 方 法会 返回 true  其子项 可以 通 过负载 操纵 方法 来进 行访 问 例 如 getbody 、 iterparts 还 有 walk
事 实上 你 可 以使 用的语 法分析程 序接 口有 两 种 parser  api  和增 量式的 feedparser  api
当 你的全部 消息内容 都在内存 当中或者 整个 消息 都保存 在 文 件 系统内 的一 个 文件当 中的 时 候 parser  api  非常 有 用
当 你从 可能会 为 了等 待更 多 输入而 阻塞 的 数 据流 当中读 取消 息比 如 从 套接 字当 中 读 取电 子邮 件 消息 的 时候 feedparser 会 更 合 适
feedparser 会 增量 读取 并解 析消 息并 且只有在 你 关闭语 法分 析程 序 的 时候 才会返回根 对象
 请注 意 语法分 析 程序可 以进 行有限 的拓 展你当 然 也 可以 完全 从 零开 始实 现你自 己 的语 法 分析程 序
 将 email 包中 内置 的 语法 分 析 程序和 emailmessage  类连 接起 来的 所有 逻 辑代码都包 含在 policy  类当 中所 以如有 必要自 定 义 的语 法分 析程 序可 以通过 实现 自定义 的对 应 policy 方法来 创 建对 应的 消息 对象 树
feedparser  api
parser  api
附 加说 明
 在解析语 义的时候请 注意大多 数非 multipart 类型 的消息都会被 解 析为 一个 带 有字 符串 负 载 的消 息 对象
 这些 对象 在 调 用 ismultipart 的 时候 会 返回 false  调 用 iterparts  的时 候会 产生一 个 空 列表
 所有 multipart  类 型的消 息 都会 被 解析成 一个 容 器 消息对象
该 对象 的 负载 是 一 个 子 消息对象 列 表
外 层 的容器 消 息在调 用 ismultipart 的 时候 会 返 回 true 在 调 用 iterparts  的时 候会 产生 一 个 子 部分 列表
 大多 数内 容 类 型为 message  例 如 messagedeliverystatus 和 messagerfc 822的消息 也会 被解 析为 一 个 负载是 长度 为1的列 表 的容器 对象
 在它 们身上 调用 ismultipart  方 法会 返 回 true  调用 iterparts  所产 生 的单 个元 素会 是 一个子消 息 对象
 一 些不 遵循标准 的 消息 在其 内部 关于它是 否为 multipart  类 型 前 后 不 一
 这 些 消息 可 能 在消 息头 的 contenttype  字段 中 写明 为 multipart  但 它们的 ismultipart 方法 的 返 回 值可 能是 false 
 如果 这 种消 息被 feedparser  类解析 它 们 的 defects 属性列 表当 中 会有一 个 multipartinvariantviolationdefect 类 的 实 例
关于 更 多信 息 详 见 email
errors 
emailpolicy  policy  objects
3
3 新版 功能
3
5 新 版 功能 the  manglefrom  parameter
3
6新 版功 能
 in  addition  to  the  settable  attributes  listed  above  that  apply  to  all  policies  this  policy  adds  the  following  additional  attributes 3
6 新版 功 能1 utf 8 if  false  follow  rfc 5322 supporting  nonascii  characters  in  headers  by  encoding  them  as  encoded  words
3
4新 版 功 能
 脚注1 originally  added  in 3
email  电 子邮 件 与 mime 处 理包
 源码 libemailinit
在3
6 版更 改 docs  reorganized  and  rewritten  to  promote  the  newemailmessageemailpolicy  api
message 表 示一 封电 子邮件信 息 email
parser 解 析电 子 邮件 信息 feedparser  api  parser  api  附 加说 明 email
errors 异 常和 缺 陷 类 email
contentmanager  managing  mime  content  content  manager  instances  email 示 例 legacy  api  email
encoders 编 码 器 email
utils  其他 工具 email
iterators  迭 代 器 参 见 module  smtplib  smtp  simple  mail  transport  protocol  client  module  poplib  pop  post  office  protocol  client  module  imaplib  imap  internet  message  access  protocol  client  module  nntplib  nntp  net  news  transport  protocol  client  module  mailbox  tools  for  creating  reading  and  managing  collections  of  messages  on  disk  using  a  variety  standard  formats
emailutils  其他工 具
ensurepip  bootstrapping  the  pip  installer
3
4新 版功能
 注解 this  module  does  not  access  the  internet
 参 见安 装 python  模块 the  end  user  guide  for  installing  python  packages  pep 453 explicit  bootstrapping  of  pip  in  python  installations  the  original  rationale  and  specification  for  this  module
command  line  interface
module  api
 注 解 the  bootstrapping  process  has  side  effects  on  both  sys
注解 the  bootstrapping  process  may  install  additional  modules  required  by  pip  but  other  software  should  not  assume  those  dependencies  will  always  be  present  by  default  as  the  dependencies  may  be  removed  in  a  future  version  of  pip
enum  对枚 举的支 持
3
4新版 功能
源代 码 libenum
py 枚 举是 一组 符 号名 称 枚举 成员 的 集合枚 举成 员应 该 是唯 一的、 不可变 的
在 枚举 中 可 以对成 员进 行恒等 比较并 且 枚举 本 身 是 可 迭 代 的
 注解 枚 举 成 员 名 称 的大 小 写因为 枚举是 被 用 来代 表 常量 的 所以我 们 建 议 枚举成 员 名称 应使 用大写形式 并将 在我 们 的 示例 中使 用 此 种 风格
 模块内 容
此 模块 定义 了 四个 枚 举类它 们 可 被用来 定 义名 称和 值的不重复 集 合 enumintenum  flag 和 intflag
此 外还 定义了 一个装 饰 器 unique 和 一个 辅助类 auto
enum 此 基类 用于创 建 枚举 常量
 请参 阅 functional  api  小节了 解 另 一种 替代性 的构建语 法
intenum 此 基类 用 于创 建 属于 int  的 子类 的 枚 举 常量
intflag 此基 类用 于创 建 可 使用 按位 运算 符进行 组合而不 会丢失 其 intflag 成员 资格 的 枚举 常量
 intflag  成 员 同样也是 int 的 子类
flag  此基 类用 于创 建 枚举 常量 可使用 按位运 算符进 行 组 合 而不 会 丢 失其 flag  成员 资 格的 枚 举常 量
unique 此 enum  类装饰器 可 确 保只将 一个 名 称 绑定 到 任 意一 个值
auto 实 例会 被替 换为 一个 可 作为 enum  成 员的 适 当的 值
 默 认情 况 下 初始 值从1 开始
3
6 新版 功 能 flag  intflag  auto
 创建一个 enum
 对枚 举 成员 及 其 属性 的 程序化 访 问
复 制枚 举成员 和值
 确 保唯一的 枚举值
默认 情况 下 枚举 允 许有 多个 名 称作 为某个相 同值的 别 名
如果 不想 要这样 的行为可以 使 用以 下装 饰器 来确 保 每个 值 在枚举 中 只被 使 用 一次 enum
unique  专用 于 枚 举 的 class 装 饰器
它会 搜索一 个枚 举的 members  并收 集 所 找到 的 任何 别 名只要 找到任何 别名 就会引发 valueerror  并附带相 关细 节 信 息 from  enum  import  enum  unique  unique 
使 用 自 动设定的 值
如 果 确切 的值 不重 要 你 可 以使用 auto  from  enum  import  enum  auto  class  colorenum 
green 3值 将 由 generatenextvalue  来选 择 该 函数 可以 被重载 class  autonameenum 
west  west  注解 默 认 generatenextvalue 方 法 的目 标是 提供 所给 出的 最后一 个 int 所在序 列的 下一 个 int  但这 种行为 方 式 属于 实现细 节 并 且可 能发生 改变
 注解 generatenextvalue  方法 定 义必 须在 任何 其他成 员之前
 迭代
 对枚 举成 员 的迭 代 不会给出别 名 listshape  shape
circle 3特 殊属 性 members  是一个从 名称到 成员的 只读 有 序 映射
 它 包 含 枚举中 定义 的所 有 名 称包括别 名 for  name  member  in  shape
square 2 members 属 性可 被用于 对枚举 成员 进 行 详细的 程序 化访 问
 例如 找 出 所有 别名 name  for  name  member  in  shape
 比较
 枚举 成 员是 按 标 识号 进行 比较的 color
blue  true 枚 举值 之间 的 排序 比 较 不被 支持
 enum  成员不属 于整 数另请参 阅下 文的 intenum  color
blue  traceback  most  recent  call  last  file  stdin  line 1 in  module  typeerror  not  supported  between  instances  of  color  and  color  相 等 比 较 的 定义 如 下 color
blue  true 与 非枚 举 值 的 比 较 将总 是 不相 等同 样 地 intenum 被显 式设 计 成 不 同的 行为参 见下 文 color
允 许的 枚举 成员 和 属 性
受 限的 enum  子类 化
一 个新 的 enum 类 必须 基于 一个 enum  类至多一 个 实 体数 据 类型以及 出于 实 际需 要 的任 意 多个基 于 object 的 mixin  类
 这 些 基类 的顺序 为 class  enumnamemixin 
 datatype  baseenum  pass 另 外仅 当 一个 枚 举 未定 义任 何成 员时 才允许子类 化 该枚举
 因此 禁 止这 样的 写法 class  morecolorcolor 
 typeerror  cannot  extend  enumerations  但是允 许这 样的写法 class  fooenum 
 允许 子 类化定 义了 成员 的枚 举将 会 导致 违 反类 型 与实 例 的某 些重 要 的不 可变 规则
 在另 一 方 面允许 在一 组枚举 之间 共享 某 些通 用 行为 也 是 有 意义的
 请参 阅 示例 orderedenum 

 封 存
枚举可 以被 封存 与解 封 from  test
tomato  true  封存 的 常 规 限 制同 样适 用可 封存 枚举 必 须在 模 块的最高 层级 中 定义因为 解封 操作 要求 它 们可 以 从该模 块导 入
 注 解使 用 pickle 协 议版 本4可以 方便 地 封存嵌套 在其他类 中的 枚举
 通过 在枚 举 类 中 定 义 reduceex 可 以 对 enum 成 员的封存 解封方 式 进行 修改
 功 能性 api
 派生的枚 举
intenum
 所提 供 的第一 个变 种 enum  同时也是 int  的一个子 类
 intenum 的 成员 可与整数 进行 比 较通过 扩 展不 同类 型 的 整 数枚 举 也可 以相 互 进行 比较 from  enum  import  intenum  class  shapeintenum 
post  true 不 过它 们仍然 不 可 与标 准 enum  枚 举 进 行 比较 class  shapeintenum 
red  falseintenum 值 在其他 方面 的行 为都 如你 预期的 一样 类似于整 数 intshape
intflag
flag
 其 他事项
何时 使用 new  与 init
当 你想要 定制 enum 成员的 实 际 值 时必须 使用 new
 任何 其他修 改可 以用 new  也可 以用 init  应优 先使 用 init
举例 来说 如果 你要 向构 造 器传 入多个 条目但 只 希望将 其 中 一 个作 为 值 class  coordinatebytes  enum 
有趣 的示例
虽 然 enum  intenum  intflag 和 flag  预期可覆 盖 大多 数应 用 场 景但 它们 无 法 覆盖全 部
这 里 有一些不 同类 型枚 举 的方 案它 们可 以被直 接使 用或 是作 为自行 创建的 参考示例
 省略 值
 在许多 应用 场景中人 们 都不关 心枚 举的 实际 值是 什么
 有几个方 式可以 定 义此 种 类型 的简 单枚 举使 用 auto  的实 例作 为值 使 用 object 的 实例作 为值 使 用描 述 性的字符 串 作为值使 用元 组作 为值 并 用自定义 的 new 以一个 int  值来替代 该元组 使用 以 上 任何一 种方 法均 可 向 用户指明 值 并不 重要 并 且使 人 能够 添加、移除或 重 排 序成员 而不 必 改 变其 余成员的数 值
 无 论 你选 择 何种 方 法 你都 应当 提 供一 个 repr  并 且 它也 需 要隐 藏不重 要的 值 class  novalueenum 
 使 用 auto  使 用 auto 的 形式 如 下 class  colornovalue 
green  使 用 object 使 用 object  的 形 式 如 下 class  colornovalue 
green 使用 描 述 性字 符 串使 用字 符 串 作 为 值的 形式 如下 class  colornovalue 
value  go 使 用自 定义的 new  使 用自 动 编号 new 的形 式 如下 class  autonumbernovalue 
value 2要 实现 更通用的 autonumber  请添加 args 到 签名 中 class  autonumbernovalue 
这样当你 从 autonumber 继 承时 你将 可以编写你 自己的 init  来处 理任 何附加 参数 class  swatchautonumber 
pantone  unknown  注解如 果 定 义了 new  则它 会 在创 建 enum 成 员期 间被 使 用随 后它将被 enum  的 new 所 替换该方 法会 在 类 创建 后被 用来查 找现 有 成员
orderedenum
 一个 有 序 枚 举 它不 是基 于 intenum  因 此保持 了 正 常 的 enum  不变 特性例 如 不 可与其 他 枚 举进行 比 较 class  orderedenumenum 
duplicatefreeenum
如果 发现 重复的成 员名称 则 将 引 发 错误而 不是 创建别 名 class  duplicatefreeenumenum 
 valueerror  aliases  not  allowed  in  duplicatefreeenum  grene  green 注 解这 个例 子适 用 于子 类化 enum  来添加 或改 变禁 用别 名以 及其 他行 为
如 果 需 要的 改 变 只是 禁用 别 名也 可以 选择 使用 unique 装 饰器
planet
 如果 定义 了 new 或 init 则 枚举 成员 的值 将被 传给 这 些方 法 class  planetenum 
timeperiod
一个 演 示如 何 使用 ignore  属 性 的 例 子 from  datetime  import  timedelta  class  periodtimedelta  enum 
 各种 枚举 有何 区别？
 枚举 具有 自 定 义的 元类它 会 影响所派 生 枚 举类及其 实例成 员 的各个方 面
枚举 类
enummeta 元类负责 提供 contains  dir  iter 及其他 方法以 允许用户通 过 enum  类 来 完成 一 般类 做不到的事 情例如 listcolor 或 someenumvar  in  color
 enummeta 会负 责确 保 最 终 enum 类 中 的各 种 其他 方法 是正 确的例 如 newgetnewargs  str 和 repr
枚 举成员 即实例
有 关枚 举成 员最有 趣 的特点是它 们 都是 单例 对象
 enummeta  会 在创 建 enum  类本 身时将 它们 全部创 建完 成然 后准备好 一个 自定义 的 new 通 过只返回现 有的 成员 实 例来确保 不会 再实例 化新 的 对象
 细 节要 点
errno 标准 errno  系统 符号
 本模 块提供 标 准 的 errno  系统 符 号
每 个符 号的值 是 其 对 应的整数 值
 符 号 的名 称 和 描述 来自 linuxincludeerrno
h  应该是 非常 全 面 的
errorcode  提供从 errno  值到 底 层 系 统中 字 符串名称 的 映射 的 字 典
例 如 errno
eperm  映射 为 eperm 
如果要 将数 字的 错误 代码转换 为 错 误信 息请 使用 os
在 下面的 列表 中当 前平 台上 没 有使 用 的符 号没有 被本模 块定义
 已定义 的符 号的 具体列 表可 参见 errno
 可用的 符号 包括 errno
eperm  操作 不 被 允许 errno
enoent  无 此文 件或 目 录 errno
esrch 无此 进程 errno
eintr 系 统调 用中 断
参见 此 错 误被映 射 到 异 常 interruptederror
eio  io  错误 errno
enxio  无此 设备 或地 址 errno
e 2 big  参 数列 表 过长 errno
enoexec 执 行格 式错 误 errno
ebadf 错 误的 文件 号 errno
echild  没 有 子进程 errno
eagain  重试 errno
enomem  内存 不足 errno
eacces 没 有权 限 errno
efault 错 误 的地址 errno
enotblk  需要块 设备 errno
ebusy  设 备或资源 忙 errno
eexist  文件 已存 在 errno
exdev  跨设备链 接 errno
enodev 无此设 备 errno
enotdir  不是 目录 errno
eisdir 是 目录 errno
einval 无 效的 参数 errno
enfile  文 件表 溢出 errno
emfile  打开 的文 件过多 errno
enotty  不 是 打 字 机 errno
etxtbsy  文本 文件 忙 errno
efbig 文件 过大 errno
enospc  设备已无 可用空间 errno
espipe 非 法查找 errno
erofs  只 读文 件系统 errno
emlink 链 接过 多 errno
epipe 管 道已 损 坏 errno
edom 数 学 参 数超出函数 范 围 errno
erange  数学 运算 结 果无法 表示 errno
edeadlk  将 发生 资源死锁 errno
enametoolong  文件 名过 长 errno
enolck 没 有可 用的 记录 锁 errno
enosys 功 能 未 实现 errno
enotempty  目 录非 空 errno
eloop 遇 到 过 多的 符 号链接 errno
ewouldblock  操 作将阻 塞 errno
enomsg 没有 所需类 型的消 息 errno
eidrm  标 识 符被移 除 errno
echrng 信 道编 号 超出 范 围 errno
el 2 nsync 级 别2未 同步 errno
el 3 hlt 级别3 已停止 errno
el 3 rst  级别3重 置 errno
elnrng 链接编 号超出 范 围 errno
eunatch 未 附加 协 议驱 动 errno
enocsi  没有 可用的 csi 结 构 errno
el 2 hlt  级别2 已停止 errno
ebade  无 效 的交 换 errno
ebadr 无效 的请求 描述符 errno
exfull  交换已满 errno
enoano  没有阳 极 errno
ebadrqc 无 效的 请求码· errno
ebadslt  无 效的 槽位 errno
edeadlock 文 件 锁定死锁 错误 errno
ebfont  错误的 字体文件 格式 errno
enostr  设备 不是 流 errno
enodata  没有可 用的 数据 errno
etime  计时器 已 到 期 errno
enosr  流资源 不足 errno
enonet 机 器不在 网络上 errno
enopkg 包未 安装 errno
eremote  对象 是 远程 的 errno
enolink  链接 已被 切 断 errno
eadv 广 告错误 errno
esrmnt  挂 载错 误 errno
ecomm 发送 时通 讯错 误 errno
eproto  协议错 误 errno
emultihop 已 尝 试多 跳 errno
edotdot  rfs 专属错 误 errno
ebadmsg 非 数据 消息 errno
eoverflow  值 相对 于已定 义数 据类 型过 大 errno
enotuniq 名 称在 网络 上 不唯 一 errno
ebadfd  文件 描述 符处 于 错 误状态 errno
eremchg 远 端地址 已 改变 errno
elibacc  无法 访问 所 需的 共享库 errno
elibbad  访问已 损坏的 共享库 errno
elibscn  a
out 中 的
lib 部 分已损 坏 errno
elibmax 尝试 链接 过 多的 共享 库 errno
elibexec 无 法 直 接执行 共享 库 errno
eilseq 非 法字节 序 列 errno
erestart 已 中 断 系 统调用 需 要重启 errno
estrpipe 流 管 道错误 errno
eusers  用户 过多 errno
enotsock 在 非套 接字 上执 行套 接字操 作 errno
edestaddrreq 需 要目 标地 址 errno
emsgsize 消 息过长 errno
eprototype  套 接字的 协议 类 型错 误 errno
enoprotoopt 协 议不 可 用 errno
eprotonosupport 协 议不受 支持 errno
esocktnosupport  套接字 类型不受 支持 errno
eopnotsupp  操作在 传 输端点 上不受 支持 errno
epfnosupport  协 议族不 受支 持 errno
eafnosupport  地 址族 不受协 议支持 errno
eaddrinuse 地 址已 被 使用 errno
eaddrnotavail  无 法 分 配要求 的地址 errno
enetdown  网 络已断开 errno
enetunreach  网 络不可 达 errno
enetreset 网 络因重置 而断开 连接 errno
econnaborted  软 件导 致 连 接中止 errno
econnreset  连接被 对方 重置 errno
enobufs 没 有 可 用的缓冲 区空 间 errno
eisconn 传 输端 点已 连 接 errno
enotconn  传输端 点未连 接 errno
eshutdown 传输 端点 关 闭 后 无法 发 送 errno
etoomanyrefs  引用过多无法 拼 接 errno
etimedout 连 接 超 时 errno
econnrefused 连 接 被拒 errno
ehostdown 主 机已 关 闭 errno
ehostunreach 没 有到 主机 的路 由 errno
ealready 操作已 在进 行 errno
einprogress 操 作正在 进行 errno
estale 过 期的 nfs 文 件句柄 errno
euclean  结构 需要 清 理 errno
enotnam 不是 xenix 命名类 型文件 errno
enavail  没 有 可 用的 xenix  信 标 errno
eisnam 是 命 名类 型 文件 errno
eremoteio  远程 io 错误 errno
edquot  超出 配 额
 内 置异 常
基类
 下 列 异 常 主要 被用作 其他 异 常的基 类
exception  baseexception 所 有 内置异常 的基 类
 它不 应 该被用 户自 定义类 直接 继承 这种情况 请 使 用 exception
如 果 在 此类 的实 例 上 调 用 str 则 会 返回 实例的 参 数 表示 或 者 当没 有参数 时返 回 空 字 符串
 args 传 给异 常 构造 器的 参数 元 组
 某 些 内置异 常例 如 oserror 接受 特 定 数量的 参数 并赋 予 此元组 中 的元 素特 殊的 含 义而 其 他 异 常通 常只 接 受 一个 给 出 错误信息 的单 独字符 串
 withtracebacktb 此方 法 将 tb 设 为异 常的新回 溯信 息 并返 回该 异 常 对 象
 它通 常以 如 下 的 形 式在异常 处理 程 序中 使 用 try 
withtracebacktbexception  exception 所 有内置 的 非系 统退出类 异常都派 生自此 类
所 有 用户 自 定义 异 常 也应 当 派 生自 此 类
exception  arithmeticerror 此基类 用 于派生 针对 各种 算术类错 误而引 发的内置 异常 overflowerror  zerodivisionerror  floatingpointerror
exception  buffererror  当 与缓 冲 区相 关的 操作 无 法 执 行时 将 被引 发
exception  lookuperror  此基类用 于 派生 当 映射 或 序列所使 用的 键或索引 无效时 引发 的异常 indexerror  keyerror
这 可以通 过 codecs
lookup 来 直接 引 发
 具 体异常
os  异常
警 告
 下列异 常 被用 作警 告类 别请 参 阅 警 告类别文 档 了解 详情
exception  warning 警 告类别 的 基类
exception  userwarning 用 户代 码所 产生 警 告的基 类
exception  deprecationwarning  如果所 发出 的警 告是针 对其 他 python  开发 者的 则 以此 作 为与 已弃用 特 性 相关 警 告 的基 类
会 被默认警告 过滤 器忽略在 main  模 块中 的情况 除 外 pep 565
 启 用 python  开发 模 式 时 会显示 此警 告
exception  pendingdeprecationwarning  对于 已过 时 并预 计 在 未来弃 用 但目 前尚未 弃 用的 特性 相关警 告 的基 类
这个 类很少 被使 用 因 为 针对未 来可 能的弃用 发出 警告 的做法 并不常 见而 针 对 当 前已 有的 弃用则推 荐使用 deprecationwarning
会 被默 认警告过 滤 器忽略
 启用 python  开发 模式 时会 显示此警 告
exception  syntaxwarning 与模糊 的语法 相关 的警 告的 基类
exception  runtimewarning 与 模 糊的 运行时 行为 相关 的 警 告的 基类
exception  futurewarning  如 果所 发出 的警告是 针对以 python  所编 写应 用 的 最终用 户的 则以 此作为 与已弃用特 性相 关警 告的 基类
exception  importwarning  与在 模块 导 入 中 可能 的错 误 相关 的 警告 的基 类
 会被默 认警 告过滤器 忽略
启 用 python 开发模 式 时会 显示此 警告
exception  unicodewarning  与 unicode 相 关的 警告的 基类
exception  byteswarning 与 bytes 和 bytearray  相关 的 警 告的 基类
exception  resourcewarning 资 源使 用相 关警 告 的 基类
 会被 默认 警 告过 滤器 忽 略
启 用 python  开发 模式 时会 显 示此 警 告
3
2新 版功 能
 异常 层 次结 构
内 置异 常的类 层级 结构 如下 baseexception  systemexit  keyboardinterrupt  generatorexit  exception  stopiteration  stopasynciteration  arithmeticerror  floatingpointerror  overflowerror  zerodivisionerror  assertionerror  attributeerror  buffererror  eoferror  importerror  modulenotfounderror  lookuperror  indexerror  keyerror  memoryerror  nameerror  unboundlocalerror  oserror  blockingioerror  childprocesserror  connectionerror  brokenpipeerror  connectionabortederror  connectionrefusederror  connectionreseterror  fileexistserror  filenotfounderror  interruptederror  isadirectoryerror  notadirectoryerror  permissionerror  processlookuperror  timeouterror  referenceerror  runtimeerror  notimplementederror  recursionerror  syntaxerror  indentationerror  taberror  systemerror  typeerror  valueerror  unicodeerror  unicodedecodeerror  unicodeencodeerror  unicodetranslateerror  warning  deprecationwarning  pendingdeprecationwarning  runtimewarning  syntaxwarning  userwarning  futurewarning  importwarning  unicodewarning  byteswarning  resourcewarning
faulthandler  dump  the  python  traceback
3
3新 版功 能
dumping  the  traceback
 在3
5 版 更 改 added  support  for  passing  file  descriptor  to  this  function
fault  handler  state
在3
5 版 更 改 added  support  for  passing  file  descriptor  to  this  function
在3
6 版更改 on  windows  a  handler  for  windows  exception  is  also  installed
dumping  the  tracebacks  after  a  timeout
在3
7版 更改 this  function  is  now  always  available
 在3
5版 更改 added  support  for  passing  file  descriptor  to  this  function
dumping  the  traceback  on  a  user  signal
 在3
5版 更改 added  support  for  passing  file  descriptor  to  this  function
issue  with  file  descriptors
示 例
fcntl  the  fcntl  and  ioctl  system  calls
在3
3 版更改 operations  in  this  module  used  to  raise  an  ioerrorwhere  they  now  raise  an  oserror
 在3
8 版更 改 the  fcntl  module  now  contains  faddsealsfgetseals  and  fseal  constants  for  sealing  ofos
 在3
9版更 改 on  macos  the  fcntl  module  exposes  the  fgetpathconstant  which  obtains  the  path  of  a  file  from  a  file  descriptor
 onlinux 3
15 the  fcntl  module  exposes  the  fofdgetlkfofdsetlk  and  fofdsetlkw  constants  which  working  with  openfile  description  locks
这 个模 块 定义 了以下 函数 fcntl
 举个例 子 import  array  fcntl  struct  termios  os  os
参 见 模块 os  if  the  locking  flags  oshlock  and  oexlock  are  present  in  the  os  module  on  bsd  only  the  os
filecmp 文件 及目 录的比 较
源 代码 libfilecmp
pyfilecmp 模块 定义了用于 比较文件 及 目录 的 函 数 并且可以 选取 多 种 关于时 间和 准 确性的折 衷方 案
 对于 文件 的 比 较另 见 difflib 模 块
filecmp  模 块定 义 了如下函 数 filecmp
cmpf 1 f 2 shallowtrue 比较名 为 f 1和 f 2的 文件 如 果 它 们 似乎相等 则返回 true  否则返 回 false 
如果 shallow 为 真 那么 具有 相同 os
stat 签 名的 文件 将 会 被认为 是相 等的
否 则将 比较 文件的内 容
需 要注 意没有外 部 程 序被该 函数 调用 这赋予 了该函 数 可 移 植性 与 效 率
该 函数 会缓 存过 去的 比较 及 其结 果且 在文 件的 os
stat 信息变化 后缓 存条目 失效
 所有的缓 存可以 通过 clearcache 清除
cmpfilesdir 1 dir 2 common  shallowtrue  比较 在两 个目录 dir 1 和 dir 2 中由 common  所确定 名称 的文 件
 返 回三 组 文件 名列表 match  mismatch  errors 
 match  含有 相匹配 的文 件 mismatch 含 有 那些 不匹配的 然后 errors 列 出 那些 未被 比较 文 件的 名 称
如果文 件 不 存在于两 目录中 的任 一个 或 者用 户缺 少 读取 它们 的 权 限 又 或者 因 为其 他 的一 些 原因 而无 法比 较那 么这 些文 件将会 被 列在 errors  中
参 数 shallow 具 有 同 filecmp
cmp 一 致 的 含 义与默认 值
例如 cmpfilesa  b  c  de  将会 比较 ac  与 bc  以及 ade  与 bde 
 c 和 de  将 会各 自出 现 在 返 回 的三 个 列表 里 的某 一 个列 表中
clearcache  清除 filecmp  缓存
 如果 一个 文件 过快地 修改 以至 于 超过底 层 文件系 统 记录修 改时 间的精度 那么该 函 数 可 能 有助 于比 较该 类 文 件
3
4 新版 功能
dircmp  类
dircmpa  b  ignorenone  hidenone  创建 一 个 用于 比较 目 录 a 和 b 的新 的 目录 比 较对 象
 ignore 是需 要 忽略 的 文 件 名列 表 且默 认为 filecmp
defaultignores 
 hide 是 需要 隐 藏 的文 件名 列 表且 默认 为 os
pardir 
 dircmp 类 如 filecmp
cmp  中所 描述 的 那样对 文 件进行 shallow  比较
 dircmp  类提 供 以下方 法 report 将 a  与 b 之 间的 比较 打印 到 sys
stdout 
 reportpartialclosure  打印 a 与 b  及共 同直 接子目 录 的比较 结果
 reportfullclosure  打 印 a 与 b  及 共同子 目录比较 结 果递归 地
 dircmp  类提供 了一些 有 趣的属 性 用以得 到关于参与 比 较的目 录 树的各 种 信息
需 要注意通 过 getattr 钩 子 所有的 属性 将 会惰性 求值因此 如果只使用 那 些计算 简便的 属 性将不 会 有速度 损失
 left  目 录 a 
 right 目录 b 
 leftlist  经 hide  和 ignore 过滤 目录 a 中的 文件与子 目录
 rightlist  经 hide 和 ignore  过滤 目录 b 中的 文件 与子目 录
 common 同时存在 于目 录 a 和 b 中的 文 件 和子 目录
 leftonly 仅 在目 录 a 中 的文件 和子目录
 rightonly 仅 在 目录 b 中的 文件和 子目录
 commondirs  同 时 存在 于目录 a  和 b 中的 子目录
 commonfiles 同 时存 在于 目 录 a 和 b  中的文 件
 commonfunny 在 目 录 a 和 b  中类 型不同的 名字 或者那 些 os
stat  报告 错误的 名 字
 samefiles 在目 录 a 和 b 中 使用类 的文 件比较操 作符 相等 的文 件
 difffiles 在目 录 a 和 b  中根据类的文 件 比较 操作 符判 定内 容不 等的文 件
 funnyfiles 在目录 a  和 b  中无 法 比 较 的文 件
 subdirs  一个 将 commondirs  中名 称映 射为 dircmp  对象 的字 典
defaultignores 3
4 新版 功 能
默 认被 dircmp 忽 略的 目录 列表
下面 是一 个简 单的 例子 使用 subdirs  属性 递 归搜 索两 个目录以 显示 公共 差异 文件 from  filecmp  import  dircmp  def  printdifffilesdcmp 
 文 件格 式
本 章中 描述的 模块 解析 各种 不是标记 语言且与 电子邮件 无关 的杂项 文件 格式
 csv  csv 文件读写 模块内容 变种 与格 式参数 reader 对象 writer  对 象 示例 configparser  配 置文 件解 析器 快速 起 步 支持 的数据 类型 回退值受支持 的 ini 文件结构 值的 插值映 射协议访问 定制 解析 器行 为 旧式 api  示例 configparser 对象 rawconfigparser  对象 异常 netrc  netrc  文件 处 理 netrc 对 象 xdrlib 编 码 与 解 码 xdr 数 据 packer  对 象 unpacker 对 象异常 plistlib 生 成与解 析 apple 
plist  文件示例
fileinput  迭代 来 自多 个 输入 流的行
 文件 和目录访问
 本 章中描 述的 模 块处 理磁 盘 文 件和 目录
 例 如有 一些 模 块 用于 读 取文 件的属 性以 可移植 的方 式操 作路 径以 及创 建临 时 文件
 本章 的 完整 模块 列表 如 下 pathlib 面 向对 象 的文 件系统路径基 础使 用纯路径 通用 性质运算符 访问个别 部分方 法和 特 征 属性 具 体路 径 方法对应的 os  模块 的工 具 os
path  常用路 径操 作 fileinput  迭代 来 自多 个输入流的行 stat  解析 stat  结果 filecmp 文 件及 目 录 的 比较 dircmp  类 tempfile  生成 临 时 文件和 目录示例已弃 用 的函数 和 变 量 glob  unix 风 格路径 名模式扩展 fnmatch  unix  文 件 名模 式 匹 配 linecache  随机读 写 文本 行 shutil  高阶文件操 作 目录和 文 件 操作 依 赖 于具 体 平台的高效 拷 贝 操作 copytree 示例 rmtree  示例归档 操 作归档程 序 示例 使用 basedir  的 归档 程序 示例 查询 输出终 端 的尺 寸 参见模块 os 操 作 系 统 接口 包括 处理 比 python 文 件 对象 更 低级 别 文件的 功能
 模块 io  python 的内置 io  库 包括抽 象类和 一些 具体 的类如 文 件 io 
内 置函 数 open 使 用 python 打开文件进 行读写 的标 准 方 法
fnmatch  unix 文件 名模 式匹 配
源代码 libfnmatch
py 此模 块提供 了 unix  shell 风 格 的通 配符 它们 并 不等同 于正 则 表 达式关 于后者 的文 档参 见 re 模 块
 shell  风格通 配符 所 使用的 特殊字符如 下模 式意 义匹 配所 有匹 配 任何 单个字符 seq  匹配 seq  中的任何 字符 seq  匹 配任 何不 在 seq 中 的字 符 对于字 面值 匹配请 将原字符 用方括 号括 起来
 例 如 将匹 配字 符
注意文 件 名 分隔符 unix 上 为不 是 此模块所 特有 的
请 参 见 glob  模块 了解 文件名扩 展 glob  使 用 filter 来 匹 配文 件 名的各个 部 分
 类 似 地 以一个 句 点打头 的文 件名 也不 是 此 模 块 所 特有的 可 以 通 过和 模 式来匹配
fnmatchfilename  pattern  检 测 filename  字 符 串 是否 匹配 pattern  字 符串返回 true  或 false
 两个形 参 都会使用 os
normcase  进行 大 小 写正规化
 fnmatchcase  可 被用 于 执 行大小写 敏感的比 较无 论这 是 否为 所 在操 作 系统 的标 准
 这 个 例 子将打 印 当前目录 下 带有扩 展 名
txt  的所 有文件名 import  fnmatch  import  os  for  file  in  os
fnmatchcasefilename  pattern  检测 filename 是 否匹 配 pattern  返 回 true 或 false 此比 较 是大 小写 敏感 的 并且 不 会应用 os
filternames  pattern 返 回 names 列 表 中匹配 pattern 的 子集
它 等价 于 n  for  n  in  names  if  fnmatchn  pattern 但 其实现更 为高效
translatepattern  返回 shell 风 格 pattern 转 换成的 正则表 达式 以 便 用 于 re
示例 import  fnmatch  re  regex  fnmatch
txt 参 见模 块 glob  unix  shell 风 格路 径 扩展
formatter  通用格 式化 输 出
3
4 版 后已移除 因为 被使 用的 次 数 很少 此 格式化模 块 已 经 被 弃用 了
the  formatter  interface
formatter  implementations
the  writer  interface
writer  implementations
fractions  分数
 源 代 码 libfractions
pyfractions  模 块 支 持分数运 算
分 数实 例可以 由一 对整 数 一 个分 数 或者一个 字 符 串 构 建而 成
fractionstring  第一 个 版 本 要求 numerator  和 denominator  是 numbers
rational 的实 例 并 返回一个 新的 fraction  实例 其值 为 numeratordenominator
 如 果 denominator 为0 将会引 发 zerodivisionerror
第 二个 版 本 要 求 otherfraction  是 numbers
rational 的 实 例并 返 回一 个 fraction 实例 且与 传入 值 相 等
下 两个版 本接受 float  或 decimal
decimal 的 实例 并 返 回 一 个 fraction 实 例 且与 传 入值 完全 相 等
 请注 意 由于 二 进 制 浮点 数 通 常存 在 的问 题参 见 浮 点 算 术 争 议和 限 制 fraction 1
1的 参 数并 不 会 精 确 等 于1110 因 此 fraction 1
1也 不会返 回 用户所期 望的 fraction 1110
 请 参 阅 下 文 中 limitdenominator 方 法的文档
构造 器的 最 后 一个 版本 接 受一个 字 符 串或 unicode  实 例
 此实 例的通 常 形式为 sign  numerator  denominator 其 中 的可 选 项 sign  可 以 为 或并 且 numerator 和 denominator  如果 存在是 十进 制数 码 的 字符串
此 外 float  构造器所 接受的任 何表 示 一 个有限 值的 字 符串 也都 为 fraction 构造 器 所接 受
不 论 哪种形式的输 入字 符串 也 都 可 以带 有 前 缀和或 后 缀的 空 格 符
这 里是一 些示 例 from  fractions  import  fraction  fraction 1610 fraction 85 fraction 123 fraction 1231 fraction  fraction 01 fraction 37 fraction 37 fraction 37 fraction 37 fraction 1
1 fraction 1110 fraction  类 继 承自 抽 象 基类 numbers
rational  并 实 现了 该类 的所 有 方 法和 操 作
 fraction 实 例是可 哈 希 的并 应 当 被视 为不 可变对 象
 此 外 fraction  还具有 以 下属性和 方法 在3
2 版 更 改 fraction 构 造器 现 在接受 float 和 decimal
decimal  实例
 在3
9 版更改 现在会 使用 math
gcd  函数来正 规化 numerator  和 denominator
gcd 总 是 返 回 int 类型
 在 之 前版 本中 gcd  的类 型 取决于 numerator 和 denominator  的 类型
 numerator  最 简分 数形 式 的分 子
 denominator  最简 分数形式 的 分 母
 asintegerratio 返 回由两个 整数 组 成的 元 组 两数之 比 等 于 该 分 数的 值 且 其 分 母 为 正数
3
8新 版功能
 fromfloatflt 此类 方法 可 构 造一 个 fraction 来表示 flt  的 精 确 值 该 参数必须 是一 个 float
请注意 fraction
3 的值 并 不 等 于 fraction 310
注解 从 python 3
2开 始 在 构造 fraction  实 例 时 可 以 直接使 用 float
 fromdecimaldec  此 类方 法 可构造 一个 fraction  来 表 示 dec 的 精确 值该参数 必须 是一 个 decimal
decimal 实 例
注 解 从 python 3
2 开 始在构 造 fraction 实 例 时 可以直 接使用 decimal
decimal 实 例
 limitdenominatormaxdenominator 1000000 找 到并 返回 一 个 fraction 使 得其 值最接 近 self  并 且分 母 不大 于 maxdenominator
 此 方 法 适 用于 找出 给定浮点数 的有理 数近似 值 from  fractions  import  fraction  fraction 3
limitdenominator 1000 fraction 355113 或 是用 来 恢复 被表示为一个 浮 点 数 的有 理数 from  math  import  pi  cos  fractioncospi 3 fraction 45035996273704979007199254740992 fractioncospi 3
limitdenominator  fraction 1110 floor  返 回最 大的 int  self
此 方 法也可 通 过 math
floor  函 数 来 使用 from  math  import  floor  floorfraction 3551133 ceil 返回 最小 的 int  self
 此方 法也 可 通 过 math
ceil 函数 来 使 用
 round  roundndigits 第 一个版本 返回 一 个 int  使得 其值最 接近 self  位 值 为 二分 之一 时 只对偶 数 舍 入
第 二个 版本会 将 self 舍 入到最接 近 fraction 110 ndigits 的倍 数 如 果 ndigits  为负 值则 为逻辑 运算 位值 为二分之 一时 同 样只 对偶 数舍入
此方 法也可通过 round  函 数来 使 用
参见 numbers 模 块构成 数字塔的 所 有抽象 基 类
程 序框架
 本 章 中描 述的模 块 是很大 程度上决 定 程序 结 构 的框架
目 前 这里 描 述 的 模块 都面 向编 写命令行 接口
本章 描 述 的完 整 模块 列 表 如 下 turtle 海龟 绘 图概述 可用的 turtle 和 screen  方法概览 turtle  方法 turtlescreenscreen  方 法 rawturtleturtle  方 法 和对应函 数 海龟动 作获取 海龟的 状 态度量 单 位设置 画笔控 制绘图 状 态颜色 控 制填充 更多 绘图 控制 海龟 状态 可见性 外 观使 用 事 件特 殊海 龟方 法复 合 形状 turtlescreenscreen  方法 及 对 应 函 数 窗 口 控 制动 画控 制使 用屏 幕事 件输 入 方 法设 置 与 特 殊 方 法 screen  专 有 方法 而 非 继承 自 turtlescreen 公 共 类 帮 助 与配 置如 何使用 帮助 文档 字符 串翻 译为 不同 的 语 言如 何配 置 screen  和 turtle  turtledemo  演 示脚 本集 python 2
6 之后 的变 化 python 3
0之 后的 变化 cmd  支持 面 向 行的 命 令 解释 器 cmd  对 象 cmd 例 子 shlex  simple  lexical  analysis  shlex  objects  parsing  rules  improved  compatibility  with  shells
ftplib  ftp 协 议客 户 端
 源代 码 libftplib
quit 这 个模 块定义了 以下内容 class  ftplib
 drxrxrx 5 ftp  ftp 4096 may 61043 centos  drxrxrx 3 ftp  ftp 18 jul 102008 fedora  在3
2版 更改 支持 了 with 语 句
在3
3 版更 改 sourceaddress  parameter  was  added
在3
9 版更 改 if  the  timeout  parameter  is  set  to  be  zero  it  will  raise  a  valueerror  to  prevent  the  creation  of  a  nonblocking  socket
 the  encoding  parameter  was  added  and  the  default  was  changed  from  latin 1 to  utf 8 to  follow  rfc 2640
3
2新 版功 能
在3
3 版更 改 sourceaddress  parameter  was  added
 在3
4 版更 改 the  class  now  supports  hostname  check  with  ssl
3
6版 后 已 移 除 keyfile  and  certfile  are  deprecated  in  favor  of  context
 please  use  ssl
loadcertchain  instead  or  let  ssl
createdefaultcontext  select  the  systems  trusted  ca  certificates  for  you
在3
9 版更 改 if  the  timeout  parameter  is  set  to  be  zero  it  will  raise  a  valueerror  to  prevent  the  creation  of  a  nonblocking  socket
 the  encoding  parameter  was  added  and  the  default  was  changed  from  latin 1 to  utf 8 to  follow  rfc 2640
参 见 module  netrc  parser  for  the 
ftp  objects
在3
3 版更改 sourceaddress  parameter  was  added
 在3
2 版 更 改 rest  parameter  added
3
3新 版功 能
注 解 if  your  server  supports  the  command  mlsd  offers  a  better  api
注 解 if  your  server  supports  the  command  mlsd  offers  a  better  api
ftptls  objects
在3
4 版更 改 the  method  now  supports  hostname  check  with  ssl
3
3 新 版 功 能
函 数 式 编 程 模 块
 本 章 里描 述的 模块提 供了 函数 和 类以 支持 函 数式 编程 风 格和 在 可 调用 对象 上的 通用 操作
 本章对 下列 模块 进行说 明 itertools 为 高效循 环 而 创建 迭代 器的 函数 itertool  函数 itertools  配方 functools  高 阶 函数和 可 调 用对象 上的 操 作 partial 对 象 operator 标 准运 算符 替代 函数 将运 算 符 映射 到函 数原 地运 算符
 内置 函 数
functools  高 阶函 数和 可调 用对 象上 的操 作
partial 对 象
partial 对 象 是 由 partial  创建 的 可调 用 对 象
 它们 具 有三 个只 读 属性 partial
func  一 个 可 调用 对象 或 函数
对 partial 对 象的 调用 将被 转发 给 func  并 附带 新的 参数 和关 键字
args  最左 边的 位置 参数 将放 置在 提供 给 partial 对 象调 用的 位置 参 数 之前
keywords  当调 用 partial  对象 时 将要 提供 的关 键字 参 数
partial  对 象与 function  对象 的 类似之处 在于 它 们都 是 可 调用、可弱 引用的 对象 并可 拥有 属性
但 两者 也存 在一 些重要 的区 别
 例 如 前者不 会自 动创 建 name 和 doc  属 性
而 且 在 类 中 定义 的 partial 对 象的 行为 类似 于静 态方法 并且 不会在 实 例属 性查 找 期 间 转 换 为绑 定方 法
gc  垃 圾回 收 器 接 口
getopt  c  风 格 的 命令 行 选项 解析 器
getpass 便 携 式 密 码 输入 工具
 源 代码 libgetpass
pygetpass  模块 提供了 两个 函数 getpass
getpasspromptpassword  streamnone  提示用 户输 入一 个密 码且不 会 回 显
用 户会看 到字 符串 prompt  作为 提示 其默 认值 为 password 
 在 unix 上 如 有 必 要 提示 会使 用替 换错 误句 柄写 入到文 件类 对象 stream
 stream 默 认指 向 控制 终端 devtty  如 果 不 可 用 则指 向 sys
stderr 此 参 数 在 windows 上 会 被忽 略
如 果 回 显自 由输 入不 可用 则 getpass 将 回退 为打 印 一 条警 告 消 息 到 stream  并且 从 sys
stdin  读 取同 时 发 出 getpasswarning
 注 解如 果你 从 idle  内部 调用 getpass  输 入 可 能 是 在 你 启动 idle  的终 端中 而 非 在 idel  窗 口 本身中 完 成
getpasswarning 一个 当 密 码输 入 可 能 被 回 显时 发 出的 userwarning 子 类
getuser  返回用户 的登录 名称
 此函数会 按顺 序 检查 环境 变 量 logname  user  lname 和 username 并 返回其中第 一 个被 设 置 为非空 字 符串的值
如 果均 未 设置 则在 支 持 pwd 模 块 的系 统上将返 回来自 密 码数 据库 的登 录名 否则将引 发一 个异 常
通 常情况下 此函 数应 优 先于 os
getlogin  使用
gettext 多 语 种国 际 化 服 务
源 代 码 libgettext
pygettext 模 块 为 python 模 块和 应 用程 序 提供 国际化 internationalization  i 18 n 和 本 地 化 localization  l 10 n 服 务
 它同 时支持 gnu  gettext  消息 编目 api  和更 高 级 的、 基于 类的 api  后者 可能 更 适合 于 python 文 件
下 方 描述 的接口 允许 用户 使用 一种 自 然语 言编 写模 块和 应 用 程序 消息 并提 供 翻 译后 的消 息编 目以 便 在不 同的自然 语言 下 运 行
 同 时还 给出 一些 本 地化 python  模块 及应用程 序的 小 技巧
gnu  gettext  api
 基于 类的 api
与 gnu  gettext  api  相比 gettext 模块 的基于 类 的 api  提供 了 更多 的灵 活性和更 强 的便 利 性
这 是本 地化 python 应 用程 序 和模 块的推荐 方 法
gettext  定义 了一 个 gnutranslations  类该 类 实现 了 gnu 
mo 格 式 文 件 的 解 析 并 且 具有 用于返回 字 符 串的 方 法
本 类 的实 例也 可 以 将自 身 作为函 数 安装到 内 建 命 名 空 间中
finddomain  localedirnone  languagesnone  allfalse  本 函数实现 了标 准的
mo  文 件搜 索算法
它 接受 一 个 domain  它 与 textdomain  接受 的域 相同
 可 选参 数 localedir 与 bindtextdomain  中的相同
 可选 参 数 languages 是 多条 字符串 的列表其 中每条 字 符 串都 是 一种 语言 代码
在3
3版 更 改 ioerror 代 替 oserror  被引 发
the  nulltranslations  class
3
8新 版功能
3
8 新版 功 能
警 告 these  methods  should  be  avoided  in  python 3
在3
8版更 改 added  pgettext  and  npgettext
the  gnutranslations  class
 例 如 n  lenos
3
8新 版功 能
3
8 新版 功 能
警 告 these  methods  should  be  avoided  in  python 3
solaris  message  catalog  support
the  catalog  constructor
internationalizing  your  programs  and  modules
localizing  your  module
localizing  your  application
changing  languages  on  the  fly
deferred  translations
致 谢
 以 下 人 员 为 创 建 此模 块贡献了 代 码、反 馈、 设计 建 议、早 期实 现 和 宝贵 的 经验 peter  funk  james  henstridge  juan  david  ib áñ ez  palomar  marcandr é lemburg  martin  von  l ö wis  fran ç ois  pinard  barry  warsaw  gustavo  niemeyer 脚 注1 the  default  locale  directory  is  system  dependent  for  example  on  redhat  linux  it  is  usrsharelocale  but  on  solaris  it  is  usrliblocale
glob  unix  风格路 径名 模 式 扩 展
graphlib  functionality  to  operate  with  graphlike  structures
3
9新 版 功能
exceptions
grp 组数 据库
 该模 块 提供 对 unix 组数据 库 的访问
它 在所 有 unix 版 本上 都可 用
组 数 据 库 条目被 报告 为 类 似 元组 的对 象其属性 对应 于 group 结 构的成 员下面的 属 性字段请 参见 pwd
h  索 引属 性 意 义0 grname 组 名1 grpasswd 加 密的 组 密码 通常 为空2 grgid  数字组 id 3 grmem 组 内 所有成员 的 用户 名 gid  是 整数名 称 和密 码是 字符 串成 员 列表是 字 符 串列 表
注 意 大多数 用 户未根 据 密 码 数据 库 显式 列 为所 属 组的 成 员
请 检查 两个 数据 库以 获取 完整 的 成员资 格 信息
 还 要注 意 以或 开头 的 grname 可 能是 ypnis  引 用可能 无法 通过 getgrnam  或 getgrgid  访问
 本 模 块 定义如 下内容 grp
getgrgidgid  返回 给 定 数 字 组 id 的 组数 据库 条目
如 果找不到要 求的 条目 则 会 引 发 keyerror 错 误
3
6版 后 已 移 除 从 python 3
6 开始 弃用对 getgrgid  中 的 float  或 string  等非 integer 参 数的 支持
getgrnamname  返 回 给 定组名 的 组数据 库 条 目
如 果找 不到 要求 的 条目 则会引 发 keyerror 错误
getgrall  以任 意顺 序 返 回 所 有可用 组条 目的 列表
参见 模 块 pwd 用 户数据 库的 接口与 此类 似
 模块 spwd  针对 影子密 码数 据 库的 接 口与本 模 块 类 似
gzip 对 gzip  格式 的支 持
用 法 示 例
 读 取 压缩 文件示 例 import  gzip  with  gzip
read  创建 gzip  文 件示 例 import  gzip  content  blots  of  content  here  with  gzip
writecontent  使 用 gzip 压 缩已 有 的文件 示 例 import  gzip  import  shutil  with  openhomejoefile
copyfileobjfin  fout 使 用 gzip 压 缩二 进制 字符串 示 例 import  gzip  sin  blots  of  content  here  sout  gzip
compresssin  参见 模 块 zlib  支持 gzip  格 式所 需 要的 基 本压 缩 模 块
 命 令行 界 面
gzip 模 块提 供了 简单 的命 令行 界面 用于 压缩 和解压 缩 文 件
 在执 行后 gzip  模块 会 保留输 入文件
在3
8 版 更 改添 加一 个带有 用 法 说 明的 新命 令行 界 面命令
 默认情况下 当 你 要 执 行 cli  时 默 认压缩 等 级 为6
命 令行 选项
file  如 果 file 未指 定则从 sys
stdin 读取
fast  指明最 快 速 的 压缩方法较 低压 缩 率
best  指 明最 慢速 的压 缩方 法最 高压 缩率
d  decompress  解压缩 给 定 的文件
h  help 显 示帮助 消息
hashlib  安全 哈希 与消 息摘 要
哈 希算 法
shake  可 变 长度摘 要
shake 128和 shake 256算 法 提供安 全的 lengthinbits 2 至128或256 位可 变长度 摘 要
 为此它 们的 摘 要 需指定 一个 长 度
 shake 算 法不限 制 最 大 长 度
digestlength 返 回当 前已 传 给 update  方法的 数据 摘 要
这 是一 个大 小 为 length  的 字节 串对 象 字 节 串中 可包 含0 to 255 的 完整 取 值 范围
hexdigestlength 类 似于 digest  但 摘 要会以 两 倍 长度 字 符串 对象 的形式 返 回其 中仅 包含 十六进 制数码
 这可 以被 用于 在电子 邮件 或 其他 非二 进 制环 境中 安 全 地交换数 据 值
密钥派 生
blake
 创建 哈希对象
 常数
saltsize  盐 值 长度 构造 器所 接 受 的最 大长度
personsize  个 性化 字符串 长度 构 造器 所接受 的最 大 长度
maxkeysize  最 大 密钥 长 度
maxdigestsize 哈 希 函 数可输 出的 最大摘要 长 度
 示 例
开 发 人员
heapq  堆队 列 算法
 源码 libheapq
py  这个 模块 提供 了 堆队 列 算 法 的实 现也 称 为优先队 列算 法
 堆是 一 个 二叉树它 的每个 父节 点的 值 都 只会 小于 或 大于所 有孩子 节点 的 值
 它 使用了数 组来 实 现 从 零开 始计 数对 于 所 有的 k  都 有 heapk  heap 2 k 1和 heapk  heap 2 k 2
 为了 便于 比较 不 存 在 的 元素 被 认 为是无限 大
堆 最有 趣的特 性在 于最小 的元 素总 是在 根 结 点 heap 0
这个 api  与教 材的 堆 算法 实现 有所不同 具 体 区别 有 两 方 面 a 我 们使 用 了从 零开 始的索引
 这 使 得节 点和 其 孩子 节点 索 引 之 间的关系 不 太直观但 更加 适 合 因为 python 使 用从 零开 始的 索 引
 b 我 们的 pop  方法 返回 最 小的 项而 不 是最 大 的项 这在 教材 中称 为最 小堆 而最 大堆 在教材 中更为 常见 因为 它更适 用于 原地 排序
 基于这两方 面把 堆 看作原 生的 python  list  也 没什 么 奇怪 的 heap 0表 示最 小的 元素 同 时 heap
sort 维 护了 堆的 不变 性要 创 建一个 堆可 以使用 list  来初始 化为或 者你 可以通 过一个 函数 heapify  来把 一个 list  转换 成堆
 定义 了以 下函 数 heapq
heappushheap  item 将 item 的 值加 入 heap 中 保持 堆的 不变 性
heappopheap  弹出并 返回 heap  的 最小 的 元素 保持 堆的 不变 性
如 果 堆为 空 抛出 indexerror  
 使用 heap 0 可以只 访 问最 小的元 素 而 不弹 出它
heappushpopheap  item 将 item   放 入堆 中然 后 弹出并 返 回 heap  的 最小 元素
 该组合 操作 比先 调用  heappush  再调用 heappop  运行 起来 更有 效率
heapifyx  将 list  x 转 换成 堆 原地 线性 时间内
heapreplaceheap  item  弹出并 返回 heap 中 最小 的 一项同时 推入 新的 item
堆 的 大 小 不变
 如果 堆为 空则 引 发 indexerror
 这个 单步 骤 操作比 heappop  加 heappush  更 高 效并且在 使 用固 定大 小 的 堆 时更 为适 宜
 poppush  组合总 是会 从堆 中返 回一 个元 素并将其替 换 为 item
返 回的 值 可能 会 比 添加的 item  更大
 如果 不 希 望 如此 可 考虑 改用 heappushpop
 它 的 pushpop  组 合会 返回 两个 值 中 较 小 的一 个 将 较 大 的 值 留 在 堆 中
 该 模 块还 提供 了 三 个 基于 堆的 通用 功能 函 数
mergeiterables  keynone  reversefalse 将多 个 已 排序 的输 入 合并 为 一个 已排序 的输 出例 如合 并 来 自多 个 日志 文 件的 带 时 间 戳 的 条 目
 返回 已排 序值 的 iterator
类 似 于 sorteditertools
chainiterables  但返 回一 个 可迭 代对 象 不会 一次 性地将 数据 全 部放 入内 存并假定 每 个输 入流都 是 已 排序 的从 小 到大
 具 有 两 个可 选参 数 它 们 都 必须 指定 为关 键字参 数
 key  指 定 带有 单 个参数 的 key  function  用 于从 每 个 输入元 素中 提取 比较 键
 默认值 为 none 直 接 比较 元 素
 reverse 为一 个 布尔 值
如 果设为 true  则输 入元素 将按 比较 结 果逆 序进 行合 并
要 达 成与 sorteditertools
chainiterables  reversetrue  类似 的 行为所 有可 迭 代 对象 必 须 是已 从大 到小 排 序的
 在3
5版 更改 添 加 了可 选的 key  和 reverse 形 参
nlargestn  iterable  keynone 从 iterable  所定 义 的数 据集 中返 回前 n  个 最大 元 素 组成 的列 表
如果 提供 了 key 则 其应 指定 一 个单 参数的 函 数 用于 从 iterable 的 每个 元素 中提取比 较 键 例 如 keystr
 等价于 sortediterable  keykey  reversetruen
nsmallestn  iterable  keynone  从 iterable  所定 义的 数 据 集中返 回 前 n 个 最小 元 素组成 的 列 表
 如果提 供 了 key  则其 应 指 定 一个单参数 的函 数 用 于从 iterable 的 每 个元 素 中提取 比较 键例 如 keystr
等 价 于 sortediterable  keykeyn
后 两 个函数 在 n 值 较小 时性 能 最好
对 于更大的 值 使用 sorted 函 数会更有 效率
 此外 当 n 1 时 使用 内置的 min  和 max 函数 会更 有 效率
 如 果 需 要 重复使 用 这些 函数请 考虑 将 可 迭 代对象 转为 真 正 的 堆
基 本示例
 优先队 列实 现 说明
 优 先 队 列 是堆的 常 用场 合并且 它的 实 现 包 含了多 个挑 战 排 序 稳 定性你 该如 何令 相同 优先 级的 两 个任 务 按 它 们最初 被加 入 时 的 顺序 返回？ 如 果 优 先 级 相 同 且任务 没有 默认 比较 顺序 则 priority  task  对 的 元组 比 较 将 会中断
 如果 任 务 优 先级 发生 改 变 你 该 如何 将其移至堆 中的 新 位置？ 或者 如果 一 个挂 起 的任 务需 要被 删除 你该 如 何找 到 它并 将其 移 出队 列？ 针对 前两项挑 战的 一 种 解 决 方 案是 将 条目保存为 包含优 先级、 条 目计 数和任务 对象3 个元 素的 列表
 条目 计 数 可用 来打 破平局 这 样具 有相 同优先级 的 任务 将按 它们 的添 加 顺序 返 回
并 且由 于 没 有 哪 两 个 条 目 计 数是相同 的元组 比 较将永远不 会直 接 比 较两 个 任务
不可比 较任务 问 题的另 一种 解决 方案 是 创建一个忽 略 任 务条目 并 且只 比 较 优先 级 字段 的包 装器 类 from  dataclasses  import  dataclass  field  from  typing  import  any  dataclassordertrue  class  prioritizeditem  priority  int  item  anyfieldcomparefalse 其 余 的挑战主要 包括 找 到挂起 的任 务并 修改 其 优先 级或 将 其 完 全 移 除
 找 到一 个任 务可 使用 一个指向 队 列 中条 目的 字典来实 现
移 除条 目 或改 变 其优 先级 的操作实 现起 来更 为困难 因为 它会 破坏 堆 结构不 变量
因 此一 种可 能的 解 决方案 是将 条目 标 记为 已 移 除 再添 加一 个改 变了 优先 级的 新条目 pq  list  of  entries  arranged  in  a  heap  entryfinder  mapping  of  tasks  to  entries  removed  removedtask  placeholder  for  a  removed  task  counter  itertools
 理论
 堆是 通过 数组来 实现 的其 中的元 素从0 开始 计数 对于 所有 的 k 都 有 ak  a 2 k 1且 ak  a 2 k 2
 为了 便于 比较 不 存在 的元 素被视为 无 穷大
 堆最 有趣 的特 性 在 于 a 0 总 是其 中最 小的 元素
 上面的 特殊 不变 量是 用来 作为 一场 锦 标 赛的 高 效内 存表 示
 下 面的数 字 是 k 而 不是 ak 0123456789101112131415161718192021222324252627282930在 上面 的树 中 每 个 k 单元 都位 于2 k 1和2 k 2 之上
 体育 运动 中我们 经常 见到 二元 锦 标 赛 模 式每 个胜 者 单元 都 位 于另 两 个 单 元之 上 并且 我 们可 以 沿 着树 形 图 向下 追 溯 胜者 所 遇 到的 所 有 对 手
 但 是在 许多 采 用 这 种 锦 标 赛 模 式 的 计 算机 应 用程 序中 我们 并 不 需要 追 溯 胜 者 的 历 史
 为 了 获 得更 高 的 内 存 利 用 效 率 当 一个 胜 者晋 级时 我 们 会用 较低 层 级 的 另 一 条 目来 替 代 它因 此 规 则 变 为 一个 单 元 和 它 之 下 的两 个 单 元包 含三 个 不 同 条 目 上方 单 元 胜 过 了 两 个 下 方单 元
如 果此 堆的 不变 量始终 受到 保护 则序 号0显 然是 最 后 的 赢家
 删 除 它 并 找出 下 一 个 赢 家 的最简 单算 法方 式 是 家 某 个 输 家让 我们 假定 是上 图中 的30号 单 元 移 至0 号 位 置 然 后 将 这个新 的0 号 沿树 下 行 不 断 进 行 值 的 交换 直到不 变 量重 新建 立
这 显然 会是 树中 条 目总 数 的对 数
 通 过 迭代 所 有 条目 你 将 得到一 个 on  log  n 复 杂度的 排 序
此排 序 有 一个很好 的 特性 就是 你 可以在 排 序 进行 期 间 高 效 地插 入新 条目 前 提 是插 入 的 条 目 不比 你 最 近取 出的0 号元 素更 好
 这在 模拟 上 下文 时特别 有用 在这 种 情况下树保存 的是所 有传 入事 件 胜 出 条 件是 最 小调度 时间
当 一个事 件 将其 他事 件 排入 执行 计划时 它们的 调 试时 间向未 来方向延 长这 样它 们 可 方 便 地 入堆
 因此 堆结 构很适 宜用 来 实 现调度 器我的 midi  音序 器 就 是 用 的 这个
用 于实现 调度 器的 各 种 结 构 都 得 到了 充 分的 研究堆 是非 常适 宜的 一种因 为它们的 速度相 当快 并且 几 乎 是 恒定 的 最 坏 的 情况与 平 均情 况没 有太大 差别
虽然 还 存在 其他 总体而 言更 高效 的 实现 方式 但其最 坏 的情 况却 可 能 非常 糟糕
 堆 在大磁 盘 排序中 也 非 常有 用
 你应该 已 经了 解大 规模排序 会 有多 个 运行轮 次即预 排序 的序 列 其 大小 通常 与 cpu  内存 容量 相关 随 后 这 些 轮次 会进 入合并 通 道轮次 合并 的组 织往 往非常 巧妙1
非常 重要 的 一 点 是初始排 序 应产生 尽 可能长 的运行轮 次
锦标 赛模 式是达 成此目 标 的 好办法
如 果你 使用全 部 有用内 存 来进行 锦标 赛 替换和 安排 恰好 适 合当前运 行轮 次的条目 你将 可 以对 于随 机输入 生成两倍 于内 存大小 的运行轮 次对 于模糊排 序的 输入 还 会 有更 好 的效 果
另 外如果你 输 出磁 盘上的 第0个 条目 并获得 一个可能 不适 合当前锦 标 赛的 输入 因 为 其 值要 胜过上 一个输出 值它 无法 被放 入堆 中因 此堆 的尺 寸将 缩小
 被释 放的 内存 可以 被巧 妙地 立即 重用 以逐 步 构建第 二个 堆其 增长 速度 与第 一个 堆的 缩 减速 度正 好相 同
当第一个 堆完全消失 时你 可以 切 换新堆 并启 动新 的 运行 轮次
 这样 做既 聪明 又高效 总 之堆是值得了解 的有 用内 存结构
 我在 一 些应 用中 用到 了它 们 并且 认 为 保 留 一个 heap  模 块 是很有 意义 的
脚 注1当 前时 代的磁 盘平衡 算法 与其 说 是巧妙 不如 说是 麻烦 这是 由 磁 盘 的 寻址能力 导 致 的结 果
在无 法 寻址 的设 备 例 如 大 型 磁带 机 上情况 则相 当 不同 开 发 者 必 须非 常 聪明 地 极为 提前 地确 保每次 磁带 转 动都尽 可 能 地高 效 就 是说 能够 最好 地 加 入 到合 并 进 程中
有 些磁 带甚 至能 够反 向读取 这也被 用来 避 免倒 带的 耗 时
请 相信我 真正 优秀的 磁带 机排 序看 起来 是 极 其 壮观 的排 序从来 都 是一 门伟 大的 艺 术
hmac 基于 密钥的消 息 验 证
htmlentities  html 一 般实 体的 定 义
htmlparser 简 单 的 html  和 xhtml 解 析器
 源 代码 libhtmlparser
py 这 个 模 块定 义了 一个 htmlparser 类为 html  超 文本 标记语 言 和 xhtml  文本 文 件解 析提 供基础
htmlparser  convertcharrefstrue 创 建一个 能 解析 无效 标 记的 解析器实例
 如果 convertcharrefs 为 true  默 认值 则 所有字符 引用 scriptstyle  元素 中 的除 外 都会自动 转 换为 相应的 unicode 字 符
一个 htmlparser 类 的实例 用 来接受 html  数据并在 标记开始、 标 记 结束、文 本、注释 和其他 元 素标 记出 现的 时候调用 对应 的方法
 要 实现 具体 的 行为 请使 用 htmlparser 的 子类 并重载 其 方 法
这 个解 析 器不检查 结束标 记是否与 开始 标记匹 配也 不会 因外层 元 素 完 毕 而 隐 式关 闭了 的 元素 引 发 结束标记 处理
在3
4 版更改 convertcharrefs 关 键字 参数被添 加
在3
5 版更 改 convertcharrefs  参数的 默认 值 现在 为 true
html 解 析器的 示 例程序
htmlparser 方 法
示例
html  超文 本标 记语言支 持
httpclient  http 协 议客户 端
httpconnection 对 象
httpresponse 对 象
在3
5版 更 改 the  io
bufferediobase  interface  is  now  implementedand  all  of  its  reader  operations  are  supported
3
3新版 功能
status  由服务 器返 回的 状 态 码
geturl 3
9 版 后已移 除 deprecated  in  favor  of  url
info 3
9版 后 已 移 除 deprecated  in  favor  of  headers
getstatus 3
9版 后已移 除 deprecated  in  favor  of  status
示 例
httpmessage  objects
httpcookiejar —— http  客户 端 的 cookie 处理
cookiejar  和 filecookiejar  对象
 在3
3版 更改 request  object  needs  originreqhost  attribute
 dependency  on  a  deprecated  method  getoriginreqhost  has  been  removed
在3
3版 更 改 request  object  needs  originreqhost  attribute
 dependency  on  a  deprecated  method  getoriginreqhost  has  been  removed
在3
3 版更 改 过去触 发 的 ioerror  现在 是 oserror 的别名
filecookiejar  subclasses  and  cooperation  with  web  browsers
注 解 this  loses  information  about  rfc 2965 cookies  and  also  about  newer  or  nonstandard  cookieattributes  such  as  port
警 告 back  up  your  cookies  before  saving  if  you  have  cookies  whose  loss  corruption  would  be  inconvenient  there  are  some  subtleties  which  may  lead  to  slight  changes  in  the  file  over  a  load  save  roundtrip
在3
8 版更改 文件名形 参支持 pathlike  object
cookiepolicy  对 象
defaultcookiepolicy 对 象
cookie 对 象
示例
httpcookies  http  状态 管 理
 源代 码 libhttpcookies
在3
3版 更改 allowed  as  a  valid  cookie  name  character
 注解 on  encountering  an  invalid  cookie  cookieerror  is  raised  so  if  your  cookie  data  comes  from  a  browser  you  should  always  prepare  for  invalid  data  and  catch  cookieerror  on  parsing
 参见 module  http
cookie 对象
morsel  对象
 在3
5 版更 改 eq  now  takes  key  and  value  into  account
在3
7版更 改 attributes  key  value  and  codedvalue  are  readonly
在3
8 版更 改 added  support  for  the  samesite  attribute
value  cookie 的值
 在3
5版 更改 an  error  is  raised  for  invalid  keys
 在3
5版 更改 return  a  morsel  object  instead  of  a  dict
示 例
httpserver  http 服 务 器
http  http  模块
 源 代 码 libhttpinit
pyhttp 是 一 个包它收 集了 多 个用 于 处理 超文 本传 输协议 的模块 http
client  是一 个低层 级的 http  协 议客 户端 对于 高 层级 的 url  访问 请 使 用 urllib
server  包 含基 于 socketserver 的 基本 http  服务类 http
cookies  包 含 一些 有 用来 实现 通过 cookies  进行 状态 管理 的 工具 http
cookiejar  提供 了 cookies 的 持久 化 http 也是 一个 通过 http
httpstatus 枚举 定 义 了一 些 http 状 态 码 以 及相 关联 消息 的 模块 class  http
httpstatus 3
5 新版功 能
 enum
intenum  的子 类它定 义 了组 http 状 态 码原 理短语以及 用 英 语书 写的 长 描 述文本
 用法 from  http  import  httpstatus  httpstatus
http  状态 码
国 际化
 本章 中介 绍 的 模块 通过提 供选 择要在 程序信息中 使 用 的 语言 的 机制或通过定 制输 出 以 匹配 本 地约 定来 帮助 你编 写不 依 赖于语 言和 区域 设置的 软件
 本章 中 描 述的模 块 列表 是 gettext 多 语种 国际 化服务 gnu  gettext  api 基 于类 的 api  the  nulltranslations  class  the  gnutranslations  class  solaris  message  catalog  support  the  catalog  constructor  internationalizing  your  programs  and  modules  localizing  your  module  localizing  your  application  changing  languages  on  the  fly  deferred  translations  致谢 locale 国际 化服务 background  details  hints  tips  and  caveats  for  extension  writers  and  programs  that  embed  python  access  to  message  catalogs
idle
 目 录
idel  具有 两 个 主 要窗 口 类型 分别 是 命令 行 窗口 和编 辑器 窗口
用 户可 以同 时打 开 多个编 辑器窗口
 对于 windows  和 linux 平 台 都有各自 的 主 菜 单
如下 记 录的每 个菜单 标识着与 之 关 联的 窗 口类 型
导 出 窗口例 如使 用 编 辑在 文件中查 找 是编辑 器 窗口的 的一 个 子类 型
 它们目前 有着相同 的 主 菜单但 是默认 标题 和上 下文 菜 单 不同
在 macos  上只 有一 个 应用程 序 菜单
 它 根据 当前 选 择的 窗 口 动态变化
 它 具有一 个 idle  菜单并 且下面 描述 的某 些条 目已 移动 到 符 合 apple 准则的 位 置
文 件 菜单 命 令 行和 编辑 器
 编辑菜单 命 令行和 编辑器
撤 销操作 撤 销当 前窗口 的 最 近一次操 作
 最 高可以 撤 回1000条操 作记录
 重做重 做当前 窗口最近 一次 所 撤销的 操 作
 剪切复 制 选 区至 系统 剪 贴板 然 后删 除 选 区
复制 复 制选 区 至系 统 剪贴 板
粘贴插 入系统 剪贴板 的 内容 至 当 前 窗口
剪贴板 功 能也可用 于 上下 文目录
全 选选 择当 前 窗口的 全部 内容
 查 找
 打 开一 个提供 多选 项的 查找 窗 口
再次查 找 重 复上 次搜索如 果结果存 在
查找 选 区 查找当前 选中 的字 符 串 如果 存在 在文件中 查找
 打开文件 查找对 话 框
将 结果输出 至新 的输 出窗 口
替 换
打 开查找并 替换对 话框
 前往 行 move  the  cursor  to  the  beginning  of  the  line  requested  and  make  that  line  visible
提示 完成 open  a  scrollable  list  allowing  selection  of  existing  names
展 开文 本 展开键入 的前 缀以 匹配 同 一窗 口 中的 完整 单 词 重 复 以 获得不同 的扩 展
 显 示 调用 贴士 在 函 数 的右括 号后打开 一 个带有函 数 参数 提示的小 窗口
请 参阅下 面的编辑 和导 航部分中 的 calltips 
显示 周 围括 号突出显 示 周围 的括号
 格式 菜单 仅 window  编辑 器
增 加缩 进将 选定 的行右 移缩进 宽度 默认 为4个空 格
减少 缩 进 将选定的 行 向左 移动 缩 进宽 度 默认 为4个 空 格
 注 释 在 所选行的 前 面 插 入
 取消 注 释 从 所 选 行 中删除开 头 的＃或
制表 符 化将 前导空格 变成制 表符
注 意我们建 议使 用4个 空 格来 缩进 python  代码
取 消制表 符 化 将所 有制 表 符转换 为 正 确 的空格 数
 缩 进 方 式 切换 打 开 一个对 话框 以在 制表 符和 空 格之 间 切换
缩 进 宽 度调整 打 开一 个 对 话框 以 更改缩 进 宽度
 python  社 区接 受 的 默认值为4 个空 格
格式 段 落 在 注释 块或 多行字符 串或 字符 串中 的选 定行 中重 新格 式化 当 前以空 行分 隔的段落
段 落中 的所 有行 的 格式都将 少于 n  列其中 n  默 认为72
删除尾随 空格通 过将 str
rstrip 应用 于 每 行包 括多行字 符串 中的 行 删除 行尾非空 白字符 之后 的尾 随空 格 和其 他空白 字 符
除 shell  窗 口 外 在 文件末 尾 删除 多 余 的换 行符
 运行 菜单 仅 window 编辑器
运 行模 块执 行 检查 模块
 如 果没 有错 误重 新启 动 shell 以清 理环境然 后执 行模 块
输 出显 示在 shell 窗 口 中
 请注 意 输出需要 使用打 印 或写入
执 行 完成 后 shell 将保 留 焦 点 并 显 示提 示
此 时 可 以交 互地探索执 行的 结果
 这类似 于在 命令行执 行带 有 python  i  file  的文 件
 运 行
定制与 运 行模 块相 同 但使用自 定义 设 置运行 该模 块
 命令 行 参数 扩展 sys
argv  就像 在命令行 上传递 一样
 该模块可 以 在 命 令行 管 理程 序中运行 而无 需重新 启 动
 检 查模 块 检查编辑 器窗 口 中当 前打开 的 模 块 的 语 法
如 果尚 未 保 存该 模块 则 idle 会提示用 户保 存或自 动保存 如在 空 闲设置 对 话 框 的 常 规 选 项 卡中所选 择 的 那 样
如 果存 在语 法错 误则 会 在 编 辑器 窗口 中 指示 大概 位置
python  shell  打 开 或 唤醒 python  shell 窗 口
shell 菜 单仅 window 编辑 器
 查看最 近 重启 将 shell 窗口 滚动 到 上一次 shell  重 启
重启 shell  重 新 启 动 shell  以 清理 环境
 上 一 条 历史 记录 循环 浏览历史 记 录中 与当 前 条 目匹配的 早期命令
 下 一条 历史 记录循 环浏 览历史 记 录中 与当前条 目匹 配的 后 续命 令
中 断执 行停 止 正在运行 的 程序
调 试 菜 单 仅 window 编 辑 器
 跳转到文件 行 look  on  the  current  line
调试 器 切换 激活 后在 shell  中 输 入 的代 码或 从 编辑器中 运行 的代码 将在 调试器下 运行
在编 辑 器 中 可以 使 用 上 下文 菜单 设 置 断 点
 此 功能 不 完 整具有 实验 性
 堆栈查 看器在树 状目 录 中显 示最 后 一个异常 的 堆栈 回溯 可以 访问本 地和 全局
 自动 打开堆栈 查看器在未 处 理的异常 上切 换 自动打开 堆 栈查 看器
 选项 菜 单 命 令 行和编 辑 器
 配置 idle 打 开配 置 对话 框并 更改 以下 各项 的首 选项字体、缩 进、键 绑定、文 本颜色主 题、 启 动 窗 口和 大小、 其他帮助 源 和扩 展名
 在 macos 上通 过在应用 程序菜单 中选 择 首选项 来打开 配置 对话 框
 有 关 详 细信息请 参 阅帮助 和 首 选项 下的 首 选项 设置
 大 多 数配置选 项适 用 于 所 有窗 口 或 将 来的 所有窗口
 以下选 项 仅 适用 于活 动窗 口
 显示 隐 藏代 码 上下 文仅 window  编辑 器 open  a  pane  at  the  top  of  the  edit  window  which  shows  the  block  context  of  the  code  which  has  scrolled  above  the  top  of  the  window
 显示 隐 藏行 号仅 window  编 辑器 open  a  column  to  the  left  of  the  edit  window  which  shows  the  number  of  each  line  of  text
 缩放 还原 高 度 toggles  the  window  between  normal  size  and  maximum  height
window  菜 单命 令行 和 编 辑 器
 列 出 所 有 打开 的 窗口的 名称 选择一 个 将其带 到 前 台必 要 时对 其 进行 去符 号化
 帮 助 菜 单 命 令 行和 编辑 器
关 于 idle 显 示版 本版权 许可证荣 誉等
idle  帮助 显示 此 idle  文档 详 细 介绍 菜单选 项基 本编辑和导航以及 其 他技巧
python 文档访问本 地 python 文 档如 果 已安 装 或 启动 web 浏 览器 并 打 开 docs
org  显 示 最新的 python  文档
 海龟 演示 使用示 例 python 代码和 turtle 绘 图运行 turtledemo  模块
 可以 在常 规选项卡 下的配置 idle 对 话 框中添 加其 他帮助 源
有 关帮 助 菜单 选项的 更 多 信息 请 参见 下面的帮 助 源小节
上 下文菜单
 编 辑 和 导 航
编 辑窗口
按 键绑 定
 在 本节中 c  是指 windows  和 unix 上的 control  键以 及 macos 上 的 command 键
 backspace  向左 删 除 del 向 右删 除 cbackspace 向 左 删除 单 词 cdel  向 右 删 除单词 方向键 和 page  uppage  down 移 动 cleftarrow 和 crightarrow 按 单词移 动 homeend 跳转 到 行首 尾 chomecend 跳转 到 文档 首 尾一 些有用 的 emacs  绑定 是从 tcl  tk 继 承的 ca  行 首 ce 行 尾 ck  删 除行但 未将 其放 入 剪 贴板 cl  center  window  around  the  insertion  point  cb  go  backward  one  character  without  deleting  usually  you  can  also  use  the  cursor  key  for  this  cf  go  forward  one  character  without  deleting  usually  you  can  also  use  the  cursor  key  for  this  cp  go  up  one  line  usually  you  can  also  use  the  cursor  key  for  this  cd 删除 下 一个字 符 standard  keybindings  like  cc  to  copy  and  cv  to  paste  may  work
自 动缩进
完 成
 提示
代 码 上 下 文
python  shell  窗 口
 cc 中 断 执 行命令 cd  sends  endoffile  closes  window  if  typed  at  a  prompt  alt  expand  word  is  also  useful  to  reduce  typing  历史 命 令 altp  retrieves  previous  command  matching  what  you  have  typed
文 本颜 色
启 动 和代 码 执 行
命 令行 语法
 c  command  run  command  in  the  shell  window  d  enable  debugger  and  open  shell  window  e  open  editor  window  h  print  help  message  with  legal  combinations  and  exit  i  open  shell  window  r  file  run  file  in  shell  window  s  run  idlestartup  or  pythonstartup  first  in  shell  window  t  title  set  title  of  shell  window  run  stdin  in  shell  must  be  last  option  before  args  如 果有参 数 if  c  or  r  is  used  all  arguments  are  placed  in  sys
启 动失 败
运行 用户 代 码
shell 中 的用户 输出
 开 发 tkinter 应用 程 序
在没有 子进 程的 情况下 运行
3
4 版后已 移除
帮 助和偏 好
帮 助 源
 首选项设 置
macos 上的 idle
扩 展
imaplib  imap 4 protocol  client
87在3
5版更 改支持了 with  语句
在3
9版 更改 the  optional  timeout  parameter  was  added
 在3
3版 更改 sslcontext  parameter  was  added
在3
4版更改 the  class  now  supports  hostname  check  with  ssl
3
6版后 已移除 keyfile  and  certfile  are  deprecated  in  favor  of  sslcontext
 please  use  ssl
loadcertchain  instead  or  let  ssl
createdefaultcontext  select  the  systems  trusted  ca  certificates  for  you
 在3
9版 更 改 the  optional  timeout  parameter  was  added
 参见 documents  describing  the  protocol  and  sources  and  binaries  for  servers  implementing  it  can  all  be  found  at  the  university  of  washingtons  imap  information  center  httpswww
imap 4 objects
在3
5 版更 改 string  usernames  and  passwords  are  now  encoded  to  utf 8 instead  of  being  limited  to  ascii
3
5新版功 能 the  enable  method  itself  and  rfc 6855 support
 在3
8版 更 改 the  method  no  longer  ignores  silently  arbitrary  exceptions
 在3
9 版更 改 the  timeout  parameter  was  added
 示例 m  is  a  connected  imap 4 instance
3
2新 版功 能
在3
4版更改 the  method  now  supports  hostname  check  with  ssl
expunge  注解 creating  flags  containing  for  example  test  violates  rfc 3501 the  imap  protocol
3
9新 版 功能
3
5 新 版 功能
imap 4 example
imghdr  推测 图 像类 型
源 代码 libimghdr
pyimghdr  模块 推测 文件 或字 节流 中的 图像 的类 型
imghdr 模 块 定 义了 以下 类型 imghdr
whatfilename  hnone  测试 包含在 命名 为 filename 的 文件 中的 图像 数据 并 且 返 回 描 述此 类图片的 字符 串
如 果 可选 的 h 被 提供 filename  将被 忽略 并且 h  包 含 将被 测试 的二进 制流
 在3
6版 更改 接受一个 类路 径对象
 接下 来的 图像 类型 是 可识 别 的 返回 值 来自 what  值图 像 格式 rgb  sgi  图像 库文 件 gif  gif 87 a 和89 a 文 件 pbm 便携式位 图文件 pgm  便携式 灰度 图 文 件 ppm  便携 式 像 素 表 文 件 tiff  tiff 文件 rast  sun 光栅 文件 xbm  x  位图 文件 jpeg  jfif 或 exif  格式 的 jpeg  数据 bmp  bmp  文件 png 便 携 式 网络 图像 webp  webp  文件 exr  openexr  文 件3
5新 版功 能 exr  和 webp  格 式 被 添 加
 你可 以扩 展 此 imghdr 可 以被 追加 的这个变 量识别 的文件格 式的列表 imghdr
tests 执 行 单个 测试 的函数 列表
每 个函数都有 两个 参数 字 节流 和类似 开 放 文件的对象
当 what 用 字 节流调 用时 类文 件对象将是 none
 如 果测试 成功 这个 测 试 函 数应 当返 回一个 描述 图像类 型 的 字符 串否 则 返回 none
示例 import  imghdr  imghdr
imp  access  the  import  internals
py 3
4版 后已 移 除 the  imp  module  is  deprecated  in  favor  ofimportlib
3
4 版后 已 移除 use  importlib
magicnumber  instead
3
3 版后 已 移除 use  the  constants  defined  on  importlib
machinery  instead
3
3 版后 已移 除 use  importlib
findspec  instead  unless  python 3
3 compatibility  is  required  in  which  case  use  importlib
 for  example  usage  of  the  former  case  see  the 示 例 section  of  the  importlib  documentation
3
3 版后 已移除 if  previously  used  in  conjunction  with  imp
 see  the 示 例 section  of  the  importlib  documentation  for  details  of  the  various  approaches
3
4版后 已移 除 use  importlib
 与 python  中的 所有的 其它对象 一 样 旧 的 对象 只 有在引用 计 数为0之 后才 会被回收
 模块 命名 空间 中的 名 称重 新指向任 何新的 或更 改后的 对象
 其 他旧 对象 的 引用 例 如 那 个模块的 外 部 名称 不会 被 重新绑定 到 引用的 新对 象的并且 如 果有需 要 必须在 出 现的 每 个命 名 空间中 进行 更 新
有一 些其他 注意 事项当 一 个 模 块被 重新 加载的 时候 它的 字 典 包含了那 个模块的 全 区变 量 会被 保留
名称 的重 新定义 会覆 盖 旧的 定 义 所 以 通 常来 说这 不 是问题
 如果一 个新 模 块没 有定 义在旧 版本 模 块中定义 的 名 称则将保 留旧 版 本 中的定 义
这 一 特性 可用 于作 为那个 模 块 的优点如果 它维 护 一个 全局 表 或 者对 象的 缓 存——使 用 try 语句就可 以测试表 的存在 并 且跳 过它的 初 始化 如果有 需要 的 话 try  cache  except  nameerror  cache  it  is  legal  though  generally  not  very  useful  to  reload  builtin  or  dynamically  loaded  modules  except  for  sys  main  and  builtins
如 果一 个模块 创建 一 个类 的 实例重 新加载 定义 那个 类 的模 块不 影 响 这 个实 例的 方 法定 义——— 它们 继续使用旧 类的定义
 对于子类也是 一 样 的
 在3
3版 更 改 relies  on  both  name  and  loader  being  defined  on  the  module  being  reloaded  instead  of  just  name
3
4 版 后已 移 除 use  importlib
3
2新 版 功能
在3
3 版更 改 if  sys
cachetag  is  none  then  notimplementederror  is  raised
3
4版 后 已移 除 use  importlib
在3
5版 更 改 the  debugoverride  parameter  no  longer  creates  a 
 在3
3 版 更 改 raise  notimplementederror  when  sys
3
4版后已 移除 use  importlib
3
4版后已移 除 use  sys
cachetag  directly  starting  in  python 3
在3
3 版更 改 the  locking  scheme  has  changed  to  permodule  locks  for  the  most  part
 a  global  import  lock  is  kept  for  some  critical  tasks  such  as  initializing  the  permodule  locks
3
4 版 后 已移 除
 在3
3版更 改 the  locking  scheme  has  changed  to  permodule  locks  for  the  most  part
 a  global  import  lock  is  kept  for  some  critical  tasks  such  as  initializing  the  permodule  locks
3
4版 后已移除
 在3
3版 更 改 the  locking  scheme  has  changed  to  permodule  locks  for  the  most  part
 a  global  import  lock  is  kept  for  some  critical  tasks  such  as  initializing  the  permodule  locks
3
4版 后已 移 除
3
3 版后 已移 除
3
3版 后已 移除
3
3 版后 已 移除
3
3 版后 已移除
3
3 版后 已 移 除
3
3版后 已移 除
 在3
3版更 改 none  is  inserted  into  sys
pathimportercache  instead  of  an  instance  of  nullimporter
3
4版 后已移 除 insert  none  into  sys
pathimportercache  instead
示 例
using  importlibmetadata
 注 解 this  functionality  is  provisional  and  may  deviate  from  the  usual  version  semantics  of  the  standard  library
概述
可 用 api
entry  points
distribution  metadata
distribution  versions
distribution  files
distribution  requirements
distributions
extending  the  search  algorithm
 备 注1 technically  the  returned  distribution  metadata  object  is  an  email
importlib  import  的实现
3
1新 版 功能
 源代 码 libimportlibinit
 概述
 函 数
importlibabc ——关 于 导入的抽 象基 类
importlibresources 资源
源码 libimportlibresources
py 3
7 新 版 功能
 这个模 块 使 得 python 的 导入系 统 提供 了 访 问 包 内 的 资 源 的 功 能
如果 能 够导 入一 个 包 那么就 能够访问 那个 包里面 的资源
 资源可以以 二进制 或文 本模 式方 式被 打开 或读 取
资 源非 常 类似于目 录 内 部的 文 件 要 牢记 的是 这 仅仅 是 一个 比喻
 资源 和 包 不是 与文件 系统 上 的物 理 文 件 和 目录 一 样 存在 着
注解 this  module  provides  functionality  similar  to  pkgresources  basic  resource  access  without  the  performance  overhead  of  that  package
 加载 器想 要 支 持资源读 取应该 实 现 一个由 importlib
resourcereader  指 定 的 getresourcereaderfullname  方 法
3
9新 版功能
importlibmachinery  importers  and  path  hooks
3
3 新 版功 能
3
3 新版功能
3
5 版后 已 移 除 use  bytecodesuffixes  instead
3
3新版功 能
3
5版后 已移 除 use  bytecodesuffixes  instead
3
3 新 版 功能
 在3
5版更改 the  value  is  no  longer  dependent  on  debug
3
3 新版 功能
3
3新 版功能
在3
5 版更 改 as  part  of  pep 489 the  builtin  importer  now  implements  loader
createmodule  and  loader
 在3
4 版 更改 gained  createmodule  and  execmodule  methods
3
3新 版功能
3
6版 后 已移 除 use  site  configuration  instead
 future  versions  of  python  may  not  enable  this  finder  by  default
3
4新 版 功能
 在3
5 版 更改 if  the  current  working  directory  represented  by  an  empty  string  is  no  longer  valid  then  none  is  returned  but  no  value  is  cached  in  sys
3
4 版 后已 移除使 用 findspec  来代替
 在3
7版 更 改 entries  of  none  in  sys
pathimportercache  are  deleted
 在3
4 版 更 改 calls  objects  in  sys
pathhooks  with  the  current  working  directory  for  i
3
3新 版 功 能
3
4 新版功 能
3
3 新版 功能
3
6版 后已 移 除 use  importlib
execmodule  instead
3
3新版 功能
3
6 版后 已移 除 use  importlib
3
3新版 功能
3
5新 版 功 能
3
5 新版 功 能
 getfilenamefullname  返 回 path
3
4 新 版 功 能
3
4新版 功 能
importlibutil  utility  code  for  importers
3
4 新版功 能
3
4新 版 功 能
 在3
5 版 更 改 the  optimization  parameter  was  added  and  the  debugoverride  parameter  was  deprecated
在3
6版 更改 接 受 一 个 类路 径对 象
3
4 新 版 功能
在3
6 版更改 接受一 个类路 径对象
3
4 新版 功能
3
3 新版功 能
 在3
9 版更 改 to  improve  consistency  with  import  statements  raise  importerror  instead  of  valueerror  for  invalid  relative  import  attempts
3
4 新 版 功能
 在3
7 版 更改 raises  modulenotfounderror  instead  of  attributeerror  if  package  is  in  fact  not  a  package  i
3
5新 版功 能
 在3
3版更 改 loader  and  package  are  automatically  set  when  possible
 在3
4版更 改 set  name  loader  package  unconditionally  to  support  reloading
3
4 版后 已 移除 the  import  machinery  now  directly  performs  all  the  functionality  provided  by  this  function
 在3
4版 更 改 set  loader  if  set  to  none  as  if  the  attribute  does  not  exist
3
4版 后已移 除 the  import  machinery  takes  care  of  this  automatically
3
4版 后已 移除 the  import  machinery  takes  care  of  this  automatically
3
4 新版 功 能
3
4新 版功 能
在3
6 版 更 改 接 受一个 类路径 对象
3
7 新 版 功 能
 注解 for  projects  where  startup  time  is  critical  this  class  allows  for  potentially  minimizing  the  cost  of  loading  a  module  if  it  is  never  used
3
5新 版功 能
在3
6 版更 改 began  calling  createmodule  removing  the  compatibility  warning  for  importlib
builtinimporter  and  importlib
示 例
importing  programmatically
checking  if  a  module  can  be  imported
importing  a  source  file  directly
setting  up  an  importer
approximating  importlibimportmodule
python  标准 库
python  语言参 考描述了 python 语 言 的具体 语法 和语 义 这份库参 考 则 介绍 了与 python  一 同 发行 的标 准库
 它还 描 述了 通常包 含 在 python  发行版中 的一 些可选 组件
python  标 准库 非常庞 大所 提供 的组 件涉及 范围 十分 广 泛 正 如以 下内容 目录所显 示的
 这 个 库 包含 了 多个 内置 模块以 c 编 写 python  程序员必 须依 靠它 们来 实现 系统 级功 能 例 如文 件 io 此 外还 有大 量 以 python 编 写的 模 块提 供了日常编 程中 许 多问 题 的标准 解决 方案
 其 中有 些 模 块经 过专 门 设计 通过将 特定 平 台功 能抽 象化 为平 台中 立 的 api 来 鼓励 和 加强 python  程序 的可 移植性
windows  版本 的 python  安装程 序通 常 包含 整 个 标 准库 往 往还 包含许 多额 外 组 件
对 于 类 unix  操作 系统 python  通 常 会分 成一 系列 的软件 包 因此 可 能需 要使用 操作 系 统所 提供的 包管 理工 具来 获 取部 分或全部 可选 组 件
 在这 个 标准 库以 外还 存在 成 千 上 万 并且不断增加的 其他 组 件 从单 独的 程 序、模 块、 软件包直到 完 整的 应用 开发 框架 访问 python  包索引 即 可 获 取 这 些第 三方 包
 概述 可 用 性 注 释内 置 函 数 内 置 常量 由 site  模块添加 的常量内 置类 型逻辑 值检 测 布 尔运 算 and  or  not 比 较数 字类 型 int  float  complex 迭代 器 类 型序 列类 型 list  tuple  range  文 本序 列类 型 str 二 进 制序列类型 bytes  bytearray  memoryview  集合类型 set  frozenset  映 射 类型 dict  上 下文 管理器 类型 generic  alias  type 其 他 内置类 型 特 殊属 性 内置 异 常 基 类 具 体 异常 警 告 异常层次 结构文本 处 理服 务 string 常 见的字 符串操作 re  正则 表达 式操作 difflib  计 算差异 的辅 助工 具 textwrap 文 本自动 换行 与填 充 unicodedata  unicode 数 据库 stringprep  因特 网 字符 串预 备 readline  gnu  readline 接 口 rlcompleter  gnu  readline 的 补全 函数 二进 制数 据 服 务 struct  将字 节 串 解 读为 打包 的二 进制数 据 codecs 编 解 码器注 册和 相关 基 类数据类 型 datetime 基本 的日 期 和 时间 类型 zoneinfo  iana  时区 支持 calendar  日 历 相 关函数 collections  容器 数 据类 型 collections
abc 容器的 抽 象基类 heapq 堆队列 算法 bisect  数组 二分 查找 算 法 array 高效 的 数 值数 组 weakref 弱引用 types  动态类 型创 建 和 内置类 型名 称 copy 浅层 shallow  和深 层 deep 复 制 操作 pprint  数据 美化输 出 reprlib 另一 种 repr 实 现 enum 对 枚举 的支持 graphlib  functionality  to  operate  with  graphlike  structures  数 字 和 数学模 块 numbers 数字 的抽 象基 类 math 数学 函数 cmath 关 于 复数的 数学函 数 decimal 十 进 制 定点 和浮点 运算 fractions  分数 random  生成伪随 机数 statistics  数学 统计 函 数 函数式 编 程 模块 itertools 为高效循 环而 创建 迭代 器 的函 数 functools 高 阶 函数 和 可调 用对 象上 的操作 operator  标准运算 符 替代函数 文 件和 目 录访问 pathlib  面向 对象 的文 件 系 统路 径 os
path  常 用 路 径 操作 fileinput  迭 代 来 自 多 个 输 入流 的行 stat  解析 stat 结果 filecmp  文 件 及 目录的比 较 tempfile  生 成临 时 文 件和 目 录 glob  unix 风 格 路 径名 模式 扩展 fnmatch  unix  文件 名 模 式 匹配 linecache  随 机 读 写文 本行 shutil  高阶 文 件操 作数 据持 久化 pickle  python  对象 序列 化 copyreg 注 册 配 合 pickle 模 块使 用的 函 数 shelve  python  对 象持 久 化 marshal  内 部 python 对 象序 列化 dbm  unix  数据 库 接口 sqlite 3 sqlite  数据 库 dbapi 2
0 接 口 模块数 据压 缩和存 档 zlib 与 gzip 兼容 的 压 缩 gzip 对 gzip  格式 的支持 bz 2对 bzip 2 压缩 算法 的支 持 lzma 用 lzma  算法压 缩 zipfile 使 用 zip  存 档 tarfile  读写 tar  归 档 文 件 文 件 格 式 csv  csv  文件 读 写 configparser  配 置 文 件解 析 器 netrc  netrc 文 件 处理 xdrlib 编 码 与解 码 xdr  数据 plistlib 生 成与 解 析 apple 
plist  文件加 密服务 hashlib  安全 哈 希 与 消息 摘 要 hmac 基 于密钥的 消 息 验 证 secrets 生 成安 全随 机数字 用 于 管 理密 码 通 用 操作系 统 服务 os 多 种操 作 系统接口 io  处理 流 的核 心工 具 time  时间 的 访 问 和转 换 argparse  命令行 选项、参数 和 子命 令 解 析 器 getopt  c  风格 的 命令 行 选 项 解析 器 logging  python 的 日志 记录工 具 logging
config 日志 记 录配 置 logging
handlers 日 志处 理 程序 getpass  便 携 式密 码输 入工具 curses 终端 字符单元 显示 的 处理 curses
textpad 用 于 curses 程序的 文 本输入 控 件 curses
ascii  用于 ascii  字符 的工具 curses
panel  curses  的 面板 栈 扩展 platform 获 取底层平 台的 标识 数据 errno 标 准 errno  系 统 符号 ctypes  python  的外 部函数 库 并发 执 行 threading 基于 线程的 并 行 multiprocessing 基 于进程的 并 行 multiprocessing
sharedmemory  可从 进程 直接 访 问的 共 享内 存 concurrent 包 concurrent
futures  启动 并行 任务 subprocess  子 进 程管理 sched  事件 调 度器 queue  一 个同 步的 队列 类 thread  底 层 多 线程 api  contextvars 上下 文变 量 上下 文 变 量 手动 上下 文 管 理 asyncio  支 持网络和进 程 间通 信 asyncio  异步 io  socket  底 层网 络 接 口 ssl  套接字 对 象的 tlsssl 包 装 器 select  等 待 io 完成 selectors 高级 io  复 用库 asyncore  异步 socket 处理器 asynchat  异 步 socket  指 令 响应 处理 器 signal 设置异 步 事件处 理程 序 mmap  内存映 射文 件支 持互联 网 数据 处理 email 电子 邮件 与 mime 处理包 json  json 编 码 和 解 码 器 mailcap  mailcap 文 件处 理 mailbox  manipulate  mailboxes  in  various  formats  mimetypes  map  filenames  to  mime  types  base 64 base 16 base 32 base 64 base 85数据编 码 binhex 对 binhex 4文 件进 行编码 和解 码 binascii 二 进制和 ascii  码 互 转 quopri  编码与解 码经过 mime  转 码的 可打印数据 uu  对 uuencode  文件 进行 编码 与解 码结构 化 标 记处理 工 具 html  超 文本标 记语言 支持 html
parser  简单 的 html  和 xhtml 解析 器 html
entities  html 一般实 体的定 义 xml  处理 模块 xml
elementtree  elementtree  xml  api  xml
saxutils  sax 工具集 xml
expat  fast  xml  parsing  using  expat  互联 网 协 议和 支 持 webbrowser 方 便的 web  浏览器 控 制器 cgi  common  gateway  interface  support  cgitb 用 于 cgi 脚 本 的回 溯管 理器 wsgiref  wsgi  utilities  and  reference  implementation  urllib  url  处理模 块 urllib
request 用于 打 开 url 的可 扩展 库 urllib
response  urllib 使用的 response  类 urllib
error  urllib
request 引发 的 异常 类 urllib
robotparser  robots
txt 语法分析 程序 http  http  模 块 http
client  http  协议 客 户端 ftplib  ftp  协议 客户端 poplib  pop 3 protocol  client  imaplib  imap 4 protocol  client  nntplib  nntp  protocol  client  smtplib  smtp  协 议客户 端 smtpd  smtp 服 务 器 telnetlib  telnet  client  uuid  uuid  objects  according  to  rfc 4122 socketserver  a  framework  for  network  servers  http
server  http 服 务器 http
cookies  http  状态 管理 http
cookiejar —— http 客 户端的 cookie  处 理 xmlrpc  xmlrpc 服务 端与 客户端模 块 xmlrpc
server  basic  xmlrpc  servers  ipaddress  ipv 4 ipv 6操作 库 多媒 体 服务 audioop 处 理 原始 音频 数 据 aifc 读 写 aiff 和 aifc  文件 sunau 读 写 sun  au  文件 wave 读 写 wav 格式文 件 chunk 读 取 iff 分块 数据 colorsys  颜 色系 统间 的转 换 imghdr 推测图 像类型 sndhdr  推 测声 音 文 件 的类 型 ossaudiodev  access  to  osscompatible  audio  devices 国际 化 gettext 多 语种 国 际化 服 务 locale 国际 化 服务 程 序框 架 turtle  海 龟绘图 cmd  支持 面向行的 命令解 释 器 shlex  simple  lexical  analysis  tk  图 形用 户界 面 gui  tkinter  tcltk 的 python 接 口 tkinter
colorchooser 颜 色选择对 话框 tkinter
font  tkinter 字体 封装 tkinter  对 话框 tkinter
messagebox  tkinter  消息 提示 tkinter
scrolledtext 滚动 文字 控件 tkinter
dnd  拖放操作 支持 tkinter
ttk  tk  主题 部 件 tkinter
tix  extension  widgets  for  tk  idle  其 他图形 用户界 面 gui 包开 发 工具 typing 类 型 标注 支持 pydoc 文 档生成 器和 在线 帮助 系 统 python  development  mode  effects  of  the  python  development  mode  resourcewarning  example  bad  file  descriptor  error  example  doctest  测试 交 互 性的 python 示 例 unittest 单元测 试框 架 unittest
mock  mock  对象 库 unittest
mock 上手 指南2 to 3 自动 将 python 2代 码转 为 python 3代码 test  python 回 归测 试包 test
bytecodehelper  support  tools  for  testing  correct  bytecode  generation  调试和 分 析审 计事件表 bdb  debugger  framework  faulthandler  dump  the  python  traceback  pdb  python  的调试器 python  profilers  分析 器 timeit  测量 小 代码片段 的 执行 时间 trace  跟踪 python  语 句 执行 tracemalloc 跟踪 内存分配 软 件 打包 和分 发 distutils  构建 和 安 装 python  模 块 ensurepip  bootstrapping  the  pip  installer  venv  创 建 虚拟 环 境 zipapp  manage  executable  python  zip  archives  python  运 行时 服 务 sys  系统相 关 的参 数和 函数 sysconfig  provide  access  to  pythons  configuration  information  builtins 内建 对象 main  顶 层 脚本环 境 warnings  warning  control  dataclasses 数据类 contextlib  为 with  语 句上下文 提供的工 具 abc  抽 象基 类 atexit  退 出 处 理器 traceback  打印 或检 索堆栈 回溯 future  future 语 句定义 gc 垃 圾回收器 接口 inspect 检 查对 象 site ——指 定域 的配 置钩子 自定 义 python  解 释 器 code 解 释器 基 类 codeop  编 译 python 代 码 导 入 模 块 zipimport 从 zip  存档中导 入 模块 pkgutil  包 扩 展工 具 modulefinder 查 找脚 本 使用的 模 块 runpy  locating  and  executing  python  modules  importlib  import  的 实现 using  importlib
metadata  python 语 言服务 parser 访 问 python 解 析树 ast  抽 象 语 法 树 symtable  access  to  the  compilers  symbol  tables  symbol  与 python 解析树 一起使用 的 常 量 token 与 python  解析 树一起使 用的常量 keyword 检 验 python 关键 字 tokenize  对 python 代码 使用 的 标记解析器 tabnanny 模 糊 缩进 检测 pyclbr  python 模 块浏览 器支 持 pycompile 编 译 python 源文 件 compileall  bytecompile  python  libraries  dis  python 字节码 反汇编器 pickletools  pickle 开 发 者 工具 集 杂项服务 formatter 通用 格 式化输 出 windows 系统 相 关 模 块 msilib  read  and  write  microsoft  installer  files  msvcrt 来 自 ms  vc  运行 时 的有 用例 程 winreg  windows 注 册 表 访问 winsound  soundplaying  interface  for  windows  unix  专有 服 务 posix 最常 见的 posix  系统调 用 pwd  用户 密 码 数 据库 spwd  the  shadow  password  database  grp 组 数据 库 crypt  function  to  check  unix  passwords  termios  posix 风格 的 tty  控制 tty 终 端控制 功 能 pty  伪终端 工 具 fcntl  the  fcntl  and  ioctl  system  calls  pipes 终端管道接 口 resource  resource  usage  information  nis  sun  的 nis 黄 页接口 unix  syslog  库例 程 被取 代 的模块 optparse  解析 器 的命令 行选 项 imp  access  the  import  internals 未创 建 文 档的模 块 平 台特定 模块
inspect 检 查 对 象
源代码 libinspect
pyinspect  模 块提 供了 一些 有 用 的函 数帮助 获 取 对 象的信 息 例如模 块、类、 方 法、 函数、回溯、帧对 象 以及 代码 对 象
例 如 它可以 帮 助 你 检 查类 的内容 获取 某个 方 法的 源代码取 得 并 格式化某个 函 数的参 数列表或 者 获 取 你需 要显示 的 回 溯的 详 细 信息
该模 块提供了4 种主要的 功能类型 检查、获取 源代码、检 查类与函 数、检查解 释器的调 用堆栈
类 型和成员
getmembers  函数获取对 象的 成员例如类 或模 块
函数名以 is  开始的函数 主要作为 getmembers  的第2个参数 使用
它们 也可用于判 定某对象 是否有如 下的特殊属 性类型属 性描述 module 模块 doc  文档字符 串 file 文件名内 置模块没 有文件名 class 类 doc  文档字符 串 name 类定义时 所使用的 名称 qualname  qualified  name 限定名 称 module 该类型 被定义时 所在的模 块的名称 method  方法 doc 文档 字符串 name 该 方法定义 时所使用 的名称 qualname  qualified  name 限 定名称 func 实 现该方法 的函数对 象 self 该方法 被绑定的 实例若没 有绑定则 为 none  module  name  of  module  in  which  this  method  was  defined 函数 doc 文 档字符串 name  用于定义 此函数的 名称 qualname  qualified  name 限定 名称 code 包含 已编译函 数的代码 对象 bytecode  defaults  tuple  of  any  default  values  for  positional  or  keyword  parameters  kwdefaults  mapping  of  any  default  values  for  keywordonly  parameters  globals  global  namespace  in  which  this  function  was  defined  annotations  mapping  of  parameters  names  to  annotations  return  key  is  reserved  for  return  annotations
 module  name  of  module  in  which  this  function  was  defined 回溯 tbframe  此级别的 框架对象 tblasti  index  of  last  attempted  instruction  in  bytecode  tblineno  current  line  number  in  python  source  code  tbnext  next  inner  traceback  object  called  by  this  level  框架 fback  next  outer  frame  object  this  frames  caller  fbuiltins  builtins  namespace  seen  by  this  frame  fcode  code  object  being  executed  in  this  frame  fglobals  global  namespace  seen  by  this  frame  flasti  index  of  last  attempted  instruction  in  bytecode  flineno  current  line  number  in  python  source  code  flocals  local  namespace  seen  by  this  frame  ftrace  tracing  function  for  this  frame  or  none  code  coargcount  number  of  arguments  not  including  keyword  only  arguments  or  args  cocode 原始 编译字 节码 的 字符串 cocellvars  单 元变量 名称的元组 通 过包含 作 用域引 用 coconsts 字节码中 使 用的常 量元组 cofilename 创建 此代 码 对象的 文 件的名 称 cofirstlineno  number  of  first  line  in  python  source  code  coflags  bitmap  of  co  flags  read  more  here  colnotab  编码的 行号 到 字节码 索 引的映 射 cofreevars  tuple  of  names  of  free  variables  referenced  via  a  functions  closure  coposonlyargcount  number  of  positional  only  arguments  cokwonlyargcount  number  of  keyword  only  arguments  not  including  arg  coname  定义此 代码对象 的名称 conames 局 部变量名 称的元组 conlocals  局部变量 的数 量 costacksize 需要虚 拟机堆栈 空间 covarnames 参数 名和局部 变量的元 组 生成器 name  名称 qualname  qualified  name 限定 名称 giframe 框架 girunning  生成器在 运行吗？ gicode  code  giyieldfrom  object  being  iterated  by  yield  from  or  none  协程 name 名 称 qualname  qualified  name  限 定 名 称 crawait  object  being  awaited  on  or  none  crframe  框 架 crrunning  is  the  coroutine  running  crcode  code  crorigin  where  coroutine  was  created  or  none
setcoroutineorigintr  ackingdepth  builtin  doc  文 档 字 符 串 name  此 函 数 或 方 法 的 原 始 名 称 qualname  qualified  name  限 定 名 称 self  instance  to  which  a  method  is  bound  or  none  在3
5 版 更 改 add  qualname  and  giyieldfrom  attributes  togenerators
the  name  attribute  of  generators  is  now  set  from  thefunction  name  instead  of  the  code  name  and  it  can  now  be  modified
 在3
7 版 更 改 add  crorigin  attribute  to  coroutines
 注 解 getmembers  will  only  return  class  attributes  defined  in  the  metaclass  when  the  argument  is  a  class  and  those  attributes  have  been  listed  in  the  metaclass  custom  dir
在3
3 版更 改 the  function  is  based  directly  on  importlib
 在3
8版更 改 functions  wrapped  in  functools
partial  now  return  true  if  the  wrapped  function  is  a  python  generator  function
3
5新版功 能
 在3
8版更 改 functions  wrapped  in  functools
partial  now  return  true  if  the  wrapped  function  is  a  coroutine  function
3
5新版功 能
coroutine  def  gencoro  yield  assert  not  isawaitablegen  assert  isawaitablegencoro 3
5 新版功 能
isasyncgenfunctionagen  true 3
6新 版功能
在3
8 版更 改 functions  wrapped  in  functools
partial  now  return  true  if  the  wrapped  function  is  a  asynchronous  generator  function
3
6新版功 能
retrieving  source  code
在3
5 版更改 documentation  strings  are  now  inherited  if  not  overridden
在3
3 版更改 oserror  is  raised  instead  of  ioerror  now  an  alias  of  the  former
在3
3 版更改 oserror  is  raised  instead  of  ioerror  now  an  alias  of  the  former
introspecting  callables  with  the  signature  object
3
3新 版功能
3
5新 版功能 followwrapped  parameter
 pass  false  to  get  a  signature  of  callable  specifically  callable
注 解 some  callables  may  not  be  introspectable  in  certain  implementations  of  python
在3
5版更 改 signature  objects  are  picklable  and  hashable
在3
7 版 更改 python  only  explicitly  guaranteed  that  it  preserved  the  declaration  order  of  keywordonly  parameters  as  of  version 3
fromcallablemin  assert  isinstancesig  mysignature 3
5新 版 功能
在3
5 版 更改 parameter  objects  are  picklable  and  hashable
在3
6 版更改 these  parameter  names  are  exposed  by  this  module  as  names  like  implicit 0
keywordonly 名 称 意义 positionalonly  value  must  be  supplied  as  a  positional  argument
3
8新 版 功能
empty  annotationspam  foospam 在3
4 版更改 in  python 3
3 parameter  objects  were  allowed  to  have  name  set  to  none  if  their  kind  was  set  to  positionalonly
注 解 arguments  for  which  signature
在3
9 版更改 arguments  is  now  of  type  dict
 formerly  it  was  of  type  collections
arguments  a  spam  b  ham  args 3
5新 版 功能
kwargs 参 见 pep 362 function  signature  object
类 与函数
3
0版 后已 移除 use  getfullargspec  for  an  updated  api  that  is  usually  a  dropin  replacement  but  also  correctly  handles  function  annotations  and  keywordonly  parameters
alternatively  use  signature  and  signature  object  which  provide  a  more  structured  introspection  api  for  callables
 在3
4版更改 this  function  is  now  based  on  signature  but  still  ignores  wrapped  attributes  and  includes  the  already  bound  first  parameter  in  the  signature  output  for  bound  methods
 在3
6版 更改 this  method  was  previously  documented  as  deprecated  in  favour  of  signature  in  python 3
5 but  that  decision  has  been  reversed  in  order  to  restore  a  clearly  supported  standard  interface  for  singlesource  python 23 code  migrating  away  from  the  legacy  getargspec  api
在3
7版 更改 python  only  explicitly  guaranteed  that  it  preserved  the  declaration  order  of  keywordonly  parameters  as  of  version 3
7 although  in  practice  this  order  had  always  been  preserved  in  python 3
 注解 this  function  was  inadvertently  marked  as  deprecated  in  python 3
例如 from  inspect  import  formatargspec  getfullargspec  def  fa  int  b  float 
 formatargspecgetfullargspecf  a  int  b  float 3
5 版后 已 移除 use  signature  and  signature  object  which  provide  a  better  introspecting  api  for  callables
注 解 this  function  was  inadvertently  marked  as  deprecated  in  python 3
 typeerror  f  missing 1 required  positional  argument  a 3
2新 版功能
3
5版 后已 移除 use  signature
3
3新版 功能
3
4新版 功 能
the  interpreter  stack
在3
5版 更 改 return  a  named  tuple  instead  of  a  tuple
注解 keeping  references  to  frame  objects  as  found  in  the  first  element  of  the  frame  records  these  functions  return  can  cause  your  program  to  create  reference  cycles
 在3
5版 更 改 a  list  of  named  tuples  frameinfoframe  filename  lineno  function  codecontext  index  is  returned
在3
5版 更改 a  list  of  named  tuples  frameinfoframe  filename  lineno  function  codecontext  index  is  returned
 在3
5版更改 a  list  of  named  tuples  frameinfoframe  filename  lineno  function  codecontext  index  is  returned
 在3
5版更改 a  list  of  named  tuples  frameinfoframe  filename  lineno  function  codecontext  index  is  returned
fetching  attributes  statically
3
2 新版功能
current  state  of  generators  and  coroutines
3
2 新 版功能
3
5 新版功能
3
3 新 版功能
3
5 新版功能
code  objects  bit  flags
3
5 新版 功能
3
5 新版 功能
3
6 新版 功能
注解 the  flags  are  specific  to  cpython  and  may  not  be  defined  in  other  python  implementations
命令 行界面
 互联网协议和 支持
概述
python 库 中 包含了 几 种 不同 的组 件
它 包含 通常 被视 为 语 言 核 心中 的一 部分 的 数 据类 型例 如数 字和 列 表
对于这 些类型 python  语言核 心定义了文 字的 形式 并对 它 们 的 语义 设 置 了 一 些 约束 但 没有 完全 定义 语义
 另 一方 面语言 核心 确实定 义了 语 法属 性如 操作 符的 拼写和 优先级
这 个库 也包含 了内置 函数 和异 常不 需要 import  语句 就 可以 在 所有 python 代 码中 使 用 的对 象
有 一些 是由 语 言核心 定义 的 但 是 许 多 对 于核 心语 义不 是必 需 的并 且仅 在这里 描述
 不 过这 个 库 主要 是由 一系列 的模 块组成
这 些 模块集 可以 不 同方 式 分类
 有 些模 块 是 用 c 编写并 内置于 python  解释器中 另 一些模 块 则是 用 python 编 写并以 源码形 式导 入
有些模 块 提供专 用于 python  的 接口 例 如打 印 栈追 踪 信 息 有些模 块提供 专用于特 定 操作系 统 的接 口例 如操作 特 定 的 硬件 另一些 模块 则 提供 针 对特 定 应 用领域的 接口例 如万维网
 有些模 块在所有更 新 和移植 版 本 的 python 中可 用另 一些 模块 仅在底 层系 统支 持或要 求 时 可 用还有些 模 块则 仅当编译 和 安装 python  时 选择了 特 定配置选 项时 才可 用
本手册 以从 内到 外的 顺序 组 织 首 先 描述 内置函 数、数 据类 型和异 常最后是根 据 相关 性进 行分组 的 各种模 块
这 意味 着如 果 你 从 头开 始 阅读 本手 册 并在 感到厌烦 时跳 到下 一 章 你 仍能 对 python  库的 可 用模 块和 所支持的应 用领域有个 大致 了解
 当然 你并 非必 须如 同读 小 说一样从 头读到尾你 也可 以先浏 览 内 容 目 录在手册开 头或 在 索 引 在手册 末尾 中 查找某个 特定函数、模 块 或条 目
最 后 如果 你喜欢 随意 学 习 某个 主题 你 可 以选 择一个 随机页 码 参 见 random  模 块并 读上 一 两小 节
 无 论你想 以怎 样的顺序 阅读 本 手册 还 是建议 先从 内 置 函 数这 一章 开 始因 为本 手册 的其 余内 容 都 需 要你熟 悉其中 的基本 概念
 让我 们开 始 吧
 可用性注释
 如果 出 现可 用性 unix  注 释 意味 着 相应函数 通 常存 在于 unix  系 统 中
 但这 并不 保证其存 在 于 某个 特定 的操 作系 统 中
 如 果没 有 单独说 明 所有注 明可用性 unix  的函 数都支持 基于 unix  核心 构建 的 mac  os  x 系 统
io 处 理流的核 心工具
源 代 码 libio
 概述
io  模块 提供 了 python 用于 处理 各种 io  类型的主 要工具
 三种主 要的 io 类型分别 为 文本 io  二进 制 io 和 原始 io
 这些 是 泛型 类型 有很多种 后端 存 储可 以 用在 他们上面
一 个隶 属于 任 何这 些类 型 的具 体对 象 被称作 file  object
 其 他同 类的 术 语 还 有 流 和类 文件 对象
独 立 于其 类别 每个 具 体流对象 也 将具 有各 种功 能它 可以 是只 读 只写或 读写
 它还可以 允许任 意 随机 访 问 向前 或向 后寻找任何 位置 或仅 允 许顺 序 访 问例如在 套接 字 或 管道 的 情 况下
所 有流 对提 供给 它们的 数据类型 都 很敏感
 例如将 str 对 象给 二 进制 流的 write  方 法 会 引发 typeerror
 将 bytes  对 象提 供给 文本 流 的 write 方 法 也是 如此
 在3
3 版更 改由 于 ioerror 现 在 是 oserror  的 别名因 此用 于引发 ioerror  的操 作现 在会引 发 oserror 
 文本 io
 文本 io  预期并 生成 str  对象
 这 意味着无 论 何时 后 台存储是 由 字节 组成的 例 如 在文件的 情况下 数据 的编 码 和 解码 都 是 透 明 的并 且可 以 选择 转换 特定 于 平台 的 换行 符
创 建文 本 流 的最 简单 方法 是 使用 open  可 以选 择指定编 码 f  openmyfile
txt  r  encodingutf 8内存 中 文 本 流也 可以 作 为 stringio  对 象使用 f  io
stringiosome  initial  text  datatextiobase 的 文 档中 详 细 描述 了文本 流 的 api
二 进 制 io
原始 io
 高阶 模 块 接口
 内 存 中 的 流
也可 以 使用 str  或 byteslike  object  作 为文件进 行读 取和写 入
对于 字符串 stringio 可 以像 在 文 本 模式下 打 开的 文件 一 样使用
 bytesio  可以 像以 二进 制 模式打开 的文 件一样 使用
两 者 都 提供完整 的 随 机 读写 功 能
参 见 sys 包含 标准 io 流 sys
stdout  和 sys
stderr 
类的 层次结 构
io 流被安 排为按类的 层次 结构实现
 首 先是 抽象 基 类 abc 用 于 指 定流 的各 种类 别 然 后是 提供标 准流实 现的具 体类
 注 解抽 象基 类还提 供某 些方法 的 默认实 现以帮助 实现 具 体的 流 类
 例如 bufferediobase  提供 了 readinto 和 readline 的 未 优 化实 现
io 层次 结 构 的顶 部 是 抽 象基 类 iobase 
它定义 了流 的基本 接口
但是 请注意对 流 的读取 和 写入 之 间 没有 分 离
 如果实 现不 支持 指定 的操作 则会引发 unsupportedoperation 
 抽 象 基 类 rawiobase  是 iobase 的 子类
它 负责 将字节读 取和写 入 流 中
rawiobase  的子 类 fileio  提供计 算机文 件系 统 中 文件 的接 口
抽象基类 bufferediobase  继承 了 iobase 处 理 原始 二进制 流 rawiobase 上 的 缓冲
其 子类 bufferedwriter 、 bufferedreader 和 bufferedrwpair  分 别缓 冲 可读、 可 写以 及 可读 写 的原始 二 进制 流
bufferedrandom 提 供 了带 缓冲的 可随 机 访问 流接 口
 bufferediobase  的另 一个子 类 bytesio 是 内 存中字 节流
 抽象 基类 textiobase 继 承了 iobase 
 它处 理 可表示 文本 的 流并 处 理字符 串的编 码和 解码
类 textiowrapper  继承了 textiobase  是 原始缓 冲流 bufferediobase  的 缓 冲文 本 接 口
最后 stringio 是 文本的 内存流
 参 数名 不 是规范的 一部 分只有 open 的参 数才用 作关键 字参 数
下 表 总 结了 抽 象基 类提 供的 io 模块 抽象 基类 继承抽象 方 法 mixin  方法 和属性 iobase  fileno  seek  和 close  closed  enter  exit  truncate  flush  isatty  iter  next  readable  readline  readlines  seekable  tell  writable 和 writelines  rawiobase  iobase  readinto  和 write 继 承 iobase 方法 read 和 readall  bufferediobase  iobase  detach  read  继承 iobase  方法 readinto  和 readinto 1 read 1和 write  textiobase  iobase  detach  read  继 承 iobase 方 法 encoding  errors 和 readline 和 write  newlines 
io  基类
原 始 文件 io
fileioname  moder  closefdtrue  openernone  代 表一 个包 含字节数据 的 os 层 级 文 件的原 始二 进 制 流
 它继承 自 rawiobase
 name  可以 是以下 两项 之 一代 表将被 打 开的文 件路径 的字符 串或 bytes 对象
在 此情 况下 closefd 必 须为 true 默 认值否 则 将会引 发 异 常
 代 表一 个现 有 os  层级 文 件 描 述符的 号 码 的整数 作 为 结果的 fileio  对 象将 可访 问该 文 件
当 fileio  对象被 关 闭 时 此 fd  也将被关 闭除非 closefd  设为 false
 mode 可 以为 r  w  x 或 a 分 别表示读 取默 认 模式、 写入、 独占 新建 或添加
 如 果以 写入 或添 加模式 打 开 的文件 不 存 在 将自 动新 建当 以 写 入模 式 打开 时文 件 将 先 清空
 以新 建模式打 开时如 果 文 件已 存在 则将 引发 fileexistserror
 以 新建 模式 打开 文 件 也意 味着要 写 入因 此该 模 式的 行为 与 w  类似
 在 模式 中附 带 将允 许同 时读取 和 写入
该类的 read  当附带 正值参 数调用 时 readinto 和 write  方 法 将只 执行 一 次系统调用
 可 以 通 过 传 入 一 个 可 调 用 对 象作为 opener  来 使 用 自 定义 文 件 打 开器
 然后 通 过 调 用 opener  并传 入 name  flags  来获 取文 件 对象所对 应 的下 层 文件 描述 符
 opener 必 须 返回一个 打 开文 件 描 述 符 传入 os
open 作 为 opener  的结果 在功 能上 将 与 传入 none 类 似
新 创 建 的文件是 不可 继承的
 有关 opener 参数 的示例 请参见 内置函 数 open 
 在3
3版更 改 增 加了 opener  参数
 增加 了 x 模 式
在3
4版 更 改 文件 现在 禁 止 继承
 fileio  在继 承 自 rawiobase  和 iobase 的 现有 成 员 以外 还提 供 了 以 下数据 属性 和 方法 mode  构造函 数中 给定 的模式
 name  文 件名
 当构 造函 数中没 有给 定名 称时 这是 文件 的文 件 描述 符
缓 冲流
 相比 原 始 io  缓 冲 io  流 提 供了 针对 io  设备 的 更 高层级接 口
bytesioinitialbytes 一 个使 用内 在字 节缓 冲区的 二进 制流
 它继 承自 bufferediobase
 在 close  方 法被调用 时 将 会丢 弃 缓冲区
可选 参数 initialbytes  是一 个包 含 初始 数据 的 byteslike  object
 bytesio  在 继承 自 bufferediobase  和 iobase 的 成 员 以外还 提 供 或 重 载 了 下列 方 法 getbuffer 返 回一 个对 应于 缓冲 区内 容 的 可 读写 视 图而不 必 拷贝 其数 据
此 外 改 变 视 图将 透明 地更新缓 冲 区内 容 b  io
getvalue  bab 56 ef 注 解只 要视 图保持存 在 bytesio  对象 就无法 被改 变大小 或关闭
3
2 新 版 功能
 getvalue 返回 包 含整 个 缓冲区 内 容 的 bytes
 read 1 size 在 bytesio  中这 与 read  相 同
 在3
7 版更 改 size  参数现 在是 可选 的
 readinto 1 b  在 bytesio 中 这与 readinto 相 同
3
5 新版 功能
bufferedreaderraw  buffersizedefaultbuffersize 一 个提供对 可 读、不 可 查 找的 rawiobase 原 始 二进 制 流的 高 层 级 访问的 缓冲 二进 制 流
 它 继 承自 bufferediobase
 当从 此对象 读取数 据 时可 能会从 下层原 始流 请 求 更 大 量 的数据 并 存放 到 内 部 缓 冲 区 中
接下 来 可以在 后续 读 取时 直 接返 回 缓冲 数 据
 根据 给定 的可读 raw  流和 buffersize  创 建 bufferedreader 的 构 造 器
 如果省 略 buffersize 则 会 使 用 defaultbuffersize
 bufferedreader 在 继 承自 bufferediobase  和 iobase  的成员 以 外还 提 供 或重载 了 下列方 法 peeksize  从 流返 回字节 数据而不 前移 位置
 完 成 此调用 将至 多 读 取一 次原 始流
 返 回的字节 数 量 可 能少于 或 多于 请求 的 数量
 readsize 读取 并返 回 size  个字 节如果 size 未给定 或为 负 值 则读 取至 eof  或 是在 非 阻 塞模 式 下 读取调用 将 会 阻塞
 read 1 size 在 原 始 流上 通过 单 次 调用 读 取 并返 回至多 size  个 字节
 如果至 少 缓冲 了一 个字 节 则只返 回 缓冲的 字 节
在 其 他 情 况下 将执 行一 次 原 始流读 取
 在3
7 版 更改 size  参 数现 在 是 可选 的
bufferedwriterraw  buffersizedefaultbuffersize 一 个提供 对可 写、不可 查找 的 rawiobase 原始二 进制流的 高 层级 访 问的 缓冲 二进 制流
它 继承 自 bufferediobase
当 写入 到此对 象时数据 通常会被 放 入 到内部 缓冲 区中
 缓冲 区将在满 足 某些条 件 的情 况下 被 写 到下 层的 rawiobase  对 象 包 括 当缓 冲 区 对 于所有挂起数据 而 言太 小 时当 flush  被调 用时 当为 bufferedrandom 对象 请求 seek  时当 bufferedwriter  对象 被 关 闭或销毁 时
该 构造 器会 为给 定的 可写 raw 流 创建 一个 bufferedwriter
如果 未 给定 buffersize  则使 用 默 认 的 defaultbuffersize
 bufferedwriter 在 继承 自 bufferediobase 和 iobase 的 成员 以外 还 提 供 或 重载 了 下 列方 法 flush  将 缓冲区 中保存的 字 节 数据强 制放入原 始流
 如 果原 始 流发 生 阻塞 则 应 当 引发 blockingioerror
 writeb  写入 byteslike  object  b 并返 回 写入 的字节数
 当 处于 非阻塞模式时 如果 缓冲区 需 要被 写 入 但原始 流发 生 阻 塞则 将 引发 blockingioerror
bufferedrandomraw  buffersizedefaultbuffersize 一 个提 供 对不可 查找 的 rawiobase  原 始 二进制 流的高 层级 访 问的缓 冲二进 制流
 它 继承自 bufferedreader  和 bufferedwriter
该 构造器 会为在 第一 个 参 数中 给定的 可查找 原始 流 创建一 个读 取器和定 稿 器
 如果省 略 buffersize 则使用默认 的 defaultbuffersize
 bufferedrandom  能做到 bufferedreader  或 bufferedwriter 所 能 做 的任何 事
此外 还会 确保实 现 seek  和 tell
bufferedrwpairreader  writer  buffersizedefaultbuffersize 一个提 供对 两个不 可查找 的 rawiobase 原始 二进 制 流 的 高 层级 访问的 缓 冲 二进制 流 一个 可读 另一个可 写
 它 继承自 bufferediobase
 reader 和 writer  分别 是 可 读和可 写 的 rawiobase  对象
 如果 省略 buffersize  则 使用 默认的 defaultbuffersize
 bufferedrwpair 实 现 了 bufferediobase 的 所有方 法但 detach 除 外调用 该 方法将引 发 unsupportedoperation
 警告 bufferedrwpair 不 会 尝试同 步 访 问其 下层的 原始 流
你 不应 当 将传 给它与 读取 器 和 写入器 相 同的 对象 而 要 改 用 bufferedrandom
文 本 io
 性能
 本节讨论 所 提 供 的具 体 io 实 现的性 能
二进 制 io
文本 io
二 进制存储 如 文 件 上的文本 io  比 同 一存 储上 的二进 制 io 慢 得多因为 它需要 使用字符编解 码器 在 unicode 和 二 进制 数据 之 间 进 行 转换
 这在 处 理大量 文本 数 据 如 大型日 志文 件时 会变得 非常 明 显
此 外由于 使用 的重 构 算 法 textiowrapper
tell  和 textiowrapper
seek 都 相当慢
stringio  是原生的 内存 unicode 容 器速 度与 bytesio  相似
多 线程
fileio  对象 是线 程安 全的只要 它们 封装的操作系 统调 用比如 unix 下 的 read 2也 是 线程 安全 的
二 进制 缓 冲对 象例如 bufferedreader  bufferedwriterbufferedrandom  和 bufferedrwpair  使用锁来保 护其内部 结构因此 可 以 安 全地 一次 从多 个线程 中调 用 它 们
textiowrapper 对象 不 再是 线 程安全的
 可 重入 性
 二进 制缓 冲 对象 bufferedreader  bufferedwriter  bufferedrandom  和 bufferedrwpair 的 实例 不 是可重 入的
 虽 然在 正常 情 况下 不会 发生 可重 入调 用 但仍 可 能会 在 signal  处理程序执 行 io  时 产生
如果 线程 尝 试重 入已经访 问的 缓冲 对 象 则会 引 发 runtimeerror 
注 意这并不 禁止其 他线程进 入缓 冲对象
上 面的内容 隐式 地扩展到 文本 文 件中因 为 open 函 数将 把缓 冲 对象封装在 textiowrapper  中
这 包括标 准流因 而 也会影响 内 置的 print 函数
ipaddress  ipv 4 ipv 6 操作库
源代 码 libipaddress
pyipaddress 提供了 创建、 处 理和 操 作 ipv 4和 ipv 6 地址 和网络 的功 能
该 模块 中的 函 数 和类 可 以直接 处理与 ip 地 址相关的 各种 任务包括 检 查两 个主 机是 否在同一 个子网中 遍 历某 个子网 中 的所有 主机 检查 一个字 符串 是否是一 个有效 的 ip  地 址或 网络 定义等等
 这 是完整的 模 块 api 参 考—若 要查看 概述请 见 ipaddress 模 块 介绍
3
3新版功 能
方 便的 工 厂 函 数
ipaddress 模 块 提 供来 工 厂 函 数来 方便地创 建 ip 地址 网络 和接口 ipaddress
ipaddressaddress  返回 一个 ipv 4 address  或 ipv 6 address  对象 取决 于 作 为 参数传 递 的 ip 地 址
可 以提 供 ipv 4或 ipv 6地 址小 于232的整数默认 被认为是 ipv 4
 如果 address 不是 有 效的 ipv 4 或 ipv 6 地 址 则会抛 出 valueerror
ipnetworkaddress  stricttrue 返 回一 个 ipv 4 network 或 ipv 6 network 对 象 具 体取决于 作为参 数传入的 ip  地 址
 address 是表 示 ip 网 址的 字符 串或整数
 可以 提供 ipv 4 或 ipv 6网 址 小 于232的 整 数 默 认被视为 ipv 4
 strict  会 被 传给 ipv 4 network 或 ipv 6 network 构造 器
如 果 address  不表 示有 效 的 ipv 4或 ipv 6 网址或 者网 络设置 了 host 比 特 位 则会 引发 valueerror
ipinterfaceaddress  返 回 一 个 ipv 4 interface  或 ipv 6 interface 对象 取决 于 作为参数 传递 的 ip  地址
 address  是代 表 ip  地 址的字 符 串 或整 数
可 以提 供 ipv 4或 ipv 6地 址小 于232 的整数默 认 认为 是 ipv 4
 如果 address  不是 有效的 ipv 4或 ipv 6 地址 则 会抛出 一 个 valueerror
 这 些方 便的函数的 一个缺 点是 需 要 同时 处理 ipv 4和 ipv 6 格式 这 意 味 着提 供 的错误 信 息 并 不精 准因 为函数 不 知 道是 打 算 采用 ipv 4还是 ipv 6 格式
更 详细的 错误 报告 可以通 过 直 接 调用 相 应 版本 的 类 构造函数 来 获得
ip 地 址
地址 对象
conversion  to  strings  and  integers
 运 算 符
ip  network  definitions
prefix  net  mask  and  host  mask
network  objects
在3
5版 更 改 added  the  twotuple  form  for  the  address  constructor  parameter
subnetofa  true 3
7 新 版功 能
supernetofb  true 3
7 新 版功 能
13203
7 版 后已移除 it  uses  the  same  ordering  and  comparison  algorithm  as  and  class  ipaddress
 在3
5 版更改 added  the  twotuple  form  for  the  address  constructor  parameter
 运算符
 迭代 network  objects  can  be  iterated  to  list  all  the  addresses  belonging  tothe  network
interface  objects
 运 算符
other  module  level  functions
custom  exceptions
 网络 和 进程 间 通 信
itertools  为 高效循 环而 创建迭 代器 的函 数
itertool  函数
itertools 配 方
本 节将展 示如 何使 用现有 的 itertools  作 为 基 础构件 来 创建 扩展的 工 具集
 基本上所 有 这 些西方 和许 许多 多其他 的 配 方 都可 以 通 过 python  package  index 上 的 moreitertools  项 目来 安 装 pip  install  moreitertools  扩展的工具 提供 了与底层工具 集 相同的高 性 能
 保 持 了 超棒的内存 利用率因 为一次 只处 理 一个 元素 而 不 是 将 整个可 迭 代 对象 加 载 到 内存
 代码量 保持得 很小 以 函 数 式风 格 将这些 工具 连 接 在一 起有助 于消 除临时变 量
 速 度依然 很 快 因为倾 向于 使 用 矢量 化 构 件来取代解释 器 开 销 大 的 for 循环 和 generator
json  json 编码 和解码 器
 源代码 libjsoninit
pyjson  javascript  object  notation 由 rfc 7159 which  obsoletesrfc 4627 和 ecma 404 指定 是 一个受 javascript 的 对象 字面 量 语法启 发的 轻 量级数据 交 换 格式 尽管它 不 仅仅是一 个 严 格 意 义 上的 javascript  的字 集1
json 提 供了 与标准 库 marshal 和 pickle 相 似的 api 接 口
对基 本 的 python  对 象层 次结 构 进行 编 码 import  json  json
getvalue  streaming  api  紧凑 编 码 import  json  json
dumps 1234567 separators 1234567美化 输出 import  json  printjson
dumps 4567 sortkeystrue  indent 44567 json 解码 import  json  json
loadio  streaming  api  特 殊 json  对象解 码 import  json  def  ascomplexdct 
1扩展 jsonencoder  import  json  class  complexencoderjson
0从 命令行 使用 json
tool  来 验证 并美化 输出 echo  jsonobj  python  m  json
tool  expecting  property  name  enclosed  in  double  quotes  line 1 column 2 char 1 详细文档请参 见 命令 行 界面
 注解 json 是 yaml 1
2 的一 个 子集
由该 模 块 的默 认设置 生成 的 json 尤其是默认 的 分隔 符 设置值 也是 yaml 1
1的 一个 子集
因此 该模 块 也能够 用于 序 列化为 yaml
 注解 这个模 块的 编码器和 解码 器默 认保 护 输入 和 输出 的顺 序
仅 当底 层的 容器 未排序 时才 会失去 顺序
 在 python 3
7之前 dict 并 不保 证 有序 因此输入 和 输出 通 常都是 乱序 的除非 是 明确地 请求 collections
ordereddict
从 python 3
7 开始普 通 的 dict 会 保留顺 序因此不 必 再为 json 的生 成 和解 析 指 定使 用 collections
ordereddict
基 本使 用
编码器和 解码器
 异常
jsondecodeerrormsg  doc  pos 拥 有 以下 附加 属 性 的 valueerror  的 子 类 msg 未 格式 化的 错误 消息
 doc 正 在解 析的 json 文 档
3
5 新版 功能
标准 符 合性 和互 操 作 性
json 格式 由 rfc 7159 和 ecma 404 指定
 此段落 详细 讲了这个模 块符 合 rfc  的级 别
 简单来 说 jsonencoder 和 jsondecoder 子 类 和 明确 提到 的参数 以外 的 参 数不 作 考虑
 此模块 不严 格 遵循 于 rfc  它实 现了 一些扩 展是 有效的 javascript  但 不是有效 的 json
尤其 是无 限和 nan 数 值是 被接 受 并 输 出 对 象内 的重复 名 称 是接 受 的并 且仅 使用最 后一 对 属 性 值 对 的值
 自 从 rfc  允 许符合 rfc  的语 法分 析 程序 接收 不符 合 rfc 的 输入 文本 以来这 个 模 块的 解串 器在 默认状态下 默认 符 合 rfc 
 字 符 编码
infinite 和 nan  数 值
rfc  不 允许 infinite 或 者 nan  数 值 的表达 方式
 尽 管 这样默 认情况 下此 模块接 受 并且 输出 infinity  infinity  和 nan  好 像 它 们是 有效 的 json 数 字 字 面 值 neither  of  these  calls  raises  an  exception  but  the  results  are  not  valid  json  json
loadsnan  nan 序 列化器中 allownan  参 数 可用 于替代这个 行 为
反 序列 化器中 parseconstant 参 数 可 用于替代 这个 行 为
 对象中 的 重 复名 称
rfc 具 体说 明 了在 json  对象里的 名 字应 该 是唯一的 但没 有 规 定如何 处理 json  对 象 中的重 复 名称
 默认 下 此模块不 引发 异常 作为替代 对 于 给定名 它 将忽略 除姓 值 对 之外 的 所 有对 weirdjson  x 1 x 2 x 3 json
顶级非对 象非数 组值
 过时 的 rfc 4627指 定 的旧 版 本 json  要求 json  文 本顶级 值必 须是 json  对 象或数 组 python  dict  或 list  并且 不能 是 json  null 值 布尔 值数 值或 者 字符 串 值
 rfc 7159移 除这 个限 制 此模块 没有并 且从未 在序列化 器和反 序 列 化器中 实 现 这 个 限制
无 论 如何为了 最 大 化 地获 取互操 作性 你 可 能 希望 自己遵 守该 原则
 实 现限 制
一 些 json 反序 列化 器的 实 现应该 在以 下方面 做出 限制 可 接受 的 json 文 本大小嵌 套 json 对象 和数组的最高 水平 json  数字的范围 和 精度 json  字符 串的内 容和 最 大 长 度 此 模块 不 强 制 执行 任何 上述 限制除了 相 关的 python  数据类型 本 身或 者 python 解 释器 本身的 限制 以外
当序 列 化为 json 在 应用中当 心此 类 限制 这 可能 破坏 你的 json 
 特别是 通 常 将 json 数字反序 列 化 为 ieee 754双 精度数字 从而受 到该表 示方式 的范 围和 精度 限制
这 是特 别 相 关的 当 序 列 化非 常 大的 python  int 值 时或 者 当 序 列化 exotic 数 值类 型 的实例 时 比 如 decimal
decimal 
命 令行界面
 源代码 libjsontool
 如 果未指定 可选 的 infile 和 outfile  参数则将 分别使用 sys
stdin  和 sys
stdout  echo  json  obj  python  m  json
tool  expecting  property  name  enclosed  in  double  quotes  line 1 column 2 char 1在3
5版更 改输出现 在将与输 入顺 序保持 一 致
请 使用 sortkeys 选项 来将 输出 按照 键的 字母 顺序 排 序
 命 令 行选项
infile  要被验 证或美化 打印的 json 文 件 python  m  json
json  title  and  now  for  something  completely  different  year 1971 title  monty  python  and  the  holy  grail  year 1975 如 果 infile 未 指定 则从 sys
stdin 读 取
outfile  将 infile  输出 写入 到给 定的 outfile
 在其 他情况 下写 入到 sys
sortkeys  将字 典输 出按 照 键 的字 母 顺序排 序
3
5新版 功能
noensureascii  禁 用非 ascii  字符的 转义 详情参 见 json
dumps
3
9 新版 功能
jsonlines  将每 个输 入 行 解析 为单独 的 json 对象
3
8 新版功 能
indent  tab  noindent  compact 用 于空 白符 控制的 互斥选项
3
9 新版功 能
h  help  显示帮助 消 息
 脚注1正如 rfc 7159的 勘 误表 所 说明的 json 允 许以 字 符串 表 示 字面 值 字符 u 2028 line  separator 和 u 2029 paragraph  separator  而 javascript 在 ecmascript 5
1 版中不允 许
keyword  检验 python 关 键字
源码 libkeyword
py  此 模 块允许 python  程序 确定 某个 字符 串 是否 为 关 键字
iskeywords  如 果 s 是 一个 python  关键 字 则返 回 true
kwlist 包 含解释 器定 义的所 有关 键字 的 序 列
如果 所定 义的 任何关 键 字 仅 在特 定 future  语 句生 效 时被 激 活 它们 也将 被 包含在 内
issoftkeywords  如果 s  是一 个 python 的 软关键字 则 返回 true
3
9 新版功能
softkwlist  包含解释 器定 义的 所 有 软关 键 字的 序 列
 如 果所 定义 的任 何软 关 键 字 仅 在 特定 future 语句 生 效时 被激 活它 们也 将被 包含在内
3
9 新版功 能
python 语 言 服务
python  提供 了许多 模 块 来帮助使 用 python  语 言
 这些 模块 支持 标 记 化、 解析、 语 法分析、字 节 码反 汇 编 以及 各种其 他 工 具
这 些模块 包 括 parser  访 问 python 解 析 树 创建 st  对象 转换 st  对 象 queries  on  st  objects  异 常和 错误 处 理 st  对象 示例 compile  的模拟 ast  抽 象 语法 树 抽象 文法节 点类字 面值 variables  表 达 式 subscripting  comprehensions  statements  imports  control  flow  function  and  class  definitions  async  and  await  ast  中的 辅助 函数 compiler  flags  commandline  usage  symtable  access  to  the  compilers  symbol  tables  generating  symbol  tables  examining  symbol  tables  symbol  与 python  解析树 一 起使 用的常量 token  与 python  解 析树 一 起使 用的 常量 keyword 检 验 python 关 键 字 tokenize  对 python  代 码使用 的标 记 解 析器 对 输入 进行解析 标 记 commandline  usage  示例 tabnanny  模糊 缩进检测 pyclbr  python  模块 浏览器支 持 function 对象 class 对 象 pycompile 编译 python 源 文件 compileall  bytecompile  python  libraries  commandline  use  public  functions  dis  python  字 节 码 反 汇编器字 节码 分析 分析函数 python  字节 码说 明 操作 码集合 pickletools  pickle  开 发者工具 集 命令 行 语 法命令 行 选项 编程 接口
linecache 随 机读 写 文 本行
locale 国 际 化服 务
background  details  hints  tips  and  caveats
for  extension  writers  and  programs  that  embed  python
access  to  message  catalogs
loggingconfig 日 志 记录 配置
 源 代码 libloggingconfig
pyimportant  此页 面仅 包 含参 考信 息
有 关教 程请 参阅 基础教程 进阶教 程日 志 操 作手 册这一 节 描 述了 用于 配 置 logging 模 块的 api
配置函 数
配 置字 典 架 构
 描 述 日志记 录配置需 要列 出要创 建 的不 同对象及 它们 之间 的连接 例如你 可以创 建一 个名为 console 的 处 理 程 序 然后名 为 startup 的日 志记录器 将可以 把它 的消息 发送 给 console 处理程 序
 这些 对象并 不 仅限 于 logging 模块 所 提 供 的 对 象因为你 还可以 编 写你自己 的格式 化或 处理程 序类
这 些 类的 形参可 能还需 要包括 sys
stderr  这样 的外 部对 象
描述 这些 对象 和 连接的 语 法会 在 下面 的对象连 接中定义
 字 典架构 细节
传 给 dictconfig  的字典必 须 包含 以 下 的 键 version 应 设为 代 表 架构版 本的 整数 值
目 前唯 一有效的 值 是1使用此键可允 许架 构在继 续 演化的同 时保 持向下 兼 容 性
所 有 其他 键都 是可 选 项但如存 在 它 们将 根 据下面 的 描 述来 解 读
在下 面提 到 configuring  dict 的所 有情 况下都 将检查 它的特 殊 键以确定是否 需要自 定 义实例 化
如 果需 要则会 使用 下 面用户 定义 对象 所描 述的机 制 来创 建一 个 实 例否则 会使 用上 下 文来 确定 要 实例 化的 对 象
 formatters  对 应的 值将 是一 个字 典 其 中每 个 键是 一个 格式器 id  而 每个 值则是 一个 描述 如 何配 置相 应 formatter 实 例的 字典
 将在 配 置 字 典 中搜索 键 format 和 datefmt 默认值均 为 none  并且 这些 键 会 被 用于构 造 formatter  实例
在3
8版 更 改一 个 validate 键默 认 值为 true  可被 添 加到 配置字 典的 formatters 部 分 这 会被用 来 验 证格式 的 有效性
 filters  对 应的 值 将是 一 个字典 其 中每 个键是 一个 过滤 器 id  而每 个值则 是一 个描述 如 何配置 相应 filter  实例 的字 典
 将在 配置 字 典中搜索 键 name  默认 值 为空 字 符串并 且该键 会被 用于 构 造 logging
filter 实 例
 handlers  对应的 值将 是 一个字 典 其中 每 个 键 是 一个处 理程 序 id 而 每个值 则 是一个描 述如何 配置 相 应 handler 实 例 的字典
 将在 配置字 典 中 搜索下列 键 class  强制
这 是处 理程 序 类的 完整限 定名 称
 level 可 选
 处 理 程 序 的级别
 formatter  可选
 处 理 程 序所对 应格 式化 器的 id
 filters  可选
由处 理程序 所对应 过滤 器 的 id  组成的列 表
所 有其 他键 会被作为 关键字参 数 传递 给处 理 程 序 类的构造 器
 例如 给 定如 下配置 handlers  console  class  logging
log  maxbytes 1024 backupcount 3 id  为 console 的 处理 程序会被 实例化 为 logging
streamhandler 并 使 用 sys
stdout  作 为下 层 流
 id 为 file  的处 理程序会 被 实 例化 为 logging
rotatingfilehandler  并附带 关键 字参 数 filenamelogconfig
 loggers 对应 的 值将是一 个 字典 其中 每 个 键 是一个日 志 记录 器 名称 而每 个值 则 是一 个描 述如何 配置相 应 logger 实 例的字 典
 将在 配置字 典 中 搜 索下列 键 level 可选
 日 志 记录 器的 级 别
 propagate 可 选
日 志 记录 器 的传 播设 置
 filters 可 选
由日 志 记录器对 应过 滤 器 的 id 组 成 的列 表
 handlers 可选
 由日志记 录器对应 处理程序 的 id 组成的 列表
 指定 的日 志 记录器将 根 据 指定的级别、 传播、过滤器 和处理程 序来配置
 root  这 将成为根 日 志 记录器 对应 的配 置
 配 置的 处 理 方式 将与 所 有 日 志记 录器 一 致 除了 propagate 设置 将不可 用之 外
 incremental  配 置是否 要被 解读 为 在 现 有配置 上新增
该值默 认为 false  这 意 味 着指 定 的配置将 以与当 前 fileconfig  api 所 使用 的 相 同语 义来替代现 有的 配 置
 如果 指 定的 值 为 true 配 置会 按照 增 量 配置 部分所描述 的方 式 来 处理
 disableexistingloggers  是 否要 禁用 任何现 有 的 非根日 志记录 器
该 设 置 对 应于 fileconfig  中的 同名 形参
 如 果 省 略则 此 形参 默认为 true
 如 果 incremental  为 true 则 该省 会 被 忽 略
增 量配 置
 为增量 配置提 供完全 的灵 活 性 是 很困难 的
例如由于 过滤 器和格式 化器这样 的对 象 是匿 名 的一 旦完 成 配置在 增 加配 置时就 不 可能 引 用这些匿 名 对象
此外 一 旦 完成了 配置 在运 行 时 任意 改 变日 志记录器、 处理 程 序、 过滤器、 格 式 化 器的对 象 图就 不 是 很 有必要 日 志记 录器和 处 理程序 的详 细程 度 只 需通 过 设置级 别即 可实现 控制 对 于日志 记录器则 可 设置传 播旗标
 在多 线程 环 境中 以安 全 的方式 任 意 改变 对象图 也 许会导致 问 题 虽 然 并非不 可能 但 这样 做 的好处 不足以 抵销其所 增 加的 实 现复杂 度
这样 当配 置字典 的 incremental  键 存 在 且为 true 时系 统将 完全忽略任何 formatters  和 filters  条目 并仅会 处 理 handlers  条目 中的 level  设 置 以及 loggers  和 root  条 目 中的 level  和 propagate  设 置
使 用 配 置 字典 中 的值 可让 配置以 封存 字 典 对 象 的形 式 通 过 线 路 传 送 给 套 接 字 监 听器
这样 长 时 间运 行 的应用程 序的日 志 记录 的 详 细程度可 随时间 改变而 无 须 停 止 并重 新启 动 应用 程 序
对 象连接
 用户定义 对象
 此 架 构支 持 用户定义 对象作 为 处理 程 序、 过滤器和 格式化 器
日 志记 录 器的 不 同实 例不需 要具有不 同类 型因 此这 个配置架构 并不 支 持 用户定 义日 志 记 录 器类
 要配置 的对象 是 由 字典 描述的 其 中 包 含 它们的 配 置 详情
 在某 些 地方日 志记录系统 将 能 够 从 上下 文中 推 断出如 何 实例化 一个 对 象但 是当 要实例 化一个 用 户自定 义对象 时系 统将不 知道 要如 何做
 为了 提 供 用户自 定 义 对 象 实 例化 的 完 全 灵 活 性用 户需要 提供 一 个‘ 工厂’函 数——即在 调 用 时传入 配置字 典 并 返回实例 化 对 象 的 可 调用 对 象
这 是 用 一 个 通过 特殊键 来 访问的 工厂函 数 的 绝对 导入 路径 来标 示 的
 下面 是一个实 际 的例 子 formatters  brief  format  messages  default  format  asctimes  levelname 8 s  name 15 s  messages  datefmt  ymd  hms  custom  my
9 answer 42上 面 的 yaml 代 码片段 定 义了 三个 格 式 化器
 第 一个 的 id 为 brief 是带 有特殊 格式 字符 串 的 标准 logging
formatter 实 例
第 二 个的 id 为 default  具有更 长的格式 同 时 还 显 式地 定义了 时 间 格 式 并将最终 实 例 化一 个 带有 这两 个格式 字符串 的 logging
formatter
 以 python 源 代码形 式显 示 的 brief  和 default 格 式化 器 分 别 具有下 列配 置 子字 典 format  messages 和 format  asctimes  levelname 8 s  name 15 s  messages  datefmt  ymd  hms  并 且由 于这些字 典不包 含 特殊 键实例化方 式是 从 上下 文中 推 断出 来 的结 果 会创 建 标准 的 logging
formatter  实 例
第三 个格 式器的 id  为 custom  对 应 配置 子字 典为 my
9 answer 42 并且 它 包 含 特 殊键 这 意 味 着需 要 用 户 自 定 义 实 例 化方式
 在此 情 况 下将 使 用指 定的 工厂可 调用对象
如果它 本身 就是 一个 可调 用 对 象则 将被直 接使 用——否 则 如 果你 指定 了 一 个字 符串 如 这个 例子 所示则将 使 用 正 常的 导 入机 制 来定 位实 例的 可调 用对 象
调用该 可调 用对 象将 传 入配 置子 字 典中 剩余 的 条 目 作为 关 键 字参数
 在上 面 的例 子 中调用 将 预期返 回 id  为 custom 的格 式化器 my
9 answer 42将用 作 特殊键 是因 为 它不是 一个有效 的 关键字 形 参名称 这样 就不会与 调 用中使 用的 关键字参 数发生冲 突
还被 用作表 明对 应值为 可调用对 象 的助 记符
访 问外部对 象
访问内部 对象
除了外 部 对象 有时 还需 要 引用 配 置中 的对象
 这 将由配 置系统 针对 它 所 了解 的 内容 隐式地 完成
 例如 在日 志记 录器或处 理程 序中 表 示 level  的 字符 串 值 debug 将 被自 动转换 为值 logging
debug  而 handlersfilters 和 formatter  条 目将 接受一个对 象 id  并解 析为 适当 的目 标对 象
但是 对于 logging 模 块所不了 解的 用户 自定义 对象则需 要一种 更通用 的 机制
 例如考 虑 logging
memoryhandler  它接受 一个 target  参数 即 其所 委 托 的另 一个 处理 程序
 由于 系统 已经 知 道存 在 该类 因 而在 配置 中给 定的 target  只需为 相 应目 标处理 程 序的的 对象 id  即可 而 系统 将 根 据该 id  解析 出处 理程 序
但 是如 果用 户 定义 了 一个 具 有 alternate 处 理程 序的 my
myhandler 则配 置 程序 将不 知道 alternate 指 向的 是一 个处理程 序
 为了 应对 这种情 况 通 用解 析系统允 许用户 指定 handlers  file  configuration  of  file  handler  goes  here  custom  my
file 字 符串 字面值 cfghandlers
file  将 按照与 ext  前缀 类似 的方 式 被解析为 结 果字 符串 但查 找操 作是 在配置 自 身而不 是 在 导 入 命 名空间 中 进 行
 该机制 允许 按点 号或 按索 引来访 问 与 str
format 所 提供的 方式 类似
 这样给 定以 下 代码段 handlers  email  class  logging
 在该 配 置 中字符 串 cfghandlers 将解 析 为带 有 handlers 键 的字典字 符串 cfghandlers
email 将 解析 为 handlers  字 典中 带有 email  键的 字典 依此类推
 字 符串 cfghandlers
toaddrs 1将 解 析为 devteam
tld  而 字 符串 cfghandlers
toaddrs 0 将解 析 为值 supportteamdomain
 subject 值 可以 使 用 cfghandlers
subject 或 者等价 的 cfghandlers
emailsubject 来访问
 后一种 形式仅 在 键包含空 格 或非字 母 数字 类字符 的情 况下 才 需要 使 用
 如果 一 个 索引仅 由十进 制 数码 构成 则将 尝 试使用 相应 的 整数 值 来访 问如果有 必要则 将回退 为字符 串值
给 定 字符串 cfghandlers
123 这将 解 析为 configdicthandlersmyhandlermykey 123
 如 果字 符串 被指定为 cfghandlers
mykey 123 系统 将尝试从 configdicthandlersmyhandlermykey 123 中 提取 值 并在 尝试失 败时回退 为 configdicthandlersmyhandlermykey 123
导入 解 析与定 制 导入 器
导入 解析默 认使 用内置 的 import 函 数来 执 行导 入
你 可 能想 要 将其 替换 为你 自己的 导入 机制 如 果是 这 样 的话 你 可 以替 换 dictconfigurator  或其 超 类 baseconfigurator  类的 importer  属性
 但 是 你必 须小心 谨 慎因为函数是 从类中 通过描 述 器方 式来 访问 的
如果 你使 用 python 可 调用对 象来 执行 导入并 且 你希 望在类 层级 而 不是 在实 例层 级上定 义它 则你 需要用 staticmethod  来装 饰 它
例 如 from  importlib  import  importmodule  from  logging
importer  staticmethodimportmodule  如果你 是在一 个 配 置 器的 实例 上 设置导 入可 调用对 象则你不 需 要用 staticmethod  来装 饰
配 置文 件 格式
logginghandlers  日 志 处 理 程序
源代 码 liblogginghandlers
pyimportant 此 页面 仅包 含参 考信 息
有关 教程请 参 阅 基础教 程进阶 教 程日 志记 录操 作手册这 个包提 供 了以下 有 用的处 理 程序
 请注 意有三个 处 理程 序 类 streamhandler  filehandler  和 nullhandler 实 际 上 是 在 logging  模块 本 身定义 的但 其文档 与其 他处 理程 序 一同 记录在 此
streamhandler
streamhandler 类 位 于 核心 logging  包它可 将日志记 录输出 发 送 到数 据流例 如 sys
stderr 或 任何 文 件 类 对 象 或者 更精确 地说任何 支 持 write  和 flush 方 法的 对象
streamhandlerstreamnone  返回 一个新的 streamhandler  类
 如 果指 定 了 stream 则实例 将用 它 作 为 日 志记 录 输 出 在其 他情况 下 将使 用 sys
stderr
 emitrecord 如 果 指定了 一个 格 式 化 器它会 被 用 来 格式 化 记录
随 后记录 会被 写 入 到 terminator  之后 的 流 中
 如果 存在异 常 信息则 会使用 traceback
printexception 来 格式 化 并添加 到 流 中
 flush  通过 调用 流 的 flush 方 法 来刷 新 它
 请注意 close  方 法是继 承自 handler 的所 以没 有 输出因 此 有 时可能 需 要显式 地调用 flush
 setstreamstream 将 实 例的流设 为指 定值如 果两者 不 一 致的话
旧 的 流会在设 置新 的流之 前被刷 新
 参 数 stream 处理程 序 应当使用 的流
 返回旧 的流如 果 流 已被 改变 的话 如果 未 被改变 则 为 none
3
7 新 版 功 能
 terminator  当 将已格式化 的 记录 写入到 流 时被 用 作 终 止符 的字 符 串
默 认 值 为 n
 如果 你不希望 以换 行 符 终止 你 可 以将处 理 程 序 类实 例的 terminator 属 性设 为 空 字 符串
在 较早 的版 本中 终止 符被 硬编 码为 n
3
2新 版 功能
filehandler
filehandler  类位 于 核心 logging 包 它 可将 日志 记录输出 到磁 盘文 件 中
它 从 streamhandler 继承 了输 出功能
filehandlerfilename  modea  encodingnone  delayfalse  errorsnone  返 回 一个 filehandler 类 的新 实 例
 将打 开指 定的文 件并 将 其 用 作日 志 记 录流
如 果未 指定 mode  则会 使用 a
如 果 encoding 不 为 none 则会 将 其用作 打 开 文 件的 编码格 式
 如果 delay  为 真值 则文件 打 开会 被 推迟 至第 一 次调 用 emit  时
默 认 情况下 文件 会无限 增长
如 果指定 了 errors 它会 被用于确 定编 码格 式 错 误的 处 理方 式
在3
6版 更改 除 了 字 符串 值也 接 受 path  对 象 作 为 filename 参数
 在3
9版 更改 增加 了 errors 形 参
 close  关 闭文 件
 emitrecord 将记 录 输 出 到 文 件
nullhandler
3
1 新版功能
nullhandler  类位 于核 心 logging  包它 不 执 行任何 格 式 化或输出
 它 实际上是 一个 供库开 发者 使 用的‘ 无操 作’处 理程序
nullhandler  返回一个 nullhandler  类的新 实例
 emitrecord 此方法 不执行任 何操 作
 handlerecord  此 方 法不 执 行任 何操 作
 createlock  此方法 会对锁返回 none  因为 没有 下 层 io  的 访 问需 要 被序 列 化
请参 阅 配置库的 日 志 记 录 了 解 有 关 如 何 使用 nullhandler  的 更多 信息
watchedfilehandler
watchedfilehandler 类 位于 logging
handlers  模块 这个 filehandler 用于 监视 它 所 写 入日 志记 录的 文 件
如 果文 件发生 变化 它 会 被关 闭并 使 用 文件 名重新 打 开
 发 生 文 件更改可 能 是由 于 使用 了执 行 文件 轮 换 的 程序例 如 newsyslog  和 logrotate
 这个 处理 程序在 unixlinux  下使 用 它会 监 视 文 件 来查 看自 上 次发 出数 据 后是 否有 更改
 如果 文 件的 设备 或 inode  发生 变化 就认 为 已被 更 改
如 果 文 件被 更改 则 会关 闭旧文 件流并再 打开 文件 以获 得 新文 件流
 这个处理 程 序不 适合在 windows  下 使用 因 为在 windows  下 打开 的日志文 件 无法 被 移动或改 名——日 志记录 会 使用 排 他 的锁来 打 开 文件—— 因此 这样 的处 理程序 是没有必 要 的
 此外 stino 在 windows  下不 受支 持 stat 将 总是 为该 值 返回 零
watchedfilehandlerfilename  modea  encodingnone  delayfalse  errorsnone 返 回一 个 watchedfilehandler 类 的新 实 例
 将打 开 指 定的文 件并将 其用作日 志记 录流
 如果 未指定 mode  则 会 使用 a
 如果 encoding  不为 none  则会 将其用作打 开 文件的 编码格 式
 如果 delay  为真 值则 文件打 开会 被推 迟至第一 次调 用 emit 时
 默认 情 况下 文件 会无 限增 长
如 果提供了 errors  它 会 被 用 于 确定 编码 格式 错 误 的处理方 式
在3
6 版 更改 除了 字符 串值 也 接受 path  对象 作为 filename  参数
 在3
9 版更 改增 加了 errors 形参
 reopenifneeded 检 查文件 是否 已更改
 如果已更 改则会 刷新 并关 闭现 有流 然后重 新打 开文 件这通常 是将 记录输 出 到文件 的先 导 操作
3
6 新版 功能
 emitrecord  将 记 录 输出到 文 件但 如 果 文 件 已 更 改 则会 先调 用 reopenifneeded  来重 新打 开它
baserotatinghandler
rotatingfilehandler
timedrotatingfilehandler
sockethandler
sockethandler  类 位于 logging
handlers  模 块它 会 将日 志记 录输 出 发送 到 网络 套接 字
基 类 所使用 的 是 tcp  套接 字
sockethandlerhost  port 返回 一个 sockethandler  类的 新 实例 该实 例旨 在与 使 用 host 与 port  给定地址 的远程 主机 进 行通 信
 在3
4版 更 改如 果 port 指 定为 none  会使 用 host 中 的值 来 创建一个 unix 域 套接 字——在其 他情况 下则 会创建一 个 tcp  套接 字
 close 关 闭套接字
 emit  对记 录的 属性 字典 执行 封存 并 以二 进制 格式 将 其写入 套接 字
如果 套接 字存 在错 误 则静 默地 丢弃 数据 包
如 果连 接 在 此之 前丢 失则 重新 建 立 连接
 要在接 收端将记 录 解 封并 输 出 到 logrecord 请 使用 makelogrecord  函数
 handleerror  处理 在 emit 期 间发 生的错误
最 可能 的原 因是 连接 丢失
 关 闭套接字以 便我 们 能在下 次事 件时 重新 尝试
 makesocket  这 是一 个 工厂 方 法它 允 许 子 类定 义它 们想 要的 套接 字的 准确类型
默 认实 现 会 创建一个 tcp  套接 字 socket
 makepicklerecord 将 记录 的属 性 字 典封 存 为带 有长 度 前缀 的 二 进 制 格式并 将 其 返回 以准 备通过 套 接 字进行 传 输
 此操作 在细 节上 相当 于 data  pickle
packl  lendata  return  datalen  data 请 注意 封 存 操作不 是 绝 对 安 全 的
如 果 你关 心安 全问 题你 可能 会想 要重 载此 方法 以实现 更 安全的 机 制
例如你 可 以使用 hmac  对封存对 象进行签 名然 后在接收端 验证 它 们或者 你也可以 在接收端 禁用 全局对象 的 解封操 作
 sendpacket 将封存 后的字节 串 packet 发 送到套接 字
 所发送 字节 串的 格式 与 makepickle 文 档中的描 述一 致
此 函数 允许部分 发送 这可 能会 在网 络 繁忙 时发生
 createsocket  尝 试 创建 一 个套接 字失败时 将使 用指 数化回退 算法处理
 在失败初 次发生时 处理 程序将丢 弃它正尝 试发 送 的消息
 当后续消 息交由同 一实例处 理时它将 不会尝试 连接直到 经过 一 段时间 以后
 默认 形参设置 为 初始延 迟一 秒如 果在延 迟之 后 连 接仍 然无 法建立处 理程 序将每次 把延 迟翻 倍直 至达到30秒的 最大 值
此 行为 由下 列处理程 序属 性控 制 retrystart  初始 延迟 默认 为1
0秒
 retryfactor  倍数 默 认为2
 retrymax 最大 延迟 默认 为30
0秒
这意 味着如果远程 监听器在 处理 程序 被使用之后启 动 你可 能会丢失消息 因为处 理程 序在 延迟 结 束 之前 甚至 不会 尝 试 连接 而在延迟期 间静 默地 丢 弃 消息
datagramhandler
datagramhandler  类位于 logging
handlers 模 块它 继承自 sockethandler 支 持通 过 udp 套接字 发送 日志 记录消息
datagramhandlerhost  port  返回一个 datagramhandler  类的 新实 例该实例 旨在与 使用 host  与 port 给 定地址的远 程主 机 进 行 通信
 在3
4版更改 如果 port  指定 为 none 会 使用 host  中的 值来创建 一 个 unix  域套 接字—— 在其 他情况下则 会创 建一个 udp  套接 字
 emit 对 记录 的属性字 典 执行 封存 并以 二进制格 式将 其写 入 套 接字
如 果 套接 字存在 错 误 则 静 默地 丢弃 数据 包
要 在接收 端将 记 录 解 封并输出 到 logrecord 请 使 用 makelogrecord 函 数
 makesocket  sockethandler  的 工厂 方法 会在 此被 重载以 创 建 一个 udp  套接 字 socket
 sends 将 封存 后的字 节 串发 送到 套接 字
 所 发送 字 节 串的 格 式与 sockethandler
makepickle 文档 中的 描述一致
sysloghandler
sysloghandler  类位 于 logging
handlers 模块它 支持 将日志记 录消 息 发送 到 远 程或本地 unix  syslog
sockdgram  返回 一 个 sysloghandler 类 的新 实例 用来 与通 过 address 以 host  port  元组 形 式给 出 地址 的 远程 unix  机器 进 行 通讯
 如果 未 指定 address  则 使 用 localhost 514
 该地 址会 被 用于 打 开 套接字
 提 供 host  port 元 组的 一 种替 代方 式 是提 供字符 串 形式 的地 址 例如 devlog
 在这种情 况下 会使 用 unix 域 套接 字将 消息 发 送到 syslog 
 如果未指定 facility 则 使用 loguser
打 开 的套 接字 类 型取 决于 socktype 参数该参 数的默 认 值为 socket
sockdgram  即打 开 一个 udp  套接字
要打开 一 个 tcp  套 接 字用 来配 合 较新 的 syslog 守护程序例 如 rsyslog  使 用 请 指定 值为 socket
 请 注意如果 你的 服务器不 是在 udp  端 口514上 进行侦听 则 sysloghandler 可能 无 法 正常 工作
在 这 种情 况下 请 检 查你 应当为 域套接字 所使 用的地址——它 依赖 于具体的 系统
例如在 linux  上通 常为 devlog  而在 osx 上则为 varrunsyslog
 你需 要检查你的 系统 平台 并使 用 适当 的地 址如 果你的 应用 程 序需 要在 多个 平台上运行则 可能 需要 在运 行时 进行 这样 的检 查
在 windows 上 你 大概 必须 要使 用 udp 选 项
在3
2 版更 改添加了 socktype
 close  关闭 连接 远 程主 机的套接 字
 emitrecord 记录 会被格 式化 然 后 发送 到 syslog  服务器
如 果存在 异常信 息 则它 不 会 被发 送 到服务器
 在3
1 版更 改参见 bpo 12168
 在较 早的版 本中 发送至 syslog 守 护程序 的消息总 是以 一 个 nul 字 节结 束 因 为守 护 程 序的 早期版 本 期望 接 收一 个以 nul  结束的 消息——即使 它不包 含于对应 的规 范 说明 rfc 5424
 这些守 护程 序 的较新版 本 不再 期望 接 收 nul 字 节如 果其 存在则会 将其去 除而 最新的 守 护 程序 更紧 密地 遵循 rfc 5424会将 nul  字 节作为 消息 的 一部分传 递出 去
为 了在面对 所有这 些不 同守护程 序行为时 能够 更方 便 地处 理 syslog  消 息通 过使 用 类层 级属 性 appendnul 添 加 nul 字节的 操作 已被 作为 可配 置项
 该属 性默 认为 true 保留 现 有 行为 但可 在 sysloghandler 实例上 设为 false  以 便让 实例 不会 添 加 nul 结 束符
在3
3版 更改 参 见 bpo 12419
在 较早 的版本中 没有 ident  或 tag 前缀工具 可以用 来标 识消 息的 来源
 现在则可 以使用一 个类 层 级属 性来 设 置它该 属性 默认为表 示保 留现有 行 为 但可在 sysloghandler 实 例上 重载 以便 让实 例不 会 为 所 处 理的每条 消 息添 加标识
 请 注意 所提供 的 标识 必 须 为 文本 而 非 字节 串 并且它 会 被原封 不 动 地 添加 到消息 中
 encodepriorityfacility  priority 将功 能和优 先级 编码 为一个整 数
你 可以传 入字 符串或者 整 数——如果传 入的是字符 串则 会使用内 部的 映 射字 典 将其转换为 整数
 符 号 log  的值在 sysloghandler 中定 义并 且 是 syssyslog
h 头文件中 所定义值 的 镜像
 优先 级名称 字符串符 号值 alert  logalert  crit 或 critical  logcrit  debug  logdebug  emerg  或 panic  logemerg  err 或 error  logerr  info  loginfo  notice  lognotice  warn 或 warning  logwarning  设备名称 字 符串符 号值 auth  logauth  authpriv  logauthpriv  cron  logcron  daemon  logdaemon  ftp  logftp  kern  logkern  lpr  loglpr  mail  logmail  news  lognews  syslog  logsyslog  user  loguser  uucp  loguucp  local 0 loglocal 0 local 1 loglocal 1 local 2 loglocal 2 local 3 loglocal 3 local 4 loglocal 4 local 5 loglocal 5 local 6 loglocal 6 local 7 loglocal 7 mapprioritylevelname  将日志 记录 级 别名称 映射 到 syslog 优先级 名 称
 如 果你使 用自定义级 别或 者 如 果 默 认算 法不适 合你 的需 要你 可 能需要重 载此方法
 默认 算法 将 debug  info  warning  error  和 critical 映射 到等价的 syslog  名称 并将 所有 其他 级别 名 称映 射 到 warning
nteventloghandler
nteventloghandler 类 位于 logging
handlers  模 块 它 支 持 将日志记 录 消 息发 送到本 地 windows  nt  windows 2000 或 windows  xp 事 件日 志
 在 你使 用它之 前你 需 要 安装 mark  hammond  的 python  win 32扩展
nteventloghandlerappname  dllnamenone  logtypeapplication 返回 一 个 nteventloghandler 类的 新实 例
 appname  用来定义出 现在事件日 志 中的应 用名 称
 将 使 用此名 称创 建 适当的注 册 表 条 目
 dllname 应当给 出 要包含 在 日志 中 的消 息定 义的
dll 或
exe 的完 整 限定 路 径名 称 如未 指 定则 会使用 win 32 service
pyd ——此 文 件随 win 32 扩 展安 装且 包 含一些基 本的 消 息定义占 位 符
 请注 意使 用 这些 占 位符 将使你 的事件 日 志变得 很大 因 为整个 消息 源都 会被 放 入日 志
如 果你 希望 有较 小 的日 志 你 必须 自行传 入 包 含你想 要 在 事件日 志 中使 用的 消息 定 义 的
dll 或
exe  名称
 logtype  为 application  system 或 security 之 一 且 默 认 值 为 application
 close 这 时 你 就 可 以从 注册 表中移除 作 为 事 件日志 条目 来源 的应 用名称
但 是如 果 你这样 做你 将无 法 如你所预 期的 那样 在 事件 日志查 看器 中 看到 这 些事 件——它 必须能 访问 注册表 来获 取
dll  名 称
 当前 版本并 不 会这 样做
 emitrecord 确 定消 息 id  事件 类 别 和事 件 类型 然后 将消息 记录 到 nt 事 件 日志 中
 geteventcategoryrecord  返 回记录 的事件 类别
 如果 你 希望指 定你 自己 的 类 别 就 要 重载 此方法
 此 版 本将 返回0
 geteventtyperecord  返回记 录的事 件类 型
如 果你 希 望指 定你 自 己 的类 型就要 重载 此方 法
 此版 本 将使 用 处理 程序的 typemap  属性来 执行 映射 该 属性 在 init 被 设 置 为 一 个字 典其中 包 含 debug  info  warning  error 和 critical  的映 射
如 果你 使 用 你自 己 的级别 你将需 要重 载 此方 法或 者 在 处理程 序的 typemap 属 性中 放置一 个合 适 的字典
 getmessageidrecord  返回记 录的 消 息 id
如 果 你 使用你 自己 的消息 你可 以 通过 将 msg  传给 日志 记录 器 作为 id 而 非 格式 字符 串 实现 此功能
 然后 你可以 在这 里使用字 典查 找来 获取 消息 id
 此版 本将 返回1 是 win 32 service
pyd  中的 基 本消 息 id
smtphandler
smtphandler 类 位于 logging
handlers  模块 它支持 将 日 志记录 消 息通 过 smtp 发送 到一 个电 子 邮 件 地址
0返 回 一个 smtphandler  类的新 实例
 该实 例 使用 电 子 邮件 的 发件人、收 件人地 址和 主题 行进 行初 始 化
 toaddrs 应 当为字 符串列表
要 指 定 一个 非标 准 smtp 端 口 请使 用 host  port 元组 格式 作为 mailhost  参数
 如 果你 使 用 一个 字符 串则 会使 用 标准 smtp  端口
如果 你的 smtp 服务器要 求 验证你 可以指 定 一个 username  password  元组 作为 credentials  参数
要 指定使 用安全 协议 tls 请传 入 一个元 组 作为 secure 参 数
这将仅在 提供了 验证 凭据时 才能 被 使 用
元组 应当或是一 个空元 组或是一 个包 含 密钥 文件名 的单值元 组 或 是 一个 包含 密钥 文件和证 书文 件 的2 值元 组
此 元 组会 被 传给 smtplib
starttls 方法
 可以使 用 timeout 参 数 为与 smtp  服务器 的通信 指 定 超时 限制
3
3 新版功能增加 了 timeout  参数
 emitrecord  对记录 执 行 格式 化 并将其发 送到 指定 的地 址
 getsubjectrecord 如果 你 想 要指定 一个 基 于记录的 主题行 请重 载此 方 法
memoryhandler
memoryhandler  类位 于 logging
handlers  模块 它 支持 在内存 中缓 冲日 志 记录并 定 期将 其刷新 到 target 处理 程序 中
 刷 新会 在缓 冲区满的 时 候或是 在遇 到特定或 更高 严重 程度 事件 的 时候 发 生
memoryhandler  是 更 通用 的 bufferinghandler 的子类后 者 属 于 抽 象 类
 它会 在内存 中缓 冲日 志 记 录
 当每 条记 录 被添加 到缓 冲区时 会通 过调用 shouldflush  来检查缓冲区是 否应 当刷 新
 如果 应 当 刷新 则要使 用 flush  来执 行刷新
bufferinghandlercapacity 使 用指 定容量的 缓冲 区 初始化 处 理 程 序
这 里 capacity 是指 缓 冲的 日志记录 数 量
 emitrecord 将 记录添 加到 缓 冲区
如 果 shouldflush 返 回真值 则会 调用 flush 来 处 理缓 冲区
 flush  你可 以重 载 此方 法来 实 现 自定 义 的 刷新行为
此 版本只 是将 缓 冲区清 空
 shouldflushrecord 如 果缓冲区 容 量已 满 则 返 回 true
可 以重 载此方 法以 实现自定 义的 刷新 策略
memoryhandlercapacity  flushlevelerror  targetnone  flushonclosetrue 返回 一个 memoryhandler 类 的新 实例
该 实例 使用 capacity 指 定 的缓 冲区 大小 要缓 冲 的记 录数 量 来 初始 化
 如 果 flushlevel 未指定则 使用 error
如 果未 指 定 target 则需 要在 此处 理 程 序执 行 任何 实际 操 作之 前使 用 settarget  来 设置 目 标
 如果 flushonclose 指定为 false  则当处 理程 序 被关闭 时不 会刷 新缓 冲 区
 如果未指定或指 定为 true  则 当处理程 序被 关闭时 将 会发生之前 的缓冲 区刷新 行为
在3
6版更改增加 了 flushonclose 形 参
 close 调 用 flush 设置 目 标为 none 并 清空缓 冲 区
 flush 对 于 memoryhandler 刷新是指 将缓 冲的 记录 发送 到目 标如 果 存在 目 标的话
 当此行 为 发 生时 缓冲 区 也将被清 空
 如 果你 想要 不同的 行为请 重载此 方法
 settargettarget  设置 此处理 程序 的目 标 处 理程序
 shouldflushrecord  检测 缓冲 区是否 已满 或是有 记录为 flushlevel  或更 高级 别
httphandler
queuehandler
queuelistener
3
2新 版功能
queuelistener 类 位于 logging
handlers 模 块它 支 持从一个队 列接 收日 志记 录 消 息 例 如在 queue 或 multiprocessing  模块 中实 现 的 队列
 消息 是在 内部线 程中 从队 列 接 收 并在 同 一线程上 传递 到一 个 或多 个处 理程 序进 行处 理 的
尽 管 queuelistener  本身 并 不 是 一个 处理 程序 但由 于它 要与 queuehandler 配合工 作因 此也 在此 处 介 绍
配 合 queuehandler 类使 用 queuelistener 可用 来 使 处理程序 在与执行 日志记 录的 线 程 不同 的 线程 上完 成工 作
这 对 web  应用 程序 以及其他 服务与 客 户端 的 线程 需要 尽可 能 快地 响应 的 服务应 用程序来 说很 重要任何 潜在的慢速 动作例 如通 过 smtphandler 发 送邮件 都 要在单独的 线程上 完 成
queuelistenerqueue  handlers  respecthandlerlevelfalse 返 回 一 个 queuelistener 类 的新 实例
该 实 例初 始化 时要传 入一 个队 列以 向其发 送 消息 还 要传 入 一个处 理程序列 表用 来处理 放 置在 队列中 的条 目
队 列可 以是 任何队列类 对 象它会 被原 样传 给 dequeue  方法 该方 法需要 知道 如何 从 其获 取消 息
 队列 不要 求具 有任 务跟 踪 api 但如 提 供则 会使 用 它这 意味着你 可以为 queue  使 用 simplequeue 实例
如 果 respecthandlerlevel 为 true  则 在 决定是否 将消 息传 递给处 理程 序之 前会 遵 循 处 理 程 序 的级 别与消 息的 级别 进行 比较 在 其他 情况下其 行为与之 前的 python 版本 一致—— 总是 将 每条消息 传递 给每个处 理程序
 在3
5版 更改 增 加 了 respecthandlerlevel  参数
 dequeueblock  从队 列 移 出一条 记 录并 将 其返回可 以 选择阻 塞
基 本实现使 用 get
如 果你 想 要使用超 时设 置或自定 义的队 列实 现则你可 能会 想要 重 载此方法
 preparerecord  准备一 条要处 理的记 录
该 实现 只是返回传 入 的 记录
 如 果 你 想要 对 记录执 行 任何自定 义 的 marshal 操作 或 在 将其传给处 理 程序之 前进 行调 整则 你可能会 想要重 载此方法
 handlerecord 处 理一 条 记 录
 此方 法简单 地 循 环遍历处理程 序向 它们提 供 要处 理 的记录
实 际传给处 理程序的 对象就是 从 prepare 返回的 对象
 start  启动监听器
 此 方法 启动 一个 后 台 线 程来 监视 logrecords 队列 以进行处 理
 stop 停止监 听器
此方 法要求 线程终 止然 后等 待它完成 终 止操 作
请注 意在 你的 应用 程 序退出 之前 如果 你 没有 调用此 方 法 则 可能 会有 一 些 记录 在留 在 队列中它 们 将 不会 被 处理
 enqueuesentinel  将 一个标 记写 入队列 以通 知 监听 器退 出
此 实 现 会 使用 putnowait 
如果 你想 要 使 得超 时 设置 或 自 定义 的队 列 实现 则 你可 能会 想要 重载 此 方法
3
3 新版功 能
 参 见模 块 logging 日 志记 录模 块 的 api 参考
 模 块 logging
config 日 志记 录模块的 配置 api 
logging  python 的 日志 记 录工具
 源代 码 liblogginginit
pyimportant  此 页面 仅包 含 api 参 考信 息
 教 程信息 和更多 高级 用 法的 讨论请 参 阅 基础 教程 进阶教程 日 志操 作手册 这 个 模 块为 应用与 库 实 现 了 灵 活的 事件日志 系统 的 函 数与 类
使 用标准库 提 提供 的 logging  api 最 主要 的 好处 是所 有 的 python  模 块都 可 能 参与日 志输出包 括你自 己 的日志 消息 和 第三方 模块的 日志 消息
 这 个模 块 提供 许 多强 大而灵 活 的功能
如 果你对 logging 不 太熟悉的 话掌 握 它最 好的方 式就 是查 看它 对应 的教 程详 见右 侧的链 接
 该 模 块 定义 的基 础 类 和函数都 列在 下面
 记录器暴露 了应 用 程序代码直 接使 用 的接 口
处 理器 将日 志记录 由记 录器 创 建 发送 到适 当 的 目标
 过滤 器提供了 更精细 的设施用 于确定要 输 出的日志 记 录
格式 器指 定最 终输 出 中日 志记 录的 样 式
记 录器对 象
日志级 别
日 志 记录 级别的数 值 在下 表中 给 出
如 果你 想要定 义 自己 的 级别并且 需 要它 们 具有相 对于 预定 义 级别 的特 定值那 么这些内 容 可 能 是你 感 兴趣 的
 如 果 你定义具 有相 同数值的 级 别 它 将覆 盖 预定 义的 值预定 义 的 名称 丢 失
级别 数值 critical 50 error 40 warning 30 info 20 debug 10 notset 0
 处 理器 对象
handler 有 以 下 属 性和 方法
 注意不 要直接 实例化 handler 这 个类 用来 派 生其 他更有 用的子类
 但 是 子 类的 init  方 法需 要调用 handler
init 
handler  initlevelnotset  初始化 handler 实 例时 需要设置 它 的级 别将 过 滤列 表置 为空 并 且创 建 锁通过 createlock 来 序 列化 对 io  的访问
 createlock  初始 化一 个线程 锁用 来 序列 化 对 底层的 io  功能 的访 问 底层 的 io 功能可 能不是 线程安全 的
 acquire  使 用 createlock  获 取线 程锁
 release  使 用 acquire 来 释 放 线 程锁
 setlevellevel  给处 理器 设 置阈 值 为 level 
日志级 别小于 level 将 被忽略
创 建处 理器 时 日 志级别被 设 置为 notset  所有 的消 息都 会被处 理
 参见日 志级别级 别列表
在3
2 版更改 level 形参 现 在接受 像 info 这样 的字 符串形 式的 级别 表达 方式也 可以使用像 info  这样的 整数 常量
 setformatterfmt  将此处 理 器 的 formatter 设 置为 fmt
 addfilterfilter 将指 定的 过滤 器 filter  添 加到此处理 器
 removefilterfilter 从 此处理 器中 删除 指 定 的 过 滤器 filter 
 filterrecord 将 此处 理 器的过 滤器 应用 于 记录在 要处 理记 录 时返 回 true 
 依次查 询 过 滤 器 直 到其中一 个 返 回假值为止
 如果 它们都不 返 回假值 则将 发 出 记录
 如 果 返回一 个假 值 则 处理 器将不会 发 出 记 录
 flush  确 保所 有 日 志 记录 从 缓 存输 出
此 版本不 执行任 何 操 作 并且 应由 子 类 实现
 close  整 理处 理器 使用 的 所有 资源
此 版 本 不输 出但 从内 部处理 器列表 中删 除 处理器 内部 处 理器 在 shutdown 被 调用 时 关 闭
子 类 应 确 保从 重写 的 close 方 法 中调用 此方 法
 handlerecord  经已添 加到 处 理器的 过滤器 过滤 后 有条 件地 发出 指定的 日志记录
用 获取释 放 io 线程 锁包 装 记录 的实 际 发出 行为
 handleerrorrecord 调用 emit  期间遇 到 异常时 应 从 处理器 中调 用 此 方法
 如果模 块级 属性 raiseexceptions  是 false 则 异常 将 被 静 默 忽略
 这是 大多数情 况 下 日志 系统 需 要的—— 大 多数 用 户不 会关 心日志 系统 中 的错 误他 们 对 应 用程 序 错误 更感 兴 趣
但 是你 可 以 根据 需要 将其 替换 为自 定 义 处理 器
 指定的 记录是发 生异 常时正 在 处理 的记录
raiseexceptions  的默 认值 是 true  因为这 在开发过 程 中 是 比较 有用的
 formatrecord  如 果设置 了格式器 则 用 其 对记 录进行 格 式化
否 则使用模 块的 默认 格 式器
 emitrecord  执 行实 际记 录 给 定 日 志 记 录 所 需的 操 作
这 个 版本 应 由 子 类实 现 因此 这 里直接 引发 notimplementederror  异常
 有 关 作 为标准 随附 的处理 程序 列表 请 参见 logging
 格式 器 对 象
filter 对 象
logrecord 属 性
logrecord  实 例 是每 当有日 志被 记 录时 由 logger  自 动创 建的并且 可通过 makelogrecord  手动 创建 例如 根 据 从 网 络接 收的已 封 存事 件创 建
logrecordname  level  pathname  lineno  msg  args  excinfo  funcnone  sinfonone 包 含与被 记 录 的事 件相 关的 所 有信息
 主要信 息 是 在 msg  和 args  中传 递的 它们使 用 msg  args 组合 到 一起 以创建 记 录的 message  字段
 参 数 name 用 于记 录由 此 logrecord  所表示的事 件的 日 志记 录 器 名称
 请 注 意 此名 称将始 终为 该 值即使 它可以 是由 附加 到不 同 祖先 日志 记录 器的处 理 程序所 发出的
 level 以数 字 表示的日志 记 录 事件 层 级如 debug  info  等
请 注意 这会转 换为 logrecord  的两 个属 性 levelno 为数 字 值 而 levelname 为对 应 的层级 名称
 pathname  进行日 志 记 录调用的 文 件的 完 整 路 径名
 lineno  记录调用 所在 源文 件中 的 行 号
 msg 事 件描述 消息 可 能为 带有可变数 据 占位 符的 格式 字 符 串
 args 要 合 并到 msg  参 数以 获得 事件描述 的可 变数 据
 excinfo 包 含当前 异常 信 息的 异 常元 组或者 如果 没有 可用异 常 信息则为 none
 func  发 起调 用日 志记 录调 用的 函数 或方法 名称
 sinfo  一个 文本 字符 串 表示当 前线 程 中 从 堆栈 底部 直 到日 志 记录 调用 的 堆栈 信息
 getmessage 在将 logrecord  实例 与 任何 用户 提 供的 参数 合并之后返 回 此 实 例 的 消息
 如果 用户提 供给 日志 记录 调用 的 消 息 参数 不是 字符 串则 会 在其 上调 用 str 以将 它转换 为字符 串
 此方 法 允 许 将用 户定 义的类用作 消息 类 的 str 方 法 可 以返 回 要 使用 的实际 格式 字符 串
在3
2版 更改通 过提 供用 于创 建记录 的 工厂方法 已使得 logrecord  的创 建 更 易 于配 置
 该工 厂 方法可 使 用 getlogrecordfactory 和 setlogrecordfactory 来 设置 在此 可 查看 工厂 方 法的 签 名
在 创建时可 使 用 此功 能将 你自己的 值注 入 logrecord
你可 以使用以 下 模式 oldfactory  logging
setlogrecordfactoryrecordfactory  通 过此模式 多个 工 厂 方法 可 以被 链接起 来并 且 只 要它 们 不重 载彼 此 的 属性 或 是在 无 意 中覆 盖 了上 面列 出 的 标准 属性 就不 会发 生意 外
logrecord 属 性
loggeradapter 对象
loggeradapter  实例 会 被 用来 方便地 将 上 下文信息 传入 日志 记录 调用
 要获取 用法 示例 请参阅添 加上下文 信 息 到你 的日志 记录输出 部分
loggeradapterlogger  extra 返 回一个 loggeradapter 的 实例 该实例 的初 始 化 使用 了 下 层的 logger  实 例和 一个 字 典类 对 象
 processmsg  kwargs 修 改传递 给日志 记录 调 用的 消息 和或 关键 字参 数 以 便插 入 上下文信息
 此 实 现 接受 以 extra  形式 传给构造 器的对象 并使 用 extra 键名 将其 加入 kwargs
 返 回值 为一个 msg  kwargs 元 组 其中 传入 了可 能经 过 修改 的 参数版 本
在 上述 方法 之外 loggeradapter  还支 持 logger  的下 列方 法 debuginfo  warning  error  exception  criticallog  isenabledfor  geteffectivelevel  setlevel  以 及 hashandlers
 这些 方法 具有 与它 们在 logger  中的 对应 方法 相 同的签 名因 此你 可 以互 换使用 这两 种类 型的 实 例
在3
2版 更 改 isenabledfor  geteffectivelevel  setlevel 和 hashandlers  方法已被 添加 到 loggeradapter
 这些 方法会委 托给 下层 的日 志记录器
 线程 安全
logging  模块的 目标是使 客户 端 不必 执行任 何 特 殊操 作即 可 确 保线 程 安全
 它通过使 用 线程 锁来 达成 这 个目标用 一个 锁来 序 列 化对 模块 共 享 数据的 访问 并 且每 个处 理 程序 也会 创 建一 个锁 来序列 化对 其 下 层 io 的 访问
 如 果你 要 使 用 signal 模 块来 实现 异 步 信 号 处理程 序则 可能无 法在 这些 处理 程序 中 使 用 logging
这 是因 为 threading  模 块中 的 锁实 现并 非 总 是可 重 入 的所以无 法从 此类 信号处理 程序发起 调 用
模块 级别 函数
 模块 级属 性
与 警告 模块集 成
lzma 用 lzma  算 法 压 缩
3
3新 版 功能
 源代码 liblzma
py  此 模块 提供了 可以 压缩 和 解 压缩 使用 lzma  压 缩算 法 的 数据的 类和 便 携函 数
其 中 还包 含支 持 xz  工具 所 使 用的
xz  和旧 式
lzma  文件 格式 的文 件接口以 及 相 应 的原始 压 缩数 据流
 此模块 所 提供 的接 口与 bz 2 模 块的 非 常类 似
 但是 请注 意 lzmafile  不是 线 程安 全的这 与 bz 2
bz 2 file 不同因 此如果你 需 要在 多个线 程中 使用 单 个 lzmafile 实 例则 需要 通过 锁来 保护 它
lzmaerror  当在压缩 或 解压缩 期间 或 是在 初始 化 压缩 器解 压 缩 器的 状态 期间 发 生错 误时 此异常会 被引 发
读 写 压 缩文 件
在内 存中压缩 和 解压缩 数 据
lzmacompressorformatformatxz  check 1 presetnone  filtersnone 创 建一 个压 缩 器对 象此对象 可 被 用来 执 行 增 量压 缩
 压 缩单 个 数据 块 的 更 便捷 方 式请参 阅 compress
 format 参 数 指定 应当使用 哪种 容 器格 式
可 能 的值 有 formatxz 
xz  容器格式
这 是 默认 格 式
 formatalone 传 统 的
lzma  容器 格 式
 这种格 式 相比
xz 更 为受限 它 不 支 持一 致 性检查或 多重 过滤 器
 formatraw  原始 数据 流 不使 用 任 何容 器格式
 这个 格式 描 述器不支 持 一致 性 检查 并 且 要 求 你 必须 指定 一个自 定义的过 滤 器 链 用 于压 缩 和解压 缩
此 外以 这种 方 式 压 缩的数 据不可使 用 formatauto 来 解压 缩参 见 lzmadecompressor
 check  参数指定 要 包含 在压 缩 数据 中的 一 致性 检 查类 型
这 种检查 在解 压缩 时使用 以确保数 据 没有被破 坏
可能 的 值是 checknone  没有 一致性检 查
这 是 formatalone 和 formatraw  的默认 值也 是 唯一可接 受 的值
 checkcrc 3232 位循环冗 余检 查
 checkcrc 6464位 循环 冗余检 查
 这是 formatxz  的默 认值
 checksha 256256 位 安 全哈 希 算法
 如 果指定的 检查 不受 支 持则 会 引发 lzmaerror
 压缩设置 可被 指 定 为一 个预设 的 压缩 等 级通 过 preset 参数 或 以 自定 义 过 滤器链 来 详 细设置 通过 filters 参数
 preset  参数 如 果提 供应当 为 一个0 到9 包括边 界之 间的整数 可以选 择与 常数 presetextreme  进行 or 运算
 如果 preset 和 filters  均 未 给出 则默认行 为是使 用 presetdefault  预设等 级6
 更 高 的预设 等级 会产生更 小 的输 出 但 会使得 压缩 过程 更缓慢
 注 解除 了更加 cpu  密 集 使用 更 高的 预设 等级来压 缩还 需要 更 多 的内 存 并 产生 需要 更多内存 来解 压缩的 输出
 例如 使用 预 设等 级9 时 一个 lzmacompressor  对象 的开 销可 以高 达800 mib
出 于这样 的原因通 常最 好是保 持使 用默 认预 设等 级
 filters  参数 如果提供 应 当指定 一个 过滤 器链
详 情参 见指 定自定 义 的 过滤 器链
 compressdata  压 缩 data 一 个 bytes  object 返 回包含针 对输 入的 至 少一 部分已压 缩数据的 bytes  对象
 一 部 data 可能会 被 放入内 部缓冲区 以便 用于后 续的 compress 和 flush 调 用
 返回 的数据 应当与 之 前任 何 compress 调 用的输出 进行 拼 接
 flush 结 束压缩进 程 返 回 包含保存 在压 缩器 的 内部 缓冲 区中 的任意 数据的 bytes 对 象
 调用此方法 之后 压 缩器将 不可 再被 使 用
lzmadecompressorformatformatauto  memlimitnone  filtersnone 创 建一个压缩 器 对象 此 对象 可被用 来 执行 增 量解 压缩
一 次性解 压缩 整个 压缩 数据 流 的更 便 捷方 式请 参阅 decompress
 format 参数 指定应当 被使用的 容器格 式
默认 值 为 formatauto 它 可以 解压 缩
xz 和
lzma  文件
其他 可能 的值为 formatxz  formatalone  和 formatraw
 memlimit 参 数指定 解压 缩 器可 以使 用的内 存上 限字 节数
 当使用此 参数时 如果 不 可能 在 给定 内存 上限之内 解 压缩 输 入数据 则解压 缩将 失败 并引 发 lzmaerror
 filters 参 数 指 定 用于创 建 被解 压缩 数据流 的 过滤 器 链
此 参 数在 format  为 formatraw 时 要求提 供但 对 于其他 格式不 应使 用
 有 关过 滤器链的 更 多 信息 请参 阅指 定自 定义 的 过 滤器链
 注解 这 个 类 不会 透明地 处理 包含 多个已 压 缩数 据 流 的 输入 这不 同于 decompress  和 lzmafile
 要 通 过 lzmadecompressor 来 解压缩多 个数 据流 输 入 你必须 为 每 个数 据流都 创建 一个 新的 解 压 缩器
 decompressdata  maxlength 1 解 压缩 data 一 个 byteslike  object 返 回字节 串 形式 的 解压 缩 数据
 某 些 data  可以 在 内部 被 缓 冲以 便 用于 后续 的 decompress  调用
返 回的 数据应 当与 之前任何 decompress  调 用的 输出进行 拼 接
如 果 maxlength 为非负 数将 返回至多 maxlength  个 字节 的 解压缩数 据
如 果达到 此限 制 并 且可 以 产 生后 续输出 则 needsinput 属性 将被设 为 false
 在 这 种 情况下 下 一 次 decompress  调用提 供的 data  可以为 b 以 获 取更多 的 输出
 如果 所有输入 数据 都已 被 解压 缩 并返 回 或是 因为 它 少于 maxlength  个字节 或 是因 为 maxlength  为负 数则 needsinput 属 性 将 被设为 true
在 到 达 数据 流末尾 之后再 尝试 解压 缩数 据会引 发 eoferror
在 数据流 末 尾 之后获 取的 任何 数据 都会 被忽略并 存储 至 unuseddata  属 性
在3
5 版更改添 加了 maxlength 形参
 check  输 入流 使用 的一 致性 检查的 id
这 可 能为 checkunknown  直到 已解 压了足够 的输 入数据 来 确 定它所使用的 一致 性检查
 eof 若 达 到了 数据流末尾 标识 符则为 true
 unuseddata 压 缩 数据 流的末尾还 有数 据
在达到 数据流 末尾 之前这 个值将为 b
 needsinput  如 果 在 要求新的 未 解 压 缩输 入 之前 decompress  方 法可以提 供 更多的 解 压 缩数 据 则为 false
3
5 新版 功能
compressdata  formatformatxz  check 1 presetnone  filtersnone  压 缩 data 一 个 bytes 对 象 返回 包含压 缩数据 的 bytes 对 象
参 见上 文 的 lzmacompressor 了 解 有 关 format  check  preset 和 filters 参 数 的 说明
decompressdata  formatformatauto  memlimitnone  filtersnone  解压 缩 data 一 个 bytes 对 象 返 回 包 含 解 压缩 数 据 的 bytes 对 象
 如 果 data  是多 个单 独压 缩 数 据流 的拼 接则 解 压 缩 所 有 相 应 数据 流并 返 回结 果的 拼接
 参见 上 文的 lzmadecompressor 了解有 关 format  memlimit 和 filters 参 数的 说 明
杂 项
ischecksupportedcheck 如 果本 系统 支持给定 的一 致 性 检 查 则返 回 true
 checknone 和 checkcrc 32 总是 受支 持
 checkcrc 64 和 checksha 256或 许不可 用如 果你 正 在 使 用基于受 限制 特性 集编 译的 liblzma  版 本 的 话
指 定自 定 义 的过 滤 器链
示 例
在已压 缩的 数据 中 读 取 import  lzma  with  lzma
read 创 建一个 压缩文件 import  lzma  data  binsert  data  here  with  lzma
writedata 在内存 中压缩 文 件 import  lzma  datain  binsert  data  here  dataout  lzma
compressdatain 增量 压缩 import  lzma  lzc  lzma
joinout 1 out 2 out 3 out 4 写 入 已压 缩 数 据 到已 打 开的 文件 import  lzma  with  openfile
writebnot  compressedn  使 用 自 定义 过滤 器链 创 建 一 个已 压缩 文件 import  lzma  myfilters  id  lzma
mailbox  manipulate  mailboxes  in  various  formats
 源代 码 libmailbox
参 见模 块 email  represent  and  manipulate  messages
mailbox 对 象
 警 告 be  very  cautious  when  modifying  mailboxes  that  might  be  simultaneously  changed  by  some  other  process
在3
2 版 更 改 support  for  binary  input  was  added
注 解 the  behavior  of  iter  is  unlike  that  of  dictionaries  which  iterate  over  keys
3
2新 版 功能
 在3
2 版更 改 the  file  object  really  is  a  binary  file  previously  it  was  incorrectly  returned  in  text  mode
 注解 unlike  other  representations  of  messages  filelike  representations  are  not  necessarily  independent  of  the  mailbox  instance  that  created  them  or  of  the  underlying  mailbox
 注 解 unlike  with  dictionaries  keyword  arguments  are  not  supported
maildir
注 解 the  maildir  specification  requires  the  use  of  a  colon  in  certain  message  file  names
 some  mailbox  methods  implemented  by  maildir  deserve  special  remarks  addmessage  setitemkey  message  updatearg  警告 these  methods  generate  unique  file  names  based  upon  the  current  process  id
 参 见 maildir  man  page  from  courier  a  specification  of  the  format
mbox
参 见 mbox  man  page  from  tin  a  specification  of  the  format  with  details  on  locking
mh
注解 alreadyissued  keys  are  invalidated  by  this  operation  and  should  not  be  subsequently  used
 参 见 nmh  message  handling  system  home  page  of  nmh  an  updated  version  of  the  original  mh
babyl
注 解 the  actual  messages  are  inspected  to  determine  which  labels  exist  in  the  mailbox  rather  than  consulting  the  list  of  labels  in  the  babyl  options  section  but  the  babyl  section  is  updated  whenever  the  mailbox  is  modified
 参见 format  of  version 5 babyl  files  a  specification  of  the  babyl  format
mmdf
 参见 mmdf  man  page  from  tin  a  specification  of  mmdf  format  from  the  documentation  of  tin  a  newsreader
message  objects
maildirmessage
 standard  flags  for  maildir  messages  are  as  follows 标 记意 义解释 d 草 稿 under  composition  f 已标记 标记为 重要 p 已 读转 发重 新发 送或退回 r  已 回复 回 复给 s  查看 读取 t 已删 除标 记 为 以后 删 除 maildirmessage 实 例 提供 以 下方 法 getsubdir  return  either  new  if  the  message  should  be  stored  in  the  new  subdirectory  or  cur  if  the  message  should  be  stored  in  the  cur  subdirectory
注 解 a  message  is  typically  moved  from  new  to  cur  after  its  mailbox  has  been  accessed  whether  or  not  the  message  is  has  been  read
when  a  maildirmessage  instance  is  created  based  upon  anmboxmessage  or  mmdfmessage  instance  the  status  and  xstatusheaders  are  omitted  and  the  following  conversions  take  place  结果 状态 mboxmessage 或 mmdfmessage  状态 cur 子 目 录 o 标记 f  标 记 f  标 记 r 标记 a  标记 s  标 记 r 标记 t  标记 d  标记 when  a  maildirmessage  instance  is  created  based  upon  an  mhmessageinstance  the  following  conversions  take  place  结 果 状 态 mhmessage 状 态 cur 子目录 unseen  序列 cur  subdirectory  and  s  flag  非 unseen  序列 f  标记 flagged  序列 r  标 记 replied  序 列 when  a  maildirmessage  instance  is  created  based  upon  ababylmessage  instance  the  following  conversions  take  place  结果 状态 babylmessage  状态 cur  子目 录 unseen 标签 cur  subdirectory  and  s  flag 非 unseen  标签 p  标记 forwarded 或 resent  标 签 r  标 记 answered 标签 t  标记 deleted 标 签
mboxmessage
 conventional  flags  for  mbox  messages  are  as  follows 标 记意 义解 释 r  读 取读取 o  old  以前 由 mua  检 测 d 已删 除标 记为 以后 删除 f 已标 记标 记 为 重要 a  已 回 复 回 复给 the  r  and  o  flags  are  stored  in  the  status  header  and  the  d  f  and  a  flags  are  stored  in  the  xstatus  header
when  an  mboxmessage  instance  is  created  based  upon  amaildirmessage  instance  a  from  line  is  generated  based  upon  themaildirmessage  instances  delivery  date  and  the  followingconversions  take  place  结果 状 态 maildirmessage  状态 r  标 记 s 标 记 o 标记 cur  子目 录 d  标记 t  标 记 f  标 记 f 标 记 a  标 记 r 标 记 when  an  mboxmessage  instance  is  created  based  upon  an  mhmessageinstance  the  following  conversions  take  place 结果 状 态 mhmessage 状 态 r 标 记和 o  标 记非 unseen  序 列 o 标 记 unseen 序 列 f 标 记 flagged 序 列 a  标记 replied  序列 when  an  mboxmessage  instance  is  created  based  upon  a  babylmessageinstance  the  following  conversions  take  place  结果 状态 babylmessage 状 态 r 标记 和 o  标 记非 unseen  标 签 o  标记 unseen 标 签 d 标 记 deleted 标签 a  标 记 answered 标 签 when  a  message  instance  is  created  based  upon  an  mmdfmessageinstance  the  from  line  is  copied  and  all  flags  directlycorrespond 结果 状态 mmdfmessage 状 态 r 标记 r  标记 o  标记 o  标记 d 标 记 d 标 记 f  标记 f  标 记 a 标 记 a 标 记
mhmessage
 some  mail  reading  programs  although  not  the  standard  mh  and  nmh  use  sequences  in  much  the  same  way  flags  are  used  with  other  formats  as  follows 序列 解释 未读未读 取 但先 前 被 mua 检 测到 已回 复 回 复给 已标记 标 记 为重 要 mhmessage  instances  offer  the  following  methods  getsequences  return  a  list  of  the  names  of  sequences  that  include  this  message
when  an  mhmessage  instance  is  created  based  upon  a  maildirmessageinstance  the  following  conversions  take  place 结 果 状 态 maildirmessage  状态 unseen 序 列 非 s 标 记 replied  序 列 r  标记 flagged  序列 f  标记 when  an  mhmessage  instance  is  created  based  upon  an  mboxmessage  ormmdfmessage  instance  the  status  and  xstatus  headers  areomitted  and  the  following  conversions  take  place  结果状 态 mboxmessage  或 mmdfmessage 状 态 unseen 序列 非 r  标记 replied  序 列 a 标 记 flagged 序 列 f 标 记 when  an  mhmessage  instance  is  created  based  upon  a  babylmessageinstance  the  following  conversions  take  place 结 果状态 babylmessage  状 态 unseen 序 列 unseen 标 签 replied 序 列 answered 标签
babylmessage
 the  attributes  are  as  follows  标 签解 释 未读 未读 取但 先前 被 mua 检 测 到 deleted  标 记为 以后 删 除 filed 复 制 到 另一 个文 件 或邮 箱 answered 回 复 给 forwarded 已 转 发 edited 由 用户修改 resent  已重发 by  default  rmail  displays  only  visible  headers
 babylmessage  instances  offer  the  following  methods  getlabels 返回邮 件上 的 标签列 表
 setlabelslabels 将消 息上的标签列 表设 置为 labels 
 addlabellabel  将 label 添 加到 消息 上的 标 签 列表 中
 removelabellabel 从 消息 上的 标签 列 表 中删 除 label 
when  a  babylmessage  instance  is  created  based  upon  amaildirmessage  instance  the  following  conversions  take  place 结 果状 态 maildirmessage 状态 unseen  标签非 s  标记 deleted 标 签 t 标 记 answered 标签 r  标 记 forwarded 标 签 p 标记 when  a  babylmessage  instance  is  created  based  upon  an  mboxmessageor  mmdfmessage  instance  the  status  and  xstatus  headers  areomitted  and  the  following  conversions  take  place  结果 状 态 mboxmessage 或 mmdfmessage  状 态 unseen 标签非 r  标记 deleted  标签 d 标记 answered 标 签 a 标 记 when  a  babylmessage  instance  is  created  based  upon  an  mhmessageinstance  the  following  conversions  take  place 结 果状 态 mhmessage 状 态 unseen 标 签 unseen  序 列 answered 标 签 replied 序 列
mmdfmessage
 conventional  flags  for  mmdf  messages  are  identical  to  those  of  mbox  message  and  are  as  follows 标 记意 义解释 r  读取读 取 o  old 以前 由 mua 检 测 d  已 删除 标记 为以 后 删 除 f 已 标记 标记 为重 要 a  已回 复回 复给 the  r  and  o  flags  are  stored  in  the  status  header  and  the  d  f  and  a  flags  are  stored  in  the  xstatus  header
when  an  mmdfmessage  instance  is  created  based  upon  amaildirmessage  instance  a  from  line  is  generated  based  upon  themaildirmessage  instances  delivery  date  and  the  followingconversions  take  place  结果 状态 maildirmessage  状态 r  标记 s 标记 o  标记 cur 子目 录 d 标记 t  标记 f 标 记 f 标 记 a 标 记 r 标记 when  an  mmdfmessage  instance  is  created  based  upon  an  mhmessageinstance  the  following  conversions  take  place  结果 状态 mhmessage  状态 r  标 记 和 o 标 记非 unseen  序列 o  标 记 unseen 序 列 f 标记 flagged 序 列 a 标记 replied 序 列 when  an  mmdfmessage  instance  is  created  based  upon  a  babylmessageinstance  the  following  conversions  take  place  结果 状态 babylmessage  状 态 r  标 记 和 o 标 记 非 unseen 标 签 o 标 记 unseen 标签 d  标记 deleted  标 签 a  标记 answered  标签 when  an  mmdfmessage  instance  is  created  based  upon  an  mboxmessageinstance  the  from  line  is  copied  and  all  flags  directlycorrespond  结 果状 态 mboxmessage  状 态 r 标 记 r 标 记 o 标 记 o 标 记 d 标 记 d 标 记 f 标 记 f  标 记 a  标记 a 标 记
异 常
示 例
mailcap  mailcap 文 件处 理
源 代码 libmailcap
pymailcap  文 件 可 用来 配 置 支 持 mime  的 应 用例 如邮 件阅 读 器和 web  浏 览 器如何 响应 具有 不同 mime 类 型的 文 件
 mailcap  这个名 称源 自 短 语 mailcapability
 例 如 一个 mailcap  文件 可 能 包 含 videompeg  xmpeg  s  这 样的 行
然后 如 果 用户 遇到 mime  类 型为 videompeg 的 邮件 消息 或 web 文档 时 s  将 被替换 为一 个文 件 名通 常是 一个临 时文 件并且将 自动 启动 xmpeg  程序 来查 看 该文 件
mailcap 格 式的 文 档 见 rfc 1524 a  user  agent  configurationmechanism  for  multimedia  mail  format  information 但 它并 不 是 一个 因 特 网 标 准
不 过 mailcap  文件在大多 数 unix 系统 上都 受到 支持
findmatchcaps  mimetype  keyview  filenamedevnull  plist  返回 一个2 元 组其 中第 一个元 素是包 含所 要执行 命令 的 字 符 串 它可 被 传递给 os
system  第二 个元 素是 对 应于 给定 mime 类 型的 mailcap  条目
 如果 找不 到匹 配的 mime  类型则 将返 回 none  none
 key 是所 需 字段 的名 称它 代 表要 执行的 活 动 类型 默 认 值 是 view 因 为在 最通 常的 情况下 你只 是 想 要 查看 mime  类 型 数据 的正 文
其 他可 能的值 还有 compose  和 edit 分 别用 于 想 要 创建 给定 mime  类型正 文 或修改 现 有 正文 数据 的 情况
请参 阅 rfc 1524获 取这 些字 段的完 整列 表
 filename 是 在 命令 行中 用 来替 换 s 的 文 件 名 默认 值 devnull 几 乎 肯定 不是 你想 要 的因 此 通常你 要通 过指 定一个文 件名 来重 载它
 plist 可 以是 一 个包 含 命名 形 参的 列 表默 认值 只 是 一 个 空列 表
列 表中 的每 个条 目 必 须为 包含 形 参名 称的 字符 串、 等于号 以及 形参 的 值
 mailcap  条 目 可 以包 含形如 foo 的 命名 形参它 将由 名为 foo 的 形参的 值所 替换
 例如如 果命 令 行 showpartial  id  number  total  是在 一个 mailcap  文 件中并 且 plist 被 设为 id 1 number 2 total 3 则结 果命 令行 将为 showpartial 123
 在 mailcap 文 件中 可 以指 定可 选的 test  字段来 检 测某 些外 部 条件 例如 所使 用的 机器 架构 或窗 口系 统来 确定 是否要 应用 mailcap  行
 findmatch 将 自 动 检查此 类 条 件并 在检 查未 通过 时跳 过条 目
getcaps  返回 一个 将 mime 类 型映射 到 mailcap 文 件 条目 列表 的字典
此 字 典 必 须被 传给 findmatch  函数
 条目会 被存 储为 字典 列表 但并 不需 要了 解 此表 示形 式 的 细 节
此 信 息 来 自在 系 统中 找 到 的所 有 mailcap  文 件
 用 户的 mailcap  文件 home
mailcap 中的设 置将 覆盖 系统 mailcap  文 件 etcmailcap  usretcmailcap  和 usrlocaletcmailcap  中 的 设置
 一个 用法示 例 import  mailcap  d  mailcap
结 构化 标 记处 理 工具
python  支 持 各 种 模 块 以处理 各 种形 式 的结 构 化 数据 标 记
这 包 括 使用标 准通 用 标记 语言 sgml  和超 文 本 标记 语 言 html  的 模 块 以 及 使用 可 扩 展 标记 语 言 xml 的 几个 接 口
 html  超文 本标 记 语 言 支 持 html
parser  简 单 的 html 和 xhtml 解 析器 html 解析 器的 示例 程序 htmlparser 方 法示 例 html
entities  html  一般 实 体 的 定义 xml  处 理 模块 xml  漏 洞 defusedxml  包 xml
elementtree  elementtree  xml  api 教 程 xml  树 和 元素 解析 xml  pull  api  进行 非阻 塞 解 析 查找 感兴 趣 的 元 素修 改 xml 文 件 构建 xml  文档 使用命 名空间解析 xml  其 他 资 源 xpath  支持示 例 支持 的 xpath  语法参 考引 用函 数 xinclude 支 持示 例 参 考 引 用 函数 元 素对 象 elementtree 对象 qname  objects  treebuilder  objects  xmlparser  对 象 xmlpullparser  对 象 异常 xml
dom  the  document  object  model  api  模块 内容 objects  in  the  dom  domimplementation  objects 节点 对象节点列 表对象 文档 类 型 对象 文档 对 象元 素对 象 attr 对象 namednodemap 对象 注释 对 象 text  和 cdatasection 对 象 processinginstruction 对 象异 常 一 致 性类型映射 accessor  methods  xml
handler  base  classes  for  sax  handlers  contenthandler  对象 dtdhandler  对象 entityresolver  对象 errorhandler 对 象 xml
saxutils  sax 工 具集 xml
xmlreader  interface  for  xml  parsers  xmlreader 对 象 incrementalparser 对 象 locator 对象 inputsource  对象 the  attributes  interface  the  attributesns  interface  xml
expat  fast  xml  parsing  using  expat  xmlparser  对 象 expaterror  exceptions  示例 content  model  descriptions  expat  error  constants
marshal  内部 python  对象 序列化
math 数 学函数
 该模块提供 了对 c  标 准 定义的 数学 函数 的访 问
这 些 函数 不适用于 复 数 如果 你 需要 计算 复数 请使 用 cmath  模块中的 同名 函数
 将支 持计 算复 数 的 函 数区 分 开的 目的 来自于 大多数开 发 者 并 不 愿 意像 数学家 一样 需 要学习 复 数的 概念
得到 一 个异常 而不是 一个 复 数 结果使 得开发 者能 够更 早地 监测到 传递 给 这些函 数的参数中 包含 复数 进 而调 查其 产生 的 原因
 该模块提 供了 以下函数
 除 非另 有 明确说明 否 则所 有返回值 均为 浮点 数
 数论 与 表示 函数
ceilx  返 回 x 的上 限即 大于 或 者 等于 x  的最小 整 数
 如果 x  不是 一 个 浮点 数则委 托 x
ceil  返 回一个 integral 类 的 值
combn  k 返 回不重 复且无顺序 地 从 n 项中 选择 k 项 的 方式总数
 当 k  n 时取 值 为 n  k  n  k  当 k  n 时 取值 为零
 也 称为二 项式 系数因为 它 等价于 表达式1 x  n  的多 项式 展 开 中第 k  项的 系 数
如 果任 一参 数不 为整 数则 会引 发 typeerror
 如 果 任 一 参 数为 负 数则会 引发 valueerror
3
8 新版功能
copysignx  y  返 回一个 基于 x 的 绝对 值 和 y 的符 号的 浮点 数
在 支 持 带符 号零的 平 台上 copysign 1
0 返 回1
fabsx 返回 x 的 绝 对 值
factorialx 以 一个 整数 返回 x  的阶乘
 如果 x  不是 整数 或为 负数时则 将引 发 valueerror
3
9版 后已移 除接受具 有 整数 值的 浮 点数例如5
0 的行 为已 被 弃 用
floorx 返回 x  的向 下取 整小于 或等 于 x 的 最大 整 数
 如果 x  不 是 浮 点 数 则 委托 x
floor 它 应 返回 integral  值
fmodx  y 返 回 fmodx  y  由 平 台 c 库 定义
请 注意 python  表 达式 x  y  可能 不会 返 回 相 同的 结果
c 标 准 的目的 是 fmodx  y 完全数 学上到 无 限精度等 于 x  ny 对 于某 个 整 数 n 使 得结 果具 有 与 x 相 同的 符号 和小于 absy 的 幅 度
python  的 x  y  返 回带 有 y  符 号 的结 果 并且 可能 不能完 全计 算 浮点 参数
 例 如 fmod 1 e 1001 e 100 是1 e 100但 python 的1 e 1001 e 100的 结果是1 e 1001 e 100 它 不 能完 全 表示 为浮 点数 并 且取 整 为 令 人惊讶 的1 e 100
出 于这 个原 因函 数 fmod 在 使用 浮点 数时通 常是 首 选而 python 的 x  y  在使用 整数 时是 首选
frexpx  返回 x  的 尾 数和 指数作 为对 m  e
 m  是 一 个浮 点 数 e 是 一个 整数 正好 是 x  m 2 e 
 如果 x  为 零则返回0
00 否则 返回0
5 absm 1
这用 于以可移 植方式分 离浮 点数 的 内部表 示
fsumiterable 返回迭 代 中的精 确浮 点值
通 过跟 踪多 个中 间部 分和 来避 免 精度 损失 sum
0 该算 法 的准确 性取 决于 ieee 754 算 术保 证和舍入 模 式 为半 偶的 典 型 情况
 在某 些非 windows  版 本中 底层 c  库使 用扩展 精度 添加 并 且有 时可 能 会使 中间 和加 倍导 致它在 最 低有效 位中关 闭
 有关 待进 一步 讨论 和两 种替 代 方法 参见 aspn  cookbook  recipes  for  accurate  floating  point  summation
gcdintegers  返回 给定 的 整数 参 数 的最 大公 约数
 如果有 一个 参数 非零则返 回值 将是 能同 时整 除所 有参 数的最大 正整 数
如 果所 有参 数为 零则 返 回值 为0
不 带参 数的 gcd  返回0
3
5 新版 功能
 在3
9版 更改 添加 了对 任意 数量 的参 数的 支持
之前 的版 本只 支持 两个参数
0 若 a 和 b  的值比较 接近 则返 回 true 否 则返 回 false
根 据给 定的 绝对 和 相对 容差 确定 两个值 是否 被认 为是 接近 的
 reltol 是 相对 容差——它 是 a 和 b  之间 允许 的最 大差 值相 对于 a 或 b 的 较 大绝 对值
 例如 要 设 置5％的容 差 请 传 递 reltol 0
05
默认容 差为1 e 09 确 保两 个值 在大 约9 位十 进 制 数 字 内 相 同
 reltol  必 须 大 于 零
 abstol  是 最 小 绝 对 容 差—— 对 于 接 近 零 的 比 较 很 有用
 abstol  必 须 至 少 为 零
 如果没 有 错 误发 生 结果将是 absab  maxreltol  maxabsa  absb  abstol 
 ieee 754 特 殊值 nan  inf 和 inf  将根 据 ieee 规 则处理
 具 体来说 nan  不被认 为接近任 何其他值包 括 nan 
 inf  和 inf  只 被认 为接 近自 己
3
5 新版 功能
 参见 pep 485—— 用于 测试 近似相等 的 函数 math
isfinitex  如果 x  既不 是 无穷大 也不 是 nan 则 返 回 true 否则 返 回 false 
注 意0
0被 认为 是有 限 的
3
2 新版 功 能
isinfx 如果 x  是正或 负无穷 大则 返回 true  否则返回 false 
isnanx  如果 x  是 nan 不 是数字 则 返回 true  否则 返回 false 
isqrtn  返 回 非负 整数 n  的整数 平方 根
这 就是 对 n 的实 际平 方根向 下取 整或者 相当 于 使得 a ² ≤  n  的最大 整数 a
对 于 某些 应 用来 说 可 以更适 合 取值 为使 得 n  ≤  a ²的 最小 整 数 a 或 者换 句话 说就 是 n  的 实际 平方 根向 上 取整
 对于 正 数 n  这可 以使 用 a 1 isqrtn 1来 计算
3
8 新版 功 能
lcmintegers 返回 给定的整数 参数的 最 小公倍 数
如 果 所有参 数 均 非 零则返 回 值将 是为 所有 参数 的 整 数倍 的 最小 正整数
 如果参 数之一为零 则 返 回值 为0
 不带 参数 的 lcm 返回1
3
9新 版 功 能
ldexpx  i 返 回 x 2 i 
 这基 本 上 是 函 数 frexp 的 反 函数
modfx  返回 x  的小 数和 整 数部 分
两 个结 果都 带 有 x  的 符 号并 且 是 浮点 数
nextafterx  y 返 回 x  趋向 于 y 的 最 接近 的浮 点数 值
如果 x 等 于 y 则 返回 y
 示例 math
inf 的 方 向朝上 趋向于正 无穷
inf 的 方向 朝 下 趋向于 负 无穷
0 趋向 于零
inf  x  趋向 于零 的反 方向
另 请参阅 math
3
9 新 版 功能
permn  knone  返回 不重复且 有 顺序地从 n 项 中 选择 k 项的 方 式 总数
 当 k  n  时取 值为 n  n  k  当 k  n 时取值 为零
 如 果 k  未指 定或 为 none  则 k 默 认值为 n  并 且 函数 将 返回 n
如 果 任一 参 数不 为整 数则会 引 发 typeerror
 如果 任一参 数 为 负数 则 会 引 发 valueerror
3
8 新版 功 能
proditerable  start 1计 算输 入的 iterable  中 所 有元 素的 积
 积的默 认 start  值为1
 当 可迭 代对 象 为空 时 返 回 起始 值
此 函 数特 别针对 数字 值 使 用 并 会拒 绝 非 数字类 型
3
8 新 版 功能
remainderx  y 返回 ieee 754 风格 的 x 相对于 y  的余数
 对 于 有限 x 和 有 限非 零 y  这是 差异 x  ny  其 中 n 是 与 商 x  y 的精确 值 最接 近 的整 数
 如 果 x  y 恰好位 于 两 个 连 续 整数之间 则最 近 的 even 整数用 于 n 
 余数 r  remainderx  y  因此总是 满 足 absr 0
5 absy 
 特 殊情 况 遵循 ieee 754特 别是 remainderx  math
inf 对 于 任 何 有限 x  都 是 x 而 remainderx 0和 remaindermath
inf  x 引 发 valueerror 适用于 任何非 nan 的 x 
 如果 余 数运 算 的 结果 为零则 该 零 将具 有与 x  相同 的 符号
 在使 用 ieee 754二 进制 浮 点 的平 台上此操 作的结果 始终可以 完 全表 示不会引 入舍 入 错 误
3
7新 版功能
truncx  返 回 real 值 x  截 断为 integral 通 常是 整数
委 托给 x
ulpx  返回浮点 数 x  的 最 小有 效 比特位 的值 如 果 x  是 nan  非数 字 则返回 x
如 果 x 为负数 则 返回 ulpx
 如果 x 为正 数则返回 x
 如果 x 等于 则 返回 去正规化 的可 表 示 最小 正浮点 数 小 于正规 化的 最小正 浮点 数 sys
如果 x  等 于 可 表 示最 大 正浮点 数则 返 回 x  的 最低 有 效比特位 的值使得 小 于 x 的 第一个浮 点数 为 x  ulpx
在 其他 情 况 下 x 是一 个有限 的正 数则 返回 x  的 最低 有效 比特 位 的值使得大 于 x 的 第一 个 浮点 数 为 x  ulpx
 ulp  即 unit  in  the  last  place 的缩写
 另 请参 阅 math
nextafter 和 sys
3
9新 版功 能
 注 意 frexp 和 modf 具有 与它 们的 c  等价 函 数 不同 的调 用 返回 模 式它们采 用单 个参 数并 返回一 对值 而不 是 通 过 输出 形参 返回 它们的 第二 个返 回参数 python 中没 有 这 样的 东西
 对于 ceil  floor 和 modf  函 数请注意 所有 足 够大的浮 点 数 都 是精确 整数
python 浮点 数 通常 不超 过53 位的 精度与 平台 c  double 类型 相同在 这 种情 况下 任何浮 点 x  与 absx 252 必然 没有小 数 位
幂函 数与 对 数函 数
expx  返回 e  次 x 幂其 中 e 2
 是 自 然对数 的基 数
这通 常比 math
e  x  或 powmath
e  x  更精 确
expm 1 x 返 回 e 的 x  次幂 减1
 这里 e  是 自 然对 数 的基数
 对于小浮 点数 x  expx 1中的 减法 可能导致 significant  loss  of  precision  expm 1 函数提供 了一种 将此 数 量 计算 为全 精 度的方法 from  math  import  exp  expm 1 exp 1 e 51 gives  result  accurate  to 11 places 1
0000050000166668 e 053
2 新版功能
logx  base  使用 一 个 参数返 回 x 的自然 对数 底为 e 
使用 两 个 参数 返 回 给定的 base 的 对数 x 计算 为 logxlogbase 
log 1 px 返 回1 x  base  e 的自 然对 数
以对 于 接近 零 的 x 精确 的方式 计 算结 果
log 2 x 返 回 x 以2为 底的 对 数
这 通常比 logx 2 更准 确
3
3新 版 功能
参 见 int
bitlength  返回 表示二 进 制 整数所 需 的位数 不包 括符号 和 前导零
log 10 x  返 回 x 底为10的 对数
这 通常比 logx 10 更准 确
powx  y 将 返回 x  的 y 次 幂
 特殊 情况尽 可能 遵循 c 99 标 准的附 录 f
 特 别 是 pow 1
0 x 和 powx 0
0 总 是返 回1
0 即使 x 是 零或 nan
 如果 x  和 y 都 是有限 的 x  是 负数 y 不 是 整数 那 么 powx  y  是未 定义 的并 且引 发 valueerror 
与内置 的运 算符 不 同 math
pow 将其 参 数 转 换为 float 类 型
使 用或内置 的 pow 函数 来计 算精 确 的整 数幂
sqrtx  返回 x  的 平方 根
 三角 函数
acosx  返回 以弧度 为单 位的 x 的反余 弦值
 结 果范围 在0到 pi 之 间
asinx 返 回以弧 度为单位的 x  的反 正弦 值
结果 范围 在 pi 2 到 pi 2 之间
atanx 返回 以 弧度 为单 位 的 x 的反正 切值
 结果 范 围 在 pi 2 到 pi 2之 间
atan 2 y  x  以弧 度为 单 位 返回 atany  x 
 结 果 是在 pi  和 pi 之 间
从原 点到 点 x  y  的平 面矢 量 使 该角度 与正 x  轴 成正比
 atan 2 的点的 两个输入 的 符号 都 是已 知 的 因 此它 可 以 计算 角度的 正确 象限
 例如 atan 1 和 atan 211都是 pi 4 但 atan 211 是3 pi 4
cosx 返 回 x 弧 度的 余 弦 值
distp  q  返 回 p  与 q  两 点之间 的欧几 里 得距 离 以一 个坐 标 序列或 可 迭代 对象 的 形式给 出
两 个点 必须 具有 相 同的 维度
 大致相当 于 sqrtsumpx  qx 2
0 for  px  qx  in  zipp  q 3
8新 版 功能
hypotcoordinates  返 回 欧 几里 得 范数 sqrtsumx 2 for  x  in  coordinates
 这是从 原 点到坐标 给定点的 向量长度
 对于一 个 二维点 x  y  这 等价 于使用 毕达 哥 拉斯定 义 sqrtxx  yy 计 算 一个 直角 三 角形 的 斜 边
在3
8版 更改 添加 了对 n  维点 的支持
之 前的版本只 支 持二维 点
sinx  返 回 x 弧度 的 正 弦值
tanx 返 回 x 弧度的 正切 值
角 度 转换
degreesx 将角度 x  从弧 度转 换为 度数
radiansx  将角度 x  从度 数转换 为弧 度
双 曲函 数
 双曲函 数 是基于 双 曲线而 非圆 来对三角 函 数进行模 拟
acoshx  返 回 x  的反双曲 余 弦 值
asinhx 返回 x  的 反双曲 正弦值
atanhx 返 回 x  的反 双曲 正 切值
coshx 返 回 x 的双曲 余 弦值
sinhx  返回 x 的 双 曲 正弦 值
tanhx  返回 x  的 双曲 正切 值
特 殊函 数
erfx  返 回 x 处 的 error  function 
 erf  函 数可 用于 计算 传统 的 统计 函数 如 累积 标准 正 态 分 布 def  phix  cumulative  distribution  function  for  the  standard  normal  distribution  return 1
03
2 新版 功 能
erfcx  返 回 x  处 的 互补 误差 函数
 互 补 错误函 数定义 为1
它 用于 x  的大 值从 其中 减去 一个 会 导致 有 效位数损 失
3
2 新版 功 能
gammax 返回 x 处的 伽 马 函 数值
3
2 新版 功能
lgammax 返 回 gamma  函数在 x  绝 对值 的自 然 对 数
3
2新 版功能
常 数
mimetypes  map  filenames  to  mime  types
在3
8 版更改 added  support  for  url  being  a  pathlike  object
 在3
2版 更改 previously  windows  registry  settings  were  ignored
mimetypes  objects
 可用 性 windows
3
2 新版 功能
 杂 项服务
本章 中介绍的 模块提供 了所 有 python 版本中 提供的 各种 杂 项服 务
这是 一个概述 formatter  通用 格式 化输出 the  formatter  interface  formatter  implementations  the  writer  interface  writer  implementations
多 媒 体服 务
本章描述 的 模块 实现了 主 要 用 于多媒体应 用 的各种算 法 或接口
它 们可 在安 装时 自行 决 定
这 是一个概 述 audioop 处 理原始 音频数据 aifc  读写 aiff  和 aifc 文 件 sunau  读 写 sun  au  文件 auread  对象 auwrite  对 象 wave 读 写 wav 格 式文件 waveread  对 象 wavewrite  对象 chunk 读取 iff  分块数 据 colorsys  颜色系 统 间的转换 imghdr  推 测 图像 类 型 sndhdr  推测 声音文件的 类 型 ossaudiodev  access  to  osscompatible  audio  devices  audio  device  objects  mixer  device  objects
mmap  内存 映 射 文件 支持
madv  constants
3
8 新版功能
modulefinder  查找脚本 使 用 的 模块
 源码 libmodulefinder
py 该模 块提 供了 一 个 modulefinder 类 可用 于 确 定脚 本导入 的 模块 集
modulefinder
py 也可以作 为 脚 本运行 给 出 python  脚本的 文件名 作 为参 数之 后 将 打印 导 入模 块的报告
addpackagepathpkgname  path 记 录 名为 pkgname  的包可以 在指定 的 path 中 找到
replacepackageoldname  newname 允 许 指定名 为 oldname 的 模块 实际上 是名 为 newname 的包
modulefinderpathnone  debug 0 excludes  replacepaths 该 类提 供 runscript 和 report 方法 用于 确 定 脚本导 入的 模 块 集
 path 可 以是 搜 索模块 的目录 列表 如果 没有 指 定 则 使用 sys
path 
 debug 设 置 调试 级别更 高 的 值使 类打 印 调试 消息关于 它正 在做 什 么
 excludes 是 要从分 析 中 排除的 模块 名称 列 表
 replacepaths 是将在 模块 路径中替换 的 oldpath  newpath  元组的列 表
 report 将报告 打印 到 标准输 出 列出 脚本 导入 的模块及 其路 径以 及 缺少 或似 乎 缺 失的 模块
 runscriptpathname  分 析 pathname  文件的 内容 该文件必须 包含 python 代码
 modules  一 个将 模块 名 称映射 到 模 块 的字 典
请参 阅 modulefinder  的示 例用 法
modulefinder 的 示例 用法
 稍 后将 分析的 脚本 bacon
py  import  re  itertools  try  import  baconhameggs  except  importerror  pass  try  import  guido
ham  except  importerror  pass 将输出 bacon
py 报 告 的 脚本 from  modulefinder  import  modulefinder  finder  modulefinder  finder
keys  输 出 样例 可 能 因架 构而 异 loaded  modules  types  copyreg  invertedregistryslotnamesall  srecompile  isstringsreoptimizeunicode  sre  sreconstants  repeatonemakedictatendline  sys  re  modulefinditerexpand  itertools  main  reitertoolsbaconhameggs  sreparse  patternenderssreflagunicode  array  types  moduleinttypetypetype  modules  not  imported  guido
导入模 块
 本章中 介 绍的模 块提供了 导入 其他 python  模 块和 挂钩 以自定 义导 入 过程 的新方 法
本 章 描述 的完整模 块列 表如下 zipimport  从 zip 存 档中 导入 模 块 zipimporter 对 象示 例 pkgutil 包 扩 展工 具 modulefinder  查找 脚 本 使用的 模块 modulefinder  的 示 例用 法 runpy  locating  and  executing  python  modules  importlib  import  的实 现概述函 数 importlib
abc ——关于导 入的 抽象 基类 importlib
resources 资 源 importlib
util  utility  code  for  importers 示 例 importing  programmatically  checking  if  a  module  can  be  imported  importing  a  source  file  directly  setting  up  an  importer  approximating  importlib
metadata 概述可 用 api  entry  points  distribution  metadata  distribution  versions  distribution  files  distribution  requirements  distributions  extending  the  search  algorithm
msilib  read  and  write  microsoft  installer  files
参 见 fcicreate  uuidcreate  uuidtostring
database  objects
3
7新 版功能
 参见 msidatabaseopenview  msidatabasecommit  msigetsummaryinformation  msiclosehandle
view  objects
 参 见 msiviewexecute  msiviewgetcolumninfo  msiviewfetch  msiviewmodify  msiviewclose
summary  information  objects
参 见 msisummaryinfogetproperty  msisummaryinfogetpropertycount  msisummaryinfosetproperty  msisummaryinfopersist
record  objects
参见 msirecordgetfieldcount  msirecordsetstring  msirecordsetstream  msirecordsetinteger  msirecordcleardata
errors
cab  objects
directory  objects
 参 见 directory  table  file  table  component  table  featurecomponents  table
相 关 特性
参 见 feature  table
gui  classes
参 见 dialog  table  control  table  control  types  controlcondition  table  controlevent  table  eventmapping  table  radiobutton  table
precomputed  tables
msvcrt 来 自 ms  vc 运行时 的有 用 例 程
这 些函 数提 供了对 windows  平台上 一些有用功 能的 访 问
一 些更 高级别 的模块 使用 这些函 数来构 建其服 务的 windows  实现
例如 getpass  模块 在实 现 getpass  函数 时使 用了 这些 函数
 关 于 这些 函数 的更 多信 息可以 在 平台 api  文档中 找到
 该模 块实 现 了控制台 io  api  的普通和宽 字符变 体
 普通 的 api  只处 理 ascii  字 符国 际化 应 用受限
 应该尽可 能地 使用 宽字符 api 
 在3
3版 更 改 此模块 中过 去会 引发 ioerror  的操作 现在将 引发 oserror
 文件操 作
lockingfd  mode  nbytes 基 于文 件描述 符 fd 从 c  运行 时 锁 定 文 件的 某一 部 分
 失败时 引 发 oserror
锁 定的 文 件 区域 从当前 文件位 置 开始 扩展 nbytes 个 字节并可 能持 续到 超出文 件 末尾
 mode 必 须为 下面 列出的 lk  之 一
一 个 文 件 中 的多个 区 域可 以 被 同时锁定 但 是 不能 重 叠
 相 邻 区域不 会被 合并 它 们必 须单 独 被 解锁
引 发一个审 计事 件 msvcrt
locking 附 带参数 fd  mode  nbytes 
lkrlck  锁定 指定 的字 节数据
如 果字 节数 据无 法被 锁定 程 序会 在1秒 之后 立 即 重 试
如 果 在10次尝 试后 字节 数据仍 无法 被锁 定则 会引 发 oserror
lknbrlck 锁 定 指 定的 字 节数 据
如 果字节数据无 法被 锁定 则 会 引 发 oserror
lkunlck 解 锁 指定 的字节 数据该 对象 必 须在之 前 被锁 定
setmodefd  flags 设 置文件 描 述符 fd 的行 结束 符转 写模式
要将 其设 为 文 本模 式则 flags  应当 为 os
otext 设 为 二 进制 模式 则应 当为 os
obinary 
openosfhandlehandle  flags  基于文件 句 柄 handle  创建 一个 c  运行时 文件 描述 符
 flags 形参 应当 os
oappend  os
ordonly  和 os
otext 按位 or  的结 果
返 回的 文件描 述 符 可 以被 用作 os
fdopen 的 形参以 创建 一个 文件 对象
 引发 一个 审计 事件 msvcrt
openosfhandle  附 带参 数 handle  flags
getosfhandlefd 返 回文 件 描述 符 fd 的 文件 句柄
 如果 fd  不 能被 识 别 则会 引发 oserror
 引 发一个 审计 事件 msvcrt
getosfhandle 附 带参 数 fd
 控制 台 io
kbhit 如 果有 某 个按 键正在 等待 被读 取则 返 回 true
getch 读 取一个 按键 并将 结果 字符 返回为一 个字 节串
 不 会 有内 容回 显 到缝 制台
如果还没 有任 何 键 被按 下此调用 将会 阻塞但它 将不 会等 待 enter  被按下
 如 果 按下 的键 是一个 特 殊 功 能键 此函 数将 返 回000或 xe 0 下 一次 调用将 返 回键 代 码
 controlc 按钮 无 法 使用 此函 数来读取
getwch  getch 的 宽字 符版 本 返回一个 unicode  值
getche  类似 于 getch  但按键 如果 表 示一 个可打 印字 符则 它 将 被回 显
getwche  getche 的 宽字 符版本返回 一个 unicode  值
putchchar  将字 符 串 char 打印 到终 端不 使用缓 冲区
putwchunicodechar  putch  的宽字 符版 本接 受 一个 unicode 值
ungetchchar 使 得 字 节 串 char  被推回 终端 缓冲 区 它将 是被 getch  或 getche 读取的 下一 个字符
ungetwchunicodechar  ungetch  的 宽字 符版 本 接受一 个 unicode 值
其他 函 数
heapmin 强 制 malloc 堆清空 自身 并将未使 用 的 块返回 给操作 系统
 失败时 这将 引发 oserror
multiprocessingsharedmemory 可 从进 程直 接 访问 的共 享内存
multiprocessing  基 于 进程的 并 行
源 代 码 libmultiprocessing
概 述
multiprocessing 是 一个支 持 使用 与 threading  模 块类似 的 api  来产 生进 程的包
 multiprocessing 包 同 时提供 了 本 地和 远程并 发操 作通过 使用子 进程而 非 线程 有效 地绕 过了 全局 解释 器 锁
 因此 multiprocessing  模块允许程 序员 充分利用给 定机 器上 的多 个处 理器
它在 unix  和 windows  上均 可运 行
multiprocessing 模 块还引入 了 在 threading 模块 中没 有的 api
 一个主要 的例 子就 是 pool 对象它 提供了 一种快 捷的 方 法赋予函 数并 行 化处 理一系列 输入 值的能 力可 以 将输入数 据 分配 给不 同 进程处理数 据并 行
下 面 的例 子演 示 了 在模块中 定 义此类 函 数的 常见 做法以 便子 进程可 以成 功 导入该 模块
 这个数 据并行 的基 本例 子使 用 了 pool  from  multiprocessing  import  pool  def  fx  return  xx  if  name  main  with  pool 5 as  p  printp
mapf 123 将在 标准输 出 中 打 印149
process 类
 在 multiprocessing 中 通 过创 建一 个 process 对 象然 后 调 用它 的 start  方 法来 生 成 进 程
 process  和 threading
thread  api 相 同
 一 个 简 单的 多进 程程 序示例 是 from  multiprocessing  import  process  def  fname  printhello  name  if  name  main  p  processtargetf  argsbob  p
join 要 显示 所 涉 及的各个 进 程 id 这 是 一 个扩 展示 例 from  multiprocessing  import  process  import  os  def  infotitle  printtitle  printmodule  name  name  printparent  process  os
join 关 于 为什 么 if  name  main 部 分是必 需 的 解释 请参 见编 程指 导
 上下 文 和 启动 方 法
 在进 程之 间交 换 对 象
multiprocessing 支 持 进 程之间的 两种 通 信通 道队 列 queue 类 是一个近似 queue
queue  的 克隆
 例如 from  multiprocessing  import  process  queue  def  fq  q
join  队列 是线 程和 进程 安全的
管 道 pipe 函 数 返回 一 个由 管道 连接 的连接 对 象 默认情 况 下 是双 工双向
例 如 from  multiprocessing  import  process  pipe  def  fconn  conn
join  返回 的两 个 连接对 象 pipe 表示 管道 的两 端
 每个连 接对 象都 有 send 和 recv 方 法相 互之 间的
 请注意如 果两个 进程 或线 程同 时 尝试读 取或 写入 管道 的同 一 端则管 道中 的数 据可 能会 损 坏
当 然在 不 同进程 中 同 时 使 用管 道的 不 同端 的情况下 不 存在 损坏 的 风险
 进程 间 同 步
对 于 所有 在 threading 存 在的 同步原 语 multiprocessing 中 都 有类似 的 等价物
 例如可 以 使用 锁 来 确保一 次只 有一 个 进程 打印 到标 准 输出 from  multiprocessing  import  process  lock  def  fl  i  l
start  不使 用锁 的 情 况下 来 自于多 进 程 的 输 出很 容易 产 生 混 淆
 进 程间 共 享状 态
如上所 述在 进 行 并 发编 程时通 常最好尽 量 避 免使用 共享 状 态
 使 用 多个 进 程 时 尤 其如 此
但 是 如果 你真的需 要使 用一 些 共 享数 据那 么 multiprocessing 提 供了 两种 方法
 共享 内存 可以 使 用 value 或 array 将 数据 存 储 在 共 享内 存映 射 中
 例如 以下 代码 from  multiprocessing  import  process  value  array  def  fn  a  n
value  printarr  将 打 印3
14159270123456789创 建 num  和 arr  时 使 用 的 d 和 i  参数 是 array  模块 使 用 的 类 型的 typecode  d  表示 双 精度 浮点 数 i  表示 有 符 号 整数
 这些 共享对 象 将 是 进 程和线 程安 全的
 为了更 灵 活地 使用共享 内存 可 以 使 用 multiprocessing
sharedctypes  模块 该模 块 支持创建 从共 享 内存 分配的 任意 ctypes  对 象
 服 务 进程由 manager  返回 的管理器对 象 控制 一 个 服务 进程 该进 程保存 python  对 象并 允 许 其他 进程 使 用 代理 操作 它 们
 manager 返 回的 管理 器 支持 类型 list 、 dict 、 namespace 、 lock 、 rlock 、 semaphore 、 boundedsemaphore 、 condition 、 event 、 barrier 、 queue 、 value 和 array 
 例如 from  multiprocessing  import  process  manager  def  fd  l  d 11 d 22 d 0
join  printd  printl  将打 印0
25 none 11229876543210使 用服务 进程 的 管 理器 比 使 用共 享 内存对 象更 灵活 因为它们 可以 支持 任 意 对象类 型
此 外单 个 管理器 可以通 过网 络由不 同 计算 机上的 进 程 共享
 但是 它 们 比使 用 共享 内存慢
使 用 工 作 进 程
pool 类 表 示一 个工作 进 程 池
它 具有允 许以几 种不 同 方式 将 任 务 分 配到 工作 进程 的方法
 例 如 from  multiprocessing  import  pool  timeouterror  import  time  import  os  def  fx  return  xx  if  name  main  start 4 worker  processes  with  poolprocesses 4 as  pool  print 014
timeouterror  printfor  the  moment  the  pool  remains  available  for  more  work  exiting  the  withblock  has  stopped  the  pool  printnow  the  pool  is  closed  and  no  longer  available 请 注意 进 程 池 的方法 只能 由创 建它的 进程 使用
 注 解这 个包中 的功能 要求 子进 程 可 以导 入 main 模 块
虽然这 在编 程 指导 中有描 述但还 是需要 提前 说明 一下
 这 意 味着 一 些示 例 在交 互式 解释 器中 不起作 用比 如 multiprocessing
pool 示 例
例如 from  multiprocessing  import  pool  p  pool 5 def  fx 
mapf 123 process  poolworker 1 process  poolworker 2 process  poolworker 3 traceback  most  recent  call  last  traceback  most  recent  call  last  traceback  most  recent  call  last  attributeerror  module  object  has  no  attribute  f  attributeerror  module  object  has  no  attribute  f  attributeerror  module  object  has  no  attribute  f 如 果尝 试执 行上面的 代 码它 会以 一 种半随 机的方式将 三个 完 整的 堆 栈内 容 交 替 输出 然后你 只能以 某种 方 式停 止父 进程
 参考
multiprocessing  包主 要复 制了 threading 模 块的 api
process  和异 常
管 道和 队列
 杂 项
activechildren 返回 当 前 进程 存活 的子 进程 的列表
调 用 该方 法 有 等待 已 经结 束的进 程的 副作 用
cpucount 返 回系 统 的 cpu 数 量
 该 数量 不同于 当 前进 程可 以 使 用的 cpu  数 量
可 用的 cpu  数量 可以 由 lenos
schedgetaffinity 0方法获得
 可能 引发 notimplementederror 
参见 os
cpucountmultiprocessing
currentprocess 返 回 与当 前进 程相对 应的 process 对象
和 threading
currentthread  相同
multiprocessing
parentprocess  返 回父 进 程 process   对象 和 父进程 调 用 currentprocess  返 回 的对象一 样
 如果一个 进 程 已经 是 主进程 parentprocess 会返 回 none
3
8 新版功能
multiprocessing
freezesupport  为使用了 multiprocessing   的程 序提 供 冻 结 以产 生 windows  可 执行 文件 的支持
 在 py 2 exe  pyinstaller 和 cxfreeze  上测 试通 过需 要 在 main  模 块的 if  name  main  该 行之 后 马上 调 用该函 数
 例如 from  multiprocessing  import  process  freezesupport  def  f  printhello  world  if  name  main  freezesupport  processtargetf
start 如 果没 有调用 freezesupport  在 尝 试 运 行被冻 结的可 执 行 文 件时 会抛 出 runtimeerror 异常
 对 freezesupport 的 调 用 在非 windows  平台上 是 无效 的
如 果 该 模 块在 windows  平 台的 python  解 释器 中 正 常运 行该程 序没 有 被 冻 结 调用 freezesupport  也 是无效 的
getallstartmethods 返 回支 持 的启 动方 法的 列 表 该列 表 的首 项即 为默 认选项
可 能的 启动 方法有 fork  spawn  和 forkserver 
 在 windows  中只有 spawn 是 可 用的
 unix  平 台 总是支持 fork 和 spawn  且 fork 是默 认值
3
4 新版 功能
getcontextmethodnone  返回 一个 context  对象
 该对 象具 有 和 multiprocessing 模 块 相 同 的 api 
如果 method  设置 成 none 那 么将返回 默认 上下 文对 象
否 则 method  应 该是 fork  spawn  forkserver 
如 果指 定的启 动方 法不 存在将 抛出 valueerror   异常
3
4 新 版功能
multiprocessing
getstartmethodallownonefalse  返 回 启 动进 程 时 使用的启 动 方法 名
 如 果启动方法 已经固 定并 且 allownone 被 设置 成 false 那 么 启动 方法 将被 固 定 为默 认的 启动 方法 并 且 返回 其 方法名
 如果启 动 方法没有 设定 并且 allownone  被设 置成 true  那 么将 返 回 none  
返 回值 将 为 fork  spawn  forkserver 或 者 none 
 fork  是 unix  的默 认 值 spawn 是 windows  的默 认值
3
4新 版功 能
multiprocessing
setexecutable  设置在 启动 子 进 程 时 使 用 的 python 解释器 路径
默 认使 用 sys
executable  嵌 入式 编程 人 员 可能 需要这 样做 setexecutableos
exe  以使他 们可以 创建子 进程
 在3
4版 更 改 现在 在 unix  平台上使 用 spawn  启 动方 法时支 持 调 用该方法
setstartmethodmethod  设置 启动子进 程的方 法
 method  可以是 fork  spawn  或者 forkserver 
 注意这最 多只能 调用一次 并 且需要 藏在 main 模块 中 由 if  name  main 进 行 保护
3
4新版功 能
注 解 multiprocessing 并 没有包含 类 似 threading
activecount  threading
enumerate  threading
settrace  threading
timer 或 者 threading
local 的 方法 和 类
 连接 connection  对 象
 同步 原 语
共 享 ctypes  对象
 管 理器
 代理对象
 代 理是 一个 指向 其他共 享对 象 的 对 象 这个 对 象很可 能在另 外一 个 进程 中
共 享对 象也可以 说 是代 理指 涉的对 象
多 个代 理对 象 可能 指向 同一 个 指涉对 象
代 理 对象代理 了指涉对 象 的 一系 列 方法 调用 虽然 并不 是 指涉 对象 的 每个方法 都有必 要 被代 理
通 过 这 种方 式代 理的 使用 方法 可 以 和它 的 指涉 对象 一样 from  multiprocessing  import  manager  manager  manager  l  manager
 l 416 l 254916 注意对代 理 使用 str 函 数 会返 回指 涉 对象 的 字符串 表示 但 是 repr 却 会 返 回代理 本身 的 内部 字符 串表 示
 被代理 的对 象很 重要的 一点是 必须 可 以 被序 列化 这样 才能允许 他 们在 进程 间 传 递
 因此 指涉对 象 可以包含 代理 对 象
这 允许 管理 器 中列 表、 字典 或 者其 他代理 对 象 对 象之 间的 嵌 套
 a  manager
list  b  manager
list  a
appendb  referent  of  a  now  contains  referent  of  b  printa  b  listproxy  object  typeid  list  at 
 b
appendhello  printa 0 b  hello  hello  类似 地 字典 和列 表代 理 也可 以相 互 嵌套 louter  manager
list  manager
dict  for  i  in  range 2 dfirstinner  louter 0 dfirstinnera 1 dfirstinnerb 2 louter 1 c 3 louter 1 z 26 printlouter 0 a 1 b 2 printlouter 1 c 3 z 26 如 果指 涉 对象包 含了普 通 list 或 dict  对 象 对这 些 内部 可 变 对 象的 修改不 会 通过管 理 器传播因 为代 理无 法得知被包 含 的值 什么 时 候 被 修 改了
 但是把 存 放在 容器代理 中的 值 本 身是 会通过管理 器 传播 的会 触发代理 对象 中的 setitem  从而 有效修 改这 些对 象所 以可 以把修 改过 的 值重 新赋值给 容器 代理 create  a  list  proxy  and  append  a  mutable  object  a  dictionary  lproxy  manager
list  lproxy
append  now  mutate  the  dictionary  d  lproxy 0 da 1 db 2 at  this  point  the  changes  to  d  are  not  yet  synced  but  by  updating  the  dictionary  the  proxy  is  notified  of  the  change  lproxy 0 d  在大 多 是使用 情 形 下 这 种实 现方 式并 不比 嵌套 代理 对象 方便 但是 依然演示了对 于同 步的 一种 控制 级别
 注 解 multiprocessing  中的 代 理类 并 没有提 供任 何对于 代 理值 比较 的 支 持
 所 以我 们 会 得到 如下 结果 manager
list 123123 false  当需要比 较 值 的时 候应该 替换为使 用 指涉 对象 的 拷 贝
class  multiprocessing
managers
baseproxy 代 理 对象 是 baseproxy 派 生类 的 实例
 callmethodmethodname  args  kwds 调用 指涉 对象 的 方 法并返回 结果
 如 果 proxy 是一 个 代 理且 其指涉 的是 obj  那 么下面 的表 达式 proxy
callmethodmethodname  args  kwds  相当于 求 取 以下表 达 式的 值 getattrobj  methodnameargs  kwds 于 管理 器进 程
 返回 结果会 是一个 值拷 贝或者 一个 新 的共享 对象 的 代理 见函 数 basemanager
register 中 关 于参 数 methodtotypeid  的文 档
如果 这 个调 用熬 出了 异 常则 这个 异 常 会被 callmethod  透传 出来
 如 果 是管 理器 进程本 身 抛出的 一些其 他异 常则会 被 callmethod 转 换为 remoteerror 异常重新 抛 出
特 别注意 如 果 methodname  没 有暴露 出 来 将 会引 发一 个异 常
 callmethod 的 一个 使用 示例 l  manager
listrange 10 l
callmethodlen 10 l
callmethodgetitem  slice 27 equivalent  to  l 2723456 l
callmethodgetitem 20 equivalent  to  l 20 traceback  most  recent  call  last 
 indexerror  list  index  out  of  range  getvalue  返回 指涉 对象 的一 份 拷贝
如果 指涉对象 无法 序 列 化 则会抛 出一 个异 常
 repr  返回 代 理 对象 的内 部字 符串 表示
 str 返 回 指 涉对象的 内部 字符 串表 示
 清理 代 理对 象使用 了一个 弱引 用回 调 函数 当 它被 垃圾回收 时会将自 己从拥有 此指涉对 象的管理 器上反注 册当共享 对象没有 被任何代 理器引用 时会被管 理 器 进程 删除
 进 程池
 监听器及 客 户端
 认 证密 码
日志
multiprocessingdummy  模 块
dummy 复 制了 multiprocessing 的 api  不过是 在 threading  模块 之 上包装了 一层
 编程 指导
 使用 multiprocessing 时 应遵 循一 些指 导原 则和 习惯用法
 所有 start  方法
spawn  和 forkserver  启动方 式
示例
创 建和 使用 自定 义管理 器、代 理的 示例 from  multiprocessing  import  freezesupport  from  multiprocessing
exposed  if  name  main  freezesupport  test 使用 pool  import  multiprocessing  import  time  import  random  import  sys  functions  used  by  test  code  def  calculatefunc  args  result  funcargs  return  s  says  that  ss  s  multiprocessing
freezesupport  test  一个演 示如何使 用 队列 来向一组 工 作进 程提 供任 务 并收集结 果的 例子 import  time  import  random  from  multiprocessing  import  process  queue  currentprocess  freezesupport  function  run  by  worker  processes  def  workerinput  output  for  func  args  in  iterinput
 互联 网数 据处理
 本章介 绍 了支持处 理互 联 网上 常用 数据 格 式的模 块
 email 电子 邮件 与 mime 处 理包 email
message 表 示一封电 子邮件 信息 email
parser  解析 电 子 邮 件 信息 feedparser  api  parser  api  附加 说明 email
errors 异 常和 缺陷类 email
contentmanager  managing  mime  content  content  manager  instances  email  示例 email
encoders  编 码 器 email
utils 其 他工具 email
iterators 迭 代器 json  json  编码 和解 码 器基本 使用 编码 器 和解 码 器异常标准 符 合性 和 互操 作性字 符编码 infinite  和 nan  数值 对 象中 的 重复 名称 顶级 非 对 象非数组 值 实 现 限制命 令行 界面 命 令行 选项 mailcap  mailcap  文件处 理 mailbox  manipulate  mailboxes  in  various  formats  mailbox 对 象 maildir  mbox  mh  babyl  mmdf  message  objects  maildirmessage  mboxmessage  mhmessage  babylmessage  mmdfmessage 异常示 例 mimetypes  map  filenames  to  mime  types  mimetypes  objects  base 64 base 16 base 32 base 64 base 85数 据 编 码 binhex 对 binhex 4 文件进 行编码和解码注 释 binascii 二进 制和 ascii  码互 转 quopri  编码 与解码 经过 mime  转 码的 可 打印 数据 uu  对 uuencode 文 件进 行编 码 与解 码
netrc  netrc 文 件处 理
 源 代码 libnetrc
pynetrc  类解 析并 封装了 unix  的 ftp 程 序和其 他 ftp  客户 端所 使用 的 netrc  文件 格 式
netrcfile  netrc 的实 例或其 子 类的 实例 会 被用来封 装来自 netrc 文 件的 数据
 如果 有初始 化参 数它将 指明 要 解 析的 文件
如 果未 给 出参 数则 位于 用 户 家目录的
netrc  文 件即 os
expanduser  所 确定 的文 件将会 被 读取
 在 其他 情况 下则 将 引发 filenotfounderror 异常
 解析错 误将引 发 netrcparseerror 并附 带诊断信息 包括 文件名、行 号 以 及 终止 令 牌
如 果在 posix  系 统上 未指 明参数 则当
netrc  文件 中 有 密码 时 如果文件 归 属 或权 限不 安 全归 属的用 户不 是运 行 进 程的用 户或 者可 供 任何 其他 用 户读 取 或 写入 将引 发 netrcparseerror
这实 现了与 ftp 和其 他使用
netrc  的 程序 同 等的安全行 为
 在3
4版 更改 添 加 了 posix  权 限检 查
在3
7版 更 改当未将 file  作为 参数传 入 时会 使用 os
expanduser  来 查找
netrc 文件 的位 置
netrcparseerror 当 在源文 本中 遇到 语法 错误 时由 netrc 类引发的 异 常
 此异 常的 实例 提供 了 三个 有用 属性 msg 为错误 的文 本说明 filename  为源文件 的 名称 而 lineno  给出 了错误 所在 的 行 号
netrc  对象
netrc  实 例具 有下 列方 法 netrc
authenticatorshost 针 对 host  的身 份验证者 返回 一 个3 元 组 login  account  password
如果 netrc 文 件不 包含 针对 给定主 机 的条目则 返 回 关联到 default  条目 的元 组
 如果匹配 的 主机 或 默 认条目均 不可 用 则返 回 none
repr 将 类数 据以 netrc  文件 的 格式转 储为一个 字符串
这 会 丢弃注释 并可能重 排条目顺 序
netrc 的实例 具有 一些 公共 实例 变 量 netrc
hosts 将 主机名映 射到 login  account  password  元组的 字典
 如果存在 default 条 目则会表示 为使用该 名称的伪 主机
macros 将宏 名称 映射 到字 符 串列 表的 字典
注解密 码 会 被 限制 为 ascii 字 符集 的 一 个 子集
 所有 ascii 标 点符号均可 用作密码但 是要注意 空 白 符和非打印 字 符不允许 用作 密码
 这 是
netrc  文件 解析方 式 带 来的 限制在未来 可能 会被解 除
nis  sun 的 nis 黄页 接口
nis  模块 提 供 了对 nis  库的轻 量 级包 装适 用 于 多个 主 机的 集中管 理
 因为 nis 仅存 在于 unix 系 统 此模 块仅 在 unix 上可用
nis  模 块 定 义了 以 下函 数 nis
matchkey  mapname  domaindefaultdomain 返回 key 在 映射 mapname 中 的匹配结 果 如无 结 果则 会引发 错误 nis
error
 两 个参 数 都应 为字符串 key  定长8个比 特
返回 值为 任意字 节数组可包 含 null 和其 他 特殊 值
请注意如 果 mapname 是 另一 名称 的 别名 则会先检查 别 名
 domain 参数 可允 许 重载 用于 查 找的 nis 域
如果 未指 定 则会 在默认 nis 域中 查找
catmapname  domaindefaultdomain  返 回一个字典 其 元 素 为 key 到 value 的映射 使 得 matchkey  mapnamevalue
 请注 意 字 典 的键 和值 均为任意 字 节 数组
 请注 意 如果 mapname  是另一名 称的 别名 则会先 检查 别名
 domain 参 数 可 允许 重载用 于查 找的 nis 域
如 果未 指定 则会 在默认 nis 域 中查找
mapsdomaindefaultdomain 返 回全部可 用映射的 列表
 domain 参数 可允许 重载 用于查 找的 nis 域
如果 未指定 则 会在 默认 nis 域中查 找
getdefaultdomain 返 回系 统默 认 的 nis 域
nis  模块定义了 以 下异常 exception  nis
error  当 nis 函 数 返回 一个 错 误码时 引发 的 异常
nntplib  nntp  protocol  client
在3
2版更 改 usenetrc  is  now  false  by  default
在3
3 版 更改支持了 with  语 句
 在3
9 版更改 if  the  timeout  parameter  is  set  to  be  zero  it  will  raise  a  valueerror  to  prevent  the  creation  of  a  nonblocking  socket
3
2新版 功 能
 在3
4版 更 改 the  class  now  supports  hostname  check  with  ssl
 在3
9 版 更 改 if  the  timeout  parameter  is  set  to  be  zero  it  will  raise  a  valueerror  to  prevent  the  creation  of  a  nonblocking  socket
nntp  objects
attributes
3
2新 版功能
3
2新 版 功 能
方 法
在3
2 版 更改 many  of  the  following  methods  have  been  reworked  andfixed  which  makes  them  incompatible  with  their 3
1 counterparts
getcapabilities  true 3
2 新版功能
3
2 新版 功能
3
2 新版功 能
在3
4 版更改 the  method  now  supports  hostname  check  with  ssl
 在3
2 版 更改 grouppattern  was  added
de 3
2 新版功 能
工 具函数
numbers 数 字的 抽象 基类
 源代码 libnumbers
pynumbers 模 块 pep 3141定义了 数字抽象 基类 的 层次 结构其 中逐 级定 义了 更多 操 作
此 模 块中 所 定 义 的类 型 都不 可 被实例 化
number 数 字的 层 次结 构的基 础
如 果你 只想 确认 参 数 x 是 不 是数 字 而 不 关心 其 类型 则 使用 isinstancex  number
数 字的 层次
complex  内置 在类 型 complex  里的子 类描 述了 复 数 和它 的运 算操 作
这 些操 作 有转 化至 complex  和 bool  real 、 imag 、、、、、 abs 、 conjugate 、 和
 所有的 异常 和 都是抽 象的
 real  抽象的
 得到 该数 字的实 数 部分
 imag 抽 象 的
 得到该 数字的 虚数 部分
 abstractmethod  conjugate  抽象 的
返 回共轭复 数
例如13 j
real 相 对于 complexreal 加 入 了只有实 数才 能进 行的 操 作
简 单的说 它们是转化 至 floatmath
trunc 、 round 、 math
floor 、 math
ceil 、 divmod 、、、、、、和
实数 同 样默 认支 持 complex 、 real 、 imag 和 conjugate
rational  子类 型 real 并加入 numerator  和 denominator  两 种 属性这 两种属 性应 该 属 于最低的 级别
 加入 后 这 默认支持 float
 numerator  摘要
 denominator  摘要
integral  子类型 rational  加 上转 化至 int
 默认支持 float 、 numerator 和 denominator
 在中加 入 抽 象方法和 比特 字 符串 的操作、、、、、
 类型接 口注 释。
实 现 者需 要注意 使相 等 的数 字相等 并拥有同 样的值
当 这两 个数使 用不 同的扩 展 模块 时这 其中 的差 异是很 微妙 的
例 如 用 fractions
fraction 实 现 hash 如 下 def  hashself  if  self
加入 更 多数字的 abc
 当然这里 有 更多 支持 数字 的 abc 如 果不 加入 这些就 将缺 少层 次 感
你 可以 用如下 方 法在 complex 和 real 中 加入 myfoo  class  myfoocomplex 
实现 算 数运 算
我 们希 望 实现 计 算因 此混 合 模式操 作 要么 调 用 一个作 者知道 参 数类型的 实现 要 么转 变 成为 最 接近 的内 置 类型 并对 这个执行 操 作
 对于 子 类 integral  这意 味着 add 和 radd  必须 用如下 方式定 义 class  myintegralintegral  def  addself  other  if  isinstanceother  myintegral  return  domyaddingstuffself  other  elif  isinstanceother  othertypeiknowabout  return  domyotheraddingstuffself  other  else  return  notimplemented  def  raddself  other  if  isinstanceother  myintegral  return  domyaddingstuffother  self  elif  isinstanceother  othertypeiknowabout  return  domyotheraddingstuffother  self  elif  isinstanceother  integral  return  intother  intself  elif  isinstanceother  real  return  floatother  floatself  elif  isinstanceother  complex  return  complexother  complexself  else  return  notimplementedthere  are 5 different  cases  for  a  mixedtype  operation  on  subclassesof  complex
如 果 a  被 定义成一 个承认 b 的 add 一 切都没有 问题
如果 a  转回成模 板 失 败它 将 返回一 个 属 于 add 的 值我 们需 要 避免 b  定 义 了 一 个更加 智能 的 radd 因此模 板需要返回一 个属 于 add  的 notimplemented 
或 者 a 可 能完全不实 现 add 
3
接 着 看 b 的 radd 
 如果它 承认 a  一 切 都没有问 题
如 果没 有成 功回 退到 模 板就没有 更 多 的 方 法 可 以去 尝 试因 此 这里 将使 用默认的实 现
 如果 b  a  python 在 a
add 之 前 尝试 b
radd 
 这 是可 行的是 通 过 对 a 的认 识 实 现的 因此这可以 在交 给 complex 处 理 之前 处 理这 些 实 例
如果 a  complex  和 b  real  没 有 共 享任何 资源 那么 适当的 共享 操作 涉 及内 置的 complex  并且分 别 获 得 radd 因此 ab  ba
 由 于 对 任 何一直类 型的大部 分操作是 十分 相似 的可 以定义 一个 帮助 函 数即 一个 生成后 续 或 相反的 实 例 的 生 成器
例如 使用 fractions
fraction 如下 def  operatorfallbacksmonomorphicoperator  fallbackoperator  def  forwarda  b  if  isinstanceb  int  fraction  return  monomorphicoperatora  b  elif  isinstanceb  float  return  fallbackoperatorfloata  b  elif  isinstanceb  complex  return  fallbackoperatorcomplexa  b  else  return  notimplemented  forward
 数字和数 学模 块
operator 标 准 运算 符替代 函数
将 运算符 映射 到函数
 以 下表 格 显示了 抽象 运 算是如何 对 应于 python 语法 中的 运 算 符和 operator 模 块中 的 函数的
 运算 语法函 数加法 a  b  adda  b  字 符 串拼 接 seq 1 seq 2 concatseq 1 seq 2包含 测试 obj  in  seq  containsseq  obj  除法 a  b  truediva  b 除 法 a  b  floordiva  b  按位 与 a  b  anda  b 按 位异或 a  b  xora  b 按 位取反 a  inverta 按 位或 a  b  ora  b 取幂 a  b  powa  b  标识 a  is  b  isa  b  标 识 a  is  not  b  isnota  b 索 引赋值 objk  v  setitemobj  k  v  索 引 删 除 del  objk  delitemobj  k  索 引 取 值 objk  getitemobj  k  左移 a  b  lshifta  b  取 模 a  b  moda  b 乘法 a  b  mula  b 矩 阵 乘 法 a  b  matmula  b 取 反算术 a  nega 取反 逻 辑 not  a  nota  正数 a  posa  右移 a  b  rshifta  b  切 片赋值 seqij  values  setitemseq  slicei  j  values  切片删除 del  seqij  delitemseq  slicei  j 切 片 取 值 seqij  getitemseq  slicei  j 字 符串格 式化 s  obj  mods  obj  减 法 a  b  suba  b 真 值测 试 obj  truthobj  比较 a  b  lta  b 比 较 a  b  lea  b  相 等 a  b  eqa  b  不等 a  b  nea  b 比较 a  b  gea  b 比 较 a  b  gta  b 
 原地 运 算符
许多 运 算都有原 地版 本
 以 下列出的是 提 供 对原 地运算 符相比通常 语法更 底 层 访问的函数 例如 statement  x  y  相当 于 x  operator
iaddxy
换一 种方 式来讲 就 是 z  operator
iaddx  y 等 价于 语句块 z  x  z  y
在 这些例子 中请注意 当调用一 个 原 地 方法 时 运算和 赋值是分 成 两个 步骤 来执 行的
 下 面列出的 原 地函数只 执行 第一 步即 调用原地 方 法
第二步 赋值 则 不 加处理
对 于不 可变的目 标例如字 符 串、数 字 和 元组 更新 的值 会 被计算 但不 会被 再被赋值 给输 入变 量 a  hello  iadda  worldhello  world  ahello  对 于 可变 的目标例 如列表 和字 典原地 方 法 将执 行 更 新因 此不需 要 后续 赋 值操作 s  h  e  l  l  o  iadds  w  o  r  l  dh  e  l  l  o  w  o  r  l  d  sh  e  l  l  o  w  o  r  l  doperator
iadda  b  a  iadda  b 等价于 a  b
ianda  b  a  ianda  b  等价 于 a  b
iconcata  b  a  iconcata  b 等 价于 a  b 其 中 a  和 b 为 序列
ifloordiva  b  a  ifloordiva  b  等价 于 a  b
ilshifta  b  a  ilshifta  b 等 价 于 a  b
imoda  b  a  imoda  b  等价于 a  b
imula  b  a  imula  b 等价 于 a  b
imatmula  b  a  imatmula  b 等价 于 a  b
3
5新 版功 能
iora  b  a  iora  b 等价 于 a  b
ipowa  b  a  ipowa  b 等 价 于 a  b
irshifta  b  a  irshifta  b  等价于 a  b
isuba  b  a  isuba  b  等 价于 a  b
itruediva  b  a  itruediva  b 等 价于 a  b
ixora  b  a  ixora  b 等价 于 a  b
optparse  解析 器 的命令 行 选 项
 源代码 liboptparse
py 3
2版 后已移除 the  optparse  module  is  deprecated  and  will  not  bedeveloped  further  development  will  continue  with  the  argparsemodule
 背景
术语
 参数 a  string  entered  on  the  commandline  and  passed  by  the  shell  to  execl  or  execv
选项 an  argument  used  to  supply  extra  information  to  guide  or  customize  the  execution  of  a  program
 可选参 数 an  argument  that  follows  an  option  is  closely  associated  with  that  option  and  is  consumed  from  the  argument  list  when  that  option  is
positional 参数 something  leftover  in  the  argument  list  after  options  have  been  parsed  i
必 选选 项 an  option  that  must  be  supplied  on  the  commandline  note  that  the  phrase  required  option  is  selfcontradictory  in  english
what  are  options  for
 位置 位置
教 程
parseargs 返 回两个 值 options  an  object  containing  values  for  all  of  your  options  e
understanding  option  actions
the  store  action
 例如 parser
handling  boolean  flag  options
other  actions
some  other  actions  supported  by  optparse  arestoreconst  store  a  constant  valueappend  append  this  options  argument  to  a  listcount  increment  a  counter  by  onecallback  调用指 定函数 these  are  covered  in  section  参考指 南 and  section  option  callbacks
默 认值
addoptionq  actionstorefalse  destverbose  defaulttrue  考虑一 下 parser
generating  help
printing  a  version  string
how  optparse  handles  errors
putting  it  all  together
参 考 指 南
创建 解 析器
 usage 默 认 prog  options  the  usage  summary  to  print  when  your  program  is  run  incorrectly  or  with  a  help  option
 optionlist 默认 a  list  of  option  objects  to  populate  the  parser  with
 optionclass 默 认 optparse
 version  默认 none  a  version  string  to  print  when  the  user  supplies  a  version  option
 conflicthandler  默 认 error  specifies  what  to  do  when  options  with  conflicting  option  strings  are  added  to  the  parser  see  section  conflicts  between  options
 description 默认 none  a  paragraph  of  text  giving  a  brief  overview  of  your  program
 addhelpoption  默 认 true  if  true  optparse  will  add  a  help  option  with  option  strings  h  and  help  to  the  parser
 epilog  默 认 none  a  paragraph  of  help  text  to  print  after  the  option  help
填充解 析器
addoption  as  shown  insection 教程
 定义选项
 the  standard  option  actions  hardcoded  into  optparse  are  store  存储此选 项的参数 默认 storeconst  store  a  constant  value  storetrue  store  true  storefalse  store  false  append  append  this  options  argument  to  a  list  appendconst  将常量值 附加 到列 表 count  increment  a  counter  by  one  callback 调 用指定函数 help  打印用 法消息包括 所有 选项和文 档 if  you  dont  supply  an  action  the  default  is  store
option  attributes
action 默认 store  determines  optparses  behaviour  when  this  option  is  seen  on  the  command  line  the  available  options  are  documented  here
type 默 认 string  the  argument  type  expected  by  this  option  e
nargs 默认1 how  many  arguments  of  type  type  should  be  consumed  when  this  option  is  seen
 see  section 教 程 for  an  example
standard  option  actions
示例 parser
示 例 parser
 示例 parser
 示 例 parser
示 例 parser
示 例 from  optparse  import  optionparser  suppresshelp  usually  a  help  option  is  added  automatically  but  that  can  be  suppressed  using  the  addhelpoption  argument  parser  optionparseraddhelpoptionfalse  parser
standard  option  types
 解析参 数
parseargsargsnone  valuesnone  输 入 参 数的 位 置 args  the  list  of  arguments  to  process  default  sys
querying  and  manipulating  your  option  parser
conflicts  between  options
setconflicthandlerhandlerthe  available  conflict  handlers  are  error  默 认 assume  option  conflicts  are  a  programming  error  and  raise  optionconflicterror  resolve  resolve  option  conflicts  intelligently  see  belowas  an  example  lets  define  an  optionparser  that  resolves  conflictsintelligently  and  add  conflicting  options  to  it  parser  optionparserconflicthandlerresolve  parser
清理
other  methods
option  callbacks
defining  a  callback  option
how  callbacks  are  called
raising  errors  in  a  callback
callback  example 1 trivial  callback
callback  example 2 check  option  order
callback  example 3 check  option  order  generalized
callback  example 4 check  arbitrary  condition
callback  example 5 fixed  arguments
callback  example 6 variable  arguments
extending  optparse
adding  new  types
adding  new  actions
ospath 常 用 路径 操 作
os 多 种操作系 统接 口
文件名 命令 行参 数以及 环境 变量。
 在 python  中使用 字符串类 型表 示 文件 名、命 令行参数 和 环境 变量
在 某些 系 统上 在将 这 些字符 串传 递给操 作系 统 之 前必须将这 些字 符串 解码 为 字 节
python 使 用文件系 统 编码来执行此 转 换请参 阅 sys
getfilesystemencoding 
在3
1 版 更改 在 某些 系统 上 使 用 文件 系 统 编码 进 行转换 可能会失 败
在这 种情况下 python  会 使 用代 理转义 编 码错 误处理 器这意 味着在 解码 时不 可解 码 的 字 节 被 unicode 字 符 udcxx 替换 并且这 些字 节在 编 码时 再次转换 为 原始 字 节
 文件 系统 编 码必 须保 证成 功 解码 小 于128的所 有 字节
如 果文件 系统 编 码 无法 提供 此 保证 api  函 数可能会 引发 unicodeerrors 
 进程 参 数
 创 建 文件对象
 这 些 函数 创建新 的 file  objects 
参 见 open 以获 取打开文 件描 述 符 的相 关 信 息
os
fdopenfd  args  kwargs  返 回 打开 文件 描 述 符 fd 对 应 文件 的对象
 类似 内建 open 函数 二 者 接 受同 样 的参数
 不同 之处在于 fdopen  第 一个 参 数应该 为 整 数
 文件描 述符操 作
查 询终端的 尺 寸
3
3 新 版功 能
getterminalsizefdstdoutfileno  返回终 端窗 口的 尺 寸 格式为 columns  lines 它是 类 型为 terminalsize  的 元组
可 选参 数 fd  默认为 stdoutfileno  或 标准输 出指定 应查 询的 文件 描述 符
如 果 文 件描 述符 未连 接 到终 端 则 抛 出 oserror 异 常
getterminalsize  是供常规 使用的高 阶函 数 os
getterminalsize  是 其底 层的 实现
可用 性 unix  windows
terminalsize  元组 的子类 存储 终 端窗口 尺 寸 columns  lines
 columns  终端 窗口的宽 度单位为 字符
 lines 终端窗 口 的高度 单 位 为字 符
文 件描 述 符的 继承
3
4 新 版功能
每个文 件描 述 符都 有一 个 inheritable 可 继承 标志 位 该标志 位控 制了文件 描述 符是否可 以由 子进 程 继承
 从 python 3
4 开 始由 python  创建的文 件 描述 符默认是 不可 继承 的
 在 unix 上 执行 新程 序时 不可 继承 的 文件 描 述 符在 子 进 程中 是 关闭的 其他 文件 描述符将 被继 承
在 windows  上不可继 承的 句 柄 和文件 描述 符在 子进程中是 关 闭 的 但标 准流 文件 描述符0、1和2 即标准 输 入、标 准输 出和标 准错误是 始终 继承的
如 果 使 用 spawn 函数所有 可 继 承 的句柄和 文件 描述 符 都 将被继承
 如果 使用 subprocess 模块将 关闭 除标 准流以 外的 所 有 文件 描 述符 并且仅当 closefds  参数 为 false 时才继 承 可 继 承的句 柄
getinheritablefd 获取 指定 文件描述符 的可继承标志位为 布尔值
setinheritablefd  inheritable 设 置指定文件描述符 的可 继承标志 位
gethandleinheritablehandle  获 取 指定句 柄的可继 承标志位为布尔值
可用 性 windows
sethandleinheritablehandle  inheritable  设置指 定句柄的 可继承 标志位
 可用 性 windows
文 件 和目录
linux 扩 展 属性
进程 管 理
 调 度器 接口
这些函 数 控制 操作系统 如 何 为 进 程分 配 cpu 时 间
它 们仅在 某些 unix  平台上可用
 更多 细节信 息 请查阅你所用 unix 的 指南 页面
3
3 新版功能
 以下调度策 略如 果被操作 系统支持就会对外公开
schedother 默 认调度 策略
schedbatch 用于 cpu  密集 型进程的 调度策略它会尽量为计算 机中的 其余任 务 保 留交互性
schedidle  用 于 极低优先级 的后 台任务的 调度策略
schedsporadic 用于偶发型服务 程序的 调度策略
schedfifo  先进 先出的调 度策略
schedrr 循环式的调度策略
schedresetonfork  此旗 标可与任 何其他调度策略进 行 or  运算
当带 有 此 旗标的进程 设置 分 叉时其子 进程的 调度策略和 优先 级 会被重置 为默认 值
schedparamschedpriority 这个类表 示在 schedsetparam  schedsetscheduler  和 schedgetparam  中使用的 可修改 调度形参
它 属于 不 可变对象
 目前它 只有一个可 能的 形参 schedpriority 一个 调度策略的调度优先级
schedgetpriorityminpolicy 获 取 policy 的 最小优先 级数值
 policy 是以上调度 策略 常量之一
schedgetprioritymaxpolicy  获取 policy 的最高优先级数值
 policy  是以上调度 策略 常量之一
schedsetschedulerpid  policy  param 设置 pid 为 pid 的 进程 的调度策 略
pid 为0指的是调用本方法的 进程
policy  是以上调 度策略常量之一
param 是 一个 schedparam  实例
schedgetschedulerpid 返回 pid  为 pid 的 进程的调 度策略
pid 为0 指的 是调用本 方 法 的 进程
返 回的结 果是 以上调度 策略常量之一
schedsetparampid  param 设 置 pid 为 pid  的进程的 某个调度参数
pid 为0指 的是 调用本方 法的进程
param 是一个 schedparam 实例
schedgetparampid 返回 pid  为 pid 的 进程的调 度参数为一个 schedparam 实例
pid  为0 指的是调 用 本 方法的进程
schedrrgetintervalpid  返回 pid  为 pid  的进程在 时间片 轮转调度下 的时 间 片长度单 位为秒
pid  为0指的是调 用本 方 法的进程
schedyield  自愿放 弃 cpu
schedsetaffinitypid  mask 将 pid 为 pid 的进 程为 零 则为当前 进程限 制 到一 组 cpu 上
mask  是整 数的可迭 代对象表示应将进程限制 在其 中的一 组 cpu
schedgetaffinitypid  返回 pid 为 pid 的进程为零 则为 当前进程 被限制到的那一 组 cpu
其他系统信息
 随机数
getrandomsize  flags 0 获得最多为 size 的随机 字节
 本函数返 回的字节数可能少于请求 的字 节数
这 些 字节可用于为用户 空间 的随 机数 生 成器提 供种 子或 用于加密目的
 getrandom 依赖于从 设 备驱 动程序和 其他 环境噪声 源 收 集 的熵
不 必 要地读取 大 量数据 将对使用 devrandom 和 devurandom 设备的其他用 户产生 负面影响
 flags  参数是 一个位 掩码 可以 是 零个 或多 个下 列值以或 运算组 合 os
grndrandom  和 grndnonblock
另 请 参 阅 linux  getrandom  手册 页
 可 用 性 linux 3
17或更 高 版 本
3
6 新版功能
urandomsize 返回大小 为 size 的 字符 串它是适 合加密 使用 的随机字 节
 本函 数从 系 统 指 定 的随机 源 获取 随机字节
对于 加密 应用 程序返 回 的数 据应 有足够的 不 可预测 性尽 管其 确 切的品质 取 决于 操 作系统的 实现
 在 linux 上如果 getrandom  系统调用 可用它 将 以阻塞 模 式使用阻 塞直 到系统的 urandom 熵 池初 始化 完毕内 核收集了128 位熵
 原 理 请参阅 pep 524
 在 linux 上 getrandom  可以以 非阻塞 模式 使 用 grndnonblock 标志 获取随机 字节 或者轮 询 直到 系统的 urandom 熵 池初始化 完 毕
 在类 unix 系 统 上随机 字节是从 devurandom  设备读取 的
 如 果 devurandom 设备 不 可用或 不可读则 抛出 notimplementederror 异常
 在 windows  上将 使用 cryptgenrandom
参 见 secrets  模块提 供 了更高 级的功能
 所在 平 台会提供 随机 数生成器 有关 其 易于使用 的接 口请参 阅 random
 在3
0版更 改在 linux 上 getrandom 现 在以阻塞 模式 使 用以提 高 安全 性
在3
2 版更 改在 linux  上如果 getrandom  系统调用 阻塞 urandom  熵池尚 未初 始化 完 毕则退回 一步读 取 devurandom
 在3
5版 更改在 linux 3
17 和 更 高版 本上 现在 使用 getrandom 系 统调用 如果 可用
 在 openbsd 5
6 和更 高版 本上现 在使 用 getentropy  c  函数
 这些函 数避 免了使 用内部 文件 描 述 符
grndnonblock 默认 情 况 下从 devrandom  读取 时如 果 没有 可用 的随 机 字节则 getrandom 会阻 塞 从 devurandom 读取 时 如 果熵 池尚 未初 始化 则会 阻塞
 如果设 置 了 grndnonblock 标 志 则这些情 况 下 getrandom 不 会阻 塞而是 立即 抛 出 blockingioerror  异常
3
6新 版功 能
grndrandom 如 果 设置 了此标 志 位那 么 将从 devrandom  池而 不 是 devurandom  池中 提 取 随机 字 节
3
6 新 版功 能
ossaudiodev  access  to  osscompatible  audio  devices
在3
3 版更 改 此 模块中过 去会 引 发 ioerror 的操 作现在 将引 发 oserror
参 见 open  sound  system  programmers  guide  the  official  documentation  for  the  oss  c  api  the  module  defines  a  large  number  of  constants  supplied  by  the  oss  device  driver  see  syssoundcard
audio  device  objects
 在3
5 版更 改现 在 支持 可 写 的 字 节 类对 象
在3
5 版更 改 现在 支持 可 写的 字 节类对象
 在3
2版 更改 audio  device  objects  also  support  the  contextmanagement  protocol  i
 some  of  the  formats  supported  by  oss  are 文 件格式 描述 afmtmulaw  a  logarithmic  encoding  used  by  sun 
 common  rates  are  采样率 描述8000 devaudio 的 默认 采样 率11025语 音录 音2205044100 cd 品 质的 音频16 位 采 样和2 通 道96000 dvd 品质 的音 频24位采样 ossaudiodevice
mixer  device  objects
 在3
2版更改 mixer  objects  also  support  the  context  managementprotocol
 其他图 形用 户界面 gui  包
parser 访问 python  解析 树
警 告 parser  模块 已 被弃 用 并将 在未来 的 python  版本 中移除
对于 大 多数 用例你 都可 以使 用 ast  模块来 控制 抽 象语法 树 ast  的 生成和 编 译阶 段
 for  full  information  on  thelanguage  syntax  refer  to  python 语 言参考
 the  parser  itself  iscreated  from  a  grammar  specification  defined  in  the  filegrammargrammar  in  the  standard  python  distribution
 参见 模 块 symbol  代表 解析 树内部节点 的有 用 常 量
模 块 token  代表 解析 树叶 子 节点 和 测试节 点 值的 函数 的有用 常量
 创 建 st  对象
 转换 st  对 象
queries  on  st  objects
 异常 和 错误处 理
st 对 象
st 对象 具有以 下 方法 st
compilefilenamesyntaxtree  和 compilestst  filename 相 同
isexpr 和 isexprst  相 同
issuite  和 issuitest  相同
tolistlineinfofalse  colinfofalse  和 st 2 listst  lineinfo  colinfo 相 同
totuplelineinfofalse  colinfofalse  和 st 2 tuplest  lineinfo  colinfo 相 同
示例 compile  的模拟
pathlib  面向对象 的文 件系 统路径
3
4 新版 功能
源 代码 libpathlib
py  该 模 块提 供表 示文件 系统 路径 的类 其语义 适用于 不同 的操作系 统
路 径类 被分 为提 供纯 计算操作 而 没 有 io 的 纯路径以 及从 纯路 径继承而 来但 提 供 io 操 作的 具体 路 径
 图片 如 果 你 以 前从 未使 用过此 模块或 者不 确定 在 项目 中使 用哪一个 类是正 确的则 path  总是你 需要 的
它 在 运行 代码 的 平台上 实例 化为一 个具 体 路 径
 在一 些 用例 中 纯路径很 有用 例 如1
如 果 你想要 在 unix  设备 上 操作 windows 路 径或 者相 反
你 不 应在 unix 上实例 化一个 windowspath 但 是 你 可以 实 例 化 purewindowspath 
你 只想 操 作路径 但不 想实 际访问 操 作 系统
在这种 情 况 下实例 化一 个纯 路径 是有用 的 因为它 们没 有 任何访 问 操 作 系 统 的 操 作
 参见 pep 428 pathlib  模块面向 对象 的的 文 件系 统路 径
参见对于 底层 的路 径字 符串 操 作你 也可以 使用 os
path 模 块
基 础使 用
 导入 主类 from  pathlib  import  path 列 出 子 目录 p  path
hg  posixpathdocs  posixpathdist  posixpathpycache  posixpathbuild  列出 当前 目录树下 的所有 python  源代码 文 件 listp
py  在目 录 树中移 动 p  pathetc  q  p  init
dhalt 查 询路 径 的属性 q
isdir  false 打 开 一个 文 件 with  q
纯 路径
通 用性 质
 路 径 是 不可 变并 可哈 希的
 相同 风格 的路 径可 以排序 与比 较
这些 性质尊 重对 应风 格 的大 小写转 换语 义 pureposixpathfoo  pureposixpathfoo  false  purewindowspathfoo  purewindowspathfoo  true  purewindowspathfoo  in  purewindowspathfoo  true  purewindowspathc  purewindowspathd  true  不 同风 格的 路径比 较得到不 等 的结 果并 且无法 被排序 purewindowspathfoo  pureposixpathfoo  false  purewindowspathfoo  pureposixpathfoo  traceback  most  recent  call  last  file  stdin  line 1 in  module  typeerror  not  supported  between  instances  of  purewindowspath  and  pureposixpath
 运算符
访 问个 别 部分
 为了访 问路 径独 立的 部分 组件使用以 下特 征 属性 purepath
parts 一个 元 组可以访 问路径 的 多 个组 件 p  purepathusrbinpython 3 p
parts  c  program  files  psf  注意 盘符和 本 地 根 目 录是 如何 重组的
方 法和 特征 属 性
 具体 路 径
 具体 路 径是纯路 径 的子 类
 除了 后者提 供的 操作 之外 它们 还提 供了 对路径 对象 进行 系 统 调 用的 方法
 有三种 方法可 以 实例 化具 体路 径 class  pathlib
pathpathsegments 一 个 purepath  的子 类 此类 以 当 前 系统 的 路径 风 格 表 示 路 径 实 例 化 为 posixpath 或 windowspath  pathsetup
py  pathsegments  参数的指 定和 purepath  相同
posixpathpathsegments  一个 path  和 pureposixpath 的子类 此类 表 示 一个 非 windows 文 件 系 统的 具 体 路径 posixpathetc  posixpathetc  pathsegments  参 数的 指 定和 purepath  相同
windowspathpathsegments  path  和 purewindowspath  的 子类 从类 表示 一 个 windows 文件 系统的 具体 路 径 windowspathcprogram  files  windowspathcprogram  files  pathsegments  参数 的指 定 和 purepath  相同
你 只 能 实例 化 与当 前系 统 风格相 同 的 类 允 许系 统 调用 作用于 不兼 容的路 径 风 格 可能 在应用 程序 中导 致缺 陷或 失败 import  os  os
 方法
 除 纯 路径方 法外 实体 路径 还提 供以 下 方法
 如果 系统 调用 失败例如 因为 路径 不存 在这 些 方 法 中许 多都 会引 发 oserror
 在3
8 版 更 改 对 于 包 含 os  层 级无法 表 示 字符 的路 径 existsisdir  isfile  ismount  issymlinkisblockdevice  ischardevice  isfifo  issocket  现 在 将返回 false  而不 是引 发 异 常
cwd  返回一 个新 的表 示当 前 目录的路径对象 和 os
getcwd  返回 的相 同 path
home 返回 一 个 表示 当 前 用户家目 录的 新路 径 对象 和 os
expanduser 构 造含路 径返回 的相同 path
home  posixpathhomeantoine 3
5 新版 功能
stat  返回 一 个 os
statresult  对 象其 中 包 含有 关此 路径 的 信息 例如 os
 结 果 会在 每次 调用此方 法时 重新搜 索
chmodmode 改 变 文件 的 模 式和 权限 和 os
chmod  一样 p  pathsetup
exists  此路 径是 否指 向一 个已 存 在的 文件 或 目录 path
exists  false  注 解如 果 路 径指 向一 个符 号 链接 exists  返回 此 符号 链 接 是否 指 向 存 在的 文 件或 目 录
expanduser  返回展开 了 包含和 user 的 构造就 和 os
expanduser  一 样 p  posixpathfilmsmonty  python  p
expanduser  posixpathhomeericfilmsmonty  python 3
5 新版 功能
globpattern  解 析 相对 于此 路径 的 通 配 符 pattern 产 生所 有匹 配 的 文件 sortedpath
py  模 式表 示此目录 以 及 所 有 子目录 递 归
 换 句话 说它 启用 递归 通 配 sortedpath
py 注 解在一 个较大 的目 录树 中 使 用模 式 可能 会消 耗非 常 多 的时 间
引发一 个审计 事件 pathlib
glob  附 带 参数 self  pattern
group  返回 拥 有 此 文 件的 用户组
 如果 文件的 gid  无法 在系 统 数据 库中 找到 将抛 出 keyerror 
isdir 如 果 路 径指 向一 个目 录 或者 一个 指向 目录 的 符 号 链 接 则返 回 true  如 果 指 向其 他 类型 的 文件 则返 回 false
当 路 径 不 存 在或 者是 一个 破损 的 符 号 链 接 时也 会 返 回 false  其他错误例如 权 限错误 被传 播
isfile 如 果路 径 指 向一 个正 常的 文件 或 者一个 指 向正 常 文件 的符 号链 接则 返回 true  如果 指向其 他类 型 的文 件则 返 回 false
当 路径 不存 在或 者是 一个破 损 的 符 号链 接时 也会返回 false  其他 错误 例如 权限 错误 被传播
ismount  如果 路径 是一 个 挂 载点 mount  point  在文 件系 统中 被 其 他 不同 的文 件 系 统 挂载 的地 点
在 posix  系统 此 函数 检查 path  的 父级—— path
 是 否处 于 一 个 和 path 不 同 的 设 备 中 或 者 filepath
 和 path 是 否指 向相 同设备 的相 同 inode ——这能 检测所 有 unix 以 及 posix  变种 上的 挂载 点
 windows  上 未实 现
3
7新 版 功能
issymlink  如果 路径 指向 符号 链接 则 返 回 true 否 则 false
 如果 路径 不存 在也 返 回 false  其 他错 误例 如权 限错 误被 传播
issocket  如果 路 径 指向 一个 unix  socket  文件或 者指 向 unix  socket 文 件的 符号 链 接则 返回 true  如果 指向 其他 类型 的文 件则 返回 false
 当路 径 不存 在或 者是 一个 破损 的符 号链 接 时也 会返 回 false 其 他 错 误 例如 权限错 误 被传 播
isfifo 如果 路径 指 向 一 个先 进 先 出存 储 或者 指 向 先 进 先出存储的 符 号链接则 返 回 true 指向 其 他类型 的 文件则 返 回 false
当路 径 不存在 或者 是一 个破损的 符号 链接时也 会 返回 false  其他错 误例 如权限错误 被传 播
isblockdevice 如 果文件 指 向一 个块 设备 或 者 指向块 设备 的 符 号 链接 则返 回 true 指向 其他 类型的文 件 则返 回 false
当 路径 不存 在 或 者 是 一个 破损 的符号 链接 时 也会 返 回 false 其 他错 误 例如权 限 错 误被 传播
ischardevice  如果路径 指 向 一 个 字符 设备 或 指 向字 符设 备 的符 号 链接则返回 true  指 向 其他 类型的 文件则 返回 false
当路径 不存在 或 者是一个 破损 的符 号 链 接时也 会返回 false  其他 错误例如 权限 错误被传播
iterdir  当 路 径 指向 一个 目录时产 生该路 径下的对 象 的路径 p  pathdocs  for  child  in  p
rst  posixpathdocsbuild  posixpathdocsstatic  posixpathdocsmakefile 子 条目 会 以任 意顺序 生 成 并 且不 包 括 特殊条 目
和

 如 果有 文 件 在迭 代 器创 建之 后 在目录中被 移除 或 添 加 是否要 包 括该 文件对 应的 路 径对 象 并没有 规定
lchmodmode  就像 path
chmod  但是 如果 路径指 向符 号链 接则 是 修改 符号链 接的 模式而 不是 修改 符号链 接的 目标
lstat  就 和 path
stat 一 样但 是如 果 路 径指 向符号 链接则是返 回符号 链 接而 不是 目标 的 信息
mkdirmode 0 o 777 parentsfalse  existokfalse  新建 给 定路 径 的 目录
 如 果给 出了 mode  它 将 与当 前进 程的 umask  值 合并来 决定文件 模式 和访问标 志
如 果 路 径已经 存在 则抛 出 fileexistserror
如 果 parents 为 true 任 何 找不到的 父目 录 都 会伴 随着此 路 径被 创建 它 们会 以 默认 权限被 创 建而 不 考 虑 mode 设置 模仿 posix 的 mkdir  p  命 令
如果 parents  为 false  默认则 找 不到的 父级目 录 会 导致 filenotfounderror  被 抛 出
 如 果 existok  为 false  默认则在 目标已存在 的情 况下抛 出 fileexistserror
如果 existok  为 true 则 fileexistserror 异 常 将 被 忽 略和 posix  mkdir  p  命 令行为 相 同 但是 只 有 在最 后 一个路 径组件 不是 现 存的非 目 录 文 件 时才生 效
在3
5版更 改 existok  形 参 被加 入
openmoder  buffering 1 encodingnone  errorsnone  newlinenone 打 开路径指向 的 文件就像 内置 的 open  函 数 所 做的一 样 p  pathsetup
owner 返 回拥 有 此文 件 的用户 名
 如果 文件的 uid  无法 在系统 数据 库中 找 到 则抛 出 keyerror
readbytes 以 字节 对象的 形 式 返回 路 径指 向的文 件 的 二进 制内容 p  pathmybinaryfile  p
readbytes  bbinary  file  contents 3
5新 版 功能
readtextencodingnone  errorsnone 以 字符 串 形式返回 路径指 向 的 文件的 解码 后文 本内容
 p  pathmytextfile  p
writetexttext  file  contents 18 p
readtext  text  file  contents  文件先 被 打 开然 后 关 闭
有和 open  一 样 的可选 形参
3
5 新版 功能
path
readlink 返 回符号 链接 所指 向的路径 即 os
readlink 的 返回值 p  pathmylink  p
symlinktosetup
py  p
readlink  posixpathsetup
py 3
9 新 版 功能
path
renametarget  将文 件或 目 录重命 名为 给定的 target 并 返回 一 个 新的 指向 target  的 path  实 例
在 unix  上如 果 target  存在 且 为一个文 件 如 果用 户有 足够权 限则 它将被静默 地替 换
 target 可以 是一个字符 串或 者另一个路 径 对 象 p  pathfoo  p
openw
writesome  text 9 target  pathbar  p
renametarget  posixpathbar  target
open
read  some  text  目 标路径可 能为 绝 对 或相对 路径
相 对路 径 将 被解 释 为相 对于 当前工作 目 录而 不是 相对 于 path 对 象 的目录
在3
8 版更 改 添加 了 返 回值 返回 新 的 path 实例
path
replacetarget 将 文件 名目录 重 命名为给定 的 target 并返回 一个 新的指向 target  的 path 实例
 如 果 target 指 向一 个现 有文 件或目 录 则 它 将被 无条 件地 替换
 目标 路 径 可 能 为 绝 对或 相 对路 径
相 对路径将 被解释 为 相对于 当 前工 作 目录 而不 是 相对于 path  对象 的目 录
在3
8版更 改添加 了 返回值 返 回新 的 path 实 例
path
resolvestrictfalse 将路径 绝对 化解 析任何 符号 链 接
返 回 新的路 径对 象 p  path  p  posixpath
 p
resolve  posixpathhomeantoinepathlib 
组 件也将被 消除 只有这 一 种方法 这么 做 p  pathdocs
setup
py  p
resolve  posixpathhomeantoinepathlibsetup
py 如 果路径不 存在 并且 strict  设 为 true  则抛 出 filenotfounderror 
如果 strict 为 false  则 路径 将被尽 可能 地 解析并 且 任何剩 余 部 分 都会 被不 检 查 是否 存 在 地 追 加
 如果 在解 析路径 上 发生无 限循 环则抛 出 runtimeerror
3
6 新版功能 加 入 strict 参数3
6 之 前 的版本 相当 于 strict  值 为 true  path
rglobpattern 这就 像调 用 path
glob 时 在给定 的 相对 pattern 前 面 添 加了 sortedpath
py 引 发一 个审计 事 件 pathlib
rglob 附 带 参 数 self  pattern
rmdir  移除 此目 录
此 目录必须 为 空的
samefileotherpath  返回 此目 录 是否 指 向与 可能 是字符串 或者 另一 个路径 对象 的 otherpath  相同 的 文件
 语 义类似于 os
samefile  与 os
samestat 
 如果 两 者 都以 同一 原 因无法 访问 则抛 出 oserror
samefilespam  true 3
5新版 功能
symlinktotarget  targetisdirectoryfalse 将此 路径 创建 为指 向 target 的 符 号链接
在 windows  下 如果链 接的 目标 是一个 目 录则 targetisdirectory 必须 为 true  默 认 为 false 
在 posix  下 targetisdirectory  的 值 将 被 忽 略
stsize 8 注解参 数的 顺 序 link  target 和 os
symlink 是相 反 的
touchmode 0 o 666 existoktrue 将给定 的路 径创建 为文件
 如 果给出 了 mode  它 将 与 当 前 进 程的 umask 值 合并以 确定文件 的模式 和访 问 标志
如果 文 件已经存 在则 当 existok 为 true  则 函数仍 会 成 功并 且 将 它的修 改 事件 更 新 为 当 前 事 件 否 则 抛 出 fileexistserror
unlinkmissingokfalse 移 除 此文件 或符 号链 接
如果 路 径指 向目 录 则 用 path
rmdir 代 替
 如 果 missingok  为 假 值 默认 则 如果 路径 不存在 将会 引 发 filenotfounderror
 如果 missingok  为 真 值 则 filenotfounderror  异 常将 被忽 略 和 posix  rm  f  命 令的 行为 相同
 在3
8 版 更改 增加 了 missingok  形 参
linktotarget  创 建 一个 指 向 名为 target  的路径 的硬链接
3
8 新 版功 能
writebytesdata  将文件以 二 进制 模式 打开 写 入 data 并 关 闭 p  pathmybinaryfile  p
readbytes  bbinary  file  contents 一 个同 名的 现 存文件 将被 覆盖
3
5 新 版 功能
writetextdata  encodingnone  errorsnone  将 文 件 以 文本 模 式 打 开 写 入 data 并 关 闭 p  pathmytextfile  p
readtext  text  file  contents  同名 的现有 文 件 会 被 覆盖
 可选 形参的 含义与 open  的相同
3
5新 版功 能
对 应 的 os  模 块 的工 具
 以下是 一 个映 射了 os  与 purepathpath  对应相 同 的 函数 的 表
注解 尽 管 os
relpath  和 purepath
relativeto 拥 有相 同的 重叠的用 例但 是它 们语义 相 差 很大 不 能 认 为 它们等 价
 os  和 os
path  pathlib  os
expanduser  和 path
pdb  python 的 调试 器
调试 器 命 令
数 据持久 化
pickle  python 对 象 序 列化
 与 其他 python 模 块间的 关系
 与 marshal  间 的关 系
 与 json  模块 的比较
 数 据 流 格 式
pickle 所 使用 的 数据 格式 仅可 用于 python
这 样做的 好 处 是 没 有 外部 标 准给该 格 式强 加 限 制 比如 json  或 xdr 不 能表示共 享指 针标准 但 这也 意味着 非 python 程序可 能无法 重 新 读 取 pickle  封存 的 python  对象
默 认情 况下 pickle 格 式使 用相 对紧凑 的 二进制 来 存 储
如果 需要让文 件 更小可以 高效 地压 缩由 pickle  封存 的 数据
pickletools  模块包 含了 相应的 工 具 用于 分析 pickle  生 成的 数据 流
pickletools  源 码 中包含 了对 pickle  协议使 用的 操作码的 大量 注 释
当 前 共 有6种 不同 的 协 议 可 用于封 存操 作
使 用的协议 版 本越高读取 所生 成 pickle 对 象所需 的 python 版本就 要越新
 v 0 版协 议 是原始 的 人 类可 读协 议并且向 后 兼 容 早 期版 本的 python
 v 1 版 协 议是 较早 的二进制 格式 它 也与 早 期版 本 的 python  兼容
 v 2版 协议 是 在 python 2
3中 引 入的
它为存 储 newstyle  class  提 供了 更高效 的机 制
欲了解 有 关 第2版 协议带来 的改 进请参 阅 pep 307
 v 3版协 议 是 在 python 3
0 中引 入的
 它显式地 支 持 bytes 字节对 象 不能使用 python 2
x  解封
 这 是 python 3
03
7的 默认 协 议
 v 4 版协 议添 加于 python 3
它 支持存 储 非常大的 对象能 存储 更多 种 类 的 对象 还包 括一些针 对数 据格 式 的优 化
它 是 python 3
8 使用的默 认协议
有 关第4版协议 带来改进的 信 息请参 阅 pep 3154
 第5版协 议 是在 python 3
8中 加 入的
它 增 加了对 带 外数据 的支 持 并可加 速带 内数 据 处理
请 参 阅 pep 574 了 解第5版协 议所 带来的改 进的 详情
 注解序 列 化是一种 比持久 化更 底层 的概 念虽 然 pickle 读 取 和 写 入的 是 文 件对 象但 它 不 处理 持 久 对象的 命 名问 题 也不 处 理 对持 久对象的 并 发访 问甚 至 更 复 杂的 问题
pickle 模 块可 以将 复 杂对 象转 换 为 字节 流 也可 以将 字节流转换 为 具 有 相 同内 部 结 构的 对 象
 处 理 这些 字节 流最常见 的做 法是 将它们写入 文 件但 它们 也 可以 通过 网 络发 送或 存储 在数 据库中
shelve  模块 提供了 一个 简单 的接 口 用 于 在 dbm  类型的 数 据 库文 件上封 存和 解封 对 象
模块接 口
 可 以 被封 存 解封 的对 象
封 存 类实 例
持久 化外 部 对象
 为了 获 取 对象 持久 化 的 利益 pickle  模 块 支持 引用 已 封 存 数 据流 之 外的对 象
这 样的 对象 是 通过 一个 持久化 id 来 引用 的它应当 是一 个由 字 母数 字 类字 符组 成的 字 符串 对于 第0版 协议5 或是 一个任 意 对象 用于 任意新 版协 议
pickle  模 块 不 提供 对持久 化 id 的 解析工作 它将 解 析工 作分 配 给 用户 定 义 的方法分 别 是 pickler 中 的 persistentid  方法 和 unpickler 中 的 persistentload  方法
要 通过 持久化 id 将 外部对 象封 存必 须 在 pickler  中 实 现 persistentid 方 法该 方法 接受 需 要 被 封存 的对象 作为 参数 返回 一 个 none 或返回 该对 象的 持久化 id
 如果 返 回 none 该 对 象 会被按 照默 认 方 式 封 存为 数据 流
 如果 返 回字 符串 形式 的持 久化 id  则会 封存 这 个字 符串 并 加上一 个 标记 这 样 unpickler 才 能将 其识 别为 持久化 id
 要解封 外部 对 象 unpickler  必须 实现 persistentload  方 法接 受一 个持 久化 id  对象 作为 参数 并 返 回一 个 引用的 对 象
 下面 是一 个全 面 的例 子展 示 了如何 使用持久化 id  来封存 外部 对象
dispatch  表
 如果 想对 某些类 进行自 定义 封存 而又 不 想 在类 中增 加 用于 封存 的代 码就 可以 创 建 带有 特殊 dispatch  表的 pickler
 在 copyreg 模 块 的 copyreg
dispatchtable 中 定 义了 全 局 dispatch 表
 因此 可以使用 copyreg
dispatchtable  修 改后 的 副本作为自 有 dispatch 表
 例如 f  io
dispatchtablesomeclass  reducesomeclass  创建了 一个带有 自有 dispatch  表的 pickle
pickler 实例它 可以 对 someclass 类进行 特殊处 理
另 外 下列 代码 class  mypicklerpickle
bytesio  p  mypicklerf  完 成了 相 同的 操作 但所 有 mypickler  的实 例都会 共用 同一份 dispatch  表
使 用 copyreg  模块 实 现 的等 效 代 码 是 copyreg
处 理 有状态 的对 象
下 面 的示 例 展 示 了如 何修 改 类 在封存 时的 行为
 其 中 textreader  类 打 开了一个文本 文件 每 次调 用其 readline 方 法则 返回 行 号和 该行的 字符
 在封 存这 个 textreader 的 实例时 除 了 文 件 对 象其 他 属性 都 会 被保 存
当解 封 实例 时需 要 重 新 打开 文 件然 后 从上 次的 位置开始 继续 读取
 实现 这些 功能需 要实 现 setstate 和 getstate  方 法
file  file 使 用方 法如 下所示 reader  textreaderhello
 类型函数 和 其 他对 象 的自 定 义归 约
3
8新 版 功 能
有 时 dispatchtable 可 能 不够 灵活
特 别是 当 我们想要 基于 对象 类型以 外的 其他 规 则 来对 封存进行 定制 或是 当我 们想 要对函数 和 类的 封存进 行定 制的 时候
 对于 那些 情况 可能要 基于 pickler  类进 行子 类化并 实 现 reduceroverride 方法
此 方法可 返回 任意 的归 约元 组参 见 reduce
 它 也 可以 选 择 返回 notimplemented  来回 退 到 传统 行 为
 如果同 时 定义 了 dispatchtable  和 reduceroverride 则 reduceroverride  方 法 具有 优先权
注 解 出于 性能 理 由 可 能不 会为以 下对 象调 用 reduceroverride  none  true  false  以及 int  float  bytes  str  dict  set  frozenset  list  和 tuple 的 具 体 实例
 以 下是 一个 简单的例子 其 中 我 们 允许 封 存 并重 新 构 建 一 个给 定的 类 import  io  import  pickle  class  myclass  myattribute 1 class  mypicklerpickle
外部缓 冲区
3
8 新版 功能
在某些 场 景中 pickle  模块 会 被用 来传 输 海量 的数 据
因 此最 小化内 存复 制次数 以保 证性 能和 节 省 资 源 是很重 要 的
 但是 pickle  模块的 正常 运作 会 将图类对 象 结 构 转换 为 字节 序列 流因 此 在本 质上就 要从 封 存流 中来 回 复 制数 据
如 果 provider  待 传输 对 象 类 型的 实 现和 consumer 通信 系 统的 实 现都 支持 pickle 第5 版或更 高 版本所提 供的外 部 传 输 功 能则 此约 束 可以被 撤销
 提 供 方 api
 使 用 方 api
 当序列 化一个 对象 图时 通 信系统可以启 用 对所 生成 picklebuffer  对 象的 定制 处 理
 发送端 需 要传 递 buffercallback  参 数到 pickler  或是 到 dump  或 dumps 函数该 回调 函数将 在 封 存 对象图 时附 带每 个 所 生成的 picklebuffer  被 调用
 由 buffercallback 所累积 的缓 冲区的数 据将 不会 被 拷 贝到 pickle 流 而是 仅 插 入 一个简 单的 标 记
接收端 需要传递 buffers  参数到 unpickler  或 是到 load  或 loads  函数 其值 是一 个由 缓冲 区 组成的 可迭 代 对 象 它会 被传 递给 buffercallback
 该可 迭代 对象 应当按 其 被传递 给 buffercallback  时的 顺序 产 生缓冲 区
这些缓 冲 区将 提供 对象 重构 造器 所 期望的 数据 对这 些 数据 的封 存产 生 了原 本的 picklebuffer  对象
 在 发送 端 和接受 端之 间通 信 系 统可 以自 由地实 现它 自己用于 外部缓 冲区 的 传 输 机制
 潜 在的 优化 包 括使 用 共 享内存 或基 于 特定 数据 类 型的压 缩等
示例
 下 面 是一 个 小 例子在 其 中 我 们实 现 了 一 个 bytearray  的子 类能 够用 于外 部 缓冲区封 存 class  zerocopybytearraybytearray  def  reduceexself  protocol  if  protocol 5 return  typeself
 return  obj  else  return  clsobj  重 构 造器 reconstruct  类 方法会 在 缓 冲区 的提 供 对象具有正确 类型 时返 回该对象
在 此小 示 例中 这是模拟 零拷 贝行 为的 便捷 方式
 在使 用 方我 们可以 按通 常方式 封存 那 些 对 象它 们 在 反序 列化 时将 提 供原始对 象的 一个 副 本 b  zerocopybytearraybabc  data  pickle
loadsdata  printb  newb  true  printb  is  newb  false  a  copy  was  made 但 是 如 果我 们传 入 buffercallback  然后 在 反序 列 化 时给 回累 积的 缓 冲 区 我们 就 能够 取 回 原始 对象 b  zerocopybytearraybabc  buffers  data  pickle
loadsdata  buffersbuffers  printb  newb  true  printb  is  newb  true  no  copy  was  made  这 个 例 子 受限 于 bytearray  会自 行分 配内存这 一事实你无 法基于另 一个 对 象的 内存 创建 bytearray  的实 例
 但是第 三方 数据类 型例 如 numpy 数组 则没 有这种 限制 允 许在 单 独进 程或 系 统 间传 输 时使用 零拷 贝 的封存 或 是尽 可能 少地拷贝
 参见 pep 574 带 有外 部数据 缓冲 区的 pickle  协议5
 限制全 局变量
 性能
 较 新版 本的 pickle  协议 第2版 或更高 具有 针对 某些 常见 特性 和内 置 类型 的 高效 二进制 编码 格式
此外 pickle 模 块还拥 有一个以 c  编 写的 透 明优 化器
 示例
对 于 最 简单 的代码请 使用 dump  和 load 函数
highestprotocol  以 下示 例 读 取 之前 封 存的 数据
loadf  参见 模块 copyreg 为扩展 类型 提供 pickle  接 口 所 需的 构 造函数
 模块 pickletools  用于 处 理和 分 析 已 封存 数据 的 工具
模 块 shelve 带索 引的 数 据 库 用 于 存放 对 象 使 用了 pickle  模 块
模 块 copy 浅 层 shallow  和 深层 deep  复制 对象 操作 模块 marshal  高效地序列 化内 置类 型的数据
脚 注1不 要把它与 marshal  模 块 混淆
2 这 就是为 什么 lambda  函数 不可以 被 封存 所有 的 匿 名函数 都有 同一 个 名字 lambda
3 抛出的异 常有 可能 是 importerror 或 attributeerror 也 可能 是其 他异 常
4 copy  模块使 用这 一协 议实 现 浅层 shallow 和 深层 deep  复制操 作
5对字 母数 字类 字符 的限制是 由于 持久 化 id  在协 议版 本0中是 由分行 符来 分隔的
 因 此如 果持 久 化 id 中 出现 任何形 式 的分 行符 封存结 果就将 变得 无法 读取
pickletools  pickle 开发者 工具 集
源 代码 libpickletools
py  此 模块包 含与 pickle  模 块 内部 细节有 关的 多 个 常量一 些关于 具体 实 现的详 细 注释 以及 一 些 能够 分 析封 存数 据的 有 用函数
此模 块 的内 容对需 要 操作 pickle  的 python  核 心开 发者来 说很 有用 处 pickle  的 一般 用户则 可能 会感 觉 pickletools  模 块与 他们无 关
命 令行 语法
3
2新 版 功能
 当从 命令 行发起 调用时 python  m  pickletools 将 对一个 或 更 多 pickle 文件 的内容 进 行 拆解
请 注意 如果 你查 看 pickle  中保存 的 python  对 象 而非 pickle  格 式的细 节你可 能需 要改 用 m  pickle
 但 是 当你 想检 查的 pickle  文 件来 自 某 个不 受信 任的 源 时 m  pickletools 是更 安全的 选择 因为 它不会 执行 pickle  字节 码
 例如 对于一个 封 存 在文 件 x
pickle 中 的 元组12 python  m  pickle  x
 命令 行选项
a  annotate  使用 简短 的操 作码 描述 来标 注每一 行
o  outputfile  输出 应当 写入到 的文 件名 称
l  indentlevelnum 一 个 新的 mark  层级所 需缩 进的 空 格数
m  memo  当反 汇编多个 对象 时 保留各 个 反汇 编的 备 忘记 录
p  preamblepreamble 当 指定 一个 以上 的 pickle  文 件 时在 每 次 反 汇编 之 前 打 印给 定的 前言
 编程 接 口
dispickle  outnone  memonone  indentlevel 4 annotate 0将 pickle  的 符 号 化 反汇 编 数据 输出 到文件 类对 象 out 默 认为 sys
 pickle  可以 是一 个字 符串 或一 个文 件 类对象
 memo  可以是一个 将 被 用作 pickle  的备 忘 记录 的 python 字 典 它可 被用来对 由同 一 封 存 器 创建 的 多个 封存 对象 执行 反汇编
由 mark  操作 码指明 的 每个连续 级别 将会 缩进 indentlevel 个空格
 如果为 annotate  指 定了 一个非 零 值则 输出中 的 每个 操作码 将 以一 个简短描 述来 标注
 annotate  的值 会被 用作 标 注所应 开始 的列 的 提 示
3
2新 版功 能 annotate 参 数
genopspickle 提 供包含 pickle  中所 有操 作码的 iterator  返 回一个 opcode  arg  pos 三 元 组的序 列
 opcode 是 opcodeinfo  类 的 一 个实 例 arg 是 python  对象 形式的 opcode 参 数 的 已解 码值 pos 是 opcode  所在 的位 置
 pickle 可 以是 一个 字符 串 或 一个 文件 类对 象
optimizepicklestring 在消除未 使 用的 put  操作 码之 后返回 一 个新 的等 效 pickle 字 符串
 优 化 后的 pickle  将更 为简 短 耗费 更为 的传 输时间要求 更少 的存储空 间并 能更 高效 地 解封
pipes 终端 管 道接 口
源 代 码 libpipes
pypipes 定 义了一个 类用来抽 象 pipeline 的 概念 将数 据从 一个 文 件 转到 另一文 件的 转换 器序列
由 于模块 使用 了 binsh 命 令行 因此要求 有 posix 或 兼容 os
system  和 os
popen 的 终端程序
pipes  模 块定 义了以 下 的 类 class  pipes
template  对管 道 的抽象
示 例 import  pipes  t  pipes
 模 板 对象
 模板 对象有以 下方 法 template
reset 将 一个 管 道 模板 恢复为 初始 状态
clone  返 回 一个 新 的 等价 的 管道模 板
debugflag  如果 flag  为 真值则 启用 调 试
否 则禁 用调 试
当 启 用调 试 时 要 执行 的命 令会 被 打 印出 来并且 会 给予终端 set  x  命 令 以 输出 更详 细 的信 息
appendcmd  kind 在 末尾添加 一个 新 的 动作
 cmd  变量 必须 为一 个 有效 的 bourne 终 端命令
 kind  变 量 由两个字 母组成
 第 一 个 字母 可 以为 这表 示命 令将 读取其 标准输入 f  这表 示命 令将 读取在 命令 行 中 给定 的 文件 或
 这 表 示 命令 将 不 读取 输 入 因而 必须放在 前面
 类 似地 第二 个字母可 以为 这 表示 命令将 写入 到标准 输出 f 这表 示命 令将写入 在命令 行 中 给定 的 文 件 或
这 表示命令 将 不执行 写入 因 而 必须 放在 末尾
prependcmd  kind  在开 头添加 一个新的 动作
 请 参 阅 append 获 取相 应 参数的说明
openfile  mode 返 回一 个文件 类对 象打 开 到 file  但是 将从 管道读 取或 写入
 请注意 只 能给 出 r  w 中的 一个
copyinfile  outfile  通过管 道将 infile  拷贝 到 outfile
pkgutil 包 扩 展工具
源 代码 libpkgutil
py  该模块 为导 入 系统 提供 了工 具尤其 是在包 支持 方面
moduleinfomodulefinder  name  ispkg  一个 包 含 模 块 信息 的 简短摘 要的 命 名 元组
3
6 新版 功能
3
3 版 后已 移除 this  emulation  is  no  longer  needed  as  the  standard  import  mechanism  is  now  fully  pep 302 compliant  and  available  in  importlib
3
3版 后已移除 this  emulation  is  no  longer  needed  as  the  standard  import  mechanism  is  now  fully  pep 302 compliant  and  available  in  importlib
 在3
3版 更 改 updated  to  be  based  directly  on  importlib  rather  than  relying  on  the  package  internal  pep 302 import  emulation
在3
4 版 更 改 updated  to  be  based  on  pep 451 pkgutil
 在3
3版更 改 updated  to  be  based  directly  on  importlib  rather  than  relying  on  the  package  internal  pep 302 import  emulation
在3
3版 更改 updated  to  be  based  directly  on  importlib  rather  than  relying  on  the  package  internal  pep 302 import  emulation
 在3
4版更 改 updated  to  be  based  on  pep 451 pkgutil
在3
3 版 更改 updated  to  be  based  directly  on  importlib  rather  than  relying  on  the  package  internal  pep 302 import  emulation
注解 only  works  for  a  finder  which  defines  an  itermodules  method
在3
3 版更 改 updated  to  be  based  directly  on  importlib  rather  than  relying  on  the  package  internal  pep 302 import  emulation
例如 list  all  modules  python  can  access  walkpackages  list  all  submodules  of  ctypes  walkpackagesctypes
注 解 only  works  for  a  finder  which  defines  an  itermodules  method
在3
3 版更 改 updated  to  be  based  directly  on  importlib  rather  than  relying  on  the  package  internal  pep 302 import  emulation
getdatapackage  resource 从 包中获取 一 个 资源
3
9 新 版 功 能
platform 获 取 底 层平台 的标 识数据
 源代码 libplatform
py  注 解 特定平 台按 字 母 顺 序排 列 linux 包括 在 unix 小 节之 中
跨 平台
java  平台
windows 平 台
mac  os 平 台
macverrelease  versioninfo  machine  获 取 mac  os 版本 信 息 并将 其返 回为元 组 release  versioninfo  machine 其 中 versioninfo  是一 个元 组 version  devstage  nonreleaseversion
 无法 确定 的条 目会被 设 为
所 有元 组 条目 均 为字 符串
unix 平 台
executable  lib  version  chunksize 16384尝 试确 定 可执行文 件默 认为 python 解释 器 所链接到 的 libc  版 本
返 回一 个字 符串 元组 lib  version  当查 找失 败时 其 默 认值 将设 为给 定 的形 参值
 请 注意 此 函数 对于 不同 libc  版本 向可执 行 文 件添 加符号 的 方式有 深 层的关 联 可 能仅 适用于 使用 gcc 编 译 出来的 可执行 文件
 文 件 将 按 chunksize  个字 节的 分 块来 读取和 扫描
plistlib  生成 与解析 apple  plist  文 件
示 例
生 成 一个 plist  pl  dict  astring  doodah  alist  a  b 1232
gmtime  with  openfilename  wb  as  fp  dumppl  fp  解析 一 个 plist  with  openfilename  rb  as  fp  pl  loadfp  printplakey
poplib  pop 3 protocol  client
在3
9版 更 改 if  the  timeout  parameter  is  set  to  be  zero  it  will  raise  a  valueerror  to  prevent  the  creation  of  a  nonblocking  socket
在3
2版 更 改 context  parameter  added
 在3
4版 更改 the  class  now  supports  hostname  check  with  ssl
3
6版 后 已移 除 keyfile  and  certfile  are  deprecated  in  favor  of  context
 please  use  ssl
loadcertchain  instead  or  let  ssl
createdefaultcontext  select  the  systems  trusted  ca  certificates  for  you
在3
9版 更改 if  the  timeout  parameter  is  set  to  be  zero  it  will  raise  a  valueerror  to  prevent  the  creation  of  a  nonblocking  socket
 参 见 module  imaplib  the  standard  python  imap  module
pop 3 objects
3
4新 版 功能
3
5 新 版功 能
3
4新版 功能
pop 3 example
posix  最常 见的 posix  系统 调 用
此 模 块 提供 了对基 于 c 标 准和 posix  标准 一 种稍加修改 的 unix  接口进行 标 准化 的 系 统 功能 的访 问
请 勿 直接 导入此 模块
 而应导入 os 模块 它 提供了此 接口 的可 移植 版 本
 在 unix  上 os  模块提 供了 posix 接 口的一 个 超集
在 非 unix  操作系 统上 posix 模 块将 不可 用但会通 过 os 接 口提 供它的 一个 可 用子 集
 一旦导 入了 os  用 它 替代 posix  时就 没 有性能 惩罚
 此 外 os 还提 供了 一些附 加 功能 例如 在 os
environ 中 的 某 个条 目被 修改时 会 自动 调用 putenv
错误 将 作 为 异 常被 报 告对 于类 型 错误 会给 出 普通异常而 系 统 调用 所 报 告的 异 常 则 会 引发 oserror
 大 文件 支 持
某 些 操作 系统 包 括 aix  hpux  irix 和 solaris  可 对 int 和 long  为32 位 值的 c 编 程 模 型提 供 大于2 gib 的 文件 的支 持
 这在通 常情 况下 是以 将相 关数据 长度 和偏 移类型定 义为64 位值 的方 式来 实 现的
 这样的 文件 有 时被称 为 大文 件
python  中 的 大文 件 支持 会 在 offt 的 大 小超 过 long 且 long  long  至 少 与 offt 一 样 大时 被启用
 要 启 用此 模 式可 能必 须在 启用 特定 编译 旗标 的情 况下执行 python  配置 和 编 译
例 如在 最近 几个 版 本 的 irix 中 默 认启用了 大文 件 支持但在 solaris 2
6 和2
7中你 还需 要 执行 这样的 操作 cflagsgetconf  lfscflags  optg  o 2 cflags 
configure  在支 持 大 文 件 的 linux 系 统 中可 以这样 做 cflagsdlargefile 64 source  dfileoffsetbits 64 optg  o 2 cflags 
重要的 模块 内容
 除 了 os 模 块 文 档 已说明的 许多函 数 posix 还 定义 了 下列 数据 项 posix
environ 一 个表示 解释器启 动 时间 点的字 符串 环 境 的字 典
 键和 值 的类型在 unix  上为 bytes  而在 windows  上 为 str
 例 如 environbhome  windows  上 的 environhome 是你 的家目录 的 路径 名等 价 于 c  中的 getenvhome
修 改此字 典不 会影响 由 execv  popen 或 system 所 传入 的字 符 串 环境 如 果你需 要修 改环 境 请将 environ  传 给 execve  或者 为 system 或 popen  的命 令 字符串添 加 变量赋 值和 export  语句
 在3
2 版更改 在 unix 上 键 和 值为 bytes 类 型
注 解 os 模 块提 供 了对 environ  的替代 实 现它 会 在被 修改时 更新 环 境
 还要注意更 新 os
environ 将 导致 此 字典 失 效
推荐使 用 这个 os  模 块版 本而 不 是直 接 访 问 posix  模 块
pprint 数 据美 化输 出
 源 代 码 libpprint
pypprint 模块 提 供 了 美化 打印任 意 python  数据 结构的 功能这 种美 化形 式可用 作 对 解释 器的 输入
如 果经 格式化 的 结构 包 含非 基 本 python 类 型的 对象 则其 美 化 形式 可 能 无 法被 加载
 包 含文 件、 套接 字或 类对象以及 许多其 他不 能用 python  字 面值 来 表 示 的 对 象都 有可能 导致 这样 的 结果
 格 式 化后 的 形式 会在 可 能 的 情况 下以 单行 来表 示 对象 并在 无法在 允许 宽度 内容 纳 对 象的 情 况下 将其 分为多行
 如果你需要调 整 宽度 限 制则 应显 式地构 造 prettyprinter 对 象
字典 在计算 其显 示 形 式 前 会先根 据 键 来排 序
 在3
9版 更 改添加 了对美 化打 印 types
simplenamespace  的 支 持
pprint  模块 定 义了 一个类 class  pprint
prettyprinterindent 1 width 80 depthnone  streamnone  compactfalse  sortdictstrue  构 造一个 prettyprinter  实 例
此 构 造器 接 受 几 个关 键字 形参
 使用 stream  关键 字 可 设置 输 出 流流 对 象使 用的 唯 一方 法是文件 协 议的 write  方法
 如 果未 指定此 关键 字 则 prettyprinter  会 选 择 sys
 每个 递 归 层 次 的 缩进 量 由 indent 指定 默认 值为一
其 他值可 导致输 出看 起来 有些怪异 但可 使 得嵌 套 结 构更易区 分
 可被 打印 的层级数 量 由 depth 控 制如 果 数 据结构 的层 级被 打印 得过 深其 所 包 含的 下 一 层级 会被 替换 为
在 默认 情况 下对 被格式 化对 象的 层级深度 没有限 制
希望的 输出宽 度 可 使 用 width 形 参 来 限制默 认值 为80个 字 符
如 果 一个 结构 无 法在 限定 宽 度 内 被格式 化 则将做 到尽 可能 接 近
如 果 compact  为 假值 默 认则长 序列 的 每一 项将 被格 式化 为单 独 的行
 如果 compact  为真值 则将 在 width  可容纳的 的情 况下 把尽 可 能多的 项放 入每个输 出 行
如 果 sortdicts 为真值 默 认字 典 将被 格式 化 为 按 键排序否则 将 按插 入顺 序显 示
 在3
4版 更改 增加 了 compact 形参
 在3
8版 更 改 增加了 sortdicts  形参
pprint 模 块 还提供了一 些快捷 函 数 pprint
pformatobject  indent 1 width 80 depthnone  compactfalse  sortdictstrue  object 的 格 式 化 表示 作为 字符串返 回
 indent  width  depth  compact 和 sortdicts  将 作 为格 式 化形 参被传 入 prettyprinter 构造 器
在3
4 版更改 增加 了 compact 形参
在3
8版 更改 增 加了 sortdicts  形参
ppobject  args  sortdictsfalse  kwargs  打 印 object  的 格式 化表 示 并 附带 一 个 换行 符
 如果 sortdicts  为假 值默 认字 典将 按键 的插 入顺 序 显示 否 则将 按字 典键排 序
 args 和 kwargs  将作 为 格式 化形 参被 传给 pprint
3
8 新版功 能
pprintobject  streamnone  indent 1 width 80 depthnone  compactfalse  sortdictstrue 在 stream  上打打 印 object 的 格式 化表示 并附 带一 个 换行符
如 果 stream 为 none  则使 用 sys
stdout
这可 以替 代 print  函数 在交互 式 解释 器中 使用 以查 看值 你甚至 可 以执 行 重新 赋值 print  pprint
pprint  以 在特 定 作 用 域 中使 用
 indent  width  depth  compact  和 sortdicts  将 作 为 格式 化 形参 被 传给 prettyprinter  构 造器
 在3
4 版 更改增加 了 compact 形 参
 在3
8版 更改 增加 了 sortdicts  形参
isreadableobject 确定 object  的格 式化 表示 是否 可 读或 是否 可被用 来通过 eval  重新构 建 对 象 的 值
此 函数对于 递归对象 总 是 返回 false
isrecursiveobject  确定 object  是否 需要 递 归表 示
 此外还定 义了一 个 支持函 数 pprint
safereprobject  返回 object  的 字符串 表示并 为 递归数据 结构 提 供保护
 如 果 object  的表 示形 式 公开 了 一个递 归 条目该递 归引 用会 被 表示 为 recursion  on  typename  with  idnumber
该表 示因 而不 会进行 其它格 式化
prettyprinter 对 象
prettyprinter 的 实 例 具 有下 列方法 prettyprinter
pformatobject 返 回 object 格 式化 表示
这 会将传 给 prettyprinter  构造 器的 选项 纳入 考 虑
pprintobject  在所 配置 的 流 上 打印 object  的格 式 化表示 并附 加 一个换 行符
 下列 方法 提 供了 与 同名函 数 相 对应 的实 现
在 实例 上 使用 这些 方 法效 率会更 高 一些因为 不需 要创建 新的 prettyprinter  对象
isreadableobject  确 定 对 象 的格式 化表 示是否 可读或 者是 否可 使 用 eval  重 建 对象 值
请 注意此 方 法对于 递归 对 象 将返 回 false
 如 果 设置 了 prettyprinter 的 depth  形 参 并且 对象深 度超 出允许 范围 此方法 将返回 false
isrecursiveobject 确定 对象是 否 需要递 归 表示
 此方 法作 为 一个 钩子 提 供 允许 子类修 改将对 象转 换为字 符串 的 方 式
默 认实 现使 用 saferepr 实现的 内部 方式
formatobject  context  maxlevels  level 返回 三个值 字 符 串形 式 的 object 已 格 式化 版 本 指 明结果 是 否可 读的 旗标 以及指 明是 否检 测到 递归 的 旗 标
第 一个 参数是 要 表示的 对 象
 第二 个是以对 象 id 为 键的字典这 些 对象是 当前 表示 上下文的 一 部分影 响 object  表示 的直 接 和间 接 容器 如 果 需 要呈 现一个 已 经在 context  中表示的 对 象则 第三 个返回 值 应当 为 true
 对 format 方法的 递归调 用 应 当将容器 的附加 条 目添加 到此字典 中
 第三 个 参 数 maxlevels 给出了 对 递归 的请 求限制 如 果没有 请求 限 制 则其 值 将为0
此 参数 应 当不 加修改 地传 给 递 归 调用
第四 个参 数 level  给出于 当前 层级传给递 归调 用的 参数值 应当小 于当 前调用 的值
 示 例
 为了 演 示 pprint 函 数 及其 形参 的几 种用 法让我们 从 pypi 获 取关 于 某个 项 目的 信息 import  json  import  pprint  from  urllib
loadrespinfopprint 以 其基 本 形 式显 示了整个 对 象 pprint
0结 果可 以被 限 制到 特 定的 depth  更深 层的内 容将使用 省 略 号 pprint
0此 外还可 以设 置 建 议的最 大字 符 width
如 果一 个对象无 法被 拆 分则 将超 出指 定 宽 度 pprint
python  profilers 分 析器
源 代 码 libprofile
py 和 libpstats
profile 分 析器简介
cprofile  和 profile  提 供 了 python 程序 的确定 性 性 能分析
profile  是一 组统 计 数据 描述程 序的 各个部 分执 行 的频率 和时 间
这 些统 计 数 据可 以 通 过 pstats 模 块 格式 化 为报 表
python  标准 库提 供了同 一 分析 接口 的 两种不 同实 现1
 对 于 大 多 数 用户 建议 使用 cprofile 这 是一 个 c 扩 展 插 件因 为其 合理 的运行 开销 所以 适合 于 分析 长时间 运行 的 程 序
 该插 件 基于 lsprof  由 brett  rosen  和 ted  chaotter 贡 献
 profile 是一 个纯 python  模 块 cprofile 就是 模拟其 接口的 c  语言 实现 但它会 显 著增 加配 置 程 序的 开销
 如果你 正 在 尝试 以某 种方 式扩 展分 析 器则 使 用 此模块可 能 会 更容易 完成 任务
该 模 块 最 初由 jim  roskind  设 计和编 写
 注解 profiler  分 析器模 块被 设 计为 给指 定 的程序提 供执 行概要 文 件而 不是 用于 基 准测 试目 的 timeit 才 是 用 于此 目 标 的 它 能 获得 合理 准确 的 结果
 这 特别 适 用 于 将 python  代码 与 c 代 码进 行 基 准测 试分 析器 为 python 代 码引入开 销 但不 会 为 c 级 别的 函数引入 开销因此 c  代码 似乎比 任 何 python  代码 都更 快
 实 时 用户手 册
profile  和 cprofile 模 块参 考
profile 和 cprofile  模 块 都提 供下 列 函数 profile
 see 上 下 文管 理器 类型 import  cprofile  with  cprofile
printstats  在3
8版更 改 添加了 上下 文管理器 支持
 enable 开 始收 集分 析 数 据
 仅在 cprofile  可用
 disable  停止 收 集分 析 数 据
仅 在 cprofile 可 用
 createstats 停止收 集分析 数 据 并 在 内部将 结 果 记录为 当前 profile
 dumpstatsfilename 将当 前 profile 的 结果写入 filename 
stats  类
 stats  对 象有 以下 方法 stripdirs  this  method  for  the  stats  class  removes  all  leading  path  information  from  file  names
 the  following  are  the  valid  string  and  sortkey  有效 字 符 串 参 数 有效 枚举 参 数 含 义 calls  sortkey
calls  调用 次数 cumulative  sortkey
cumulative 累 积时 间 cumtime  na  累 积时 间 file  na 文 件 名 filename  sortkey
filename 文件名 module  na  文件 名 ncalls  na 调 用次 数 pcalls  sortkey
pcalls 原始 调 用计 数 line  sortkey
line 行号 name  sortkey
name 函数 名称 nfl  sortkey
nfl  名称文 件行 stdname  sortkey
stdname 标 准 名称 time  sortkey
time  内部 时间 tottime  na 内 部时 间 note  that  all  sorts  on  statistics  are  in  descending  order  placing  most  time  consuming  items  first  where  as  name  file  and  line  number  searches  are  in  ascending  order  alphabetical
3
7新 版 功能 added  the  sortkey  enum
3
9 新版功能 added  the  following  dataclasses  statsprofile  functionprofile
 什么 是确定性性 能分析？
 确定性 性 能分 析旨 在反 映 这样 一个 事实即所 有 函数 调用、 函数 返回和 异常事 件 都被 监控 并且 对这 些事 件 之 间的 间隔 在 此期 间用户 的 代码正 在执 行进 行精 确 计时
 相 反统计 分析 不是 由该 模块完 成随机 采样 有效 指 令指 针并 推断时 间 花费 在哪 里
后 一种 技 术传 统上涉 及 较少 的开销 因为 代码 不 需 要检 测但 只提 供 了时间花 在 哪里 的相对指 示
在 python 中由 于在 执 行过 程 中总 有一 个活动的解 释 器 因 此 执 行 确定性 评测 不 需要插 入指 令 的代 码
python 自 动 为 每个 事件 提供一个 dfn  钩子 可选 回调
 此外 python  的 解释 特 性往 往会 给执 行增 加 太多 开 销以 至于在 典 型的 应 用 程序中确 定性 分析 往 往 只 会增 加 很 小的 处理开销
 结果 是确定性分 析并 没有那 么 代价高 昂但 是 它提供 了 有关 python 程序 执 行的 大 量运 行时 统 计信 息
调用 计数 统计 信息可 用于识 别代 码 中的 错 误 意外 计数 并识 别可 能 的 内联 扩展 点高 频 调 用
 内部时 间统 计可 用 于识 别应 仔细 优化 的热 循 环
累 积时 间 统计 可用 于识 别算法 选 择 上 的高 级别 错误
 请 注 意该 分析器中 对累 积时 间的异 常 处理 允许 直接 比 较算 法 的递 归实 现与迭代实 现 的 统 计 信息
局限 性
一个 限 制 是关于时 间 信息的 准确性
确 定性 性能 分 析存 在一 个涉 及 精度 的基 本 问题
最 明显的 限制是 底 层的时 钟 周 期大约 为0
001 秒通常
 因此 没有 什么测量会 比底 层时 钟 更 精确
 如果进 行 了足够 的测量 那 么 误差将 趋于 平 均
 不幸 的是 删 除第一 个错 误 会导 致 第 二个 错误 来 源
 第二 个 问 题是 从 调 度事 件 到 分析 器 调 用 获取 时间函数 实际 获取 时 钟状 态这需要 一段 时间
 类 似地 从获 取时 钟 值 然 后保 存 开始直 到再 次执行用 户代 码为 止退 出 分 析 器 事件 句柄时 也存 在一定的延 迟
因此 多 次调用单 个函 数或调 用多个函数 通 常 会累 积此错 误
 尽 管这 种方 式的 误 差 通 常小 于时 钟的 精度 小 于一 个时 钟 周期 但它 可以 累积 并 变得非 常 可 观
与 开 销 较低 的 cprofile  相比 profile  的问 题更 为 严 重
 出于这个原 因 profile 提 供了 一种 针对指 定平 台的 自 我校准 方 法以便 可以 在 很大 程度 上 平 均 地消除 此误 差
校 准后 结 果 将 更 准 确 在 最小二乘 意义上 但 它有 时会 产生 负 数当调 用计数 异常 低且 概 率 之神对 您不 利 时
 因此 不 要对 产生 的 负数 感 到惊慌
 它 们 应该只 在 你 手工 校准分析器 的情况 下 才 会出现 实际 上结果 比 没 有 校准 的 情况 要好
 准 确估 量
profile  模块的 profiler  会从 每 个 事 件处 理时 间 中减去 一个 常 量 以补偿 调用 time 函 数和 存 储结果 的 开 销
默认 情况 下常数为0
 对 于特 定的 平台 可 用以 下程 序 获 得 更 好修 正 常数 局限 性
当 你有一个一 致 的 答案时有 三 种 方法 可以使 用 import  profile 1
使 用 自 定 义计时 器
 be  warned  that  you  should  calibrate  the  profiler  class  for  the  timer  function  that  you  choose  see 准确 估量
 for  most  machines  a  timer  that  returns  a  lone  integer  value  will  provide  the  best  results  in  terms  of  low  overhead  during  profiling
 os
times  is  pretty  bad  as  it  returns  a  tuple  of  floating  point  values
 if  you  want  to  substitute  a  better  timer  in  the  cleanest  fashion  derive  a  class  and  hardwire  a  replacement  dispatch  method  that  best  handles  your  timer  call  along  with  the  appropriate  calibration  constant
pty  伪 终端 工具
 源代码 libpty
pypty 模块 定义了一些 处理 伪 终端概 念的 操作 启动 另 一 个 进 程并能 以 程序 方 式在 其控 制终 端中进行 读 写
由 于 伪 终 端处理 高度 依赖 于 具体 平台因 此此 功 能只 有 针 对 linux  的代 码
 linux 代码 也 可在其 他 平 台上 工作 但是 未 经 测试
pty 模 块定义 了 下列 函 数 pty
fork  分 叉
 将子进 程的 控 制终 端连 接到 一个 伪终端
返 回值 为 pid  fd
请 注意子 进程 获得 pid 0 而 fd 为 invalid
父 进 程 返 回 值为子 进程 的 pid 而 fd  为 一个连 接 到子 进程 的控制 终端 并同 时连接 到 子进 程的标 准输 入和 输 出的 文件 描述符
openpty  打开 一个 新的 伪 终 端对 如果 可能将 使用 os
openpty  或是针 对通 用 unix 系 统的 模拟 代码
 返 回 一个文 件描 述符 对 master  slave 分 别表示 主 从两 端
spawnargv  masterread  stdinread 生 成一个 进 程并 将其 控制 终端 连接 到当前 进程的 标准 io
 这常 被用来 应对 坚 持要从 控制终 端 读 取数据的程 序
在 pty  背 后 生 成的进 程预 期 最后 将 被终 止 而 且 当 它被 终 止 时 spawn 将 会返 回
会向 masterread  和 stdinread 函 数 传 入 一个 文件 描述 符供 它们 读取 并且 它们总是 应 当 返 回一 个 字 节串
 为 了强制 spawn  在子 进 程退 出 之 前 返回 所以 应当 抛出 oserror
 两个 函数 的 默认 实现 在 每次 函数被调 用时 将 读 取并 返 回至 多1024 个字 节
 会向 masterread  回调 传 入伪 终端 的 主 文件 描述符 以 从子 进程 读取 输出 而向 stdinread  传 入文 件 描 述符0 以从 父进 程的 标准 输入 读 取数 据
从 两 个回 调 返 回空字 节 串会被 解读 为文 件 结 束 eof  条件 在 此之 后回调 将不 再 被调 用
 如果 stdinread  发 出 eof 信 号则 控制 终端 就 不能 再与 父 进程 或子 进程 进行 通信
除 非 子进 程将不 带任 何 输 入就退出否 则随 后 spawn 将 一 直 循环 下去
 如果 masterread  发 出 eof 信号则 会有 相同 的 行为 结 果至 少是 在 linux 上
 如果 两 个 回调 都发出 eof  信 号则 spawn  可 能 将永 不 返 回 除非在 你的平台 上当 传入 三个空列表时 select  会 抛 出一 个错 误
这 是一 个 程 序缺 陷 相 关文 档见 问题26228
 从子进 程 中的 os
waitpid  返回 退出 状 态值
 可以 使用 waitstatustoexitcode  来将 退 出状 态转 换为退 出码
 引发一 个 审 计事 件 pty
spawn 附带参 数 argv
在3
4 版更改 spawn  现 在会从子 进程 的 os
waitpid  返回 状态 值
示例
pwd  用户 密 码数据库
pyclbr  python 模 块浏 览 器支持
 源代 码 libpyclbr
pypyclbr 模块 提 供 了对 于以 python  编写 的模 块 中 定义 的函数、类 和 方法 的受 限信息
 这 种 信息 足 够用 来实 现一个 模 块 浏览 器
这种 信息 是 从 python 源 代码中 直接 提 取而 非 通 过导 入模块 因 此该 模 块 可 以 安 全地 用于 不 受信任的 代码
此 限制 使 得非 python  实 现的模 块 无法使 用此 模 块包括 所有标 准和可 选的 扩 展 模 块
readmodulemodule  pathnone  返回 一个 将模块 层 级的 类 名 映射 到 类描述 器的字 典
如果 可能 将 会 包 括 已导 入基 类的描述 器
 形 参 module  为要 读 取 模块 名称的字 符 串 它 可 能是 某个包内 部 的模 块名 称
 path  如果 给出 则 为添 加到 sys
path 开头的目 录路 径序 列它 会被用于 定 位 模块 的 源代码
此 函 数 为 原始 接口 仅保留 用于向 下兼 容
 它会 返回 以下 内容 的过 滤版 本
readmoduleexmodule  pathnone 返 回一个 基于 字典 的树 其 中 包含 与模 块 中每 个 用 def  或 class  语句 定 义的 函 数 和 类 相对 应的 函数 和类描 述 器
 被返 回的 字典 会将 模块层 级的 函数和类 名映 射到 它们 的描 述器
 嵌 套的 对 象会 被输入 到它 们的 上级子 目录 中
与 readmodule  一样 module  指明要 读 取的 模 块 而 path 会 被添加 到 sys
如果 被读 取的 模块 是 一个 包 则 返回 的字典 将具 有 path 键 其值是 一个包含 包 搜索路径的 列 表
3
7 新版 功能 嵌套 定义 的 描 述器
 它们通过 新的子属 性 来 访问
每 个定 义 都会有一个 新 的上 级属性
 这些函 数所返回 的描 述器 是 function 和 class  类 的实 例
用 户 不 应自行 创建 这 些类 的实例
function  对象
function 类 的实 例描 述 了由 def  语句 所定 义的 函数
 它们 具有 下列 属性 function
file  函数 定义所 在的 文 件 名 称
module 定 义了所 描述 函数的模 块名 称
name 函 数名 称
lineno 定 义在 文件中 起始位 置 的行 号
parent  对 于最高层 级函 数为 none
 对于 嵌套 函数 则为上 级函数
3
7新 版功 能
children 将 名称 映射 到嵌 套函数 和类描述 器的 字典
3
7 新版 功能
class 对象
class  类的 实例 描述了 由 class 语句所 定义 的类
 它们 具有 与 function 对 象相同 的属性 以及 两个额外 属性
file  类定 义所 在的文件 名称
module  定义 了所 描述 类的模 块名 称
name 类名 称
lineno 定 义在文 件中 起始位置 的行 号
parent  对于最 高层 级类为 none
对 于嵌 套 类则为 上级 类
3
7新 版功 能
children 将 名称 映 射到 嵌套函数和 类描 述 器的字 典
3
7新 版功能
super  一 个 class 对 象的 列 表它 们描 述 了所 描述 类的直 接基类
被 命 名为超 类但 无法被 readmoduleex  发现 的 类会作为 类名 字符串 而非 class  对象 列出
methods  一个 将方法 名映 射到 行号 的字 典
 此属性 可从更 新的 子目 录中 获取 仅 保 留用 于向 下 兼容
pydoc 文 档 生成 器和 在 线 帮 助系 统
xmlparsersexpat  fast  xml  parsing  using  expat
警 告 the  pyexpat  module  is  not  secure  against  maliciously  constructed  data
 if  you  need  to  parse  untrusted  or  unauthenticated  data  see  xml 漏 洞
 参见 the  expat  xml  parser  home  page  of  the  expat  project
xmlparser 对象
expaterror  exceptions
 示例
content  model  descriptions
expat  error  constants
3
2新 版功 能
3
2 新 版 功 能
xmlerrorsuspendpe 脚 注1 the  encoding  string  included  in  xml  output  should  conform  to  the  appropriate  standards
python  运行时服 务
本 章里 描述 的模 块提供了 和 python 解释器 及其环境 交互 相 关的 广泛 服务
 以下 是综 述 sys 系 统相 关的 参数 和函 数 sysconfig  provide  access  to  pythons  configuration  information 配 置变 量安 装 路径 其他 功能 using  sysconfig  as  a  script  builtins  内建对象 main 顶层脚本环境 warnings  warning  control 警告类别 the  warnings  filter  describing  warning  filters 默认警告过滤 器 overriding  the  default  filter 暂时禁止警告测试警告 updating  code  for  new  versions  of  dependencies  available  functions  available  context  managers  dataclasses 数据类模块级装饰器、 类和函数 初始化后处理类变量仅初始化变量冻结的实例 继承默认 工厂函数可变的默认值异常 contextlib 为 with 语句上下文提供 的工具工 具例子 和配方 supporting  a  variable  number  of  context  managers  catching  exceptions  from  enter  methods  cleaning  up  in  an  enter  implementation  replacing  any  use  of  tryfinally  and  flag  variables  using  a  context  manager  as  a  function  decorator  single  use  reusable  and  reentrant  context  managers  reentrant  context  managers  reusable  context  managers  abc 抽象基类 atexit 退出处理器 atexit 示例 traceback 打印或检索堆 栈回溯 tracebackexception  objects  stacksummary  objects  framesummary  objects  traceback  examples  future  future 语 句定义 gc  垃 圾回收 器接口 inspect 检查对象类型和成员 retrieving  source  code  introspecting  callables  with  the  signature  object 类与函数 the  interpreter  stack  fetching  attributes  statically  current  state  of  generators  and  coroutines  code  objects  bit  flags 命令行界 面 site —— 指定域 的配置钩子 readline  configuration 模块内容命令行界面
pycompile 编译 python 源文件
queue 一 个 同 步的队 列 类
源代 码 libqueue
pyqueue 模块实现了多生产者、多消费者队列
这特别适 用于消息必须安全地在多线程间交换的线程编 程
模块中 的 queue 类实现了所有所需的锁定语义
模块实现了三 种类型的 队列它们的区别仅仅是条目取回的顺序
在 fifofirstin  firstout 队列 中先添加 的任务先 取回
在 lifo  lastinfirstout 队列中最近被添加的条目先取回操作类 似一个堆 栈
优 先级 队 列 中条 目将 保持排 序 使用 heapq  模 块并 且最 小 值 的 条目第一 个返 回
在 内 部这 三个 类型 的队 列使 用锁 来临 时阻 塞竞 争线 程然 而它 们并未 被 设 计用于线 程的重 入性 处 理
此 外 模块 实现 了 一个简 单的 fifo  firstin  firstout  队 列 类 型 simplequeue 这 个特 殊实 现 为 小功 能在 交 换 中 提供 额 外的 保障
queue  模块 定 义 了 下 列 类 和异 常 class  queue
lifoqueuemaxsize 0 lifo  lastin  firstout 队 列构 造 函 数
 maxsize 是 个整 数 用于 设置 可以放入 队 列 中的 项 目数 的上 限
 当达到 这 个大 小的 时候插 入操 作将 阻塞 至队列中 的项 目被 消费 掉
如 果 maxsize  小于 等于 零 队列尺 寸 为 无限大
priorityqueuemaxsize 0 优 先 级队列 构造函 数
 maxsize 是个整 数用 于设 置可 以放入队 列中 的项 目数 的上 限
当达到 这 个大小 的时 候插 入操 作 将阻 塞至队 列中 的项目被 消 费掉
如 果 maxsize 小 于等于 零 队列 尺寸 为无限 大
最小值 先 被取出最小值条 目是由 sortedlistentries 0返回 的条 目
条目 的典型模 式 是一个以下形式 的元组 prioritynumber  data 
如果 data  元素 没有可 比性 数据将被 包 装在一个类中忽略 数据值仅 仅比 较优先 级数 字 from  dataclasses  import  dataclass  field  from  typing  import  any  dataclassordertrue  class  prioritizeditem  priority  int  item  anyfieldcomparefalseclass  queue
simplequeue  无界 的 fifo  firstin  firstout 队列 构造函数
简单的队 列缺少任 务跟 踪等高 级功 能
3
7新版 功能
empty 对空的 queue 对象 调用非阻塞 的 get  or  getnowait 时引发的异 常
full 对满的 queue  对象调用 非阻 塞的 put  or  putnowait 时 引发 的异常
queue 对象
队 列 对象 queue  lifoqueue  或者 priorityqueue 提供下 列 描 述的 公共方法
qsize  返 回队 列的大 致 大 小
注意 qsize 0不保 证后续 的 get 不被阻 塞 qsize  maxsize  也不保 证 put 不 被阻 塞
empty 如果队列为 空返回 true 否 则返回 false 
如 果 empty 返 回 true 不保 证后 续调用的 put 不被 阻 塞
类 似的 如果 empty 返回 false 也 不 保 证后 续调 用的 get 不被阻 塞
full 如 果队列 是 满 的返回 true 否 则 返回 false 
如 果 full 返回 true  不 保 证 后续调 用 的 get  不被 阻 塞
 类似的如果 full 返回 false  也不 保 证后 续调用 的 put 不被 阻塞
putitem  blocktrue  timeoutnone  将 item  放 入 队列
如果可选参 数 block 是 true 并且 timeout  是 none  默认 则 在必 要时 阻塞 至有 空闲 插槽 可用
如 果 timeout 是 个正 数将 最多 阻塞 timeout  秒如果 在 这 段 时间 没 有可 用 的空闲 插 槽 将引发 full  异 常
反 之 block  是 false 如 果空 闲 插槽 立即 可用 则 把 item  放入队 列否 则引发 full 异 常在 这 种 情 况下 timeout 将被忽略
putnowaititem 相 当于 putitem  false 
getblocktrue  timeoutnone 从队 列中 移 除并 返回 一 个项目
 如果 可选参 数 block  是 true 并且 timeout 是 none  默 认 值 则在 必要 时 阻塞 至 项目 可得 到
如 果 timeout  是 个 正 数 将 最多阻塞 timeout 秒 如果在这段 时间 内 项 目 不能 得到 将引发 empty 异 常
反之 block 是 false  如 果 一个 项目立即 可得 到 则 返 回一个项目否则 引发 empty 异常 这种情况 下 timeout 将被 忽 略
 posix 系统3
0之前以及 所有 版本的 windows  系 统中如果 block 是 true 并且 timeout  是 none 这 个操 作 将进 入基 础锁的 不间 断 等待
 这意 味着 没有 异常 能发生 尤 其 是 sigint 将不 会 触 发 keyboardinterrupt  异常
getnowait 相 当于 getfalse 
 提 供 了 两个 方法 用于支持 跟踪排 队的 任 务 是否被 守护的 消 费者线 程 完整 的处理
taskdone  表示 前 面排 队的 任务 已 经 被 完成
被队列的消 费者线程 使用
 每 个 get 被 用于 获 取 一个 任 务 后续调 用 taskdone 告诉 队列该任务 的处 理已 经完 成
如果 join 当 前正 在 阻 塞 在所有条目都被 处理后将 解除 阻塞 意味 着 每个 put  进队列 的条目的 taskdone 都 被收 到
如果 被调用 的次数 多于 放入 队列中 的项 目数 量将引 发 valueerror  异常
join  阻 塞至 队列 中所有 的元素都 被接 收 和处理 完 毕
 当 条 目添 加 到队 列 的时 候未 完成任 务的 计数就会 增加
每当 消费者 线程 调用 taskdone  表示这 个条 目已经 被回 收该条 目所有工 作已经 完成 未完 成 计数 就会减少
当 未完成 计数降 到零的时候 join 阻 塞被 解除
 如何 等待排队的任 务被 完 成的示 例 import  threading  queue  q  queue
simplequeue 对 象
simplequeue 对 象提供 下列描述 的公共 方法
qsize  返 回队列的大致大 小
注意 qsize 0 不保证 后续的 get 不 被 阻塞
empty  如果 队列为 空返回 true 否 则返 回 false 
如 果 empty  返回 false 不保证 后续 调用的 get  不 被 阻塞
putitem  blocktrue  timeoutnone  将 item 放入队 列
此方法永 不阻塞始 终 成 功除了潜在 的 低级错 误 例如 内 存 分配 失败
 可选 参 数 block 和 timeout  仅仅是 为了保持 queue
put  的兼容 性而提 供其值被忽略
putnowaititem  相当 于 putitem  仅为保 持 queue
putnowait 兼容性而提 供
getblocktrue  timeoutnone 从 队 列中移 除并 返回 一个项 目
如果可 选参数 block  是 true  并 且 timeout  是 none 默认值则在必 要时阻 塞至项 目可得到
 如 果 timeout 是 个 正 数将最 多阻塞 timeout 秒 如果 在这 段 时间内项目 不能 得到将 引 发 empty  异常
 反之 block 是 false 如 果一个项目 立即可得 到 则 返回一个项 目 否则引 发 empty  异常 这 种 情况 下 timeout 将 被忽略
getnowait 相当 于 getfalse 
 参 见类 multiprocessing
queue 一个 用于 多 进程上下 文的 队列类 而不 是多 线程
deque 是 无界 队 列的一个 替 代实 现 具 有 快速 的不需要 锁并 且 支 持索 引 的 原子 化 append 和 popleft  操作
quopri 编码 与解码 经 过 mime  转 码的 可打印 数据
 源 代码 libquopri
py 此 模块 会执 行 转换 后 可打 印 的 传输编码 与 解 码 具体定义 见 rfc 1521 mime  multipurpose  internet  mail  extensions  part  one  mechanisms  forspecifying  and  describing  the  format  of  internet  message  bodies
转换后可 打印的编 码 格 式 被设计用 于 只包含相 对 较 少 的不 可 打 印 字 符 的 数据如果 存在 大 量这 样的 字符 通 过 base 64模 块所 提供的 base 64 编 码方案会 更 为紧凑 例如当 发送图 片文件 时
decodeinput  output  headerfalse  解码 input  文 件的 内 容 并 将已解 码 二 进制 数 据 结 果写 入 output 文 件
 input 和 output  必须 为 二进 制文 件对 象
如 果 提供 了 可选 参 数 header 且为 真值 下划 线 将被 解码 为 空 格
此 函数 可 用 于解 码 q  编码 的头 数据具体 描述见 rfc 1522 mime  multipurpose  internet  mail  extensions  part  two  message  header  extensions  for  nonascii  text 
encodeinput  output  quotetabs  headerfalse  编码 input  文件 的 内容 并将转 换后可打 印 的数 据结果 写 入 output 文 件
 input  和 output  必须 为二 进制 文件对象
 quotetabs 是 一 个 非 可选的旗 标 它 控 制 是否要 编码 内嵌 的空格 与制表 符当 为真 值时将编 码此 类内 嵌空 白符当 为假值时 则 保持 原样不进 行编 码
 请 注意 出现 在行 尾的空格与 制 表 符 总是会被 编 码 具 体 描述见 rfc 1521
 header  旗标 控制 空格符 是否要 编码 为下 划线 具 体 描述 见 rfc 1522
decodestrings  headerfalse 类 似 decode 区 别在于 它接受一 个 源 bytes 并返回 对 应的 已解 码 bytes
encodestrings  quotetabsfalse  headerfalse 类型 encode  区别在于 它接 受一 个 源 bytes 并 返回 对应的 已编 码 bytes
 在默 认 情 况下 它会发送 false  值 给 encode 函数的 quotetabs  形参
 参见模 块 base 64编码与 解 码 mime  base 64 数 据
random  生成 伪随机数
 簿 记 功能
seedanone  version 2初始 化 随机 数生 成器
 如 果 a  被省 略或 为 none 则 使用当前系 统 时 间
 如果操作 系 统 提 供 随机 源 则使 用它 们而不 是系统 时间 有关 可用 性的详细 信 息请参 阅 os
urandom 函数
如 果 a 是 int 类型 则直接使用
 对于 版本2 默 认的 str 、 bytes 或 bytearray  对 象转换 为 int  并使用 它 的所有 位
对 于版本1用 于从旧版 本的 python 再现 随机 序列用于 str  和 bytes 的算法 生成更窄 的种子范 围
在3
2 版更改已 移至版本2 方案该方 案使用 字符 串 种 子中 的所有位
3
9 版后已移 除在将 来 seed 必 须是 下 列类 型之 一 nonetype  int  float  str  bytes  或 bytearray
getstate 返 回捕 获生成器当 前 内 部 状 态的 对 象
 这个 对象 可 以 传 递给 setstate  来恢复 状态
setstatestate  state  应该是 从之 前调用 getstate 获 得 的并且 setstate  将 生 成 器的 内部状 态恢 复到 getstate 被 调用 时的状态
 用 于字节 数据 的函数
randbytesn  生 成 n  个随机字 节
此方法不 可用 于生成安 全凭 据
那应当使 用 secrets
tokenbytes
3
9新 版功 能
整 数用函 数
randrangestart  stop  step 从 rangestart  stop  step  返回一个 随机选 择的 元素
 这相 当于 choicerangestart  stop  step  但实际上 并没 有构建 一 个 range 对象
 位置 参 数模 式匹 配 range 
不应 使 用 关键 字 参数因为 该函数可 能以 意外 的方式 使用 它们
 在3
2 版更 改 randrange 在 生 成均匀 分布的 值 方 面更 为复 杂
以 前它使 用了 像 intrandomn  这样 的形 式它 可以 产生 稍微 不均匀的 分布
randinta  b  返回随 机整 数 n  满 足 a  n  b
相 当 于 randrangea  b 1
getrandbitsk  返回 带 有 k  位随机 的 python  整数
此方 法随 mersennetwister  生成 器一 起提供 其 他一 些生成 器 也可 以将 其作为 api  的 可 选 部 分提供
 如 果可 用 getrandbits 启 用 randrange 来 处 理任意大 范围
 在3
9版 更改 此 方法 现在 接受零 作为 k 的值
 序列用 函 数
choiceseq  从非空 序列 seq  返 回 一个 随机元 素
如 果 seq 为空 则 引 发 indexerror
choicespopulation  weightsnone  cumweightsnone  k 1从 population  中 选择替换 返 回大 小 为 k 的 元素列 表
如 果 population 为 空则引发 indexerror
如 果指 定 了 weight  序列则 根据相对权 重进行选 择
 或者 如果 给 出 cumweights 序列 则根据 累 积权 重可 能使用 itertools
accumulate 计算 进 行 选 择
 例如相 对权重105305 相 当 于累 积 权 重10154550
在内 部相对 权 重在进行选 择之前 会 转换 为累积 权 重 因 此 提 供 累积 权 重 可以 节 省工 作量
如 果既 未 指定 weight  也未指定 cumweights 则 以相等的 概率 进行 选择
如果提 供 了权 重序列 则它必 须 与 population 序 列的长度相 同
一个 typeerror 指 定了 weights  和 cumweights
 weights 或 cumweights  可使 用 random 所返回 的 能与 float 值 进行相互 运算的任 何数字 类 型包 括 int 、 float 、 fraction 但不 包括 decimal
 权重 为负值 的 行为 未有 定义
如果 权 重为 负值则 将引 发 valueerror
对于 给定的种 子具有 相等 加权 的 choices 函数通 常 产生与 重复调用 choice  不同的序 列
 choices 使用 的 算法 使用浮 点运 算来 实现内 部 一致 性和 速度
 choice 使用 的 算法 默认为 重复 选择的 整数运算 以避免 因舍入误差 引起 的 小 偏 差
3
6 新版 功能
在3
9版更 改 如果所 有权重均为负 值 则将引发 valueerror
shufflex  random  将序列 x 随 机 打乱 位置
可选参 数 random 是 一个0参 数 函数 在0
0中返回随 机 浮点数 默认情况下这 是 函数 random 
要改 变一个不 可 变的 序列并返回 一个 新 的打 乱 列表 请使用 samplex  klenx
 请注意 即使对于小 的 lenxx 的排 列 总 数 也可以快速 增 长大于 大多数随机数 生 成器的周 期
这意味 着 长序 列的 大多 数排列永 远 不 会产 生
例如长 度为2080 的序列是 可以 在 mersenne  twister 随机数 生成 器的周期 内拟 合的最大序 列
11可 选形参 random
samplepopulation  k  countsnone 返 回 从总体 序 列或集 合中 选择的唯 一 元素的 k  长 度列表
 用于无重 复的 随 机抽 样
返 回包 含来自总 体的元素 的新 列表 同时 保持 原 始 总体 不变
 结 果列 表按 选择 顺 序排 列 因此 所 有 子切 片也 将是 有效的 随 机样 本
这允 许抽 奖 获奖者样 本被 划分为 大 奖和 第 二 名获 胜 者 子切 片
总 体成员不 必是 hashable  或 unique 
如 果总 体 包含重复 则每次出 现都 是样本 中 可 能的选 择
重 复的元 素可 以一 个 个地直 接列出或 使用 可 选 的仅 限关键 字形参 counts  来指定
例 如 samplered  blue  counts 42 k 5等 价于 samplered  red  red  red  blue  blue  k 5
要从 一系 列整 数中 选 择样本请 使用 range 对象 作为 参数
对 于 从 大量人 群中 采样这 种方 法特 别 快速且节 省空间 samplerange 10000000 k 60
如 果样 本大 小大 于总体 大小则引 发 valueerror 
在3
9版更 改增 加 了 counts 形参
3
9版 后 已移除 在 将 来 population 必 须 是一个 序列
 set 的实 例将 不再被 支持
 集 合必 须先 转换为 list 或 tuple  最好是 固 定顺序 以 使抽 样是可 重现 的
实 值分布
以 下 函 数生 成特定 的实值分 布
如常用 数学实 践中 所使用的 那样函数 参数以 分布 方程中的 相应变量 命名 大多数这 些方程都 可以 在任何统 计学教材 中找到
random 返 回0
01
0范围内 的下一个 随机浮点 数
uniforma  b  返 回一 个随 机浮点数 n  当 a  b  时 a  n  b 当 b  a 时 b  n  a 
 取决 于 等式 a  ba  random  中的浮 点舍 入 终 点 b  可以包 括 或 不包 括在该 范围 内
triangularlow  high  mode 返 回一个随 机浮 点 数 n 使 得 low  n  high 并 在这 些 边界 之间 使用 指定 的 mode 
 low  和 high 边 界 默认为 零和 一
 mode  参 数 默 认 为 边界之 间的中 点给 出对 称分 布
betavariatealpha  beta  beta 分 布
 参数 的 条 件是 alpha 0 和 beta 0
返回 值的 范围 介于0 和1之间
expovariatelambd 指 数 分布
 lambd 是1
0 除以所需 的平均值 它应该是 非零的
该 参数本应 命名为 lambda 但 这是 python 中的 保留字
如 果 lambd 为正则 返回值的 范围为0到 正 无穷大 如果 lambd 为 负则返回 值 从负无 穷大 到0
random
gammavariatealpha  beta  gamma 分 布
不是 gamma 函数 参数的条件 是 alpha 0和 beta 0
概率分 布函数是 x  alpha 1 math
expx  beta  pdfx  math
gammaalpha  beta  alpharandom
gaussmu  sigma  高斯分布
 mu  是平均值 sigma  是标 准差
 这比下 面 定 义的 normalvariate  函数 略快
多线 程注意 事项 当 两个 线程 同时调 用此方 法时 它们有 可能将 获得相 同的返 回值
这 可以通 过三种 办法来 避免
1让 每个线 程使用 不同的 随机数 生成器 实例
2在 所有 调用外 面加 锁
3改用 速 度 较慢 但 是 线程 安全 的 normalvariate 函 数
random
lognormvariatemu  sigma 对 数 正态分布
 如果你采 用 这 个分布 的自 然 对 数 你 将得到 一个 正 态 分布 平均 值 为 mu  和标 准差为 sigma 
 mu  可以 是任何 值 sigma 必 须 大于零
random
normalvariatemu  sigma  正 态分布
 mu  是 平均值 sigma  是标准差
random
vonmisesvariatemu  kappa  冯·米塞斯 von  mises  分布
 mu 是平 均角度以 弧度表示 介于0和2 pi 之 间 kappa 是浓度 参数必须 大于或等 于零
如果 kappa  等于 零则该分 布 在0到2 pi 的 范围内减 小到 均匀的随 机 角度
paretovariatealpha 帕 累托分布
 alpha  是 形状参 数
weibullvariatealpha  beta 威布尔 分 布
 alpha 是比例 参数 beta 是形 状 参数
替 代生成器
 关 于再现性 的说 明
 有时能 够 重现伪 随机 数生成器 给 出的序 列是很有 用 处的
通 过重用一 个 种子值 只要没有 运 行多线 程相同的 序列就应 当 可在多 次运行中 重现
大多 数 随机 模 块 的 算法 和种 子函数 都 会在 python  版本中 发生 变 化 但保证 两个 方 面 不会 改变如果 添 加了 新 的播 种 方法 则将 提 供 向 后兼 容的播种 机
当 兼 容的 播 种机 被赋 予相同 的种 子时生 成器 的 random  方 法将 继续 产 生相同的序列
 例子
基本 示例 random  random  float 0
split  shuffledeck  shuffle  a  list  deck  four  two  ace  three  sample 1020304050 k 4 four  samples  without  replacement 40105030模拟 six  roulette  wheel  spins  weighted  sampling  with  replacement  choicesred  black  green 18182 k 6 red  green  black  black  red  black  deal 20 cards  without  replacement  from  a  deck  of 52 playing  cards  and  determine  the  proportion  of  cards  with  a  tenvalue  ten  jack  queen  or  king
7958 statistical  bootstrapping 的 示例 使用 重新采样 和 替换来估 计一 个 样本的 均值 的置 信区 间 httpstatistics
1 f 使用 重新 采 样排 列测 试来确 定 统计 学显 著性 或者使 用 p  值来观察 药物与 安 慰 剂的 作用之间 差异的示 例 example  from  statistics  is  easy  by  dennis  shasha  and  manda  wilson  from  statistics  import  fmean  as  mean  from  random  import  shuffle  drug 547353707368526565 placebo 54515844555242475846 observeddiff  meandrug  meanplacebo  n 10000 count 0 combined  drug  placebo  for  i  in  rangen  shufflecombined  newdiff  meancombinedlendrug  meancombinedlendrug  count  newdiff  observeddiff  printfn  label  reshufflings  produced  only  count  instances  with  a  difference  printfat  least  as  extreme  as  the  observed  difference  of  observeddiff
多 服务 器队 列的到 达时 间 和 服务交 付 模 拟 from  heapq  import  heappush  heappop  from  random  import  expovariate  gauss  from  statistics  import  mean  median  stdev  averagearrivalinterval 5
 参 见 statistics  for  hackers  jake  vanderplas 撰写的 视 频 教 程使 用 一些基本 概 念 进 行 统计分析 包括 模拟、 抽样、 改组和交 叉验证
 economics  simulation  peter  norvig 编 写的市 场模拟 显示了 该模块 提供的 许多工具 和分布 的有效使 用高斯、均 匀、样本、 beta 变 量、选 择、三 角和 随机范围 等
 a  concrete  introduction  to  probability  using  python  peter  norvig 撰写的 教程涵盖 了概率论 基础 知识 如何 编写 模拟 以及如何 使用 python  进行数据 分 析
例程
 默认的 random 返 回在0
0≤ x 1
0范围内2⁻⁵³ 的倍数
所有 这些 数值 间 隔相等 并 能精确 表示 为 python 浮 点数
 但是 在此 间隔上有 许多 其 他 可表示浮 点 数是不可 能的 选 择
例如0
05954861408025609 就不 是2⁻⁵³的 整数 倍
 以下规 范程 序采 取 了 一 种不同 的方 式
在 间隔 上的 所有 浮点 数都 是 可能 的选 择
它 们的 尾数 取值 来自2⁵²≤ 尾数2⁵³范围 内整 数的 均匀 分布
 指数 取值 则 来自 几何 分 布其中小 于53的指 数的 出 现频 率为 下一 个 较 大指 数 的一 半
bitlength 32 return  ldexpmantissa  exponent 该类 中 所 有的 实 值分 布都 将使用 新 的 方法 fr  fullrandom  fr
87925541791544 该规 范程 序在概念 上 等 效于 在0
0范 围内 对所 有2⁻¹⁰⁷⁴的倍数 进 行选择 的 算法
 所有 这 样的 数 字 间隔都相 等但大 多必 须向下 舍入 为 最接近 的 python  浮点 数表 示形式
2⁻¹⁰⁷⁴ 这个 数值 是 等于 math
0 的未经 正规 化的 最小 正 浮点数
参 见生 成伪随机 浮点 数 值 为 allen  b
 downey  所撰 写 的描述如 何生 成相比 通过 random 正 常生 成 的数值更 细 粒 度 浮点数的 论文
re  正 则表 达 式操 作
源 代 码 libre
py 这 个 模块提供 了与 perl  语 言 类似的正 则表 达式匹配 操作
 模式 和被搜 索的字 符串 既 可以 是 unicode 字符 串 str 也可 以 是8位 字 节串 bytes
 但是 unicode  字 符 串 与8位 字 节串 不 能混 用也就 是说 你 不 能 用 一 个字 节串 模式 去匹 配 unicode 字 符 串反 之 亦然 类似 地当 进 行 替 换 操 作 时 替 换 字符 串 的类 型也必 须与 所 用的模式 和搜索 字符 串的类型 一 致
 正 则 表达 式 使用反斜 杠 字符 来表 示 特殊 形式 或是 允 许在 使 用特 殊 字符 时 不引 发它 们 的特 殊含义
 这会 与 python 的 字符串 字 面 值 中对相同 字符 出 于 相同目 的的 用法 产 生冲 突例如 要匹 配 一个 反 斜 杠字面值 用户 可 能必须 写成 来作为模 式 字符串因 为 正则 表 达 式 必 须 为而 每个反斜 杠 在普 通 python 字 符串 字面 值 中又 必须表示 为
而 且还要 注意 在 python 的 字符 串 字面值 中使 用的反 斜杠 如 果有 任何无 效 的 转 义序 列 现 在 将 会产 生 deprecationwarning 并 将在 未 来 改为 syntaxerror
 此行 为即使 对于正 则 表 达式来 说 有 效的转 义字 符 同 样 会发 生
解决办 法是对 于正 则表达 式样 式 使用 python  的 原始字 符串表示 法在 带有 r  前缀的 字 符 串 字 面 值 中反 斜 杠 不必 做 任何 特殊 处理
 因此 rn  表示包 含 和 n 两 个字符 的字 符串而 n 则 表 示只 包含 一个 换行 符 的字 符串
样式 在 python  代 码中通 常 都会 使用 这种 原始 字符 串 表 示 法 来表 示
 绝大 部 分 正 则表 达式 操 作 都提供 为模块 函数 和方法 在 编 译 正 则 表达 式
 这些 函数 是一 个捷径不 需要 先编 译 一 个正 则对 象 但 是损 失 了 一些 优化参 数
参 见 第 三 方 模 块 regex  提 供了 与标准 库 re 模 块 兼容的 api 接 口 同时 还提 供了额 外的 功能和 更全 面 的 unicode 支 持
正则 表达 式语 法
 模块 内容
 正则 表达 式 对 象 正 则 对 象
匹 配对 象
匹配对象 总是 有 一个布 尔 值 true
如 果 没有 匹配 的 话 match 和 search 返回 none  所以 你 可 以 简单 的用 if  语句 来 判 断是否 匹配 match  re
searchpattern  string  if  match  processmatch  匹配 对 象支 持 以下 方 法和 属性 match
expandtemplate 对 template 进 行反斜 杠转义替 换并且 返回 就像 sub  方法 中一 样
转 义 如同 n  被 转 换 成 合适 的字符数 字引 用12和 命名 组 合 g 1 gname 替 换为相 应组 合的 内 容
 在3
5版 更改不 匹配 的 组 合替 换为 空 字符串
返 回 一 个或者多 个匹配的 子组
 如果只 有 一个参 数 结果 就 是 一个字 符串 如果 有 多个参 数结果 就是 一个 元组每 个 参 数对应 一个 项如果 没有 参数 组1默 认到0整 个匹 配 都被 返 回
如 果一 个组 n  参 数值 为0相 应的返回 值就 是整个 匹 配字 符 串如果 它是 一个范 围1
99结果就 是相 应 的括 号组 字符 串
 如果 一 个组 号 是 负数 或者 大于 样 式中 定 义的 组数 一 个 indexerror 索 引错 误就 raise
 如果 一个 组包 含在 样式 的一部 分并被 匹 配多 次就 返 回 最后 一个 匹 配
 m  re
matchrw  w  isaac  newton  physicist  m
group 0 the  entire  match  isaac  newton  m
group 1 the  first  parenthesized  subgroup
 isaac  m
group 2 the  second  parenthesized  subgroup
 newton  m
group 12 multiple  arguments  give  us  a  tuple
 isaac  newton  如果 正 则 表 达 式 使 用 了 pname … 语法 groupn  参数 就也可 能是 命名组 合 的 名 字
 如 果一个 字符 串 参 数 在 样 式中未定 义为 组 合名 一个 indexerror  就 raise
 一个 相对复 杂 的 例子 m  re
matchrpfirstnamew  plastnamew  malcolm  reynolds  m
groupfirstname  malcolm  m
grouplastname  reynolds  命名 组合同 样 可 以 通 过索 引 值引用 m
group 1 malcolm  m
group 2 reynolds  如 果一 个组匹配 成 功 多 次 就 只 返回 最后 一个匹配 m  re
matchr
 a 1 b 2 c 3 matches 3 times
 m
group 1 returns  only  the  last  match
 c 3 match
getitemg  这个 等价 于 m
groupg
 这 允许 更 方便 的引 用一个 匹配 m  re
matchrw  w  isaac  newton  physicist  m 0 the  entire  match  isaac  newton  m 1 the  first  parenthesized  subgroup
 isaac  m 2 the  second  parenthesized  subgroup
 newton 3
6 新 版功 能
match
groupsdefaultnone  返 回 一个元 组包 含所 有匹 配 的子 组在 样 式中出 现的从1 到 任意 多的 组 合
 default 参数用 于不参与 匹配 的情 况默认 为 none
例如 m  re
matchrd
d 24
1632 m
groups 241632 如果 我们 使小 数点 可 选那 么不 是 所有 的 组都 会参与 到匹配 当中
这 些组 合默认 会返回 一 个 none 除非 指 定了 default 参 数
 m  re
matchrd
d 24 m
groups  second  group  defaults  to  none
24 none  m
groups 0 now  the  second  group  defaults  to 0
240 match
groupdictdefaultnone 返 回一 个字 典 包 含了所 有 的 命 名子组
key  就是 组 名
 default 参 数 用 于 不 参与匹 配的 组合 默认 为 none
例 如 m  re
matchrpfirstnamew  plastnamew  malcolm  reynolds  m
groupdict  firstname  malcolm  lastname  reynoldsmatch
startgroupmatch
endgroup 返 回 group 匹 配到的字串 的开 始和 结 束标 号
group  默 认为0 意思 是整 个匹 配 的子串
 如果 group  存在但 未产生 匹配 就 返回1
对 于一个 匹 配对象 m  和 一个 未参 与匹配的 组 g 组 g  等 价于 m
groupg  产生 的 匹配 是 m
endg 注 意 m
startgroup 将 会等 于 m
endgroup 如 果 group 匹 配一 个空字 符 串的 话
比如在 m  re
searchbc  cba  之后 m
start 0 为1 m
end 0为2 m
start 1 和 m
end 1 都是2 m
start 2 raise  一个 indexerror  例 外
这 个例 子会从 email  地址 中 移除 掉 removethis  email  tonytiremovethisger
spangroup  对于 一 个 匹配 m 返 回一 个 二元 组 m
startgroup  m
endgroup 
注 意如 果 group 没 有 在这个 匹配 中就 返 回11
group 默 认 为0 就是整 个 匹配
pos  pos  的值 会传 递 给 search 或 match  的方 法 a 正 则对 象
这个 是 正 则引擎 开始 在字 符串 搜索一个匹配 的 索引位 置
endpos  endpos  的 值会 传递 给 search 或 match 的方 法 a 正 则对 象
这 个是正则 引擎停止 在字符 串 搜 索一个 匹配 的 索 引位 置
lastindex 捕 获组的 最后一 个匹配 的整 数索引 值或 者 none 如 果 没 有匹 配 产生 的 话
比 如对于 字符 串 ab 表 达 式 ab  ab  和 ab  将 得 到 lastindex 1而 ab  会得 到 lastindex 2
lastgroup  最后 一个匹 配的命名组 名字或者 none  如果没 有产生匹配 的 话
re  返回 产生这个实 例的正则 对象这 个实 例是由正 则对 象 的 match 或 search 方 法产生的
string 传 递到 match 或 search  的 字符串
 在3
7版更改添 加 了 对 copy
copy 和 copy
deepcopy  的支持
匹配 对 象被 看 作是原 子性 的
 正则 表达 式例子
检 查对子
 在这 个例子里 我们 使 用以下 辅助函数来 更 好地 显示匹配 对 象 def  displaymatchmatch  if  match  is  none  return  none  return  match  r  groupsr  match
groups 假 设 你在 写一 个扑克程 序一个 玩家 的一手 牌 为五 个字符的串 每个字符 表 示一 张牌 a  就是 a  k  k  q  q  j  j  t 为102到9 表 示2 到9
 要看 给定的字符 串是否 有 效我们 可 以按 照以下 步 骤 valid  re
 match 727 ak  groups  最 后一 手牌727 ak 包 含了一个对 子或者 两张同样数 值的牌
要 用正 则 表达 式 匹 配它 应 该 使用 向后 引 用如 下 pair  re
 match 354 aa  groupsa  要 找出 对子 由 什么 牌组成开 发者 可 以 按照 下面 的 方 式 来使 用匹配对象 的 group 方法 pair  re
模 拟 scanf
python  目 前 没有一个 类似 c 函 数 scanf 的替代 品
 正 则 表达 式通常比 scanf  格式 字符 串要更强 大 一 些 但 也带 来更多复杂 性
 下 面 的 表格 提供 了 scanf  格式符和 正 则 表 达式 大致 相 同 的映射
 scanf  格式符正则 表达式 c 
deed  i 0 xxdafaf 007 d  o 07 s  s  u  d  x  x 0 xxdafaf 从 文件名 和数 字提 取字 符串 usrsbinsendmail 0 errors 4 warnings  你 可 以使 用 scanf  格式 化 s  d  errors  d  warnings 等价 的正则表 达式 是 s  d  errors  d  warnings
search  vs  match
制作 一个电话 本
split 将字 符串 用参数 传递 的 样 式分 隔开
这 个方法 对 于转换 文本 数据到易 读而 且容易 修 改的数 据结构是很 有用 的如下面的 例子 证 明
首 先这 里是输 入
 它通 常来自一 个文件 这里 我们使用 三重 引号字 符 串语法 text  ross  mcfluff 834
4584919 park  place  条目用一个 或者 多个换行符 分开
 现 在我 们 将 字符串转换为 一个 列表每个非空 行 都有 一个条 目 entries  re
4584919 park  place 最 终将每个 条目 分割为一 个由名 字、 姓氏、电 话号码和地 址组 成的 列表
 我 们为 split 使 用了 maxsplit  形参 因为地 址中 包 含 有被我 们作为分割 模式的空 格 符 re
4584919 park  place  样式 匹配 姓后 面的冒号因 此它 不 出 现在结 果列 表 中
如果 maxsplit 设 置 为4我 们还可 以 从 地址中获 取 到房 间号 re
 文字 整 理
sub 替换字 符串 中出 现的样 式的每 一个 实例
这 个例 子证 明 了 使用 sub  来 整 理 文字或者 随机 化每个 字符的位置 除 了首位 和末尾 字符 def  replm 
 查找 所有 副词
findall  匹配样 式所 有的 出 现不仅 是像 search  中 的 第一 个 匹 配
比 如 如 果 一个作 者希望找 到文 字 中 的 所有 副词 他可 能 会按 照以 下方 法 用 findall  text  he  was  carefully  disguised  but  captured  quickly  by  police
查 找 所 有 的副词 及其 位置
 如果 需要 匹配 样式 的更多 信息 finditer  可以 起到 作用 它提 供 了 匹配 对象 作 为返回值 而不 是字 符串
 继续 上面 的 例 子如果 一 个 作者希望找 到 所有 副 词 和 它的位 置可 以 按 照下 面方法 使用 finditer  text  he  was  carefully  disguised  but  captured  quickly  by  police
 原 始 字 符串 标记
 原始 字符 串记 法 rtext 保持正 则表 达式 正 常
否 则每个 正则式里 的 反斜杠都 必 须 前 缀 一个 反 斜杠来 转义
 比如下 面两 行代 码功能 就是 完 全 一致的 re
match  object  span 04 match  ff 当需要匹配一 个字符 反斜杠 它必 须 在 正则表达式中转义
在 原始字 符 串记 法就 是 r
 否 则就必须用来表示同 样的意 思 re
写一 个词 法 分析 器
一 个词法器或词法分析 器分析 字符串 并分类成 目录 组
 这 是 写一 个 编 译 器或解释器的第一步
 文 字目 录是由 正则 表 达 式指 定 的
 这 个技 术是通 过将这 些样式合并为 一个 主 正则 式并且 循环匹配来 实现的 from  typing  import  namedtuple  import  re  class  tokennamedtuple  type  str  value  str  line  int  column  int  def  tokenizecode  keywords  if  then  endif  for  next  gosub  return  tokenspecification  number  rd
05 endif  for  token  in  tokenizestatements  printtoken 该 词法器 产生以 下 的输出 tokentypeif  valueif  line 2 column 4 tokentypeid  valuequantity  line 2 column 7 tokentypethen  valuethen  line 2 column 16 tokentypeid  valuetotal  line 3 column 8 tokentypeassign  value  line 3 column 14 tokentypeid  valuetotal  line 3 column 17 tokentypeop  value  line 3 column 23 tokentypeid  valueprice  line 3 column 25 tokentypeop  value  line 3 column 31 tokentypeid  valuequantity  line 3 column 33 tokentypeend  value  line 3 column 41 tokentypeid  valuetax  line 4 column 8 tokentypeassign  value  line 4 column 12 tokentypeid  valueprice  line 4 column 15 tokentypeop  value  line 4 column 21 tokentypenumber  value 0
 该书的 第 三版 不 再 包含 python 但第 一版 极详 细地 覆 盖 了正则 表达式 模式 串 的 编写
readline  gnu  readline 接 口
readline 模 块定义了许多 方便从 python  解释器 完成 和读取写 入历史文件的 函数
此 模块 可 以直接 使用或通 过支持在交互 提示符 下 完 成 python 标识 符 的 rlcompleter  模块使用
 使用此 模块 进行 的设 置会 同时 影响 解释 器的交 互 提 示符 以及 内置 input  函 数提 供的提示符
注 解底层 的 readline 库 api 可 能使 用 libedit 库来实现而 不是 gnu  readline
在 macos  上 readline 模块 会在 运行时检 测所使用的是 哪个库
libedit  所用的 配置 文 件与 gnu  readline  的不 同
 如果你要在程序中载 入配置 字符串 你可 以 在 readline
doc  中 检测 文 本 libedit 来区分 gnu  readline 和 libedit
如果你是 在 macos 上使 用 editlinelibedit  readline 模拟 则位 于 你 的 主目 录 中的初始化文件名称 为
例如
editrc  中的以 下内 容 将开 启 vi  按键绑定以及 tab 补全 pythonbind  v  pythonbind  i  rlcomplete
初 始化文 件
下列 函数 与 初始 化 文 件和用户配置有关 readline
parseandbindstring 执 行在 string 参 数中提 供的 初 始化 行
 此函数会调用底层库 中的 rlparseandbind
readinitfilefilename 执 行一个 readline  初始 化 文 件
默认文件名为最近 所 使用 的 文 件 名
 此函数会调用底层库中 的 rlreadinitfile
行缓 冲区
 历史 文 件
 下列函数会在历史文 件 上操 作 readline
readhistoryfilefilename  载 入 一 个 readline 历史文件并将其添加 到历史 列表
 默认 文 件 名为
此函数会调用底 层 库中 的 readhistory
writehistoryfilefilename 将历 史 列表保存为 readline 历史文件覆 盖任何 现有 文件
 默 认文 件名 为
 此函数会调用底层库 中 的 writehistory
appendhistoryfilenelements  filename 将 历史列 表 的最后 nelements 项添加到历史文 件
默认 文件 名为
文件 必须 已 存 在
 此函 数 会 调用底层库中的 appendhistory
此函 数 仅当 python  编译包 带 有支持此功能的库版本 时才会 存在
3
5 新版 功 能
sethistorylengthlength  设 置或 返回需 要保存 到历史文件的 行数
 writehistoryfile  函 数会 通过调 用底层库中 的 historytruncatefile 以使用 该值来 截取历 史 文件
负 值意味 着 不限 制 历 史文件的 大小
 历史 列表
 以 下 函数会 在全局 历 史列 表上操 作 readline
clearhistory  清除当前历史
此函数会 调用 底 层 库的 clearhistory
此 python  函数 仅当 python 编译包带 有 支持 此功能 的 库版本时才会存在
getcurrenthistorylength 返回 历史列 表的 当前项 数
此函数 不同于 gethistorylength 后者是 返 回将 被 写 入 历 史文件的最大行数
readline
gethistoryitemindex 返回 序 号 为 index  的历史 条 目 的当 前内容
 条 目 序 号从 一开始
此 函 数会调 用底 层库 中的 historyget
removehistoryitempos  从历 史列表 中 移 除指 定位 置上 的 历 史 条目
 条 目位置从零开始
此函 数 会调 用底层 库 中的 removehistory
replacehistoryitempos  line 将指定位置上的历 史条目 替换 为 line
条 目 位 置 从零 开 始
此函数会调用底层 库 中的 replacehistoryentry
addhistoryline  将 line 添加 到 历史缓冲区相当于是最 近输入 的一 行
此函数会 调 用底 层 库中的 addhistory
setautohistoryenabled  启用或禁用 当 通过 readline  读 取 输 入 时 自动 调 用 addhistory
 enabled 参 数应 为一 个 布尔 值当其为真 值 时启 用 自 动历史 当其为假值 时 禁用 自 动 历 史
3
6 新 版功 能
 启动 钩子
setstartuphookfunction  设置 或 移除 底层库的 rlstartuphook 回 调 所发 起 调用的 函数
如果指 定 了 function 它 将 被 用 作 新 的钩 子 函数 如果 省略或 为 none 任 何已安装的 函数将 被移 除
钩 子函数将 在 readline 打印第一 个提示 信息之 前不带参数 地被调 用
setpreinputhookfunction 设 置或 移除底层 库的 rlpreinputhook 回调所 发起调 用的函 数
如果指定 了 function 它将 被用 作新的钩 子函数如果 省 略或 为 none 任 何已 安装 的函数 将 被移除
 钩 子函数 将在打印 第 一 个 提示信息 之后、 readline  开 始 读 取 输 入字 符 之前不 带 参 数 地被 调 用
 此函 数仅 当 python  编 译 包 带有 支持 此 功 能的 库 版 本时才 会存 在
completion
以 下函 数 与自定义 单词 补 全函 数 的实 现有关
 这通 常 使 用 tab 键进行 操作 能够 提示并自 动 补全正在 输入 的单词
 默认情 况下 readline  设 置为 由 rlcompleter 来补 全 交 互 模式 解 释 器的 python 标 识 符
 如果 readline 模块要 配合 自定义 的 补全 函 数 来使用则 需要 设置 不同的 单 词 分隔 符
setcompleterfunction 设 置 或移除 补全 函数
如 果指 定了 function  它 将 被用 作 新 的 补 全 函 数如果 省略或为 none  任何已安 装 的 补全 函数 将被 移除
 补 全 函 数的 调用 形 式为 functiontext  state  其中 state 为012
 直至 其返 回一 个 非 字符 串值
 它 应当 返回 下 一个以 text  开头 的候 选补 全 内 容
已安 装的补 全函 数将 由传 递给 底层 库中 rlcompletionmatches 的 entryfunc  回调函 数来 发起调 用
 text 字 符串来自 于底 层库 中 rlattemptedcompletionfunction 回 调函数 的第一个 形参
getcompleter 获取 补全 函 数如果 没 有设置 补 全函数 则返回 none
getcompletiontype 获 取正在 尝试 的补全类 型
此 函数 会将 底层库 中的 rlcompletiontype  变量 作为 一个 整数 返回
getendidx  获取 补全 域的 开始 和结 束序 号
这 些 序 号就 是传给底层 库中 rlattemptedcompletionfunction 回调函 数 的 start  和 end 参数
getcompleterdelims  设置或 获取补 全 的单 词分 隔符
 此分 隔符 确定 了 要 考虑 补全的 单词的 开始 和结 束 位 置 补全域
这些 函 数会访 问 底层库的 rlcompleterwordbreakcharacters 变 量
setcompletiondisplaymatcheshookfunction 设置 或移 除 补 全显 示函数
 如果指定了 function  它将被用作 新的补全 显示 函 数如 果 省略或为 none 任 何已安装 的补 全显 示函数将被 移除
此函 数会设置或 清除底层 库 的 rlcompletiondisplaymatcheshook  回调 函 数
 补全 显示 函数会在 每次 需要 显示匹配项 时以 functionsubstitution  matches  longestmatchlength 的形 式被调用
示 例
 以 下 示 例 演 示了如何 使 用 readline  模块 的 历 史读 取或 写入函数 来自 动加载和保 存 用户主 目录 下名 为
pythonhistory 的 历史 文 件
 以下代码 通常 应当 在交互 会话期 间从用 户的 pythonstartup  文 件 自动执行
writehistoryfile  histfile  此代 码实 际上 会在 python  运行 于交 互模 式时 自动 运 行 参 见 readlineconfiguration
以 下 示例 实现 了同 样的 目标但 是通 过只 添加新历 史的 方式 来 支持并 发的交互 会 话
registersave  hlen  histfile 以下示 例扩 展了 code
interactiveconsole  类以支持 历史保存 恢复
reprlib 另一 种 repr 实现
源代 码 libreprlib
pyreprlib 模块提 供 了一种对 象表 示的 产生方式 它会 对 结果字 符 串的大小 进行 限制
 该方式被 用 于 python  调 试 器也 适 用 于 某些其 他场 景
此 模 块 提 供了 一个 类、一个实 例和 一个 函数 class  reprlib
repr 该类 提供 了格式化 服 务适用于 实现 与内 置 repr 相似的 方法其中 附加 了 针对不 同对象类 型的大小 限 制以避 免 生成超 长的 表示
arepr  这 是 repr 的 一个 实例用于 提 供如 下所述的 repr  函数
 改 变此 对象 的属 性将 会影 响 repr 和 python  调 试器 所使 用的大 小 限制
reprobj  这 是 arepr 的 repr  方法
它 会返 回与同名 内置 函 数 所返 回字 符串相 似的 字符串区别在 于 附 带了 对 多 数 类型 的 大 小限 制
在大小 限 制工 具以 外此 模块 还 提供了一个装 饰器 用于 检测 对 repr 的递归调用 并改 用一 个占位 符来替换
 用于 为 repr 方法检 测同 一线 程内 部递 归调用 的装饰器
如 果执 行 了递 归 调用 则 会返回 fillvalue 否 则执 行正 常 的 repr  调用
 例如 from  reprlib  import  recursiverepr  class  mylistlist 
x 3
2 新 版功 能
repr 对 象
repr  实例对象 包含 一 些 属性可以 用 于为 不 同 对象类 型的 表 示提供 大小限 制 还包含 一 些 方法可 以 格式化特 定的对 象 类 型
maxlevel  创 建 递 归 表示形式 的 深度限制
 默认为6
maxarray  代 表 命 名对 象 类型 的条 目 数量 限制
对 于 maxdict  的默 认 值为4 对 于 maxarray 为5 对于 其 他则为6
maxlong 表示整数 的最大 字 符 数量
 数码会 从中 间被 丢 弃
 默认 值为40
maxstring 表示字符串 的 字符 数 量 限制
 请注 意字 符源会 使用 字符 串 的 正常 表示形式如果表 示 中需 要 用到 转义序列在缩短 表示时 它 们可 能 会 被破 坏
默 认值 为30
maxother  此限 制用于控制在 repr 对 象上 没 有特 定的格式化方法 可用的 对象 类 型 的大 小
它 会以 类 似 maxstring 的 方式被应用
默认 值为20
reprobj 内 置 repr  的等 价形式它使用实 例专属 的格式 化
repr 1 obj  level  供 repr  使用 的递 归实 现
 此方 法使用 obj 的类型来 确 定要调 用 哪个 格式化方法并传 入 obj 和 level
类 型 专属的 方 法 应当 调用 repr 1 来执 行 递归 格式化在递归调 用 中使 用 level 1作 为 level 的 值
reprtypeobj  level 特定 类 型的 格式 化方 法 会被 实现为 基 于类 型名 称来命名的 方法
 在方 法 名称中 type  会被 替换为
对这 些方法 的 分派 会由 repr 1 来 处理
 需要对 值 进行递 归格 式化的类型 专属 方法 应 当调 用 self
repr 1 subobj  level 1
子类 化 repr 对象
通过 repr
repr 1 使用动 态 分派 允许 repr 的 子类添加对 额外内 置对象 类 型的 支持 或 是修改对已支 持类 型的 处理
这个 例 子演 示 了如 何添 加对 文件对 象的 特殊 支 持 import  reprlib  import  sys  class  myreprreprlib
resource  resource  usage  information
error 一 个被 弃用 的 oserror  的别 名
 在3
3版 更改 根据 pep 3151 这个类是 oserror 的 别 名
resource  limits
3
4 新版 功能
3
4 新 版功 能
3
4 新 版 功能
3
4 新版 功 能
3
4新版 功能
3
4 新版 功 能
3
4新版 功能
3
4 新版 功能
3
4 新版 功能
resource  usage
一 个 简单的示 例 from  resource  import  import  time  a  non  cpubound  task  time
 a  brief  summary  is  presented  here 索引 域 resource 0 ruutime  time  in  user  mode  float  seconds 1 rustime  time  in  system  mode  float  seconds 2 rumaxrss  maximum  resident  set  size 3 ruixrss  shared  memory  size 4 ruidrss  unshared  memory  size 5 ruisrss  unshared  stack  size 6 ruminflt  page  faults  not  requiring  io 7 rumajflt  page  faults  requiring  io 8 runswap  number  of  swap  outs 9 ruinblock  block  input  operations 10 ruoublock  block  output  operations 11 rumsgsnd  messages  sent 12 rumsgrcv  messages  received 13 runsignals  signals  received 14 runvcsw  voluntary  context  switches 15 runivcsw  involuntary  context  switches  this  function  will  raise  a  valueerror  if  an  invalid  who  parameter  is  specified
3
2新版 功 能
rlcompleter  gnu  readline 的 补全 函数
 源 代 码 librlcompleter
pyrlcompeleter  通过 补 全有效 的 python 标 识符 和 关键 字 定义 了 一个 适用于 readline 模 块的补全 函数
 当 此模 块在具有可 用的 readline  模块 的 unix  平 台 被导 入一个 completer 实 例将被 自 动创 建并且 它 的 complete 方 法将 设置 为 readline 的补 全 器
示 例 import  rlcompleter  import  readline  readline
rlcompleter 模 块是 为 了 使 用 python 的交 互模式 而 设 计 的
 除非 python  是 通过 s  选 项 运行 这个 模 块总 是自 动 地被 导 入且 配置 参见 readlineconfiguration
 在 没 有 readline 的 平台 此模 块 定义 的 completer 类仍 然可 以用 于自定义 行为
completer  对 象
completer  对象具 有以 下 方法 completer
completetext  state  为 text 返 回第 state  项补 全
 如果指定 的 text 不 包含 句 点 字 符
它将 根据 当前 main  builtins  和保留 关键 字 定义于 keyword  模 块 所 定义 的 名称 进 行补 全
如 果 为带有 句点 的 名称 执 行 调用 它将尝 试 尽 量求 值直到 最 后 一部 分为止 而 不 产生 附 带 影 响 函 数不 会 被 求值但 它可 以 生成对 getattr  的调用 并通 过 dir 函数 来 匹配 剩余 部分
 在对 表达 式求 值期间 引发的 任 何异常 都会 被 捕获、 静默处 理并 返 回 none
runpy  locating  and  executing  python  modules
 参 见 the  m  option  offering  equivalent  functionality  from  the  command  line
 在3
1 版更 改 added  ability  to  execute  packages  by  looking  for  a  main  submodule
在3
2 版 更 改 added  cached  global  variable  see  pep 3147
 在3
4 版更 改 updated  to  take  advantage  of  the  module  spec  feature  added  by  pep 451
 this  allows  cached  to  be  set  correctly  for  modules  run  this  way  as  well  as  ensuring  the  real  module  name  is  always  accessible  as  spec
参见 接口 选项 for  equivalent  functionality  on  the  command  line  python  pathtoscript
3
2新版 功能
 在3
4版 更改 updated  to  take  advantage  of  the  module  spec  feature  added  by  pep 451
 this  allows  cached  to  be  set  correctly  in  the  case  where  main  is  imported  from  a  valid  sys
path  entry  rather  than  being  executed  directly
 参 见 pep 338将 模 块作 为脚本执 行 pep 由 nick  coghlan  撰写并 实现
 pep 366 main  module  explicit  relative  imports  pep  由 nick  coghlan  撰写并 实 现
 pep 451 a  modulespec  type  for  the  import  system  pep  written  and  implemented  by  eric  snow  命令行与 环境 cpython  command  line  details  the  importlib
sched 事 件调 度器
 源 码 libsched
pysched  模 块 定义 了一个 实现通用 事件调 度 程序的类 class  sched
sleep  scheduler  类定 义 了一 个调 度事 件的 通 用 接口
 它 需要 两 个函 数 来实际 处理 外部 世界—— timefunc  应当不 带参 数地 调 用并 返回 一 个 数 字时 间 可 以 为 任 意单位
 delayfunc  函 数 应当带 一个 参数调 用与 timefunc  的 输 出相 兼容 并且应 当 延迟 其所 指定 的时间 单位
每 个事件 运行 后还将调用 delayfunc 并 传 入 参数0以 允许其 他线 程有 机会 在 多 线 程应 用中 运 行
 在3
3版 更 改 timefunc 和 delayfunc 参 数 是可选 的
在3
3 版 更改 scheduler 类可 以 安 全 的 在多线 程环境中 使用
 示例 import  sched  time  s  sched
调 度器对象
scheduler  实例 拥有以 下方法和 属 性 scheduler
enterabstime  priority  action  argument  kwargs 安 排一个新 事件
 time  参数 应 该 有 一个 数字类 型兼 容的 返 回值与 传递 给 构造函数 的 timefunc  函 数 的 返回值 兼 容
计 划在相同 time 的 事件 将按 其 priority 的 顺序执行
数 字越小 表示 优先级 越 高
 执 行事件意为执 行 actionargument  kwargs
 argument  是包 含 有 action  的 位置 参数的序 列
 kwargs 是包含 action  的 关键 字参 数的 字典
 返 回 值是一 个事件 可用 于以后取 消事件参 见 cancel 
 在3
3版 更改 argument  参 数是 可 选的
 在3
3版更改 添 加了 kwargs  形参
enterdelay  priority  action  argument  kwargs  安排 延 后 delay  时 间 单位的 事件
除 了相 对时间其 他 参 数、效 果 和返回值 与 enterabs  的相 同
 在3
3 版更 改 argument 参 数 是可选 的
在3
3版 更改 添加 了 kwargs  形 参
cancelevent  从 队列 中 删 除 事 件
如 果 event 不是当前 队列中 的事件则 此方法 将引发 valueerror
empty 如果 事 件队列为空则 返回 true
runblockingtrue  运 行所 有预定 事件
 此 方 法将 等待 使用 传递 给 构 造函数 的 delayfunc 函 数 进行下 一个事件 然后执 行它依此 类推直到 没有 更多 的 计划 事件
如果 blocking 为 false 则 执行 由于 最快 到期 如 果有的 预定事件 然 后 在调 度程 序中 返回 下一 个预 定调 用的 截止 时 间 如果 有
 action 或 delayfunc  都可以引 发 异 常
在 任何 一种 情况下调 度程序 都将 保 持一 致状 态 并传 播异常
如 果 action 引 发异 常 则在将 来调用 run  时不 会尝试 该事件
如 果一 系 列 事件 的 运行时 间比 下一 个事 件之 前的可用时 间长那 么 调 度程 序 将完 全落 后
不 会 发 生任何事 件 调 用 代码 负责取消 不再 相关 的事件
 在3
3版 更 改添 加了 blocking  形参
queue 只读属 性按 照 将要 运 行 的顺序 返回即 将发 生 的事 件 列表
每个 事 件都显示为 named  tuple  包含 以下字 段 time 、 priority 、 action 、 argument 、 kwargs
secrets 生成安 全 随机数字用 于管 理 密码
3
6新版功 能
源 代 码 libsecrets
pysecrets 模 块可 用 于生 成高 加密强度的 随机 数 适 应 管 理 密码、 账 户验 证、安全 凭据 和 相关机 密数据 管 理的 需 要
特 别地 应当优先使 用 secrets 来 替 代 random 模 块中的 默认 伪随机 数生 成 器后 者被设 计 用于建模和 仿 真 而不适 用于安全 和 加密
参 见 pep 506
 随 机数
通 过 secrets 模块可 以访 问你 的操 作 系 统 所 能提 供的最安 全的 随机性 来 源
systemrandom  使 用操 作系 统所提供的 最高质量 源来 生 成随 机数 的类
 请参 阅 random
systemrandom 了解 更 多 细 节
choicesequence 返 回 从 一 个非 空 序列 中随 机选 取 的元 素
randbelown 返回一 个0 n  范围之 内的 随 机整数
randbitsk  返 回一 个 具 有 k  个 随 机 比特 位 的 整 数
 生 成凭 据
secrets 模 块提 供了 一些 生 成 安 全 凭 据的 函数 适用 于诸如 密 码重 置、难 以猜 测 的 url  之类 的应用场景
tokenbytesnbytesnone  返回一 个包 含 nbytes 个 字节 的 随机字 节 串
如 果 nbytes 为 none 或未提 供则 会 使用 一 个合 理 的 默 认值
tokenhexnbytesnone 返 回一 个十 六进 制 数码 形式 的随 机字 符串
字 符串 具 有 nbytes 个随机 字节 每个字 节转 换为 两 个十六 进制 数 码
如 果 nbytes 为 none  或未提 供则会使 用 一个 合理 的默 认值
tokenurlsafenbytesnone 返回一 个 url 安全的 随机 字 符串 包含 nbytes 个 随 机字 节
 文 本将 使用 base 64编 码因 此 平 均 来说 每个字 节 将对应1
3 个 结果 字 符
 如 果 nbytes 为 none 或 未 提供 则会使 用 一个合 理 的默认 值
 凭据 应当 使用多少个 字节？
 为了 在 面 对暴 力攻 击时 保证 安全凭 据必 须具有 足够 的随 机性
 不幸 的 是 对随 机性是否 足够的标 准会 随 着计 算 机越 来 越 强大 并能 够在 更 短 时间 内 进 行更 多猜测而 不 断提 高
在2015 年时人 们认 为32字 节256位 的随 机性对 于 secrets 模 块所 适 合的典 型 用 例来说是足 够的
作 为 想 要自 行管理 凭据长 度 的用 户你 可 以通过为 各 种 token  函 数 指定一个 int  参数 来显 式 地 指 定凭据要使用 多大 的随 机性
该 参 数以字节 数来 表示要使 用的 随机 性大小
在其他 情 况 下 如果 未提供 参数或者 如果参数 为 none  则 token 函 数 将改用一 个合 理 的 默 认 值
注 解 该默认 值 可 能在任何时候 被改 变包 括 在维 护版 本更 新 的时 候
 其他 功 能
comparedigesta  b 如 果字 符 串 a  与 b 相 等 则返 回 true 否 则返 回 false  该处理 方式 可 降 低 定时 攻击 的 风险
 请参 阅 hmac
comparedigest  了解 更多细 节
应用 技巧与 最 佳 实 践
本节 展 示了 一 些使 用 secrets  来管 理基本安 全级别 的 应用 技巧 和最 佳 实践
 生成长 度为 八个字 符的字母 数 字 密 码 import  string  import  secrets  alphabet  string
choicealphabet  for  i  in  range 8 注 解应 用 程序 不 能以可 恢复 的 格式存 储 密码无 论 是用纯文 本还是 加 密
 它 们应当使 用 高 加密 强 度的单向 不可恢 复 哈 希 函数 来 加盐 并生 成 哈 希值
 生成 长度 为十 个字符 的字 母 数字 密 码其中包含至 少 一个小写 字母 至少一 个大写字 母 以 及至少 三个 数 字 import  string  import  secrets  alphabet  string
isdigit  for  c  in  password 3 break 生成 xkcd 风格的 密码 串 import  secrets  on  standard  linux  systems  use  a  convenient  dictionary  file
choicewords  for  i  in  range 4生成 难以猜 测 的临 时 url 其 中 包 含适 合 密码恢 复应用 的安 全凭 据 import  secrets  url  httpsmydomain
select 等待 io  完成
devpoll  轮 询 对象
 边 缘 触发 和水 平 触发的 轮询 epoll  对象
poll  对象
大 多数 unix  系统 支持 poll 系 统调 用 为 服务 器提供了 更好的 可 伸 缩性使 服务器 可以 同时 服务于 大量 客 户端
poll 的 伸 缩 性 更 好因为 该调 用内 部仅列 出所 关注 的文件 描述符 而 select 会 构 造一个 bitmap  在 其中 将 所 关 注的 描 述 符所 对 应 的 bit  打开 然后重 新 遍历 整个 bitmap
 因此 select  复杂度 是 o 最 高 文 件描 述 符 而 poll  是 o 文 件描述 符数 量
registerfd  eventmask 在 轮询对 象中 注册 文件描 述符
 这 样 将来 调用 poll 方法 时将检 查 文 件描 述 符 是 否有 未 处理 的 io 事件
fd 可以 是整 数也 可 以是 带有 fileno  方法的对 象该 方法 返 回一 个 整数
文件对 象已 经实 现 了 fileno 因 此 它们也可以 用作 参数
 eventmask  是 可选 的位掩 码用 于指定要 检查 的事 件 类型 它可以 是 常量 pollin 、 pollpri 和 pollout 的组 合如 下表 所 述
如 果未指 定本参数默 认将 会检 查 所有3 种类型 的 事件
常数意 义 pollin 有 要读 取 的数 据 pollpri  有紧 急 数据需 要 读 取 pollout 准 备 输出 写不会 阻 塞 pollerr  某种错误条 件 pollhup 挂 起 pollrdhup  流 套 接字 的对 侧关闭 了连 接或关 闭 了写 入到 一半 的 连接 pollnval  无效的 请求描 述 符 未 打开 注册已 注 册过 的文 件描 述 符不 会报错 且等同 于 只注 册一次 该 描述 符
modifyfd  eventmask 修改 一个已 注册的 文件描 述符 等同 于 registerfd  eventmask
 尝试 修 改未 注册的 文件描 述符会 抛出 oserror  异常 错 误码 为 enoent
poll
unregisterfd 删 除 轮询 对象正 在跟 踪的 某 个文 件描 述符
 与 register  方法类似 fd  可以 是 整数 也 可 以 是带 有 fileno 方法 的对 象 该方 法 返回 一 个整数
 尝试 删除 从 未注 册 过 的文 件 描述 符会 抛 出 keyerror  异 常
poll
polltimeout  轮询 已 注册 的文件 描述符的 集合 并返 回一个列 表 列表 可 能为 空 也可 能有 多个 fd  event 二 元组 其中 包含了要报 告 事件或错 误的描述 符
 fd  是 文件 描述符 event  是一 个位 掩 码 表 示 该描 述符 所 报告的 事件 pollin  表示可 以 读 取 pollout  表 示该 描 述 符可 以写入依 此类 推
空 列表 表 示调用 超时没有 任 何文件描 述符报 告 事件
 如果 指定 了 timeout 它将 指定 系 统等 待事 件 时等 待多 长时间 后返 回 以毫 秒为 单位
 如果 timeout 为 空、负数 或 none 则 本调 用 将阻 塞直 到轮询 对象 发 生事 件为 止
在3
5 版更改 现在 当本 函 数被 信 号中 断 时重试超 时将 从头 开始计 时不 会抛 出 interruptederror 异常
 除 非 信号 处理程序抛 出异常 相关 原 理请 参阅 pep 475
kqueue 对象
kevent 对 象
ident  用于 区分 事件的标识 值
其 解 释取 决于筛 选器 但该值 通常 是 文件描述 符
 在 构造 函数中该 标识值可 以是整数 或带 有 fileno  方法 的 对象
 kevent  在内 部存储整数
filter  内 核 筛 选 器的 名 称
 常数 意义 kqfilterread  获取 描述符 并在有数 据可读时返 回 kqfilterwrite 获 取描 述符并在 有数据 可写时 返 回 kqfilteraio  aio 请求 kqfiltervnode  当在 fflag 中监 视的 一 个 或多 个请 求事件发 生时返 回 kqfilterproc 监视 进程 id 上的事 件 kqfilternetdev 观 察网络 设 备 上的 事件在 mac  os  x 上不 可用 kqfiltersignal  每 当监 视 的 信 号传 递 到进程时 返回 kqfiltertimer  建 立 一 个任意 的 计 时 器 kevent
flags 筛 选器 操 作
常 数意 义 kqevadd  添加 或修改 事件 kqevdelete  从队 列 中 删 除事 件 kqevenable  permitscontrol  返 回事 件 kqevdisable 禁 用 事 件 kqevoneshot 在 第一 次 发生后删 除事件 kqevclear  检 索事 件 后重置状 态 kqevsysflags 内 部 事件 kqevflag 1 内 部事 件 kqeveof 筛 选特 定 eof 条 件 kqeverror 请 参阅返 回值 kevent
fflags 筛 选特 定 标 志
 kqfilterread 和 kqfilterwrite  筛选 标 志常数 意 义 kqnotelowat 套 接字缓 冲 区的 低水 线 kqfiltervnode 筛 选标 志常 数意 义 kqnotedelete 已 调用 unlink  kqnotewrite 发 生写入 kqnoteextend  文件 已 扩展 kqnoteattrib  属 性已 更改 kqnotelink  链接 计数 已 更改 kqnoterename 文 件已 重 命 名 kqnoterevoke  对 文 件的访问权 限已 被撤 销 kqfilterproc  filter  flags 常 数意义 kqnoteexit  进 程 已 退出 kqnotefork  该进 程调用了 fork  kqnoteexec  进 程 已执 行 新 进程 kqnotepctrlmask  内 部筛 选器 标 志 kqnotepdatamask 内部 筛 选器 标志 kqnotetrack  跨 fork  执 行 进 程 kqnotechild 在 notetrack  的 子进 程上 返回 kqnotetrackerr  无法 附 加 到子 对象 kqfilternetdev 筛 选 器标志 在 mac  os  x  上不可 用 常 数意 义 kqnotelinkup 链接 已建 立 kqnotelinkdown 链 接已 断开 kqnotelinkinv  链 接 状 态 无 效 kevent
data 筛 选 特 定数 据
udata  用 户自定 义 值
selectors  高 级 io  复用 库
3
4 新版 功能
源 码 libselectors
概 述
 注解 the  type  of  file  objects  supported  depends  on  the  platform  on  windows  sockets  are  supported  but  not  pipes  whereas  on  unix  both  are  supported  some  other  types  may  be  supported  as  well  such  as  fifos  or  special  file  devices
 参 见 select  lowlevel  io  multiplexing  module
 类
 it  can  be  acombination  of  the  modules  constants  below 常 数 意 义 eventread 可 读 eventwrite 可 写 class  selectors
 注 解 this  method  can  return  before  any  file  object  becomes  ready  or  the  timeout  has  elapsed  if  the  current  process  receives  a  signal  in  this  case  an  empty  list  will  be  returned
 在3
5 版 更 改 the  selector  is  now  retried  with  a  recomputed  timeout  when  interrupted  by  a  signal  if  the  signal  handler  did  not  raise  an  exception  see  pep 475 for  the  rationale  instead  of  returning  an  empty  list  of  events  before  the  timeout
3
5新 版功 能
 示例
shelve  python  对象持 久化
源 代码 libshelve
pyshelf  是一 种 持 久 化的 类似字 典的 对象
与 dbm  数据库 的区别在 于 shelf 中的 值 不是 键实际 上可 以为任 意 python 对 象即 pickle  模 块能 够处理 的任 何东西
 这包括 大部分类 实例、递 归数 据类 型以 及包 含大 量 共 享子 对 象的 对 象
 键 则为普 通的 字符串
openfilename  flagc  protocolnone  writebackfalse  打开一 个持 久化字 典
 filename 指定 下 层数 据库 的基 准文 件 名
 作 为 附带效 果会 为 filename  添 加一个 扩展名 并且可 能创 建更多 的文 件
默认 情况 下下 层数据库会 以读写模式 打 开
 可选的 flag  形 参具 有与 dbm
open  flag  形参 相同 的 含 义
 默认 会使 用第3 版 pickle 协 议来序列化 值
 pickle 协议版本 可通过 protocol 形 参 来 指 定
由 于 python 语 义的 限 制 shelf  对象无法确 定一个可变 的持久化 字典条目在何 时被 修改
 默认情况 下只有 在被修 改对象再 赋值 给 shelf 时才 会 写 入该对 象 参 见示 例
 如 果 可 选 的 writeback 形 参设 为 true 则 所 有 被访 问 的条 目 都 将 在内 存中被 缓存 并会 在 sync 和 close  时被 写 入 这 可以使得 对持 久化 字典中 可 变条目 的 修改 更方 便但是如 果访 问的 条目 很多 这会 消 耗 大量 内存作为 缓存 并 会使 得关 闭操作 变 得非常缓 慢因 为 所 有被访问 的条目都 需要写回 到字 典无 法确定 被 访问 的 条 目 中 哪 个 是可 变 的也 无法确定 哪 个 被实 际修改 了
注解请 不要 依赖 于 shelf 的自 动关闭功 能当 你不再需 要时应 当总是 显 式地 调用 close 或 者使用 shelve
open 作 为上 下 文管理器 with  shelve
openspam  as  db  dbeggs  eggs  警告由于 shelve  模块 需要 pickle 的支 持因此 从不可 靠的 来源 载入 shelf  是不 安全的
 与 pickle 一样 载入 shelf  时 可以 执行任意代码
 字典所支 持的 所有 方法 都被 shelf  对象所支持
因 此很 容 易将基 于字 典的 代码转换 为 需要持久化 存储 的代码
 额 外 支持的两 个 方法 shelf
sync  如果 shelf  打 开时 将 writeback 设为 true  则 写回 缓存 中 的所 有 条目
 如 果可行还 会清 空缓 存 并将 持久化 字典 同步 到磁盘
 此 方法 会 在 使用 close  关闭 shelf 时 自动被 调用
close  同 步 并关 闭 持 久 化 dict 对 象
 对 已 关 闭 shelf 的 操作将 失败 并引 发 valueerror
参 见 持 久化 字典 方 案 使用 了广泛支 持的 存 储 格式并具 有原 生 字典的速 度
限 制
示 例
 对接口的 总 结如 下 key  为 字 符串 data  为 任 意对 象 import  shelve  d  shelve
close  close  it  参见 模 块 dbm  dbm 风格数据 库的 泛型接口
模 块 pickle  shelve 所使 用 的对 象序列 化
shlex  simple  lexical  analysis
注 解 since  the  split  function  instantiates  a  shlex  instance  passing  none  for  s  will  read  the  string  to  split  from  standard  input
3
9版 后已 移除 passing  none  for  s  will  raise  an  exception  in  future  python  versions
3
8 新版 功 能
formatquotecommand  printremotecommand  ssh  home  ls  l  somefile  rm  rf  the  quoting  is  compatible  with  unix  shells  and  with  split  from  shlex  import  split  remotecommand  splitremotecommand  remotecommand  ssh  home  ls  l  somefile  rm  rf  command  splitremotecommand 1 command  ls  l  somefile  rm  rf 3
3新 版 功能
 在3
6 版 更 改 the  punctuationchars  parameter  was  added
参 见 module  configparser  parser  for  configuration  files  similar  to  the  windows 
shlex  objects
 在3
8版 更 改 the  punctuationchars  attribute  was  made  compatible  with  the  whitespacesplit  attribute
3
6 新版 功能
parsing  rules
improved  compatibility  with  shells
3
6 新版 功能
shlexa  b  c  punctuationchars  lists  a  b  c 注解 when  punctuationchars  is  specified  the  wordchars  attribute  is  augmented  with  the  characters 
shutil 高 阶文 件 操作
源代码 libshutil
pyshutil  模块提供了 一系 列对 文件 和文 件 集合的 高阶 操 作
特 别是 提 供了一 些支 持 文件 拷贝和删除 的函数
 对 于单 个文 件的操 作请参 阅 os 模块
 警 告 即便 是 高阶 文 件 拷贝函数 shutil
copy  shutil
copy 2也 无 法 拷贝 所有的 文件元数 据
在 posix  平台 上这 意味 着 将 丢 失 文件 所有 者和组 以及 acl 数 据
在 mac  os 上 资源 钩子 和其 他元 数据不 被使 用
这 意 味着 将 丢失 这 些 资 源并 且文件类型 和 创建 者代 码将 不 正确
 在 windows 上 将不会 拷 贝文 件所 有 者、 acl 和 替 代 数据流
 目录 和 文件 操 作
依 赖 于 具体平 台的高 效拷 贝 操 作
从 python 3
8 开始 所 有涉 及文 件拷 贝的 函数 copyfile  copycopy 2 copytree  以 及 move  将会使用 平台 专属 的 fastcopy 系 统调用 以便 更高 效地 拷贝文 件参 见 bpo 33671
 fastcopy 意味 着 拷 贝操 作将 发 生 于内核之中 避 免 像在 outfd
read  中那样 使 用用户 空间 的缓 冲 区
 在 macos  上将 会使 用 fcopyfile 来 拷贝 文 件内 容不含 元数 据
 在 linux  上 将 会使 用 os
sendfile
在 windows  上 shutil
copyfile  将会使 用 更大的默 认缓 冲区1 mib 而非64 kib  并且 会 使 用基于 memoryview  的 shutil
copyfileobj 变种 形 式
如果快速 拷贝操 作 失 败并 且没 有 数 据 被写入 目标 文件则 shutil  将在 内部静 默 地回退到 使 用 效率 较低 的 copyfileobj 函数
在3
8 版更改
copytree  示例
 这 个示例 就 是上面 所 描 述的 copytree  函 数的 实现其 中 省 略 了文 档 字符串
它 还 展示了 此模块 所提 供 的 许 多其他 函数
extendsrc  dst  strwhy  if  errors  raise  errorerrors  另 一个使用 ignorepatterns 辅 助 函 数 的 例子 from  shutil  import  copytree  ignorepatterns  copytreesource  destination  ignoreignorepatterns
pyc  tmp  这将 会拷 贝除
pyc  文 件和 以 tmp 打 头的 文件或目录以外 的所 有条 目
 另一 个使 用 ignore 参 数来 添加 记 录调用的例 子 from  shutil  import  copytree  import  logging  def  logpathpath  names  logging
rmtree 示 例
这 个 例子演 示了 如 何 在 windows  上 删 除一个目 录 树其中 部分文 件设 置 了 只读属 性位
 它 会使 用 onerror 回 调函数来清 除只 读属性位 并再次 尝试 删除
 任 何后续 的失 败都 将 被 传 播
归 档 操作
 归档程 序 示 例
在这 个示例 中我 们 创 建了一个 gzip 压 缩 的 tar  归档文 件 其 中包 含 用 户 的
ssh  目 录下 的 所 有文 件 from  shutil  import  makearchive  import  os  archivename  os
gz  结果 归档文 件中 包含有 tar  tzvf  userstarekmyarchive
 使用 basedir 的归档 程序示 例
在 这 个 例子 中与上 面的 例 子类似我 们演 示了 如何使 用 makearchive  但 这 次是 使用 basedir
我 们现在具 有如 下的目 录结 构 tree  tmp  tmp └── root └── structure ├── content └── pleaseadd
txt  在 最终的 归 档中应 当会 包括 pleaseadd
txt 但 不 应当 包括 donotadd
txt
 因此我们使 用以 下代 码 from  shutil  import  makearchive  import  os  archivename  os
tar 列出结 果归档中 的文 件我们将 会得到 python  m  tarfile  l  userstarekmyarchive
查询 输出终端 的尺寸
getterminalsizefallbackcolumns  lines 获 取终端 窗口 的 尺寸
 对 于 两个 维度 中 的每 一个会分别 检 查环 境变 量 columns 和 lines
 如果 定义 了这 些变 量并 且其值 为正整数 则 将 使 用这 些 值
如果 未定 义 columns  或 lines 这 是 通 常的 情况则 连 接 到 sys
stdout 的 终 端将 通过 发起 调用 os
getterminalsize  被查询
 如果 由于系统不 支持 查 询或 是由于我 们 未连 接 到 某个 终端而 导 致查 询终端 尺寸不成功 则会 使用 在 fallback 形参 中 给出 的值
 fallback  默认 为8024 这 是许 多终端 模拟 器 所使 用的 默认 尺寸
返 回 的 值 是一 个 os
terminalsize 类 型的 具 名元 组
另 请参 阅 the  single  unix  specification  version 2 other  environment  variables
3
3 新 版 功能
signal  设置 异步事件 处理 程序
该 模块提供 了在 python 中 使 用信 号处理 程序 的机 制
一般 规 则
signal
signal 函 数允 许定 义在 接收 到信号 时执 行 的 自定 义 处理 程序
 少 量的 默认 处理 程序已 经 设 置 sigpipe  被忽 略因 此管 道 和套 接字上的 写 入错 误可以报 告为 普通 的 python  异常 以 及 如 果父进 程没 有 更改 sigint 则 其 会 被 翻 译 成 keyboardinterrupt 异 常
一 旦设 置特 定 信 号的处 理程 序将 保 持 安 装直到 它被 显 式 重置 python  模 拟 bsd 样式 接口 而不 管 底层 实现 但 sigchld  的处 理程序 除 外它 遵循 底 层实现
执 行 python 信 号处 理程 序
python 信 号处 理 程序 不 会 在低 级 c 信 号 处理 程序 中执 行
相 反低级信 号处理 程序 设置 一 个标志告 诉 virtual  machine 稍 后执 行 相 应的 python  信号 处理 程 序例如在 下一个 bytecode  指令
 这会导 致捕 获 同步 错误 是没 有意 义 的例 如 sigfpe 或 sigsegv  它们是由 c 代 码中 的无效操作 引起 的
python 将 从信 号处 理程 序返 回到 c  代 码这 可能 会再 次 引发 相同 的信 号导 致 python 显然的 挂 起
 从 python 3
3开 始你可 以 使用 faulthandler  模块 来报 告同步错误
 纯 c 中 实现 的 长时 间运 行的计 算例如在大 量文本 上 的正则 表 达 式 匹配 可 以 在任 意时 间 内不 间断 地运 行 而不管 接 收到 任何 信号
 计 算 完成 后将调 用 python 信 号 处 理程 序
信 号 与线 程
 模 块 内容
 在3
5 版 更改 信 号 sig 处 理 程 序 sigdfl  sigign 和 sigmask  sigblock  sigunblock  sigsetmask  下面列 出的相 关常量变 成了 enums 
 getsignal  pthreadsigmask  sigpending  和 sigwait  函 数 返 回人类 可 读的 enums 
 在 signal  模块中 定义的 变量是 signal
sigdfl 这 是 两种 标 准信 号处 理 选项 之一它只 会执行信号 的默 认函数
 例如 在大 多数 系 统上 对于 sigquit  的默 认操 作是 转 储核心 并退 出而对 于 sigchld 的 默认 操 作是 简单 地忽 略它
sigign  这 是另 一 个标 准信 号处 理 程序 它将简单 地忽 略给定 的信 号
可 用 性 windows
 可用性 windows
参 见 zerodivisionerror  is  raised  when  the  second  argument  of  a  division  or  modulo  operation  is  zero
ctrlcevent 对 应于 ctrlc  击 键事 件的信 号
此信号 只能 用于 os
kill 
可 用性 windows
3
2 新版 功能
ctrlbreakevent  对 应于 ctrlbreak  击键 事件 的 信 号
此信 号 只能用于 os
kill 
 可用性 windows
3
2 新版 功 能
nsig  比最 高信 号 数多 一
itimerreal 实 时递 减间 隔 计 时器 并在 到期时 发 送 sigalrm 
itimervirtual  仅 在进 程执行 时递减 间隔 计时 器 并在 到期 时 发 送 sigvtalrm 
3
3新版 功 能
3
3 新 版功 能
3
3 新版功能
3
3 新版功 能 this  error  used  to  be  a  subtype  of  ioerror  which  is  now  an  alias  of  oserror
3
8新版 功能
3
8新版 功能
3
8 新版功 能
13
9 新版 功能
3
3 新版 功能
3
3 新版功 能
 在3
5 版 更 改 on  windows  the  function  now  also  supports  socket  handles
 在3
7版 更改 added  warnonfullbuffer  parameter
3
3新版 功能
3
3 新版 功 能
3
3 新版 功能
在3
5版 更 改 the  function  is  now  retried  if  interrupted  by  a  signal  not  in  sigset  and  the  signal  handler  does  not  raise  an  exception  see  pep 475 for  the  rationale
3
3新版 功能
在3
5 版更 改 the  function  is  now  retried  with  the  recomputed  timeout  if  interrupted  by  a  signal  not  in  sigset  and  the  signal  handler  does  not  raise  an  exception  see  pep 475 for  the  rationale
 示例
note  on  sigpipe
site —— 指定域 的 配 置钩 子
readline  configuration
在3
4版 更改 activation  of  rlcompleter  and  history  was  madeautomatic
模 块内 容
在3
3 版更 改 this  function  used  to  be  called  unconditionally
3
2新 版 功 能
3
2新 版功能
3
2新 版功 能
命 令 行 界面
 参见 pep 370分 用 户 的 sitepackages 目 录
smtpd  smtp  服务 器
 源代 码 libsmtpd
 参 见 the  aiosmtpd  package  is  a  recommended  replacement  for  this  module
smtpserver 对 象
3
4新版 功能 the  map  constructor  argument
在3
5 版 更改 localaddr  and  remoteaddr  may  now  contain  ipv 6 addresses
3
5 新 版功能 the  decodedata  and  enablesmtputf 8 constructor  parameters  and  the  kwargs  parameter  to  processmessage  when  decodedata  is  false
在3
6版 更 改 decodedata  is  now  false  by  default
debuggingserver 对 象
pureproxy  对 象
mailmanproxy  对象
smtpchannel 对象
 在3
5版更改 the  decodedata  and  enablesmtputf 8 parameters  were  added
 在3
6版更改 decodedata  is  now  false  by  default
 built  into  the  base  smtpchannel  class  are  methods  for  handling  the  following  commands  and  responding  to  them  appropriately  命令所采 取的行动 helo  接 受来 自客 户端的问 候语并将 其存储在 seengreeting  中
 将服 务器 设置为基 本命令 模式
 ehlo 接 受来 自客户 的问候 并将其 存 储在 seengreeting  中
将 服务 器设置 为扩展命令 模式
 noop  不采 取任何措施
 quit  干净 地关闭连接
 mail  accepts  the  mail  from  syntax  and  stores  the  supplied  address  as  mailfrom
 rset  重置 mailfrom  rcpttos  和 receiveddata  但不 重置 问候语
 data  sets  the  internal  state  to  data  and  stores  remaining  lines  from  the  client  in  receiveddata  until  the  terminator  rn
 help 返 回有 关命 令语法 的最 少信息 vrfy  返回代 码252服务器 不知 道 该 地址是 否 有效 expn  报 告该 命 令未实现

smtplib  smtp  协议 客户端
 在3
3版 更改支 持了 with  语句
在3
3版 更 改 sourceaddress  argument  was  added
3
5 新 版 功 能 the  smtputf 8 extension  rfc 6531 is  now  supported
在3
9 版更 改 if  the  timeout  parameter  is  set  to  be  zero  it  will  raise  a  valueerror  to  prevent  the  creation  of  a  nonblocking  socketclass  smtplib
在3
3 版 更改 增加 了 context
在3
3 版更 改 sourceaddress  argument  was  added
在3
4 版 更 改 the  class  now  supports  hostname  check  with  ssl
3
6 版 后已移 除 keyfile  and  certfile  are  deprecated  in  favor  of  context
 please  use  ssl
loadcertchain  instead  or  let  ssl
createdefaultcontext  select  the  systems  trusted  ca  certificates  for  you
 在3
9 版更 改 if  the  timeout  parameter  is  set  to  be  zero  it  will  raise  a  valueerror  to  prevent  the  creation  of  a  nonblocking  socketlmtphost  portlmtpport  localhostnamenonesourceaddressnone  timeout  the  lmtp  protocol  which  is  very  similar  to  esmtp  is  heavily  based  on  the  standard  smtp  client
 在3
9版 更 改 the  optional  timeout  parameter  was  added
 在3
4版 更改 smtpexception  became  subclass  of  oserrorexception  smtplib
3
5 新版功 能
 参 见 rfc 821 simple  mail  transfer  protocol  protocol  definition  for  smtp
smtp  objects
 在3
5 版更 改 added  debuglevel 2
注 解 many  sites  disable  smtp  vrfy  in  order  to  foil  spammers
在3
5版更 改 smtpnotsupportederror  may  be  raised  and  the  initialresponseok  parameter  was  added
3
5新版功 能
3
6 版后 已 移除 keyfile  and  certfile  are  deprecated  in  favor  of  context
 please  use  ssl
loadcertchain  instead  or  let  ssl
createdefaultcontext  select  the  systems  trusted  ca  certificates  for  you
 在3
3 版 更改 增加了 context
 在3
4版更改 the  method  now  supports  hostname  check  with  sslcontext
在3
5 版更改 the  error  raised  for  lack  of  starttls  support  is  now  the  smtpnotsupportederror  subclass  instead  of  the  base  smtpexception
 注解 the  fromaddr  and  toaddrs  parameters  are  used  to  construct  the  message  envelope  used  by  the  transport  agents
 在3
2 版更 改 msg  may  be  a  byte  string
在3
5版更改 smtputf 8 support  added  and  smtpnotsupportederror  may  be  raised  if  smtputf 8 is  specified  but  the  server  does  not  support  it
3
2 新版功 能
3
5新 版 功能 support  for  internationalized  addresses  smtputf 8
smtp  example
quit  注 解 in  general  you  will  want  to  use  the  email  packages  features  to  construct  an  email  message  which  you  can  then  send  via  sendmessage  see  email 示例
sndhdr  推测声 音文件的类 型
socket 底层 网络 接 口
源 代码 libsocket
py 这个模 块提供 了访 问 bsd  套接 字 的 接 口
在所有 现代 unix 系统、 windows 、 macos 和 其他一些 平台 上 可用
 注 解一些行为 可能因平 台不 同 而异 因 为调用 的是操 作系统的套 接字 api
这 个 python 接 口 是用 python  的面向对象 风格对 unix  系统 调 用和 套 接字库 接口的 直译函数 socket 返 回一个 套接 字 对象 其 方法是对各 种套接 字系统调 用的 实 现
 形参 类型 一 般 与 c  接 口相 比更 高级 例如 在 python  文件 read  和 write   操作 中接 收操 作的 缓 冲区 分 配是 自动的发 送操 作的 缓冲 区长 度 是隐 式的
 参见 模块 socketserver  用 于简 化 网络 服务端编 写的 类
模 块 ssl 套 接 字 对 象 的 tlsssl 封 装
 套接 字 协议 族
 模 块 内容
socket  模 块 包含 下 列 元 素
 异常
 常 数
 函数
 套 接字 对象
 关 于 套 接字 超时 的说 明
超 时 与 connect 方法
connect 操 作 也受 超时 设 置 的约 束通 常建 议在调用 connect  之前 调用 settimeout  或将 超 时参数直 接 传递 给 createconnection
但 是 无论 python  套接 字 超时 设置 如何系统 网络 栈都 有 可能 返回自 带的 连 接 超时错误
超 时与 accept  方法
如 果 getdefaulttimeout 的 值 不是 none  则 accept 方 法返回的 套接 字将 继 承 该 超时 值
 若是 none 返 回 的套接字 行为 取 决于 侦 听 套 接 字的 设置 如果 侦 听 套 接字 处于 阻塞 模 式或 超时模 式则 accept  返 回 的套接字处 于阻 塞 模 式如果侦 听套 接字处于 非阻 塞模 式那么 accept  返回 的套 接 字 是 阻 塞 还是 非阻 塞 取 决 于 操 作系 统
如 果 要 确 保 跨平 台时 的 正 确 行 为 建议 手动 覆盖 此 设置
 示例
socketserver  a  framework  for  network  servers
server  creation  notes
在3
7 版更 改 socketserver
serverclose  and  socketserver
serverclose  now  waits  until  all  child  processes  and  nondaemonic  threads  complete
server  对 象
在3
3版更改 added  serviceactions  call  to  the  serveforever  method
3
3 新版 功 能
 在3
6版更改 now  only  called  for  exceptions  derived  from  the  exception  class
 在3
6版 更改 support  for  the  context  manager  protocol  was  added
request  handler  objects
在3
6版 更改 streamrequesthandler
wfile  also  supports  the  io
 示例
socketservertcpserver  example
socketserverudpserver  example
asynchronous  mixins
spwd  the  shadow  password  database
h  索引属 性意 义0 spnamp 登 录 名1 sppwdp  encrypted  password 2 splstchg  date  of  last  change 3 spmin  minimal  number  of  days  between  changes 4 spmax  maximum  number  of  days  between  changes 5 spwarn  number  of  days  before  password  expires  to  warn  user  about  it 6 spinact  number  of  days  after  password  expires  until  account  is  disabled 7 spexpire  number  of  days  since 19700101 when  account  expires 8 spflag  reserved  the  spnamp  and  sppwdp  items  are  strings  all  others  are  integers
 定 义 了 以下 函数 spwd
 在3
6 版 更 改 raises  a  permissionerror  instead  of  keyerror  if  the  user  doesnt  have  privileges
 参 见模 块 grp 针 对 用 户 组 数据 库的 接 口 与 本 模 块类 似
模 块 pwd  an  interface  to  the  normal  password  database  similar  to  this
sqlite 3 sqlite 数 据 库 dbapi 20接 口模块
 模块 函 数 和常量
连接 对象 connection
cursor  对 象
 行对象
异 常
sqlite 与 python  类型
概述
sqlite  原生 支持 如下的 类型 nullintegerrealtextblob
 因此 可 以 将 以 下 python  类型 发送到 sqlite 而 不会 出现 任 何 问 题 python 类 型 sqlite 类型 none  null  int  integer  float  real  str  text  bytes  blob 这 是 sqlite 类 型 默认 转 换 为 python  类型 的方式 sqlite 类 型 python 类 型 null  none  integer  int  real  float  text  取 决于 textfactory  默认 为 str  blob  bytes  sqlite 3 模 块的类型系 统可 通过 两种 方式 来 扩 展你 可以 通过 对象适配将 额外 的 python 类 型保 存在 sqlite  数 据 库中 你也 可以 让 sqlite 3模 块通过 转 换器 将 sqlite 类 型转 换 为 不同 的 python 类 型
使 用适 配器 将额 外的 python 类 型保存 在 sqlite  数 据 库中。
 如上 文所 述 sqlite 只 包含 对有 限 类型 集的原 生支 持
要让 sqlite  能使 用其他 python 类 型 你 必须 将它 们适 配至 sqlite 3 模块 所支持的 sqlite  类型 中的 一种 nonetype  int  float  str  bytes
 有两 种方 式 能让 sqlite 3 模块 将某 个定 制的 python 类 型 适配 为 受支 持的类型
 让对 象自 行适 配如果类是 你 自己编 写 的 这将是一 个很 好 的方 式
假 设你 有 这 样一 个类 class  point  def  initself  x  y  self
y  x  y  现在你可 将 这种点 对象 保存 在一 个 sqlite 列 中
 首先你必须 选 择 一 种受支持 的 类型用来 表示 点对 象
让 我 们就 用 str  并使 用一个分号 来 分隔 坐标 值
然 后你 需要 给 你 的 类加 一个 方 法 conformself  protocol 它 必 须返回 转换 后的 值
 形参 protocol 将 为 prepareprotocol
close 注 册 可调 用 的 适配 器 另 一 种可 能 的做 法是 创建 一个 将该类 型转换为 字符 串表示 的函 数并 使用 registeradapter 注册 该函 数
closesqlite 3模块有 两个 适配器 可用 于 python  的内 置 datetime
date  和 datetime
datetime  类型
现 在 假 设我们 想 要存 储 datetime
datetime 对 象 但不 是表示为 iso 格 式 而是 表示为 unix 时 间戳
 将 sqlite 值转 换 为 自 定义 python  类型
 编 写适 配 器 让你 可以 将定 制的 python  类型 发送 给 sqlite
但 要令 它 真 正有 用我们需 要 实现 从 python 到 sqlite 再 回到 python  的双向 转换
 输入转 换器
 让我 们 回到 point  类
我们 以字 符串 形 式在 sqlite  中存 储了 x 和 y  坐标 值
 首 先 我 们将 定 义 一个 转换器 函数 它接 受这 样 的 字 符 串 作 为 形 参并 根 据该 参 数构 造一 个 point  对象
 注解转换 器 函 数 在 调 用时 总是会 附带 一个 bytes 对 象无 论你 将何 种数 据类 型 的 值发 给 sqlite
splitb  return  pointx  y 现 在你 需 要让 sqlite 3 模 块 知道 你从数据 库 中选取 的其 实 是 一 个点对 象
有两 种 方式 都可 以做 到这件 事隐 式的 声明类 型 显式的 通过列 名这 两种 方 式 会在 模块 函 数和 常量 一 节中描述相 应条 目为 parsedecltypes  和 parsecolnames  常 量
下 面 的 示 例说 明 了这 两种 方法
 默认适 配器 和转 换器
对于 datetime  模块 中 的 date  和 datetime  类型 已提 供 了默 认 的 适配 器
 它们将会 以 iso  日期 iso  时 间 戳 的形式 发 给 sqlite
默 认 转 换器使 用的 注册名 称是 针对 datetime
date  的 date  和针 对 datetime
datetime 的 timestamp
 通 过这 种方 式你 可 以 在大 多数 情 况下 使用 python  的 datetimestamp  对 象 而无 须任 何 额 外处 理
适 配器 的格式 还与 实 验 性的 sqlite  datetime 函数 兼 容
下 面 的示 例演 示 了这 一点
close  如果 存储在 sqlite 中 的 时间 戳的 小数位多 于6 个数字则 时 间戳转换器 会 将 该值截断 至 微秒 精度
控制 事务
 有效使 用 sqlite 3
使 用快捷 方式
 使 用 connection  对 象的 非 标 准 execute  executemany 和 executescript  方 法可以 更简洁 地编 写代 码因 为 不必 显式 创建 通 常 是 多余 的 cursor 对 象
相 反 cursor  对象是 隐 式创建的 这 些 快捷 方法返 回游 标对象
 这 样只 需 对 connection  对象 调 用一次 就能直 接执 行 select 语 句并 遍 历 对 象
通 过名 称 而 不 是索 引访 问索 引
sqlite 3 模块的 一 个有用功 能 是 内置 的 sqlite 3
row 类该 类旨 在用作 行 工厂
 该 类 的行 装 饰器可 以用索 引如 元组 和不 区分大小 写 的 名称 访问 import  sqlite 3 con  sqlite 3
使 用连 接 作为上 下 文管 理 器
 常见 问 题
多线 程
较老 版本 的 sqlite 在 共享 线程之 间 存在 连接 问题
这 就 是 python 模块 不允 许线 程 之间 共享 连 接 和游 标的 原 因
 如 果仍 然尝 试这 样做则在 运行 时会出 现异 常
 唯 一的 例 外是 调用 interrupt 方 法该 方 法仅 在从 其他线程 进行 调用 时才 有意义
 脚 注1 sqlite 3 模 块默 认没 有构 建 可 加 载扩 展 支持 因为有一 些 平 台带 有不支 持这 个 特性的 sqlite  库 特别 是 mac  os  x
要 获 得可加 载 扩展 的支持 那么在 编译配 置的 时候 必须 指定 enableloadablesqliteextensions 选项
ssl  套 接 字对 象的 tlsssl 包 装器
 方 法、常量 和异 常处 理
 套接 字 创 建
从 python 3
2 和2
9开 始建 议使 用 sslcontext 实 例 的 sslcontext
wrapsocket  来 将 套 接 字 包装 为 sslsocket  对象
 辅助函数 createdefaultcontext  会返回 一个新的 带有 安全 默 认设置的 上下文
旧的 wrapsocket  函数 已被 弃用 因 为 它 效率 较差并 且不 支持服务 器 名称提 示 sni 和主机 匹配
客户 端套接字 实例采用 默认上下 文 和 ipv 4 ipv 6双栈 import  socket  import  ssl  hostname  www
version  客户 端套 接字 示例 带有自 定义 上 下文和 ipv 4 hostname  www
version 服 务 器套接字 实例 在 localhost 上 监 听 ipv 4 context  ssl
 上 下文 创建
 便捷 函数 可以 帮助 创 建 sslcontext 对 象 用于常见 的目 的
serverauth  cafilenone  capathnone  cadatanone 返 回一个新 的 sslcontext 对 象使 用 给定 purpose  的默 认 设置
 该设置 由 ssl 模 块选 择并且通 常 是 代表一 个比 直 接调用 sslcontext 构造 器 时 更高的 安全等 级
 cafile  capath  cadata 代 表用 于进 行证 书 核验 的可选 受 信 任 ca 证书 与 sslcontext
loadverifylocations 的 一致
 如 果三 个 参 数 均为 none  此函 数可 以转 而选 择信 任系 统的 默认 ca  证书
设 置 包括 protocoltls  opnosslv 2 以及 opnosslv 3 具 有不带 rc 4和 不带 无身 份验 证密 码套 件 的高度加 密密码 套件
 传入 serverauth 作为 purpose  会把 verifymode 设为 certrequired  并且 加载 指定 ca  证书 当给 出 cafile  capath 和 cadata  中的 至少 一个 或者 使用 sslcontext
loaddefaultcerts 来加 载 默 认 ca 证 书
当 keylogfilename  受支 持并 且设 置了环境 变量 sslkeylogfile  时 createdefaultcontext 会 启用 密钥 日志 记 录
注 解协 议、选项、密码 和 其他设 置 可 随时更改 为更 具 约束 性的 值而 无须 事 先弃 用
这 些 值 代表 了兼 容性 和安 全性 之间 的合 理平衡
 如果 你的应用 需 要特定的 设置 你 应当 创 建一 个 sslcontext 并 自行 应用 设置
注解 如果你发 现当某些 较旧的客 户 端或服 务器 尝试 与用 此函 数创 建的 sslcontext  进行 连 接时 收到 了报错 提示 protocol  or  cipher  suite  mismatch  这可能 是因 为它 们只 支持 ssl 3
0而它 被此 函数 用 opnosslv 3排 除掉 了
0被 广泛 认为 完全不 可用
 如果你仍希 望继续 使用此函数 但仍允 许 ssl 3
0连 接你 可以 使用 以 下代 码重 新启 用它 们 ctx  ssl
opnosslv 33
4新 版 功能
在3
4版 更改 rc 4 被从 默认密码 字 符串 中丢 弃
在3
6 版更 改 chacha 20 poly 1305被添加到 默认 密码字 符 串 中
3 des 被从默认 密码字 符 串中 丢弃
在3
8 版 更改 增加 了对 密 钥日 志记 录至 sslkeylogfile 的 支持
 异常
sslerror 引发此 异 常以 提 示 来自 下层 ssl 实现 目 前由 openssl  库提供的错 误
 它 表示 在 下 层网 络连 接之 上叠加 的高层级加 密和 验 证层 存在某种 问题
此错 误 是 oserror  的一 个子 类型
 sslerror  实 例的 错 误和消 息是 由 openssl 库 提 供的
 在3
3版更改 sslerror  曾经是 socket
error 的 一 个子类 型
 library  一个 字 符 串形 式的 助 记符 用来 指 明发 生 错误的 openssl 子 模 块 例如 ssl  pem  或 x 509
可能的 取 值 范围依赖 于 openssl 的版本
3
3 新版 功 能
 reason 一 个 字符串 形式的助记符 用来指 明发生错误 的原因例如 certificateverifyfailed
 可能 的取值 范围 依赖于 openssl 的 版本
3
3 新 版功能
sslzeroreturnerror  sslerror 的子 类当 尝试 读 取或 写入 且 ssl 连 接 已被完全 关闭 时 会被 引发
 请 注 意 这并 不 意味 着下层的 传输 读取 tcp 已被 关 闭
3
3 新版功 能
sslwantreaderror  sslerror 的 子 类当尝 试读取或 写入 数 据但 在 请求 被 满 足 之 前还 需 要 在下 层的 tcp  传输上接 收更 多数据 时 会被 非阻 塞型 ssl  套 接字引发
3
3 新版 功能
sslwantwriteerror  sslerror  的 子类当尝试 读取 或写入数 据但在请求被 满足之前 还需 要 在 下层 的 tcp 传输上发 送 更 多 数 据时 会被非阻 塞型 ssl  套接 字引发
3
3 新版 功能
sslsyscallerror  sslerror 的 子类当尝 试 在 ssl 套接字 上 执行 操 作 时 遇 到系 统错 误时 会 被引 发
 不幸的 是 没有 简单的 方式 能检查原 始 errno  编号
3
3 新版功能
ssleoferror  sslerror 的 子类当 ssl  连接 被 突然终止 时 会 被 引发
通 常 当遇 到此错 误时 你不 应再 尝试 重 用下 层的 传输
3
3新 版功 能
sslcertverificationerror  sslerror  的子 类当 证书 验证失败 时会被 引发
3
7 新版功能
 verifycode  一 个数 字形式 的错 误 编号 用于表 示验证错误
 verifymessage  用 于 表 示验 证错 误的 人类可读 的字 符 串
certificateerror  sslcertverificationerror  的 别名
 在3
7版 更改此异常 现在 是 sslcertverificationerror  的 别名
 随机 生 成
randbytesnum 返 回 num  个高加 密强度伪 随 机字 节数 据
如果 prng 未 使用 足够 的数 据 作 为随 机 种子 或者 如果 当前 rand  方法 不支 持该操作 则 会 引 发 sslerror
 randstatus 可被用 来 检查 prng  的状 态而 randadd  可被 用来 为 prng 设置 随机 种子
 对于几 乎所 有应 用程 序都 更推荐 使用 os
urandom
请 阅读 维基百 科文 章 cryptographically  secure  pseudorandom  number  generator  csprng 以了解 对于高加 密 强度 生成 器 的 具体 要 求
3
3新 版 功能
randpseudobytesnum  返回 bytes  iscryptographic  bytes  是 num 个 伪 随 机字节 数据 如 果所生成 的字 节数 据为高加 密强 度则 iscryptographic 为 true
如 果 当前 rand  方法 不 支持 此 操作 则会引 发 sslerror
所 生成 的伪 随机 字节 序列 如果 具有足够 的长度则 将会具有 唯一 性并 是并 非不 可预测
它 们可被用 于非加密 目的 以及 加密 协议 中的特定 目的但通 常不可被 用于 密钥 生成等目的
 对于几 乎所 有应 用程 序都 更推 荐使用 os
urandom
3
3新版 功能
3
6 版后已移除 openssl  已弃用了 ssl
randpseudobytes  请改用 ssl
randbytes
randstatus 如果 ssl  伪随 机数 生 成器 已使 用‘ 足 够的’随 机 性作 为种 子则返回 true  否 则 返 回 false
 你可以 使用 ssl
randegd  和 ssl
randadd 来 增加伪随 机 数生成 器 的 随机性
randegdpath 如 果 你在 某处运 行了 一 个 熵 收 集守护 程序 egd  且 path  是 向 其 打 开 的 套接 字 连接 路 径 名 此 函 数将 从该 套 接字 读取256 个 字节的随 机 性 数 据并 将 其添 加 到 ssl  伪随 机数 生 成器 以 增加 所生成 密 钥的 安 全 性
 此 操 作通 常 只 在 没有更好 随机 性 源 的系统上 才是必 要的
 请查 看 httpegd
net 或 httpprngd
net  来 了 解 有关 熵收集 守护 程序 源 的信息
 可用性对 于 libressl 和 openssl 1
0 不 可 用
randaddbytes  entropy 将给定 的 bytes 混合 到 ssl 伪随机 数生 成器 中
 形 参 entropy  float 类型 是数据所 包含 的 熵 的下界因 此你可 以总是使 用0
请 查看 rfc 1750 了 解 有关熵 源的更多 信息
 在3
5版 更 改 现在接受 可写 的字 节 类 对象
证 书处理
常 数
3
6新 版 功 能
3
6新 版功 能
3
4 新版 功能
3
4 新 版功 能
3
4新 版功 能
3
4新 版 功能
3
4新 版功能
3
6新 版功能
3
6新 版功 能
3
6 新版 功能
3
6 新版 功 能
3
6版 后已移除 use  protocoltls  instead
 警告 ssl  version 2 is  insecure
3
6 版 后 已移 除 openssl  has  removed  support  for  sslv 2
警告 ssl  version 3 is  insecure
3
6 版后已移 除 openssl  has  deprecated  all  version  specific  protocols
 use  the  default  protocol  protocoltls  with  flags  like  opnosslv 3 instead
3
6版 后已 移 除 openssl  has  deprecated  all  version  specific  protocols
 use  the  default  protocol  protocoltls  with  flags  like  opnosslv 3 instead
3
4 新版 功 能
3
6 版 后已移除 openssl  has  deprecated  all  version  specific  protocols
 use  the  default  protocol  protocoltls  with  flags  like  opnosslv 3 instead
3
4 新版 功 能
3
6版 后 已 移除 openssl  has  deprecated  all  version  specific  protocols
 use  the  default  protocol  protocoltls  with  flags  like  opnosslv 3 instead
3
2新版 功能
3
2新 版 功 能
3
6版 后已移除 sslv 2 is  deprecatedssl
3
2 新 版功 能
3
6 版后 已移 除 sslv 3 is  deprecatedssl
3
2 新版 功能
3
7 版后 已移除 the  option  is  deprecated  since  openssl 1
0 use  the  new  sslcontext
3
4 新版功 能
3
7版 后已 移 除 the  option  is  deprecated  since  openssl 1
3
4新 版 功 能
3
7 版后已 移除 the  option  is  deprecated  since  openssl 1
3
7 新版功 能
3
7 版后已 移除 the  option  is  deprecated  since  openssl 1
 it  was  added  to 2
0 for  backwards  compatibility  with  openssl 1
3
7 新版 功能
3
3新版 功 能
3
3新版功 能
3
3新 版功 能
3
8新 版功 能
3
3新版 功 能
3
6 新版 功能
3
5新 版功能
3
7 新 版功能
3
3 新版功能
3
2 新 版功能
3
3 新 版功能
3
7新 版功 能
3
7新 版功 能
3
7新 版功 能
3
7新版功 能
3
7新 版功能
3
7新 版功能
3
3新 版 功能
2 k 26 jan 20173
2新 版 功能
opensslversioninfo 10211153
2新 版功能
opensslversionnumber 0 x 100020 bf 3
2新版 功 能
3
4新版功 能
3
6新版功 能
3
4新版功 能
3
4 新版功 能
3
6 新版 功能
3
7新版 功 能
ssl  sockets
socket  ssl  sockets  provide  the  following  methods  of 套 接字 对 象 accept  bind  close  connect  detach  fileno  getpeername  getsockname  getsockopt  setsockopt  gettimeout  settimeout  setblocking  listen  makefile  recv  recvinto  but  passing  a  nonzero  flags  argument  is  not  allowed  send  sendall  with  the  same  limitation  sendfile  but  os
在3
5 版更 改 the  sendfile  method  was  added
 在3
5 版更 改 the  shutdown  does  not  reset  the  socket  timeout  each  time  bytes  are  received  or  sent
 the  socket  timeout  is  now  to  maximum  total  duration  of  the  shutdown
3
6 版后 已移 除 it  is  deprecated  to  create  a  sslsocket  instance  directly  use  sslcontext
wrapsocket  to  wrap  a  socket
在3
7 版更改 sslsocket  instances  must  to  created  with  wrapsocket
 在3
5版 更 改 the  socket  timeout  is  no  more  reset  each  time  bytes  are  received  or  sent
 the  socket  timeout  is  now  to  maximum  total  duration  to  read  up  to  len  bytes
3
6版后 已 移除 use  recv  instead  of  read
在3
5 版更改 the  socket  timeout  is  no  more  reset  each  time  bytes  are  received  or  sent
 the  socket  timeout  is  now  to  maximum  total  duration  to  write  buf
3
6 版 后已 移 除 use  send  instead  of  write
 注解 the  read  and  write  methods  are  the  lowlevel  methods  that  read  and  write  unencrypted  applicationlevel  data  and  decryptencrypt  it  to  encrypted  wirelevel  data
在3
4 版更 改 the  handshake  method  also  performs  matchhostname  when  the  checkhostname  attribute  of  the  sockets  context  is  true
在3
5 版 更改 the  socket  timeout  is  no  more  reset  each  time  bytes  are  received  or  sent
 the  socket  timeout  is  now  to  maximum  total  duration  of  the  handshake
 在3
7版 更改 hostname  or  ip  address  is  matched  by  openssl  during  handshake
 the  function  matchhostname  is  no  longer  used
 in  case  openssl  refuses  a  hostname  or  ip  address  the  handshake  is  aborted  early  and  a  tls  alert  message  is  send  to  the  peer
org  version 3 注解 to  validate  a  certificate  for  a  particular  service  you  can  use  the  matchhostname  function
 在3
2版 更改 the  returned  dictionary  includes  additional  items  such  as  issuer  and  notbefore
在3
4版 更 改 valueerror  is  raised  when  the  handshake  isnt  done
 the  returned  dictionary  includes  additional  x 509 v 3 extension  items  such  as  crldistributionpoints  caissuers  and  ocsp  uris
在3
9 版更改 ipv 6 address  strings  no  longer  have  a  trailing  new  line
3
5 新版 功 能
3
3新 版 功 能
3
3新 版功能
3
5 新版 功能
3
3 新版 功 能
 注解 only  available  with  openssl 1
3
8 新版 功 能
3
5新版 功能
3
2 新版 功 能
3
2新 版功 能
3
2新 版 功能
在3
7版 更改 the  attribute  is  now  always  ascii  text
 when  serverhostname  is  an  internationalized  domain  name  idn  this  attribute  now  stores  the  alabel  form  xnpythnmua
3
6 新版 功能
sessionreused 3
6 新 版功 能
ssl  contexts
3
2 新 版功 能
 heres  a  table  showing  which  versions  in  a  client  down  the  side  can  connect  to  which  versions  in  a  server  along  the  top 客户 端 服务 器 sslv 2 sslv 3 tls 3 tlsv 1 tlsv 1
2 sslv 2是 否否1 否 否 否 sslv 3否 是否2否 否 否 tls  sslv 233 否1否2是 是是 是 tlsv 1 否否 是是 否否 tlsv 1
1 否 否是 否 是 否 tlsv 1
2否 否 是 否否 是脚 注1 sslcontext  disables  sslv 2 with  opnosslv 2 by  default
参 见 createdefaultcontext  lets  the  ssl  module  choose  security  settings  for  a  given  purpose
在3
6 版 更改 the  context  is  created  with  secure  default  values
 the  options  opnocompression  opcipherserverpreference  opsingledhuse  opsingleecdhuse  opnosslv 2 except  for  protocolsslv 2 and  opnosslv 3 except  for  protocolsslv 3 are  set  by  default
 the  initial  cipher  suite  list  contains  only  high  ciphers  no  null  ciphers  and  no  md 5 ciphers  except  for  protocolsslv 2
certstorestats  crl 0 x 509 ca 1 x 50923
4新 版功 能
 在3
3 版更改 new  optional  argument  password
3
4 新 版功 能
 在3
4版 更改 new  optional  argument  cadatasslcontext
 注解 certificates  in  a  capath  directory  arent  loaded  unless  they  have  been  used  at  least  once
3
4 新版功 能
示 例 ctx  ssl
3
6新版 功 能
 注 解 when  connected  the  sslsocket
3
5 新 版功 能
3
3 新版功 能
3
7 新版 功能
3
4新 版功 能
3
3 新 版功 能
3
3新版 功能
 参见 ssltls  perfect  forward  secrecy  vincent  bernat
在3
5版更 改 always  allow  a  serverhostname  to  be  passed  even  if  openssl  does  not  have  sni
在3
6版更 改 session  argument  was  added
在3
7版更改 the  method  returns  on  instance  of  sslcontext
3
7 新版功能
 在3
6 版 更 改 session  argument  was  added
在3
7 版更 改 the  method  returns  on  instance  of  sslcontext
3
7新版 功能
 示例 import  socket  ssl  context  ssl
com 4433
4 新版功 能
在3
7 版更 改 verifymode  is  now  automatically  changed  to  certrequired  when  hostname  checking  is  enabled  and  verifymode  is  certnone
注解 this  features  requires  openssl 0
3
8 新版 功 能
注 解 this  features  requires  openssl 1
注 解 this  attribute  is  not  available  unless  the  ssl  module  is  compiled  with  openssl 1
3
7 新版 功 能
注 解 this  attribute  is  not  available  unless  the  ssl  module  is  compiled  with  openssl 1
3
7新 版 功能
 注解 this  attribute  is  not  available  unless  the  ssl  module  is  compiled  with  openssl 1
3
8新 版 功 能
 注 解 with  versions  of  openssl  older  than 0
在3
6 版更改 sslcontext
options  returns  options  flags  ssl
 注解 only  available  with  openssl 1
3 support  the  property  value  is  none  and  cant  be  modified 3
8 新 版 功能
注 解 only  writeable  with  openssl 1
3
7新 版功能
3
4 新版功 能
 在3
6版 更 改 sslcontext
verifyflags  returns  verifyflags  flags  ssl
在3
6版更 改 sslcontext
verifymode  returns  verifymode  enum  ssl
certificates
certificate  chains
ca  certificates
combined  key  and  certificate
selfsigned  certificates
示 例
testing  for  ssl  support
clientside  operation
serverside  operation
notes  on  nonblocking  sockets
 在3
5 版更 改 in  earlier  python  versions  the  sslsocket
send  method  returned  zero  instead  of  raising  sslwantwriteerror  or  sslwantreaderror
select  sock 参见 the  asyncio  module  supports  nonblocking  ssl  sockets  and  provides  a  higher  level  api
memory  bio  support
3
5新 版功 能
 可 以使 用 以下 方 法 context  serverside  serverhostname  session  sessionreused  read  write  getpeercert  selectedalpnprotocol  selectednpnprotocol  cipher  sharedciphers  compression  pending  dohandshake  verifyclientposthandshake  unwrap  getchannelbinding  version  when  compared  to  sslsocket  this  object  lacks  the  following  features  any  form  of  network  io  recv  and  send  read  and  write  only  to  the  underlying  memorybio  buffers
 在3
7 版 更 改 sslobject  instances  must  to  created  with  wrapbio
ssl  session
3
6 新版 功能
security  considerations
best  defaults
manual  settings
在3
7版 更改 hostname  matchings  is  now  performed  by  openssl
 pythonno  longer  uses  matchhostname
multiprocessing
tls
3
7新 版 功 能
libressl  support
 参见 class  socket
socket  documentation  of  underlying  socket  class  ssltls  strong  encryption  an  introduction  apache  http  server  文 档介 绍 rfc 1422 privacy  enhancement  for  internet  electronic  mail  part  ii  certificatebased  key  management  steve  kent  rfc 4086 randomness  requirements  for  security  donald  e
stat 解 析 stat 结果
statistics  数 学统 计 函数
3
4 新版 功能
 源代 码 libstatistics
py 该模块 提供了用 于计算数 字 realvalued  数据 的数理 统计 量 的函数
此 模 块 并 不是诸如 numpy  scipy  等 第三方 库 或者诸如 minitab  sas  matlab  等针对 专业 统 计 学家 的 专有 全 功能统计软 件包的竟 品
此 模块 针对图形和 科学计算 器的水平
 除 非 明 确 注 释 这些函数 支 持 int  float  decimal  和 fraction
当 前 不 支持 同其 他类型是 否在 数字 塔中的行 为
 混 合 类型 的集 合也 是 未定 义 的并 且依 赖于 实 现
 如果 你 输入 的 数据由 混合 类型组 成 你应 该能 够 使用 map 来 确保 一个 一致的 结 果比如 mapfloat  inputdata 
 平 均 值 以及 对 中 心 位 置的 评估
 对分散 程度 的评 估
 函 数细 节
异 常
 只定 义了 一 个异 常 exception  statistics
statisticserror  valueerror 的子类 表示统 计相 关 的异常
normaldist 对 象
normaldist 工 具可用 于创 建 和操 纵随 机变量 的正态 分布
 这 个类 将数 据度量 值的平 均值 和标准差 作 为单一 实体来 处 理
 正态 分 布的概念 来自于 中 央极 限 定理 并且在 统计 学 中有 广泛 的应 用
0返 回 一个 新 的 normaldist  对 象其 中 mu  代表 算 术平 均值 而 sigma 代 表标 准差
若 sigma 为负 数将 会引 发 statisticserror
 mean  一 个只 读特征 属性 表 示特 定正态 分布 的 算术 平 均 值
 median 一个 只 读 特 征属 性表示特定 正态 分布 的中 位 数
 mode 一 个只 读特 征 属性 表示 特定 正态 分 布的 众数
 stdev  一个只 读特征属 性 表 示 特定 正态 分布的 标准 差
 variance 一个 只读 特征属 性表示 特 定正态 分布 的方 差
 等于 标 准差 的平方
 classmethod  fromsamplesdata  传 入使 用 fmean  和 stdev 基于 data 估算 出 的 mu 和 sigma 形 参 创建一个 正 态分布实 例
 data  可以 是任 何 iterable 并 且应 当 包含能 被转 换 为 float  类型 的值
如 果 data 不包含 至少 两个 元素则 会 引 发 statisticserror 因 为估 算中心 值至 少需要 一个 点 而估 算分 散度至 少需 要两 个点
 samplesn  seednone 对于给 定的 平均 值和标准 差 生 成 n 个 随 机 样 本
返 回 一个 由 float 值组 成 的 list
当 给 定 seed  时创 建一 个 新的底 层随 机数生 成器实 例
这适用 于 创 建可 重 现的 结果 即使对 于多 线 程上 下文 也有 效
 pdfx  使 用 概 率密 度函 数 pdf  计算 一个 随机 变量 x 趋向 于 给定 值 x 的相对 可 能性
 在数 学意义 上 它是 当 dx 趋 向于零 时比 率 px  x  xdx  dx 的 极限
 相对可 能性 的计 算方 法是 用 一 个狭窄 区间 内某个 样本 出现 的概率 除以 区 间 的 宽度因此使 用 密度一 词
由 于可 能 性是相 对于其他 点的 它的值 可 以 大 于1
 cdfx 使 用累 积分 布函数 cdf 计 算一 个随机 变量 x 小 于等 于 x 的概 率
 在 数学 上它 表示 为 px  x
 invcdfp  计算反 向累 积分布 函数 也称为分 位 数函数 或百 分点函数
 在 数学 上 它表示为 x  px  x  p
 找 出随 机 变 量 x 的 值 x  使得 该变量 小于 等于该值 的概 率等 于给 定的 概 率 p
 overlapother 测量 两个 正 态概率 分布 之 间的 一 致性
返回 介于0
0 和1
0之间 的 值 给出 两 个概率 密 度函 数的重 叠区域
 quantilesn 4将 指定 正态分 布划 分 为 n 个 相 等概 率 的连续 分隔 区
返 回这些 分隔区 对应的 n 1个 分隔 点的 列表
 将 n 设 为4以 使用 四 分位 默认 值
 将 n 设 为10以 使用十 分位
将 n  设为100 以使 用百分 位即给 出99个 分隔点 来将 正 态分布 分隔 为100个 大 小相 等的 组
 zscorex 计 算 标准 分 即以高 于或 低于 正态 分布 的平均 值的标准 差数 值的形式 来 描 述 x  x  mean  stdev
3
9新版 功能
 normaldist  的实 例 支持加 上、 减 去、 乘 以或 除 以一 个常量
这 些运 算 被用 于转 换 和 缩放
 例 如 temperaturefebruary  normaldist 52
5不 允 许一 个 常量 除 以 normaldist  的实 例 因 为 结果将 不 是正 态分 布
由 于 正 态分 布是由独 立变 量的 累加 效应 产 生 的 因 此允 许 表示为 normaldist  实 例的 两 组独 立正 态分 布 的 随机 变 量相 加 和 相减
 例如 birthweights  normaldist
53
8 新版 功能
normaldist  示例和用 法
normaldist 适 合 用 来 解决 经典 概率 问题
 举例 来说 如 果 sat 考 试的历史 数 据 显示 分 数呈 平 均值 为1060且 标准差 为195的正 态分 布则 可 以 确定 考试 分数 处于1100 和1200之 间的 学生的百分比舍 入 到 最接 近 的 整 数应为 sat  normaldist 1060195 fraction  sat
4 求 sat 分数 的四 分 位和 十 分 位 listmapround  sat
quantilesn 10810896958101110601109116212241310为 了 估算 一个 不易 解析 的 模 型分 布 normaldist 可以 生成用 于 蒙特 卡 洛 模 拟的 输入 样本 def  modelx  y  z 
175091447274739 当样 本量 较 大并且 成功试 验的 可能 性 接近50时 正 态 分布 可以 被用 来 模 拟二 项分布
 例如一 次开 源 会 议有750 名 与会者和 两 个 可 分别容 纳500人 的 会议 厅
会上 有 一场 关 于 python 的 演 讲和 一场 关 于 ruby 的 演 讲
在 往届 会议 中65 的与会 者更 愿意 去 听关于 python  的演 讲
假 定 人群 的 偏好没 有发 生 改变 那 么 python 演 讲的 会议 厅不 超出其 容 量上 限 的 可 能 性 是多 少？ n 750 sample  size  p 0
8398在 机器 学习问题中也经 常会 出 现 正态 分 布
wikipedia 上 有 一个 朴 素 贝 叶斯 分类器 的好例 子
挑 战的 问 题 是根 据对 多 个 正态 分 布 的 特征 测量 值 包括 身高、 体重 和 足部 尺码来预测 一个 人的 性 别
我 们得 到 了由 八 个 人的测 量 值组成的 训练 数据 集
假 定 这些 测 量值 是正态 分布 的因 此我们 用 normaldist 来 总结 数据 heightmale  normaldist
fromsamples 6879 接 下 来我 们 遇到 一 个特 征 测量 值 已 知 但性别 未知 的新 人 ht 6
0 height  wt 130 weight  fs 8 foot  size  从 是 男是女 各50 的 先验概率 出发 我 们 通 过将 该 先 验概 率乘 以给 定 性 别 的特征 度 量 值 的 可 能 性 累 积 值 来计 算后 验 概率 priormale 0
pdffs 最终 预测 值 应 为 最大 后 验概 率值
 这 种算 法被 称为 maximum  a  posteriori  或 map  male  if  posteriormale  posteriorfemale  else  female  female
 内置 类 型
 以下部 分描 述了 解释器 中内 置 的标准 类型
 主要 内置 类 型 有 数字、序 列、 映 射、类、 实例 和 异 常
有些多 项集 类 是 可 变的
它们 用于 添 加、 移 除 或 重 排 其 成 员 的 方 法 将 原 地 执 行并 不返 回特 定的 项 绝 对 不会 返回 多 项 集 实 例自身 而是返 回 none
有 些操 作受多种 对象类 型的 支 持 特别地实 际 上所 有对象 都可 以比 较是 否相等、 检 测逻 辑值以及 转换 为字 符串使 用 repr 函数或 略 有 差 异 的 str 函 数
后一个 函 数是在 对 象 由 print  函数 输出时 被隐式 地 调用 的
逻 辑 值 检测
 任 何 对象 都 可 以进 行逻辑 值 的检测以便 在 if 或 while 作 为 条件 或 是 作为下 文所 述 布尔 运算的操 作数 来 使用
 一个 对 象在默 认情况 下均 被 视 为真值 除 非当 该对象被 调用 时其所 属类 定 义 了 bool 方 法且 返 回 false 或是定 义了 len 方法且返 回零
1下面 基本完整 地列 出 了会被 视为 假值 的 内置 对象被 定义 为假 值的常 量 none 和 false
任何 数 值 类 型 的 零00
00 j  decimal 0 fraction 01空的序 列和多项集 set  range 0 产生 布尔 值 结 果 的 运算 和内置 函数 总 是返 回0或 false  作 为 假 值1或 true  作为真 值除 非 另行 说明
重 要 例 外布尔运算 or  和 and 总 是 返回 其中 一个 操作 数

布 尔 运算 and  or  not
 这些 属 于布尔 运算 按优 先 级 升序排 列运 算结果 注释 x  or  y  if  x  is  false  then  y  else 1 x  x  and  y  if  x  is  false  then  x  else 2 y  not  x  if  x  is  false  then  true 3 else  false  注 释1
这是个 短 路运 算符因 此 只 有在第一 个 参数 为假 值 时才 会对第二 个参数 求值
这 是 个短路运 算 符因 此只 有在 第一个 参 数为 真值 时才 会 对 第二个参数 求值
 not 的 优先级比 非 布尔 运 算符低 因 此 not  a  b 会 被 解读为 not  a  b 而 a  not  b  会 引发 语法 错 误
比 较
数 字类 型 int  float  complex
 存 在三 种 不 同的数 字类 型整 数浮点 数 和复 数
此 外 布 尔值 属 于 整 数 的子 类型
整 数具 有无 限 的精度
浮 点 数通 常使用 c 中 的 double 来 实现 有关 你的程序 运行所 在机器上 浮点数的 精度 和 内部 表示 法可 在 sys
floatinfo 中 查看
复 数 包含实部 和虚 部分 别以一个 浮点数 表示
 要 从一 个复 数 z  中 提取 这两 个部分可 使用 z
real 和 z
标 准 库 包 含附加的 数字类 型如 表 示 有理 数 的 fractions
fraction  以及 以 用户 定 制 精度 表示 浮点 数 的 decimal
decimal
 数字 是由 数字 字 面值或 内置函 数 与 运 算符 的结 果来 创建 的
不 带 修 饰 的 整数 字面 值 包括 十六 进制、 八 进 制和 二 进 制数 会生 成整 数
包 含小 数 点 或幂 运算 符的 数 字字 面值 会生成 浮 点 数
 在 数字 字面 值 末 尾 加 上 j 或 j  会 生成虚 数 实部 为零 的 复 数你 可 以 将其 与整 数或浮 点数相 加来得 到具 有 实部 和虚部 的复数
python 完 全 支持混合 运算当 一 个二 元算 术运算符 的操作数 有 不同 数值 类型 时较窄类 型 的操 作数会拓 宽到 另一 个操 作 数的 类 型其中整 数 比浮 点数 窄 浮点数 比 复数窄
不 同类型的数 字 之间 的比较 同比 较 这些数 字的精确 值一 样
2构 造函 数 int 、 float 和 complex 可以 用 来 构 造特定 类型 的数字
 所有数 字类 型 复数除 外都 支 持下列 运算 有关 运算优 先级 请参阅运 算符 优先 级运 算结 果注 释完整文档 x  y  x  和 y 的 和 x  y  x 和 y 的差 x  y  x  和 y 的乘 积 x  y  x  和 y  的 商 x  y  x 和 y  的商 数1 x  y  x  y 的 余数2 x  x  取反 x  x  不变 absx  x 的绝 对值或大 小 abs  intx  将 x 转换 为整 数36 int  floatx 将 x 转换 为 浮点数46 float  complexre  im  一个 带 有实 部 re  和虚 部 im  的6 complex 复 数
im 默 认 为0
 c
conjugate 复数 c  的 共轭 divmodx  y  x  y  x  y 2 divmod  powx  y  x 的 y  次 幂5 pow  x  y  x 的 y 次 幂5 注释1
也 称为 整数 除法
结果 值 是一个 整 数但结 果的类型 不一定是 int
 运算结果 总是向负 无穷的方 向舍入12为012 为112 为1而12为0
 不可用于 复数
而应 在 适当条 件下 使 用 abs 转换 为浮点数
从 浮点 数 转换为 整数会被舍 入或 是 像在 c  语言 中一 样被 截 断请参 阅 math
floor 和 math
ceil 函数 查看 转 换的 完 整 定义
 float 也 接受 字符 串 nan  和附 带可 选前 缀 或 的 inf 分别表 示非 数 字 nan  以及正或 负无 穷
 python  将 pow 00 和00定义为1 这是 编程 语言 的普遍 做法
 接受 的数字字 面值 包括 数码0 到9或任何等 效的 unicode  字 符 具有 nd  特 征 属 性的代 码点
 请参 阅 httpswww
0 ucdextractedderived  numerictype
txt  查 看具有 nd 特征 属 性的 代 码点的 完整 列表
所 有 numbers
real 类型 int  和 float 还 包括 下列运算 运算 结果 math
truncx  x 截 断为 integral  roundx  n  x  舍入 到 n 位 小数 半数值会 舍 入到 偶数
如果省 略 n 则默 认 为0
 math
floorx  x  的 最大 integral  math
ceilx  x 的 最 小 integral 有 关更多的 数 字 运 算 请参阅 math  和 cmath 模块
 整数 类型 的按位 运算
 按 位 运 算只对 整数 有意义
 计算 按位 运算 的 结 果就相 当于 使用 无穷 多个 二进 制符 号位对 二的补 码执 行 操 作
 二进 制按 位运 算的 优 先 级 全都 低于 数 字 运算 但又 高于 比较 运 算 一元 运算 具有 与其 他 一 元算 术运 算 and 相 同的 优 先 级
此 表格是 以优先 级 升序 排序 的按 位运 算 列表运 算结果注释 x  y  x 和 y  按位 或4 x  y  x 和 y  按位 异 或4 x  y  x  和 y  按 位 与4 x  n  x 左 移 n 位12 x  n  x 右 移 n 位13 x  x  逐 位取反 注释1
 负 的 移 位 数是非 法的 会 导致 引发 valueerror
 左移 n  位等 价于 乘以 pow 2 n 
 右移 n  位等 价 于 除以 pow 2 n 作 向 下取整除 法
 使用 带 有 至少一个 额外 符号扩 展 位的 有 限 个 二进 制 补 码 表 示 有效位宽 度为1 maxx
bitlength  或 以上 执 行这 些计 算就足以 获 得相当 于有 无 数 个 符号位 时的 同 样结果
整 数 类型 的 附 加方 法
int 类 型实现了 numbers
 此外它 还 提 供了 其 他几 个 方法 int
bitlength 返 回以二 进制表示一 个整 数 所 需要的位 数 不包 括 符号 位和前面 的零 n 37 binn 0 b 100101 n
bitlength 6更 准确 地说 如果 x 非零 则 x
bitlength 是使得2 k 1 absx 2 k 的 唯 一正 整数 k
 同样地 当 absx 小 到 足以 具 有正确的 舍入 对数 时则 k 1 intlogabsx 2
如果 x  为 零 则 x
bitlength 返 回0
 等 价 于 def  bitlengthself  s  binself  binary  representation  bin 370 b 100101 s  s
lstrip 0 b  remove  leading  zeros  and  minus  sign  return  lens  len 10010163
1新 版功 能
tobyteslength  byteorder  signedfalse  返回 表示 一 个整 数的 字节 数 组
bitlength 78 byteorderlittle  bxe 8 x 03整 数会 使用 length  个 字节来表 示
如果 整数 不能用 给 定 的字节数 来表 示则 会引 发 overflowerror
 byteorder 参数 确定用 于 表示整数 的 字节 顺序
 如 果 byteorder 为 big  则 最高位字 节 放在 字 节 数组 的开头
 如果 byteorder  为 little 则最高 位字 节 放 在 字节 数 组的末 尾
要 请求主 机系 统 上 的 原生 字节顺序 请使 用 sys
byteorder 作为 字节 顺序 值
 signed  参 数确 定是 否使 用 二的 补码来 表示 整 数
如 果 signed 为 false 并 且 给出的 是负整 数 则会 引 发 overflowerror
 signed 的默 认 值为 false
3
2 新版 功能
frombytesbytes  byteorder  signedfalse  返回由 给 定 字节 数组所 表示的整 数
frombytes 25500 byteorderbig 16711680 bytes  参 数必须 为一 个 byteslike  object  或 是生 成字 节 的可 迭 代对象
 byteorder 参数 确定用 于 表 示 整数的 字节顺序
 如果 byteorder  为 big 则最 高 位字 节 放在 字 节数组 的开 头
如果 byteorder  为 little 则 最高位 字节放在 字 节 数组的 末尾
 要请求 主 机 系统 上的 原生 字 节 顺序请 使用 sys
byteorder  作 为字 节 顺 序值
 signed 参 数指 明 是否使 用二的 补 码 来表示 整数
3
2 新版 功 能
asintegerratio  返回 一 对整数其 比 率正好 等 于 原 整数 并且分 母 为 正数
 整数的 比率 总是 用这 个整 数 本身 作 为分 子1 作为分 母
3
8 新版功 能
 浮 点类型 的附加 方 法
float  类 型实现 了 numbers
 float  还具有 以下附 加 方 法
asintegerratio 返 回一 对 整 数其比 率正 好 等于 原 浮 点数并且 分母 为 正 数
无穷大会 引发 overflowerror 而 nan  则 会 引 发 valueerror
isinteger 如果 float 实 例可 用 有限位 整数表 示则返回 true  否 则 返 回 false 2
isinteger  false 两个 方法均支持与十六 进制数 字符 串之间 的转 换
 由 于 python  浮 点数在内 部存 储 为二进制 数 因此浮 点 数 与十进 制数字 符串 之间的 转 换往 往 会导 致微小 的舍 入错误
 而十 六进 制 数字 符串却允 许 精 确地 表示和 描述浮点 数
 这 在 进行 调 试和数值 工作 时 非 常 有 用
hex  以 十六 进制 字符 串的 形式 返回 一个 浮 点 数表示
对于 有 限浮 点 数这 种表 示法 将 总 是包含 前 导的0 x 和尾 随的 p  加指 数
fromhexs 返 回以十 六进制 字符 串 s 表示 的浮点数的 类 方 法
字 符 串 s 可 以带 有 前导 和尾 随 的 空格
 请注 意 float
hex 是 实例 方 法而 float
fromhex 是 类方 法
十 六进 制字符 串 采用 的形 式 为 sign 0 x  integer 
 fraction  p  exponent  可选的 sign 可 以是 或 integer  和 fraction  是十六进 制 数 码组成 的 字符串 exponent  是带 有 可 选 前导 符的十 进制整 数
 大 小 写没有影 响 在 integer 或 fraction  中必 须 至 少 有一 个 十 六进 制 数码
 此 语 法类似 于 c 99标 准的6
2小 节中所 描 述 的 语 法也是 java 1
5 以上所使用的 语法
 特别 地 float
hex  的 输 出可 以用作 c  或 java 代码中 的 十 六进制 浮点 数 字面 值 而由 c  的 a 格 式字符 或 java 的 double
tohexstring 所 生成 的十 六 进制 数 字 符串 由为 float
fromhex  所 接受
 请注意 exponent 是十 进制 数 而非 十 六 进 制 数它 给出要 与 系 数相 乘的2 的幂 次
例如 十 六 进制 数 字 符 串0 x 3
a 7 p 10 表示浮 点 数310
167
010 即3740
0 对3740
0应 用反向 转 换会 得 到另一 个 代 表相同数值 的 十六 进制 数字 符 串 float
 数字类 型的 哈希 运算
对 于 可 能为 不同 类型的 数 字 x 和 y 要 求 x  y 时 必 定 hashx  hashy  详 情 参 见 hash  方 法 的 文档
为 了便 于在 各种 数 字类型 包括 int  float  decimal
decimal 和 fractions
fraction  上实现并 保 证 效率 python 对 数字类型 的哈 希运 算是基于 为 任意 有理 数定 义统 一的数 学函数 因 此该 运 算对 int  和 fractions
fraction 的 全部 实 例 以 及 float 和 decimal
decimal  的 全部有限 实例 均可 用
 从本 质上 说此 函 数 是通 过以 一个 固定 质 数 p 进行 p 降 模给 出的
 p 的值 在 python  中 可以 sys
hashinfo 的 modulus 属性 的形式被访 问
cpython  implementation  detail 目 前所用的 质 数设定 在 c  long  为32 位 的 机器 上 p 2311而 在 c  long  为64 位 的机器 上 p 2611
详细规则 如 下所 述如果 x  m  n  是一个 非 负的 有 理 数且 n  不 可被 p  整 除 则定义 hashx  为 m  invmodn  p  p 其中 invmodn  p  是对 n  模 p 取反
如 果 x  m  n 是 一个 非 负的有理 数 且 n 可 被 p 整 除 但 m 不 能则 n 不 能对 p  降模以 上 规 则不适 用 在 此情况 下则 定义 hashx  为 常数 值 sys
 如 果 x  m  n  是一个 负 的有 理数则 定义 hashx 为 hashx
如果 结果哈希 值为1 则将其替 换为2
 特定值 sys
inf  和 sys
nan 被 用 作 正无穷、 负 无穷 和 空值 所分别 对应 的 哈希 值
 所有 可 哈希 的空 值都具有相 同 的 哈希值
 对于一 个 complex 值 z  会通过 计算 hashz
imag  将实 部 和 虚 部的 哈 希值 结合 起来 并进行降模2 sys
width  以 使其 处 于 range 2 sys
width 1范 围之 内
同 样地 如果 结果 为1则 将 其 替换为2
 为 了 阐 明上 述规则 这里 有一 些等 价于 内置 哈 希算 法的 python  代 码示例 可用 于计 算有 理数、 float  或 complex  的哈 希值 import  sys  math  def  hashfractionm  n  compute  the  hash  of  a  rational  number  m  n
迭 代 器 类型
python 支 持 在 容 器中进 行迭 代的 概 念
 这 是 通 过 使用两 个 单独方 法 来实现 的它 们被用 于 允 许 用 户 自 定 义类对 迭 代 的 支 持
将 在下 文 中 详 细描述 的 序 列 总 是 支持 迭代方 法
 容 器对 象 要提 供 迭代 支持 必 须定 义 一 个 方 法 container
iter 返 回一 个迭 代 器对 象
 该 对 象 需要支 持下文 所述 的迭 代 器 协议
如 果 容器 支 持 不同 的迭代 类型 则可以 提 供 额外的 方法 来专门 地请 求 不同 迭代 类型的 迭代 器
支 持多种迭 代形 式 的 对象的 例子有 同 时 支持 广 度 优先和 深 度 优 先 遍历的 树结构
 此 方法对 应于 pythonc  api  中 python 对 象类 型结构 体的 tpiter  槽位
迭 代器对 象自身需 要 支 持以下 两 个方法它 们 共同 组成 了 迭 代器 协 议 iterator
iter 返 回 迭 代器对 象本身
 这是 同时 允许容器 和 迭 代 器配 合 for 和 in  语句使 用 所必 须 的
 此方 法对 应于 pythonc  api  中 python 对 象 类型 结 构体 的 tpiter  槽 位
next  从容器 中返回 下一项
如 果已 经没 有项 可返 回则会引 发 stopiteration 异 常
此方法 对 应 于 pythonc  api 中 python  对 象 类型结 构体 的 tpiternext 槽 位
python  定 义 了 几 种迭 代 器对象 以 支持对 一般 和 特 定 序 列类 型、 字典 和 其 他更特 别 的形式 进行 迭代
 除了 迭代 器 协 议的实 现特 定类型 的 其他性质 对迭 代操 作 来 说都不 重要
 一旦 迭代 器的 next  方法引 发了 stopiteration  它必须 一 直 对 后 续 调用引 发同 样的异 常
不 遵循 此 行 为特性 的实 现将无 法正 常使 用
生成 器类 型
python  的 generator  提 供了 一 种实现 迭代 器协议 的便 捷 方 式
如果 容器对 象 iter  方法 被实现 为 一 个 生 成 器它将 自动 返 回 一个迭 代器 对 象 从 技 术上 说 是一 个 生成 器 对象 该 对象 提供 iter 和 next 方 法
 有 关 生 成器 的 更 多 信 息 可 以 参 阅 yield  表达 式的 文 档
 序列类 型 list  tuple  range
 有三 种 基本 序 列类型 list  tuple  和 range  对 象
 为 处理二 进制数据 和文 本字符 串而特 别 定 制的附 加序 列类型 会在 专门 的 小节 中描述
 通用 序列 操作
 大多 数序 列 类 型包括 可变 类型和 不 可 变 类型都 支持下 表中 的 操 作
collections
sequence  abc 被 提 供用来 更容 易 地在 自 定 义 序列 类型 上正确 地 实 现这些 操作
 此 表 按 优先 级升 序 列 出了 序列 操 作
 在 表格中 s  和 t 是具有 相同类 型的 序 列 n  i  j 和 k  是整 数 而 x 是 任何满 足 s 所 规 定的 类 型和 值限制 的 任 意对象
in 和 not  in  操作具 有与 比较操 作 相 同的优 先 级
拼 接和 重 复操 作 具有 与对 应数 值运算相同的 优先 级
3运 算结果注 释 x  in  s  如 果 s 中的 某项等 于 x 则 结果1 为 true 否 则为 false  x  not  in  s 如 果 s  中 的 某 项 等 于 x  则结果1 为 false 否则 为 true  s  t  s 与 t  相 拼 接67 s  n 或 n  s  相当于 s 与 自身进 行 n  次 拼 接27 si  s 的第 i  项起始 为03 sij  s 从 i  到 j 的切片34 sijk  s 从 i  到 j 步长 为 k 的35 切片 lens  s 的 长 度 mins  s  的最小 项 maxs  s  的最大 项 s
indexx  i  j  x 在 s  中首 次出现 项的 索引 号8 索 引号在 i  或 其 后 且 在 j 之前 s
countx  x  在 s 中出 现 的总次 数相 同类 型的 序列也 支持 比较
特 别地 tuple 和 list  的比较是 通 过 比较对 应元素 的 字典 顺 序
 这意味 着 想 要比 较 结果相 等 则 每 个元素比较结 果都 必须 相 等 并且 两 个 序 列 长 度 必 须 相同
完 整 细 节 请参 阅语言 参 考 的 比 较运算 部分
注 释1
虽 然 in  和 not  in 操 作在 通常情 况下 仅 被 用 于简单 的 成 员检测某 些 专 门 化序列 例 如 str  bytes  和 bytearray  也 使用它 们进行 子 序列检 测 gg  in  eggs  true 2
小 于0的 n  值会 被当作0 来处 理生成 一个与 s  同类型的 空 序 列
请注 意 序 列 s  中的 项并 不 会 被拷贝 它们会被多 次 引用
 这 一 点经 常会 令 python  编程 新手 感 到 困扰 例如 lists 3 lists  lists 0
append 3 lists 333 具体 的原因 在于 是 一个 包 含 了一个 空列表的单 元素 列表 所以3 结果中 的 三 个元素 都 是 对这 一 个空列 表 的 引 用
修 改 lists 中的任何 一个 元 素实 际上 都是 对 这 一 个 空列表 的修改
 你 可以用 以下 方式 创建 以不同 列表 为元素 的列表 lists  for  i  in  range 3 lists 0
append 7 lists 357 进一步的 解 释 可以在 faq  条 目 如何创 建多 维列表？ 中查 看
 如 果 i 或 j 为 负值 则索引 顺 序是相 对于序 列 s 的 末尾 索 引 号 会被替 换 为 lens  i  或 lens  j
但 要 注 意0仍 然为0
 s 从 i 到 j  的切 片被 定 义 为 所有 满 足 i  k  j  的索 引号 k  的 项组 成 的 序 列
如果 i  或 j 大于 lens 则使 用 lens
如 果 i 被 省略 或 为 none 则 使 用0
如 果 j  被省略 或为 none  则使用 lens
 如 果 i 大 于等 于 j 则切 片为空
 s 从 i  到 j  步长 为 k  的切片被 定义为 所有 满 足0 n  jik  的 索 引号 x  i  nk  的 项组成 的 序 列
 换 句话说 索引 号为 i  ik  i 2 k  i 3 k 以此 类 推 当达到 j 时 停 止 但 一 定不 包 括 j
 当 k  为正 值时 i  和 j  会 被减 至 不 大 于 lens 
当 k 为 负值时 i  和 j 会被 减至 不大于 lens 1
如 果 i  或 j  被省 略 或为 none 它 们会 成 为终 止值 是哪一 端 的 终 止 值 则取决 于 k 的符 号
请 注意 k  不 可为 零
如果 k  为 none 则当 作1处理
 拼 接不 可变 序列 总 是 会 生 成新 的对象
 这 意味着通 过重 复拼接 来 构 建序 列的运 行 时开 销 将 会 基于序列 总长 度的 乘 方
 想要获 得线 性的 运 行 时 开销 你 必须 改用下 列替代 方案之 一如果拼接 str 对 象你 可以 构 建 一个 列 表并 在 最 后使 用 str
join 或 是 写 入 一个 io
stringio  实例并 在 结束 时获取它 的值 如果 拼接 bytes  对 象你 可 以 类 似 地 使用 bytes
join 或 io
bytesio  或 者 你也可 以 使用 bytearray  对 象进 行原 地 拼接
 bytearray 对象 是可变 的 并且 具有高 效 的重 分 配机制 如 果 拼 接 tuple  对 象 请改为 扩展 list  类对 于其 它 类 型请 查看 相 应的 文档7
 某 些 序列类 型例如 range 仅 支持 遵 循 特定模 式 的 项序 列因 此并 不 支 持序列 拼 接 或重复
 当 x  在 s  中 找 不到 时 index 会引发 valueerror
 不是 所有 实现 都支持 传入额 外 参 数 i  和 j
这两 个 参 数 允许 高 效 地 搜索 序列的子 序 列
 传入这 两个 额 外参数 大致相 当 于使用 sij
indexx 但 是不会复 制任 何 数 据并 且返 回 的 索引 是 相对 于序 列的 开头而 非切 片的开 头
不 可 变序 列 类 型
不 可变序 列类 型 普遍 实现 而可 变 序列类 型 未 实现 的唯 一操 作就 是对 hash 内置函数 的支持
 这种 支持 允 许 不可 变类 型 例如 tuple  实 例被 用 作 dict 键 以及 存 储在 set  和 frozenset  实 例 中
尝 试 对 包含 有不 可 哈希 值 的 不 可变序 列 进 行哈 希 运 算将 会导 致 typeerror
 可 变 序 列 类 型
 列表
列 表是 可变序列 通 常 用于存放 同 类 项目 的集 合其 中 精 确 的 相 似程度 将 根据 应用 而 变化
class  listiterable  可以 用多 种方式构 建列 表 使用一 对 方括 号 来 表示空 列表 使 用 方括 号其中 的 项 以逗 号分 隔 a  a  b  c 使用 列 表推导 式 x  for  x  in  iterable 使 用 类 型的构 造 器 list  或 listiterable 构造 器 将 构造一 个列 表其中 的 项 与 iterable  中的 项 具 有 相同 的 的值与顺 序
 iterable  可 以 是 序 列、 支 持 迭 代 的容 器 或其它 可迭 代 对 象
如果 iterable  已 经是一 个列 表将 创 建并 返 回 其副 本 类 似于 iterable 
 例 如 listabc  返回 a  b  c 而 list 123 返回123
 如 果没有给 出参 数 构造器 将创建 一 个 空 列 表
 其 它许多 操作也 会 产 生 列 表包 括 sorted 内 置函 数
 列表 实 现 了所有 一 般 和 可变 序列 的操 作
列 表还 额外提供 了 以下 方法 sort  keynone  reversefalse  此方 法 会 对 列表进 行原 地排 序只 使用 来进 行 各 项 间 比较
异 常不 会 被屏 蔽—— 如 果有 任何 比 较操作 失败 整个 排序操 作将 失败而 列表 可能 会 处于 被部 分修改的 状态
 sort  接受 两 个仅限以 关键 字形式 传入的 参 数仅 限关键字参 数 key 指定带 有 一个 参数 的 函数 用 于 从 每个列表 元 素 中提 取比较键例 如 keystr
 对 应 于 列表中 每一 项的 键 会 被计算 一次 然后 在 整个 排 序 过程中 使用
 默 认 值 none  表 示直 接对列 表项 排 序而 不计 算 一 个单 独的 键 值
 可 以使 用 functools
cmptokey  将2
x 风格 的 cmp 函 数 转换 为 key 函数
 reverse 为一 个布 尔值
如 果 设为 true  则每 个列表 元 素将 按反向 顺 序 比 较 进行 排 序
当顺 序大 尺寸序 列时 此方 法 会原 地 修改 该 序 列以 保证空间 经济性
 为 提醒 用户 此 操作是 通 过 间接 影响 进 行的 它并不会 返 回排 序后的序 列请使 用 sorted 显 示地 请求 一个新的 已排序 列表实 例
 sort 方法 确保是 稳定的
如 果一 个 排序 确保不会 改变 比较 结 果相 等 的元 素 的 相 对顺 序 就 称 其 为稳定 的这有 利于 进行 多 重排 序例 如先 按 部 门、 再接 薪 级 排 序
有 关 排 序 示例 和 简 要排 序教程 请 参阅 排 序 指南
 cpython  implementation  detail 在 一个 列表被 排 序期 间尝试 改变 甚至 进行 检 测也 会 造成 未定义 的 影 响
 python 的 c  实 现会在 排序 期间将列 表 显 示 为空如 果发 现列 表 在排序期 间 被 改变将 会 引 发 valueerror
元 组
元组 是不 可 变 序列通 常 用 于 储 存异构 数 据 的多项 集例 如由 enumerate  内 置函数 所产 生 的 二元 组
元组也 被 用 于 需 要同构 数据 的 不可变 序列的 情 况例 如 允 许存 储到 set 或 dict 的 实 例
class  tupleiterable 可以 用多 种 方 式 构 建 元 组使用 一 对 圆括 号来 表示 空元组使 用 一个 后 缀的 逗 号 来表 示单 元组 a  或 a 使用以 逗号 分隔的多 个 项 a  b  c  or  a  b  c  使用 内 置 的 tuple  tuple 或 tupleiterable 构 造器将构 造一 个元 组其 中 的 项与 iterable 中 的 项 具有相 同 的值 与顺序
 iterable  可以 是 序 列、支 持迭 代的 容 器 或其他 可迭 代 对象
 如果 iterable  已经是 一 个 元组 会不 加改变地将 其 返回
 例如 tupleabc  返回 a  b  c  而 tuple 123 返 回123
如 果 没 有 给 出 参数 构造器 将创 建一 个 空 元 组
 请 注 意决 定生成元 组的 其 实 是 逗 号 而不 是圆 括 号
圆括 号 只是 可 选 的 生 成 空元组 或 需 要避 免 语 法 歧 义的 情 况除外
例 如 fa  b  c  是在 调用函 数 时附 带三 个参数 而 fa  b  c 则 是在 调 用 函数 时附 带 一个 三 元 组
 元组 实 现了 所有 一 般 序列 的操 作
对 于通 过名 称访 问相 比通 过 索引 访问 更清 晰 的 异构 数据 多项 集 collections
namedtuple  可能是 比 简单元组 对象更 为 合 适的 选择
range 对 象
 文 本序 列 类 型 str
字 符 串 的方 法
printf  风格的字 符 串 格式 化
二 进制 序 列 类 型 bytes  bytearray  memoryview
操 作二 进制 数据 的 核心 内置类 型 是 bytes  和 bytearray
 它 们由 memoryview 提 供支持 该对 象使 用 缓冲 区协议 来访 问其 他 二进制对 象所 在 内 存 不需要 创 建对象 的副 本
array  模 块 支持高 效地存 储 基本 数据类型 例如32位 整数和 ieee 754 双精 度浮点值
bytes  对象
bytes  对象 是由单 个 字 节 构 成的 不可 变序 列
由 于许多 主要二 进 制 协议都 基 于 ascii  文 本编 码因 此 bytes 对象 提供了 一 些仅 在 处 理 ascii 兼容数 据时 可用并且在 许 多 特性上与 字符 串对象紧 密 相 关 的方 法
class  bytessource  encoding  errors 首先 表 示 bytes  字面值 的语 法 与字符 串字面值的 大 致相 同 只是 添 加 了一个 b 前 缀单 引号 b 同样允许 嵌 入双 引 号
双 引 号 b 同 样 允 许 嵌 入单 引号
 三重 引 号 b 三 重 单 引号 b  三 重双引 号 bytes  字面 值 中 只 允许 ascii  字 符 无 论源 代码 声 明的 编码 为 何
任 何超出127的 二 进 制 值必须 使用相 应的 转 义 序 列 形式 加入 bytes  字 面值
 像 字 符 串字面 值 一 样 bytes 字 面值 也 可以 使用 r 前 缀来 禁用 转义 序列 处 理
 请 参 阅字 符串 和字节 串字 面值了 解 有关 各 种 bytes  字面值 形式的 详情包 括所 支持的转 义序 列
 虽 然 bytes  字面值 和 表 示 法 是基 于 ascii 文本 的 但 bytes  对象 的行 为实 际上更像 是 不可 变 的 整 数序 列序列 中 的 每个 值的大 小被 限 制 为0 x 256 如 果 违 反此 限制将引 发 valueerror
 这 种 限 制 是 有意 设计 用 以强 调 以下 事 实虽 然 许 多二进 制格式 都包含基 于 ascii 的元 素可 以通过 某些 面 向文 本的算 法进 行有用 的 操 作 但情 况对 于任意二 进 制数 据来 说通 常却 并 非 如此盲目 地 将文本 处理算 法应 用于 不兼 容 ascii 的二进制 数 据 格式 往往 将 导 致数 据 损 坏
 除了字 面值 形式 bytes 对 象还可 以 通 过 其 他 几种方 式 来创 建指 定长度 的 以 零值填 充的 bytes  对象 bytes 10 通 过由整 数 组 成 的可 迭代 对象 bytesrange 20通 过缓 冲区 协议 复 制 现有的 二 进制 数据 bytesobj 另 请参 阅 bytes  内 置 类 型
 由 于两 个十六 进 制数码 精 确对应 一 个 字节 因 此十 六 进 制数是 描述二进 制 数 据 的常 用格 式
相应地 bytes  类型 具 有从 此 种 格式读 取 数 据的 附 加 类方 法 classmethod  fromhexstring  此 bytes 类 方法返 回一个 解 码 给定字 符串 的 bytes  对 象
 字符串 必须由 表示 每 个 字 节的 两个 十 六 进制数 码构 成 其 中的 ascii  空白 符会 被忽 略
 bytes
fromhex 2 ef 0 f 1 f 2 b
xf 0 xf 1 xf 2在3
7 版更 改 bytes
fromhex  现 在 会忽 略所 有 ascii  空白符 而 不 只 是空格 符
存 在 一 个反 向转换 函 数可 以将 bytes 对 象转 换 为 对应的 十六进制 表示
 hexsep  bytespersep  返 回 一个 字 符串对象 该对象 包 含实 例 中 每个字节 的两 个 十 六进 制 数字
 bxf 0 xf 1 xf 2
hex  f 0 f 1 f 2如 果 你 希 望令 十 六进制 数字 符串更 易读你可 以指 定 单 个字符 分隔 符 作为 sep  形参包 含 于输 出 中
默 认会 放在每 个字节之 间
第 二 个 可选的 bytespersep 形 参控 制 间 距
 正值会从 右开 始 计 算分隔符 的位 置 负 值 则是从左 开始
 value  bxf 0 xf 1 xf 2 value
hex  f 0 f 1 f 2 value
hex 2 f 0 f 1 f 2 buuddlrlrab
hex 4555544444 c 524 c 5241423
5 新 版 功能
 在3
8 版更改 bytes
hex  现 在支 持可 选 的 sep 和 bytespersep  形参以在 十 六进制输 出 的 字 节之间插 入分 隔符
 由于 bytes 对 象是 由 整 数 构成 的序 列 类 似 于元 组 因 此对于 一 个 bytes  对 象 bb 0将为一 个 整 数 而 b 01将为一 个 长 度为1的 bytes  对 象
这 与文本 字符 串 不 同 索 引和切 片所 产生 的 将 都 是 一个长 度为1 的 字符串
bytes  对象的表示 使 用字面值 格式 b
 因为 它 通常 都 要 比像 bytes 464646这 样 的格 式 更好 用
你 总 是可 以 使用 listb  将 bytes  对 象转换为 一 个由 整数 构成 的列 表
注 解 针 对 python 2
x  用户的 说明在 python 2
x  系列 中 允许8位 字 符 串2
x  所 提供的最接 近内 置 二 进制 数 据 类型 的对 象 与 unicode 字符 串进 行 各 种隐式 转 换
这是 为了实现 向 下兼容 的变 通 做法 以适 应 python  最 初只 支 持8 位 文 本而 unicode 文 本 是后 来才 被加 入 这一 事实
 在 python 3
x 中这些 隐式 转换 已被 取 消——8 位二进制 数据 与 unicode 文 本 间 的 转 换必 须显式 地进 行 bytes  与 字符串 对象的 比 较结 果 将总是 不 相 等
bytearray 对 象
bytes  和 bytearray  操作
printf  风 格 的字 节 串 格式化
 内存 视 图
 集合 类 型 set  frozenset
set  对象 是 由具 有 唯一性 的 hashable 对象 所 组成 的无 序 多 项 集
常见 的用途包括成 员检 测、 从序 列 中去 除重 复项以及数 学中的 集 合类 计算 例如 交集、 并集、 差集 与对 称差 集 等等
 关于 其他 容器 对象 请参 看 dict  list 与 tuple  等内 置类 以及 collections  模 块
与其 他多 项集 一样 集合 也支持 x  in  set  lenset  和 for  x  in  set
 作 为一 种无序 的 多 项 集 集合 并不记录元素 位置 或插 入顺 序
相应 地集 合 不 支持 索 引、 切片 或 其他 序 列类的操 作
目 前 有两 种 内置集合 类型 set  和 frozenset
 set  类型 是 可 变的 其 内 容可 以使 用 add 和 remove  这 样 的方 法来 改 变
由于是可 变类型它 没有 哈 希值 且不能被 用 作字典的键 或 其他 集合 的 元 素
 frozenset 类 型 是不 可变 并且 为 hashable 其 内容 在被 创建 后 不能再改变 因此 它 可以被用作 字 典的键 或其 他 集合的 元素
 除 了可以 使用 set  构 造器非 空 的 set 不是 frozenset 还可 以通过将 以逗 号分 隔的 元 素列表包含 于花 括 号 之内 来 创建 例如 jack  sjoerd
 两个 类的构造器具有相 同的 作用 方式 class  setiterableclass  frozensetiterable  返回 一 个新 的 set  或 frozenset 对 象其元素 来自 于 iterable
集 合 的元素 必须 为 hashable
 要表 示 由集 合 对象 构成 的集 合所 有的 内层集合必须 为 frozenset  对象
如果未 指定 iterable  则将返 回一个 新的空 集合
 集合 可用 多种方 式 来 创建 使用花 括 号 内以 逗号 分 隔 元 素的 方式 jack  sjoerd 使用集合 推 导 式 c  for  c  in  abracadabra  if  c  not  in  abc 使 用类 型构 造器 set  setfoobar  seta  b  foo  set  和 frozenset 的 实 例 提 供以下 操作 lens  返回 集 合 s 中 的元 素数 量 即 s  的基 数
 x  in  s 检 测 x 是否 为 s  中 的 成员
 x  not  in  s  检测 x 是否 非 s 中 的成员
 isdisjointother 如 果集 合 中没有 与 other 共 有的 元素则 返回 true
当且 仅 当 两 个集 合的 交集 为空 集 合 时两 者 为 不相 交集 合
 issubsetother  set  other  检测 是否 集合 中 的每 个元 素 都在 other 之 中
 set  other 检 测集合 是否 为 other 的 真 子集 即 set  other  and  set  other
 issupersetother  set  other 检 测是 否 other  中的每个元 素 都 在集 合之 中
 set  other  检测 集 合 是否为 other  的真 超集 即 set  other  and  set  other
 返回 一个 新 集 合 其 中包 含 来 自 原集合 以及 others 指 定的 所有 集合中 的元 素
返 回一 个 新 集合 其中 包含 原 集 合以及 others  指定 的 所 有集 合中 共 有的 元 素
 返回一 个 新集合 其中 包含原集合 中在 others  指定 的其 他 集合 中 不 存在 的元 素
 symmetricdifferenceother  set  other 返 回 一个 新 集 合 其 中的元素 或属 于原 集合 或属于 other 指 定 的 其他 集 合但 不能同时 属 于 两 者
 copy 返 回原 集 合 的 浅拷 贝
 请注意非运 算 符 版本 的 union  intersection  difference 以及 symmetricdifference  issubset  和 issuperset 方 法 会 接 受任意 可迭 代对 象 作 为 参 数
相比 之下它 们所 对应 的 运 算符 版 本 则要 求其 参数为 集合
这 就 排除 了容 易 出 错的 构造 形式例 如 setabc  cbs 而 推 荐可读 性 更强 的 setabc
 set 和 frozenset  均 支持集合与 集合 的 比较
两个集 合当 且 仅 当每个 集合 中的每个元素均包 含 于另一个 集合 之 内 即 各 为对 方的 子集 时则相等
一 个 集 合当 且 仅 当其 为 另 一个集 合的 真 子 集即为 后 者 的子集 但 两 者不相 等 时 则小于 另 一 个集合
 一 个 集 合当且 仅 当 其 为另一 个 集 合的真 超 集 即为后 者 的 超集但 两 者 不 相等时 则 大 于 另一个 集 合
 set  的实例 与 frozenset  的 实例之 间 基 于它们 的 成 员进行 比 较
 例如 setabc  frozensetabc 返 回 truesetabc  in  setfrozensetabc 也 一样
子集 与 相等 比较并不 能推广 为完全 排序函 数
例 如任 意 两 个 非空 且不 相交 的集 合 不 相等且 互不 为 对方的 子集因此 以下 所有比 较均返回 false  ab  ab  or  ab
由 于集合仅 定义 了部 分 排序 子集 关 系因 此 由集 合构成 的列 表 list
sort 方法 的输 出并 无 定义
 集合 的元素与 字典 的键 类 似必须为 hashable
 混合 了 set 实 例与 frozenset 的 二 进 制位 运 算 将返回 与第 一 个操 作 数相 同 的 类型
 例如 frozensetab  setbc  将 返 回 frozenset  的实例
 下 表 列出 了 可 用 于 set 而 不 能 用于不 可变的 frozenset 实 例 的 操作 updateothers  set  other 
更 新 集合添 加来自 others 中的所 有 元 素
更 新集 合 只保 留 其中 在所 有 others  中 也 存 在的 元素
更 新集 合 移除 其中 也存 在于 others  中的 元 素
 symmetricdifferenceupdateother  set  other  更 新集合 只保 留存 在于 集合 的一 方而 非共同 存在的 元素
 addelem  将 元素 elem 添 加到 集 合中
 removeelem 从 集 合 中 移除 元素 elem
如果 elem 不 存在于 集 合中则 会引 发 keyerror
 discardelem  如 果元 素 elem  存在 于 集 合中则 将其移 除
 pop  从集 合 中移除并 返回 任 意一个元 素
 如果 集合 为空 则 会引 发 keyerror 
 clear 从 集 合中移 除 所 有元 素
请 注 意 非运 算符 版 本 的 update  intersectionupdate  differenceupdate  和 symmetricdifferenceupdate  方法将接 受任意可 迭 代 对 象作 为参 数
请注意 contains  remove 和 discard  方法 的 elem  参 数可 能是一 个 set
为支 持 对一 个等 价的 frozenset 进行 搜索 会 根 据 elem  临时 创建 一 个该 类型 对象
映 射类 型 dict
mapping 对 象会 将 hashable 值 映 射到 任意 对象
 映射 属于可变 对象
 目前仅 有一 种标准 映 射类 型 字 典
关于其 他容器 对象 请参看 list  set  与 tuple  等 内置 类以 及 collections 模 块
 字 典的 键几乎 可以 是任 何 值
 非 hashable 的 值即 包 含 列表、 字 典 或 其他 可 变 类 型的值 此类 对象基于 值而 非对 象标识 进行 比 较不可 用作 键
 数 字类型 用 作键 时遵 循数字 比较的 一般 规 则 如果 两个 数 值相 等例 如1和1
0 则两 者可 以被 用 来 索引同 一 字 典 条目
但是 请 注意 由 于 计算机 对于 浮 点数存 储的 只是 近似 值因 此将其 用作字典 键是 不明智 的
字 典可以通 过将以 逗号 分隔 的 键 值 对 列 表包 含于 花括 号之 内 来创 建 例如 jack 4098 sjoerd 4127 或4098 jack 4127 sjoerd 也 可 以 通 过 dict  构造 器来创 建
class  dictkwargclass  dictmapping  kwargclass  dictiterable  kwarg 返 回 一个新的 字典 基于 可选 的 位置 参 数和 可能 为空的 关键字 参数集 来初 始化
 字典 可用多 种 方式 来 创 建使 用 花括 号内以 逗 号分 隔 键值对的方 式 jack 4098 sjoerd 4127 or 4098 jack 4127 sjoerd 使用 字典 推导 式 x  x 2 for  x  in  range 10使 用类型构 造器 dict  dictfoo 100 bar 200 dictfoo 100 bar 200 如果 没有 给 出位置 参数 将创 建 一个空字典
 如果给 出一 个 位 置 参 数并 且其属 于映 射对 象 将 创 建一个 具 有与 映射 对 象 相 同键值 对的 字典
 否则的话 位 置 参数 必 须 为 一 个 iterable  对 象
该 可 迭 代 对象 中的每 一项本 身 必 须 为 一 个 刚好 包含 两 个元 素的可迭 代 对象
 每一 项 中的 第 一 个 对 象将 成为新字 典的 一个 键 第二 个对 象 将成为其对 应的 值
如 果一个键 出现 一 次以 上该 键 的 最 后一 个 值将 成为其 在新 字 典中 对应 的值
 如果给 出了 关键 字参 数 则 关 键 字 参 数及其 值会被加 入 到 基于位置 参数 创 建的 字 典
如果 要加入的键 已 存在来 自关 键字 参数的值 将 替代来 自位 置参数 的值
 作为 演 示以 下示 例返 回的字典 均 等于 one 1 two 2 three 3 a  dictone 1 two 2 three 3 b  one 1 two 2 three 3 c  dictzipone  two  three 123 d  dicttwo 2 one 1 three 3 e  dictthree 3 one 1 two 2 f  dictone 1 three 3 two 2 a  b  c  d  e  f  true  像 第一个例 子那 样提 供关键 字参 数的方 式 只 能使 用有 效 的 python 标 识符 作 为 键
 其他 方 式则可 使用 任 何有 效的 键
这些 是 字 典 所支 持的 操作 因 而自 定义 的 映射 类型 也应 当支 持 listd 返 回字 典 d 中 使 用的 所 有 键的 列表
 lend  返回 字 典 d 中 的项数
 dkey 返 回 d 中以 key  为键 的 项
如 果 映射中不 存在 key  则会 引 发 keyerror
如 果 字 典 的子 类 定义了 方法 missing 并 且 key  不存在 则 dkey  操作 将调用 该方 法并 附 带键 key 作 为 参 数
 dkey 随后将返 回或 引发 missingkey 调用 所 返回 或引 发 的 任 何对 象或 异常
 没有其 他操 作或 方法 会发起调 用 missing
如 果 未定 义 missing 则会 引发 keyerror
 missing  必须 是一 个方 法 它 不能 是 一个 实 例 变量 class  counterdict 
 return 0 c  counter  cred 0 cred 1 cred 1 上面的 例 子显 示了 collections
counter 实 现的部 分代码
 还有 另一 个不 同的 missing  方法 是由 collections
defaultdict  所 使用 的
 dkey  value 将 dkey  设为 value
 del  dkey  将 dkey 从 d 中 移除
如果 映 射中 不存在 key  则 会 引发 keyerror
 key  in  d  如果 d  中存在键 key  则返 回 true 否 则返回 false
 key  not  in  d  等价 于 not  key  in  d
 iterd 返 回 以字 典 的键为 元 素的迭 代器
 这 是 iterd
keys  的 快捷 方 式
 clear 移 除字 典中 的 所 有元 素
 copy  返回 原字 典 的 浅 拷 贝
 classmethod  fromkeysiterable  value  使用来 自 iterable 的 键创建一 个新 字 典并 将键 值 设为 value
 fromkeys  是一 个 返 回 新字典 的类方 法
 value  默认为 none
 所有 值都只 引用 一个 单独的实 例因 此让 value  成 为一 个可变 对 象例如空列 表通 常是没 有意 义 的
 要获取不同 的 值请改用 字典推导 式
 getkey  default 如 果 key  存在 于 字典 中则 返 回 key  的值 否则返回 default
 如 果 default 未给出 则默 认 为 none  因 而 此 方法 绝不会 引 发 keyerror
 items 返回 由字 典项 键值对组 成 的一 个 新视图
参 见视 图对 象文 档
 keys 返 回由字 典键 组成 的 一个 新 视图
参见 视 图对 象 文档
 popkey  default  如 果 key 存 在 于 字典 中 则 将其移 除 并返 回 其 值否 则返 回 default 
如 果 default 未 给 出 且 key  不 存在于字 典中 则会 引 发 keyerror
 popitem 从 字 典中移 除并 返回 一个键 值 对
键值 对 会按 lifo 后 进 先 出 的 顺 序 被 返 回
 popitem 适 用于 对字 典 进行 消耗 性的 迭 代 这 在 集合算 法中 经常被 使用
 如果 字 典为 空调 用 popitem  将 引发 keyerror
 在3
7版 更改现在 会确 保采 用 lifo  顺 序
在 之 前的 版本 中 popitem 会返 回 一个任 意的 键值 对
 reversedd 返 回一 个逆 序获取 字典键 的 迭代器
 这是 reversedd
keys  的快 捷 方式
3
8 新版 功能
 setdefaultkey  default  如果字典存 在键 key  返 回它的值
如 果不存 在插入 值 为 default 的键 key  并返 回 default 
 default 默 认为 none
 updateother  使用 来自 other 的 键值 对更新 字典覆 盖原 有 的键
 返回 none
 update 接受另一 个字 典 对象 或者一 个包 含键 值对以 长度为 二 的 元 组 或其 他可 迭代 对象 表示的 可迭 代对象
如 果 给出了关 键 字 参 数 则会以 其所指定的键 值对 更 新字 典 d
updatered 1 blue 2
 values 返 回由 字典 值组成 的 一个新视图
 参 见 视图 对象 文档
 两 个 dict
values  视图 之 间的 相等性 比较 将总 是返 回 false
这 在 dict
values  与 其 自 身 比较 时也 同样 适用 d  a 1 d
values  false  d  other  合并 d 和 other  中的键和 值 来 创建 一 个 新 的 字典 两 者必 须都 是字典
 当 d  和 other  有相 同 键 时 other  的 值优 先
3
9新 版功 能
 d  other  用 other  的键 和值 更新 字 典 d  other  可以是 mapping  或 iterable  的键 值 对
当 d 和 other 有相 同 键 时 other 的 值优 先
3
9新 版 功能
 两个字 典 的 比 较 当 且 仅 当它 们 具有 相同 的 键 值对时 才会 相等 不 考虑 顺序
 排序比 较会 引 发 typeerror
字典 会 保留 插入 时 的顺 序
请 注意对 键的更 新不 会影响 顺 序
删除 并 再次 添加的 键将被 插入到 末尾
values 1234 done 42 d  one 42 two 2 three 3 four 4 del  dtwo  dtwo  none  d  one 42 three 3 four 4 two  none  在3
7版 更改 字典顺序 会确 保为插 入 顺序
 此行 为是 自3
6版 开始的 cpython  实现细 节
字典 和字典视 图 都 是 可逆的
items  four 4 three 3 two 2 one 1 在3
8版 更 改字 典现 在 是 可逆 的
参 见 types
mappingproxytype 可 被用 来创 建 一个 dict  的 只读 视 图
 字 典视 图对 象
由 dict
values  和 dict
items 所返回 的对象是 视图 对象
该 对象 提供 字 典 条目 的一 个 动 态 视 图这 意味 着当 字 典 改 变时视 图也 会相 应 改变
字典 视 图可 以被迭 代以 产 生与 其对 应 的 数据并 支 持成员 检测 lendictview  返回字典 中 的 条 目数
iterdictview  返 回 字典 中 的键、 值 或 项以 键值 为 元素 的元 组 表示 的迭代 器
键 和 值是按 插入时的 顺 序 进 行迭 代的
 这样 就 允 许 使用 zip 来创建 值键 对 pairs  zipd
 另 一 个创建 相 同列 表的 方 式 是 pairs  v  k  for  k  v  in  d
在 添 加或 删除 字典 中的 条 目期 间对 视图 进行 迭代可能 引发 runtimeerror 或 者 无法 完全 迭 代 所有 条目
 在3
7 版 更 改字 典 顺序会 确 保 为插入 顺序
x  in  dictview  如 果 x  是 对 应 字 典 中存 在的 键、值 或 项在 最 后 一种情 况 下 x 应为一 个 键值 元组 则返 回 true
reverseddictview  返 回 一个逆 序 获 取 字 典 键、 值或 项的 迭代 器
 视 图 将按与 插 入时 相反 的 顺序进行迭 代
 在3
8版更 改 字典 视 图现在是 可 逆的
 键视 图类 似 于集 合因 为 其 条 目 不 重复 且可哈 希
如 果所 有值 都 是 可哈希的 即 键值 对也 是 不 重复 且可 哈希的 那 么条 目 视图也 会 类 似于集 合
值 视图则不 被 视为类似 于 集 合 因 其 条目通 常 都 是有 重复 的
 对于 类似 于集 合 的视 图为抽 象 基 类 collections
set 所 定义的 全部 操 作 都是有效 的例 如或
一 个 使 用字 典视图的 示例 dishes  eggs 2 sausage 1 bacon 1 spam 500 keys  dishes
上 下 文管 理 器类 型
python  的 with  语句支 持通 过 上下 文管 理器 所 定义 的 运行时上 下 文这 一概 念
 此对象的实 现使用了 一 对 专门 方法 允许 用户自 定义 类 来定 义运 行时 上 下文 在语 句体被 执行 前 进 入该 上下 文 并 在 语 句 执 行完 毕时 退出 该 上 下文 contextmanager
enter 进入运 行时上下 文 并 返回此对象 或 关 联 到该运行 时上下文 的其 他对象
此 方 法的返回 值 会 绑定 到使用 此上 下文 管理 器的 with 语 句的 as  子 句 中 的标识 符
一 个返回 其自身的 上下 文管 理器 的例 子是 file  object
文件对象会从 enter  返回其 自 身以 允许 open  被 用作 with 语 句中的 上 下文表达式
一 个 返回 关 联对象 的 上下 文 管 理 器的 例 子是 decimal
localcontext 所 返回的对 象
 此种 管理器 会将活 动的 decimal  上下 文 设 为 原始 decimal  上下 文的一 个副 本 并 返 回该 副 本
 这 允许 对 with  语 句 的 语 句体 中的 当 前 decimal 上 下文 进 行 更改而 不 会 影响 with 语 句 以外 的 代 码
exitexctype  excval  exctb  退出 运 行时 上 下文 并返回一 个布 尔 值 旗标来表 明所发 生的 任 何异 常是 否 应 当被屏 蔽
 如 果 在执行 with  语句的 语句体期 间 发 生 了异 常 则 参数会 包含异 常的 类型、 值 以及回 溯信息
 在其 他情 况下三 个参 数 均为 none
 自此 方 法 返回一 个 真 值将导 致 with 语 句 屏蔽异 常 并继续 执行 紧 随在 with  语句之 后的 语 句
 否则异 常将在 此 方法结 束执 行后 继续 传 播
在 此方法 执 行 期 间 发 生的异 常将会 取 代 with  语 句 的 语 句 体 中发 生 的任何 异常
 传入 的 异 常绝对 不应 当被 显式 地 重 新引发—— 相反 地此方 法 应当 返回 一个 假值 以 表 明方法 已 成 功完 成 并且不希 望 屏 蔽被 引发 的异 常
这 允许 上 下文 管 理 代码方 便地 检测 exit  方 法 是否 确 实 已 失 败
python  定义了 一 些上下文管 理 器来 支持简易的 线 程同 步、 文件或 其他 对象的快 速 关闭 以及更方便 地 操作活 动的 十进 制算 术 上 下文
 除了 实 现上 下 文管 理 协 议 以 外 不同类型不 会被特 殊处 理
 请参阅 contextlib  模块查 看相关 的示例
python 的 generator 和 contextlib
contextmanager  装 饰器提 供了实 现这 些 协议 的便捷方式
 如果使 用 contextlib
contextmanager 装饰 器来 装饰一个生 成 器函数它将 返 回 一个实 现了必要的 enter  andexit  方法 的上下 文管理 器而不 再是 由未 经装 饰 的生 成 器函 数 所 产生的 迭代器
 请 注 意 pythonc  api 中 python  对象 的类 型结构 中 并没 有针 对这 些方法 的 专门槽位
想 要 定 义这 些方法的扩 展 类 型 必须将它 们 作 为普 通的 python  可 访问 方 法 来 提供
 与设 置运行 时上下 文 的 开 销相 比单个 类字典 查 找的 开销可以 忽 略不 计
generic  alias  type
 注解 if  the  getitem  of  the  class  metaclass  is  present  it  will  take  precedence  over  the  classgetitem  defined  in  the  class  see  pep 560 for  more  details
standard  generic  collections
special  attributes  of  generic  alias
parameters  t  参见 pep 585 type  hinting  generics  in  standard  collections  classgetitem  used  to  implement  parameterized  generics
 泛型 generic  generics  in  the  typing  module
3
9新 版功能
其 他内 置 类型
解释器 支持 一 些其 他 种 类 的对象
 这些 对象 大都仅 支 持一 两种操 作
模块
 模 块唯 一 的 特 殊操作 是属 性 访 问 m
name 这 里 m 为 一 个模 块而 name  访问定义在 m  的 符 号表 中的 一个 名称
 模 块属性可 以 被 赋 值
请 注意 import  语句 严格来 说 也 是对 模块对 象 的一 种操 作 import  foo 不要 求存 在一 个 名 为 foo  的 模块 对象而是 要求 存在一个 对 于 名 为 foo 的模块 的 永久 性定 义
每 个模 块都 有 一 个特殊 属性 dict
 这是 包含 模块 的 符 号表 的 字典
修改此 字 典 将实际 改变 模 块的符 号表但是 无 法 直接对 dict  赋值你可以 写 m
dicta 1这 会将 m
a  定 义 为1但是 你 不 能写 m
不 建 议 直接修改 dict
内 置于 解释器 中的 模 块 会写成 这 样 module  sys  builtin
 如果 是从 一个 文 件加载 则会写成 module  os  fromusrlocallibpythonx
 类与 类实例
 关 于这些 类型 请参 阅对 象、值 与类 型 和 类 定义
 函 数
 函数 对 象是通过 函数 定 义创 建的
 对 函 数对 象 的唯一操 作是 调用它 funcargumentlist
 实 际 上存 在 两种 不 同的 函数对 象 内 置函数 和 用 户 自 定 义函 数
两 者支 持同 样的 操作调 用函数 但 实 现方 式 不 同因此 对 象 类型 也 不同
更多 信息 请 参阅 函数定义
 方法
 方 法是 使用属 性 表 示 法 来调 用的函 数
存 在两种形 式 内置 方法例如 列表的 append 方 法 和 类 实例 方 法
 内置 方法 由支 持它 们的类型 来 描述
 如 果 你通 过 一 个实例来访 问方 法即 定 义在 类 命 名 空 间 内的函 数 你 会得 到一 个特殊 对象 绑定方法 或称 实例 方法 对 象
 当被调 用 时 它 会将 self  参数添 加到 参 数列 表
绑定方法 具 有两 个特 殊 的只 读属 性 m
self 操 作该 方 法 的 对象 而 m
func  是 实现该 方法的函 数
调 用 marg 1 arg 2
 argn  完全 等价 于 调 用 m
与 函数 对象 类 似绑 定 方 法对 象 也 支持 获 取 任意属性
但 是 由于方 法 属性 实 际上保存 于 下 层 的 函 数对象 中 meth
func  因此 不 允 许 设 置 绑定 方 法 的方 法 属 性
尝试 设 置 方法 的 属 性将 会导致引发 attributeerror
想 要 设 置方法 属 性你必须 在下 层的 函 数对 象 中 显式 地 对其 进行设置 class  c 
whoami  my  name  is  method 更 多 信 息请 参阅 标准类 型层级 结 构
 代码对 象
代 码 对象 被 具体实 现 用来 表 示 伪编译 的可 执行 python  代码例 如一个 函数 体
它们 不 同于函数对 象 因 为它们 不 包 含对 其 全 局执 行环境 的引用
 代 码 对象由 内 置 的 compile 函数返 回并 可通 过 从 函数对 象 的 code  属性从中提 取
另 请参阅 code  模块
 可以 通 过 将 代 码 对象 而非源 码 字 符 串 传 给 exec 或 eval 内 置函 数来执 行或 求 值
更 多信 息请参阅 标准 类型 层级结 构
 类 型对象
 类 型 对 象 表示各 种 对 象类型
 对象 的类 型可 通过 内 置 函 数 type 来获 取
 类型没 有特 殊 的操 作
 标准 库模块 types  定 义了 所 有 标准内 置 类 型 的 名 称
 类型以 这样 的 写 法来表 示 class  int
空 对象
此对 象会由 不显式地返 回 值 的函数 所 返 回
 它 不支 持任 何特殊 的 操 作
空对 象 只有 一 种 值 none 这是 个内 置名 称
 typenone 会生 成 同 一 个 单 例
该对 象 的 写法为 none
 省略符对 象
此对 象 常 被用于 切片参见切 片
它 不支持 任何 特殊的操 作
 省 略符 对 象只 有一 种值 ellipsis  这是个 内置名称
 typeellipsis 会 生成 ellipsis  单 例
 该对 象的写 法 为 ellipsis  或
未实 现 对象
此对 象 会 被作为比 较和 二元运 算被 应 用 于它们 所 不 支 持的 类 型 时的 返 回值
 请 参阅 比较运 算 了 解更多 信 息
 未实现 对 象只有 一 种值 notimplemented
typenotimplemented  会 生 成这 个单例
该对象 的 写 法为 notimplemented
布 尔值
布尔值 是 两 个 常 量对 象 false 和 true
它们 被用 来 表 示 逻 辑 上的 真 假 不 过其他 值也可 被当作真 值或假值
 在数 字类的 上 下 文中例 如被 用作算术 运算 符的 参 数 时它们 的行 为 分 别类 似于 整数0 和1
内 置 函 数 bool  可 被 用来将 任 意 值转 换 为布 尔 值 只要 该 值可 被解 析为一个逻 辑值 参见 之 前 的逻辑 值 检测部分
 该对 象 的 写 法 分别为 false  和 true
 内 部对象
 有关此对 象的 信息 请参 阅标 准 类 型 层级 结 构
其 中描 述了 栈帧 对象、回溯 对象 以及切片对 象 等等
 特殊属 性
 语言实 现 为 部分对 象类 型 添 加了 一些特 殊的只 读属性它 们具有 各自的作用
其 中 一些 并不 会 被 dir 内 置函 数 所 列出
dict  一个 字 典 或其 他类型 的映 射对象 用于 存 储 对 象的 可 写属 性
class  类 实例所 属 的 类
bases 由类 对 象的 基类 所 组 成的 元 组
name 类、函 数、方 法、描 述 器 或 生 成器实 例的名称
qualname  类、函 数、方 法、描 述 器或 生成 器 实 例的 qualified  name
3
3新 版 功 能
mro 此 属性 是由 类 组成的元 组 在 方法 解 析期 间会 基 于它来 查 找基类
mro  此方法 可被 一个元 类 来重 载以 为其 实 例 定 制方 法解 析顺 序
 它会 在 类 实 例化 时 被 调用 其 结 果 存储于 mro  之中
subclasses  每个类会 保存 由对 其直 接子类 的 弱 引用组 成 的列表
 此 方法 将 返回一 个由 仍 然存 在 的 所 有 此 类 引 用组成 的 列表
例如 int
subclasses  class  bool  脚 注1 有关 这 些特 殊 方 法 的 额 外 信 息可参 看 python 参考指 南基 本定 制
2作 为结 果 列 表12 与1
02
0 是相 等 的元 组的 情 况也类 似
3 它们必 须如此 因为 解析 器 无 法区分 这些 操 作 数的 类 型
4区分大小 写的字符是 指所 属 一般 类别属 性为 lu  letter  uppercase  ll  letter  lowercase  或 lt  letter  titlecase  之一 的字 符
5要 格式化单独 一 个元组那 么你 应当 提 供 一 个单例 元 组 其 唯一 的元 素就是 要被 格 式化 的元组
string  常见 的字符 串操作
 源 代 码 libstring
py 参见 文 本序 列 类型 str  字符 串 的方 法
 字 符串常 量
 此模 块 中定 义的 常量为 string
asciiletters  下 文所述 asciilowercase 和 asciiuppercase  常量的拼 连
该 值不 依赖于 语言区域
asciilowercase  小 写 字 母 abcdefghijklmnopqrstuvwxyz
该值 不依赖 于 语 言区域 不会 发生 改 变
asciiuppercase 大 写 字 母 abcdefghijklmnopqrstuvwxyz
 该值 不 依 赖于语 言区 域 不会发 生 改 变
digits 字 符 串0123456789
hexdigits  字符 串0123456789 abcdefabcdef
octdigits  字 符 串01234567
punctuation  由 在 c 区 域设 置中 被 视为标 点符 号 的 ascii  字符 所 组 成的字 符 串
printable  由被视 为可 打印符 号的 ascii  字 符组 成的 字符 串
 这 是 digits  asciiletters  punctuation 和 whitespace 的 总和
whitespace  由 被视 为空 白符 号 的 ascii 字 符 组成 的字 符串
 其中 包括 空格、制 表、换 行、回 车、进纸 和纵 向制 表符
自 定义字 符 串 格 式 化
内 置的字 符串 类提供 了通 过 使用 pep 3101 所描 述的 format 方 法进 行复杂变 量替 换和 值 格 式化 的能 力
 string 模块中 的 formatter  类 允许你 使 用 与 内 置 format  方法相 同的 实 现来创 建并 定 制你自 己的字符 串格式 化 行 为
formatter  formatter  类 包含下 列 公 有 方法 formatformatstring  args  kwargs 首 要的 api  方 法
 它 接受 一 个 格 式 字 符串 和任意 一 组 位置 和关 键 字参 数
它 只是一 个 调 用 vformat  的包 装 器
在3
7 版 更 改格 式 字 符 串 参数 现在 是仅 限位置 参 数
 vformatformatstring  args  kwargs 此 函数 执 行 实际的 格 式化操 作
它 被 公开为一 个 单独 的 函 数用 于 需要 传入 一个预 定义字母 作 为 参数 而不是 使用 args  和 kwargs 语 法 将 字典 解 包 为 多 个单独参数 并重 打 包 的 情 况
 vformat 完 成 将格 式 字符 串分解 为 字 符数 据 和替 换 字段的 工 作
 它会 调 用下 文 所 述 的 几 种不同 方法
 此 外 formatter  还定义 了一 些旨 在被 子类 替换的 方法 parseformatstring  循环遍 历 formatstring  并 返回一 个 由可 迭 代对象 组 成的元组 literaltext  fieldname  formatspec  conversion
它 会被 vformat  用 来将 字符 串分 解 为文 本字面值或 替换字 段
元 组中的 值 在 概念上 表示一 段 字面 文本 加 上 一 个 替换 字段
如 果没 有字 面 文本如 果 连 续 出 现 两 个 替换字 段 就会发 生 这种情 况则 literaltext 将 是一个 长度为 零 的字 符串
 如果 没 有替 换字 段 则 fieldname  formatspec 和 conversion  的值 将 为 none
 getfieldfieldname  args  kwargs 给 定 fieldname 作为 parse 见 上文的 返回值 将其 转 换为 要格式 化 的 对象
 返回一 个元 组 obj  usedkey
默认 版 本接 受 在 pep 3101 所 定义形 式 的 字符串例如0 name  或 label
title 
 args 和 kwargs  与 传 给 vformat 的 一样
 返回 值 usedkey 与 getvalue  的 key  形 参 具有 相 同的含 义
 getvaluekey  args  kwargs  提 取 给 定的 字段值
 key 参数 将为 整数 或字 符 串
 如 果是整 数它表示 args  中 位置 参数 的索 引 如果 是 字 符串它 表 示 kwargs  中 的关 键字参 数名
 args  形参会被 设 为 vformat 的位置 参 数列 表而 kwargs 形 参 会 被设为 由 关 键字 参 数 组 成 的 字典
 对于 复 合字段名 称仅 会为字段 名 称 的 第一个 组 件 调用这些函 数 后续 组件 会通 过普 通属 性 和 索 引 操作 来进行处 理
 因此举 例 来说 字段 表 达 式0
name 将 导致调 用 getvalue 时 附带 key 参数值0
 在 getvalue  通 过调用 内 置 的 getattr 函 数返回 后将会 查找 name  属性
 如 果 索引或 关 键 字引用了一 个不 存在的 项 则 将引发 indexerror  或 keyerror
 checkunusedargsusedargs  args  kwargs  在 必要 时 实现对 未使 用参 数进 行 检测
 此 函 数的参 数是 是格 式字 符串 中实 际 引 用的 所有参数 键 的 集合整 数 表 示位置参数 字 符 串表 示名 称 参数 以及 被 传 给 vformat 的 args 和 kwargs  的 引用
未使 用 参数 的集 合可以 根 据这 些形参 计 算出 来
 如 果检测 失败则 checkunusedargs 应 会引 发 一个 异 常
 formatfieldvalue  formatspec  formatfield  会简单 地 调用 内 置全 局函数 format
 提 供该 方 法 是为了 让 子 类能 够重 载它
 convertfieldvalue  conversion  使用 给定 的 转换 类 型 来 自 parse 方 法 所 返回的 元组来 转换 由 getfield  所 返回的 值
默 认版 本支 持 s  str  r  repr  和 a  ascii  等转换 类 型
 格式字 符 串语 法
格 式规 格 迷你 语 言
 格 式规 格在 格 式字 符串 所 包 含的替 换字段 内部 使 用 用于 定义单 个值 应如 何 呈现 参 见 格式字 符 串语 法和 格式化 字符串字 面值
 它们也 可以 被直 接 传 给内置 的 format  函 数
每种 可 格 式化 的类型 都可以自 行定 义如 何对格 式 规 格 进 行 解读
大 多 数 内置类型都为格 式 规格实现了 下列选项 不过某 些格 式化 选项只 被数值 类型所 支 持
 一般约 定空的 格式描述 将产 生 与在 值上 调用 str 相 同 的 结果
非 空格 式描 述通 常会修 改此 结 果
标 准 格 式说明符 的 一 般形 式 如下 formatspec  fillalignsign 0 widthgroupingoption
precisiontype  fill  any  character  align  sign  width  digit  groupingoption  precision  digit  type  b  c  d  e  e  f  f  g  g  n  o  s  x  x  如果 指定 了 一个 有效的 align 值 则 可以在 该值 前 面加 一 个 fill  字 符它可 以 为 任 意 字符 如 果 省略则 默认为 空格符
在 格式化 字 符 串 字面值或在 使用 str
format 方法 时是 无法使 用 花 括号字 面 值 or  作 为 fill 字符 的
 但 是 通过 嵌 套 替换字 段插 入 花括号 则 是 可以的
 这个 限 制 不会影 响 format 函数
各 种对 齐选 项的 含义如下 选 项意 义强 制 字段 在可 用 空 间内左 对齐 这是 大多 数对象的默认 值
强 制字段 在可用 空 间内右对 齐这是数 字的 默认值
 强制将填充 放置在 符号 如 果有 之 后 但在数 字 之 前
这用于 以000000120形式打印 字段
 此对 齐 选项仅 对数字类 型 有效
 当0 紧接 在字段宽 度之 前时 它 成 为默 认值
 强 制 字 段在可 用空间 内居中
请注 意 除非定义 了最小字 段宽 度 否则 字段 宽 度 将始终 与填 充它的 数据大小 相同 因 此在 这种情 况下 对 齐选 项 没 有 意义
sign  选项 仅对 数 字 类型有 效可以 是以 下 之 一选项 意义 表示标志 应该用 于正数和 负 数
 表示标 志 应 仅用 于 负数 这 是默认 行为
 space 表 示应在正数 上使 用前导空 格 在负 数 上使 用减号
 选项可 以让替 代 形 式被用 于转 换
替代 形式 可针 对不 同 类 型分 别 定义
此 选 项仅 对 整数、浮 点、 复数 和 decimal 类型 有 效
对 于 整数 类 型当 使用 二进 制、 八 进 制 或十六 进制输 出 时 此选 项 会为 输出值添加 相应 的0 b 0 o 或0 x  前缀
 对 于浮 点 数、复 数 和 decimal  类型替 代形式 会使 得转 换 结果 总是 包含 小数点 符号 即使 其不带 小数
 通 常 只 有在带有小 数的情 况 下此类 转 换 的 结 果中 才会出 现小 数 点 符 号
此外 对 于 g 和 g  转 换 末 尾 的 零 不 会 从结 果 中 被移除
 选 项表 示使用逗 号作 为千位 分 隔符
 对于感 应 区 域设置 的 分 隔符请 改 用 n 整 数 表示 类型
 在3
1 版 更改 添 加了 选 项 另请 参 阅 pep 378
选 项 表示 对 浮点表示 类型和整数 表示 类 型 d  使用下 划线作为 千 位 分隔符
对于 整 数 表示类 型 b  o  x  和 x  将 为每4 个 数位插入 一 个下 划 线
对 于其 他 表 示类型 指定 此 选项则 将导致错 误
在3
6版更改 添加 了选项 另 请 参阅 pep 515
width 是 一 个 定 义最小 总字 段宽 度 的 十进制 整 数 包 括任何前 缀、 分隔符 和其 他格 式 化 字 符
如果 未指 定则字段 宽 度 将由内 容确定
当 未显式 给出对 齐方 式 时 在 width 字段 前 加一 个 零0 字段将为数字 类 型启用感 知 正 负 号 的 零填 充
 这相当 于设 置 fill  字 符 为0且 alignment  类型 为
precision 是一 个十 进制数 字表 示对 于以 f  and  f  格 式 化的浮 点数 值要 在小 数 点后显 示多 少个 数 位 或者对 于 以 g 或 g 格 式 化的浮 点数 值 要 在小 数 点 前后共 显 示 多少 个 数位
对于 非数 字 类 型 该 字 段 表 示 最大 字段 大小—— 换 句话说 就 是要使 用 多少 个来自字 段 内 容的字 符
 对于 整数 值 则不允 许 使 用 precision
 最后 type 确 定 了数 据应如何呈 现
可 用的字 符 串表 示类 型 是类型 意 义 s 字 符串 格式
 这是 字 符串 的 默 认类型 可 以省 略
 none 和 s 一 样
 可用 的整数表 示 类型 是类 型 意 义 b 二 进 制格 式
输 出以2 为 基数 的数 字
 c 字 符
 在 打 印 之 前将 整数转 换为 相 应的 unicode  字 符
 d 十 进 制 整 数
 输出以10 为 基 数的 数字
 o 八 进制 格式
输 出以8 为 基数 的 数 字
 x  十 六 进 制 格 式
 输出以16 为 基数 的 数字 使 用 小 写字 母 表 示9以 上 的 数 码
 x  十 六 进制 格 式
输 出以16为基 数 的 数 字 使用大 写 字 母 表 示9 以 上 的 数 码
 n  数字
这 与 d 相 似 不 同之 处 在 于 它会 使 用 当前 区 域 设置来 插 入 适 当 的 数 字 分 隔 字 符
 none  和 d 相 同
 在上述 的 表 示类 型 之 外 整 数 还可以 通过 下列 的浮 点 表 示类型 来格 式 化除了 n  和 none
 当这 样 做时 会 在格 式 化 之前使用 float 将 整数 转换 为浮 点 数
浮点数 和小数 值 可用 的 表示 类型 有 类型 意 义 e 指 数表示
 以使 用 字 母 e 来标 示 指 数的 科 学 计数 法 打印 数 字
默 认 的精 度 为6
 e 指 数 表 示
与 e 相 似 不 同之 处在 于 它使 用大 写 字 母 e  作 为分 隔字符
 f  定点 表示
 将数 字 显 示 为 一个 定点 数
默 认 的精 确度 为6
 f  定点 表示
 与 f  相 似但会 将 nan 转 为 nan  并将 inf 转 为 inf
 g  常规格 式
对于给定 的精 度 p 1这 会 将数 值 舍 入 到 p  位有效 数字 再将结果 以定点 格式或科学 计 数 法进 行 格 式 化 具体 取决 于其值 的 大 小
准确 的 规 则如 下 假 设使 用 表 示类 型 e 和 精度 p 1 进 行格 式化 的结 果具有 指数 值 exp
 那么 如 果 m  exp  p  其中 m 以4 表 示 浮 点 值 而 以6 表 示 decimal 值 该 数字 将使用 类型 f  和精 度 p 1 exp  进行 格 式化
否 则的话 该数 字 将使 用 表 示类 型 e 和 精 度 p 1进 行格 式化
 在两 种 情况 下都会 从有 效 数 字中 移 除 无 意义 的 末 尾零如 果小 数 点 之后 没 有余下数 字 则小 数点 也会 被 移除除非 使 用了 选 项
 正负 无 穷 正负 零和 nan  会 分 别被 格式 化为 inf  inf 00 和 nan  无论 精度如 何 设 定
精度0 会被视为 等同于 精度1
默 认 精 度为6
 g 常 规格 式
类似于 g  不同之 处在 于 当数值非 常大 时会 切换 为 e
 无穷与 nan  也会 表 示 为 大写形 式
 n 数 字
这与 g 相 似不同 之处 在 于它 会使 用当 前 区域 设 置来 插 入适当的数 字 分隔 字符
 百 分 比
将数 字乘以100并 显 示 为定 点 f  格式 后面 带一 个 百 分号
 none 类 似于 g 不同 之处 在 于 当 使用定 点表示 法 时小 数 点后 将至 少 显 示一位
 默认精 度 与表 示给定 值所 需的 精度 一 样
 整体 效果 为与其 他 格 式修 饰符 所调 整 的 str  输出 保持 一致

 格式示 例
 本 节包含 str
format  语 法 的示例以及 与旧 式 格 式化的 比 较
 该 语 法在 大多数 情况 下 与旧 式 的格 式化 类似只是增 加 了 和来取 代
 例 如03
2 f  可以 被改 写 为03
 新的 格式 语 法还 支 持 新增的 不 同 选 项将在 以下 示 例 中说 明
 按位 置访 问 参 数012
formatabra  cad  arguments  indices  can  be  repeated  abracadabra 按名 称 访 问参 数 coordinates  latitude  longitude
81 w  访 问 参数 的属 性 c 35 j  the  complex  number 0 is  formed  from  the  real  part 0
 strpoint 42 point 42 访问 参 数 的项 coord 35 x 00 y 01
formatcoord  x 3 y 5替 代 s  和 r  repr  shows  quotes  r  str  doesnt  s
formattest 1 test 2 repr  shows  quotes  test 1 str  doesnt  test 2 对 齐文 本以 及指定 宽度30
formatcentered  use  as  a  fill  char  centered  替代 f  f  和 f 以 及 指 定正负 号 f  f
140000替代 x  和 o  以 及转 换 基 于 不 同进 位 制的值 format  also  supports  binary  numbers  int 0 d  hex 0 x  oct 0 o  bin 0 b
format 42 int 42 hex 0 x 2 a  oct 0 o 52 bin 0 b 101010 使 用 逗号作 为 千位分 隔符
format 12345678901234567890 表示为 百分 数 points 19 total 22 correct  answers 
36 使 用特定 类 型的专 属 格 式 化 import  datetime  d  datetime
formatd 20100704121558 嵌 套参 数以 及更复 杂的 示例 for  align  text  in  zip  left  center  right 
模 板 字符 串
 辅 助函数
capwordss  sepnone  使用 str
split 将 参数 拆 分 为 单词使 用 str
capitalize 将单 词转 为 大 写 形 式 使 用 str
join  将大写 的 单 词进 行拼 接
如果 可 选 的 第二个参 数 sep 被省 略或为 none  则连 续的空 白字 符会被 替换为 单 个空 格 符并且 开头 和 末尾 的 空 白 字符会 被移 除 否则 sep  会 被用来 拆 分 和拼接 单词
stringprep  因特 网字 符串 预 备
struct  将 字 节串解 读 为打包 的二 进制 数 据
源 代码 libstruct
py  此 模 块 可 以 执行 python 值 和 以 python  bytes  对象 表示的 c  结构之 间的 转换
这 可以 被用来 处理存储 在 文 件中或 是 从网 络连 接等 其他 来源获取的 二进 制 数据
 它使用 格 式 字符 串 作 为 c  结 构 布局 的精简 描述 以及 与 python 值 的 双向 转 换
注 解 默 认情 况 下 打 包 给 定 c 结 构 的结 果会包含 填充字 节以使得所 涉 及 的 c 类 型保持 正 确的 对 齐类似 地对 齐在 解包 时 也 会被纳 入考 虑
选 择此 种行为的 目 的 是 使得被打 包结构 的字节 能 与 相应 c 结 构 在 内 存中 的布 局 完 全一 致
要 处 理 平台独 立 的数据 格 式或 省略 隐式的填 充字 节请 使 用 standard  大小和 对 齐 而不 是 native  大小 和 对 齐详 情 参 见字节 顺序 大小 和 对 齐方式
 某些 struct  的函数 以及 struct 的方 法接 受一 个 buffer 参数
 这将 指向 实现了缓 冲协 议 并提 供 只 读或 是 可读写 缓冲 的对 象
用 于此目 的 的 最常 见 类 型 为 bytes 和 bytearray 但 许多 其 他 可 被视 为 字 节数组 的类 型也实 现了缓冲协 议因此它 们 无需额 外从 bytes  对象复制 即可 被读 取 或填充
函 数 和 异 常
格 式字 符 串
 格式字符 串是 用 来在打 包和 解 包 数据时指 定预 期布 局 的机制
 它 们 使 用指 定 被打 包 解包数据 类型 的格 式 字 符 进行 构建
 此 外还 有一 些特 殊 字 符用来 控制 字 节 顺序大 小和 对齐方 式
 字 节 顺 序大 小和 对 齐 方 式
 格 式 字 符
示 例
 注 解所 有 示例 都假 定 使用 一台 大端 机 器 的本机 字节顺序、 大小 和 对齐方 式
 打包解包三个 整 数 的基 础示 例 from  struct  import  packhhl 123 bx 00 x 01 x 00 x 02 x 00 x 00 x 00 x 03 unpackhhl  bx 00 x 01 x 00 x 02 x 00 x 00 x 00 x 03123 calcsizehhl 8 解包 的 字 段可通 过 将 它 们 赋值给 变量或将结果 包装为 一个 具 名元 组 来命名 record  braymond  x 32 x 12 x 08 x 01 x 08 name  serialnum  school  gradelevel  unpack 10 shhb  record  from  collections  import  namedtuple  student  namedtuplestudent  name  serialnum  school  gradelevel  student
makeunpack 10 shhb  record  studentnamebraymond  serialnum 4658 school 264 gradelevel 8 格式 字符 的顺 序可 能对 大小产 生影响 因为满 足对 齐要 求所 需的填充是不 同 的 packci  b 0 x 12131415 bx 00 x 00 x 00 x 12 x 13 x 14 x 15 packic 0 x 12131415 b  bx 12 x 13 x 14 x 15 calcsizeci 8 calcsizeic 5 以 下 格式 llh 0 l 指 定 在末 尾有 两 个填 充字 节假 定 long 类型 按4 个字 节 的 边界 对 齐 packllh 0 l 123 bx 00 x 00 x 00 x 01 x 00 x 00 x 00 x 02 x 00 x 03 x 00 x 00 这仅当 本机大 小 和 对齐方 式生 效 时 才会起作 用 标 准大小 和 对齐 方式 并不会 强 制进 行 任何对齐
参 见模块 array  被打包 为二进制 存储的 同 质数据
 模 块 xdrlib 打 包和 解 包 xdr  数据
类
struct  模块还定 义了 以下 类 型 class  struct
structformat 返 回 一个新的 struct 对 象它会根 据格式 字 符 串 format 来写 入 和读取 二进 制数 据
 一次 性 地创 建 struct 对 象并调 用其 方法 相 比使 用同 样的 格式调用 struct  函数 更为高效因为 这 样 格式字 符 串只 需被编 译 一 次
注解 传 递 给 struct  和模块层级 函 数的已 编译 版最 新 格式 字符 串 会 被 缓 存 因此 只 使用 少量 格 式 字符串的 程 序 无需担 心重用单 独的 struct  实例
 已编 译 的 struct  对 象支 持以 下 方法和 属性 packv 1 v 2
 等价 于 pack 函 数 使 用了 已编 译的 格式
 lenresult  将 等 于 size
 等价于 packinto  函数使 用了 已 编译的 格式
 unpackbuffer 等 价于 unpack  函数使 用 了已编 译 的 格 式
 缓冲 区 的 字节大 小必 须 等于 size
 unpackfrombuffer  offset 0等 价 于 unpackfrom 函数 使用 了已 编 译 的格式
 缓 冲区 的字节 大 小 从 位 置 offset  开 始必须 至少为 size
 iterunpackbuffer 等 价 于 iterunpack 函 数 使 用了 已 编 译 的格式
 缓冲区 的大 小 必 须为 size 的 整数倍
3
4 新版 功 能
 format  用于构 造此 struct 对 象 的 格式字 符 串
 在3
7版更 改 格 式字符串 类 型 现在是 str  而 不再是 bytes
 size  计算 出对 应于 format  的 结 构大 小亦 即 pack 方法 所 产 生的字 节 串 对 象的 大小
subprocess  子进 程管理
 源代码 libsubprocess
pysubprocess  模 块允 许你生 成新的 进程 连接 它们 的输入、 输 出、错误管道 并 且 获取它 们的返 回码
此 模 块 打算代 替 一些老旧的 模块与功 能 os
spawn 在下 面 的 段落中 你可以 找 到 关于 subprocess  模块 如 何代 替 这些模块和 功能的 相关 信息
参见 pep 324 提 出 subprocess  模块的 pep
 使 用 subprocess 模块
常用 参数
popen 构造 函数
异 常
 在 子进程 中抛出的 异常 在 新的 进程 开 始 执 行 前 将 会 被再 次 在 父 进 程中 抛 出
 最常见 的 被 抛出 异常是 oserror
 例 如 当尝 试 执 行一 个 不 存在的 文件时 就会发 生
 应 用 程序需 要为 oserror  异常 做 好准 备
 如果 popen  调 用时 有无 效的 参 数则 一个 valueerror 将 被抛 出
checkall 与 checkoutput 在调 用 的 进 程 返回 非 零 退出码时 将 抛 出 calledprocesserror
 所 有接受 timeout  形 参 的函 数与 方 法 例 如 call 和 popen
communicate  将会 在进程 退 出 前超 时 到 期时抛 出 timeoutexpired
此模 块 中定义的 异 常 都继承 自 subprocesserror
3
3 新版 功 能基 类 subprocesserror  被 添 加
 安全考 量
不像 一些 其他的 popen 功 能此 实 现 绝不会 隐式调 用 一个 系统 shell
这 意味 着任 何字 符包 括 shell  元字 符 可以 安全地 被 传 递给子 进 程
如果 shell 被 明确地 调用 通 过 shelltrue  设 置则 确 保所 有空 白字符和 元 字 符被恰 当地包 裹在引 号 内 以避 免 shell 注 入 漏洞 就由 应用程序负 责 了
当使用 shelltrue  shlex
quote 函 数 可 以作 为在 将被用于 构造 shell  指令的 字符 串 中 转义空白 字符 以 及 shell  元 字符 的方 案
popen  对象
windows  popen 助手
windows  常 数
 较 旧 的 高阶 api
 使 用 subprocess  模 块 替换 旧函 数
在 这一节 中 a 改 为 b 意 味 着 b  可以 被用作 a 的 替代
注 解在 这 一 节 中 的 所有 a 函数 会在找 不 到 被执 行的程 序时 差不多 静默 地 失 败 b 替 代函 数 则 会 改 为引发 oserror
 此外在 使用 checkoutput  时如 果替代 函 数所 请求 的操作 产生 了非 零返 回 值则 将失 败并 引发 calledprocesserror
操 作的 输出 仍 能以 所引 发异常 的 output  属 性 的 方式被 访问
 在下 列 例子 中我们假 定 相 关的函 数都 已 从 subprocess 模 块中 导入了
替 代 binsh  shell  命令 替 换
outputmycmd  myarg 改 为 output  checkoutputmycmd  myarg
替 代 shell 管 道
outputdmesg  grep  hda  改 为 p 1 popendmesg  stdoutpipe  p 2 popengrep  hda  stdinp 1
communicate 0启 动 p 2 之 后再 执行 p 1
close 调 用 很重要 这是为 了让 p 1 能 在 p 2先 于 p 1退 出 时 接收到 sigpipe
 另外对 于受 信任的 输入 shell  本身 的 管 道 支持 仍 然可 被直 接使用 outputdmesg  grep  hda 改 为 outputcheckoutputdmesg  grep  hda  shelltrue
 替代 ossystem
systemmycmd  myarg  becomes  sts  callmycmd  myarg  shelltrue  注释 通 过 shell  来调 用程 序通 常 是 不 必要 的
 一 个更 现实 的 例子 如下 所 示 try  retcode  callmycmd  myarg  shelltrue  if  retcode 0 printchild  was  terminated  by  signal  retcode  filesys
 替 代 osspawn 函 数 族
pnowait 示例 pid  os
pidpwait  示例 retcode  os
pwait  binmycmd  mycmd  myarg  retcode  callbinmycmd  myargvector 示例 os
pnowait  path  args  popenpath  args 1 environment  示例 os
 替代 ospopen  ospopen 2 ospopen 3
stdout 返 回 码 以 如 下方 式 处 理转写 pipe  os
 来自 popen 2模 块的 替代 函 数
注 解如果 popen 2 函 数的 cmd  参数 是一 个 字 符 串 命 令 会通 过 binsh  来执 行
如 果是一 个列 表命 令会 被 直接执 行
popen 3和 popen 2
popen 4 基本 上 类似 于 subprocess
popen  不同之 处在 于 popen 如 果 执 行 失败 会引 发 一 个异常
 capturestderr  参数被 替换 为 stderr 参数
 必须 指定 stdinpipe  和 stdoutpipe
 popen 2 默认 会关 闭所有文 件描 述符 但 对于 popen 你必 须指 明 closefdstrue 以 才 能在 所有 平 台 或较旧 的 python 版 本中确 保 此 行为
 旧式的 shell  发起 函数
 此 模块还 提供 了以 下来 自2
x  commands  模 块 的旧 版 函 数
这些 操作会隐式 地 发起 调用系 统 shell  并且 上文所 描述 的有 关安 全 与异常处 理一 致性 保证都不 适 用于这 些 函 数
getstatusoutputcmd 返 回在 shell 中 执行 cmd  产生的 exitcode  output
 在 shell 中以 popen
checkoutput  执行 字 符 串 cmd  并返回 一个2元 组 exitcode  output
会使 用当前 区域设置 的 编 码 格 式 请参阅 常用参 数中的说 明 来 了解详 情
末尾 的一 个 换 行符 会 从输 出 中 被去除
 命令的 退出码 可被 解读 为子 进程的返 回 码
 例如 subprocess
getstatusoutputbinkill 15可 用性 posix  和 windows
在3
4 版更改 添 加 了 windows 支 持
此函 数 现在 返 回 exitcode  output 而不 是像 python 3
3及 更早 的版 本那 样返回 status  output 
 exitcode  的值 与 returncode 相 同
getoutputcmd  返 回 在 shell  中 执 行 cmd  产 生的 输 出 stdout 和 stderr
 类 似于 getstatusoutput  但退 出码 会 被忽 略 并 且 返 回值 为包 含命 令输 出 的字符 串
例如 subprocess
getoutputls  binls  binls 可 用 性 posix 和 windows
 在3
4 版更 改 添加 了 windows 支 持
注释
 在 windows 上将 参 数 列 表转换 为 一 个 字符 串
在 windows 上 args  序列 会被 转换 为可 使 用以 下规 则来 解析 的字 符 串 对 应于 ms  c  运 行 时 所使用 的规则1
 参数以 空白符分隔 即 空 格 符或 制表 符
用 双 引 号标 示的字符 串会 被 解 读 为 单个参 数而 不再 考虑 其 中的空 白符
 一个 参 数可 以嵌 套用引 号标 示的 字 符串
带 有一个反 斜杠前 缀的双 引 号 会被 解读 为双 引号 字面值
 反斜杠 会按字面 值解 读 除非 它 是作为双引 号 的 前 缀
 如 果反斜 杠被作 为双 引 号 的前缀 则 每个 反 斜杠 对会被 解 读 为一 个反斜杠字 面 值
如 果反 斜杠数 量为 奇 数则最 后一 个 反 斜 杠会 如规 则3 所描 述的 那 样转 义下一个双 引号
 参 见 shlex  此 模 块提 供了 用于 解析 和转 义命 令行 的函 数
sunau 读 写 sun  au 文 件
auread  对象
getsampwidth 返回采 样 字节长度
getframerate 返 回采 样 频 率
getnframes 返回 音频 总帧数
getparams 返回 一个 namedtuple  nchannels  sampwidth  framerate  nframes  comptype  compname 与 get  方法的 输出 相同
rewind  设 置 当前文件指 针位置
 以下两 个 方法 都 使 用 指 针具体 实 现 由其底层决 定
getmarkers 返 回 none
getmarkid  引 发错误 异 常
auwrite 对 象
setnchannelsn  设置 声 道数
 在3
4版 更改 added  support  for 24 bit  samples
writeframesrawdata  写入 音 频数 据 但 不更新 nframes
在3
4 版 更 改现 在可接 受 任意 byteslike  object
writeframesdata  写 入 音 频数 据 并更 新 nframes
在3
4版 更 改现 在可 接受 任意 byteslike  object
 被 取代 的模块
 本 章 中描 述 的 模块均 已弃用仅 保留 用 于向 后 兼 容
它 们 已经被 其他 模 块所 取 代
 optparse 解 析器 的 命令 行 选项背 景 术 语 what  are  options  for 位 置位置教 程 understanding  option  actions  the  store  action  handling  boolean  flag  options  other  actions 默 认 值 generating  help  grouping  options  printing  a  version  string  how  optparse  handles  errors  putting  it  all  together 参考指 南创 建 解 析 器 填 充 解 析 器定义 选项 option  attributes  standard  option  actions  standard  option  types  解析 参数 querying  and  manipulating  your  option  parser  conflicts  between  options 清 理 other  methods  option  callbacks  defining  a  callback  option  how  callbacks  are  called  raising  errors  in  a  callback  callback  example 1 trivial  callback  callback  example 2 check  option  order  callback  example 3 check  option  order  generalized  callback  example 4 check  arbitrary  condition  callback  example 5 fixed  arguments  callback  example 6 variable  arguments  extending  optparse  adding  new  types  adding  new  actions  imp  access  the  import  internals 示 例
symbol 与 python 解 析 树 一起 使用 的 常 量
 源 代 码 libsymbol
py 此模块提 供 用 于表 示解 析 树内 部节 点数值的 常 量
 与大多 数 python 不 同这 些 常 量 使用 小 写字 符名称
 请参阅 python  发行 版 中 的 grammargrammar 文件 来获取 该 语言语法 上 下 文中 对这 些名称 的 定 义
这些 名称所映 射的 特 定 数 字 值可 能会 在 python  版 本 之间更改
警 告 symbol  模 块 已 弃用 并将 在 未 来的 python 版 本中 被 移除
 此 模块还 提 供了一 个额 外 的数 据对象 symbol
symname 将 此模块 中定 义 的常量 的数 值映 射 回 名称 字符 串的 字典允 许 生成更 加人 类可 读的 解析树表示
symtable  access  to  the  compilers  symbol  tables
generating  symbol  tables
examining  symbol  tables
例 如 table  symtable
sys  系统 相 关 的参 数和函数
sysconfig  provide  access  to  pythons  configuration  information
3
2 新版 功 能
 源代码 libsysconfig
 配置 变 量
 用 法 示例 import  sysconfig  sysconfig
 安装 路 径
其 他功能
using  sysconfig  as  a  script
unix  syslog  库 例 程
此模 块提 供 一个 接口 到 unix  syslog  日常库
参 考 unix 手册 页 关于 syslog  设 施 的 详细描 述
此模块包装 了系 统的 syslog 例 程族
 一 个能 与 syslog 服 务 器 对 话 的纯 python  库则 以 logging
handlers 模 块中 sysloghandler 类的形式 提 供
这 个模 块定 义了 以下 函 数 syslog
syslogpriority  message  将字符串 message  发送 到系统日 志 记录 器
 如 有必 要会 添加末尾换 行符
 每条 消息都带有 一 个由 facility 和 level  组 成的 优 先级标 价签
 可选 的 priority  参数默认 值为 loginfo  它确 定消 息 的 优先级
 如果 未在 priority  中使用 逻辑 或 loginfo  loguser 对 facility 进 行编码则会 使用 在 openlog 调用 中所给定的 值
 如果 openlog  未 在 对 syslog 的 调用之 前 被调用 则将 不带参 数 地调用 openlog
 引 发 审计 事 件 syslog
syslog 使 用参数 priority  message
openlogident  logoption  facility  后 续 syslog 调用 的日 志选项可以 通过 调 用 openlog 来 设 置
如果日 志当 前未 打 开则 syslog  将 不带参数 地 调用 openlog
可选的 ident  关键字 参 数是在 每条消 息前 添加 的字符 串默 认为 sys
argv 0 去除 打头的 路 径部 分
 可 选的 logoption  关键 字 参数 默认 为0是 一 个位 字 段请 参见下文 了 解可能的 组合 值
可选的 facility  关 键字参数 默 认为 loguser 为没有 显式 编 码 facility 的消息设 置默 认的 facility
 引发 审计 事件 syslog
openlog  使用 参数 ident  logoption  facility
 在3
2 版 更 改 在之 前的 版本 中不 允 许关键字参 数并且要求必须有 ident
 ident  的 默认值依 赖于 系 统 库 它 往 往 为 python 而不 是 python  程 序文件 的 实 际名称
closelog  重 置 日志模 块 值并 且 调 用系统 库 closelog
这 使得 此 模 块 在初始 导 入 时 行为固 定
例如 openlog 将在 首 次 调用 syslog 时 被 调 用 如果 openlog 还 未 被 调用过 并 且 ident  和其他 openlog  形 参 会被重 置 为 默 认 值
 引 发 一 个 审 计 事件 syslog
closelog  不附 带任 何参数
setlogmaskmaskpri  将优 先 级 掩 码设 为 maskpri 并返 回之前 的 掩 码值
 调 用 syslog  并 附 带未在 maskpri  中 设 置 的优先 级 将 会被忽 略
 默 认设置 为 记 录所有 优 先 级
函数 logmaskpri  可 计 算单个 优 先 级 pri 的掩 码
函数 loguptopri 可 计 算 包括 pri 在 内 的 所有优 先级的掩 码
引发 一个审 计 事 件 syslog
setlogmask 附 带参 数 maskpri
此模块定 义了 一 下 常量 优先 级 级 别高 到 低 logemerg  logalert  logcrit  logerr  logwarning  lognotice  loginfo  logdebug
设 施 logkern  loguser  logmail  logdaemon  logauth  loglpr  lognews  loguucp  logcron  logsyslog  loglocal 0 to  loglocal 7如 果 syslog
h 中 有定义则 还有 logauthpriv
 日 志选 项 logpid  logcons  logndelay 如果 syslog
h  中有定义则 还 有 logodelay  lognowait  以及 logperror
 示例
 简单 示例
 一个 简 单的 示 例 集 import  syslog  syslog
logerr  processing  started 一 个 设 置 多种日 志 选项 的 示例 其中有 在日 志 消 息中包 含 进 程 id 以及 将消 息写 入用于邮 件日 志记 录 的目 标设 施等 syslog
tabnanny  模糊 缩 进检 测
源代码 libtabnanny
py  目前 该 模块 旨在 作 为脚本调 用
 但是可 以使 用下 面 描述 的 check  函数 将 其导入 ide
 注解 此 模块 提供 的 api 可 能 会在 将 来的 版 本中更 改 此 类 更改可 能无 法 向后 兼 容
checkfileordir 如 果 fileordir  是目 录 而非 符号 链接 则递 归地在 名为 fileordir  的目 录 树中 下行 沿途 检 查 所有
py 文 件
如 果 fileordir 是一 个普 通 python 源文 件将 检查 其 中的 空格 相关问题
 诊断 消息 将 使用 print 函数 写入 到 标准 输出
verbose 此旗标指 明是 否 打 印详 细 消息
如果 作 为脚 本调用 则是 通 过 v 选项来 增 加
filenameonly 此 旗标指 明 是否只 打 印 包含 空格相关问题文件 的文 件名
 如 果作为 脚本 调用则是 通 过 q  选项 来 设 为真值
nannynag  如 果 检测到 模糊 缩 进 则 由 processtokens  引发
在 check  中 捕 获 并处理
processtokenstokens  此 函 数由 check 用 来 处 理 由 tokenize 模块 所 生 成 的标记
 参 见 模块 tokenize 用 于 python 源代 码的词 法扫描 程序
tarfile 读写 tar 归档 文件
tarfile  对象
tarinfo  对象
 命令 行界面
3
4 新 版 功能
tarfile  模块 提供 了 简单 的命 令行 接口 以便 与 tar 归 档 进 行交 互
 如果 你想要 创建一 个 新的 tar 归 档请 在 c 选 项后 指定 其名 称然后列出 应 当被包 含的 文件名 python  m  tarfile  c  monty
txt 传 入 一个 字 典也 是可 接 受的 python  m  tarfile  c  monty
tar  lifeofbrian 1979 如 果你 想 要将一个 tar 归 档 提取 到指 定 的目 录请使用 e 选 项 python  m  tarfile  e  monty
tar 你 也 可以 通过 传 入 目 录名称 将 一个 tar  归档 提取到不同 的 目 录 python  m  tarfile  e  monty
tar  otherdir 要 获取 一 个 tar  归档 中 文件 的列表请 使 用 l  选 项 python  m  tarfile  l  monty
命 令 行 选项
l  tarfilelist  tarfile  列出 一 个 tarfile 中的文件 名
 sourcen 基 于源文 件创 建 tarfile
e  tarfile  outputdirextract  tarfile  outputdir  如 果未 指定 outputdir 则 会 将 tarfile 提 取到 当 前目 录
t  tarfiletest  tarfile  检 测 tarfile 是 否 有效
v  verbose  更详细 地输 出结 果
示 例
如何 将整 个 tar  归 档提取 到 当 前工作目 录 import  tarfile  tar  tarfile
close 如 何通 过 tarfile
extractall 使用生 成器 函 数 而非 列 表来 提取 一个 tar  归 档 的子 集 import  os  import  tarfile  def  pyfilesmembers  for  tarinfo  in  members  if  os
close  如何 基 于一个 文件名列 表创 建 未压缩 的 tar  归档 import  tarfile  tar  tarfile
close  使用 with  语句的同一个示例 import  tarfile  with  tarfile
addname  如 何读取一 个 gzip 压 缩 的 tar  归 档 并 显 示一些 成 员信 息 import  tarfile  tar  tarfile
close  如何 创建一个 归档 并 使用 tarfile
add 中的 filter 形 参 来重 置 用户 信 息 import  tarfile  def  resettarinfo  tarinfo
 受支 持 的 tar 格 式
通 过 tarfile 模 块 可以 创 建三 种 tar 格 式 the  posix
11988 ustar 格 式 ustarformat
 它支 持 最 多256个字 符 的 文件名 长 度 和最多100 个 字符 的 链 接名长 度
 文 件大小 上限 为8 gib
这 是一种老 旧但 广受支 持的 格式
 gnu  tar 格式 gnuformat
它 支持 长文件名 和链 接名、大于8 gib  的文件 以及稀 疏文件
 它 是 gnulinux 系 统上的 事 实标 准
 tarfile  完 全 支持 针 对长 名称 的 gnu  tar  扩展稀 疏文 件支 持则 限制为 只读
 posix
12001 pax 格式 paxformat
 它是 几乎 无限 制的 最灵 活 格 式
 它 支持 长文 件名 和链接 名大文 件以 及使 用便 捷方 式 存储路径名
 现 代 的 tar 实 现 包括 gnu  tar  bsdtarlibarchive 和 star  完 全支 持扩 展 pax  特 性某 些老 旧或 不维护的库 可能不 受 支 持 但 应 当 会将 pax 归 档视 为广 受支 持的 ustar 格 式
 这 是目 前新 建 归 档 的 默 认格 式
 它 扩展 了 现有的 ustar 格式包 括 用 于无 法以 其 他方 式 存储 的附 加标头
 存在 两 种形 式的 pax  标头 扩展 标头 只 影 响 后 续的 文件 标头全 局标头 则适 用 于 完整归 档并 会 影响 所有 后 续 的 文件
 为 了 便于移 植在 pax 标 头 中 的 所 有 数 据 均 以 utf 8 编 码
 还有一 些 tar 格式 的其 他变种 它 们可以 被读 取但 不能 被 创 建 古 老 的 v 7格式
 这是来自 unix 第 七版 的 第一个 tar 格 式它 只存储常 规 文件 和 目录
 名称 长 度 不能 超过100 个字 符并 且 没 有 用户 分 组名 信 息
某些 归 档在带 有非 ascii  字符 字段 的情 况 下 会产 生计 算错 误的 标 头 校验 和
 sunos  tar  扩 展 格式
 此 格 式是 posix
12001 pax  格式的 一 个变 种但并 不保 持兼 容
unicode  问 题
 最初 tar 格 式被设计用 来 在 磁带 机上 生 成备 份主 要 关 注 于保 存 文 件 系统信 息
 现在 tar  归档通 常 用 于 文 件 分 发和在 网 络上 交换 归 档
最 初 格式 它 是 所 有 其他 格 式 的基 础的一 个问题 是它没有 支 持 不同字 符编码格 式的 概念
例 如一 个在 utf 8 系统 上创 建的 普通 tar  归档 如果 包含 非 ascii 字符则 将无法在 latin 1 系统 上被正确读 取
文本 元数 据例 如文 件 名链 接 名用 户 分组 名 将变 为损 坏 状态
 不幸 的 是没有什么 办 法能 够 自 动检测一 个归 档 的编码 格式
 pax  格式 被 设计用来解 决 这 个问 题
 它使用通用 字 符 编码 格式 utf 8来 存储 非 ascii 元 数 据
 在 tarfile 中 字 符转换 的细 节由 tarfile  类的 encoding  和 errors 关 键 字参 数 控 制
encoding  定义了 用 于归 档中 元数 据的字 符 编码 格式
 默 认值 为 sys
getfilesystemencoding  或是 回退 选项 ascii
根 据归 档 是被 读取还是被 写入元 数 据 必 须 被解码 或编 码
如 果 没有 正确设置 encoding 转 换可 能会失 败
errors 参 数 定义 了 不能被 转换 的 字 符将 如 何 处 理
可 能的 取值在 错 误 处 理 方案 小节列 出
默认方 案为 surrogateescape  它 也被 python  用于文 件系 统调 用 参见文 件名 命令 行 参数 以及 环 境变 量
 对于 paxformat  归 档默认 格式 encoding  通常是 不必要 的因为所 有元 数据 都使 用 utf 8 来 存 储
 encoding 仅 在 解码 二进制 pax  标头 或 存 储 带有替 代字 符的 字 符 串 等 少 数场 景 下 会 被 使用
telnetlib  telnet  client
 在3
6 版更 改 context  manager  support  added 参 见 rfc 854 telnet  protocol  specification  definition  of  the  telnet  protocol
telnet  objects
close 关 闭连接对象
 在3
3 版更 改 this  method  used  to  raise  socket
error  which  is  now  an  alias  of  oserror
telnet  example
tempfile  生成 临 时文 件和目录
 示 例
以 下 是 tempfile  模块 典 型用 法的一 些示例 import  tempfile  create  a  temporary  file  and  write  some  data  to  it  fp  tempfile
已 弃 用 的函数 和 变 量
创建 临时文 件有 一 种 历 史方法首 先使 用 mktemp 函数 生成 一个 文件 名 然 后使 用 该文件 名创 建文 件
 不幸 的是这 是 不 安全的因 为 在调用 mktemp  与随 后 尝试 创建文 件的 进 程 之间的 时间 里 其他 进 程 可 能会 使用 该名 称创 建 文件
解 决 方 案是将 两个 步骤 结合 起 来立 即创 建文 件
 这 个 方 案目 前 被 mkstemp 和 上述 其他 函数所采 用
mktempsuffix  prefixtmp  dirnone 2
3版 后已 移 除 使用 mkstemp  来代 替
 返 回 一 个 绝对路径 这个 路 径指向 的文 件在 调 用本 方法 时不 存 在
prefix 、 suffix 和 dir  参 数与 mkstemp  中的 同 名参 数 类似 不同 之处在 于不 支持 字 节 类 型 的文件 名不 支 持 suffixnone 和 prefixnone
警 告使 用 此 功能可 能会在 程 序中引 入 安全漏 洞
当 你 开始使用 本 方法返回 的 文 件执 行任 何 操作 时 可 能有人 已 经 捷足 先登了
mktemp  的 功能可 以 很 轻松 地 用 namedtemporaryfile  代替 当然 需 要 传递 deletefalse  参数 f  namedtemporaryfiledeletefalse  f
termios  posix  风格 的 tty 控制
 此模 块 提供 了 针 对 tty  io 控制 的 posix  调 用 的 接口
有关 此类 调 用的 完整 描 述 请参 阅 termios 3 unix 指 南 页
它 仅在当 安装 时 配置 了支 持 posixtermios 风 格的 tty  io  控 制的 unix  版 本上 可 用
 此模块 中 的 所有函 数均 接受一 个文 件 描述符 fd  作为 第一 个 参数
 这 可以 是一个 整 数形 式的 文 件描述 符 例 如 sys
fileno 所 返 回 的 对象 或是一 个 file  object 例 如 sys
stdin  本 身
这 个模 块还 定义 了与 此 处所提 供的 函数一 起使 用 的所 有必 要 的常量 这 些 常量 与 它 们 在 c 中 的对应 常量 同 名
 请参 考 你 的系统 文档了 解有 关如 何使 用这 些终 端 控 制 接口的 更 多 信息
 这 个模 块 定义 了 以下 函数 termios
tcgetattrfd  对 于文 件 描 述 符 fd 返回 一个 包含 tty 属 性 的 列 表形式 如下 iflag  oflag  cflag  lflag  ispeed  ospeed  cc 其 中 cc 为 一 个 包含 tty  特殊 字符的 列 表每 一项 都是 长度为1 的 字 符串 索 引 号为 vmin 和 vtime  的 项除 外这些 字段如 有定 义则应 为整 数
 对 旗 标和速 度 以及 cc  数组 中索 引的 解 读必须使用 在 termios 模块 中定 义 的 符 号 常量 来 完 成
tcsetattrfd  when  attributes 根 据 attributes  列表设 置文 件描述 符 fd  的 tty 属 性该 列表即 tcgetattr  所返 回的 对象
 when  参数 确定 何 时 改 变属性 tcsanow  表示立 即 改 变 tcsadrain 表 示在传 输所 有队列 输出后再 改变 或 tcsaflush 表 示在传 输所有 队列 输出 并丢 失 所 有 队 列输 入后 再改变
tcsendbreakfd  duration  在文件描 述 符 fd  上发 送一个中 断
 duration  为 零 表示 发送 时长 为0
5秒的 中断 duration  非 零值 的含 义取 决 于 具体 系统
tcdrainfd  进入 等待 状态 直到 写入文 件描 述符 fd  的所有 输出都 传送 完毕
tcflushfd  queue  在文 件描 述符 fd 上 丢弃队列 数 据
 queue  选择器 指 定 哪 个队 列 tciflush 表 示输 入队 列 tcoflush 表 示输 出队列 或 tcioflush  表示 两个队 列 同时
tcflowfd  action  在 文件 描述 符 fd 上 挂 起 一战 恢 复 输 入 或 输 出
 action 参 数 可 以 为 tcooff  表示 挂起 输出 tcoon  表示重 启输 出 tcioff 表 示挂 起 输入 或 tcion 表 示重 启 输入
 参见 模块 tty  针对 常用 终端 控制 操作 的便 捷 函数
 示例
 这个函 数 可 提示 输入密 码 并且 关闭 回显
请 注意 其采 取 的 技 巧是 使用 一个 单独的 tcgetattr  调用 和 一个 try 
 finally 语 句 来确保 旧的 tty 属性 无 论 在何种 情况下都会被原样 保存 def  getpasspromptpassword  import  termios  sys  fd  sys
test  python 回归测试 包
注 解 the  test  package  is  meant  for  internal  use  by  python  only
参见 模 块 unittest 编写 pyunit  回归 测 试
 unittest 文档 测试 tests  embedded  in  documentation  strings
writing  unit  tests  for  the  test  package
参见 test  driven  development  a  book  by  kent  beck  on  writing  tests  before  code
running  tests  using  the  commandline  interface
 文本处理 服务
 本 章 介 绍的 模 块提供 了 广 泛的字 符 串操 作 和 其他文本 处理 服 务
 在 二 进 制 数据 服务 之 下 描 述 的 codecs  模块 也与 文本 处理高 度 相关
 此外也请 参 阅 python  内 置字 符串 类 型 的 文 档文本 序 列 类型 str
 string 常 见的字 符串 操作字 符 串常量 自定义字 符 串格式 化格 式 字符 串语法 格式 规 格 迷你语 言格 式示 例 模 板字符串辅 助 函 数 re 正 则 表 达 式操作 正 则 表 达式语法 模 块内容正 则表 达式 对 象 正则对 象 匹配对象 正 则表 达式 例 子检查 对子 模拟 scanf  search  vs
 match  制作 一个电 话 本文 字整理 查找 所 有副 词查找所有 的副 词及 其 位置 原 始字符 串标 记写一 个词 法分析 器 difflib 计 算 差 异的辅 助 工 具 sequencematcher 对象 sequencematcher  的 示例 differ  对象 differ 示例 difflib 的 命令 行接 口 textwrap 文 本 自动换 行与填 充 unicodedata  unicode  数据库 stringprep  因 特网字 符串 预备 readline  gnu  readline  接 口 初始 化 文 件 行缓冲 区 历史 文件 历 史列表 启 动 钩子 completion  示例 rlcompleter  gnu  readline  的 补全函 数 completer  对 象
textwrap  文本自 动 换 行与 填 充
源 代 码 libtextwrap
pytextwrap 模 块 提 供 了 一些 快捷函 数以 及可以 完成 所 有工作 的 类 textwrapper
如 果 你 只是要 对 一 两个 文本字 符串进行 自动换 行或 填充 快 捷函数应 该就够 用 了否则的 话 你 应该使 用 textwrapper  的 实例来提 高 效率
wraptext  width 70 kwargs  对 text  字符 串 中的单 独段落自 动 换行 以使 每行 长 度 最多 为 width  个 字符
返 回由 输 出行 组成 的列表 行 尾不 带 换行符
 可选 的关键 字参数对 应于 textwrapper  的 实 例属 性具体文 档 见下
 width  默 认为70
请 参 阅 textwrapper
wrap  方 法了 解 有 关 wrap  行为 的详 细 信 息
filltext  width 70 kwargs  对 text 中 的 单 独 段落 自 动换行 并返 回 一个 包含被自 动换 行 段落 的单 独 字 符 串
 fill 是以 下语 句的 快捷 方式 n
 特别 要 说明的 是 fill 接 受与 wrap  完全 相 同 的 关 键字 参数
shortentext  width  kwargs 折叠并 截短 给定 的 text 以 符合给定 的 width
 首 先将折叠 text 中的 空格所有 连 续 空 格替 换 为 单个 空 格
 如 果 结 果 能适 合 width 则 将其 返 回
 否 则 将 丢弃 足够 数 量 的末 尾单 词以 使得剩余单 词加 placeholder  能适合 width  textwrap
 可选 的关 键字参 数对 应 于 textwrapper 的 实 际属 性 具 体见下 文
 请 注意 文 本 在被 传 入 textwrapper  的 fill 函 数之 前 会 被 折 叠 因 此 改 变 tabsize  expandtabs  dropwhitespace  和 replacewhitespace 的值将 没 有 任 何 效果
3
4新 版功 能
dedenttext 移除 text  中 每 一 行 的任 何 相 同 前 缀 空 白 符
 这 可以 用 来 清 除三 重 引 号 字符 串 行 左侧空 格而 仍 然 在 源 码 中 显 示 为 缩 进 格 式
 请 注 意 制 表 符 和 空 格 符 都 被视为 是 空白 符 但它 们 并 不相 等 以下 两 行 hello 和 thello  不 会被 视 为 具 有 相同的 前缀 空白符
 只 包 含空 白符的 行会 在输 入时 被忽 略 并 在输 出 时 被标 准化 为 单个 换 行符
 例如 def  test  end  first  line  with  to  avoid  the  empty  line  s  hello  world  printreprs  prints  hellon  worldn  printreprdedents  prints  hellon  worldntextwrap
indenttext  prefix  predicatenone 将 prefix  添加 到 text 中选 定行的 开 头
通过 调 用 text
splitlinestrue 来 对 行进 行 拆 分
 默 认情况 下 prefix  会被添 加 到 所有不 是只 由空白 符包 括任何 行 结 束 符组成 的 行
例 如 s  hellonn  nworld  indents  hellonn  n  world 可 选 的 predicate 参 数 可 用 来控制 哪 些 行要缩 进
例 如 可以 很 容易地为 空行 或只有 空白 符的 行添 加 prefix  printindents  lambda  line  true  hello  world 3
3新 版功 能
wrap  fill  和 shorten 的 作用 方式 为创 建 一 个 textwrapper  实 例并在其上 调 用单 个 方法
 该 实例 不 会 被 重用因 此对 于要 使用 wrap 和或 fill 来 处理 许 多文本 字 符串 的应 用来 说创 建你 自 己的 textwrapper  对象 可 能 会更有 效率
 文 本最 好 在空 白符 位置 自动 换行 包括 带 连字符 单 词 的连字 符之 后长 单词 仅 在 必要 时会 被 拆分 除 非 textwrapper
breaklongwords 被 设为 假值
textwrapperkwargs  textwrapper 构 造 器 接受 多个 可选 的关键字 参数
 每个 关键 字参 数 对应 一 个 实例 属 性比 如说 wrapper  textwrapperinitialindent  就相当于 wrapper  textwrapper  wrapper
initialindent  你可 以 多次 重用 相 同 的 textwrapper  对象 并 且你 也 可 以 在使用 期间 通 过 直接向 实 例 属 性赋 值 来修 改它的任 何选 项
 textwrapper 的 实 例属性以 及构 造器 的关 键字参数 如下 所 示 width 默 认70自动 换行 的 最大 行 长度
只 要输 入文 本中 没有 长于 width  的单 个 单词 textwrapper  就能 保 证 没有长 于 width 个 字 符的 输出 行
 expandtabs 默 认 true 如 果为真 值则 text  中 所 有的 制表符将 使 用 text 的 expandtabs  方 法 扩展 为空 格符
 tabsize 默认8 如果 expandtabs  为真值 则 text  中所有 的制表符 将 扩展为零 个 或多个空 格 具 体取决 于当 前 列 位置和 给定的 制表 宽度
3
3 新版功 能
 replacewhitespace  default  true  如 果为真 值 在制表 符扩 展之后、自动 换 行 之 前 wrap 方法 将 把 每个空 白 字 符 都替换 为单个 空格
 会 被替 换 的 空白字 符如下 制 表换行 垂 直 制 表进 纸和 回 车 tnvfr
 注解如 果 expandtabs 为 假值且 replacewhitespace 为 真 值每 个制表 符将被 替换为单个 空格 这 与制表符扩展 是不一 样的
 注 解如 果 replacewhitespace 为 假值在 一行 的中 间有 可 能 出现 换 行 符 并导 致怪异 的输 出
因 此文本 应 当 使用 str
splitlines 或 类 似 方 法拆 分为段 落 并分 别进行 自 动换行
 dropwhitespace  默认 true  如 果 为真 值 每一 行 开头 和末 尾 的空白 字 符在 包装 之后、 缩进之 前会 被丢 弃
但 是段 落开 头的 空 白 字符如 果 后面 不带任 何非 空白字 符 则 不会 被丢弃
 如果 被丢 弃 的 空 白字 符占 据了 一 个整 行则 该整 行将被 丢 弃
 initialindent 默 认将 被添 加 到被自动换 行输出 内容的 第一 行 的字 符 串
 其长度 会 被计入 第一行 的长度
空字符 串不会被 缩 进
 subsequentindent  default 将 被添加 到被 自动 换行 输 出 内容除 第一行 外的 所有行 的 字符 串
其长 度 会被 计 入除 行 一 行外 的所 有行 的长 度
 fixsentenceendings 默 认 false 如 果 为 真值 textwrapper 将 尝试检 测句 子 结尾 并 确 保句 子间 总 是 以恰 好 两个 空 格 符分隔
 对 于 使用 等宽 字体的文 本来 说通常 都 需 要这 样
但 是 句子 检测 算法 并不完 美 它假 定句 子 结 尾 是一 个 小写 字 母加 字 符
或 中的 一个 并可 能带 有 字符或 最后 以 一个 空格 结束
 此算 法的 问 题之 一 是 它无法 区分以下文 本中 的 dr

和以 下 文本 中的 spot

 fixsentenceendings  默认 为假 值
 由于 句 子 检 测 算法 依 赖于 string
lowercase  来 确定 小 写字 母以 及 约 定在句 点 后 使用 两 个 空格 来 分 隔处于 同一行 的句 子因 此只适 用于英 语文 本
 breaklongwords 默 认 true 如果 为 真值 则长度 超过 width  的 单词将 被 分 开以 保 证 行的长 度不会超过 width
 如果为 假值超 长单 词 不 会被 分 开因 而 某 些行 的长度可 能 会 超过 width
超 长单词将被 单独作 为 一行 以 尽量 减少超 出 width 的 情况
 breakonhyphens  默 认 true  如果为 真 值 将 根据英语的惯例 首选 在 空白符和 复合词的 连字 符 之后自 动 换 行
如果 为假值 则只 有空 白符 会 被 视 为合适 的潜 在断 行 位 置 但 如 果 你 确实 不 希 望出现 分 开的单 词则 你 必须 将 breaklongwords  设 为假 值
之 前版本 的默 认行为 总 是 允 许分开 带 有连 字 符的单词
 maxlines  默 认 none 如 果 不 为 none 则 输 出内 容将 最多包 含 maxlines 行并使 placeholder  出 现 在输 出内容 的末 尾
3
4新 版 功 能
 placeholder 默 认
 该 文 本 将在输出文 本被 截 短 时 出 现在 文 本末 尾
3
4 新版 功能
 textwrapper 还 提 供 了一 些 公有 方 法类似 于 模 块层 级 的便 捷 函 数 wraptext  对 text  字 符串中 的单 独 段 落自动 换 行以 使 每行长 度 最多为 width 个字 符
所 有 自动 换行 选项 均 获取 自 textwrapper 实例的实 例属性
 返回 由输出 行 组 成的列 表行尾 不 带换 行符
 如 果 自 动 换行 输出结 果没 有任 何 内容则 返 回 空 列 表
 filltext  对 text  中 的单独 段 落自动 换行并 返回包 含被自 动 换 行段 落的 单 独字 符 串
threading 基 于 线 程的 并 行
线 程本地数 据
线程 本 地数 据是 特 定线 程的数 据
 管 理 线程本 地数 据只需 要 创建 一 个 local  或 者一个 子类型 的实 例并 在实例中 储 存属性 mydata  threading
x 1 在 不同 的 线程 中实 例的值 会 不 同
local 一 个代表 线 程本 地数据的 类
 更 多 相关 细 节 和 大 量 示 例参 见 threadinglocal  模 块 的文档
 线 程 对 象
 锁 对象
 原 始 锁是一 个在 锁定 时不 属 于 特定线 程 的 同 步 基 元 组 件
 在 python  中它 是能 用 的 最 低级 的 同步基 元组 件由 thread  扩 展 模 块 直接 实 现
原 始 锁 处于锁 定 或者非 锁定 两种 状态 之一
 它 被 创建时 为非 锁定 状态
 它有 两个基 本方 法 acquire 和 release 
当 状 态为 非锁定 时 acquire  将状态改 为锁 定并 立 即 返回
当 状态 是锁定时 acquire  将阻 塞 至其他线程 调用 release 将 其改 为 非锁定状 态 然 后 acquire 调用重置 其 为锁 定 状态并 返回
 release 只 在锁 定状态 下 调 用它 将 状态 改为 非 锁 定并立 即 返回
如果 尝 试释 放一 个 非锁定 的锁则 会 引发 runtimeerror   异常
锁 同 样支 持上 下文 管理 协 议
当 多 个线 程在 acquire  等 待状 态 转 变为 未锁 定 被 阻塞然 后 release 重 置状态 为未锁 定时只有一 个线 程能继续 执行 至 于 哪 个等待 线程 继续 执行没 有定 义并 且 会根据 实现而 不同
 所 有 方法的 执 行都是 原子性的
lock 实 现 原 始锁对 象 的类
一 旦 一个线程获 得 一个 锁会 阻塞随后 尝 试 获 得锁 的 线程 直到 它被释放 任何 线程 都可以 释 放它
 需 要注 意 的是 lock 其 实 是一个 工厂 函 数返 回平 台支持 的 具体锁类 中 最 有效的版 本 的 实例
 acquireblockingtrue  timeout 1可 以阻 塞 或非 阻塞 地获 得锁
当 调 用 时 参 数 blocking 设 置 为 true  缺 省 值 阻塞 直到 锁被 释放 然后 将锁 锁 定 并 返回 true 
 在 参数 blocking  被 设 置 为 false  的情 况 下 调用将不会 发生 阻 塞
 如果 调 用 时 blocking 设为 true  会 阻 塞 并 立即 返 回 false  否则将 锁锁 定 并返 回 true
当 浮点 型 timeout 参数 被 设 置为 正 值 调用 时 只要 无 法 获得锁 将最多阻塞 timeout  设定 的秒 数
timeout  参 数 被设置 为1时 将 无限等 待
 当 blocking  为 false 时 timeout 指定 的值将被忽 略
 如 果 成 功获得 锁则返 回 true 否 则 返 回 false 例 如发 生 超 时 的 时 候
在3
2版 更改新 的 timeout 形 参
 在3
2版 更 改 现在 如果 底层 线程 实 现支持 则可以 通过 posix 上 的 信 号中 断锁 的获 取
 release  释放 一 个 锁
这 个方 法 可 以在 任 何 线 程 中调用 不单 指获 得锁 的 线程
 当 锁被 锁 定 将它重 置 为 未锁定 并返 回
如 果 其 他线 程正在等 待 这 个锁解 锁而被阻塞 只允 许 其 中一个 允 许
在未 锁定的锁 调 用时 会引发 runtimeerror  异常
 没有 返 回 值
 locked 如果 获 得 了锁则返 回真 值
递归 锁对 象
重入锁 是 一个 可以 被 同 一个 线程 多次 获取 的同步基 元 组 件
在内 部它在基元 锁的锁定 非锁 定状态上 附 加 了 所属线 程 和 递归等 级的概念
 在 锁定 状 态下 某些线程 拥 有锁 在非 锁 定状 态下 没有 线程拥 有它
若要 锁定锁 线程调 用 其 acquire 方 法一旦线 程拥有了 锁方 法将 返 回
 若 要解 锁 线程 调 用 release 方 法
 acquirerelease 对 可 以 嵌套 只 有 最 终 release  最 外面 一对的 release  将 锁解 开 才能让 其他线 程 继 续 处理 acquire 阻塞
 递归 锁也 支持 上 下 文管 理 协议
rlock  此 类实 现了 重入 锁 对 象
重 入 锁 必须 由 获 取它 的 线 程 释 放
一 旦线 程获 得了 重入锁 同 一 个线 程再 次获 取它 将不 阻塞 线 程必 须 在每 次 获取 它时 释放 一 次
 需要 注 意的是 rlock 其 实 是一 个工厂 函 数返 回平 台支 持 的 具体递 归锁 类中最 有效的 版本 的实 例
 acquireblockingtrue  timeout 1可 以 阻 塞 或 非阻塞 地获 得锁
 当无 参 数调 用 时如 果 这个 线 程已经 拥有锁 递归 级别增 加 一 并 立 即返回
 否 则如果 其 他 线程拥有 该锁则 阻塞 至该 锁解锁
 一 旦 锁被 解锁 不 属 于任 何 线 程则抢 夺 所 有权设 置 递归等 级 为一 并 返回
 如果 多 个 线程被 阻塞 等 待锁 被 解锁 一次只有 一 个线 程能 抢 到 锁的所 有权
 在这种 情况 下没 有 返回值
 当发 起调 用时 将 blocking  参数设 为真 值则执行 与 无参 数调 用 时 一 样的操 作然后返回 true
 当 发起 调 用 时将 blocking  参数设 为假 值则 不 进行阻 塞
 如果 一 个 无参数 调用 将 要阻 塞则 立即返 回 false 在 其他情况下 执行与无 参 数调 用 时 一 样 的操 作然 后 返回 true
 当发起调 用时将浮 点 数的 timeout 参 数 设为 正 值时 只 要无 法 获得锁 将 最 多阻 塞 timeout 所 指 定的 秒数
如果 已 经 获得锁 则 返 回 true 如 果 超时则 返回 假值
在3
2 版 更改 新 的 timeout 形参
 release  释放 锁 自减递 归 等 级
如果 减到零则 将锁 重置 为 非 锁定状 态不被 任何 线程 拥 有 并且 如 果 其他线 程正被阻 塞 着 等待锁被解 锁 则 仅允许 其 中 一 个 线程继 续
如果自 减后 递 归等 级仍然 不 是 零则 锁保持 锁 定仍 由调用 线 程拥 有
只有 当前 线 程 拥有锁 才 能 调用这 个方 法
如 果锁 被释放 后调用 这 个方 法 会 引起 runtimeerror 异 常
 没 有返回 值
条件 对象
 条 件 变量 总 是与 某 种 类型 的锁对 象相关 联 锁对象可以 通 过传 入 获得 或者 在缺省 的情况 下 自动 创建
 当 多个 条 件 变量需 要 共享 同一 个 锁 时传 入 一 个锁很 有用
锁 是 条件 对象 的 一部分 你 不 必 单独 地 跟 踪它
条 件变量遵循 上下 文 管 理协 议使 用 with 语 句会在它 包 围 的代码块内 获取关 联的锁
 acquire  和 release 方法也 能 调用 关 联 锁的 相关方法
 其它 方 法必 须 在 持 有 关联的锁 的 情 况下调用
 wait 方 法 释 放锁然 后阻塞直 到 其 它线程 调用 notify 方法 或 notifyall 方 法唤醒 它
 一旦被 唤醒 wait  方法 重 新获 取锁 并 返 回
它也 可以 指 定 超 时时 间
注 意 notify  方法和 notifyall  方法并 不 会释放锁 这意 味着 被 唤 醒 的 线程不 会立即从它 们的 wait  方法 调用 中 返回 而 是会 在调用 了 notify 方 法或 notifyall  方法 的线程最 终 放弃 了 锁的 所 有 权后返 回
使用条件 变量 的典 型 编 程风 格是将 锁用 于 同 步 某些 共 享状 态的 权 限那 些对 状态 的 某些 特定 改变 感兴 趣的线 程它 们重复调 用 wait  方 法直到 看到所 期望 的改 变 发 生 而对 于 修改 状态的 线程它 们将 当 前 状态改 变为可 能 是等待者 所 期 待的 新状 态后调 用 notify  方 法或者 notifyall  方 法
 例如下 面的 代 码 是 一个通 用 的 无 限缓冲 区容 量 的 生产者 消 费 者情形 consume  one  item  with  cv  while  not  anitemisavailable  cv
notify  使 用 while 循 环 检 查所要 求 的条件成立 与否 是 有 必要的 因为 wait  方法 可能要 经过不 确定长度 的 时间 后才 会返回 而此 时导 致 notify  方 法调 用的那 个条 件 可能已经不 再成立
 这 是多 线程 编程 所固有 的 问题
 waitfor  方 法可 自动 化条 件 检查 并 简 化超 时计 算
 consume  an  item  with  cv  cv
waitforanitemisavailable  getanavailableitem  选择 notify 还 是 notifyall  取决 于 一次状态改 变是只 能被一 个还 是能 被多 个 等 待线 程 所用
 例 如 在一 个典型的 生产 者 消费 者情 形中添 加一 个 项目 到缓 冲区 只需 唤醒 一 个消费 者线 程
class  threading
conditionlocknone 实现 条件变 量 对 象的 类
 一个条件 变 量对象 允 许一 个或 多个 线 程在 被 其它线 程所通 知之 前进行等 待
如 果 给 出了非 none  的 lock 参数 则 它 必须 为 lock  或 者 rlock 对 象并 且 它 将被用 作底 层锁
 否则 将会 创 建 新的 rlock  对象并将 其用 作底 层锁
 在3
3版 更改 从 工 厂函数 变为 类
 acquireargs  请求 底层 锁
 此方 法调 用底 层锁的相 应 方 法返回 值是 底 层 锁 相应方法 的 返回 值
 release 释 放底 层锁
此 方 法调 用底层锁 的 相 应方法
 没 有返 回 值
 waittimeoutnone 等待直 到 被 通 知或 发生超时
 如 果 线程在 调用 此方 法时没 有 获 得 锁将会 引发 runtimeerror  异 常
 这个 方法 释放 底 层 锁 然后阻塞直到 在 另外 一个 线程 中调 用同 一 个 条件变 量的 notify 或 notifyall 唤 醒它 或者 直 到 可 选的 超时 发 生
一 旦 被唤 醒或者超 时它 重新获得 锁并返回
当 提供 了 timeout 参 数 且 不 是 none 时它 应该是一个 浮点 数 代 表操 作 的 超时时 间 以秒 为单 位可以 为 小数
当 底层 锁 是 个 rlock 不 会使用它 的 release 方 法释 放锁 因为 当 它 被递 归 多次 获取 时实 际 上可 能无 法解 锁
 相反使 用了 rlock 类 的内部接 口 即 使 多 次 递 归获取 它也能解 锁它
然 后在重新获 取锁 时 使 用另 一个 内部 接 口来 恢复 递 归级 别
返回 true  除非 提 供的 timeout  过 期这 种情况 下 返 回 false 
在3
2 版 更 改很 明 显方 法 总 是返 回 none
 waitforpredicate  timeoutnone 等 待 直 到条件 计算为真
 predicate  应该是 一个可 调用 对 象而 且它 的返回值 可 被解 释为 一 个 布 尔值
 可以 提供 timeout  参数 给 出 最大 等待时 间
这个实 用 方 法会重 复地 调 用 wait 直 到满 足判 断式 或者 发 生超 时
返 回值 是判 断式 最 后一 个返 回值 而 且如 果 方法发 生超 时会返 回 false 
忽 略超时功 能调用此方 法大 致 相当 于 编写 while  not  predicate  cv
wait 因 此 规则 同 样适 用于 wait  锁 必须 在 被调 用 时 保 持 获取 并 在 返 回 时重 新获 取
随着 锁定执 行 判断式
3
2 新版 功能
 notifyn 1 默认 唤 醒 一 个等待 这 个条 件的 线 程
 如 果调用 线 程在 没 有获 得锁 的情 况下 调用 这 个 方法 会引发 runtimeerror  异常
 这个 方 法 唤 醒 最多 n 个正 在等 待这个 条 件 变量 的线程 如果没 有线 程 在等待 这是 一个 空操作
 当前 实现中 如 果至 少有 n  个 线程 正在等待 准 确 唤醒 n  个 线 程
但是依 赖这 个行为 并 不安全
 未来 优 化 的 实 现 有 时会唤 醒超 过 n 个 线 程
 注 意被 唤醒 的 线 程实际上 不会 返 回 它调 用的 wait  直到 它 可以 重新 获得 锁
 因 为 notify 不 会释 放 锁 只 有 它的调 用者 应该 这样 做
 notifyall 唤 醒所有 正在 等待 这个 条 件 的线程
 这 个方 法行为与 notify  相似 但 并 不 只 唤醒单一 线 程 而 是唤 醒 所有 等 待 线 程
如 果调 用 线程在 调用 这 个 方法时 没有获 得锁 会引发 runtimeerror  异常
 信 号 量对象
semaphore  例 子
事 件 对 象
 这是线程 之间 通 信的 最简 单 机 制之一 一个 线程 发出 事 件 信 号 而 其 他 线程 等 待 该 信 号
 一 个 事 件对 象管 理 一 个 内 部标 识 调用 set  方 法可 将 其 设 置 为 true  调 用 clear  方法 可将 其设 置 为 false 调用 wait  方 法 将进 入 阻 塞 直 到标 识 为 true 
class  threading
event  实现 事件对 象的类
事 件对 象管 理 一 个内 部标 识调用 set  方 法可 将 其 设 置为 true
调用 clear  方法 可将 其 设 置为 false 
调 用 wait  方法将 进 入 阻塞 直 到 标 识为 true
 这个 标 识初 始时 为 false 
 在3
3版 更 改 从工 厂 函数 变 为 类
 isset 当且仅 当内 部 标识 为 true  时 返回 true 
 set 将 内 部标 识设置 为 true 
所 有 正在 等待 这个 事件 的 线 程将 被唤 醒
当标识 为 true  时调 用 wait 方 法的 线程 不 会 被被阻塞
 clear  将 内 部标 识设置为 false 
 之后调 用 wait  方 法 的 线程 将 会被 阻塞直到调 用 set 方 法 将 内部标 识再 次设 置 为 true 
 waittimeoutnone  阻塞线 程 直到 内部变 量为 true 
 如 果 调 用时内部 标 识 为 true  将立 即返 回
 否 则 将阻塞 线 程直 到调用 set 方 法将标 识设 置为 true 或 者发 生可选 的 超 时
当提供了 timeout  参数且 不 是 none  时它 应该 是一 个 浮 点 数代 表 操作 的超时时 间以 秒为 单 位 可以为 小数
 当且 仅当 内部 旗标在等 待调 用 之前或者 等待开 始之 后 被设 为真值 时此方 法将返 回 true  也 就是说 它将总 是 返 回 true  除非 设定 了超 时且操 作发 生了 超 时
 在3
1版更 改很 明 显方 法 总是 返回 none
定 时器 对象
栅 栏对 象
在 with  语 句中 使用 锁、条件和 信号 量
这 个 模块提供 的带 有 acquire 和 release  方法的 对象 可 以 被 用作 with  语句的 上下 文管理器
 当进入 语句 块 时 acquire  方法 会被 调用 退出 语句块 时 release   会 被 调 用
因此 以 下 片段 with  somelock  do  something
相 当 于 somelock
release  现在 lock 、 rlock 、 condition 、 semaphore 和 boundedsemaphore  对象可以 用作 with  语 句的 上下文 管理 器
time  时间的 访 问 和转 换
 函数
clock  id  常量
 时 区 常量
altzone  本 地 dst 时区 的偏移 量以 utc  为单位 的秒 数如 果 已定 义
如果当 地 dst  时 区 在 utc 以东 如在 西欧包括英 国则 是 负 数
 只 有当 daylight 非 零时 才使用 它
见下 面的 注释
daylight  如果 定 义 了 dst 时区 则为 非零
见下 面 的 注 释
timezone  本地非 dst 时 区的 偏 移 量 utc  以西的 秒 数西 欧 大 部分 地 区为 负美国 为正英国 为 零
 见 下 面 的 注 释
tzname 两 个字 符 串的 元组第一 个是 本 地 非 dst 时区 的 名 称第 二个 是本 地 dst 时 区的名 称
如 果未定 义 dst  时区 则不 应 使 用第二 个字符 串
见 下面 的注 释
 注解 对于 上 述 时 区常 量 altzone 、 daylight 、 timezone  和 tzname  该值 由模 块 加载 时有效 的时 区规 则确 定 或者 最后 一 次 tzset  被 调用时 并且 在过 去的 时 间可能 不正确
 建 议使 用 来自 localtime  结果的 tmgmtoff  和 tmzone  来 获 取时 区 信息
 参 见模块 datetime  更多 面向对 象 的 日期和 时 间接口
 模块 locale 国际 化服 务
 区域设 置会影 响 strftime  和 strptime  中 许 多格 式说明 符 的 解析
 模 块 calendar 一 般日 历相关 功能
 这 个 模块的 timegm  是 函 数 gmtime  的反函 数
 脚 注1 现 在不 推 荐使用 z 但是 所有 ansi  c  库 都 不 支持扩 展 为 首 选 小 时分 钟 偏 移量的 z  转 义符
此 外严格 的1982年原始 rfc 822标准 要 求 两位数 的 年 份 y 而 不是 y  但是实 际在2000年之 前很 久就转 移到 了4位 数 年
之 后 rfc 822已 经废 弃了4 位 数 的 年份 首先被推荐 rfc 1123 然 后 被 rfc 2822 强制 执行
timeit  测量 小代 码片 段 的 执 行 时间
 源 码 libtimeit
py 该 模 块提供 了一 种简 单的 方法来 计 算一小 段 python 代码 的 耗时
 它 有命 令 行 界面 以及 一 个可调用 方法
它 避 免了 许多 用 于测 量 执 行 时间 的 常 见 陷阱
 另见 tim  peters 对 oreilly  出版 的 python  cookbook 中 算 法 章 节的介绍
 基本 示例
以 下示 例 显 示 了 如 何使 用命令 行 界面 来比 较三个不 同的 表达 式 python 3 m  timeit 
2 usec  per  loop 这 可 以 通 过 python 接 口 实 现 import  timeit  timeit
23702679807320237从 python 接 口 还 可以 传 出一 个可 调用 对象 timeit
19665591977536678 但 请注 意 timeit 仅 在使 用 命令 行界 面 时 会自动确 定 重 复次 数
在 示 例一节你可 以 找 到更 多 的进阶示 例
python 接 口
 该 模块 定义了 三个 便利 函 数 和 一个公共类 timeit
timeitstmtpass  setuppass  timerdefault  timer  number 1000000 globalsnone  使 用给 定 语句、 setup 代码和 timer  函 数 创 建 一个 timer 实例并 执 行 number 次其 timeit 方 法
可选的 globals  参 数 指定用 于 执行 代码 的命名 空间
 在3
5版 更改 添 加 可选参 数 globals 
repeatstmtpass  setuppass  timerdefault  timer  repeat 5 number 1000000 globalsnone  使用 给 定语句、 setup  代 码和 timer  函 数 创建一 个 timer  实例并 使 用 给定的 repeat  计数 和 number  执行运 行 其 repeat 方 法
可 选 的 globals  参数指 定 用于 执行 代 码 的 命 名 空 间
在3
5 版 更改 添 加 可选参 数 globals 
 在3
7版更 改 repeat  的 默认值由3 更改为5
defaulttimer  默 认 的计 时器总 是 time
perfcounter 
 在3
3 版更 改 time
perfcounter 现 在 是 默认 计 时 器
timerstmtpass  setuppass  timertimer  function  globalsnone 用于 小代 码 片 段的计 数执行 速度 的类
 构造函 数 接 受一个 将计时 的 语句、一 个用 于设置 的附 加 语句 和 一 个 定 时器 函 数
两 个 语句都 默 认 为 pass  计时 器函 数 与 平台有 关 请 参阅 模块 文档 字 符串
 stmt  和 setup 也可 能包 含多 个 以或 换行 符 分隔的 语句 只 要 它们不 包含 多 行 字 符串 文 字 即 可
该语句 默 认在 timeit  的命 名空 间内 执 行 可 以 通过将 命 名 空间 传递 给 globals 来控制 此行 为
 要 测 量第 一 个语 句的 执行 时间 请 使用 timeit  方法
 repeat  和 autorange 方法 是方 便 的方 法 来调 用 timeit 多 次
 setup 的执 行 时间 从总 体计 时执行 中排除
 stmt  和 setup  参数也 可以 使用不 带 参 数 的 可调 用对 象
这 将在一 个计时 器函数 中嵌 入对 它 们的 调 用然 后由 timeit 执 行
 请 注 意 由 于 额外 的 函 数 调 用在 这 种 情 况 下计时 开销 会略大 一些
 在3
5版 更 改添加 可选参 数 globals 
 timeitnumber 1000000执 行 number  次主 要 语句
 这将 执 行 一次 setup  语 句然后 返 回执行 主 语句 多 次 所 需 的时 间 以 秒 为单位测 量 为 浮点数
 参 数是通 过 循环的 次数 默认为 一百 万
要 使 用的 主 语句、 setup 语句 和 timer 函数将 传递 给构 造函数
 注 解 默认 情况下 timeit 暂 时 关 闭 garbage  collection 
这 种方 法的优点 在于 它使独 立 时序更具可 比 性
缺 点是 gc  可 能 是 所测量 功能性 能的重 要组成 部分
 如 果是这 样 可以 在 setup 字 符串 中 的 第一个 语句 重 新启 用 gc
例如 timeit
timeit  autorangecallbacknone  自动决 定调 用多 少次 timeit 
 这 是一 个 便利 函 数 它 反复 调 用 timeit  以便 总时间0
2 秒返回 最 终循环次数 循环所 用 的时 间
 它 调 用 timeit 的 次 数 以 序列125102050
递 增直到所用 的时间 至少为0
2秒
 如 果给 出 callback 并 且 不 是 none  则 在 每次试验后 将 使 用两个 参数调 用它 callbacknumber  timetaken 
3
6 新 版 功 能
 repeatrepeat 5 number 1000000调用 timeit 几 次
这 是 一 个 方便的 函数 它 反 复 调用 timeit  返 回结 果列 表
第一 个 参 数 指定 调 用 timeit 的 次 数
第二 个 参 数指定 timeit  的 number  参 数
 注 解从结 果向 量 计算 并报告 平均 值和 标准 差 这 些 是很 诱人 的
但是 这不 是很 有用
 在 典 型情况 下最低 值 给 出 了机 器运 行给 定 代码 段的 速度 的 下 限结果 向 量中 较 高的 值 通 常 不是由 python  的速 度变 化引 起的 而是 由于 其 他 过 程干扰 你的计时 准确 性
 所 以结果 的 min 可 能 是 你 应 该感 兴趣 的 唯一 数字
之 后 你 应该看 看整 个 向量 并应 用 常识而不 是统计
 在3
7 版更 改 repeat  的 默 认值由3 更改为5
 printexcfilenone 帮助程 序从 计时 代码 中打 印回 溯
典 型 使 用 t  timer
printexc  与标准 回溯 相比优 势在于 将显 示 已 编 译 模 板 中 的源 行
可 选的 file  参数 指向发 送 回 溯的 位置 它默 认为 sys
stderr 
 命令 行界 面
从 命令 行调 用程 序时 使用 以下 表 单 python  m  timeit  n  n  r  n  u  u  s  s  h  statement 
 如果 了解 以下 选 项 n  n  numbern  执行 语 句 多 少 次 r  n  repeatn 重复 计 时器 的次 数 默认为5 s  s  setups 最初 要执行 一次 的 语 句默 认为 pass  p  process  测量进程时间而不 是 wallclock  时间使用 time
processtime  而不 是 time
perfcounter  这 是 默 认值3
3 新版 功能
u  unitu  指 定 定 时器 输 出的 时间 单 位 可以 选 择 nsecusecmsec 或 sec 3
5 新版 功 能
v  verbose 打印原始 计时 结 果重复更多 位数 精 度 h  help 打印一条 简短的使用 信息 并退 出 可以通过将 每 一行 指 定为单 独 的语 句参数来给 出多 行语句 通过 在引 号 中包含参数 并使 用 前导空格可 以缩 进行
 多 个 s 选项的处 理方 式相 似
如 果未 给出 n  则会 通过尝试按 序 列125102050
递增 的 数值 来计 算合适 的 循 环 次 数直到总计 时间 至 少 为0
2 秒
defaulttimer 测量 可能 受 到在 同 一台 机 器上 运行的 其他 程序的 影响 因此 在 需要 精确 计时时最 好的 做法 是 重复几次 计时 并使用 最 佳时间
 r  选项 对此 有利在 大多数 情况下 默认的5次重复 可能 就足 够了
你 可 以 使 用 time
processtime 来 测 量 cpu  时 间
注 解执 行 pass 语 句会 产生 一定 的基 线开销
这 里的 代 码 不 会 试图 隐藏 它 但 你 应该 知 道它
 可以通过不带 参数 调用 程序来测量基 线开 销 并且 python 版本之 间可 能 会有 所不 同
示 例
tk 图形 用户 界面 gui
tkintercolorchooser  颜色 选择 对话 框
源 代 码 libtkintercolorchooser
pytkinter
colorchooser 模块提供 了 chooser  类 作为原 生颜 色选 择对话 框 的 接口
 chooser  实现 了 一 个 模 式 颜 色 选 择对话框窗 口
 chooser 类继 承自 dialog 类
askcolorcolornone  options 创 建一个 颜色 选择对 话框
 调用此 方法 将显 示相 应窗 口等 待用户进 行 选择并 将 选择 的 颜 色或 none  返回 给 调用者
 参见 模块 tkinter
commondialog  tkinter 标准对话框模 块
tkinterdnd  拖放 操 作支 持
源代码 libtkinterdnd
py  注解 此模 块 是实验 性的 且在为 tk  dnd  所 替代 后将被 弃用
tkinter
dnd 模 块为单 个应 用内 部的 对象提 供 了 在同 一窗 口 中 或 多 个 窗口 间 的 拖放 操 作支持
要将对 象设 为可拖 放 你 必 须为 其创 建启 动 拖放 进程 的事件 绑定
 通常你 要将 buttonpress 事件绑定 到你 所编 写 的回调 函数 参见 bindings  and  events
该函 数 应当 调 用 dndstart 其 中 source  为要 拖动 的 对象 而 event 为发起调 用 的 事件 你的回调 函 数 的 参数
 目标对 象 的 选择 方式如 下1
从 顶至底地 在鼠 标 之 下的 区 域中 搜 索目标 控 件目 标 控件 应当具 有一个 指向 可调用 对象的 dndaccept  属性 如 果 dndaccept  不存 在 或是返回 none  则将转 至父控件中搜 索如 果目 标控件 未 找 到则 目 标 对 象 为 none 2
调 用 oldtarget
 调用 newtarget
 调用 target
dndcommitsource  event  来通 知 释 放5
调 用 source
dndendtarget  event 来 表 明 拖放 的 结 束 class  tkinter
dndhandlersource  event  dndhandler 类处 理拖放 事件 在事 件控 件 的 根 对象 上跟踪 motion  和 buttonrelease 事 件
 canceleventnone 取消 拖放 进程
 finishevent  commit 0 执行 结 束播 放函数
 onmotionevent  在 执行拖动 期 间 为目标对 象检 查 鼠 标 之 下 的区域
 onreleaseevent  当释放 模 式 被触发 时表 明 拖动的结 束
dndstartsource  event  用于 拖放进 程的 工 厂函数
参 见 bindings  and  events
tkinterfont  tkinter  字体 封装
tkintermessagebox  tkinter 消 息 提示
源 代码 libtkintermessagebox
pytkinter
messagebox  模块 提供了一个 模板 基类 以及 多 个 常用配 置的 便捷 方 法
消息框为 模式 窗口 并将 基于 用户 的 选择 返回 true  false  ok  none  yesno  的 一个子集
常 用消 息 框 风 格和 布局 包括 但 不限 于图片 class  tkinter
messagemasternone  options  创建一个默认信息 消 息框
信息 消息 框 tkinter
showinfotitlenone  messagenone  options  警 告 消 息框 tkinter
showerrortitlenone  messagenone  options 疑 问消息框 tkinter
tkinterscrolledtext  滚动 文 字控件
源代 码 libtkinterscrolledtext
pytkinter
scrolledtext  模块 提 供了一 个同 名 的类 实现 了 带有 垂直 滚动 条 并被 配置为 可以正 常 运 作 的文本控 件
使 用 scrolledtext 类会 比 直接 配置一 个 文本 控 件附加 滚动条 要 简单 得多
文 本 控 件与滚动 条 打 包在 一 个 frame 中 grid 方法 和 pack 方法的 布局管 理 器从 frame  对象 中获得
 这 允许 scrolledtext  控件 可以直 接 用于 实现 大多 数正 常的 布局 管理 行为
 如果 需要 更具 体的 控制 可 以 使用 以下 属性 class  tkinter
scrolledtextmasternone  kw  frame  围 绕 文本 和 滚 动 条 控件的 框 架
 vbar 滚 动条控 件
tkintertix  extension  widgets  for  tk
py 3
6 版后 已 移 除 this  tk  extension  is  unmaintained  and  should  not  beused  in  new  code
参 见 tix  homepage  the  home  page  for  tix
using  tix
tix  widgets
basic  widgets
file  selectors
hierarchical  listbox
tabular  listbox
manager  widgets
image  types
miscellaneous  widgets
form  geometry  manager
tix  commands
tkinterttk  tk  主 题部件
 源代码 libtkinterttk
参 见 tk  widget  styling  support  一 份文档 介 绍 tk 支持 的主 题
使 用 ttk
 开始 使用 ttk 导 入 模 块 from  tkinter  import  ttk 重 写基础 tk  控 件 导入 应跟 随 tk  导 入 from  tkinter  import  from  tkinter
 参见 converting  existing  applications  to  use  tile  widgets  a  monograph  using  tcl  terminology  about  differences  typically  encountered  when  moving  applications  to  use  the  new  widgets
ttk  控件
ttk 中有18种部 件其 中十 二种 已 存 在于 tkinter 中 buttoncheckbutton  entry  frame  label  labelframe  menubuttonpanedwindow  radiobutton  scale  scrollbar  以 及 spinbox
 另外 六 种 是新 增的 combobox  notebook  progressbar  separatorsizegrip  以及 treeview
 它们全 都 是 widget  的 子类
tk  代 码 l 1 tkinter
labeltexttest  fgblack  bgwhitettk 代 码 style  ttk
tlabel 有 关 ttkstyling 的 更 多信息请参 阅 style 类 文 档
控件
widget 定义 了由 tk  带主 题部 件所支 持 的 标准 选项和 方 法 它们 不应 该 被 直 接实 例化
标准选项
 所有 ttk 小部件接 受以 下选 项选 项描 述类 指定 窗 口类
 在查 询选 项 数 据库 中窗口 的其 他选 项时 使用 该 类确 定窗 口的 默认 绑定 标 签以 及选 择 控件 的默 认 布 局和 样式
 此 选 项仅 为 只读 并且 只 能在 创建窗 口 时 指定
 光标 指定要 用 于 控件 的 鼠标 光标
如果设置为空 字符 串默 认 值则为 父控 件继承光 标
 takefocus 确定 窗 口是 否 在键 盘 遍 历 期间接 受 焦点
 返 回0或1 返 回空 字 符串
 如 果返 回0 则 表 示在键 盘 遍 历 期间应 该 跳 过该窗 口
 如 果为1 则 表 示 只要 可 以 查 看窗 口 就 应该接 收 输 入 焦 点
并且 空 字 符 串意味 着 遍 历 脚 本决定 是 否 关 注窗 口
 风 格可 用 于指 定 自定 义 控件 样 式

 可 滚动控 件 选 项
 控件支 持 以 下选项 使 用 滚动条 控 制
 选 项描述 xscroll  命 令 用于与 水 平 滚动条 通 讯
 当视图 在 控 件 的窗口 改 变 控件将 会 基 于 scroll 命令 生 成 tcl  命 令
 usually  this  option  consists  of  the  method  scrollbar
 this  will  cause  the  scrollbar  to  be  updated  whenever  the  view  in  the  window  changes
 yscroll 命 令 用 于与垂 直滚动条 通讯
更 多信息请参 考 上 面 的 信 息

标 签选 项
以 下选 项支持 标 签按 钮已及其 他 类 按钮 的 控 件
选项 描 述 文本 specifies  a  text  string  to  be  displayed  inside  the  widget
文 本 变 量 specifies  a  name  whose  value  will  be  used  in  place  of  the  text  option  resource
 下划线 if  set  specifies  the  index 0 based  of  a  character  to  underline  in  the  text  string
 图 片 specifies  an  image  to  display
 valid  values  are  text  只显示 文本 image 只显 示图 片 top  bottom  left  right  分 别显示 图 片 的 上下左 右的 文 本
 none 默认
 如果设 置 显 示图片 否 则 文本
宽 度 if  greater  than  zero  specifies  how  much  space  in  character  widths  to  allocate  for  the  text  label  if  less  than  zero  specifies  a  minimum  width
兼容 性选项
选项描 述 状 况 may  be  set  to  normal  or  disabled  to  control  the  disabled  state  bit
控 件状 态
 控 件状 态 是 无 关状 态 标 志 的 位图
 标志描 述活动 the  mouse  cursor  is  over  the  widget  and  pressing  a  mouse  button  will  cause  some  action  to  occur  禁用在 程序 控制 下控 件是 禁用 的焦 点控 件 有 键 盘 焦点 按压 widget  is  being  pressed 选 择 on  true  or  current  for  things  like  checkbuttons  and  radiobuttons  背景 windows  and  mac  have  a  notion  of  an  active  or  foreground  window
 the  background  state  is  set  for  widgets  in  a  background  window  and  cleared  for  those  in  the  foreground  window 只读 widget  should  not  allow  user  modification  alternate  a  widgetspecific  alternate  display  format 无 效的 控件 的值是 无效 的 a  state  specification  is  a  sequence  of  state  names  optionallyprefixed  with  an  exclamation  point  indicating  that  the  bit  is  off
ttkwidget
 组 合 框
 选项
this  widget  accepts  the  following  specific  options 选 项描述 exportselection  boolean  value
状况 one  of  normal  readonly  or  disabled
 文本 变量 specifies  a  name  whose  value  is  linked  to  the  widget  value
值 specifies  the  list  of  values  to  display  in  the  dropdown  listbox
宽度 specifies  an  integer  value  indicating  the  desired  width  of  the  entry  window  in  averagesize  characters  of  the  widgets  font
 虚 拟事件
ttkcombobox
spinbox
选项
this  widget  accepts  the  following  specific  options  选项 描述 从 float  value
到 float  value
 增加 float  value
 值 sequence  of  string  or  float  values
格 式 string  value
 命令 python  callable
虚拟事 件
ttkspinbox
笔记本
 选项
this  widget  accepts  the  following  specific  options  选项 描述 height  if  present  and  greater  than  zero  specifies  the  desired  height  of  the  pane  area  not  including  internal  padding  or  tabs
宽 度 if  present  and  greater  than  zero  specified  the  desired  width  of  the  pane  area  not  including  internal  padding
tab 选 项
there  are  also  specific  options  for  tabs 选项描 述状 况 either  normal  disabled  or  hidden
 文本 specifies  a  text  to  be  displayed  in  the  tab
图片 specifies  an  image  to  display  in  the  tab
下 划线 specifies  the  index 0 based  of  a  character  to  underline  in  the  text  string
tab  identifiers
virtual  events
ttknotebook
progressbar
 选项
this  widget  accepts  the  following  specific  options 选项 描述 orient  one  of  horizontal  or  vertical
 模 式 one  of  determinate  or  indeterminate
值 the  current  value  of  the  progress  bar
ttkprogressbar
separator
选项
this  widget  accepts  the  following  specific  option 选 项描 述 orient  one  of  horizontal  or  vertical
sizegrip
platformspecific  notes
bugs
treeview
选 项
this  widget  accepts  the  following  specific  options 选项描 述 columns  a  list  of  column  identifiers  specifying  the  number  of  columns  and  their  names
item  options
选 项描 述文 本 the  textual  label  to  display  for  the  item
图 片 a  tk  image  displayed  to  the  left  of  the  label
值 the  list  of  values  associated  with  the  item
tag  options
the  following  options  may  be  specified  on  tags 选项 描述 foreground  specifies  the  text  foreground  color
 背 景 specifies  the  cell  or  item  background  color
 图片 specifies  the  item  image  in  case  the  items  image  option  is  empty
column  identifiers
 注释 items  option  values  may  be  displayed  in  a  different  order  than  the  order  in  which  they  are  stored
virtual  events
 event  描述 treeviewselect  generated  whenever  the  selection  changes
ttktreeview
 stretch  truefalse  指明 列 宽度 是否 应该 在部 件大 小 被改 变 时 进行相 应的 调 整
 width  width 以像素 表示 的列 宽 度
要 配置树的 列 则调用此 方 法并 附带 参 数 column 0 deleteitems  delete  all  specified  items  and  all  their  descendants
在3
8 版更改 selection  no  longer  takes  arguments
 for  changing  the  selection  state  use  the  following  selection  methods
 在3
6 版更改 items  can  be  passed  as  separate  arguments  not  just  as  a  single  tuple
 在3
6版 更改 items  can  be  passed  as  separate  arguments  not  just  as  a  single  tuple
 在3
6 版更 改 items  can  be  passed  as  separate  arguments  not  just  as  a  single  tuple
 在3
6版更 改 items  can  be  passed  as  separate  arguments  not  just  as  a  single  tuple
ttk  styling
参 见 tcl 2004 conference  presentation  this  document  explains  how  the  theme  engine  worksclass  tkinter
layouts
tkinter  tcltk 的 python  接 口
tkinter  模块
在大多 数时 候你只 需要 tkinter  就足 够了 但也 有一些 额外 的模 块 可供使用
tk 接 口位 于一个名字 tkinter  的二 进制 模块 当中
此模块 包含 了 低层级的 tk 接 口 它 不应 该 被应 用程 序 员 所直 接 使用
 它通 常 是 一 个 共享 库或 dll 但在 某 些情 况下也 可 能被 静态 链接 到 python 解释 器
 除了 tk  接 口 tkinter 也 包 含了若 干 python 模 块 tkinter
constants 是 其中 最 重要 的
导入 tkinter  会 自 动 导入 tkinter
constants 所 以要 使 用 tkinter 通 常 你只 需要一 条简 单的 import  语句 import  tkinter  或者 更 常用 的 from  tkinter  import  class  tkinter
tkscreennamenone  basenamenone  classnametk  usetk 1 tk  类被初 始 化 时 无参数
 此 时 会 创建 一个 tk 顶级 控件 通常 是应 用程 序的 主窗 口
 每个 实 例都有自己关 联 的 tcl 解 释 器
tclscreennamenone  basenamenone  classnametk  usetk 0 tcl 函 数是一 个工 厂 函 数 它 创建 的 对象 与 tk  类 创建的 对象 非常 相似 只是它不初始化 tk 子 系 统
在不想 创建 或 无 法 创 建如 没有 x  server  的 unixlinux 系 统额 外的 顶层窗 口的环 境 中驱动 tcl 解释 器时这一点 非 常 有用
由 tcl  对 象 创建的 对 象 可 以通过 调 用 其 loadtk 方法 来创 建 顶层 窗口 并 初始 化 tk  子 系统
提 供 tk  支持的 其 他模 块 包括 tkinter
colorchooser  让用 户选择 颜 色的对话 框
commondialog 在此处 列出 的其 他模块 中定义的 对 话 框 的基类
tkinter  life  preserver
how  to  use  this  section
a  simple  hello  world  program
a  very  quick  look  at  tcltk
 注释 these  classes  are  provided  for  the  purposes  of  organizing  certain  functions  under  one  namespace
 例 如 button 
mapping  basic  tk  into  tkinter
how  tk  and  tkinter  are  related
handy  reference
setting  options
索 引意 义示 例0 选项 名 称 relief 1数 据库 查找 的选 项名 称 relief 2数据 库查 找的 选项类 relief 3 默认 值 raised 4当 前值 groove 示 例 printfred
the  packer
packer  options
ipadx 和 ipady  a  distance  designating  internal  padding  on  each  side  of  the  slave  widget
padx 和 pady  a  distance  designating  external  padding  on  each  side  of  the  slave  widget
coupling  widget  variables
 例 如 import  tkinter  as  tk  class  apptk
the  window  manager
tk  option  data  types
 位 图 there  are  eight  builtin  named  bitmaps  error  gray 25 gray 50 hourglass  info  questhead  question  warning
callback  回调 this  is  any  python  function  that  takes  no  arguments
bindings  and  events
 the  form  of  the  bind  method  is  def  bindself  sequence  func  addwhere  序列 is  a  string  that  denotes  the  target  kind  of  event
例 如 def  turnredself  event  event
 tk  tkinter  event  field  tk  tkinter  event  field  f  焦 点 a  char  h  height  e  sendevent  k  keycode  k  keysym  s 状况 n  keysymnum  t  time  t  类型 w  宽度 w  widget  x  x  x  xroot  y  y  y  yroot 
the  index  parameter
images
 参 见 the  pillow  package  adds  support  for  formats  such  as  bmp  jpeg  tiff  and  webp  among  others
file  handlers
token 与 python  解 析 树 一起 使 用 的常量
 源码 libtoken
py  此 模块提 供 表示解 析 树 终端 令 牌 的叶 节 点 的 数 值 的常 量
请 参阅 python  发 行版中 的文 件 grammargrammar  以 获取 语 言 语法上 下 文 中名称 的定 义
名称 映射 到 的特 定数 值可 能 会 在 python 版本 之 间更改
 该模块 还提 供从数 字代 码 到名 称和 一些函 数的 映射
这些 函数 镜像 了 python  c  头 文件 中的 定义
tokname 将此 模 块 中定义 的 常 量 的 数 值映射 回名 称 字符串 的字 典 允许生 成更加人 类可读 的 解 析 树 表示
isterminalx 对 终 端 标 记值返 回 true
isnonterminalx 对 非 终 端 标记 值 返 回 true
iseofx  如 果 x  是表 示输入 结 束 的标 记则 返 回 true
标 记常 量是 token
lpar 的 权 标 值
rpar  的权 标 值
lsqb 的 权 标 值
rsqb 的 权 标 值
colon  的 权标 值
comma 的 权标 值
semi 的权 标 值
plus 的 权标 值
minus  的 权标值
star  的 权标值
slash  的权 标 值
vbar 的权标 值
amper  的权 标 值
less  的权 标 值
greater 的 权标 值
ntoffsetc 标记 生成器不 使 用 以下 标记类 型值 但 tokenize 模 块 需 要这 些 标 记 类 型值
comment 标记值 用于 表 示 注 释
nl  标记 值 用于 表 示非 终止换 行 符
 newline  标记 表 示 python 代 码 逻辑行 的 结 束当 在 多条 物 理 线 路 上 继续执 行逻 辑 代 码行时 会 生 成 nl 标记
encoding  指 示 用于将 源字节解 码为文 本的编 码的 标记 值
 tokenize
tokenize 返 回 的第一 个标记将 始终 是一个 encoding 标 记
在3
5 版更 改 补充 await  和 async 标记
在3
7 版更 改 补充 comment 、 nl  和 encoding 标记
 在3
7版 更改 移除 await  和 async  标记
 async  和 await  现在 被标记 为 name 标 记
在3
8版 更改 added  typecomment  typeignore  colonequal
added  await  and  async  tokens  back  theyre  needed  to  supportparsing  older  python  versions  for  ast
parse  with  featureversionset  to 6 or  lower
tokenize  对 python 代 码 使用 的标 记解析器
 源码 libtokenize
 为了 简 化标记流 的处 理所有 的 运算符 和 定界 符以及 ellipsis  返回时 都会 打上通 用 的 op 标 记
可以通 过 tokenize
tokenize 返回 的 namedtuple  对象 的 exacttype 属性来获 得 确切的 标记类 型
对输 入进行解 析标 记
 主 要的入 口是一个 生 成 器 generatortokenize
tokenizereadline 生成 器 tokenize  需要一 个 readline 参数这 个参 数必须是 一个 可调用对 象且 能提供与 文件 对 象 的 io
readline 方法 相同 的 接 口
 每 次调 用这 个 函数 都要返 回 字 节类型 输入 的 一行 数据
 在3
1 版更改 added  support  for  named  tuples
在3
3 版更改 added  support  for  exacttype
3
2 新 版功 能
tokenerror  raised  when  either  a  docstring  or  expression  that  may  be  split  over  several  lines  is  not  completed  anywhere  in  the  file  for  example  beginning  of  docstring  或 者123 note  that  unclosed  singlequoted  strings  do  not  cause  an  error  to  beraised
commandline  usage
3
3 新版功 能
 示 例
readline  for  token  in  tokens  printtoken 或 者通 过 tokenize 直 接 读 取 字节数据 import  tokenize  with  openhello
trace  跟踪 python  语句 执行
commandline  usage
3
8 新版 功能 added  module  option  that  allows  to  run  an  executablemodule
main  options
modifiers
filters
 编程 接口
traceback 打印 或检 索堆 栈 回 溯
源 代 码 libtraceback
py  该 模 块提 供了一 个标 准接 口来 提取、 格式 化和 打 印 python 程 序 的 堆栈 跟踪 结 果
 它完全 模仿 python 解释器 在打 印 堆栈跟 踪 结果 时的行为
 当 您 想 要在 程 序 控 制 下打 印 堆 栈 跟踪 结果 时例如 在 封 装解 释器 时这 是 非 常有 用 的
这个 模块 使用 traceback  对 象——这 是 存 储 在 sys
lasttraceback 中 的对 象 类型变 量 并作 为 sys
excinfo 的 第 三 项被 返回
这 个 模 块 定 义了 以下 函 数 traceback
在3
5 版更 改 added  negative  limit  support
printexceptionetype  value  tb  limitnone  filenone  chaintrue 打 印 回 溯对 象 tb 到 file  的 异常 信 息 和 整 个堆 栈回 溯
这和 printtb 比 有 以下方 面不 同如 果 tb 不为 none 它 将 打 印 头 部 traceback  most  recent  call  last  it  prints  the  exception  etype  and  value  after  the  stack  trace  if  typevalue  is  syntaxerror  and  value  has  the  appropriate  format  it  prints  the  line  where  the  syntax  error  occurred  with  a  caret  indicating  the  approximate  position  of  the  error
 在3
5版 更改 the  etype  argument  is  ignored  and  inferred  from  the  type  of  value
 在3
5版 更 改 added  negative  limit  support
在3
5 版更 改 the  etype  argument  is  ignored  and  inferred  from  the  type  of  value
3
4新版功能
3
5 新 版功 能
3
5 新 版 功能
tracebackexception  objects
3
5 新 版 功能
stacksummary  objects
3
5 新 版功能
 在3
6版 更 改 long  sequences  of  repeated  frames  are  now  abbreviated
framesummary  objects
3
5 新 版 功能
traceback  examples
tracemalloc  跟踪 内存 分配
3
4 新 版 功 能
源代码 libtracemalloc
 示例
显示前10 项
显示 内存 分 配最多 的10个 文 件 import  tracemalloc  tracemalloc
statisticslineno  print  top 10 for  stat  in  topstats 10 printstatpython  测试 套 件的 输出 示 例 top 10 frozen  importlib
计 算 差异
 获 取 两 个快 照 并显示 差异 import  tracemalloc  tracemalloc
get  the  traceback  of  a  memory  block
pretty  top
takesnapshot  displaytopsnapshotpython  测 试套 件 的输出示 例 top 10 lines 1 libbase 64
gettracedmemory  printffirstsize  firstpeak  printfsecondsize  secondpeak 输 出 firstsize 664 firstpeak 3592984 secondsize 804 secondpeak 29704 using  resetpeak  ensured  we  could  accurately  record  the  peakduring  the  computation  of  smallsum  even  though  it  is  much  smallerthan  the  overall  peak  size  of  memory  blocks  since  the  start  call
api
函数
3
9 新 版功能
 域 过滤 器
3
6新 版 功能
 过 滤器
filterinclusive  bool  filenamepattern  str  lineno  intnone  allframes  boolfalse  domain  intnone  对 内存 块 的 跟踪进 行 筛 选
 示例 filtertrue  subprocess
file  excludes  traces  of  the  tracemalloc  module  filterfalse  unknown  excludes  empty  tracebacks  在3
5 版更 改 the 
pyo  file  extension  is  no  longer  replaced  with 
在3
6版更改 added  the  domain  attribute
frame
 快 照
 统 计
statisticdiff
 跟踪
 在3
6 版 更 改 added  the  domain  attribute
 回 溯
 在3
7 版 更 改 frames  are  now  sorted  from  the  oldest  to  the  most  recent  instead  of  most  recent  to  oldest
在3
9 版 更改 the  traceback
totalnframe  attribute  was  added
 示 例 printtraceback  most  recent  call  first  for  line  in  traceback  printline 输 出 traceback  most  recent  call  first  file  test
tty 终 端 控 制 功能
pytty  模块 定义 了 将 tty 放 入 cbreak 和 raw  模 式的 函数
 因 为 它 需 要 termios 模 块所 以只能 在 unix 上 运行
tty  模块 定 义了 以 下 函数 tty
tcsaflush 将 文 件 描 述 符 fd 的 模 式 更 改为 raw 
 如 果 when 被 省略则 默认 为 termios
tcsaflush 并 传 递给 termios
tcsetattr 
tcsaflush  将文 件描 述符 fd 的模 式 更改为 cbreak 
 如果 when  被 省 略 则 默认 为 termios
tcsaflush 并传递给 termios
tcsetattr 
 参 见模 块 termios 低 级终端控制 接 口
turtle 海 龟绘 图
 源码 libturtle
 概述
可用的 turtle  和 screen  方法 概览
turtle  方法
 海龟动作移 动 和绘 制 forward  fd 前 进 backward  bk  back 后 退 right  rt 右转 left  lt 左 转 goto  setpos  setposition 前 往定位 setx 设置 x  坐 标 sety 设 置 y 坐 标 setheading  seth  设 置朝 向 home 返 回原点 circle 画 圆 dot 画 点 stamp 印章 clearstamp 清除 印 章 clearstamps 清 除多 个印 章 undo 撤消 speed 速 度获 取海 龟的 状态 position  pos 位置 towards 目 标 方 向 xcor  x 坐 标 ycor  y 坐 标 heading 朝 向 distance 距离设置 与 度量 单位 degrees  角度 radians  弧度画笔控 制 绘图 状态 pendown  pd  down  画笔落下 penup  pu  up  画笔 抬起 pensize  width 画笔粗 细 pen  画笔 isdown  画笔 是否 落下 颜色 控 制 color 颜色 pencolor 画 笔 颜色 fillcolor 填 充 颜 色填 充 filling  是 否 填 充 beginfill  开 始 填 充 endfill 结束 填充 更多 绘图 控 制 reset  重置 clear 清 空 write  书 写 海 龟 状 态可 见性 showturtle  st  显 示 海龟 hideturtle  ht  隐 藏海 龟 isvisible  是 否可 见 外观 shape 形 状 resizemode 大 小调 整模 式 shapesize  turtlesize  形 状大 小 shearfactor 剪切 因 子 settiltangle 设 置 倾 角 tiltangle 倾 角 tilt 倾斜 shapetransform  变形 getshapepoly  获取 形状 多 边形 使 用事 件 onclick 当 鼠标点 击 onrelease  当鼠 标 释放 ondrag 当鼠 标 拖 动特殊 海龟方法 beginpoly 开 始 记录 多边 形 endpoly 结 束记 录多 边形 getpoly  获取 多边 形 clone  克隆 getturtle  getpen  获 取 海龟 画 笔 getscreen 获 取 屏幕 setundobuffer  设置 撤 消 缓 冲区 undobufferentries 撤 消缓 冲区条目 数
turtlescreenscreen  方法
 窗口 控制 bgcolor  背 景颜 色 bgpic  背景图片 clear  clearscreen  清 屏 reset  resetscreen  重置 screensize 屏 幕大 小 setworldcoordinates 设置世界坐标 系 动画控制 delay  延 迟 tracer  追踪 update 更 新使用屏 幕事件 listen 监 听 onkey  onkeyrelease 当 键盘按下并 释 放 onkeypress 当 键盘 按下 onclick  onscreenclick  当点 击屏 幕 ontimer 当 达到 定时 mainloop  done  主循 环设 置 与特殊 方法 mode  模式 colormode 颜 色模 式 getcanvas  获取 画布 getshapes  获 取形状 registershape  addshape  添 加 形状 turtles  所 有 海 龟 windowheight 窗 口高度 windowwidth  窗口 宽 度 输入 方 法 textinput  文本输 入 numinput 数字 输入 screen 专有 方法 bye 退出 exitonclick  当点 击 时退 出 setup  设置 title  标 题
rawturtleturtle  方 法 和对 应函数
 本 节 中 的大 部分 示例都使用 turtle  类 的 一个 实例 命 名为 turtle
 海龟 动作
 获取海 龟的 状态
pos  返 回 海 龟 当前 的坐 标 xy 为 vec 2 d 矢量 类对象
towardsx  ynone 参 数 x 一 个数值或数 值 对矢量 或一个 海龟实例 y  一个数 值—— 如 果 x 是一 个 数值 否则 为 none  从海 龟 位 置 到由 xy 矢 量或 另一海 龟对应位 置 的连 线 的 夹角
 此 数 值 依赖 于 海龟 初始 朝 向 由 standardworld 或 logo  模 式设 置所 决定
xcor  返回 海龟 的 x 坐 标
ycor  返 回 海 龟 的 y 坐 标
heading 返 回 海 龟 当前 的朝 向 数 值 依 赖 于 海龟 模式 参 见 mode
distancex  ynone 参数 x 一个 数值或 数 值对 矢量 或一个海 龟实例 y 一 个数值——如果 x  是 一个 数值 否则 为 none 返 回从海 龟 位 置到由 xy  适量 或另一海 龟对 应位置的单 位 距离
 度量 单位 设置
 画笔控 制
绘 图状 态 turtle
down 画 笔 落下 移 动时 将 画 线
up  画笔 抬起 移动时 不 画线
widthwidthnone 参数 width  一个 正数 值 设 置 线 条 的粗 细为 width  或返 回该 值
 如果 resizemode  设为 auto  并 且 turtleshape 为 多 边 形 该 多边 形也 以同 样组 细 的线 条 绘 制
如 未指 定参 数 则 返回当前 的 pensize
penpennone  pendict  参 数 pen 一个 包 含部分或 全 部 下列键 的 字典 pendict 一个 或 多 个以下 列 键为关键 字 的 关键字 参 数 返 回或设 置 画笔 的 属 性以 一个 包含以下键 值 对的画 笔字典 表示 shown  truefalse  pendown  truefalse  pencolor 颜色 字符 串 或颜 色 元组 fillcolor  颜色字 符串 或颜 色元组 pensize  正数值 speed 0
10范 围 内的数值 resizemode  auto  或 user 或 noresize  stretchfactor 正数值 正 数值 outline  正数 值 tilt 数值此 字典可作为 后 续调 用 pen 时 的参 数以 恢复之 前的 画笔 状态
 另 外还 可 将这 些 属 性 作为 关键 词参 数提 交
 使用 此 方 式 可 以用 一条 语句 设 置 画笔 的 多个属 性
isdown 如 果画 笔落下 返回 true  如果 画 笔 抬起返 回 false
isdown  true  颜色 控制 turtle
pencolorargs 返回 或设置画笔 颜 色
允 许以 下 四种 输 入格式 pencolor  返回 以颜 色描 述 字 符串 或元 组 见示 例 表示 的当 前画 笔 颜色
 可用作 其 他 colorpencolorfillcolor  调 用的 输入
 pencolorcolorstring  设置 画 笔颜色为 colorstring  指 定 的 tk 颜色 描 述字符串 例 如 red 、 yellow  或33 cc 8 c
 pencolorr  g  b 设置 画笔颜色 为以 r  g  b 元组 表示 的 rgb 颜色
r  g  b 的取 值 范围 应为0
colormodecolormode  的值 为1
0或255参见 colormode
 pencolorr  g  b  设置画笔 颜色 为以 r  g  b 表示的 rgb  颜 色
r  g  b 的 取值 范围 应为0
如果 turtleshape  为多边形 该多边形轮 廓 也以 新设 置的 画 笔 颜 色 绘制
fillcolorargs  返回 或 设置 填充颜色
 允许以下四 种 输入 格式 fillcolor  返回以颜 色描述字 符串或元组 见 示例 表示 的当 前填 充颜 色
 可用 作其 他 colorpencolorfillcolor 调用的输入
 fillcolorcolorstring 设 置填 充颜色为 colorstring 指定的 tk  颜色描述 字符串例 如 red 、 yellow 或33 cc 8 c
 fillcolorr  g  b 设置填 充颜 色 为以 r  g  b  元 组表 示 的 rgb 颜 色
r  g  b 的 取值 范 围 应为0
colormodecolormode  的值为1
0或255 参见 colormode
 fillcolorr  g  b  设置填充颜 色 为 r  g  b 表 示的 rgb  颜色
r  g  b  的取 值范围 应为0
如果 turtleshape 为多边 形该 多边形 内部也以新设置 的填 充颜色 填充
colorargs 返回或设置 画笔 颜色 和 填充 颜色
允许 多种输 入格式
使 用 如下0 至3个参 数 color  返 回以 一对颜色 描述字符串 或元 组 表示 的当前 画 笔 颜 色和填充 颜色 两者 可分 别由 pencolor  和 fillcolor 返 回
 colorcolorstring  colorrgb  colorrgb  输入 格 式与 pencolor  相 同 同 时设 置填 充颜 色和 画 笔颜 色 为 指 定 的值
 colorcolorstring 1 colorstring 2 colorr 1 g 1 b 1 r 2 g 2 b 2 相当 于 pencolorcolorstring 1加 fillcolorcolorstring 2 使用 其 他输 入格 式的方法也与之 类似
如果 turtleshape  为多边 形该多边 形轮 廓与 填充也使 用新 设置的颜色
0 另 参见 screen  方法 colormode
 填充 turtle
filling  返回填充 状态填 充为 true 否则 为 false
beginfill  在 绘制要 填充的 形 状 之前 调用
endfill  填充上次 调用 beginfill 之后绘 制 的形 状
自 相交 多边 形或 多 个形 状间 的重叠区域是否 填充 取决于操作系统 的图形引 擎、重叠 的类型以 及 重叠 的层数
例 如上 面的 turtle 多芒星 可 能会 全部 填充 为黄色也 可能会 有一些白 色 区 域
endfill 更 多绘 图控制 turtle
reset 从 屏幕 中删除海 龟的绘图海 龟 回到 原 点并 设置 所有变量 为默 认值
clear 从 屏幕中删 除指定海龟 的绘 图
不移动 海龟
海龟的 状 态和 位置 以及 其他 海龟的 绘图不受影响
writearg  movefalse  alignleft  fontarial 8 normal 参 数 arg 要书 写到 turtlescreen 的对 象 move  truefalse  align  字 符串 left  center  或 right  font 一 个三元组 fontname  fontsize  fonttype  书写文本 arg 指 定的字符 串到 当前海龟 位置 align 指定对 齐 方式 left  center  或 rightfont 指定字 体
如果 move 为 true  画笔会移动 到 文本 的右 下角
 默认 move 为 false
海 龟状态
使用 事 件
特 殊海 龟方法
beginpoly  开始记录多边形 的顶 点
当前 海龟位置为多边 形的 第一个顶 点
endpoly 停止记录 多 边形 的顶 点
当前海 龟位置为多 边 形的 最后 一个 顶点
它 将连 线 到第 一个顶点
getpoly  返 回 最 新记 录 的多边形
clone  创建并返回 海 龟的 克隆 体具有相 同的位置、朝 向 和海 龟 属性
getpen  返 回海 龟对 象自 身
 唯一 合 理的用 法 作为 一 个函 数来 返回匿名 海龟 pet  getturtle  pet
getscreen  返回 作为海龟 绘图场所的 turtlescreen  类 对象
 该 对象 将 可调 用 turtlescreen 方 法
setundobuffersize 参 数 size 一 个 整 型数值或 none 设 置或 禁 用撤 消缓冲区
 如果 size 为一 个整型数则 将 开辟 一 个指 定 大小 的 空缓 冲区
size  表示 可使 用 undo 方 法函 数 撤 消的海龟命 令的 次 数上 限
如 果 size 为 none  则禁用撤 消缓冲 区
undobufferentries 返回撤 销 缓冲 区里的 条 目 数
复 合形状
要 使用 由多个不同 颜 色多边 形构成的 复 合海龟形 状你 必须明确地 使 用辅 助类 shape  具体 步骤如 下1
创建一 个空 shape 对象 类型为 compound
按照 需 要使 用 addcomponent  方法 向 此对 象添 加多个部 件
例 如 s  shapecompound  poly 100105010105 s
接 下来将 shape  对象添加到 screen 对象 的形状 列表并使 用它 registershapemyshape  s  shapemyshape 注解 shape 类 在 registershape 方 法的 内 部以 多种 方式使用
 应用程序编 写者 只 有在 使 用上 述 的复 合 形状 时 才需 要处 理 shape 类
turtlescreenscreen  方法 及对 应函 数
 本 节中的大部 分示 例 都使 用 turtlescreen 类 的一 个实例命 名为 screen
窗 口控制
动 画控制
delaydelaynone 参数 delay  正整型数 设置或返回 以 毫秒 数表 示的 延迟值 delay
这 约等于 连续两次 画布 刷新的间 隔 时间
 绘图延迟 越长动画速 度 越慢
可选 参数 screen
tracernnone  delaynone 参数 n 非 负 整型数 delay 非 负整型数启 用 禁用 海龟 动画并设 置刷新图形 的 延迟 时间
 如果指 定 n 值则只有每第 n  次屏幕刷 新会实际执 行
 可被 用来 加速 复杂 图形的 绘制
如果调用时 不带参数 则返回当前 保 存的 n 值
第 二个参数设 置 延迟 值参 见 delay
update 执行一 次 turtlescreen 刷新
在 禁用追踪时 使 用
另 参见 rawturtleturtle  方法 speed
使用 屏幕事件
 输入方法
textinputtitle  prompt 参 数 title  字符 串 prompt 字 符串弹出 一个对话 框窗口用来 输 入一 个字 符串
形参 title 为对话 框窗口的 标题 prompt 为一条 文本 通常用 来 提示 要 输 入什么 信息
 返回 输入 的 字 符 串
如 果对 话 框被取 消 则 返 回 none
 screen
numinputtitle  prompt  defaultnone  minvalnone  maxvalnone 参 数 title 字 符 串 prompt  字 符串 default 数 值可 选 minval  数值 可选 maxval  数 值 可选 弹 出一个 对话 框 窗 口 用 来输 入一 个 数值
title 为 对 话 框 窗口 的标 题 prompt 为 一 条 文本通 常用 来描述 要输 入 的 数值信 息
default  默认 值 minval 可 输 入 的最小值 maxval  可输 入 的 最大 值
 输 入 数值 的必须在 指 定的 minval 
 maxval  范围 之 内 否则 将给 出 一条 提 示对 话框 保持 打 开 等 待 修改
 返 回输 入 的数 值
如果 对 话框被取消 则返 回 none
 screen
设置与特殊 方法
modemodenone  参数 mode  字符串 standard  logo  或 world 其 中之一 设 置海龟 模式 standard  logo  或 world 并 执 行重置
如 未 指 定模 式则返 回当 前的 模式
 standard  模式与 旧的 turtle  兼容
logo  模 式 与 大 部 分 logo 海 龟绘 图 兼 容
world  模 式使用 用 户自 定 义 的世 界坐标系
 注意在 此模 式下如果 xy  单位比 率 不 等 于1 则 角度会 显 得扭 曲
模 式初 始 海龟朝向 正数 角度 standard  朝 右 东 逆时 针 logo 朝上北 顺 时针 modelogo  resets  turtle  heading  to  north  mode  logoturtle
colormodecmodenone 参 数 cmode 数 值1
0 或255其 中之一返 回颜 色模 式 或将 其设为1
0或255
 构成 颜 色三元组的 r  g  b  数 值 必须 在0
cmode  范 围 之 内
getcanvas 返回 此 turtlescreen 的 canvas  对象
供 了 解 tkinter 的 canvas 对 象内 部机 理 的人 士 使 用
getshapes  返 回所有 当 前 可 用 海龟 形状 的 列 表
addshapename  shapenone  调 用 此 函数 有 三 种 不同方 式1
 name 为 一个 gif  文件 的 文件名 shape  为 none 安 装相 应 的 图像形 状
 screen
gif 注 解当 海龟 转向时 图 像形 状不会 转动 因此 无 法显 示海 龟的 朝 向2
 name 为 指定 的 字 符串 shape  为 由 坐标 值 对 构 成的 元 组安 装相 应 的多 边 形 形状
 name  为指 定的 字符 串为 一个 复合 shape 类对象 安装 相应 的 复 合 形 状
将 一个 海龟形 状 加 入 turtlescreen  的 形状列 表
 只 有这 样注 册过 的形 状才 能通 过执 行 shapeshapename 命 令来 使 用
turtles 返回屏幕 上的 海龟 列表
windowheight  返 回海 龟窗 口 的 高度
 screen
windowwidth  返 回海龟窗口 的宽度
 screen
screen 专有方法而 非继 承自 turtlescreen
bye  关 闭 海龟 绘 图窗 口
exitonclick  将 bye 方 法绑 定到 screen 上 的 鼠 标点击事 件
如 果配 置 字典 中 usingidle  的值 为 false  默认 值 则 同 时 进入 主事 件 循环
注如 果 启 动 idle 时使用了 n  开 关 无子 进程 turtle
cfg 中此数 值 应 设为 true
 在此 情况 下 idle  本身 的 主 事件循 环 同 样会 作 用于 客户脚 本
setupwidthcfgwidth  heightcfgheight  startxcfgleftright  startycfgtopbottom 设置 主窗 口的 大小 和位 置
默认 参数值 保 存在配 置字 典中 可通 过 turtle
cfg 文 件进 行修 改
参 数 width 如为 一 个 整型 数值 表 示 大 小 为 多少 像 素 如为 一 个浮点数值则 表示 屏幕 的 占比 默认 为 屏 幕 的50 height  如为 一个 整 型数值表示 高度 为 多少 像素 如 为一 个浮 点数 值则 表示 屏幕 的 占比默认为 屏幕 的75 startx  如为正值表 示初 始位置 距 离屏幕左边 缘多 少 像素负值表 示距 离 右边缘 none 表示 窗口 水平 居 中 starty 如为正值 表示 初 始位置距离 屏幕 上边 缘多 少像素 负 值 表示 距离下 边 缘 none  表 示 窗口 垂直 居中 screen
titletitlestring  参数 titlestring 一 个字 符串 显示 为 海 龟绘 图窗 口的标 题栏 文本 设置 海龟 窗口 标题 为 titlestring 指定 的文 本
 公共 类
 帮 助 与配 置
如何 使 用帮 助
screen  和 turtle  类 的 公 用方 法以 文 档 字 符 串 提 供 了 详 细 的文 档
 因 此 可 以 利 用 python 帮 助工 具获 取这些在 线帮助信 息当 使 用 idle 时 输入函 数方法 调 用 将弹出 工具 提 示显 示 其签名和 文档字符 串的 头几行
 对 文 法 或函数调 用 help 将显示其 文 档字符 串 helpscreen
penup  方法对 应函 数 的文档字符 串的 形式 会有一 些修 改 helpbgcolor  help  on  function  bgcolor  in  module  turtle  bgcolorargs  set  or  return  backgroundcolor  of  the  turtlescreen
 aliases  penup  pu  up  no  argument  example  penup  这些修 改版文 档 字 符串 是 在 导入时与方 法 对应函数的定 义一 起自 动生 成的
文 档字 符串翻 译 为不 同的 语言
如 何配置 screen  和 turtle
turtledemo 演示脚本 集
turtledemo 包汇 集了 一 组演示脚本
 这些 脚本 可以 通过以 下命令 打 开所提供的 演示查 看器 运 行 和查 看 python  m  turtledemo 此 外你 也 可 以 单独运行其 中的 演示 脚 本
例 如 python  m  turtledemo
bytedesignturtledemo 包 目录 中 的 内 容 一个 演 示查看器 main
py  可 用来 查 看脚 本的 源 码 并即 时运行
多个 脚 本文 件演示 turtle  模 块 的不 同 特性
 所有示 例可 通 过 examples  菜单 打 开
也 可 以 单 独运 行每 个脚 本
一个 turtle
cfg  文件 作为 说明 如何编 写 并 使用 模块 配 置 文 件 的示例 模 板
 演示 脚本 清单 如 下名 称描 述相关 特性 bytedesign  复杂 的传 统 海 龟 绘图 模式 tracer  delay  update  chaos  绘制 verhulst  动 态 模 型演示通 世 界 坐 标系 过 计 算 机的 运算 可 能会 生 成令 人惊 叹的 结果 clock  绘制 模 拟 时钟 显示 本机 的 当前 时间海 龟作为 表针 ontimer  colormixer  试验 r  g  b 颜色 模 式 ondrag 当 鼠 标拖 动 forest 绘制3 棵广 度优先树随 机 化 fractalcurves  绘制 hilbert  koch  曲 线递 归 lindenmayer 文 化 数学 印度装饰艺 术 l  系 统 minimalhanoi 汉诺塔 矩形 海 龟 作为 汉诺 盘 shape  shapesize  nim  玩经 典的 尼 姆游戏开 始 时有三海龟 作为 小棒 事件 驱 动 堆 小 棒 与 电脑对战
鼠 标 键 盘 paint 超 极简 主 义绘 画 程序 onclick  当鼠 标点击 peace 初级 技巧海 龟外 观 与 动画 penrose  非 周期 性地 使用 风 筝和飞 镖形 状铺 stamp  印章 满平 面 planetandmoon 模 拟引 力 系统 复合 开关 vec 2 d  类 rounddance 两 两相 对并 不 断 旋转 舞蹈 的海 龟 复合 形 状 clone  shapesize  tilt  getshapepoly  update  sortinganimate 动 态 演示 不同 的排序 方法简 单 对齐 随 机 化 tree 一棵 图形 化 的广 度优 先 树使 clone  克隆 用生 成 器 twocanvases  简单 设 计两 块画 布 上的 海龟 wikipedia  一个 来自 介 绍 海 龟绘图的 维基 百 科 clone  undo  文章 的图案 yinyang  另 一 个初 级示例 circle 画 圆 祝 你玩 得开 心
python 26 之后的 变 化
 turtle
windowwidth  和 turtle
windowheight  方 法 已被去 除
具 有 这些 名称 和 功能 的方 法现 在只 限 于 screen  类的 方 法
但 其对 应的函 数仍 然 可用
 实际 上 在 python 2
6 中这 些 方法就 已经 只 是 从 对应 的 turtlescreenscreen 类的 方法复 制而 来
 turtle
fill  方法已 被去 除
beginfill  和 endfill  的 行为 则 有 细微 改 变现在每个 填 充过 程 必须以一 个 endfill  调用 来结 束
新增 了一 个 turtle
filling  方法
该方 法返 回 一 个布 尔值 如果填充 过 程 正 在进 行为 true  否 则 为 false
此 行为 相 当 于 python 2
6中 不带 参数的 fill 调 用
python 30之 后的变化
 新 增了 turtle
shapetransform 和 turtle
getshapepoly  方 法
这 样就 可 以使 用所有 标准 线 性变 换 来 调 整海 龟形 状
turtle
tiltangle 的 功能 已 被加 强现 在可被 用来 获取 或设 置 倾 角
turtle
settiltangle 已弃 用
新 增了 screen
onkeypress 方 法作为 对 screen
onkey  的 补充实 际 就是 将行 为 绑定 到 keyrelease 事件
 后 者 相 应 增加 了 一 个别 名 screen
新 增了 screen
mainloop  方法
 这样 当 仅 需使用 screen  和 turtle 对 象时不需 要再额 外导 入 mainloop
新 增了 两 个方 法 screen
textinput  和 screen
 用来弹 出对话 框接受 输入 并 分别 返回 字符 串和 数 值
两个 新 的 示例 脚本 tdemonim
py 和 tdemorounddance
py 被加 入 到 libturtledemo 目 录 中
types 动态 类 型创 建 和 内置类型 名称
 源代 码 libtypes
py  此 模块 定 义了一 些 工具函 数用于 协 助动 态创 建 新的 类型
 它还 为某些对 象类型定 义了 名称这些名 称 由标 准 python  解 释 器所使 用但 并 不像 内置 的 int 或 str  那 样 对 外 公开
 最后 它 还 额外 提 供了 一 些类型 相关 但 重要 程度 不足 以作为 内置对 象 的工具 类 和函 数
动 态类 型创 建
newclassname  bases  kwdsnone  execbodynone 使 用适当 的 元类 动态地 创建一 个类 对象
 前三 个参 数是组 成类 定义 头的部 件 类名 称基 类 有序 排列 关键字 参数 例 如 metaclass
 execbody 参 数是 一 个 回 调函 数 用于 填充新 创 建 类的命名空 间
 它 应当接 受 类命名 空间 作为其 唯一 的参数 并 使 用 类 内容 直接更 新命 名空 间
如 果未提 供 回调 函 数则 它就 等 效于 传入 lambda  ns  ns
3
3新版 功 能
prepareclassname  bases  kwdsnone  计算 适当 的 元 类并 创建 类命名空 间
参 数是 组 成 类定义头的 部 件类 名称 基类 有序排 列以 及关键 字参 数例如 metaclass
 返 回 值是 一 个3 元 组 metaclass  namespace  kwds  metaclass 是适 当的 元类 namespace  是 预备 好的 类命 名空 间 而 kwds  是 所传 入 kwds  参数 移除 每个 metaclass  条目 后的已更 新副本
如 果 未传入 kwds  参 数 这将为一 个空 字典
3
3 新 版功能
在3
6 版 更改 所返 回元 组 中 namespace  元 素的默 认 值已 被改 变
现 在 当 元 类没有 prepare  方法 时 将 会 使 用一个 保留 插入 顺 序 的 映射
 参见 元类这 些函 数 所支 持的类创建 过 程 的 完整 细 节 pep 3115 python 3000中 的 元类引 入 prepare 命 名空 间 钩子 types
resolvebasesbases  动 态地 解 析 mro 条 目具 体描述见 pep 560
此 函数 会在 bases  中查找不是 type  的实 例的 项并 返回 一 个元 组其 中每个具 有 mroentries 方 法 的 此 种 对象 对 象将 被 替 换为 调用 该方 法解 包后的 结果
 如 果一 个 bases 项 是 type 的实例 或 它不具 有 mroentries  方法 则它 将 不加 改变地 被 包 含 在返 回的 元组 中
3
7 新版功 能
 参 见 pep 560 对类 型模 块和 泛型 类型 的 核 心支 持
标准 解释 器类 型
附加 工具类 和函 数
simplenamespace 一个简 单的 object 子类 提供了 访问 其 命 名空间的 属 性以 及一个 有意 义的 repr
 不同 于 object 对于 simplenamespace 你 可以 添 加和 移除 属性
 如 果 一个 simplenamespace  对象 使用 关键 字 参数 进 行 初始化这 些参数 会 被直 接 加 入 下层 命 名 空间
 此类型大 致 等价于以 下代 码 class  simplenamespace  def  initself  kwargs  self
dict  simplenamespace 可 被用 于替 代 class  ns  pass
但是对于 结 构化 记 录类型则 应 改用 namedtuple
3
3新版 功 能
在3
9 版 更改 repr  中的 属 性 顺 序 由字 母顺 序改 为插入顺 序 类 似 dict
dynamicclassattributefgetnone  fsetnone  fdelnone  docnone  在类上访 问 getattr 的路由 属 性
 这是一 个描述 器用 于定 义 通 过实 例与 通 过类 访问 时 具有 不 同行为 的 属性
当 实 例访 问时 保 持 正常行 为但 当 类访 问属 性 时将 被 路由至 类 的 getattr 方 法这是通 过引 发 attributeerror 来完 成 的
这 允许 有在 实例 上 激活 的特性 属 性 同时 又 有 在类 上的同名虚 拟属 性 一个例子 请参见 enum
enum
3
4 新版功能
 协程 工具函数
coroutinegenfunc  此 函数 可将 generator  函 数转 换 为 返回 基于 生成 器 的协 程 的 coroutine  function
基 于生成 器 的协 程 仍然 属 于 generator  iterator  但同 时又 可 被视 为 coroutine 对 象兼 awaitable
不 过它 没有必 要实 现 await 方 法
如 果 genfunc  是一 个生 成器函数 它 将被 原 地修 改
如 果 genfunc  不 是一 个 生成 器函 数则它会被 包装
如 果它 返回 一个 collections
generator  的 实例 该 实例 将 被 包 装在 一个 awaitable 代 理 对 象中
 所 有其他对象 类型 将被原样 返回
3
5 新 版功 能
typing 类型 标注 支持
3
5 新版 功能
 源码 libtyping
py  注 解  python 运 行 时并不 强 制标注 函数 和变 量类 型
类型 标 注可被 用 于 第三 方 工具比 如 类型 检 查器、集 成开发 环境、静 态检查 器等
此 模 块为运 行 时提 供了 pep 484、 pep 526、 pep 544、 pep 586、 pep 589和 pep 591 规定 的 类 型提 示
最基本的 支持 由 anyuniontuplecallabletypevar 和 generic  类型 组成
有 关完 整 的规 范 请参 阅 pep 484
有 关类 型 提示 的简 单 介 绍请参 阅 pep 483
函 数 接受并返 回一个 字符串 注释 像下 面这 样 def  greetingname  str  str  return  hello  name 在 函 数 greeting 中 参数 name 预 期是 str  类型 并且返 回 str 类 型
子类 型允 许 作为 参数
 类型 别 名
要 定义 一 个 类型 别名 可以 将一 个类 型赋给 别名
 在 本例 中 vector 和 listfloat  将被视 为 可互换 的 同 义词 vector  listfloat  def  scalescalar  float  vector  vector  vector  return  scalar  num  for  num  in  vector  typechecks  a  list  of  floats  qualifies  as  a  vector
4类 型别名 可用 于简化 复杂 类 型 签 名
例 如 from  collections
 请注意 none  作为 类型提 示是 一 种特殊 情 况 并且由 typenone  取代
newtype
 使 用 newtype 辅 助 函数创 建不同 的类 型 from  typing  import  newtype  userid  newtypeuserid  int  someid  userid 524313静态类 型 检查 器会将 新类型视 为它是 原始 类型的子类
 这 对 于帮助 捕 捉逻辑 错 误 非常有 用 def  getusernameuserid  userid  str 
 typechecks  usera  getusernameuserid 42351 does  not  typecheck  an  int  is  not  a  userid  userb  getusername 1 您 仍 然可 以对 userid  类型的 变量 执 行所 有 的 int 支持的 操 作 但 结 果 将始 终为 int  类型
 这可 以让 你在需 要 int 的 地方传入 userid 但会 阻 止你以 无效 的 方式 无意中 创建 userid  output  is  of  type  int  not  userid  output  userid 23413 userid 54341请 注意 这 些检 查仅通 过静 态类 型检查 程序 来强 制
 在运 行 时语 句 derived  newtypederivedbase 将 derived  设为 一个 函 数 该 函数立即 返 回您 传递 它 的任 何参数
这 意味着表 达式 derivedsomevalue  不会 创建一个 新的 类 或引 入任 何超出常 规函 数 调用 的开 销
更确切 地说 表达 式 somevalue  is  derivedsomevalue 在运 行时总是 为真
 这也 意味着无 法创 建 derived 的 子类 型因 为它是运 行时 的标 识函数而 不 是 实际 的 类型 from  typing  import  newtype  userid  newtypeuserid  int  fails  at  runtime  and  does  not  typecheck  class  adminuseriduserid  pass  但是 可以基 于 derived  newtype 创建 newtype  from  typing  import  newtype  userid  newtypeuserid  int  prouserid  newtypeprouserid  userid  并且 prouserid 的 类型 检 查将 按预 期 工作
 有关更多 详细 信 息 请参 阅 pep 484
注 解回 想一下使 用 类型 别名 声明 两种类 型彼 此等 效
alias  original  将使 静 态类 型检 查对 待所 有情 况下 alias  完全 等同于 original
 当您 想 简化复 杂类 型签 名 时这 很有 用
相反 newtype  声明 一种 类 型 是 另一 种类 型的 子类 型
derived  newtypederived  original 将使 静态 类型 检查 器将 derived 当作 original  的 子类 这意味着 original 类 型的 值不 能用于 derived  类 型的值需要 的地 方
 当您 想以最 小 的运 行 时 间成 本 防止 逻辑 错误时 这非 常 有用
3
2 新 版功 能
callable
期 望特 定签 名的 回调 函 数的 框架 可 以将 类型标 注为 callablearg 1 typearg 2 type  returntype
例 如 from  collections
abc  import  callable  def  feedergetnextitem  callable  str  none  body  def  asyncqueryonsuccess  callableint  none  onerror  callableint  exception  none  none  body 通过用 文字 省略 号替换类型 提 示 中的参 数 列 表 callable
returntype  可 以 声明 可调 用的 返回 类型 而无 需 指定 调用 签 名
 泛 型 generic
由 于无 法以 通用方 式静 态推 断有关保存 在 容 器 中 的对 象 的 类型信 息 因 此 抽 象基 类已 扩 展为支持订 阅以 表 示容 器元素 的 预期 类型
 泛 型可 以通 过 使 用 typing 模 块 中 名为 typevar  的 新工 厂进 行 参数 化
用户 定义 的 泛型 类型
 用户 定义 的类可 以 定义 为泛型类
name  messagegenerict  作为基 类 定 义 了 类 loggedvar 采 用单 个类 型参 数 t
 这 也使 得 t 作 为类 体内 的一个 类型 有效
generic 基 类 定义 了 classgetitem  使 得 loggedvart 作为 类 型有 效 from  collections
set 0泛 型类型 可以 有任意 数量 的类 型变量 并且类型 变 量 可能 会 受到 限 制 from  typing  import  typevar  generic 
generic 每 个参 数的 类型 变量 必须是不 同的
这 是无效的 from  typing  import  typevar  generic 
 您可 以对 generic 使用 多重 继承 from  collections
 从 泛型类 继 承 时 某些 类型 变量可 能 是固 定的 from  collections
 在这种情 况下 mydict  只有一 个参 数 t
 在 不指定 类型 参数 的 情况 下 使 用泛 型 类 别会 为 每个 位 置假 设 any
在下面 的例 子中 myiterable  不是 泛型 但 是隐式 继 承自 iterableany  from  collections
abc  import  iterable  class  myiterableiterable  same  as  iterableany  用户定 义 的通用类型别 名也 受支 持
 例 子 from  collections
 t  typevart  int  float  complex  vec  iterabletuplet  t  def  inproductv  vect  t  same  as  iterabletuplet  t  return  sumxy  for  x  y  in  v 在3
7 版更 改 generic  不再 拥 有 一 个自 定 义的 元类
一个 用户定 义的 泛型 类能 够使 用抽 象基本 类作 为 基类 而不会 发生 元 类冲突
 泛型 元 类不再被 支持
 参 数化泛 型的 结果会被 缓存 并且在 typing  模块中 的大部分类 型是可 哈希且可 比较 相等 性的
any 类 型
 名 义性 子类型区别 于结构 性子类 型
最初 pep 484 将 python 的 静态类 型系 统定 义 为使 用名 义性 子类型
 即是 说当且 仅当 a 是 b  的子 类时可 在 需要 b  类时 提 供 a 类
 这一 要求之 前也适 用 于 抽象 基类 比如 iterable 
这 一做 法的问题在于 一个 类必 须 显式 地 标注 为支 持他 们 这 即不 pythonic  也不 太可 能 在 惯用 动态 类型 的 python  代 码 中 会 有 人 正常地去用
举 例 来说 这符 合 pep 484 from  collections
  pep 544 通过 允许 用户不 必 在 类定 义中显 式地标注 基类 来解决这一问 题允许 静态 类 型检查 器 隐含地认为 bucket 既是 sized  的子类 型 又是 iterableint  的子 类型
 这被 称为 结构 性子 类型或者 静态鸭子类型 from  collections
 result  collectbucket  passes  type  check 此 外通过继 承一 个特 殊 的 类 protocol 用户能够定义 新的 自 定义 协议来充 分享受结构 化 子类 型后 文 中有 例子
模 块内容
本模块 定 义了 如下类、函数 和修 饰器
注解 本模块定义 了 若干 现存 的 标 准库 类 的子 类同时扩展为 generic 以 支持中 的 类型变 量
由于 现 存 的 标准库 类 在 python 3
9中 已经增 强 为 支持这 些 类型 变 得冗余
 这 些荣誉类型在 python 3
9 中 被弃 用但解释器不会 发起弃 用 警告
 预 期 上 类型 检 查器将 会在 程 序的目标 版本为 python 3
9 以上 时标记这 些 弃用 的类 型
这 些被弃用的 类 型会 在 python 3
0发 布 的五 年后 从 typing 模 块中 移除
 详情 请 见 pep 585《标准 集 合的类 型提示 泛 型》
 特 殊类 型原 语
generic  concrete  collections
dictdict  mutablemappingkt  vt  dict  的 泛 型版 本
对 标注 返 回 类 型比较 有用
 如 果要标注参 数 的话 使用 如 mapping 的 抽 象容 器类 型是 更好 的 选 择
这 个类型 可以这 样 使用 def  countwordstext  str  dictstr  int 
3
9 版 后已 移除 builtins
 see  pep 585 and  generic  alias  type
 这个 类型可 以这 样用 t  typevart  int  float  def  vec 2 x  t  y  t  listt  return  x  y  def  keeppositivesvector  sequencet  listt  return  item  for  item  in  vector  if  item 03
9版后 已 移除 builtins
 see  pep 585 and  generic  alias  type
3
9 版后 已 移除 builtins
 see  pep 585 and  generic  alias  type
3
9 版后已 移除 builtins
frozenset  now  supports 
 see  pep 585 and  generic  alias  type
 注解 tuple  is  a  special  form
defaultdict  mutablemappingkt  vt  collections
defaultdict  的 泛型版 本
3
2新 版功 能
3
9版 后已 移 除 collections
defaultdict  now  supports 
 see  pep 585 and  generic  alias  type
ordereddict  mutablemappingkt  vt  collections
ordereddict  的泛 型版本
3
2 新版 功 能
3
9版 后已 移除 collections
ordereddict  now  supports 
 see  pep 585 and  generic  alias  type
chainmap  mutablemappingkt  vt  collections
chainmap  的泛 型版 本
3
4新 版功 能
3
1 新版 功能
3
9 版后 已移 除 collections
chainmap  now  supports 
 see  pep 585 and  generic  alias  type
counter  dictt  int  collections
counter 的 泛型版本
3
4 新版 功能
3
1 新 版功 能
3
9版后 已 移除 collections
counter  now  supports 
 see  pep 585 and  generic  alias  type
dequedeque  mutablesequencet  collections
deque 的 泛型版本
3
4 新版 功 能
3
1 新版 功能
3
9 版后 已 移 除 collections
deque  now  supports 
 see  pep 585 and  generic  alias  type
3
9 版后 已移除 classes  pattern  and  match  from  re  now  support 
 use  text  to  indicate  that  a  value  must  contain  a  unicode  string  in  a  manner  that  is  compatible  with  both  python 2 and  python 3 def  addunicodecheckmarktext  text  text  return  text  u  u 27133
2 新版功能
abstract  base  classes
 协 议
3
8新 版 功能
functions  and  decorators
3
8 新 版 功 能
notypecheck  用 于指 明 标 注 不是 类 型提示的 装饰器
 此 decorator  装 饰器 生 效 于类 或函数上
如果 作 用于 类上 的话它 会递归地 作 用于 这 个类的 所定 义的 所有 方 法上但是 对 于 超类 或子 类所 定义的方 法不会 生效
此 方法会 就地 地修改 函数
notypecheckdecorator  使其 它装 饰器 起 到 notypecheck 效 果的 装 饰 器
typecheckonly  标记 一个 类或 函 数在 运 行时 内不 可用 的 装 饰 器
introspection  helpers
gettypehintsobj  globalnsnone  localnsnone  includeextrasfalse  返 回一 个 字典 字典 内 含有 函数、 方法、 模块 或 类对 象的 类 型 提 示
 for  example  class  studentnamedtuple  name  annotatedstr  some  marker  gettypehintsstudent  name  str  gettypehintsstudent  includeextrasfalse  name  str  gettypehintsstudent  includeextrastrue  name  annotatedstr  some  marker 在3
9 版更改 added  includeextras  parameter  as  part  of  pep 593
 examples  assert  getorigindictstr  int  is  dict  assert  getargsdictint  str  int  str  assert  getoriginunionint  str  is  union  assert  getargsunionint  str  int  str 3
8 新 版功能
 常 数
 注 解 if  from  future  import  annotations  is  used  in  python 3
3
2 新版 功 能
未创 建 文 档的 模块
平 台特 定 模 块
这 些模块用 于实 现 os
path  模块除 此 之 外 没 有文 档
 几 乎 没 有 必 要创 建 这 些文档
ntpath  在 win 32 和 win 64 平台 上 实现 os
path 
posixpath 在 posix  上实 现 os
path 
unicodedata  unicode  数据 库
unittestmock 上 手 指南
3
3 新版功 能
使 用 mock
模 拟方 法调 用
使用 mock  的 常 见 场景模 拟 函数 调 用记 录对 象 上 的方 法 调用你可 能需 要 替换 一个 对 象 上的 方 法用 于确 认 此 方 法被 系统 中 的其他 部分 调用过 并 且调用 时 使 用了 正确 的参 数
 real  someclass  real
method  magicmocknamemethod  real
method 345 keyvaluemagicmock  namemethod  id
使 用 了 mock 本 例 中 的 real
method  之后 它有 方 法 和属 性可以 让你针 对 它是 被 如何 使用 的下 断 言
 注解 在 多 数示 例 中 mock 与 magicmock  两个 类 可 以相 互替 换 而 magicmock  是一个 更适用 的类 通 常 情况 下使 用它 就 可 以了
 如果 mock 被调 用它 的 called  属 性就 会变 成 true 更 重要 的是 我们 可以 使用 assertcalledwith  或者 assertcalledoncewith  方法 来确认它在被调 用时 使用 了 正确 的 参数
 在如 下的 测试 示例中 验 证对 于 productionclass
method 的 调用 会导 致 something 的调 用
 class  productionclass
对 象上 的方 法调用的 mock
mocking  classes
naming  your  mocks
tracking  all  calls
setting  return  values  and  attributes
raising  exceptions  with  mocks
side  effect  functions  and  iterables
mocking  asynchronous  iterators
8 asyncmock  and  magicmock  have  support  to  mock  异 步迭 代器 through  aiter
 the  returnvalue  attribute  ofaiter  can  be  used  to  set  the  return  values  to  be  used  foriteration
mocking  asynchronous  context  manager
8 asyncmock  and  magicmock  have  support  to  mock 异 步上 下文管 理 器 through  aenter  and  aexit
 by  defaultaenter  and  aexit  are  asyncmock  instances  that  return  anasync  function
creating  a  mock  from  an  existing  object
patch  decorators
 注解 在查 找 对 象 的名 称 空间中修补 对 象 使用 patch 
 使 用 起 来 很 简单 阅读 在哪里 打 补 丁来 快速上 手
还 有一 个 patch
dict 用 于在 一定 范围 内设 置 字 典 中的 值并 在测 试结 束 时将 字典恢复为 其原 始 状态 foo  key  value  original  foo
further  examples
mocking  chained  calls
partial  mocking
mocking  a  generator  method
applying  the  same  patch  to  every  test  method
mocking  unbound  methods
checking  multiple  calls  with  mock
coping  with  mutable  arguments
 注解 if  your  mock  is  only  going  to  be  used  once  there  is  an  easier  way  of  checking  arguments  at  the  point  they  are  called
nesting  patches
mocking  a  dictionary  with  magicmock
sideeffect  setitem 注 解 an  alternative  to  using  magicmock  is  to  use  mock  and  only  provide  the  magic  methods  you  specifically  want  mock  mock  mock
mock  subclasses  and  their  attributes
mocking  imports  with  patchdict
tracking  order  of  calls  and  less  verbose  call  assertions
more  complex  argument  matching
unittestmock  mock 对 象库
3
3 新 版功 能
源代 码 libunittestmock
mock 是 一个 用于 测试的 python  库
它 允许使 用 mock  对 象替 换受 测试 系统 的部 分 并对 它们 如何 已经被 使用进行断 言
mock 提 供了 一个 核心 类 mock  用 于消 除了 在整个测 试套 件中 创建大 量 存根 stub  的 需 求
创 建后 就可 以 断言 调用 了哪 些 方法 属 性 及其 参 数
还可以以常 规 方式指 定返回值 并 设 置所 需的 属 性
 此 外 mock  提 供了用 于修 补测 试 范围 内 模 块和类 级别 属 性的 patch 装饰 器 和 用 于创 建独 特 对 象的 sentinel 
 阅读 quick  guide 中 的案 例了解如何使 用 mock  magicmock  和 patch 
mock 是 为 unittest 而 设计 且 简单 易 用
模 拟 基 于 action  assertion 模 式而 不 是许 多模拟 框架 所使用的 record  replay  模式
 在 python  的 早期 版本要 单独 使用 unittest
mock  在 pypi 获取 mock 
快 速 上 手
mock  类
mock  是 一个 可以灵 活的替换存 根 stubs  的对象 可以 测试所 有代 码
mock  是 可调 用的 在 访 问 其属 性时 创 建一个 新的 mock 1
 访 问相 同的 属性 只会 返回 相 同 的 mock 
 mock  会保 存调用 记录 可 以 通 过 断言 获 悉代 码 的调 用
magicmock 是 mock 的 子类 它有 所 有预 创建 且 可使用的魔 术方法
在 需要模拟不 可 调用 对象 时可 以使用 noncallablemock   和 noncallablemagicmockpatch 装 饰器 便于 mock  对象 临 时替 换特 定 模 块中 的类
 patch 默 认 创建 magicmock 
可以使 用 patch 方 法 的 newcallable 参 数指 定 mock 的 替 代类
mockspecnone  sideeffectnone  returnvaluedefault  wrapsnone  namenone  specsetnone  unsafefalse  kwargs  创 建 一个 新的 mock  对 象
 通 过可 选 参数指 定 mock  对象的 行为 spec  this  can  be  either  a  list  of  strings  or  an  existing  object  a  class  or  instance  that  acts  as  the  specification  for  the  mock  object
3
5 新 版功 能
assertcalled 3
6 新版 功 能
3
6新 版功 能
3
5新 版功 能
called  false 在3
6 版更 改 added  two  keyword  only  argument  to  the  resetmock  function
 注 解 returnvalue  and  sideeffect  are  keyword  only  argument
在3
8 版更改 added  args  and  kwargs  properties
 注解 the  way  mockcalls  are  recorded  means  that  where  nested  calls  are  made  the  parameters  of  ancestor  calls  are  not  recorded  and  so  will  always  compare  equal  mock  magicmock  mock
 在3
4版 更改 added  signature  introspection  on  specced  and  autospecced  mock  objects
3
8 新 版功 能
calling
deleting  attributes
mock  names  and  the  name  attribute
attaching  mocks  as  attributes
the  patchers
patch
注解 the  key  is  to  do  the  patching  in  the  right  namespace
 with  it  switched  on  you  can  write  passing  tests  against  apis  that  dont  actually  exist 注 解在3
5 版 更改 if  you  are  patching  builtins  in  a  module  then  you  dont  need  to  pass  createtrue  it  will  be  added  by  default
 test 在3
8版 更 改 patch  now  returns  an  asyncmock  if  the  target  isan  async  function
patchobject
patchdict
在3
8 版 更 改 patch
dict  now  returns  the  patched  dictionary  when  used  as  a  context  manager
patchmultiple
patch  methods  start  and  stop
run  警 告 if  you  use  this  technique  you  must  ensure  that  the  patching  is  undone  by  calling  stop
patch  builtins
testprefix
nesting  patch  decorators
where  to  patch
patching  descriptors  and  proxy  objects
magicmock  and  magic  method  support
mocking  magic  methods
 注解 if  you  use  the  spec  keyword  argument  to  create  a  mock  then  attempting  to  set  a  magic  method  that  isnt  in  the  spec  will  raise  an  attributeerror
the  full  list  of  supported  magic  methods  is  hash  sizeof  repr  and  str  dir  format  and  subclasses  round  floor  trunc  and  ceil  comparisons  lt  gt  le  ge  eq  and  ne  container  methods  getitem  setitem  delitem  contains  len  iter  reversed  and  missing  context  manager  enter  exit  aenter  and  aexit  unary  numeric  methods  neg  pos  and  invert  the  numeric  methods  including  right  hand  and  inplace  variants  add  sub  mul  matmul  div  truediv  floordiv  mod  divmod  lshift  rshift  and  xor  or  and  pow  numeric  conversion  methods  complex  int  float  and  index  descriptor  methods  get  set  and  delete  pickling  reduce  reduceex  getinitargs  getnewargs  getstate  and  setstate  file  system  path  representation  fspath  asynchronous  iteration  methods  aiter  and  anext  在3
8 版更改 added  support  for  os
 在3
8 版更改 added  support  for  aenter  aexitaiter  and  anext
magic  mock
0 bool  true  index 1 hash  default  hash  for  the  mock  str  default  str  for  the  mock  sizeof  default  sizeof  for  the  mock  例如 mock  magicmock  intmock 1 lenmock 0 listmock  object  in  mockfalsethe  two  equality  methods  eq  and  ne  are  special
helpers
sentinel
 在3
7 版更 改 the  sentinel  attributes  now  preserve  their  identity  when  they  are  copied  or  pickled
default
call
createautospec
 在3
8 版更 改 createautospec  now  returns  an  asyncmock  if  thetarget  is  an  async  function
any
filterdir
mockopen
在3
4版 更改 added  readline  and  readlines  support
 the  mock  of  read  changed  to  consume  readdata  rather  than  returning  it  on  each  call
 在3
5 版 更改 readdata  is  now  reset  on  each  call  to  the  mock
 在3
8 版更 改 added  iter  to  implementation  so  that  iteration  such  as  in  for  loops  correctly  consumes  readdata
autospeccing
sealing  mocks
3
7 新 版功 能
unittest  单 元 测试 框架
 基本实 例
unittest 模块提供 了一 系 列创 建和 运行 测试的 工具
 这一段落演 示了 这 些工具的 一小 部 分但也 足以 满足 大部 分 用户 的需 求
这 是 一 段 简 短的 代码 来测 试 三种字 符 串 方法 import  unittest  class  teststringmethodsunittest
main  继 承 unittest
testcase 就 创建 了 一 个 测试样 例
上 述三 个独立 的 测试 是三 个类 的方 法这些 方 法的 命名 都以 test  开头
这 个 命 名 约 定告 诉测 试运行 者 类 的 哪些 方法 表示 测 试
 每个 测试 的关 键 是调 用 assertequal 来 检 查预 期 的输 出 调 用 asserttrue 或 assertfalse  来验证 一个条件 调用 assertraises 来 验 证抛出了一 个特定 的 异 常
 使用这些 方法 而不是 assert 语 句 是为 了让测试 运行者能聚 合 所有的 测试 结果并 产生结 果报 告
通过 setup  和 teardown 方法可 以 设 置测试 开始 前与完成 后 需要 执行的指令
 在组织你的 测试 代码 中对 此 有更为详 细 的描 述
最 后的 代码 块 中演 示 了 运行测 试的一个 简单的 方 法
main 提供了一 个测 试脚 本的命令 行 接 口
 当在 命令行运 行该 测试脚 本上文的 脚本 生成 如以下格 式的 输出
000 s  ok 在 调用 测 试 脚 本 时 添加 v  参数使 unittest
main  显示 更 为详细的 信 息生成如 以 下形 式的 输 出 testisupper  main
001 s  ok 以上 例 子演示 了 unittest  中 最 常 用的、足 够满 足许多 日常测 试 需求 的特 性
 文档 的剩余部 分 详 述 该框架的 完整 特 性
命 令行界 面
 命令 行 选项
unittest  supports  these  commandline  optionsb  buffer  在 测 试 运 行 时标 准输 出流与标 准 错误 流 会被 放入缓 冲区
成 功的 测 试 的运行时 输出会 被丢 弃测 试 不 通过 时 测试运行 中的 输 出 会 正 常显示 错误 会被 加入 到测 试 失败 信息
c  catch 当 测试正在 运 行 时 controlc 会 等 待当前 测试 完成 并 在完 成 后报告 已执 行 的测 试 的结果
当 再次 按下 controlc  时引 发 平常 的 keyboardinterrupt 异常
 see  signal  handling  for  the  functions  that  provide  this  functionality
f  failfast 当出 现第 一 个错误或 者失 败 时停 止 运行 测 试
k 只 运 行匹 配模式 或子 串的 测 试方 法和类
 可以多 次 使 用这 个选 项以便 包含匹配 子串的所 有测 试用 例
包 含通配符 的 模 式使用 fnmatch
fnmatchcase  对测 试 名称进 行匹配
另外 该匹配是 大小 写 敏 感的
 模式 对测 试 加载器 导入的 测试方 法全 名进行匹 配
 例 如 k  foo 可 以 匹配 到 footests
testsomething 和 bartests
testfoo  但 是不能匹 配到 bartests
testsomething 
locals 在 回溯 中显 示 局部变量
3
2新 版功 能 添加 命令行选 项 b  c 和 f 
3
5 新版 功能 命令行选项 locals 
3
7 新版 功能 命令 行选项 k 
 命 令行 亦 可用 于探索 性测 试以运 行一个项 目 的所 有 测试 或其子 集
探 索 性 测 试
组织你 的测 试代码
 单 元测试 的 构建单 位是 test  cases  独立 的、 包含 执行 条件 与正 确性 检 查的方 案
 在 unittest 中 测试 用 例表 示为 unittest
testcase  的 实例
 通 过编 写 testcase 的 子类 或 使用 functiontestcase 编写你 自己 的测 试 用例
一个 testcase 实 例的测 试 代码 必 须是 完全 自含 的因 此它可以独 立 运行 或与 其它任 意组 合任意 数量 的测 试用例 一 起运行
testcase 的 最 简 单的 子类 需要 实现 一 个 测 试方 法例 如一个 命名以 test 开 头的 方法 以 执行特 定的测试 代码 import  unittest  class  defaultwidgetsizetestcaseunittest
testcase  def  testdefaultwidgetsizeself  widget  widgetthe  widget  self
assertequalwidget
size 5050 可以看到 为 了进 行 测 试 我 们使用了 基 类 testcase 提 供的 其中 一个 assert 方法
 若测 试 不通 过将 会 引发一个 带有说明 信息 的异 常并 且 unittest 会 将这个测 试用 例标 记为测 试不通过
 任何其 它类 型的 异 常将 会被当 做 错误 处理
可能 同时存 在多个前 置操 作相同 的测 试我们可 以 把测 试的 前置 操 作从 测试 代码 中拆解 出来并实 现测试 前置方法 setup 
在 运行 测 试时 测试 框 架 会自动地 为 每个 单独 测试调 用前 置方 法
 import  unittest  class  widgettestcaseunittest
testcase  def  setupself  self
widget  widgetthe  widget  def  testdefaultwidgetsizeself  self
assertequalself
widget
size 5050 incorrect  default  size  def  testwidgetresizeself  self
widget
resize 100150 self
assertequalself
widget
size 100150 wrong  size  after  resize 注解多 个测 试运 行的顺 序由内置 字符 串排 序方 法 对测试名 进 行 排序 的结 果 决 定
在测试 运行时若 setup  方法 引 发异常测 试框架会 认为 测 试 发生 了错误 因此测试 方 法不会被 运行
相似 的我 们提供 了一个 teardown 方 法在 测 试 方 法运 行后 进行 清理 工 作
 import  unittest  class  widgettestcaseunittest
dispose 若 setup 成 功运 行 无论 测试 方 法 是 否 成 功都 会运 行 teardown 
 这样 的一 个 测试代 码运行 的环 境被称 为 test  fixture 
 一个 新 的 testcase 实 例作 为 一个测 试 脚手架用 于 运行 各 个独 立 的测 试方法
在 运 行每 个 测试 时 setup 、 teardown 和 init  会被调用 一 次
建 议你 根据 所测 试的 功 能将测试 用 testcase 实 现 集合 起 来
unittest 为 此 提供了机 制 test  suite  以 unittest 的 类 testsuite  为代 表
大 部分 情况下 调用 unittest
main 即可 并且 它会 为你 集合所 有 模块 的 测试 用例 并 执行
然 而如 果 你需要 自定 义你的测 试套 件的 话 你可 以 参考 以 下方 法组织你 的 测试 def  suite  suite  unittest
 复用已 有的测试 代码
一些用 户希望直接 使用 unittest  运行 已有的测 试 代码 而不 需要 把 已有 的 每 个测 试函数转 化为 一个 testcase  的子类
 因此 unittest 提供 functiontestcase 类
 这 个 testcase  的子 类可用于 打包 已有 的测 试 函数并 支 持设置前置 与后 置函数
 假定有一 个 测试 函数 def  testsomething  something  makesomething  assert  something
name  is  not  none 
可以 创建 等价的测试 用例 如下其中前 置 和后 置方 法 是可选的
 testcase  unittest
functiontestcasetestsomething  setupmakesomethingdb  teardowndeletesomethingdb  注解 even  though  functiontestcase  can  be  used  to  quickly  convert  an  existing  test  base  over  to  a  unittestbased  system  this  approach  is  not  recommended
 跳过测试与 预 计的失败
distinguishing  test  iterations  using  subtests
3
4 新版 功能
 例如以下 测试 class  numberstestunittest
assertequali 20 可以得到以 下 输出 fail  testeven  main
 类与 函数
 本 节深 入介 绍 了 unittest 的 api
 测 试 用例
grouping  tests
 在3
2版更改 in  earlier  versions  the  testsuite  accessed  tests  directly  rather  than  through  iteration  so  overriding  iter  wasnt  sufficient  for  providing  tests
在3
4 版更改 in  earlier  versions  the  testsuite  held  references  to  each  testcase  after  testsuite
loading  and  running  tests
3
5新 版 功 能
注 解 while  using  a  hierarchy  of  testcasederived  classes  can  be  convenient  in  sharing  fixtures  and  helper  functions  defining  test  methods  on  base  classes  that  are  not  intended  to  be  instantiated  directly  does  not  play  well  with  this  method
在3
2 版 更 改 support  for  loadtests  added
在3
5 版更改 the  undocumented  and  unofficial  useloadtests  default  argument  is  deprecated  and  ignored  although  it  is  still  accepted  for  backward  compatibility
 the  method  also  now  accepts  a  keywordonly  argument  pattern  which  is  passed  to  loadtests  as  the  third  argument
在3
5版 更改 if  an  importerror  or  attributeerror  occurs  while  traversing  name  then  a  synthetic  test  that  raises  that  error  when  run  will  be  returned
 these  errors  are  included  in  the  errors  accumulated  by  self
3
2 新版 功能
在3
4 版更 改 modules  that  raise  skiptest  on  import  are  recorded  as  skips  not  errors
 discovery  works  for  namespace  packages
 paths  are  sorted  before  being  imported  so  that  execution  order  is  the  same  even  if  the  underlying  file  systems  ordering  is  not  dependent  on  file  name
在3
5版 更改 found  packages  are  now  checked  for  loadtests  regardless  of  whether  their  path  matches  pattern  because  it  is  impossible  for  a  package  name  to  match  the  default  pattern
3
7 新 版功 能
3
1 新版 功能
3
2 新 版 功能
3
2 新版 功能
3
5新版功 能
 在3
4版 更改 returns  false  if  there  were  any  unexpectedsuccesses  from  tests  marked  with  the  expectedfailure  decorator
3
1新版功 能
3
1新 版 功能
3
4 新版 功 能
3
2 新版 功能 this  class  was  previously  named  texttestresult
 the  old  name  still  exists  as  an  alias  but  is  deprecated
在3
2版更 改 added  the  warnings  argument
 在3
2版 更 改 the  default  stream  is  set  to  sys
stderr  at  instantiation  time  rather  than  import  time
在3
5版 更改 added  the  tblocals  parameter
 在3
1版 更 改 the  exit  parameter  was  added
 在3
2版 更改 the  verbosity  failfast  catchbreak  buffer  and  warnings  parameters  were  added
在3
4版更 改 the  defaulttest  parameter  was  changed  to  also  accept  an  iterable  of  test  names
loadtests  protocol 3
2 新 版 功 能
addtestspackagetests  return  standardtests 在3
5版 更改 discovery  no  longer  checks  package  names  for  matchingpattern  due  to  the  impossibility  of  package  names  matching  thedefault  pattern
class  and  module  fixtures
setupclass  and  teardownclass
setupmodule  and  teardownmodule
3
8 新版 功能
3
8 新版 功 能
signal  handling
3
2新 版 功能
unix  专有 服务
本 章 描 述的 模块提供了 unix  操作 系统独 有特 性 的接 口 在某 些 情况 下也 适用于 它的 某些或许多 衍生 版
 以 下为 模块概览 posix 最 常见 的 posix 系 统 调 用 大 文件 支 持重 要的模 块内容 pwd 用 户密 码 数据 库 spwd  the  shadow  password  database  grp  组 数据库 crypt  function  to  check  unix  passwords  hashing  methods  module  attributes  模块函数示 例 termios  posix 风 格 的 tty 控制示 例 tty 终端 控制 功能 pty  伪终 端 工 具示 例 fcntl  the  fcntl  and  ioctl  system  calls  pipes  终 端管道接口 模 板 对象 resource  resource  usage  information  resource  limits  resource  usage  nis  sun  的 nis 黄 页 接 口 unix  syslog 库 例程示 例简 单示例
urlliberror  urllibrequest 引 发的异 常类
源代 码 liburlliberror
pyurllib
error  模块为 urllib
request  所引 发的异常 定义 了异 常 类
基础异 常类 是 urlerror
下 列 异常 会被 urllib
error  按需 引发 exception  urllib
urlerror 处 理程序在 遇 到问题时会 引发 此异 常或其派 生 的异 常
它 是 oserror 的 一 个子 类
 reason 此 错误 的原 因
它可 以是一 个消 息字 符串 或另 一个 异 常实 例
在3
3 版更改 urlerror  已被 设为 oserror  而不是 ioerror 的 子类
httperror  虽然 是一 个异 常 urlerror 的 一个子 类 httperror 也可 以作 为一个 非异常的 文 件类返回值 与 urlopen 返所回的 对 象相同
 这适 用于处 理 特殊 http  错 误 例如 作 为 认证 请求 的 时候
 code 一 个 http 状态码 具 体定义见 rfc 2616
这 个数 字 的 值对应于 存放在 http
responses  代 码字 典中的 某个 值
 reason  这通 常 是一 个解 释本 次错 误原 因 的 字符 串
 headers 导致 httperror 的 特 定 http 请 求的 http  响应头
3
4 新版 功能
contenttooshorterrormsg  content 此异 常会 在 urlretrieve  函数 检测 到已下 载 的 数据 量 小于 期 待的 数 据 量 由 contentlength 头 给 定时被 引发
 content  属性 中将存放 已下 载可能 被截 断的 数据
urllibparse  parse  urls  into  components
源代 码 liburllibparse
url 解 析
 the  return  value  is  a  named  tuple  which  means  that  its  items  can  be  accessed  by  index  or  as  named  attributes  which  are 属 性 索 引值值如 果不存 在 scheme 0 url 方案 说 明符 scheme  parameter  netloc 1网 络位置 部 分空字 符 串 path 2 分层路 径空字 符串 params 3 最 后路 径 元素 的参 数空 字 符串 query 4 查 询 组件 空 字符 串 fragment 5 片段识 别 空字 符串 username  用户名 none  password  密码 none  hostname  主 机名小 写 none  port  端口 号为 整数如果 存在 none  reading  the  port  attribute  will  raise  a  valueerror  if  an  invalid  port  is  specified  in  the  url
 see  section 结 构化 解析 结果 for  more  information  on  the  result  object
html  params  query  fragment 在3
2版 更 改 添 加了 ipv 6 url 解析 功能
在3
3 版更改 the  fragment  is  now  parsed  for  all  url  schemes  unless  allowfragment  is  false  in  accordance  with  rfc 3986
 previously  a  whitelist  of  schemes  that  support  fragments  existed
 在3
6版更 改 outofrange  port  numbers  now  raise  valueerror  instead  of  returning  none
 在3
8 版更改 characters  that  affect  netloc  parsing  under  nfkc  normalization  will  now  raise  valueerror
在3
2 版更改 add  encoding  and  errors  parameters
 在3
8版更改 added  maxnumfields  parameter
 在3
2 版更改 add  encoding  and  errors  parameters
 在3
8版 更改 added  maxnumfields  parameter
 the  return  value  is  a  named  tuple  its  items  can  be  accessed  by  index  or  as  named  attributes  属 性索 引值值 如 果 不存在 scheme 0 url  方 案 说明 符 scheme  parameter  netloc 1 网络位 置部 分空 字 符串 path 2分 层 路径空 字 符串 query 3查询组件 空字 符 串 fragment 4 片 段识 别 空字符 串 username 用户名 none  password  密 码 none  hostname 主 机 名 小写 none  port  端口 号为整 数如果存 在 none  reading  the  port  attribute  will  raise  a  valueerror  if  an  invalid  port  is  specified  in  the  url
 see  section 结 构化 解析结果 for  more  information  on  the  result  object
 在3
6版 更改 outofrange  port  numbers  now  raise  valueerror  instead  of  returning  none
在3
8版 更改 characters  that  affect  netloc  parsing  under  nfkc  normalization  will  now  raise  valueerror
 注解 if  url  is  an  absolute  url  that  is  it  starts  with  or  scheme  the  urls  hostname  andor  scheme  will  be  present  in  the  result
在3
5版 更改 behavior  updated  to  match  the  semantics  defined  in  rfc 3986
 the  return  value  is  a  named  tuple  its  items  can  be  accessed  by  index  or  as  named  attributes 属 性索引值 值如果 不存在 url 0 url  with  no  fragment 空 字符 串 fragment 1 片 段 识 别 空字符串 see  section  结 构 化解 析 结 果 for  more  information  on  the  result  object
 在3
2版 更改 result  is  a  structured  object  rather  than  a  simple 2 tuple
 解析 ascii 编 码 字 节
在3
2版 更改 url  parsing  functions  now  accept  ascii  encoded  bytesequences
 结 构 化解 析结果
3
2新 版 功能
3
2 新版 功能
3
2 新 版功 能
3
2新 版功 能
url  quoting
 在3
7版更 改 moved  from  rfc 2396 to  rfc 3986 for  quoting  url  strings
在3
9 版更 改 string  parameter  supports  bytes  and  str  objects  previously  only  str
在3
2版更 改 query  supports  bytes  and  string  objects
3
5新 版功能 quotevia  参 数
 参 见 rfc 3986统 一 资 源标识符 this  is  the  current  standard  std 66
 rfc 2396 统 一 资 源 标识 符 uri 通 用语 法 document  describing  the  generic  syntactic  requirements  for  both  uniform  resource  names  urns  and  uniform  resource  locators  urls
urllibrequest 用 于打 开 url  的 可扩 展库
request  对象
fullurl  传给 构 造 函数的原始 url
 在3
4版 更改
originreqhost 请 求的 原 始主 机不含 端 口
selector  uri 路径
 若 request 使 用代 理选 择器将会是 传给 代 理的完整 url
 在3
4版更改 changing  value  of  request
data  now  deletes  contentlength  header  if  it  was  previously  set  or  calculated
unverifiable  布 尔表 明请 求是 否为 rfc 2965 中 定义的无 法证 实 的
3
3新 版 功能
 在3
4版更改 a  default  value  can  now  be  set  in  subclasses  previously  it  could  only  be  set  via  the  constructor  argument
 在3
3版 更改 getmethod  now  looks  at  the  value  of  request
addunredirectedheaderkey  header 添加 一个不 会被 加入 重定 向请求 的 头部
3
4 新版 功 能
getfullurl 返 回构 造 器 中 给定的 url
在3
4 版更改
 返回 request
 在3
4版 更改 the  request  methods  adddata  hasdata  getdatagettype  gethost  getselector  getoriginreqhost  andisunverifiable  that  were  deprecated  since 3
openerdirector 对 象
openerdirector  实例 有以 下方 法 openerdirector
 protocolopen — 句柄 知道 如何 打 开 protocol  urls  的 信 号
查 看 basehandler
protocolopen 以 获 取更 多信 息
查 看 basehandler
httperrornnn 以 获取 更多信息
 protocolerror — 句 柄知道如何处理 来自 非 http  protocol 的 错误的信 号
 protocolrequest —句 柄知 道如何 预处 理 protocol 请求 的信 号
查看 basehandler
protocolrequest 以 获取 更 多信 息
 protocolresponse —句 柄知 道如 何后处理 protocol  响应 的 信号
 查看 basehandler
protocolresponse  以获 取更 多 信息
basehandler 对象
 注 解 the  convention  has  been  adopted  that  subclasses  defining  protocolrequest  or  protocolresponse  methods  are  named  processor  all  others  are  named  handler
httpredirecthandler 对 象
 注 解 some  http  redirections  require  action  from  this  modules  client  code
注解 the  default  implementation  of  this  method  does  not  strictly  follow  rfc 2616 which  says  that 301 and 302 responses  to  post  requests  must  not  be  automatically  redirected  without  confirmation  by  the  user
httpcookieprocessor 对 象
proxyhandler 对 象
httppasswordmgr  对 象
httppasswordmgrwithpriorauth 对 象
abstractbasicauthhandler 对象
httpbasicauthhandler  对象
proxybasicauthhandler  对 象
abstractdigestauthhandler  对象
httpdigestauthhandler 对 象
proxydigestauthhandler 对 象
httphandler 对 象
httpshandler  对 象
filehandler 对 象
 在3
2版 更改 this  method  is  applicable  only  for  local  hostnames
 when  a  remote  hostname  is  given  an  urlerror  is  raised
datahandler  对 象
ftphandler  对 象
cacheftphandler 对 象
unknownhandler  对 象
httperrorprocessor 对 象
 示例
in  addition  to  the  examples  below  more  examples  are  given  in  howto  使用 urllib  包 获取网络 资 源
legacy  interface
urlopenerproxiesnone  x 5093
3版后 已移 除
3
3版 后已 移除
 注解 according  to  the  letter  of  rfc 2616301 and 302 responses  to  post  requests  must  not  be  automatically  redirected  without  confirmation  by  the  user
注 解 when  performing  basic  authentication  a  fancyurlopener  instance  calls  its  promptuserpasswd  method
urllibrequest  restrictions
 在3
4版更改 added  support  for  data  urls
urllibrobotparser  robotstxt  语 法 分析 程序
源 代码 liburllibrobotparser
py  此 模 块提 供了 一个 单 独的类 robotfileparser 它 可以 回答关 于 某 个 特定 用户代理 是 否能 在 web 站点 获 取发 布 robots
txt 文 件 的 url 的问 题
有关 robots
txt  文 件 结构 的更 多细 节请 参阅 httpwww
robotfileparserurl 这 个 类提 供 了 一些 可以读 取、 解 析 和回 答关 于 url  上的 robots
txt  文件 的问题 的 方法
 seturlurl  设 置指 向 robots
txt 文 件的 url
 read  读取 robots
txt  url 并将 其 输 入 解析器
 parselines  解析 行参 数
 canfetchuseragent  url  如果 允 许 useragent 按 照 被解 析 robots
txt 文 件 中的 规则 来 获取 url  则返回 true
 mtime  返回 最近 一次获 取 robots
txt 文 件 的时间
这适 用于 需要 定期检查 robots
txt  文件 更 新情 况 的 长 时 间运 行的网页爬 虫
 modified 将 最近一 次获 取 robots
txt 文 件的 时间 设置 为当前 时间
 crawldelayuseragent 为 指定 的 useragent 从 robots
txt 返 回 crawldelay  形参
 如果 此形 参不存 在 或不适用 于指定 的 useragent 或 者此形参 的 robots
txt 条 目 存在 语 法 错误 则返回 none
3
6 新 版 功能
 requestrateuseragent 以 named  tuple  requestraterequests  seconds  的 形式 从 robots
txt 返 回 requestrate 形 参的 内容
 如果此 形 参不存 在或不 适 用于指定 的 useragent 或者 此形 参的 robots
txt  条 目存 在语法错误 则返 回 none
3
6 新版功 能
 sitemaps 以 list 的 形式从 robots
txt 返 回 sitemap 形 参 的内容
 如果此 形参不 存在 或 者 此形参的 robots
txt  条目存 在语 法错误则 返回 none
3
8 新版功能
 下面 的 例 子演示了 robotfileparser  类 的基 本 用法 import  urllib
urllib  url 处 理 模块
源 代码 liburlliburllib  是一个收 集了 多个 涉及 url 的模 块的 包 urllib
request 打 开和 读取 url  urllib
error 包 含 urllib
request 抛 出的异常 urllib
parse  用 于解 析 url  urllib
robotparser  用于解析 robots
txt  文 件
uu 对 uuencode 文 件进 行编 码与 解码
uuid  uuid  objects  according  to  rfc
safeuuid 3
7 新 版 功能
fields 以元 组形 式存 放的 uuid 的6个 整数域有 六个 单独 的属 性和两 个 派 生 属性域意 义 timelow  uuid 的前32位 timemid  接前 一域 的16位 timehiversion  接 前一 域 的16位 clockseqhivariant 接 前一 域 的8位 clockseqlow 接 前一 域 的8 位 node  uuid  的最 后48 位 time  uuid  的 总长60 位 的时 间 戳 clockseq 14 位的 序列 号 uuid
3
7新 版功 能
在3
7 版 更 改 universally  administered  mac  addresses  are  preferred  over  locally  administered  mac  addresses  since  the  former  are  guaranteed  to  be  globally  unique  while  the  latter  are  not
 参见 rfc 4122 a  universally  unique  identifier  uuid  urn  namespace  this  specification  defines  a  uniform  resource  name  namespace  for  uuids  the  internal  format  of  uuids  and  methods  of  generating  uuids
 示例
venv  创 建虚拟环 境
3
3新 版功能
源 码 libvenvvenv  模块支 持使 用 自己 的站 点目录 创建 轻 量 级 虚拟环境可 选 择 与系统 站点目录 隔离
 每 个虚 拟环 境 都有自 己的 python  二进制 文件 与用于创 建此 环 境的 二 进制文件 的版 本 相 匹配并 且 可以 在其站点 目 录 中 拥有 自己 独立的已 安装 python  软件包 集
 有 关 python  虚拟 环境 的 更 多 信息请参 阅 pep 405
参 见 python 打包 用户 指南创建 和使 用虚拟 环境
 创建虚 拟 环境
api
 一个扩展 envbuilder  的 例子
warnings  warning  control
 源代 码 libwarnings
 c  programmers  use  pyerrwarnex  see 异常 处 理 for  details
参 见 logging
 警告类 别
the  following  warnings  category  classes  are  currently  defined  class 描 述 warning  this  is  the  base  class  of  all  warning  category  classes
在3
7 版更 改 previously  deprecationwarning  and  futurewarningwere  distinguished  based  on  whether  a  feature  was  being  removedentirely  or  changing  its  behaviour
 they  are  now  distinguished  basedon  their  intended  audience  and  the  way  theyre  handled  by  the  defaultwarnings  filters
the  warnings  filter
 each  entry  is  a  tuple  of  theform  action  message  category  module  lineno  where  action  is  one  of  the  following  strings 值处置 default  为发 出警 告的每个 位 置模 块行 号 打印第一 个 匹 配警 告 error 将匹 配警告转换 为异 常 ignore  从不 打印 匹配的 警告 always  总是 打印匹配 的警 告 module  为发出 警 告的每 个 模块打 印第 一次 匹配 警 告无 论 行 号 如 何 once 无 论 位置 如何仅 打 印 第一 次出现 的匹 配警 告 message  is  a  string  containing  a  regular  expression  that  the  start  of  the  warning  message  must  match
describing  warning  filters
 默认 警告过 滤 器
 在3
2版 更 改 deprecationwarning  is  now  ignored  by  default  inaddition  to  pendingdeprecationwarning
 在3
7版更 改 deprecationwarning  is  once  again  shown  by  defaultwhen  triggered  directly  by  code  in  main
 在3
7 版更 改 byteswarning  no  longer  appears  in  the  default  filterlist  and  is  instead  configured  via  sys
warnoptions  when  b  isspecified  twice
overriding  the  default  filter
 暂 时禁 止警告
 测试 警告
updating  code  for  new  versions  of  dependencies
available  functions
在3
6 版更 改 added  source  parameter
在3
6 版 更 改 add  the  source  parameter
available  context  managers
 注 解 the  catchwarnings  manager  works  by  replacing  and  then  later  restoring  the  modules  showwarning  function  and  internal  list  of  filter  specifications
wave  读 写 wav 格式 文件
waveread  对象
wavewrite  对 象
对 于 可查找 的输 出流 wave 头 将自动 更新 以反 映实 际写入的 帧 数
 对于 不 可查 找的 流当 写 入第一帧时 nframes  值必 须准 确
获取 准确 的 nframes 值 可以通 过调用 setnframes  或 setparams 并 附 带 close  被调用 之 前将要 写入的帧 数然 后使 用 writeframesraw  来写入帧数 据或 者 通过 调 用 writeframes 并 附带 所有 要写 入的帧
 在 后一 种情 况下 writeframes  将计算数 据中 的帧数 并 在写 入帧 数据之前 相应 地设 置 nframes
由 open  返回的 wavewrite  对象 有以 下 几种方 法在3
4 版更改添 加 了对不可 搜 索 文件 的 支持
close  确保 nframes 是 正确的并 在 文件 被 wave  打开 时 关闭 它
此方 法会 在对象收 集 时 被调 用
 如果 输出 流 不可 查找 且 nframes 与实 际写入 的帧 数不匹 配时 引 发 异 常
setnchannelsn 设 置声道 数
setsampwidthn 设置 采样 字 节长 度为 n
setframeraten  设置 采样频 率 为 n
 在3
2版更 改 对此 方法 的 非整 数输 入 会 被舍 入到最接 近 的整 数
setnframesn 设 置 总 帧数为 n
 如 果 与之 后实 际写 入的 帧数 不一致此 值将 会被 更改 如果 输出 流不 可查 找则 此 更改 尝试 将引发 错 误
setcomptypetype  name 设置压 缩格式
 目前只 支持 none  即无 压缩 格式
setparamstuple  tuple  应该 是 nchannels  sampwidth  framerate  nframes  comptype  compname 每 项的值应 可用 于 set 方法
 设置 所有 形参
tell 返 回当前 文 件指 针 其指针 含 义和 waveread
tell 以及 waveread
setpos  是一致 的
writeframesrawdata 写入 音 频 数 据 但不 更新 nframes
 在3
4版 更改现 在可 接受 任 意 byteslike  object
writeframesdata 写 入音频 帧 并 确保 nframes  是正 确的
 如 果 输 出流不 可查找且 在 data  被 写入 之后 写 入 的 总帧 数与 之前设 定的 has  been  written  does  not  match  the  previously  set  value  for  nframes  值 不匹 配将会 引发错 误
 在3
4版 更改 现 在可接受 任 意 byteslike  object
注 意 在调用 writeframes 或 writeframesraw 之 后 再 设置 任何 格式 参 数是无 效的 而 且任 何 这样的尝 试将 引发 wave
weakref  弱 引 用
弱 引用 对象
弱 引用 对象 没有 ref
callback  以外 的 方法 和属性
一 个 弱引用对 象 如果 存在 就允 许通 过调用 它来 获取 引 用 import  weakref  class  object
refo  o 2 r  o  is  o 2 true  如 果 引用 已 不 存 在则调用 引 用 对象将 返回 none  del  o  o 2 printrnone  检测一 个弱 引用 对象是否 仍然存 在 应该 使 用表 达 式 ref  is  not  none
通常需 要使用 引用 对 象 的 应 用 代 码应 当 遵循 这 样 的 模式 r  is  a  weak  reference  object  o  r  if  o  is  none  referent  has  been  garbage  collected  printobject  has  been  deallocated  cant  frobnicate
dosomethinguseful  使 用 单 独 的存活 测试会在 多 线 程 应用中 制造 竞 争条件 其 他线程 可 能 导 致某个 弱引 用 在 该弱 引 用 被调 用前 就失 效上 述 的 写法 在 多线 程 应用 和 单线程 应用 中 都是 安全 的
 特 别版 本的 ref  对象可以 通 过子 类 化来创建
 在 weakvaluedictionary  的实现中 就 使用了 这种 方式 来减 少映 射中 每个 条 目 的 内 存 开销
这对 于将附 加信 息关 联到 引 用的 情况 最 为 适用 但 也可以被用 于在 调 用 中插 入额 外 处 理来 提 取引用
 这个 例 子演 示了如何 将 ref 的 一个子类 用于 存 储有 关对 象的 附 加 信 息 并 在引用被 访问时 影 响 其所 返回 的值 import  weakref  class  extendedrefweakref
示 例
 这个 简单 的例 子演 示 了 一 个 应用 如何使用 对 象 id 来 提取 之 前出 现过 的对 象
然 后 对象 的 id  可以 在 其 它数 据 结构 中使 用而 无须 强制 对 象保 持存 活 但 处于 存活 状态的对 象也仍然 可以 通过 id 来提 取
终 结器对 象
 使用 finalize  的主 要好处 在 于 它 能 更 简 便 地注册 回调函 数 而 无须保 留所返 回的 终 结器 对象
 例 如 import  weakref  class  object
 del  kennyyou  killed  kenny  终结 器也 可以 被 直接 调用
但是 终 结 器最多只能 对 回调 函数 发起 一次 调用
alive  f  callback  not  called  because  finalizer  dead  del  obj  callback  not  called  because  finalizer  dead 你 可以 使 用 detach 方 法 来 注 销一 个终结 器
该 方法 将 销毁终 结 器 并返 回其 被创 建时传 给 构 造器 的参 数
alive  assert  newobj  is  obj  assert  funcargs  kwargs 6 callback  除非 你将 atexit  属性 设为 false  否 则 终 结 器 在 程序 退出 时 如果仍 然存 活就 将被 调用
例如 obj  object  weakref
 比 较 终结 器与 del  方法
 假 设 我们 想 创建 一个类 用 它的 实 例 来 代 表临 时目 录
 当 以下事 件中的某 一个 发 生 时这个 目录应当 与 其 内 容一 起 被 删 除 对象被 作为 垃圾 回 收 对 象 的 remove  方法被 调用 或 程 序退出
我 们 可以尝 试 使 用 del 方 法来 实现 这 个类 如 下 所 示 class  tempdir  def  initself  self
remove  从 python 3
4 开始 del 方 法不 会 再 阻 止循 环引用 被作 为垃圾 回 收 并 且 模 块 全 局 变量 在 interpreter  shutdown  期 间 不 会被 强 制 设为 none
 因 此 这 段代 码在 cpython  上 应该会 正常 运行 而 不 会 出 现任何 问 题
 然 而 del  方法 的处 理 会严 重地受到 具 体实现的 影响 因为 它 依 赖于解 释器垃圾 回 收实 现方 式 的内 部细 节
更健 壮的 替 代 方 式可 以 是定 义 一 个 终结 器只引 用 它所 需要 的特 定 函 数 和对 象而 不是 获 取对 整 个对 象 状态 的访问权 class  tempdir  def  initself  self
alive  像 这样 定义 后我 们 的终 结器将 只接 受一 个 对 其 完成 正 确 清理 目录 任务 所需细 节的 引用
如果 对象 一直 未 被 作为 垃圾 回收 终 结器 仍会 在退 出时 被调 用
 基 于弱 引用 的终结 器 还 具 有 另 一 项优 势 就是 它们可被用 来 为 定义 由第 三方 控制 的 类 注 册 终结 器 例如 当一 个模 块 被卸 载时 运 行特 定 代码 import  weakref  sys  def  unloadingmodule  implicit  reference  to  the  module  globals  from  the  function  body  weakref
modulesname  unloadingmodule 注 解如 果当程 序 退 出时你 恰 好 在 守 护 线程 中创 建终 结器对 象则 有可能 该 终结器 不 会 在退 出时 被调 用
 但是 在 一 个 守护 线 程中 atexit
register  try 
 和 with 
同 样不 能保 证执 行清 理
webbrowser 方 便 的 web 浏览 器控 制 器
 源码 libwebbrowser
pywebbrowser  模块提 供 了一 个高 级接 口允 许 向用 户显示 基于 web  的 文档
 在大 多数 情 况 下只需从 该模 块 调 用 open 函 数就可 以了
 在 unix 下 图形 浏览 器 在 x 11 下 是 首 选但 如 果 图 形浏览 器不可 用 或 x 11 显示 不可 用 则将使用 文本 模式 浏览 器
 如果 使用 文 本 模 式浏 览 器则 调 用 进程 将阻 塞 直 到用户 退 出浏 览器
 如 果 存在环 境 变量 browser 则 将 其解 释 为 os
pathsep  分 隔的 浏览 器列 表 以便 在 平台 默 认值 之 前尝试
 当列 表 部 分的值 包含 字符 串％ s 时它被解 释 为 一 个 文字 浏览 器命令 行用 于替换％ s  的参 数 url  如果 该部 分不 包含％ s  则它只 被解 释 为要 启 动的浏 览 器 的 名称
1 对于 非 unix 平 台或 者 当 unix  上 有 远 程浏览 器时控制 过程 不会 等 待用 户 完成 浏览 器 而 是 允 许 远 程 浏览 器 在显 示 界 面上 维 护 自 己 的 窗 口
如 果 unix  上没 有 远 程 浏 览器 控制 进 程 将启动 一个 新 的浏 览 器并 等 待
脚 本 webbrowser  可 以用 作 模 块的 命令 行 界 面
 它接受一 个 url 作 为参数
 还接受 以下可 选 参数 n  如 果可 能 在新 的浏 览 器 窗 口中 打开 url  t 在新 的浏 览器 页面 标签 中打开 url
 这些 选择 当然 是相 互 排 斥 的
 用法 示 例 python  m  webbrowser  t  httpwww
org  定 义 了以 下 异常 exception  webbrowser
error  发 生浏 览 器控 件 错误 时引 发 异常
 定义 了 以下 函数 webbrowser
openurl  new 0 autoraisetrue  使 用默 认浏 览器 显示 url
如 果 new 为0 则 尽可 能在同 一浏 览器 窗 口中 打开 url
 如果 new  为1则 尽 可能 打开 新的 浏览器 窗口
 如果 new  为2 则 尽可能打 开新 的浏 览器 页面标 签
 如 果 autoraise  为 true 则会尽可 能置 前 窗 口请注意在 许 多 窗口 管理 器 下无 论此 变量的 设置如 何都 会置 前 窗 口
请 注意 在 某些 平台 上 尝试 使用 此 函数 打 开 文件名 可能 会 起 作 用并 启动 操作 系 统的关 联程 序
但是 这种 方式 不被 支持 也不 可 移植
使 用 url 参 数会 引发 auditing  event  webbrowser
open 
opennewurl  如 果可 能在 默认 浏 览器的 新窗 口 中 打 开 url  否 则在 唯 一的浏 览器窗口中 打 开 url
opennewtaburl 如 果 可 能在 默 认 浏览 器 的 新 页面 标签中 打开 url  否 则等效 于 opennew
getusingnone  返回 浏览 器 类 型为 using 指定 的控制器 对象
 如果 using  为 none 则 返 回适 用于 调用 者环 境 的 默 认浏 览 器的 控 制器
registername  constructor  instancenone  preferredfalse 注 册 name 浏 览器类 型
注 册浏 览器 类型后 get  函数 可以返 回该 浏 览器 类型的 控制 器
 如 果 没 有 提 供 instance  或者为 none  constructor  将 在 没有 参 数的 情况下 被调 用以 在需要 时创建 实例
 如 果 提供 了 instance 则 永远不 会 调用 constructor  并 且可 能是 none 
 将 preferred  设置 为 true 使得 这个 浏览器 成 为 get 不带参 数调 用的 首选 结果
 否 则只 有在 您计划 设置 browser 变 量或使用 与您声明 的处 理程序 的 名称 相匹 配的 非空参 数 调用 get  时此 入口点才有 用
在3
7 版更改添 加 了仅关 键字 参 数 preferred
预 定义 了 许多 浏览 器 类 型
 此表 给出 了可 以传 递 给 get 函 数的类 型名 称以及 控 制 器类的 相应 实例化 这些 都 在此 模块 中定义
 类型 名 类 名注 释 mozilla  mozillamozilla  firefox  mozillamozilla  netscape  mozillanetscape  galeon  galeongaleon  epiphany  galeonepiphany  skipstone  backgroundbrowserskipstone  kfmclient  konqueror 1 konqueror  konqueror 1 kfm  konqueror 1 mosaic  backgroundbrowsermosaic  opera  opera  grail  grail  links  genericbrowserlinks  elinks  elinkselinks  lynx  genericbrowserlynx  w 3 m  genericbrowserw 3 m  windowsdefault  windowsdefault 2 macosx  macosxdefault 3 safari  macosxsafari 3 googlechrome  chromegooglechrome  chrome  chromechrome  chromium  chromiumchromium  chromiumbrowser  chromiumchromiumbrowser  注 释1
 konqueror 是 unix  的 kde 桌 面环境 的 文件 管理器 只 有在 kde  运 行时 才有意 义
一些 可靠 地检测 kde  的 方法 会很 好仅检 查 kdedir 变量 是不够的
 另请 注意 kde 2的 konqueror 命 令会使 用名 称 kfm 此 实现 选择 运 行的 konqueror  的 最佳策 略
仅 限 windows 平台
仅限 mac  os  x  平台
3
3 新 版功 能添 加 了 对 chromechromium 的 支持
以 下 是 一些简单 的例子 url  httpdocs
 浏览器 控制 器对 象
 浏览器 控 制器 提供三 个 与模 块 级便 捷函 数相 同的方 法 controller
openurl  new 0 autoraisetrue 使 用此 控制 器 处理 的浏览器显示 url
 如 果 new 为1则尽可 能打开 新 的浏 览器窗 口
 如果 new 为2 则尽 可能 打 开 新的浏览 器页 面标 签
opennewurl 如 果可 能在 此控 制 器处 理的 浏览 器的 新窗 口中打开 url 否 则在唯 一 的 浏 览器 窗口中 打 开 url 
 别 名 opennew
opennewtaburl 如果可 能 在 此 控 制器 处理 的浏 览 器 的 新页面 标签中打开 url  否 则等效于 opennew
脚 注1 这 里 命 名 的不 带完 整 路 径 的 可 执 行文 件 将 在 path  环境 变 量给 出的 目录中搜 索
windows 系统相 关 模 块
本章节叙 述 的模块只 在 windows 平台上 可用
 msilib  read  and  write  microsoft  installer  files  database  objects  view  objects  summary  information  objects  record  objects  errors  cab  objects  directory  objects 相 关特 性 gui  classes  precomputed  tables  msvcrt 来 自 ms  vc 运 行 时 的 有用例 程文 件操 作控制台 io 其 他 函 数 winreg  windows 注 册表 访问 函 数常数 hkey  constants  access  rights 64 bit  specific  value  types  registry  handle  objects  winsound  soundplaying  interface  for  windows
winreg  windows 注册 表访 问
这 些 函 数将 windows  注册表 api  暴露给 python
 为了确保即便 程序员忽略 了显式 关 闭 句柄该 句柄 依然 能够 正确 关闭它 使用 了一个 handle  对 象而不是 整数 来作为 注册 表句 柄
在3
3 版更改 该模 块中 的 几个 函数被用于 引 发 windowserror 该 异 常 现 在是 oserror 的别名
 函数
常数
hkey  constants
access  rights
value  types
3
6新版 功 能
3
6 新 版 功 能
registry  handle  objects
引发一个审 计 事 件 winreg
detach 附 带参数 key
winsound  soundplaying  interface  for  windows
 all  win 32 systems  support  at  least  the  following  most  systems  support  many  more  playsound  name  corresponding  control  panel  sound  name  systemasterisk  asterisk  systemexclamation  exclamation  systemexit  exit  windows  systemhand  critical  stop  systemquestion  question  例 如 import  winsound  play  windows  exit  sound
注解 this  module  does  not  support  playing  from  a  memory  image  asynchronously  so  a  combination  of  this  flag  and  sndasync  will  raise  runtimeerror
注解 this  flag  is  not  supported  on  modern  windows  platforms
 注 解 this  flag  is  not  supported  on  modern  windows  platforms
wsgiref  wsgi  utilities  and  reference  implementation
wsgirefutil  wsgi  environment  utilities
 it  should  not  be  used  by  actual  wsgi  servers  or  applications  since  the  data  is  fake 用 法示例 from  wsgiref
 用法示例 from  io  import  stringio  from  wsgiref
util  import  filewrapper  were  using  a  stringiobuffer  for  as  the  filelike  object  filelike  stringiothis  is  an  example  filelike  object 10 wrapper  filewrapperfilelike  blksize 5 for  chunk  in  wrapper  printchunk 3
8版后 已移除 support  for  sequence  protocol  is  deprecated
wsgirefheaders  wsgi  response  header  tools
gif  在3
5 版更 改 headers  parameter  is  optional
wsgirefsimpleserver  a  simple  wsgi  http  server
用 法示例 from  wsgiref
wsgirefvalidate  wsgi  conformance  checker
用法 示例 from  wsgiref
wsgirefhandlers  servergateway  base  classes
3
2 新 版 功 能
在3
3 版 更改 the  term  python  is  replaced  with  implementation  specific  term  like  cpython  jython  etc
3
2 新版功 能
示例
xdrlib  编码与 解码 xdr  数据
 源 代 码 libxdrlib
pyxdrlib 模 块 为外 部 数据 表 示 标 准 提 供 支持 该标准的 描述见 rfc 1014由 sun  microsystems  inc
 在1987年6 月撰 写
 它支 持该 rfc  中 描述 的 大部 分 数据 类 型
xdrlib 模块定义了 两个 类 一 个用于 将变 量 打 包为 xdr 表 示 形式另 一个 用 于 从 xdr  表示 形式解包
 此 外 还有两个 异常类
packer  packer  是用 于 将数据 打包 为 xdr  表 示 形 式 的类
 packer  类的实 例 化 不附 带 参数
unpackerdata  unpacker  是用 于相 应 地 从字 符串 缓 冲区解包 xdr  数 据值 的 类
 输入 缓冲 区 将 作 为 data 给 出
参 见 rfc 1014 xdr  外部 数据表示 标 准 这 个 rfc 定 义了 最 初 编写 此 模 块时 xdr  所 用的 数据 编码格式
 显然它已被 rfc 1832 所 淘 汰
 rfc 1832 xdr  外部数 据表 示标 准 更新 的 rfc 它提 供了 经修 订 的 xdr 定 义
packer 对 象
unpacker 对 象
unpacker 类 提供以 下方 法 unpacker
resetdata 使 用给定的 data  重 置 字 符串缓 冲区
getposition 返 回数 据缓冲 区中 的当 前 解包 位置
setpositionposition  将数 据 缓 冲 区 的解 包位 置 设 为 position
你 应当小 心使 用 getposition  和 setposition
getbuffer  将 当前 解包 数 据 缓冲 区 以字 符串 的形式 返回
done 表明解 包完成
如 果数据 没 有 全部完 成解包 则 会引发 error  异常
 此 外每种可 通过 packer  打包的数 据类 型都可 通过 unpacker 来 解包
 解包 方法 的形式 为 unpacktype  并且 不接 受 任 何 参 数
 该方 法 将返 回解包后 的对象
unpackfloat  解包单精 度 浮 点数
unpackdouble  解包 双精 度 浮 点 数 类 似于 unpackfloat
此 外以下 方法可用 来解包 字 符串、 字节 串以及 不透 明数据 unpacker
unpackfstringn 解 包 并返 回 固 定长 度字符 串
 n 为 期 望的 字 符数量
 会预 设以 空 字节 串填充以 保证4字 节对 齐
unpackfopaquen 解 包 并 返 回固 定长度 数据 流 类似于 unpackfstring
unpackstring  解包 并返回 可 变 长度 字符串
先 将字 符 串 的长 度解 包为 无符号整 数再用 unpackfstring 来解 包字符 串数据
unpackopaque 解包 并 返回 可变 长度不透明 数据 流 类 似于 unpackstring
unpackbytes 解 包 并返回 可 变长 度字 节流 类似 于 unpackstring
下 列 方法支持 解包 数 组和列 表 unpacker
unpacklistunpackitem 解包 并 返 回 同质条目 的列 表
该 列表 每次解 包一个元素 先解 包一 个无 符号 整数旗 标
如果 旗标为1则解 包条 目 并将其 添加到列表
 旗 标 为0 表 明列 表 结 束
 unpackitem 为 在解 包 条目 时调 用的函数
unpackfarrayn  unpackitem 解包 并以 列表 形 式返 回 由同质 条目 构 成的固 定长 度 数组
 n  为期 望的 缓冲 区 内列表 元 素数 量
 如 上 所述 unpackitem 是 解包 每个元 素时要 使用 的 函 数
unpackarrayunpackitem  解 包并 返回由 同质条 目构 成 的可 变长度 list
 先 将列 表的长 度解 包 为 无 符号整 数 再像 上面 的 unpackfarray 一 样 解 包 每 个元 素
异常
此 模 块中 的异 常会 表示 为类实例代 码 exception  xdrlib
error  基本 异 常类
 error  具有 一 个公共 属性 msg 其 中包 含对错 误的描述
conversionerror  从 error 所 派生 的类
不包 含额 外的实 例变 量
以 下 是一个 应该如何 捕获 这些异 常 的示例 import  xdrlib  p  xdrlib
xmldomminidom  minimal  dom  implementation
 警告 the  xml
 if  you  need  to  parse  untrusted  or  unauthenticated  data  see  xml  漏 洞
参见 document  object  model  dom  level 1 specification  the  w 3 c  recommendation  for  the  dom  supported  by  xml
dom  objects
 在3
8版 更 改 the  writexml  method  now  preserves  the  attribute  order  specified  by  the  user
 在3
8 版 更改 the  toxml  method  now  preserves  the  attribute  order  specified  by  the  user
 在3
8版 更改 the  toprettyxml  method  now  preserves  the  attribute  order  specified  by  the  user
dom  example
minidom  and  the  dom  standard
脚 注1 the  encoding  name  included  in  the  xml  output  should  conform  to  the  appropriate  standards
xmldompulldom  support  for  building  partial  dom  trees
 警告 the  xml
 if  you  need  to  parse  untrusted  or  unauthenticated  data  see  xml 漏 洞
 在3
1 版更改 the  sax  parser  no  longer  processes  general  externalentities  by  default  to  increase  security  by  default
 to  enableprocessing  of  external  entities  pass  a  custom  parser  instance  in  from  xml
setfeaturefeatureexternalges  true  parsefilename  parserparser 示例 from  xml
domeventstream  objects
domeventstreamstream  parser  bufsize 3
8 版 后 已移 除 support  for  sequence  protocol  is  deprecated
xmldom  the  document  object  model  api
 see  section 一致 性 for  a  detaileddiscussion  of  mapping  requirements
 参 见 document  object  model  dom  level 2 specification  the  w 3 c  recommendation  upon  which  the  python  dom  api  is  based
模块 内容
objects  in  the  dom
dom  的 权威 文档 是来 自 w 3 c 的 dom 规范
 请 注 意 dom 属性 也可以 作 为节 点而 不 是简 单 的 字符 串 进行 操作
 然而 必须 这样 做的情况相当 少见 所以这种用 法还 没有 记录下来
 接 口 部件 目的 domimplementation  domimplementation  objects  底层 实现 的接口
 node 节 点 对象 文档 中大 多数 对象的 基本 接口
 nodelist  节 点 列 表 对象节点序 列 的接 口
 documenttype  文档 类 型对 象有 关处 理 文档 所 需声 明的 信 息
 document  文 档对 象 表示 整个 文档 的对象
 element  元 素对象 文档 层次结 构中 的 元素 节点
 attr  attr 对 象元 素节 点上 的属 性值节点
 comment 注 释 对象 源文 档中 注释 的表示 形式
 text  text  和 cdatasection 对 象 包 含文档 中文本内 容的 节 点
 processinginstruction  processinginstruction 对 象 processing  instruction  representation
另一 节 描述了在 python 中 使 用 dom  定义的 异常
domimplementation  objects
 节点 对象
 注解 this  is  based  on  a  proposed  dom  level 3 api  which  is  still  in  the  working  draft  stage  but  this  particular  interface  appears  uncontroversial
 节点列表对 象
 文 档类 型对 象
文档 对 象
 元素对 象
attr 对 象
namednodemap  对 象
注释对 象
text  和 cdatasection 对 象
 注解 the  use  of  a  cdatasection  node  does  not  indicate  that  the  node  represents  a  complete  cdata  marked  section  only  that  the  content  of  the  node  was  part  of  a  cdata  section
processinginstruction  对象
 异常
the  exception  codes  defined  in  the  dom  recommendation  map  to  theexceptions  described  above  according  to  this  table  常数异常 domstringsizeerr  domstringsizeerr  hierarchyrequesterr  hierarchyrequesterr  indexsizeerr  indexsizeerr  inuseattributeerr  inuseattributeerr  invalidaccesserr  invalidaccesserr  invalidcharactererr  invalidcharactererr  invalidmodificationerr  invalidmodificationerr  invalidstateerr  invalidstateerr  namespaceerr  namespaceerr  notfounderr  notfounderr  notsupportederr  notsupportederr  nodataallowederr  nodataallowederr  nomodificationallowederr  nomodificationallowederr  syntaxerr  syntaxerr  wrongdocumenterr  wrongdocumenterr 
 一致 性
 类型映射
将 根据 下表 将 dom 规范 中使 用 的 idl 类型映射 为 python  类型
 idl  类型 python 类 型 boolean  bool  或 int  int  int  long  int  int  unsigned  int  int  domstring  str  或 bytes  null  none 
accessor  methods
xmletreeelementtree  elementtree  xml  api
源 代码 libxmletreeelementtree
pyxml
elementtree 模块 实 现了 一个 简 单高 效的 api  用 于解 析和 创 建 xml 数据
在3
3 版更改 this  module  will  use  a  fast  implementation  wheneveravailable
3
3 版 后已 移除 the  xml
celementtree  module  is  deprecated
警告 xml
elementtree  模块 对于 恶 意 构 建 的数 据是不安全 的
如果 需要解析 不 可信 或未经 身份 验证 的数据请 参 见 xml 漏 洞
 教程
这是 一个 使用 xml
elementtree  简 称 et  的简 短教程
目标 是演示 模 块的 一 些构建块 和基 本 概念
xml  树和 元素
xml  是一 种固 有的分 层数 据格 式 最 自 然的 表示方 法是 使用 树
为此 et 有 两个 类 elementtree 将 整 个 xml 文 档 表示为 一个 树 element 表示 该树 中 的 单个节点
 与整 个 文档 的交互 读写 文 件通 常 在 elementtree  级 别完 成
与 单 个 xml  元素 及其子元素 的交 互 是 在 element 级别 完成 的
 解析 xml
我们 将 使用以 下 xml 文 档 作为本节 的示 例数 据 xml  version 1
0 data  country  nameliechtenstein  rank 1 rank  year 2008 year  gdppc 141100 gdppc  neighbor  nameaustria  directione  neighbor  nameswitzerland  directionw  country  country  namesingapore  rank 4 rank  year 2011 year  gdppc 59900 gdppc  neighbor  namemalaysia  directionn  country  country  namepanama  rank 68 rank  year 2011 year  gdppc 13600 gdppc  neighbor  namecosta  rica  directionw  neighbor  namecolombia  directione  country  data  可以 通过从文 件中 读 取 来导 入此 数 据 import  xml
getroot 或 直接 从 字符串中 解析 root  et
fromstringcountrydataasstringfromstring  将 xml  从 字 符 串直接解析为 element  该 元素 是 已解 析树的根 元 素
 其他 解析 函数 可能 会创建 一 个 elementtree 
确 切 信息请 查阅 文档
 作为 element  root  具有 标签 和 属 性 字 典 root
attrib 还 有 可以 迭 代的子 节点 for  child  in  root 
 country  name  liechtenstein  country  name  singapore  country  name  panama 子 级是 可 以 嵌 套 的我们可以通 过索引 访问 特定 的子 级节 点 root 01
text 2008注 解并 非 xml  输入的 所有 元素 都 将 作 为解析树的元 素 结 束
 目前 此模块 跳 过输入 中 的任 何 xml 注释、 处 理指 令和文 档类型 声明
 然 而 使用这个 模块的 api  而不 是从 xml  文本 解析 构建 的树可以包 含注 释和 处理 指令 生成 xml 输出 时同样包 含 这 些注释 和处 理 指令
 可 以 通 过将 自 定义 treebuilder  实例 传 递给 xmlparser  构 造 函 数 来访 问文 档类 型声 明
pull  api 进 行 非阻塞 解析
 查 找 感 兴 趣的元素
element  有一 些很 有效 的方法 可帮助递 归 遍历 其 下 的所 有子树包 括 子级 子 级 的子级等 等
 例 如 element
findall  仅查 找 当 前元素 的直 接子 元素 中带 有 指定标签的 元素
element
find 找 带 有特 定 标 签 的第 一个子级 然 后 可以 用 element
text  访问 元素 的文 本 内容
 element
get 访 问元 素的 属 性 for  country  in  root
 liechtenstein 1 singapore 4 panama 68 通 过 使 用 xpath 可 以更 精 确 地指定要查 找的元素
修 改 xml  文件
 构建 xml  文档
subelement 函 数 还提 供 了 一种 便捷方法来为 给 定元素创建 新的 子元 素 a  et
使 用命名空间 解 析 xml
 其他 资源
xpath  支持
示 例
支 持 的 xpath  语法
 语法 含 义 tag  selects  all  child  elements  with  the  given  tag
 在3
8版 更改 support  for  starwildcards  was  added
 选 择 所有 子元素 包括 注释 和处 理 说 明
 例如 egg  选 择 所 有名 为 egg 的 孙元 素

选择 当 前 节点
 这 在 路径 的开 头非 常有用用于 指示 它是 相对路径
 selects  all  subelements  on  all  levels  beneath  the  current  element
 attrib 选择 具有给 定属 性的 所 有元 素
 attribvalue  选择给 定 属性具有 给 定 值 的 所有元 素
该 值 不能包 含 引号
 tag  选择所 有 包 含 tag 子 元 素 的元 素
只支持直 系 子元素

text 选择 完 整文 本内容等 于 text 的 所有 元 素 包 括后代
3
7新 版 功能
 tagtext 选择 所 有 包 含 名为 tag  的子 元 素 的 元素 这些 子 元素 包 括 后代 的完 整文本 内容 等 于 给定 的 text 
 position  selects  all  elements  that  are  located  at  the  given  position
谓词 方括 号 内 的表达 式 之前 必须 带有 标签名称星 号或其 他 谓词
position  谓词 前 必 须有 标签 名称
 参考 引 用
 函 数
0转 换功能
 典型使 用 xmldata  root
xml  outoutfile  the  configuration  options  are  as  follows  withcomments  set  to  true  to  include  comments  default  false  striptext  set  to  true  to  strip  whitespace  before  and  after  text  content 默认 值否 rewriteprefixes  set  to  true  to  replace  namespace  prefixes  by  nnumber 默 认 值否 qnameawaretags  a  set  of  qname  aware  tag  names  in  which  prefixes  should  be  replaced  in  text  content  default  empty  qnameawareattrs  a  set  of  qname  aware  attribute  names  in  which  prefixes  should  be  replaced  in  text  content  default  empty  excludeattrs  a  set  of  attribute  names  that  should  not  be  serialised  excludetags  a  set  of  tag  names  that  should  not  be  serialised  in  the  option  list  above  a  set  refers  to  any  collection  or  iterable  of  strings  no  ordering  is  expected
3
8 新 版功 能
 在3
8版 更改 the  dump  function  now  preserves  the  attribute  order  specified  by  the  user
3
2新版 功能
3
9新版 功能
 注解 iterparse  only  guarantees  that  it  has  seen  the  character  of  a  starting  tag  when  it  emits  a  start  event  so  the  attributes  are  defined  but  the  contents  of  the  text  and  tail  attributes  are  undefined  at  that  point
3
4版 后已 移 除 parser  参 数
 在3
8 版 更改 the  comment  and  pi  events  were  added
3
2 新版 功 能
3
4新 版 功 能 shortemptyelements  形参
3
8 新版 功能 the  xmldeclaration  and  defaultnamespace  parameters
在3
8版 更改 the  tostring  function  now  preserves  the  attribute  order  specified  by  the  user
3
2 新 版功 能
3
4新版功 能 shortemptyelements  形参
3
8新 版功 能 the  xmldeclaration  and  defaultnamespace  parameters
在3
8 版更 改 the  tostringlist  function  now  preserves  the  attribute  order  specified  by  the  user
xinclude 支持
示 例
 document 结果 可能 如 下 所 示 document  xmlnsxihttpwww
参 考引 用
函 数
3
9新 版功 能 the  baseurl  and  maxdepth  parameters
元 素对象
 tag 一个 标 识此 元 素意味 着何 种数 据 的字 符串 换 句 话 说元 素类 型
3
2新 版 功能
3
2 新版 功 能
3
2 新版 功能
3
2 新 版 功能
elementtree 对象
3
2 新版 功能
3
4 新版 功能 shortemptyelements 形 参
在3
8版 更改 the  write  method  now  preserves  the  attribute  order  specified  by  the  user
qname  objects
treebuilder  objects
3
8 新版功能
3
8 新版功能
3
2 新 版 功能
3
8 新 版功能
3
8 新版 功能
3
8新版 功能
xmlparser  对象
在3
8 版更改 parameters  are  now  keywordonly
 the  html  argument  no  longer  supported
xmlpullparser  对 象
注 解 xmlpullparser  only  guarantees  that  it  has  seen  the  character  of  a  starting  tag  when  it  emits  a  start  event  so  the  attributes  are  defined  but  the  contents  of  the  text  and  tail  attributes  are  undefined  at  that  point
3
4 新版功 能
在3
8 版更 改 the  comment  and  pi  events  were  added
异 常
脚 注1 the  encoding  string  included  in  xml  output  should  conform  to  the  appropriate  standards
xmlsaxhandler  base  classes  for  sax  handlers
contenthandler  对象
 注 解 the  earlier  sax 1 interface  provided  by  the  python  xml  special  interest  group  used  a  more  javalike  interface  for  this  method
dtdhandler 对象
entityresolver  对象
errorhandler  对象
xmlsaxxmlreader  interface  for  xml  parsers
xmlreader 对 象
在3
5版 更 改 added  support  of  character  streams
在3
8 版更 改 added  support  of  pathlike  objects
incrementalparser 对 象
locator 对象
inputsource 对 象
the  attributes  interface
the  attributesns  interface
xmlsax  support  for  sax 2 parsers
 警告 the  xml
 if  you  need  to  parse  untrusted  or  unauthenticated  data  see  xml 漏 洞
 在3
1版更改 the  sax  parser  no  longer  processes  general  externalentities  by  default  to  increase  security
 before  the  parser  creatednetwork  connections  to  fetch  remote  files  or  loaded  local  files  fromthe  file  system  for  dtd  and  entities
 the  feature  can  be  enabled  againwith  method  setfeature  on  the  parser  object  and  argumentfeatureexternalges
在3
8 版更 改 the  parserlist  argument  can  be  any  iterable  not  just  a  list
在3
5版 更 改 added  support  of  str  instances
 参见 sax  the  simple  api  for  xml  this  site  is  the  focal  point  for  the  definition  of  the  sax  api
saxexception  objects
xmlsaxsaxutils  sax  工具 集
源代 码 libxmlsaxsaxutils
pyxml
saxutils 模 块包 含一 些在 创 建 sax 应 用程 序 时十 分有 用 的类 和 函 数 它 们 可以被直 接使 用或 者 是作 为基类使 用
escapedata  entities 对 数据 字 符 串 中 的 和 进行 转义
 你 可以 通过 传 入一 个字 典作 为可 选的 entities 形 参来 对其 他字 符串数 据进行 转 义
字 典的键和 值 必 须 为字 符 串 每个 键将 被替 换为其 所对 应 的值
字 符 和 总 是会 被 转义 即使 提供了 entities
unescapedata  entities  对 字 符串 数 据 中 的 amp  lt 和 gt  进行 反 转 义
你 可 以 通 过传入 一个 字 典 作为 可选 的 entities  形参来 对 其 他 数 据 字 符 串 进行 转 义
 字 典的键 和 值 必须 都为字 符串 每个 键将 被替 换 为所对 应的 值
 amp  lt 和 gt 将 总是 保持 不被 转义即 使提 供了 entities
quoteattrdata  entities  类似 于 escape 但 还 会对 data  进行 处理以将 其 用 作属 性值
返回值是 data  加上 任何 额 外 要 求的替 换的 带 引号 版本
quoteattr  将基于 data  的 内 容选 择 一 个 引 号字 符 以 尽 量 避免 在 字符 串中 编 码 任 何引 号 字符
 如 果 单 双 引 号 字符 在 data  中 都 存 在 则 双引 号字 符 将 被编 码 并 且 data 将 使 用 双引号 来标记
 结 果 字 符 串 可 被直 接用 作 属性 值 printelement  attrs  quoteattrab  cd  ef  element  attrab  cd  quot  ef  此 函 数适 用于 为 html 或 任何 使 用 引 用实 体语 法 的 sgml  生 成属 性值
xmlgeneratoroutnone  encodingiso 88591 shortemptyelementsfalse  这 个类 通 过 将 sax  事件 写 回 到 xml 文 档 来实 现 contenthandler 接 口
 换句 话说使 用 xmlgenerator  作 为内 容处 理 程 序 将 重 新产 生 所 解析 的 原 始 文 档
 out  应当 为 一 个 文 件类 对象 它 默 认将 为 sys
 encoding  为 输 出 流的 编 码 格 式 它 默 认 将 为 iso 88591
 shortemptyelements 控 制 不 包含 内 容的 元 素的格式 化 如为 false  默认值 则它 们会 以 开始结 束标 记对 的 形式 被 发送 如果设 为 true 则 它们 会 以单 个自 结束 标 记 的形 式被 发 送
3
2 新 版 功 能 shortemptyelements  形 参
xmlfilterbasebase  这 个 类 被 设 计 用 来分隔 xmlreader  和客 户 端 应 用 的 事 件 处理 程 序
在 默 认情 况 下它 除了 将 请 求 传送 给读 取器 并 将事 件传 送 给 处 理程 序之 外什 么 都 不 做但 其子 类可以重 载特 定的 方法 以在 传送它 们的 时 候修改 事件 流或 配置 请求
prepareinputsourcesource  base  此 函数接受一 个 输 入 源和 一 个可 选 的基 准 url 并 返回 一 个 经过完整解 析 可供 读取 的 inputsource
输 入源 的 给 出 形式 可以 为 字符串、 文件 类对 象或 inputsource  对象 解 析器 将使 用 此函数来针 对 它 们 的 parse  方 法 实现 多态 source 参数
xml 处 理模 块
 源码 libxml 用 于 处 理 xml  的 python  接口 分 组在 xml  包中
 警告 xml  模块 对于 错误 或恶 意构造 的 数 据 是不安 全的
 如果 你 需要 解析 不受 信 任 或 未 经身 份验证 的数据请参 阅 xml 漏 洞和 defusedxml 包 部分
值 得 注意 的 是 xml 包 中的模 块要 求至 少 有 一 个 sax 兼 容的 xml 解析 器可 用
expat 解 析 器 包含 在 python 中 因此 xml
expat 模块 将 始终可用
xml
dom  和 xml
sax 包的 文档 是 dom 和 sax  接口 的 python 绑 定的 定 义
xml 处 理 子模 块包括 xml
elementtree  elementtree  api 一 个简单 而轻 量级 的 xml  处理 器 xml
domdom  api  定 义 xml
minidom  最小的 dom 实 现 xml
pulldom  支持 构 建 部分 dom  树 xml
saxsax 2基类 和便 利函数 xml
expatexpat  解 析器 绑 定
xml  漏 洞
xml 处 理模 块 对于恶 意 构造的数 据是不 安全 的
攻击 者 可 能滥用 xml  功能 来执 行 拒绝 服务攻 击、访 问本 地 文件、 生成 与其 它计算 机的 网络 连接 或绕 过防 火墙
 下 表 概 述了 已 知 的 攻 击以 及 各种模 块是 否容 易受 到攻 击
种 类 sax  etree  minidom  pulldom  xmlrpc  billion  laughs 易 受 攻击 易 受攻击易受 攻击 易受 攻击 易 受攻 击 quadratic  blowup  易 受 攻 击易受攻击 易 受 攻击 易受 攻击 易受攻 击 external  entity  expansion  安 全4 安 全1安 全2安 全4安全3 dtd  retrieval  安全4 安 全 安 全 安 全4 安全 decompression  bomb 安全 安全 安全 安全 易受 攻 击1
elementtree 不 会扩 展 外部实体并 在 实体 发 生 时引 发 parsererror
minidom 不 会扩展 外 部 实体 只 是简单 地返 回未扩 展 的实体
 xmlrpclib  不扩展 外部 实体 并 省 略 它们
 从 python 3
1开 始默 认情况 下不 再处理 外部 通 用实 体
billion  laughs  exponential  entity  expansion 狂 笑递 归 实 体扩 展 billion  laughs  攻击 也 称为 递归 实体 扩 展使 用多 级嵌 套 实体
 每个 实体 多 次 引用 另一 个实 体最 终 实体 定义 包 含一个小 字符 串
指 数 级扩 展 导致几 千 gb 的 文本 并消耗 大量内存和 cpu  时间
quadratic  blowup  entity  expansion  二 次 爆炸 实体扩展 二次 爆炸 攻 击类 似于 billion  laughs  攻击它也 滥用实 体扩 展
它 不是 嵌套实 体而是 一遍又 一 遍 地重 复一 个 具有 几 千 个字 符的大型实 体
攻击 不如 递 归 情况有 效但它 避免 触发禁 止 深度 嵌套 实体的解 析 器 对策
external  entity  expansion  实 体声 明可 以包 含 的不仅 仅是替 换 文 本
 它 们 还 可 以指 向外 部 资 源或本 地文 件
 xml 解 析器访 问 资 源 并 将 内 容 嵌入 到 xml  文 档中
dtd  retrieval  python  的一 些 xml 库 xml
pulldom 从 远程 或本 地位 置 检 索 文 档 类 型 定 义
该功 能与 外 部实 体扩展 问 题 具 有 相似 的 含义
decompression  bomb  decompression  bombs 解 压炸 弹又 名 zip  bomb 适 用 于所 有可 以解 析 压缩 xml  流 例 如 gzip  压缩 的 http  流 或 lzma  压缩 的 文件的 xml  库
对 于 攻 击 者 来说 它可 以将传 输 的 数 据 量 减少 三 个 量 级 或更多
pypi 上 defusedxml  的文档 包 含有 关所 有已知 攻击 向量 的更多信息 以 及 示例 和参 考
defusedxml 包
defusedxml  是一 个纯 python 软件包 它修改 了所 有标 准库 xml  解析 器的 子类 可 以防 止任 何潜 在的 恶意 操作
 对于 解 析不 受信任的 xml 数 据的 任何 服务器 代 码 建 议使 用此 程序 包
该软件包 还 提供 了有 关 更多 xml 漏 洞 如 xpath 注入 的示 例 漏洞 和扩 展 文 档
xmlrpcclient  xmlrpc  client  access
 源 代码 libxmlrpcclient
 警告 the  xmlrpc
 if  you  need  to  parse  untrusted  or  unauthenticated  data  see  xml  漏洞
在3
5版更 改 for  https  uris  xmlrpc
client  now  performs  all  thenecessary  certificate  and  hostname  checks  by  default
在3
3 版 更改 the  usebuiltintypes  flag  was  added
 在3
8 版更改 the  headers  parameter  was  added
both  the  http  andhttps  transports  support  the  url  syntax  extension  for  http  basicauthentication  httpuserpasshostportpath
 the  userpassportion  will  be  base 64 encoded  as  an  http  authorization  header  andsent  to  the  remote  server  as  part  of  the  connection  process  wheninvoking  an  xmlrpc  method
 you  only  need  to  use  this  if  the  remoteserver  requires  a  basic  authentication  user  and  password
 if  an  httpsurl  is  provided  context  may  be  ssl
sslcontext  and  configures  thessl  settings  of  the  underlying  https  connection
the  returned  instanceis  a  proxy  object  with  methods  that  can  be  used  to  invokecorresponding  rpc  calls  on  the  remote  server
 if  the  remote  serversupports  the  introspection  api  the  proxy  can  also  be  used  to  querythe  remote  server  for  the  methods  it  supports  service  discovery  andfetch  other  serverassociated  metadata
types  that  are  conformablee
 that  can  be  marshalled  through  xml  include  the  following  andexcept  where  noted  they  are  unmarshalled  as  the  same  python  type  xmlrpc 类型 python  数据 类 型 boolean  bool  int  i 1 i 2 int  的 范 围从2147483648 到2147483647
 值 将获得 i 4 i 8 或 者 int  标 志
 biginteger  double 或 float  float
 值 将 获 得 double  标志
 string  str  array  list 或 tuple 包 含整合 元素
 数组 以 lists 形 式返 回
 struct  dict
iso 8601 datetime  或 datetime
返 回的类 型 取 决于 usebuiltintypes  和 usedatetime  标志 的值
 base 64 binary  bytes 或 bytearray
 返 回的 类型 取 决 于 usebuiltintypes 标志的 值
 nil  none  常量
 仅 当 allownone 为 true 时才 允许 传递
 bigdecimal  decimal
 仅 返 回类 型
 this  is  the  full  set  of  data  types  supported  by  xmlrpc
 在3
5版 更改 added  the  context  argument
 在3
6版 更改 added  support  of  type  tags  with  prefixes  e
参 见 xmlrpc  howto  a  good  description  of  xmlrpc  operation  and  client  software  in  several  languages
serverproxy  对 象
 在3
5 版 更改 instances  of  serverproxy  support  the  contextmanager  protocol  for  closing  the  underlying  transport
datetime 对 象
binary 对 象
fault  对象
protocolerror  对象
multicall  对 象
convenience  functions
 在3
3版更改 the  usebuiltintypes  flag  was  added
example  of  client  usage
example  of  client  and  server  usage
脚 注1 this  approach  has  been  first  presented  in  a  discussion  on  xmlrpc
xmlrpcserver  basic  xmlrpc  servers
警 告 the  xmlrpc
 if  you  need  to  parse  untrusted  or  unauthenticated  data  see  xml 漏 洞
在3
3 版 更改 the  usebuiltintypes  flag  was  added
 在3
3 版更改 the  usebuiltintypes  flag  was  added
simplexmlrpcserver  objects
 在3
7版 更改 registerfunction  can  be  used  as  a  decorator
 警告 enabling  the  allowdottednames  option  allows  intruders  to  access  your  modules  global  variables  and  may  allow  intruders  to  execute  arbitrary  code  on  your  machine
simplexmlrpcserver  example
 警告 enabling  the  allowdottednames  option  allows  intruders  to  access  your  modules  global  variables  and  may  allow  intruders  to  execute  arbitrary  code  on  your  machine
cgixmlrpcrequesthandler
在3
7版 更 改 registerfunction  can  be  used  as  a  decorator
 示例 class  myfuncs  def  mulself  x  y  return  x  y  handler  cgixmlrpcrequesthandler  handler
documenting  xmlrpc  server
在3
3 版 更 改 the  usebuiltintypes  flag  was  added
docxmlrpcserver  objects
doccgixmlrpcrequesthandler
xmlrpc  xmlrpc 服 务端与客户 端模 块
xmlrpc  是一 种 远程过 程调用 方法 它 使 用通 过 http  传递 的 xml 作 为载 体
 有 了它 客 户 端可以在 远程 服务 器上 调用 带参 数的方 法服 务 器 以 uri 命 名并 获 取 结构化 的数 据
xmlrpc 是 一个 集合 了 xmlrpc  服务端 与客户 端 实现 模块 的包
这 些模 块 是 xmlrpc
zipapp  manage  executable  python  zip  archives
3
5 新 版功 能
 the  module  provides  both  a 命 令行 接 口 and  a  python  api
basic  example
the  following  example  shows  how  the 命 令行 接口 can  be  used  to  createan  executable  archive  from  a  directory  containing  python  code
 whenrun  the  archive  will  execute  the  main  function  from  the  modulemyapp  in  the  archive
命令行 接口
3
7 新版 功 能
python  api
3
7 新 版 功能 added  the  filter  and  compressed  arguments
 示例
specifying  the  interpreter
creating  standalone  applications  with  zipapp
making  a  windows  executable
caveats
the  python  zip  application  archive  format
zipfile  使用 zip  存 档
源代码 libzipfile
pyzip  文件格 式是 一个 常 用的归档 与压缩标准
 这个 模 块提供 了创 建、读 取、 写入、添加及 列出 zip  文 件的工 具
任 何对 此模 块 的 进阶使用 都 将需 要理 解此 格式其 定义 参见 pkzip  应用 程 序 笔 记
此 模块目前不能 处 理分 卷 zip 文件
 它可以 处理 使用 zip 64 扩展 超过4 gb  的 zip 文 件 的 zip 文 件
它支持 解密 zip 归档中 的 加 密文件但是 目 前 不 能创建 一个 加密 的文 件
解密 非 常慢因为 它是 使用 原生 python 而不 是 c 实 现的
这个模 块定义 了 以 下内容 exception  zipfile
badzipfile  为损 坏的 zip  文 件 抛出的 错误
3
2 新 版功 能
badzipfile  badzipfile 的 别名与 旧版 本 python 保持兼 容性
3
2 版后 已移除
largezipfile  当 zip  文 件 需 要 zip 64功能但 是未启 用时 会 抛出 此错 误
zipfile 用 于读 写 zip 文 件的类
欲了 解 构造 函数 的描述 参阅段 落 zipfile 对 象
path 用 于 zip  文件 的兼容 pathlib  的 包装 器
 详 情 参见 path 对象
3
8 新 版功 能
pyzipfile  用于 创建 包 含 python  库的 zip  归 档的 类
zipinfofilenamenoname  datetime 198011000用 于表 示 档案 内 一个成 员信 息的 类
此 类的 实例 会由 zipfile  对象 的 getinfo 和 infolist  方 法 返回
大 多数 zipfile  模块 的用 户都 不必 创 建它 们只 需使用 此 模块 所创 建的实 例
 filename 应 当是档 案成员的 全名 datetime  应 当 是 包 含六 个字 段的描 述最 近修 改时 间的元 组这些 字段 的描述 请 参 阅 zipinfo  对 象
iszipfilefilename  根 据 文件的 magic  number  如果 filename  是一个 有效 的 zip 文件则 返回 true 否 则 返 回 false
 filename 也 可 能 是一 个文 件 或 类 文件对 象
在3
1 版 更 改 支持 文件 或类 文件 对象
zipstored  未被压缩的 归档 成员 的数 字 常 数
zipdeflated 常 用的 zip 压 缩方 法的数 字常数
 需要 zlib  模块
zipbzip 2 bzip 2 压 缩方法的 数字 常 数
 需 要 bz 2模 块
3
3 新版 功能
ziplzma  lzma  压缩 方法的 数字 常 数
需 要 lzma 模块
3
3 新 版 功能
 注解 zip 文件 格 式 规范 包 括自2001年以 来 对 bzip 2压缩 的 支持 以及 自2006年以 来 对 lzma  压 缩的 支持
 但是一 些工 具包括 较 旧 的 python 版 本不支持 这 些 压 缩 方 法并 且 可能拒绝完 全 处理 zip 文 件或 者无 法 提取单个 文 件
参见 pkzip  应用 程 序笔 记 phil  katz 编写的 zip  文件 格式文 档此格 式和 使用的 算法 的创建 者
 infozip  主页 有 关 infozip 项目的 zip  存档 程序 和 开发库 的信 息
zipfile  对象
path 对 象
pyzipfile 对 象
pyzipfile  构 造器 接受 与 zipfile 构 造器 相同的 形 参 以 及 一个额 外的形 参 optimize
pyzipfilefile  moder  compressionzipstored  allowzip 64 true  optimize 13
2 新版功 能 optimize  形参
在3
4版更 改默 认启用 zip 64 扩展
 实例 在 zipfile  对象 所具 有 的方 法以 外还 附加 了 一 个 方 法 writepypathname  basename  filterfuncnone 查 找
py 文 件并将 相应 的 文件 添加到 归档
 如 果 pyzipfile 的 optimize  形参 未给 定或为1则相 应的 文 件为
pyc 文件 并在 必要 时进行 编译
如 果 pyzipfile  的 optimize 形 参为01或2 则限 具有 相 应优 化 级别参 见 compile 的 文件 会被 添加 到归档 并在必 要时 进 行编 译
如 果 pathname  是文 件 则 文件 名 必须 以
py  为后 缀并且 只 有相应的
pyc  文件会被 添加到最 高层 级不 带路径信息
 如果 pathname  不是以
py  为 后缀 的文件则 将 引发 runtimeerror
 如果它是目 录并且该目录 不是一 个 包目录则 所 有的
pyc 文件 会被添 加到 最 高层 级
如 果目 录 是一 个包目录则 所 有的
pyc  会被 添加到 包名所 表示 的 文件 路 径 下 并且 如 果有 任 何 子目 录为 包目 录则会 以排 好的顺 序递 归 地添 加 这些 目录
 basename 仅 限在内 部使 用
如果 给定 filterfunc 则 它必 须 是一个接 受单 个字符串参 数的 函数
 在将 其添 加到归档 之前 它将 被传入每 个路 径包括每 个单独 的完 整路径
如 果 filterfunc  返回假值 则 路径 将不 会被添加 而 如果它是 一个目录 则其内容 将 被忽略
例 如 如果我们 的测试文 件 全都位于 test  目录 或 以字 符串 test  打头则我 们 可以使用 一 个 filterfunc 来 排 除它 们 zf  pyzipfilemyprog
writepymyprog  filterfuncnotests  writepy 方 法会产生 带 有这 样一 些文件名 的 归档 string
myfile 3
4新版 功能 filterfunc  形参
在3
2 版更改 pathname 形 参接 受一 个 pathlike  object
 在3
7版 更 改递 归 排序 目录条目
zipinfo 对 象
zipinfo 类的 实 例 会通 过 getinfo  和 zipfile 对象 的 infolist 方 法 返回
 每个 对象 将 存储关于 zip  归档 的一 个成 员的 信息
有 一个类 方法 可以为文 件系 统文件 创建 zipinfo  实例 classmethod  zipinfo
fromfilefilename  arcnamenone  stricttimestampstrue  为文 件系统 中的 文件 构 造一个 zipinfo 实例 并准 备 将其添 加 到 一 个 zip  文 件
 filename 应为 文 件 系统 中某 个 文件或 目 录的路径
 如果 指定了 arcname 它会 被用作 归档 中的 名称
 如果 未指 定 arcname  则 所 用 名 称 与 filename  相同但 将去 除 任何驱 动器 盘符 和 打头 的路 径分 隔符
 stricttimestamps  参 数 在 设 为 false 时 允许压 缩 早于19800101 的文件代 价时会 将 时 间戳 设为19800101
 类似的 行为 也 会对 晚 于21071231的文件 发生 时间 戳 也 会 被设 为该上 限值
3
6 新版 功能
 在3
2版更 改 filename  形参 接 受 一个 pathlike  object
3
8 新版 功能 stricttimestamps  仅限关 键字 参 数 实 例 具 有下 列方 法 和属 性 zipinfo
isdir 如 果 此归 档成员 是 一 个目 录 则返 回 true
这 会 使用 条目 的名称 目 录应 当总 是 以结 尾
3
6 新 版 功 能
filename  归档 中 的 文件 名称
datetime  上次 修 改 存 档成 员 的 时 间 和 日期
 这是六 个值 的元组 索 引 值0 year 19801月1为基 数2月 份 中 的 日 期1为基 数3小 时0为 基 数4分 钟0 为 基 数5 秒0 为 基 数 注解 zip  文 件格式 不支 持1980年 以前 的时 间戳
compresstype  归 档 成员 的压 缩类型
comment  bytes  对 象 形式 的 单 个归档 成员 的注 释
extra 扩 展字 段数 据
 pkzip  application  note 包 含一些保 存 于 该 bytes 对象 中的 内 部 结构 的注 释
createsystem 创 建 zip 归 档 所用 的系统
createversion 创 建 zip 归 档所 用的 pkzip  版本
extractversion  需要 用来提取 归 档的 pkzip 版本
reserved  必须 为零
flagbits  zip  标志 位
volume  文 件 头的 分 卷 号
internalattr 内 部 属 性
externalattr 外部文 件 属 性
headeroffset  文 件 头 的 字节 偏 移量
crc  未压缩 文 件的 crc 32
compresssize  已 压 缩数 据的 大 小
filesize  未压缩 文件 的大 小
命 令行 界面
zipfile  模块提供 了简 单的 命 令 行 接 口用 于 与 zip 归 档 的交 互
 如 果 你想 要 创 建一个 新 的 zip  归档 请在 c  选 项 后指 定 其名 称然 后列 出应 当被 包 含 的 文 件名 python  m  zipfile  c  monty
txt 传 入 一个 字典也 是可 接受的 python  m  zipfile  c  monty
zip  lifeofbrian 1979 如果 你 想要将 一 个 zip  归档 提取 到 指定 的 目录 请使 用 e  选项 python  m  zipfile  e  monty
zip  targetdir 要 获取 一个 zip  归 档 中的文 件 列表 请使 用 l  选项 python  m  zipfile  l  monty
 命令 行 选项
l  zipfilelist  zipfile  列 出 一个 zipfile 中 的 文件 名
 sourcen 基 于源 文件 创建 zipfile
e  zipfile  outputdirextract  zipfile  outputdir  将 zipfile  提取 到目标 目 录 中
t  zipfiletest  zipfile 检测 zipfile  是否 有 效
解压 缩的 障碍
zipfile  模 块 的提取 操作 可能 会 由 于 下面列 出的 障 碍 而 失败
由于 文件 本身
 解 压 缩可能 由于 不正 确 的 密 码 crc  校 验 和 zip 格式 或不 受 支 持的 压 缩解密 方法 而失 败
文 件 系统 限制
 超 出特 定文件 系 统 上的限 制可 能 会 导 致解 压 缩失 败
 例如目 录条 目 所允许的字符、 文 件名 的 长 度、 路 径名 的 长度、 单个文 件 的 大 小 以及 文 件 的数量 等 等
资 源 限 制
 缺 乏 内 存 或磁盘 空间 将 会导 致解 压缩 失 败
例如 作用于 zipfile  库的解 压缩 炸 弹即 zip  bomb  就可能 造 成磁 盘空 间耗 尽
 中断
 在解压缩 期 间 中断执 行例 如按 下 ctrlc 或杀死解 压 缩 进程 可能 会 导致归 档文件 的解压缩不 完整
 提取的 默 认行 为
不了解 提取的默认 行为可能导 致不 符 合期 望的解 压 缩结 果
例 如 当提 取相 同归档 两次 时它 会不 经询问地覆 盖文件
zipimport 从 zip 存 档 中导 入 模块
 源代 码 libzipimport
py 此 模块添加 了从 zip  格式 档 案中 导入 python  模块
py 
pyc  和包 的能 力
 通常 不需要 明确 地 使用 zipimport 模块内置的 import  机制 会 自 动将 此模 块用 于 zip 档 案 路径 的 sys
path 项 目上
 通常 sys
path  是 字符 串的目 录名 称 列 表
 此模 块同样允 许 sys
path 的 一项 成为命 名 zip 文件 档案 的 字符 串
 zip  档案可 以容 纳子目录结 构 去 支持 包的 导入并且 可以将归 档文 件 中 的路 径指定 为仅 从子 目 录 导入
比如 说 路 径 example
ziplib 将只 会从 档案 中的 lib 子 目录 导入
 任何 文 件都 可以 存在 于 zip 档 案之 中但 是只 有
py  和
pyc 文件是 能 够导入 的
 不允 许 导入 zip  中的 动态模 组
pyd 
so 
 请注意 如果 档案中 只 包 含
py 文 件 python  不 会 尝 试通 过 添加 对应的
pyc  文 件 修改 档案 意思 是 如 果 zip 档 案不 包含
pyc  文件导入或 许 会变 慢
 在3
8 版 更 改以 前不 支持 带 有档 案注释的 zip 档 案
参 见 pkzip  application  note  phil  katz  编写 的 zip  文件格 式文 档此格 式和 使用 的算 法的 创建 者
 pep 273 从 zip  压 缩 包导 入模 块由 james  c
 ahlstrom  编写他也 提供了 实现
3 遵循 pep 273 的规范 但是 使 用 just  van  rossum 编写的 使 用了 pep 302 中描 述的 导入钩的 实 现
 pep 302新导 入钩 pep 添 加 导入钩 来有 助于 模 块 运作
 此模块定 义 了一个 异常 exception  zipimport
zipimporterror 异 常 由 zipimporter 对象 引发
 这 是 importerror 的 子类因此 也可 以捕 获 为 importerror 
zipimporter 对 象
zipimporter 是用于 导入 zip  文件 的类
zipimporterarchivepath 创建 新的 zipimporter  实 例
 archivepath  必须是指 向 zip 文 件的路 径或 者 zip 文 件 中的 特定 路径
 例 如 foobar
ziplib  的 archivepath  将在 zip 文 件 foobar
zip  中的 lib 目录中 查找模 块 只 要它 存 在
如 果 archivepath 没有 指向一 个 有效的 zip  档 案 引发 zipimporterror 
 findmodulefullname  path  搜索 由 fullname 指 定的 模 块
 fullname 必 须是 完 全合格 的点 分的 模 块名
它 返 回 zipimporter 实 例 本身 如果 模块 被 找到 或者 返回 none 如 果没 找 到指定模 块
 可选的 path 被 忽略这 是为 了与 导入 器协 议兼容
 getcodefullname  返回 指定 模块 的代 码对 象
如 果 不 能找到 模块 会引 发 zipimporterror 错 误
 getdatapathname 返回 与 pathname 相关 联的数据
 如 果 不能找 到文 件则 引发 oserror  错 误
在3
3 版更 改曾经是 ioerror 被引 发 而不 是 oserror 
 getfilenamefullname  如果导 入了指 定 的模 块 file 则 返回为 该模 块设 置的值
 如 果 未找 到 模 块则引 发 zipimporterror 错 误
3
1 新 版功能
 getsourcefullname  返回 指 定模块 的源 代 码
如果没 有 找到模块则 引发 zipimporterror 如果 档案包 含模 块但是 没有 源 代码 返回 none 
 ispackagefullname  如 果 由 fullname  指定 的模 块 是 一个包 则返 回 true 
如果不 能找到 模块 则引 发 zipimporterror 错误
 loadmodulefullname  加 载由 fullname  指定的模 块
 fullname 必 须 是 完全 限定的点分 的 模块名
 它 返回 已加 载 模 块或 者当找不 到 模块时 引发 zipimporterror  错误
 archive  导 入器 关联 的 zip 文 件的 文 件名 没有 可能的子 路径
 prefix  zip  文件 中 搜索 的模 块的子路 径
 这 是一 个指 向 zip 文 件根目 录的 zipimporter  对象的空 字 符 串
当与 斜 杠结 合使 用 时 archive 和 prefix  属 性等 价于 赋 予 zipimporter 构 造器的 原始 archivepath  参数
 示 例
这 是一 个 从 zip  档案 中 导入 模块 的例 子 请注意 zipimport  模块不 需要 明 确 地 使用
zlib  与 gzip 兼 容的 压缩
zoneinfo  iana  时 区支 持
3
9 新版 功能
zoneinfo 模 块根 据 pep 615的最初说明 提供 了具体 的 时 区 实现 来 支持 iana  时区数 据库
按照 默认 设 置 zoneinfo  会在 可 能的 情况下使 用系 统的 时 区数据 如果系 统时区 数 据不 可用 该库 将回 退为 使 用 pypi 上 提供 的 tzdata  第一 方包
 参见模 块 datetime  提供 time  和 datetime  类型 zoneinfo 类被 设 计为 可配 合 这两 个 类型 使用
包 tzdata 由 cpython 核 心开 发者维 护 以 通过 pypi 提供时 区 数 据的 第一 方 包
 使 用 zoneinfo
zoneinfo 是 datetime
tzinfo  抽 象基类的具 体实 现 其目 标是 通过构 造器、 datetime
replace 方 法 或 datetime
astimezone  来与 tzinfo  建 立关 联 from  zoneinfo  import  zoneinfo  from  datetime  import  datetime  timedelta  dt  datetime 2020103112 tzinfozoneinfoamericalosangeles  printdt 202010311200000700 dt
tzname  pdt 以 此方 式构 造的日期 时间 对 象可 兼容日期 时 间运 算并 可 在无 需进 一步 干预 的 情况 下处 理夏 令时 转 换 dtadd  dt  timedeltadays 1 printdtadd 202011011200000800 dtadd
tzname  pst 这 些 时区 还支 持在 pep 495中引 入 的 fold
在可 能导 致时间歧 义的 时 差转 换中 例如 夏令 时 到标 准 时 的转 换当 fold 0时 会使 用转换之前 的时 差 而当 fold 1 时则 使 用转换之 后的 时 差 例 如 dt  datetime 20201111 tzinfozoneinfoamericalosangeles  printdt 202011010100000700 printdt
replacefold 1202011010100000800当执行 来自 另 一 时区的转 换时 fold  将被 设 置 为 正确的 值 from  datetime  import  timezone  losangeles  zoneinfoamericalosangeles  dtutc  datetime 20201118 tzinfotimezone
数据 源
zoneinfo 模 块不 直 接 提供 时区 数据而 是在 可 能的 情况 下从 系 统时 区数 据 库或 pypi 上 的第 一 方包 tzdata  获 取时 区 信息
 某 些系 统重要的 一点是 windows 系 统也包 括在 内并 没有 可用 的 iana 数 据 库因 此 对于 要保证 获 取 时区信 息的 跨平台兼容 性 的项 目 推 荐 对 tzdata  声明 依赖
如果 系 统数 据和 tzdata  均 不 可 用则 所有 对 zoneinfo 的 调 用 都将 引发 zoneinfonotfounderror
 配置 数据 源
当 zoneinfokey  被调用 时此 构造器首先 会 在 tzpath 所 指定 的目 录 下搜 索 匹配 key 的 文件 失 败时 则 会 在 tzdata 包 中查 找 匹 配
此 行为 可通 过三种 方式 来 配置1
 默 认 的 tzpath  未 通 过其 他方 式指 定 时 可在 编 译时 进行 配 置
 tzpath  可 使用 环 境变 量进 行配 置
在 运行 时 搜索 路径可 使用 resettzpath  函数 来修 改
 编译 时配置默 认 的 tzpath  包括 一 些时 区数 据库 的 通 用布 署位 置 windows 除 外该 系 统没 有时 区 数 据的 通 用 位置
 在 posix 系 统中下游 分 发者 和从 源 码编译 python 的 开发 者知 道系统 时区 数据布 署 位置 他们 可以 通过指定 编译 时选 项 tzpath  或 者更 常见 的 是 通过 configure  旗标 withtzpath  来改 变 默认 的时区 路径 该选项 应当 是一 个 由 os
pathsep 分 隔的字 符 串
在所有 平 台 上配 置值会 在 sysconfig
getconfigvar  中以 tzpath  键的 形式提 供
 环境配 置 当初 始 化 tzpath 时 在导入时 或不 带参 数调 用 resettzpath  时 zoneinfo 模 块 将使 用环 境变 量 pythontzpath 如 果 变量 存 在则 会 设 置搜 索路 径
pythontzpath 这 是 一个以 os
pathsep  分隔 的 字符 串 其中包含 要 使用 的 时 区搜索路 径
 它必须 仅 由 绝 对 路径而非 相 对 路 径 组 成
在 pythontzpath 中指 定 的 相 对 路 径部 分将不 会 被使 用但 在其他 情况 下 当指 定 相对 路径 时的行为 该实现 是 有定义 的 cpython 将 引 发 invalidtzpathwarning  而其 他 实 现可自 由地 忽略 错误部 分或 是引 发异常
 要设置 让系统忽 略 系 统 数据 并改 用 tzdata 包 请设 置 pythontzpath
运 行时 配 置 tz 搜 索路径 也可 在运 行时使 用 resettzpath  函 数来 配置
 通 常 并 不建 议如 此操作 不过 在需 要 使用 指定 时 区 路径或者 需 要禁 止访 问 系 统 时区 的测试 函 数 中使 用它则 是 合理 的
zoneinfo 类
 字符 串表 示
当 在 zoneinfo  对 象 上调用 str 时 返回 的字 符 串表 示默 认会使 用 zoneinfo
key  属性 参 见该 属性文 档中 的 用法 注释 zone  zoneinfopacifickwajalein  strzone  pacifickwajalein  dt  datetime 202041315 tzinfozone  fdt
tzinfo 20200401 t 0315001200 pacifickwajalein 对于基 于 文件 而非 指定 key 形 参所 构 建的 对象 str  会 回退 为调用 repr
 zoneinfo 的 repr  是 由具 体 实 现定义的 并且 不一 定会在 不 同 版本 间 保 持 稳 定 但它 保 证 不 会是 一个 有效 的 zoneinfo 键
 封存 序 列化
zoneinfo  对 象的 序 列化 是基 于 键 的而 不是序 列 化所 有过 渡数据并且 基 于文 件 构造 的 zoneinfo 对 象 即使 是指定 了 key 值 的对 象不 能被封 存
zoneinfo 文 件 的行为 取决 于它的 构造方 式1
 zoneinfokey 当 使用 主构 造器构 造时 会 基于 键序列 化一个 zoneinfo  对 象 而当 反序列 化 时反 序 列 化 过程 会 使用 主 构造器 因此预 期它 们与 其 他对 同一时 区的 引 用会是同 一 对象
例 如 如果 europeberlinpkl 是 一 个 包含基 于 zoneinfoeuropeberlin 构 建 的 封 存数 据的字 符串 你可以 预期出 现以 下的行 为 a  zoneinfoeuropeberlin  b  pickle
nocachekey  当通 过 绕 过 缓 存的 构 造 器 构造 时 zoneinfo 对象 也会 基 于键 序列 化但当反 序列 化时 反序列 化过 程 会 使用 绕过 缓 存的构造 器
如 果 europeberlinpklnc 是一 个 包 含基 于 zoneinfo
nocacheeuropeberlin  构造 的封存 数据 的字 符串 你 可 以 预期 出现以 下的 行 为 a  zoneinfoeuropeberlin  b  pickle
fromfilefobj  keynone  当通 过文 件 构 造时 zoneinfo  对 象会 在封存 时引 发异 常
 如果最终用户 想要 封 存 通 过文 件 构造的 zoneinfo  则推荐他 们 使用 包 装类 型 或 自定 义序 列化函数或 者基 于键 序列 化或 者存储文 件 对象 的内 容 并将 其 序列化
 该 序 列化方 法 要求 所 需键 的 时区 数据 在 序列 化 和反序 列 化中 均可 用类 似 于在 序 列化 和 反序 列化 环境中 都 预期存 在对类和 函 数的引 用 的方 式
 这还意 味着 在具 有不 同 时区 数据 版 本 的环 境 中 当解 封被封存 的 zoneinfo 时 并不 会保 证 结果的一 致 性
函数
availabletimezones 获取 一 个 包含可用 iana 时 区 的在 时区 路 径的任 何 位置 均 可 用 的 全 部有效 键的 集合
 每 次 调 用该 函数 时 都 会重 新计 算
此 函数 仅 包括 规范 时区 名 称而不 包括特殊时 区如位于 posix  和 right 目 录 下的 时 区或 posixrules 时 区
警 告此 函 数 可能会 打开 大量的文 件 因 为确 定时 区 路径 上某 个文 件是否 为有 效时区 的最 佳 方式 是读取 开 头 位置的 魔术 字 符 串
注 解 这些 值 并不 被设计 用来 对外公 开 给 最终 用户 对于面 向 用 户的 元素 应 用程序 应 当使 用 cldr  unicode 通用区 域数 据存 储 库 之 类 来 获取更为 用户 友好 的 字符 串
另 请参阅 zoneinfo
key  中的 提示 性说明
resettzpathtonone 设 置或 重 置模 块 的 时区 搜 索 路径 tzpath
当 不带 参数调用 时 tzpath 会被 设 为默 认 值
调 用 resettzpath 将 不会 使 zoneinfo 缓存失 效因而 在缓 存未 命中 的情 况下 对主 zoneinfo  构造 器 的调 用将 只使用 新的 tzpath
 to  形 参 必须是由字 符 串或 os
pathlike 组成 的 sequence  或 而不 是 字符串 它们 必须 都 是绝对路 径
如 果 所 传 入的 不 是绝 对路径 则 将 引 发 valueerror
全 局 变量
tzpath  一个表 示 时区搜 索 路 径 的只 读序 列当通 过 键 构 造 zoneinfo  时 键会与 tzpath 中 的 每 个 条目进 行合 并并 使用所 找到 的第 一个 文 件
 tzpath 可以 只 包 含 绝对 路 径绝不 包 含 相 对路径 无论它是 如何配 置 的
 zoneinfo
tzpath 所 指 向 的对象可 能随着 对 resettzpath 的 调 用而改 变因 此推 荐 使用 zoneinfo
tzpath 而不 是从 zoneinfo  导 入 tzpath 或 是将 zoneinfo
tzpath  赋值 给一 个 长期变 量
有关 配置时 区 搜索 路径 的 更 多信息 请 参阅 配置 数 据源
 异常 与警 告
zoneinfonotfounderror 当 一 个 zoneinfo  对 象 的 构造 由于在系 统中 找 不到 指定的 键而失 败 时 引 发
这 是 keyerror  的 一个子 类
invalidtzpathwarning  当 pythontzpath 包 含 将 被过 滤 掉的无 效组件 例如 一 个 相对路 径时引 发
thread 底 层 多线 程 api
future  future 语 句 定义
main 顶 层脚本 环境
历 史 和 许可 证
该 软 件的 历史
python 由 荷 兰 数学 和计算机 科 学研 究学 会 cwi 见 httpswww
nl  的 guido  van  rossum 于1990 年代初 设 计作 为 一门 叫做 abc  的 语 言 的 替代 品
尽管 python 包 含了 许多 来自 其他 人 的贡 献 guido  仍是 其 主 要作者
1995年 guido  在弗 吉尼 亚州的国 家创 新研究公 司 cnri 见 httpswww
us  继续他 在 python  上的 工 作并在 那 里发布 了该 软 件 的多个 版本
2000 年五 月 guido  和 python 核心 开发 团 队转到 beopen
com  并组 建了 beopen  pythonlabs  团 队
 同年 十月 pythonlabs  团队 转 到 digitalcreations  现为 zope  corporation 见 httpswww
2001年 python  软 件基金会 psf 见 httpswww
orgpsf  成立 这是 一 个专 为 拥有 python  相 关 知识产权而 创 建 的 非 营利 组 织
 zope  corporation  现在是 psf  的赞 助成 员
所有的 python 版 本都 是 开 源的有 关 开 源 的 定义 参 阅 httpsopensource
org 
 历史 上 绝 大多 数 python 版 本是 gpl 兼 容 的 下表 总结了 各个 版本情 况
发 布 版本 源 自年 份所有 者 gpl 兼 容？0
0 至1
2 na 19911995 cwi  是1
3 至1
21
219951999 cnri  是1
22000 cnri 否2
com  否1
62001 cnri 否2
12001 psf 否2
12001 psf 是2
12001 psf  是2
12002 psf  是2
22002 psf  是2
2及 更高2
12001 至 今 psf  是注 解 gpl  兼 容并 不意 味 着 python  在 gpl 下发布
与 gpl  不同 所有 python 许 可 证都 允许 您 分 发修 改后 的版本而 无 需 开 源所 做的 更改
gpl  兼容 的许 可证使 得 python 可 以与其它 在 gpl  下 发布 的 软件 结合 使用 但其它的许 可证则 不 行
感谢 众多 在 guido  指 导下 工 作 的 外部 志愿者 使得 这 些 发布 成为可 能
获取 或以 其他 方式 使 用 python  的 条款 和条 件
python  软 件 和文 档的使用 许可均基于 psf  许可 协 议
从 python 3
6 开始 文 档中 的示例、操作指 导和其 他代 码采用 的是 psf  许可 协议 和 零条 款 bsd  许可 的 双重 使 用 许可
 某 些包含 在 python  中 的 软件是 基于 不 同 的许 可
这些 许可会 与相 应许 可之下 的代码 一同列 出
有关 这些 许可的 不完整列表 请参 阅被 收 录软 件 的许可 证与 鸣 谢
用 于 python 390的 psf 许 可 协 议
 用 于 python 20的 beopencom  许可 协 议
beopen  python 开 源 许 可 协议 第1版1
 用于 python 161 的 cnri  许可 协 议
用 于 python 090 至12的 cwi  许可 协议
zeroclause  bsd  license  for  code  in  the  python 390 documentation
被收录 软 件的 许可证 与鸣 谢
 本 节是 python  发行 版 中收 录 的 第 三方 软件 的许 可 和 致谢清单 该清单 是 不 完整 且不 断增 长的
mersenne  twister
random  模块包 含基 于 httpwww
html 下 载的 代 码
以 下是 原始 代 码的 完整 注 释 声 明 a  cprogram  for  mt 19937 with  initialization  improved 2002126
 套接 字
socket  模 块使 用 getaddrinfo  和 getnameinfo  函 数这 些 函数 源代 码 在 wide 项 目 httpwww
jp 的 单独 源文 件中
 异 步 套 接 字服 务
asynchat 和 asyncore  模块 包含 以下 声明 copyright 1996 by  sam  rushing  all  rights  reserved  permission  to  use  copy  modify  and  distribute  this  software  and  its  documentation  for  any  purpose  and  without  fee  is  hereby  granted  provided  that  the  above  copyright  notice  appear  in  all  copies  and  that  both  that  copyright  notice  and  this  permission  notice  appear  in  supporting  documentation  and  that  the  name  of  sam  rushing  not  be  used  in  advertising  or  publicity  pertaining  to  distribution  of  the  software  without  specific  written  prior  permission
cookie  管 理
http
cookies  模块包含以下 声 明 copyright 2000 by  timothy  omalley  timoalum
 执行 追踪
trace 模块 包含 以 下声明 portions  copyright 2001 autonomous  zones  industries  inc
uuencode  与 uudecode  函 数
uu 模 块包含以下声 明 copyright 1994 by  lance  ellinghouse  cathedral  city  california  republic  united  states  of  america
xml 远 程过程调 用
xmlrpc
client 模块 包 含 以下声 明 the  xmlrpc  client  interface  is  copyright  c 19992002 by  secret  labs  ab  copyright  c 19992002 by  fredrik  lundh  by  obtaining  using  andor  copying  this  software  andor  its  associated  documentation  you  agree  that  you  have  read  understood  and  will  comply  with  the  following  terms  and  conditions  permission  to  use  copy  modify  and  distribute  this  software  and  its  associated  documentation  for  any  purpose  and  without  fee  is  hereby  granted  provided  that  the  above  copyright  notice  appears  in  all  copies  and  that  both  that  copyright  notice  and  this  permission  notice  appear  in  supporting  documentation  and  that  the  name  of  secret  labs  ab  or  the  author  not  be  used  in  advertising  or  publicity  pertaining  to  distribution  of  the  software  without  specific  written  prior  permission
testepoll
testepoll  模 块包含以 下 声 明 copyright  c 20012006 twisted  matrix  laboratories
select  kqueue
select 模 块 关 于 kqueue  的 接口 包含以 下声 明 copyright  c 2000 doug  white 2006 james  knight 2007 christian  heimes  all  rights  reserved
siphash
pythonpyhash
c  文件包 含 marek  majkowski 对 dan  bernstein 的 siphash 24算法 的实现
它 包含 以下 声明 mit  license  copyright  c 2013 marek  majkowski  marekpopcount
strtod  和 dtoa
pythondtoa
c  文件提 供了 c 语言 的 dtoa 和 strtod 函 数用于将 c  语言 的 双 精 度 型和 字 符 串进 行转换 由 david  m
 gay 的 同 名文 件 派生而来该 文 件当 前可从 httpwww
orgfp  下 载
2009 年3月16 日检索 到 的原始 文件包 含以 下版 权和 许可 声 明 the  author  of  this  software  is  david  m
openssl
如 果操 作系 统 可 用 则 hashlib  posix  ssl  crypt 模 块使用 openssl 库来 提高性能
 此外 适用 于 python 的 windows 和 mac  os  x 安装 程 序 可能包 括 openssl  库 的 拷贝 所以在 此处 也 列 出了 openssl  许可证 的 拷贝 license  issues  the  openssl  toolkit  stays  under  a  dual  license  i
expat
 除非 使用 withsystemexpat  配 置了构建 否则 pyexpat  扩展 都是用 包 含 expat  源的 拷 贝 构建的 copyright  c 199819992000 thai  open  source  software  center  ltd  and  clark  cooper  permission  is  hereby  granted  free  of  charge  to  any  person  obtaining  a  copy  of  this  software  and  associated  documentation  files  the  software  to  deal  in  the  software  without  restriction  including  without  limitation  the  rights  to  use  copy  modify  merge  publish  distribute  sublicense  andor  sell  copies  of  the  software  and  to  permit  persons  to  whom  the  software  is  furnished  to  do  so  subject  to  the  following  conditions  the  above  copyright  notice  and  this  permission  notice  shall  be  included  in  all  copies  or  substantial  portions  of  the  software
libffi
 除非 使用 withsystemlibffi 配 置了 构 建否 则 ctypes  扩 展 都是 包 含 libffi 源 的 拷 贝 构建 的 copyright  c 19962008 red  hat  inc  and  others
zlib
 如果 系统上找 到的 zlib  版 本 太旧 而无 法用于构 建 则 使用包 含 zlib  源代 码的 拷贝 来构 建 zlib  扩展 copyright  c 19952011 jeanloup  gailly  and  mark  adler  this  software  is  provided  asis  without  any  express  or  implied  warranty
cfuhash
tracemalloc  使 用的哈 希表 的 实 现 基于 cfuhash  项 目 copyright  c 2005 don  owens  all  rights  reserved
libmpdec
w 3 c  c 14 n  测试套 件
test 包 libtestxmltestdatac 14 n 20 中的 c 14 n 2
0 测试 套件 来源于 w 3 c 网 站 httpswww
orgtrxmlc 14 n 2 testcases 并根 据 bsd 许 可 证 三条 款版 发行 copyright  c 2013 w 3 cr  mit  ercim  keio  beihang  all  rights  reserved
复合语 句
复 合语 句是 包含 其 它 语 句 语 句 组的 语句它们会 以 某种 方 式 影 响 或 控 制所包 含 其它 语句的执 行
通 常复 合 语 句 会 跨 越多行 虽 然 在某些 简 单形 式下 整个 复合语句也可 能 包含 于一 行之 内
if  while  和 for  语句用来 实现 传统 的控 制流程构 造
 try 语句 为 一 组语句 指 定异 常处理 和和 清理 代码而 with  语 句允 许 在一个代 码块 周 围执行初始 化和 终结 化代 码
函 数和 类定 义 在语法 上也属于 复合 语句
 一条 复 合语 句 由 一 个 或多个‘ 子句’ 组成
 一个子 句则 包 含 一 个句头 和一 个‘句 体’
 特 定复 合语 句的子 句 头 都处于 相同 的缩 进 层 级
 每 个 子句 头 以 一 个 作为 唯一 标 识的关 键 字 开始 并 以一 个冒 号 结束
 子 句体是由一 个子 句控 制 的 一 组语 句
子 句体可 以 是 在子 句头的冒 号之 后 与 其同 处 一 行的一 条或 由 分 号分 隔的 多条 简 单语 句 或者 也可 以是在其 之 后 缩进 的一 行或 多 行 语句
 只有后 一 种 形 式 的子 句体 才 能包含 嵌套的复合 语句以下 形式 是 不合 法 的这主 要 是因为 无法分清某 个后 续 的 else 子 句 应 该属 于哪 个 if  子 句 if  test 1 if  test 2 printx 还 要注意的 是在这种 情形下分号 的绑 定比 冒 号更 紧密 因 此在 以下示 例中 所 有 print  调用 或 者 都不执 行或 者 都执 行 if  x  y  z  printx  printy  printz 总 结 compoundstmt  ifstmt  whilestmt  forstmt  trystmt  withstmt  funcdef  classdef  asyncwithstmt  asyncforstmt  asyncfuncdef  suite  stmtlist  newline  newline  indent  statement  dedent  statement  stmtlist  newline  compoundstmt  stmtlist  simplestmt  simplestmt 请注意 语句 总 是以 newline  结束 之 后可 能跟随 一个 dedent
 还 要注 意可 选的 后续 子句 总 是以 一 个 不能 作 为语 句开 头的 关 键字 作 为开头 因此不 会产生 歧 义‘ 悬 空的 else ’ 问题在 python 中 是 通 过要 求嵌 套的 if  语 句 必 须 缩进 来 解 决的
 为 了保证 清晰 以下 各节 中语 法规 则采 用 将每个 子句 都 放在单 独行 中 的格 式
if  语 句
if 语句 用于 有条 件的 执 行 ifstmt  if  assignmentexpression  suite  elif  assignmentexpression  suite  else  suite  它通过对 表达 式逐 个 求值 直 至找到 一 个真值 请参 阅布 尔运 算 了 解 真 值与 假值 的 定 义在子 句体 中 选择 唯一 匹配 的 一 个然 后 执 行该 子句 体而 且 if  语 句的其他 部分不 会被 执 行或 求值
 如 果 所有表 达式均 为 假 值 则 如果 else 子 句体 如 果存 在 就会被 执行
while  语句
while  语句用于在 表 达式保 持为 真的 情 况 下重 复地 执行 whilestmt  while  assignmentexpression  suite  else  suite 这将重 复 地检 验表 达式 并 且如果其 值为 真 就执行 第一个子 句体如 果表 达式 值为 假 这可 能在第 一次 检验 时就 发生 则如 果 else  子句 体存 在就 会被 执 行并 终 止 循环
第 一个 子句 体 中 的 break 语句 在 执 行 时 将终 止循 环且 不 执 行 else  子 句 体
第 一个 子句体 中的 continue  语句 在 执 行时将 跳过 子句 体中的 剩余 部分 并返回 检 验表 达式
for  语句
try  语 句
try  语句可 为 一 组语 句 指 定异常处理器 和或清 理 代 码 trystmt  try 1 stmt  try 2 stmt  try 1 stmt  try  suite  except  expression  as  identifier  suite  else  suite  finally  suite  try 2 stmt  try  suite  finally  suiteexcept  子 句指 定一 个或多 个 异常 处理 器
当 try  子句 中没 有发 生异常 时没 有异 常处理器会 被执 行
 当 try  子 句 中 发生异 常时 将启动 对异常处 理器 的搜 索
此 搜索 会 依 次 检查 except 子 句直 至 找到与该 异 常相匹配 的 子句
 如果 存 在 无表 达式 的 except 子句它 必 须是最 后一个 它 将 匹配任 何异常
 对 于 带有 表 达式 的 except  子句 该 表达式 会 被求 值 如 果 结 果对象 与发 生 的异 常 兼容则该 子 句将 匹配 该异 常
一个 对象 如果 是异 常对 象 所属的 类或基类或 者 是 包含有 兼 容该异 常 的项的元 组 则两者 就 是兼容 的
 如 果没 有 except  子句 与 异常 相匹配 则会 在周 边 代 码和 发起调 用栈 上继续搜 索异常 处理 器
1如 果在对 except 子句 头 中的 表达 式求值 时引发 了异 常 则原 来对 处理 器 的 搜 索会被 取 消并在 周边 代码 和调用栈 上启 动对 新异 常 的搜 索它 会 被视 作是整个 try 语 句所 引 发 的 异常
 当 找 到一个 匹 配的 except  子 句 时该 异常 将 被赋 值给 该 except 子句 在 as  关 键字之 后指定 的目 标如果存在 此关 键字 的 话并且该 except  子 句体将 被 执行
 所 有 except 子句都 必须 有可 执 行 的 子句 体
 当到达 子句体 的末 尾时通 常会 转向整 个 try 语 句之后 继续执 行
这意 味着 如 果对 于同 一异 常 存在有 嵌 套 的两个 处理 器而异常 发生 于内 层 处 理器 的 try 子句 中则 外层 处 理器 将不 会处理该异 常
 当使用 as  将目 标 赋值 为 一个 异 常时 它将在 except 子 句结束时被 清 除
 这就 相当于 except  e  as  n  foo 被 转写 为 except  e  as  n  try  foo  finally  del  n 这意 味着 异常必 须 赋值给 一个 不同的 名称 才 能 在 except  子 句 之 后引用 它
异 常会 被 清 除 是因 为在 附加 了 回 溯 信息 的情况下 它们 会形 成堆栈帧的 循 环 引用 使得 所有局 部变 量保持 存活 直到 发生下一 次垃圾回 收
 在一 个 except  子句 体被 执行 之前 有关 异常 的详 细信息存放 在 sys 模块 中可 通过 sys
excinfo 来 访 问
excinfo 返 回 一个3元 组 由异 常类、 异常实例 和回 溯对象 组成 参见 标准 类型 层 级 结 构 一节 用于 在程序 中标 识 异 常 发 生点
 当 从处 理 异常 的函数 返 回 时 sys
excinfo  的值会 恢复为调用 前的 原值
如果 控制流 离 开 try 子句 体时 没有引 发异 常并 且没 有执行 returncontinue  或 break 语 句可选的 else  子句 将被执 行
 else  语句中 的 异 常不 会 由 之前 的 except 子 句处 理
如 果存 在 finally 它 将指 定 一 个‘ 清 理’ 处理程 序
 try 子 句会 被执行 包 括 任何 except  和 else  子句
 如果在 这些 子句 中发 生任何 未处 理的 异常该 异 常 会被临时 保存
 finally  子句 将被执 行
如 果存 在 被保存 的异常 它会 在 finally 子 句 的末尾被 重新引 发
如果 finally 子 句 引发 了另 一 个 异 常 被保存 的异常 会被 设为新异 常 的 上 下文
 如 果 finally  子 句 执 行了 return  break  或 continue 语 句则 被保 存 的异 常会 被 丢弃 def  f 
 f 42 在 finally 子句执行 期 间 程 序不 能 获 取 异 常信 息
当 return  break  或 continue  语句 在一 个 try
finally 语句的 try  子语 句体中 被 执行时 finally 子语 句也 会‘在 离 开时’ 被执 行
 函 数 的返 回值是 由最 后 被执 行的 return 语句 所决 定 的
 由 于 finally  子 句 总 是 被执 行因 此在 finally  子句中 被执 行的 return  语句 总 是 最后 被 执 行 的 def  foo 
 foo  finally 有 关异 常的更多信 息可以 在 异常 一节 找到 有关 使 用 raise  语 句生 成异 常 的信 息可以在 raise  语句 一节 找到
 在3
8版 更改在 python 3
8之 前 continue 语 句不 允许在 finally  子句 中 使用这 是因 为具 体 实现 存在 一 个问 题
with 语 句
with 语 句用于 包装 带有 使用 上 下 文管 理 器参 见 with 语 句上 下文 管 理 器 一 节定 义的 方法 的代 码 块的执 行
这允 许对 普通 的 try
finally  使用 模式 进 行 封装以 方 便地 重用
 withstmt  with  withitem  withitem  suite  withitem  expression  as  target  带有 一 个 项 目 的 with  语 句 的执 行过 程如下1
对上 下 文表 达 式 在 withitem 中 给出 的 表达 式求 值以 获得一 个 上 下文 管理 器
载 入上 下 文 管 理 器的 enter 以 便后 续使 用
 载 入 上 下文 管理器 的 exit 以 便后 续 使用
 发起 调 用 上下 文 管 理 器 的 enter  方 法
 如果 with  语句 中包 含一个 目标 来 自 enter 的返 回值将被 赋 值 给 它
注 解 with 语句 会 保 证如果 enter  方法 返 回时 未发生 错误 则 exit 将 总是 被 调用
因 此如果 在 对 目标 列 表 赋值期间发 生错 误则 会 将 其视 为 在语 句体 内 部发 生的 错误
 参见 下 面 的 第6步
 执 行 语 句 体
 发起调 用上下 文管理 器的 exit 方法
如果 语句体的退 出是 由 异 常 导 致的 则 其 类型、 值 和回溯 信 息 将 被 作 为参数传递 给 exit
 否 则的话 将提 供 三个 none  参数
 如 果 语句体 的退 出是 由异 常导致的 并 且来 自 exit  方 法 的 返回 值 为假则 该异 常会被 重新 引发
如果返 回值 为 真 则 该 异 常 会 被 抑制 并 会继 续执 行 with 语 句 之 后的语 句
如 果语句 体由 于异常以外的 任何 原因 退出则来自 exit  的返 回 值会被忽 略并 会 在该 类 退出 正常 的发 生 位置继 续执 行
以下 代 码 with  expression  as  target  suite  在语 义上 等 价于 manager  expression  enter  typemanager
excinfo  raise  finally  if  not  hitexcept  exitmanager  none  none  none  如果 有多个 项目 则会 视 作存在多个 with  语句嵌 套来 处理 多 个上下 文管理 器 with  a  as  a  b  as  b  suite 在语 义上 等 价 于 with  a  as  a  with  b  as  b  suite 在3
1 版 更 改支 持 多 个上 下文表 达式
 参见 pep 343 with 语 句 python  with 语 句 的规范 描 述、 背 景和 示 例
 函数 定义
 类 定义
 类 定 义就是 对类 对 象的 定义参见标 准 类型 层级 结构一 节 classdef  decorators  class  classname  inheritance  suite  inheritance  argumentlist  classname  identifier  类 定义 是一条 可执行 语 句
其 中 继承列 表通常给出 基类 的 列表 进阶 用法请参见 元 类 列 表 中 的每一项 都应当 被求值为 一个允许 子类的 类 对象
没 有继 承列表 的 类 默 认继承自 基 类 object 因 此 class  foo  pass 等 价 于 class  fooobject  pass 随后 类 体将 在 一个 新的 执行 帧 参见 命名 与 绑 定中 被执行 使 用 新 创建 的局部 命名空间 和 原 有 的全 局 命名 空 间
 通 常 类 体 主要 包含函 数 定 义
当类体结 束执行 时其执 行帧 将 被 丢弃 而其局 部 命 名 空间 会被 保存
3 一 个 类 对象 随后会 被创 建 其基 类 使用 给 定 的继 承列 表属性 字 典 使用 保存 的局 部命 名空 间
类名称将 在 原 有的全 局 命名 空 间 中 绑 定 到 该 类 对象
在类 体 内 定 义 的 属性的顺序保 存在 新 类 的 dict 中
请 注意 此 顺 序的可 靠性只 限 于类 刚 被创 建时 并 且只 适 用 于 使用 定 义语 法 所 定 义的 类
 类 的创 建可 使 用 元 类 进 行 重度定 制
 类也 可以 被装 饰 就像 装饰 函数 一 样 f 1 arg  f 2 class  foo  pass 大 致等价 于 class  foo  pass  foo  f 1 argf 2 foo 装 饰器表达 式的 求值 规则与函 数装饰器 相 同
 结 果随 后会被绑定 到类 名称
在3
9版 更改 类可 使 用任何 有 效的 assignmentexpression 来 装 饰
 在之 前 版本 中此语法 则更为 受限 详情 参见 pep 614
 程序 员注 意 事项在类 定义 内定 义的 变 量是类属 性 它 们 将被 类实 例所 共享
实 例 属性 可通过 self
name  value  在方法中设 定
类 和实例属性 均 可通 过 self
name 表示 法 来访问 当通 过此 方 式 访问时 实 例属 性会隐 藏同名的类 属性
类属性 可被 用作实 例属性的 默认 值 但 在此 场景 下使 用 可 变值 可 能 导致 未预 期的 结果
 可以使用 描 述器 来创 建具有 不同 实 现细 节的 实例变 量
参 见 pep 3115 python 3000中 的 元 类将 元类 声明修改 为当 前语法 的提 议 以及关 于如 何构 建带 有 元类 的类 的语 义描 述
 pep 3129类 装饰 器 增 加类 装饰 器的 提议
 函数 和方法 装 饰 器是 在 pep 318 中被 引 入的
 协程
3
5新 版 功能
 协程 函 数 定义
asyncfuncdef  decorators  async  def  funcname  parameterlist  expression  suitepython  协程 可以在多 个位 置上 挂起 和恢复 执 行参 见 coroutine
在 协程 函数 体 内 部 await 和 async  标识 符 已成 为保 留 关键 字 await  表 达 式 async  for  以 及 async  with  只能 在协程 函 数体 中 使 用
 使用 async  def  语 法 定义 的函数 总 是为 协程 函数 即使 它们 不包 含 await 或 async  关 键 字
在 协程 函 数体 中使 用 yield  from  表达 式 将引发 syntaxerror
协 程 函数 的例 子 async  def  funcparam 1 param 2 dostuff  await  somecoroutine
async  for 语句
asyncforstmt  async  forstmtasynchronous  iterable 能够 在其 iter  实 现 中调 用 异步 代码 而 asynchronous  iterator 可 以在其 next  方法 中调 用异 步代码
async  for  语句 允许 方便 地对 异 步迭 代 器 进 行 迭 代
以 下代码 async  for  target  in  iter  suite  else  suite 2 在 语义上 等价 于 iter  iter  iter  typeiter
anextiter  except  stopasynciteration  running  false  else  suite  else  suite 2另 请 参阅 aiter  和 anext 了解 详情
 在协程 函 数 体 之外 使 用 async  for  语 句将 引发 syntaxerror
async  with  语句
asyncwithstmt  async  withstmtasynchronous  context  manager 是一 种 context  manager  能 够在 其 enter 和 exit 方 法中 暂停 执 行
以下 代码 async  with  expression  as  target  suite  在 语义 上等 价于 manager  expression  aenter  typemanager
excinfo  raise  finally  if  not  hitexcept  await  aexitmanager  none  none  none  另请参 阅 aenter  和 aexit 了解详 情
在 协程 函数 体 之外 使 用 async  with 语 句 将 引发 syntaxerror
 参见 pep 492 使用 async  和 await 语 法实现协 程将 协程 作为 python  中 的一 个正 式的 单独概 念并 增加 相应 的 支 持语法
 脚 注1异 常会 被传 播给 发起 调 用栈 除 非 存在 一 个 finally  子句 正好 引发了 另一 个异 常
新 引发 的异 常将 导致 旧 异 常 的丢 失
2 作 为函 数体 的第 一 条语 句出 现的 字符 串字面值 会 被转 换 为函 数 的 doc 属 性 也 就是 该函数 的 docstring
3作 为类 体 的 第一 条语 句出现的 字 符串 字 面值 会被转 换为 命 名空 间的 doc  条目也就 是 该类 的 docstring
数 据 模型
对象、 值与 类 型
标 准类型 层级 结 构
特殊 方法名 称
一个 类可以 通 过 定 义具 有特 殊名称 的方 法 来实 现 由特殊 语法 所引 发 的特 定 操作例 如 算 术运算或下 标 与切片
 这是 python  实 现操 作 符重 载的方 式允 许每 个类 自行 定 义 基 于操 作符 的特 定 行为
 例如 如 果 一 个 类定 义了 名为 getitem  的方 法并 且 x 为该类 的一 个实 例则 xi  基 本就 等同于 typex
除 非 有说明 例 外 情 况 在没有 定 义 适 当 方 法 的情 况下尝 试 执行 一种 操作 将引发 一个 异常 通常 为 attributeerror 或 typeerror
 将 一 个特 殊 方 法设为 none  表示 对应 的 操作 不 可用
例 如如 果 一 个类 将 iter 设 为 none 则 该 类就 是不可迭代 的因 此对 其实 例调用 iter  将引 发一个 typeerror  而不 会回 退 至 getitem
2在 实现 模 拟 任何 内 置类 型的 类时 很重 要 的 一 点是 模 拟 的实现程 度对 于 被 模 拟 对象 来 说 应 当是 有意义 的
例 如 提 取单 个元素的 操作对于 某些 序 列 来说是适 宜的但 提取 切片 可能就没 有意义
这 种情 况的 一个 实 例是 w 3 c  的文档对 象模 型中的 nodelist  接 口
基 本定 制
自 定义 属 性 访 问
自 定义类创 建
自定 义实 例 及 子 类 检查
 以下方 法 被用 来 重载 isinstance 和 issubclass  内置函 数的 默认 行为
 特别 地元 类 abc
abcmeta 实 现了这些方 法 以便 允 许将抽 象基类 abc 作 为 虚 拟基类 添 加 到任何 类 或类型 包 括内 置类 型包 括 其 他 abc 之 中
instancecheckself  instance 如 果 instance  应 被视 为 class 的一个 直接或间 接 实例 则 返 回 真 值
 如果 定义了 此方 法则会 被调 用 以实 现 isinstanceinstance  class 
subclasscheckself  subclass  return  true 如 果 subclass 应 被视 为 class 的 一个 直接 或间 接子 类则 返 回真 值
如 果定 义 了 此方 法则 会被 调用 以实 现 issubclasssubclass  class
 请注意 这些方法 的 查找 是基 于类 的类型 元类
 它 们不能 作为 类 方法 在 实际 的类 中被 定义
这与 基 于实 例被 调 用 的特 殊方 法的 查找 是一致的 只有在 此 情 况 下实 例本 身被 当作 是 类
参 见 pep 3119引入 抽象 基类新 增 功能 描 述通 过 instancecheck  和 subclasscheck 来 定制 isinstance 和 issubclass  行为 加入 此功 能的 动机 是 出于 向 该语言 添加抽 象 基类的内 容参 见 abc  模块
模 拟泛 型 类 型
通 过定义一 个 特殊 方法 可以 实现 由 pep 484所 规定 的泛型 类语法 例如 listintclassmethod  object
classgetitemcls  key 按照 key  参数指定 的类 型返回一 个 表示 泛型类 的 专门 化 对象
 此方 法的查 找会 基 于对象 自身 并且当 定义 于类 体 内部时 此方 法将 隐 式地 成 为 类 方 法
 请注意 此机 制 主要 是被保 留 用 于 静 态类 型提 示 不鼓励 在其 他场 合 使 用
参 见 pep 560对 typing  模块和 泛型 类 型的 核心 支 持
 模 拟 可调 用对 象
此方 法 会在 实例作 为一 个 函 数被 调用 时 被调 用如果定 义了 此 方法 则 xarg 1 arg 2
就大 致可以被 改写 为 typex
callx  arg 1
模拟 容器 类 型
 可以 定义 下列方 法 来 实现 容器 对 象
 容器 通 常属 于 序 列 如 列 表 或元 组或 映 射 如字 典 但也 存在其他 形式 的 容器
 前几 个 方 法集 被 用于 模拟 序列 或 是模拟 映射 两者的 不同 之处 在 于序 列允许 的键 应为整 数 k 且0 k  n  其中 n  是序 列或定 义 指定 区间 的 项 的 切 片对 象 的长度
 此外还建 议 让映 射提 供 keys  values  items  get  clearsetdefault  pop  popitem  copy 以 及 update  等方 法它 们的 行为 应与 python  标准 字典 对象 的相 应 方 法类 似
 此 外 collections
abc  模 块 提 供了一 个 mutablemapping 抽 象基类以 便根 据由 getitem  setitem  delitem  和 keys  组 成 的基 本 集 来 创建 所 需 的 方 法
 可变序 列 还应 像 python 标 准列 表对象那样提 供 append  count  index  extend  insert  popremove  reverse 和 sort  等方 法
 最后 序 列 类 型 还应通过 定义下 文描 述 的 add  radd  iadd  mulrmul 和 imul  等方 法 来 实现加法 指 拼 接 和 乘 法指重 复 它 们 不应 定义 其他数值 运 算 符
 此外 还建 议 映射 和序 列 都 实 现 contains 方 法以允 许 高 效地 使用 in  运 算 符 对于映 射 in  应 该 搜索映射的 键对于 序 列则 应 搜索其中 的值
 另 外 还建 议 映射和序 列都实 现 iter 方法 以允 许 高效 地 迭代 容器 中 的 条 目对 于映 射 iter  应当迭 代 对象的键 对于序列则应 当迭 代其 中的 值
lenself  调 用此 方 法以 实 现内 置 函 数 len
 应该 返 回 对 象的 长 度以 一 个0的 整 数 表示
此 外 如果 一 个 对 象 未 定义 bool  方 法而 其 len  方 法返 回 值为 零则在 布尔 运算中 会被 视为假值
 cpython  implementation  detail 在 cpython  中 要求 长度 最大 为 sys
如 果长度 大于 sys
maxsize 则 某些特性 例如 len 可能会 引发 overflowerror
要通 过 真 值检测 来防 止引 发 overflowerror  对 象必须 定 义 bool 方 法
lengthhintself  调用此 方法以 实现 operator
 应该返回对 象长 度的 估计 值可 能大于 或小于 实际长度
 此长度应为 一个0的 整数
返 回值 也可 以为 notimplemented  这 会 被视 作 与 lengthhint 方法 完全 不存 在时一样 处理
 此方 法纯 粹是为 了 优化 性能并 不要 求正确 无误
3
4新 版功能
 注解 切片 是通过 下述 三 个专 门 方 法完成 的
以 下形式 的 调用 a 12 b 会为 转写为 aslice 12 none  b  其他 形式以 此类 推
略去的切片项 总是 以 none  补 全
getitemself  key 调 用此 方 法 以实 现 selfkey  的 求值
对 于序 列类 型 接受 的键 应 为整 数 和切 片 对象
请 注意 负数 索 引如 果类 想要 模拟序列类 型的 特殊解 读 是 取决 于 getitem 方 法
如果 key 的 类型不 正确 则 会引 发 typeerror  异 常 如果 为序 列 索 引集 范 围 以外 的 值 在进 行 任 何负 数 索 引的特 殊 解读 之后 则应 引 发 indexerror  异 常
 对 于 映射 类型 如果 key  找 不到 不在 容器 中 则应 引发 keyerror  异 常
注解 for  循环 在 有 不合法索 引时会 期 待捕 获 indexerror 以便 正 确地检测 到序列 的结束
setitemself  key  value 调 用此 方法 以实现 向 selfkey  赋 值
 注意 事 项 与 getitem  相 同
为对 象实 现 此 方 法应该 仅 限 于需 要 映 射 允许 基 于键修改 值或添加 键 或是序列 允许 元素 被 替 换时
 不正 确 的 key 值所 引发 的异 常应 与 getitem 方 法 的 情况 相同
delitemself  key  调 用此 方 法 以 实现 selfkey  的删 除
 注意 事 项与 getitem 相 同
为 对象 实现 此 方 法应 该 权限于需要 映射 允许 移除键或是 序列 允许 移除元 素时
不正 确的 key  值所引 发的 异常 应与 getitem  方法 的情况 相同
missingself  key  此 方 法 由 dict
getitem  在找 不 到 字 典 中 的 键 时调 用 以实 现 dict 子 类的 selfkey
iterself 此 方 法在需 要为容 器创 建迭代 器 时 被调 用
 此方 法应该 返 回一 个新的 迭代 器 对 象它 能够 逐 个 迭 代容器 中的 所有 对象
 对 于 映射 它应 该 逐个 迭 代 容器 中的键
 迭代 器 对 象也 需 要 实 现 此 方法 它们 需要返 回对象 自身
 有关 迭代器 对象 的 详情 请参 看迭 代器类 型一节
reversedself 此方 法如 果存在 会 被 reversed  内置函数调 用 以 实 现 逆向 迭代
 它 应 当返 回一 个新 的 以 逆序逐 个迭代容器 内所 有对 象 的 迭 代器 对象
如果 未提 供 reversed 方法 则 reversed 内 置 函数将 回 退 到 使 用 序列 协 议 len  和 getitem
 支 持序列 协议的 对 象应 当仅 在 能 够 提供 比 reversed 所提 供的 实现 更高 效的 实 现时 才提 供 reversed 方 法
成 员检 测 运算 符 in 和 not  in  通 常 以 对容器进 行逐 个 迭代 的 方 式 来 实 现
不 过 容器 对象可 以 提 供 以 下 特殊 方 法并采用更 有 效率 的实 现 这样也 不要 求 对 象 必须为 可 迭代 对 象
containsself  item 调用 此方 法 以 实现 成员 检测运算符
 如 果 item  是 self 的 成员 则 应返回 真否 则 返 回假
 对于 映 射 类型此 检测 应基 于 映射 的 键 而不 是 值 或 者键 值 对
 对于 未定 义 contains  的 对象成 员 检 测将 首 先尝试 通 过 iter 进 行 迭代然 后再 使 用 getitem 的旧 式序 列迭代 协议 参看 语言 参考 中的 相 应部 分
模拟 数 字类型
with  语句 上 下 文 管理 器
 特殊 方法 查 找
协 程
可 等 待 对 象
awaitable 对 象主要 实现了 await  方 法
从 async  def  函数返 回 的 协 程 对象 即属 于可 等 待 对象
 注解从带有 types
coroutine  或 asyncio
coroutine  装 饰器的 生 成 器返回的 generator  iterator 对象也 属于可 等待 对 象但 它们 并未实 现 await
awaitself 必 须 返 回一 个 iterator
 应当 被 用来实 现 awaitable 对 象
例 如 asyncio
future 实 现了 此 方法 以与 await 表 达 式相兼 容
3
5 新版 功能
 参 见 pep 492 了解 有关 可等待 对象的详 细信 息
协 程 对象
 协程对 象属 于 awaitable  对 象
协程 的执 行可通 过调 用 await 并 迭代 其结 果来 控制
 当协程 结 束 执行 并返回 时迭 代器 会 引 发 stopiteration  该异 常的 value 属 性 将存 放返 回 值
如果协 程 引发了 异常 它 会 被 迭 代 器所 传播
协 程不 应 直 接 引 发未处 理 的 stopiteration 异常
 协程也 具有下面 列 出 的 方 法它 们类 似 于 生成器 的对应 方法 参 见 生成 器 迭 代 器的 方 法
 但是 与生成 器 不 同 协程并 不直接 支 持 迭 代
 在3
2版 更改 等待一 个 协 程 超过一 次将 引发 runtimeerror
sendvalue  开 始或 恢 复 协 程 的执 行
如果 value  为 none 则 这 相 当于前 往 await 所返 回迭 代器的 下一 项
 如果 value  不为 none 此 方 法 将委 托给 导致 协 程挂起 的迭代 器 的 send  方法
 其结 果返 回值 stopiteration  或是 其他异 常将 与 上 述 对 await  返 回 值 进行 迭 代的 结 果相 同
throwtype  value  traceback  在 协程内 引发 指 定的 异常
 此方 法 将 委 托给 导 致协 程挂 起的迭 代器 的 throw 方 法 如果 存 在 该方 法
 否 则的 话异 常 会在 挂 起点被 引发
 其结 果 返回 值 stopiteration 或 是 其 他异 常将 与上 述对 await  返回值 进行迭代 的结果 相 同
 如 果 异常 未 在 协程 内被 捕 获则 将 回 传 给调用 者
close  此方法 会使 得协 程清 理自 身并 退出
如 果协 程 被 挂起 此方 法 会先 委托 给导 致 协程 挂起 的 迭 代 器的 close  方 法如果 存 在该 方 法
 然后 它会 在挂 起 点 引发 generatorexit  使 得协 程 立 即 清 理 自身
 最后 协程 会 被标记为 已结 束 执行 即使它 根本 未 被 启 动
当协 程 对 象将 要被 销毁 时会 使用以 上处 理过程来 自 动关 闭
异 步迭 代器
 异步 迭 代器 可 以 在其 anext  方法 中 调 用 异 步 代码
异 步 迭 代器 可在 async  for  语句 中 使 用
aiterself  必须 返 回一 个 异 步 迭代 器对 象
anextself 必 须返 回 一个可 迭代 对 象输 出迭代 器 的下一 结果 值
 当迭 代结 束时 应该引 发 stopasynciteration 错误
 异步 可 迭 代 对 象 的 一个 示例 class  reader  async  def  readlineself 
readline  if  val  b  raise  stopasynciteration  return  val 3
5 新版功 能
在3
7版 更改 在 python 3
7之 前 aiter 可以 返回 一个可 迭代对 象并 解析 为 异 步迭 代器
从 python 3
7 开 始 aiter  必 须返 回一 个异 步 迭 代器对 象
返 回任 何 其 他对 象都 将导 致 typeerror 错 误
异 步上下 文管 理器
 异步 上下 文管 理器 是上 下文 管理 器的一 种 它 能够 在其 aenter  和 aexit 方法中暂 停执 行
异 步 上下 文管 理器 可 在 async  with 语 句中 使用
aenterself  在 语义上 类似 于 enter 仅 有的区 别是 它必 须 返回 一个可 等 待对 象
aexitself  exctype  excvalue  traceback 在 语义 上 类似 于 exit  仅有的 区别 是 它必 须返 回一 个可 等 待 对 象
异 步上下 文管 理 器类 的一 个 示 例 class  asynccontextmanager  async  def  aenterself  await  logentering  context  async  def  aexitself  exctype  exc  tb  await  logexiting  context 3
5新 版功 能
脚 注1 在某 些情况下 有可 能基 于可 控的条 件改 变 一 个对 象 的 类 型
但 这通常不是 个好 主意 因为 如果 处 理不当会 导致 一些 非 常 怪异 的行 为
2 hash  iter  reversed 以 及 contains  方法对 此 有特 殊处 理 其他 方法 仍会 引发 typeerror  但可 能依靠 none  属于 不可 调用 对象 的 行为来 做到这 一 点
3这 里的 不支 持 是 指该类 无 此方 法或 方 法 返 回 notimplemented
如 果 你想强 制回 退到右操作 数的 反射方法 请不要 设置 方 法 为 none —那 会造 成显式 地阻塞 此 种回 退 的相 反 效果
4 对于 相同类 型的 操作数 如果非反 射方 法例如 add 失败 则会认为 整 个 运算 都 不 被支 持这就 是 反射 方法 未被 调用 的原 因
执 行模型
程序的 结构
python  程序是 由代码 块 构成 的
代 码 块是 被作 为一 个单 元来 执行 的一 段 python 程 序文 本
 以下 几个 都属于代 码块模块、 函 数体和类 定义
交 互式 输入的每 条 命令 都是 代码 块
一 个 脚本 文件 作为 标 准 输入 发送 给解 释 器或 是作 为命 令 行 参数发 送给解释 器的文 件也是 代码 块
一 条脚 本命令 通过 c  选项 在解释器 命令行 中 指定 的命 令也 是代 码块
 通过 在命 令行 中 使用 m  参数 作 为最 高层 级脚本 即 main  模块运行的 模块 也是 代 码 块
 传递 给内 置 函数 eval  和 exec 的字 符串 参数 也是 代码 块
 代码块在 执 行帧 中被执行
 一个 帧 会包 含某些 管理 信息用于 调试 并决 定代码 块执 行完 成后应 前往何 处以 及如 何继续 执 行
命 名与 绑定
 名称 的 绑定
名称 用 于指代 对象
 名称是 通 过名称 绑定操 作来 引入 的
以下 构造会绑 定名称传 给函 数 的正 式 形 参 import  语句类与 函数 定义 这 会在 定义 的 代 码块 中 绑定 类或 函数名称 以及 发 生以标 识 符为 目标 的 赋 值 for 循环的开 头或 with  语句 和 except 子 句的 as 之 后
import 语句 的 from 
 import 形 式会 绑 定在 被 导入 模块 中定 义的 所 有 名 称 那些 以下划 线开头的 除 外
 这种 形式 仅在 模块 层级 上 被 使 用
del 语 句 的目标也 被视作 一种绑 定虽 然 其 实际 语义 为解 除 名 称绑定
 每条 赋值 或导 入语句均 发 生于类或 函 数内部定 义 的 代码 块中 或是 发生 于模 块层级 即最高 层 级的 代码块
 如 果 名 称 绑定在一 个 代 码块 中则 为 该代 码 块的局 部 变量 除 非 声明 为 nonlocal 或 global
 如 果名 称绑 定在 模块 层级 则 为 全局 变 量
模 块代 码 块的 变 量 既 为 局 部 变 量 又为 全局 变量
 如果 变 量在 一个代 码 块中 被使 用但 不是 在 其 中定义则 为 自 由 变 量
每 个在 程序 文本 中出 现 的 名称是 指由 以下 名称 解析规 则所 建 立的对 该 名称 的绑 定
 名 称 的解析
 内置命 名 空间 和 受 限 的 执行
cpython  implementation  detail  用户 不 应该 接触 builtins  严格 说 来它属于 实现 细 节
 用户 如果要 重 载 内置命名 空间 中的 值 则应 该 importbuiltins 并相 应地 修改该 模块 中的 属性
 与一 个代 码块的执 行相 关联 的 内 置命 名空 间实 际 上 是通 过在 其全局 命 名空 间 中搜 索名 称 builtins 来 找到 的这 应 该是 一个 字典或一 个模 块在 后一 种情况 下会 使 用 该模 块 的字 典
默 认情 况 下当 在 main 模 块 中 时 builtins  就是内 置模块 builtins  当在 任何 其他模块 中时 builtins  则是 builtins  模 块自 身的 字典的 一 个别 名
与 动 态 特 性的 交 互
自由 变 量的名称解析 发生 于运 行 时而 不是编 译 时
这 意 味着 以下代 码 将打印 出42 i 10 def  f  printi  i 42 feval  和 exec  函 数 没 有对 完整 环境的访 问权 限来 解 析 名称
 名称 可以 在调 用者 的局 部 和 全 局命 名 空间中被 解析
自 由 变 量 的解析不 是在最 近包 含命 名空 间中 而 是 在 全局 命 名 空 间中
1 exec 和 eval  函数有 可 选 参 数用 来重 载 全 局 和 局部 命名空间
 如果 只 指 定一个 命名 空间 则它 会 同时 作 用于 两 者
 异常
异常 是 中 断 代码 块的 正 常 控制 流 程 以便 处 理错 误或 其他异常 条件 的 一种方式
 异 常会在 错误 被检 测 到 的 位置引 发它 可以 被 当前包 围 代码 块 或是 任 何 直 接或 间 接发起 调用 发 生 错 误 的 代 码 块 的 其 他代 码块所 处 理
python  解 析 器会 在检测 到 运行 时错误 例如 零作 为被 除 数 的时 候 引 发 异常
python  程序 也 可 以 通 过 raise  语 句 显 式 地 引 发 异 常
 异 常 处 理是 通 过 try 
 except  语 句 来指 定 的
 该 语 句的 finally  子 句 可被 用来指 定清 理 代 码 它 并不 处理 异常 而 是 无 论 之 前 的代 码 是 否 发 生异 常 都 会 被 执 行
python  的错 误 处 理 采 用 的 是终止模 型 异 常处 理器 可 以 找 出 发 生了 什 么 问 题 并在 外层继 续 执 行 但它 不能修 复错 误 的 根源 并 重试 失败 的 操作 除非 通过 从 顶 层重新 进入 出 错的代 码 片 段
当 一 个异 常完 全未 被处 理时 解 释 器会 终止 程 序的 执 行 或 者 返 回 交 互 模 式 的 主 循 环
无 论 是 哪 种情 况它 都 会 打印栈 回 溯 信息 除 非是 当异 常 为 systemexit 的 时 候
异 常 是通 过类 实 例 来标 识的
 except 子 句会 依 据 实 例的 类来选 择它必 须引 用实 例 的 类 或 是 其所 属 的基 类
实 例可 通 过 处 理 器被接 收 并 可 携带 有 关 异 常条 件 的附 加 信息
 注 解 异 常消 息不 是 python  api 的 组成 部分
 其内 容 可 能在 python 升 级 到新 版 本 时 不 经警 告地 发 生改 变 不应 该被 需 要在 多版 本解 释 器中 运行的 代 码所 依赖
 另请 参看 try 语 句小 节中 对 try  语 句的 描述 以 及 raise  语 句 小节 中 对 raise  语 句的 描述
 脚注1 出现这 样 的 限制 是由于 通过这 些操 作执 行的 代 码 在模 块被 编 译 的 时候 并 不 可用
 表达 式
本 章将 解 释 python 中组 成表 达式的 各 种 元 素的 的 含义
语 法 注 释 在 本 章 和后 续章 节 中 会 使用 扩展 bnf  标注 来描 述语 法 而 不 是 词 法分 析
当 某 种 替 代 的语 法规 则 具 有 如下 形 式 name  othername 并且 没 有 给 出语 义 则这种 形 式 的 name  在 语法上 与 othername 相 同
 算术 转 换
原 子
 原 子 指 表 达 式的最 基本 构 成 元 素
 最简单的 原子 是标 识 符和 字面值
 以圆 括号、 方括号 或花 括号 包括的 形式 在语 法 上也 被归类为 原子
原 子 的句 法 为 atom  identifier  literal  enclosure  enclosure  parenthform  listdisplay  dictdisplay  setdisplay  generatorexpression  yieldatom
标 识符名 称
 作为 原子出 现的 标 识符 叫做名称
 请参 看标 识符 和关键字 一节 了解 其词 法定 义以及命 名与 绑 定获 取有 关命名与 绑定 的文 档
当 名称 被绑 定到一个 对象 时对 该原子求 值将 返回 相应 对 象
当 名称未被 绑定 时尝 试对 其 求 值将引 发 nameerror 异 常
 私有名称 转换 当 以文 本形式 出现 在 类 定义中的 一 个标 识 符以两 个 或 更多下 划线 开头 并 且 不以 两个 或更 多 下 划线结 尾它 会 被 视为 该 类 的 私有 名 称
 私有 名称 会在为其 生成 代 码之 前被 转换 为一种更 长的形 式
转 换时 会 插 入类 名移 除打 头的下 划 线 再在名称 前增 加一 个 下 划线
 例 如 出 现在 一 个名为 ham  的类中 的 标识 符 spam 会 被转 换为 hamspam
 这 种转 换独 立于 标 识 符 所使 用 的 相关 句法
 如 果转 换后 的名 称 太长 超过255 个字 符 可能发 生 由 具体 实现 定 义的 截断
如 果类 名 仅由 下 划 线 组成 则 不 会进 行 转换
 字面 值
python 支持 字 符串 和字节 串字 面值 以及几 种 数 字字 面值 literal  stringliteral  bytesliteral  integer  floatnumber  imagnumber  对字 面值 求值 将 返 回 一个 该值 所对 应 类 型 的 对象 字符串、 字 节 串、 整 数、浮 点 数、复数
 对 于浮点 数 和虚数 复 数的情 况该 值可 能为 近 似值
 详情 参见 字面 值
所 有字 面值 都对 应与 不可 变数据 类 型 因此 对象 标识 的重 要性不 如其 实际值
多 次对 具有 相同 值的 字面值求值不论 是发生在程序文 本的相同位置还 是不同 位 置可能 得到 相同 对象 或是 具有 相 同值的 不 同对象
 带 圆括号 的形式
 列表、 集 合与 字 典的 显 示
为了 构 建列 表、 集合 或 字典 python 提 供了名 为显 示 的 特 殊 句法每 个类型各 有两 种 形式第一 种是 显式地列 出容 器内容 第二 种 是通过 一 组循环 和筛选 指令 计 算 出来称为 推导 式
推导式 的常 用句法元 素 为 comprehension  assignmentexpression  compfor  compfor  async  for  targetlist  in  ortest  compiter  compiter  compfor  compif  compif  if  expressionnocond  compiter  推 导 式的结构 是一 个单 独表 达 式后面 加至少一 个 for 子 句以 及 零个或 更多 个 for 或 if  子句
在这 种 情 况 下 新 容 器的 元素产生方 式是 将 每 个 for 或 if 子句视 为一个 代码 块按从左至 右的顺 序嵌套 然 后每次 到达 最 内层代 码块 时就 对表 达式 进行 求值以 产 生 一个 元素
 不过 除了 最左边 for  子句 中的可迭 代表 达式 推导 式是 在另 一个 隐式 嵌 套的 作 用域 内执 行的
 这能 确保 赋给 目 标列 表 的 名称 不 会泄 露 到外 层 的 作 用域
最 左边 的 for 子 句中 的 可迭 代 对象 表达 式 会直接在 外层 作用 域中 被求 值 然后 作 为 一 个 参 数被 传 给隐 式 嵌套 的作 用域
后 续的 for  子句以及最 左侧 for  子句 中的任 何筛 选条 件 不能 在外 层作 用域 中被 求值 因 为 它们 可能 依 赖 于 从 最 左 侧可 迭代 对象 中获 得的 值
 例如 xy  for  x  in  range 10 for  y  inrangex  x 10
 为了 确保推 导式 得出 的结 果 总 是 一 个 类型 正确 的容 器在 隐 式 嵌套 作用 域内 禁止 使用 yield  和 yield  from  表达式
从 python 3
6 开始 在 async  def 函 数中 可以 使用 async  for 子 句 来 迭代 asynchronous  iterator
 在 async  def 函 数中 构建 推导式 可以 通过在打 头的 表达 式后 加上 for  或 async  for  子句 也可 能包 含额 外的 for  或 async  for  子句 还可 能使 用 await 表 达式
 如 果一 个推 导式 包含 async  for  子句 或 者 await  表达 式则 被称为 异步 推 导式
 异 步推 导 式可 以暂 停 执行 它所 在 的协 程函数
另 请参阅 pep 530
3
6新 版 功能 引入 了 异 步 推导 式
在3
8 版更改 yield  和 yield  from 在 隐式 嵌 套 的作 用 域中已 被禁 用
列表显 示
列 表 显示 是一个 用 方 括 号括起来 的 可能 为空 的表 达 式 系 列 listdisplay  starredlist  comprehension 列 表显 示会产 生一 个新 的 列 表 对象 其内 容通 过一 系列 表 达式或 一 个 推 导式 来指 定
当 提供由 逗 号 分隔 的一系 列表 达 式 时其 元素 会 从左 至右被 求 值 并 按 此 顺 序放入 列表 对象
 当提 供一 个 推导 式时 列表会根 据 推 导式 所 产生 的 结果 元 素进行 构建
 集合显 示
集 合显 示 是 用花 括号 标明 的与 字典 显示的 区别 在于 没有冒 号 分 隔 的键 和值 setdisplay  starredlist  comprehension  集合 显示会 产生一个 新的 可 变集 合对 象其 内容 通过 一系 列表 达式 或 一 个 推导 式 来 指定
 当提供 由逗号分 隔的一 系 列表 达式 时其 元素会 从左 至右被求 值并 加入到 集合 对 象
当 提供一 个推导 式 时 集 合会根据推 导 式 所产 生的 结果 元素 进行 构建
空 集合 不 能用来 构建 该字面 值所 构 建的是 一个空 字 典
字 典显示
字 典 显示 是一 个 用花 括号 括起来 的可 能 为 空 的键 数据 对系 列 dictdisplay  keydatumlist  dictcomprehension  keydatumlist  keydatum  keydatum  keydatum  expression  expression  orexpr  dictcomprehension  expression  expression  compfor  字典 显 示 会产 生一 个 新 的 字 典 对象
 如果给 出 一个由 逗号分隔 的键 数 据 对 序 列它 们 会 从左 至 右被 求值以 定 义 字典 的条 目每 个 键 对 象 会被 用作 在 字典中 存 放相应 数据 的键
 这 意 味着你 可以 在键 数据 对 序列中多 次指 定相 同 的 键最 终字 典的 值将 由最 后一 次给 出的键 决 定
 双星 号表 示字 典拆 包
它的 操作 数必须是 一个 mapping
 每个 映射 项被 会加 入 新的 字 典
后 续的值 会替 代先 前的 键 数据 对 和先 前的字 典拆 包所设 置 的值
3
5 新版 功能 拆包到 字 典 显示 最初 由 pep 448 提出
 字 典推导 式与列 表 和 集合推 导式 有所不 同 它 需 要 以冒号 分隔的 两 个 表 达 式后 面带上 标 准 的 for 和 if  子句
当 推 导 式被 执 行时作为 结果的 键和值 元素 会按 它 们 的产生顺 序被 加入新 的字典
 对 键 取值 类 型 的 限 制已列 在 之 前的 标准 类型层 级结构一节 中
 总的 说 来键 的 类型应该为 hashable  这 就 把所有 可变 对 象都 排除 在外
 重 复键 之间的冲突 不 会被 检 测指 定 键所 保 存 的最 后 一个 数 据 即在 显示 中排最右 边 的 文本为 最终 有效 数据
在3
8 版更改 在 python 3
8之前 的字 典推 导 式中 并没有定义 好键 和值 的 求值 顺序
 在 cpython 中 值 会 先于键 被求值
 根据 pep 572的提议 从3
8 开始键会 先 于值被 求值
生成器 表 达式
yield 表达 式
 原型
原 型代 表 编程 语 言中 最紧 密绑 定的 操作
 它 们的 句法 如下 primary  atom  attributeref  subscription  slicing  call
 属 性引 用
属性 引用是后面 带有一个句 点加 一个 名 称的 原型 attributeref  primary 
 identifier  此原 型 必 须求 值为一个支 持属性引用 的 类型 的 对 象 多数 对 象 都支持 属 性 引用
随后该 对 象会被要求 产生以指定 标识符为名 称的属性
这 个产生过程 可通过 重载 getattr  方 法来 自定 义
如果这个 属性不 可用 则将 引 发 attributeerror  异常
 否则 的话 所 产 生对 象的 类型 和 值会 根据 该对 象 来确定
 对 同一属 性引 用的 多次 求值可 能产生不 同的 对象
 抽 取
 对 序列字 符串、元组 或列表 或映射字典 对 象的抽 取操 作 通常 就 是 从相应 的多 项集中 选 择一 项 subscription  primary  expressionlist  此原型 必 须求值 为 一个支 持 抽取操作 的对 象例 如列 表或 字典
用 户定义的对 象可通过定 义 getitem 方 法来 支持 抽取 操作
对 于 内 置对 象有 两种 类型 的对象 支持 抽取操作 如果 原型 为映 射表 达式列表 必 须求值 为一 个以该 映射 的 键为 值 的对 象 抽取 操作 会 在映 射中 选出 该键 所对 应 的值
 表 达式 列 表 为一个 元组 除 非 其中 只有 一项
 如果 原型 为序 列 表达 式 列表 必须 求 值 为 一 个整 数或 一 个切片 详情 见 下 节
正 式句 法规 则并 没 有在 序 列中 设 置 负标 号的 特殊保 留 条款 但是 内置 序列所 提供的 getitem  方法 都 可 通过在索 引中 添加 序列 长度 来 解析 负 标号 这 样 x 1 会 选出 x 中 的最 后一 项
 结果 值必须 为 一个 小于 序列 中项 数的 非 负整 数抽取 操作会 选出 标 号为 该值 的项 从 零开 始 数
由 于对 负 标 号和 切 片的 支持 存 在 于 对 象的 getitem  方法 重载 此 方 法 的 子 类需要 显 式 地 添 加这 种支 持
字 符串的 项 是字 符
字 符不 是单 独的 数据 类 型而 是 仅 有一 个字 符 的字 符 串
对 特 定 类 或 类型的 抽取 操作 会 创 建一 个泛 型别 名
 在 此情况 下用 户 自定义 类型可通 过提 供 classgetitem  类方 法 来 支持 抽取 操 作
切 片
调用
await 表 达式
 挂 起 coroutine  的执 行以 等待 一个 awaitable 对 象
 只 能在 coroutinefunction  内 部 使用
 awaitexpr  await  primary 3
5 新 版 功 能
 幂运 算符
 幂 运 算 符 的绑定比 在 其 左 侧 的一 元运算 符更 紧密 但 绑定 紧密 程度不 及在 其 右 侧 的一 元 运算 符
句 法如 下 power  awaitexpr  primary  uexpr 因 此在 一 个 未加 圆 括号的 幂运 算符和 单 目 运 算 符序 列中运 算符 将从右 向左 求值 这不 会 限制 操 作数 的求 值 顺序12结 果将 为1
幂 运 算符与 附带两 个 参 数调 用内 置 pow 函数具有 相 同的语 义结 果为 对 其 左 参 数进行 其右 参数 所指 定 幂次 的 乘方 运算
 数值 参数会先转 换为相 同 类型结果 也为转 换 后的 类型
 对 于 int 类型的 操 作数 结 果 将 具有与操 作 数相 同的 类型 除非 第二个 参数 为 负数在那 种 情 况下所 有参数 会被 转换 为 float 类 型并输出 float 类 型的结 果
 例如102返回100 而102 返 回0
 对0
0进 行负数 幂 次运 算 将 导致 zerodivisionerror
 对 负 数进 行 分数幂 次运算将 返 回 complex 数 值
 在 早 期版 本中这将 引发 valueerror

 一元 算术和 位 运 算
所 有算 术和 位 运 算具 有相 同 的 优先 级 uexpr  power  uexpr  uexpr  uexpr  一元运算 符 负 会产 生 其数 值 参 数 的 负值
一 元运 算 符正 会产 生与其 数 值 参数 相 同的 值
 一元 运 算 符取 反的 结 果 是对 其整数 参数 按 位 取反
 x 的 按 位取反 被定 义为 x 1
 它只 作用于整数
 在 所有 三 种 情 况 下如果 参数的 类 型不 正确 将引 发 typeerror 异 常
 二元 算术运算 符
 移位 运算
 移 位 运算 的优先 级低 于算术 运 算 shiftexpr  aexpr  shiftexpr  aexpr  这 些 运 算符接 受 整数参 数
它 们会 将 第一 个参数 左移 或 右移第 二 个参 数所 指定的 比特 位 数
右 移 n 位 被定 义为被 pow 2 n  整 除
左 移 n  位被 定义 为乘 以 pow 2 n
 二元位 运算
 三种 位运 算具有 各不相 同 的优先 级 andexpr  shiftexpr  andexpr  shiftexpr  xorexpr  andexpr  xorexpr  andexpr  orexpr  xorexpr  orexpr  xorexpr 运 算符 对两 个参 数 进行 按 位 and 与 运算 两个参 数必 须为整数
运 算符 对两 个参 数进 行按位 xor  异 或 运算 两个 参数 必须 为整数
 运算 符对两个 参数 进行 按位 or  或运 算两 个参 数必 须为 整 数
 比 较运 算
值 比较
 成员 检测 运算
 运算 符 in 和 not  in  用 于成员检 测
如 果 x 是 s  的成 员 则 x  ins  求 值 为 true 否 则为 false
 x  not  in  s  返回 x  in  s 取反后的值
 所有 内置序列 和 集 合 类 型以及字 典 都支 持 此 运算 对于 字典 来 说 in  检 测 其是 否有给 定 的 键
对 于 list  tuple  set  frozenset  dict 或 collections
deque 这样 的 容 器类型 表 达式 x  in  y 等价 于 anyx  is  eor  x  e  for  e  in  y
对于 字 符 串 和字节串 类型 来说 当且仅 当 x  是 y 的 子串 时 x  in  y  为 true
一 个 等价 的 检测 是 y
空字 符 串总 是被 视为任 何其 他字 符串 的子串 因 此 in  abc  将返回 true
 对于 定义 了 contains 方法 的用户 自定 义类来 说 如果 y
containsx 返 回真值则 x  in  y  返 回 true 否则 返 回 false
对 于未 定 义 contains 但 定 义 了 iter 的 用 户 自定 义 类 来 说 如 果 在 对 y  进行迭代 时 产 生 了值 z  使 得表达 式 x  is  z  or  x  z 为 真则 x  in  y  为 true
 如果 在 迭 代 期 间引发 了异 常则 等 同于 in 引 发 了该 异常
 最 后将 会 尝试 旧式 的迭代 协议如 果 一 个 类 定义 了 getitem 则 当且 仅当 存 在 非 负 整 数索 引号 i  使 得 x  is  yi  or  x  yi 并 且没有更 小的索 引号 引发 indexerror  异 常时 x  in  y  为 true
 如 果引 发了 任何其 他异 常则 等 同 于 in 引 发了 该 异常
 运 算符 not  in  被定 义 为 具 有与 in  相反 的 逻辑 值
标 识 号 比 较
运算 符 is 和 is  not 用 于检 测对 象 的 标 识号 当 且 仅 当 x 和 y 是 同一 对象 时 x  is  y 为真
一 个对 象 的标识 号可使用 id  函 数来 确定
 xis  not  y  会产 生 相 反的逻辑值
 布尔运 算
 赋值 表达 式
assignmentexpression  identifier  expression  赋值表 达式 有时 又被 叫做命 名 表达式或海 象 表 达式将 一 个 expression 赋值 给一 个 identifier  同时还返回 expression  的 值
一 个 常 见 用 例是在 处 理 匹 配的 正 则 表达 式 的时 候 if  matching  pattern
searchdata  dosomethingmatching  或者 是在 处 理 分块 的 文件 流的 时候 while  chunk  file
read 9000 processchunk 3
8 新 版功能请参 阅 pep 572了 解有关 赋值 表达 式 的 详 情
 条 件表 达式
conditionalexpression  ortest  if  ortest  else  expression  expression  conditionalexpression  lambdaexpr  expressionnocond  ortest  lambdaexprnocond 条 件表 达 式有 时 称 为三元运算 符在 所 有 python 运 算中 具有 最 低的 优先 级
 表达 式 x  if  c  else  y 首 先是对 条 件 c 而 非 x  求值
 如果 c  为真 x  将被求 值 并 返 回其 值 否 则 将对 y  求 值并 返 回 其值
请参阅 pep 308 了 解有关 条件表 达式的 详情
lambda  表 达式
lambdaexpr  lambda  parameterlist  expression  lambdaexprnocond  lambda  parameterlist  expressionnocondlambda  表达式 有时称 为 lambda  构型被 用于 创建匿 名函 数
表 达式 lambda  parameters  expression  会 产 生 一 个函数 对象
 该未命 名对象 的行为 类似于 用以 下 方 式 定义 的 函数 def  lambdaparameters  return  expression  请参 阅 函 数 定义了解 有关 参数列表 的句法
 请 注 意通 过 lambda 表 达式 创 建的函数 不能 包 含 语 句或 标 注
表 达式 列 表
求 值 顺序
 运 算 符 优先级
 完整 的语 法 规范
 导入 系 统
 一 个 module  内 的 python 代 码 通 过 importing 操 作 就能 够访 问另 一 个模块 内的 代码
 import 语句是 发起调 用导入机 制的最常 用 方 式 但不是唯 一 的方 式
 importlib
importmodule  以及 内 置 的 import 等 函 数 也 可以 被用 来 发 起 调用 导入机 制
import  语 句结合 了两 个 操 作它 先 搜索 指定 名称 的 模 块然 后 将搜 索 结果绑定 到当 前作 用域 中 的名 称
 import 语句 的搜索操 作 定 义 为对 import 函数 的调 用 并带 有 适 当的 参 数
 import 的返 回值会 被用 于 执 行 import  语 句的 名 称绑定 操 作
请参 阅 import  语句 了 解 名 称 绑定 操 作的 更多 细 节
对 import 的 直 接调 用 将 仅执 行模块 搜索 以及在 找 到时 的模块 创建 操 作
 不 过 也可 能产 生某 些副作 用例 如 导 入 父 包和 更 新各 种 缓存包括 sys
modules  只有 import 语句 会执 行名称绑 定操作
 当 import 语句 被 执 行时 标准 的内置 import 函数 会 被调 用
 其他发 起 调 用导 入 系 统 的机 制例 如 importlib
importmodule 可 能会 选择 绕 过 import  并 使 用它 们自 己 的 解决方 案来实 现 导入机 制
当 一个 模块首 次 被导入 时 python 会 搜 索该 模 块如 果 找到 就 创 建一 个 module 对象1 并 初 始化它
 如果 指 定 名称 的模 块未找 到 则会引 发 modulenotfounderror
当发起 调用导 入 机 制时 python  会 实 现 多种 策 略来 搜索指定 名 称的 模块
 这 些策 略 可 以 通过使 用使用 下文 所 描 述 的多 种钩子 来加以 修改 和 扩展
 在3
3版 更改 导入 系 统 已被 更 新 以完 全 实现 pep 302中 的第 二 阶 段 要求
 不会 再 有任何隐 式的 导入 机制——整 个导 入 系统都通 过 sys
metapath  暴 露 出来
 此 外对 原 生命 名 空间包的 支 持也 已被 实现 参 见 pep 420
importlib
importlib  模 块提 供了一个 丰富 的 api 用来 与导 入 系 统进 行交互
 例如 importlib
importmodule 提 供了相 比内置 的 import  更 推荐、更 简 单的 api  用来 发 起调 用导 入机制
 更多细 节请参看 importlib  库 文档
 包
python  只有 一 种模 块对象类型 所有 模 块都属 于 该 类 型 无 论模块 是 用 python 、 c 还 是 别 的语 言实 现
为了 帮助 组织 模 块并 提 供名 称层 次结构 python  还 引入 了包的 概念
你 可以把 包 看成 是文件 系 统中 的 目录并 把 模 块 看 成 是目 录中 的文 件但 请不 要对这 个类 似 做过 于字 面的 理 解 因为包和 模块 不 是 必 须来 自于 文件 系 统
 为了 方便 理解 本文档 我 们将 继续 使用 这种 目录 和文 件的类 比
 与 文件系 统一 样包 通 过 层次 结构 进行 组织 在 包之内 除 了一 般的模块 还可 以有 子包
 要注 意的一个 重点 概 念是 所有包都 是 模块但并非 所有 模 块 都是 包
或者 换 句 话 说包只 是 一 种特 殊的 模块
特别 地任何具 有 path  属 性 的 模块 都会 被当作是 包
所 有模 块 都有自 己 的 名 字
 子 包 名与 其 父包 名 以点 号分 隔 与 python 的标 准 属 性 访 问语 法致
例 如 你可能 看到一个 名为 sys 的 模块 以 及一个名 为 email 的 包这 个包中又有 一个 名 为 email
mime  的 子包和 该子 包中的 名 为 email
text  的子 包
 常规包
python 定 义了 两 种 类 型 的包常 规包 和命名空 间包
常规 包是 传统 的 包 类 型它 们在 python 3
2及之 前就已 存在
 常规 包通常 以一 个包 含 init
py  文件的 目录 形式 实现
 当 一个常规 包被 导 入 时这个 init
py  文件会隐式 地 被执 行 它所定 义 的对象 会 被 绑 定 到该 包命 名 空间 中的 名 称
init
py  文 件可 以包 含与任 何 其他 模 块中 所包含的 python  代码 相似的 代码 python 将在 模块 被导入 时为 其 添加 额外 的属 性
 例 如以 下文件 系 统布 局定 义了 一个 最 高 层 级的 parent  包和 三个子 包 parent  init
py 导入 parent
one 将 隐式地 执行 parentinit
py 和 parentoneinit
 后续 导 入 parent
two 或 parent
three 则 将 分 别执行 parenttwoinit
py  和 parentthreeinit
py
命 名空间 包
命 名空间 包 是 由多 个部 分构成 的每 个部 分为父 包 增加 一个 子包
 各 个部 分可 能处 于文件 系 统 的 不 同位 置
部 分也 可 能处 于 zip  文 件 中、 网 络上 或者 python 在导 入期 间 可以 搜 索的 其他 地方
命 名 空 间包并不 一 定会 直接 对应到文 件系 统中的对 象它 们有 可 能是无实体 表示的虚拟 模 块
命 名空 间包的 path  属性 不使用 普 通的 列 表
而 是使用 定 制的 可迭代 类 型 如果其 父 包的 路 径或 者最高 层级 包的 sys
path  发生 改变 这种对 象会 在 该 包 内的下一 次 导入尝试时 自动 执行新 的 对包 部分 的搜索
命名 空间 包 没有 parentinit
py  文件
 实际 上在导 入 搜索期 间 可 能 找 到多 个 parent 目 录每个 都由 不同 的部分 所提供
 因此 parentone 的 物理 位置不 一定 与 parenttwo  相邻
在 这种 情 况 下 python  将为 顶级 的 parent 包 创 建 一个 命 名 空 间包 无论 是它本 身还是 它的 某个 子包 被 导 入
另 请参 阅 pep 420 了 解对 命 名 空间包的 规格描 述
搜 索
模 块 缓 存
 在导 入 搜索 期 间首先 会被检 查的 地方是 sys
这 个 映 射起 到缓存 之前导入 的 所有 模块的作 用 包括其中 间路 径
 因此如果 之前导 入 过 foo
baz 则 sys
modules  将包含 foo  foo
bar  和 foo
baz 条 目
每 个 键的值就 是相 应 的模 块对 象
 在导 入期间 会 在 sys
modules 查找 模 块 名称如 存在 则 其 关联的 值就是 需要导入的 模 块导入 过 程 完成
 然而 如果 值为 none  则会 引发 modulenotfounderror
 如果找 不 到指 定模 块 名 称 python 将 继续搜 索该 模 块
modules  是可 写的
删 除键 可 能 不会破 坏关 联的 模块 因为 其 他模 块可 能 会 保留对 它的引 用但 它 会使 命 名模 块的 缓存 条目 无效 导致 python  在 下次 导 入 时 重新搜 索命名 模块
 键 也可以 赋 值 为 none  强 制下 一次导入 模块 导 致 modulenotfounderror 
 但是 要小 心 因为 如果你 还 保有 对 某个 模块 对象 的引用同 时停 用其 在 sys
modules 中 的缓存条 目 然后 又再 次 导入该 名称 的 模块则前 后 两个 模块 对象 将 不 是同 一 个
相 反 地 importlib
reload 将重 用 同一个模 块 对 象并 简单地通 过重 新运 行模 块的 代 码来 重 新 初 始化模块内 容
查 找 器和 加 载器
 如 果 指定名 称的模 块在 sys
modules  找 不到则将 发起 调 用 python 的 导 入协 议以 查 找和加 载 该模块
此 协 议由两 个概 念 性模块 构成即 查找器和加 载 器
 查找器 的任 务是确 定是 否能使 用其 所 知 的策 略找 到 该名 称 的模 块
 同 时 实 现 这 两种接口 的 对 象 称为 导入 器——它 们 在确定能 加 载所 需的模块 时会 返回 其 自 身
python 包含了多 个默认 查 找器 和导入器
 第一 个知 道 如何 定 位 内置模块 第 二个知道 如 何定 位冻 结 模 块
第 三个 默 认查 找 器会 在 import  path  中搜 索模块
 import  path 是 一个由 文件系 统 路 径或 zip  文件 组 成的 位置 列 表
它 还可 以扩展 为搜 索任意 可 定位 资源 例 如由 url  指 定 的 资 源
导 入 机 制 是 可 扩展 的因此 可以 加 入新 的查 找器 以 扩展 模 块搜 索 的范围 和作 用 域
查 找 器并 不真 正加载 模 块
如 果它 们 能找 到指定 名 称 的 模 块会 返回一 个 模 块规格说 明 这是对模 块 导入 相 关信 息的 封装供 后续 导入 机 制 用于在 加载 模 块 时使 用
以 下 各节描 述 了有关 查找器 和加 载 器 协议 的更多细 节 包括 你应 该如何 创建 并 注册 新的 此类对象 来 扩展 导入机 制
 在3
4版 更改 在之 前的 python 版 本中 查 找器会直 接返 回加 载器 现在 它 们则 返 回模块规 格 说明 其中 包 含加 载器
 加载 器仍 然在导 入期间 被使 用但 负担 的任务有 所减少
导 入钩 子
 导 入 机制 被设 计 为 可 扩展 其中 的基 本机制 是导 入 钩 子
导 入钩 子有两 种 类 型元 钩子和 导入 路径 钩子
 元钩 子在 导入 过程开 始时被调 用此时 任 何 其他导 入过程 尚未 发生 但 sys
modules  缓存 查找除 外
 这允许元 钩 子 重载 sys
path 过 程、 冻 结 模 块甚至 内置 模块
元钩 子的注 册是 通 过向 sys
metapath  添 加新的 查 找器 对 象具 体 如 下所 述
 导入 路径钩 子 是作 为 sys
path  或 package
path  过 程 的一部分 在遇 到 它们 所关联的 路径项的 时候 被 调用
 导入 路径 钩 子 的注册 是 通 过向 sys
pathhooks 添加 新 的可调 用 对象 具体如下 所述
元路 径
 加 载
 当一个 模块说 明被 找 到 时导 入 机制将在 加载该 模块时 使用它 及 其所 包含 的加 载 器
下面是 导入 的加 载部分 所发 生 过程 的简要 说 明 module  none  if  spec
name  请 注意 以 下 细节如果 在 sys
modules 中 存在 指定 名 称的模 块对象 导 入操 作会 已 经 将 其 返 回
 在加 载 器执 行 模 块代 码 之 前 该 模 块 将 存 在于 sys
modules  中
这一点 很关 键因为 该 模 块代 码可 能直接 或 间接 地导入 其自 身 预 先 将其 添 加到 sys
modules  可防止 在最 坏情 况下的 无限递归 和最 好 情 况下 的 多 次 加载
 如 果 加 载失 败 则 该 模块只 限 加载 失 败的 模块 将从 sys
modules  中移 除
 任 何已 存 在于 sys
modules  缓 存的 模块 以及 任 何 作为 附带 影响被成功 加 载的模 块仍 会保 留 在 缓存中
 这 与 重新 加载 不同后 者会 把 即 使 加载 失 败 的模块也 保留 在 sys
modules 中
 在模块创 建完成但 还未 执行之前 导入 机 制会设置 导 入 相关 模块 属性在 上 面的 示例伪 代 码 中 为 initmoduleattrs  详情参 见后续部 分
 模块执行是 加 载的 关键 时刻 在 此期间 将填 充模 块的 命名空间
 执 行 会 完全委 托给 加载 器 由 加 载器决定 要填 充的 内 容和方式
在 加载 过程 中创 建并传 递给 execmodule  的 模块 并不一 定就 是 在导 入结束时 返回 的 模 块2
 在3
4版 更改导 入系 统已 经 接 管了加 载器建立 样 板 的责 任
 这 些 在 以 前 是由 importlib
loadmodule 方法 来 执行 的
加载 器
 模块 加载器提供 关键 的 加载 功 能模块执 行
 导 入机 制 调 用 importlib
execmodule 方法并 传入 一 个 参 数来 执行 模 块对 象
 从 execmodule 返 回的 任 何 值 都 将 被 忽 略
加载 器必 须满 足下 列要 求如 果模 块是 一 个 python 模 块而非内置 模块 或动 态加 载 的扩 展 加 载器 应该在 模块 的 全局 命 名 空 间 module
dict 中 执行 模块的 代码
如果加 载器无 法执行 指 定模块 它 应 该引 发 importerror 不 过在 execmodule  期间 引发 的 任 何其 他异常 也 会被 传播
 在 许多情况下 查 找器和 加载 器可以 是同 一对 象在 此情 况下 findspec  方法 将 返回 一个 规 格说 明 其 中加载器会 被设为 self
模 块加载器 可以选择 通 过实现 createmodule 方法在 加载 期 间创 建模 块对 象
它 接受 一个 参数 即模 块规 格 说明 并返 回新 的模 块 对象供 加载期 间使 用
 createmodule  不需 要在模 块 对 象 上 设置 任何属性
 如果 模 块 返 回 none 导 入 机 制将 自 行 创建新 模块
3
4 新 版功 能加载器 的 createmodule 方 法
在3
4版 更改 loadmodule  方法被 execmodule  所 替代 导入 机制 会 对加载 的所 有样 板责 任作出 假定
 为了 与现有的加 载器 兼容 导入机 制会 使 用 导入 器的 loadmodule  方法 如 果它 存 在 且导 入器也未 实现 execmodule
 但是 loadmodule 现 已 弃用 加载器应该转而 实 现 execmodule
 除了执行 模块 之外 loadmodule  方法必须实现上 文描 述的所有样 板加 载 功 能
 所 有相 同 的 限 制仍 然 适用 并 带 有一 些附加 规 定 如果 sys
modules 中存在 指定 名称 的模 块 对象 加载 器必须使 用已 存在 的模 块
 否则 importlib
reload  将无 法 正 确 工 作
 如果 该名 称模 块不 存在于 sys
modules  中加 载器必 须 创建 一个 新的 模块 对象并将其 加 入 sys
在 加 载 器执行 模块 代码之 前模 块 必 须存在 于 sys
modules 之 中 以防 止无限递 归或多 次加 载
如 果加 载失 败加 载器 必须移除 任何 它 已加 入到 sys
modules  中的 模块 但 它必 须 仅限 移除加载 失败的模块 且所移除 的模块应为 加 载器 自身 显式 加 载的
 在3
5版更改 当 execmodule  已定 义但 createmodule  未 定义时将 引发 deprecationwarning
 在3
6版 更 改当 execmodule  已 定 义但 createmodule  未定 义时 将 引 发 importerror
子 模 块
模 块规 格说明
 导入相关 的模块 属性
modulepath
 模 块 的 repr
 默 认情况 下全 部模块都 具 有 一个 可 用 的 repr 但是 你 可 以依据 上述的 属性设 置 在 模块 的规格 说 明中更 为显式 地 控 制模 块对 象的 repr
如 果 模块 具有 spec  spec  导 入 机制 将尝试 用它 来 生成一 个 repr
 如 果生成失 败 或找不 到 spec 导入 系统将 使 用 模 块 中的各 种可 用 信息 来 制 作一 个默 认 repr
 它 将 尝试 使 用 module
name  module
file 以 及 module
loader 作 为 repr 的 输入并将 任何 丢失 的信息 赋为 默认 值
以 下 是 所 使 用的 确 切规 则如 果模 块 具 有 spec  属性 其中 的规格 信 息 会被 用来 生成 repr
被 查询 的属 性有 name  loader  origin 和 haslocation  等等
 如 果 模 块 具 有 file 属 性这 会被用 作 模 块 repr 的 一部分
 如 果模块 没 有 file  但是 有 loader 且 取 值不 为 none 则 加 载 器 的 repr  会 被 用作 模 块 repr  的一 部分
对于 其 他 情况 仅在 repr 中 使 用 模块 的 name
在3
4版更 改 loader
modulerepr  已 弃用 导入 机 制 现在使 用模 块 规格说明 来生 成模块 repr
为 了向 后兼 容 python 3
3如 果加载 器定 义 了 modulerepr 方 法则 会在尝试 上述 两 种方 式 之前 先调 用该 方法来 生成 模 块 repr
但请 注意 此方 法已弃 用
已 缓存字节 码的 失 效
在 python  从
pyc  文 件加 载已缓存 字 节码 之前 它会 检 查缓 存是否 由最 新的
py  源 文 件所生成
 默认 情况 下 python 通 过在所写入 缓存 文 件中保 存 源 文件 的 最新修 改时 间戳 和大小来 实 现这一 点
在 运 行时导入 系 统会通过 比 对 缓存文 件 中保 存的元 数 据 和源 文件 的 元数据确 定该 缓存 的有效 性
python  也支 持 基 于哈希 的 缓存文 件 即 保存 源文件内容 的 哈希 值而 不是 其 元数据
存在 两种 基于哈 希 的
pyc  文件 检查 型 和非检查 型
对于检查 型基于 哈希 的
pyc 文件 python  会通 过 求哈 希源 文 件并将结 果哈 希值与 缓存 文件中 的哈希 值比对 来确 定缓存 有效 性
如果检查型 基于 哈希 的缓存 文件 被确 定为 失效 python 会 重新生成 并写 入一个新的检查 型基于 哈希 的缓存 文件
对 于非 检 查型
pyc 文件 只 要其存 在 python 就 会直接认定 缓存文件 有效
 确定 基于 哈希的
pyc 文 件有 效性 的行 为 可通 过 checkhashbasedpycs 旗标来 重载
在3
7 版更改增 加了 基 于哈 希的
pyc  文 件
 在此 之前 python  只支持基 于时 间戳 来 确定字 节码缓 存的 有效性
 基 于 路径 的 查找 器
 路 径 条 目查找 器
路 径 条目 查找 器协 议
 为 了支持 模块 和已初始 化 包的 导 入 也 为了 给命 名空间包 提供组 成部分 路径 条目 查找 器 必须实 现 findspec 方 法
findspec 接 受 两个参数 即要 导入 模块的 完整 限定 名称 以 及可 选 的目 标 模块
 findspec 返 回 模 块的 完 全填 充好的 规格说 明
这个 规格 说明总 是包含加 载器集合 但有一 个例 外
为了 向导入 机 制 提示 该规 格说 明代 表一 个命名 空间 portion  路 径 条 目查 找 器会 将 submodulesearchlocations 设 为 一 个包 含该 部分 的 列表
在3
4 版 更 改 findspec 替 代 了 findloader  和 findmodule 后 两者现 在 都已 弃用 但会 在 findspec 未定 义 时 被使 用
较旧的 路径 条 目查 找器可 能 会实现 这 两 个已弃 用的方 法 中 的 一个而 没有 实现 findspec
 为 保持 向后兼 容这两 个方 法仍会 被接 受
 但是 如 果 在 路径 条 目 查 找 器上 实现 了 findspec 这两 个遗 留方 法 就 会被 忽略
findloader 接受 一 个参数 即要导 入模 块的 完整限 定名 称
 findloader 返回 一个2 元 组其 中第一 项是加 载器而 第 二项 是 命 名空间 portion
为 了向 后兼 容其他导入 协 议 的 实 现许 多 路 径条 目 查 找器 也 同样 支持元 路 径 查 找器 所支 持 的 传统 findmodule  方 法
 但 是 路径 条 目查 找 器 findmodule  方 法的 调用 绝 不 会 带 有 path 参 数它 们被 期望记 录 来 自对 路 径钩 子初 始调用 的恰当 路径 信息
 路径 条目查 找 器 的 findmodule  方 法 已 弃 用 因 为它 不允 许 路径条目 查 找 器为 命 名 空 间 包 提供部 分
 如 果 findloader 和 findmodule  同时 存在 于一 个 路 径条 目查 找器中导 入 系 统将总 是调 用 findloader 而 不选 择 findmodule
替 换 标准 导 入 系统
 替换 整 个导 入系 统的最 可靠 机 制 是移 除 sys
metapath  的默 认内 容将 其 完全 替换 为 自 定 义 的元 路 径 钩 子
 一 个可 行的 方 式是 仅改 变导 入 语句的行 为而 不 影 响 访 问 导 入系 统 的其 他 api 那 么替换 内置 的 import 函 数可 能就够 了
这种 技 巧 也 可以 在 模 块 层 级上运 用即 只 在某 个 模块 内部改 变导 入语 句 的行 为
 想要选择性 地 预先 防止 在元 路 径上 从一 个钩子 导入某些 模块 而不 是完全禁 用 标准 导 入系统 只需 直 接 从 findspec 引 发 modulenotfounderror 而 非返 回 none  就足 够了
返 回后 者 表 示元 路 径 搜索 应 当 继 续而 引发 异常 则会 立 即 终 止搜 索
 包相 对导 入
相对导 入 使用 前缀 点号
 一个 前 缀 点号 表 示相 对导 入从 当前 包 开始
两 个或 更多前缀 点号 表 示 对当 前 包 的 上级 包的相 对导 入第 一个 点 号 之后 的 每个 点 号 代 表 一级
 例如 给 定以 下的 包布 局结 构 package  init
py 不 论是 在 subpackage 1 modulex
py 还是 subpackage 1 init
py  中以 下 导 入都 是 有 效 的 from 
modulea  import  foo 绝对 导入 可 以 使用 import  或 from  import 语法 但 相 对 导入只 能 使用 第 二种 形 式其中 的原 因 在于 import  xxx
zzz 应 当提 供 xxx
zzz  作 为可 用表达 式但
moduley  不是 一 个有 效 的表 达式
 有关 main 的 特殊 事项
对 于 python  的 导入 系 统来 说 main 模块 是 一 个特 殊 情况
 正如 在另 一 节中 所述 main  模块是 在解 释器 启动时直 接初 始化 的与 sys  和 builtins 很 类 似
但是 与那 两者 不 同 它并 不被 严 格 归类 为内置 模块
这 是因为 main  被 初始 化 的 方 式 依 赖于发 起调 用解 释器所附 带的 旗标 和其 他选 项
mainspec
根 据 main  被初 始 化的 方式 main
spec 会 被设 置相应 值 或 是 none
当 python  附加 m  选项启 动 时 spec 会 被设为相应 模块 或 包的 模块规 格说 明
 spec 也会 在 main 模 块 作 为执 行某 个目 录 zip 文 件或其它 sys
path 条 目的 一 部分 加载时 被 填充
 在其 余 的 情况下 main
spec  会被 设 为 none  因 为 用 于填 充 main 的 代码 不直 接与可 导 入 的 模块相 对应 交互型提 示 c  选 项 从 stdin 运 行 直接 从源码 或字 节码文 件 运 行请 注 意 在最 后一 种情 况中 main
spec  总是 为 none 即 使文 件从技 术上 说可 以作 为一 个模 块被导 入
如 果 想要 让 main 中 的元 数据 生效 请使用 m  开 关
 还要 注意 即使是在 main  对应 于一个可导 入模块 且 main
spec 被相应 地设 定时 它 们仍 会被 视 为不 同的 模块
 这 是由 于以下事实 使用 if  name  main 检测 来 保 护 的代 码块 仅 会 在模 块被 用来 填充 main 命名 空 间 时而 非普 通的导入 时 被执 行
 开放 问题项
 参考 文献
 导入机 制 自 python  诞生 之初至 今已发生了 很大的 变化
原始 的包 规格 说 明仍 然可 以 查阅 但在 撰写 该 文档 之后许多相 关细节已 被 修 改
 原始 的 sys
metapath 规格说 明见 pep 302 后续的 扩展 说明 见 pep 420
pep 420为 python 3
3 引入 了 命 名 空间 包
 pep 420还 引入 了 findloader  协 议作为 findmodule  的 替 代
pep 366 描 述了 新增的 package  属性 用 于 在 模块中 的显 式 相对导 入
pep 328 引 入了 绝对 和 显 式相对 导入 并 初 次 提 出了 name 语 义最 终 由 pep 366 为 package 加入 规范 描述
pep 338 定 义了将 模块 作为 脚本 执 行
pep 451 在 spec  对 象中 增加 了对 每 个模块 导 入 状态的封 装
它 还 将加载器 的大 部分 样板责 任移 交 回导入 机制 中
 这些 改变允 许弃 用导 入系 统中的一 些 api  并 为 查找 器 和 加载 器增 加 一 些新 的方 法
脚 注1参 见 types
2 importlib  实 现避 免 直接使用 返回值
 而是通 过在 sys
modules  中查 找 模块名 称来获 取模 块对 象
 这 种 方式 的间 接 影响 是被 导入的模 块可 能在 sys
modules  中替 换其自 身
这 属于 具体 实现 的特定 行 为 不保 证能在其 他 python 实 现中 起 作用
3 在 遗 留 代码 中 有可 能在 sys
pathimportercache  中找 到 imp
nullimporter  的 实例
建 议 将这些 代码修改为 使用 none 代 替
 详 情 参见 porting  python  code
python 语 言 参考
 本参 考手 册描 述了 python  的 语法 和核 心 语义
 本参考 是 简洁 的但 试图做到 准确 和完整
非 必要 的内建对 象 类型 和内 建函数、模 块的 语义 描述 在 python 标 准 库中
 有关 该 语言 的 非正 式介 绍 请参 阅 python 教 程
 对 c 或 c  程 序员还有 两个 额外 的手册 扩展 和 嵌入 python 解 释器 概述 了如 何 编写 一个 python  扩 展模 块 pythonc  api 参考 手册 详 细介 绍了 cc 中可 用的 接口
 概述1
 其他实现1
 标注2
 词 法分析2
行 结构2
 其他形 符2
标 识符 和关 键 字2
 字面 值2
 运 算符2
分 隔 符3
数 据 模 型3
对 象、值与 类 型3
标准 类型层 级结 构3
 特殊 方法 名 称3
 协 程4
执 行模 型4
 程 序的 结构4
命 名 与 绑 定4
 异常5
 导入系 统5
 包5
 搜 索5
加 载5
基于 路径 的 查找器5
 替 换标准 导入 系统5
 包 相对 导 入5
有 关 main  的 特殊 事项5
开 放问 题项5
 参考 文献6
表 达式6
 算 术 转换6
 原 子6
原 型6
 await 表 达式6
 幂运 算符6
一 元算 术和 位 运算6
 二元 算术 运算符6
移位 运算6
二 元 位运算6
 比 较 运算6
 布尔 运 算6
 赋值 表 达式6
 条 件表达 式6
 lambda  表达式6
 表达 式 列表6
 求 值 顺 序6
 运 算符 优先 级7
 简单 语句7
表达 式 语句7
赋值 语句7
 assert  语句7
 pass  语 句7
 del 语 句7
 return 语 句7
 yield  语句7
 raise 语句7
 break  语 句7
 continue  语句7
 import  语 句7
 global 语 句7
 nonlocal  语句8
 复 合语 句8
 if 语句8
 while  语句8
 for  语 句8
 try 语句8
 with 语 句8
函数定 义8
 类定义8
 协程9
 最 高层 级组件9
完 整的 python  程序9
文件输 入9
交 互 式输入9
 表达 式输 入10
完 整的 语 法规 范
 概 述
 其 他 实 现
 标 注
词法 分析
 行结 构
 一个 python 程 序可 分为许多 逻辑行
逻辑 行
物理 行
 物 理行 是 以 一 个行终止 序列结 束的 字符 序列
 在源 文件和 字 符 串中可以 使用任 何标 准平 台上的 行 终 止 序 列 unix  所 用的 ascii  字 符 lf 换行 windows  所 用的 ascii 字 符 序列 cr  lf  回车 加 换行 或者旧 macintosh  所 用的 ascii 字 符 cr 回 车
所有这 些 形式 均可 使用无论 具体平 台
 输入 的 结 束 也 会 被 作 为 最 后 一个 物 理 行 的 隐含 终止标 志
当 嵌入 python  时源码字 符串传 入 python  api  应 使 用 标 准 c  的 传 统换 行 符 即 n  表示 ascii 字 符 lf  作为 行终 止标 志
 注 释
一 条 注 释 以不 包含 在字符 串字 面 值 内的 井号 开 头 并 在物 理行 的 末 尾结 束
一 条 注释 标志着逻 辑行 的 结 束 除非 存 在 隐含的行 拼接 规 则
 注 释在 语法分 析 中 会被 忽略
编码声 明
如 果一 条 注释 位于 python  脚 本的第一 或第 二行 并 且匹配 正则表达 式 codingsw
 这条 注 释 会 被 作为编码 声 明 来处 理 上 述 表达 式的 第 一 组 指定 了源 码文 件 的编 码
 编 码 声 明 必 须 独占 一行
如 果它 是在第二 行则 第一行 也 必 须是 注释
推 荐的 编码声明 形式如下 coding  encodingname  这也 是 gnu  emacs  认可的 形 式 以 及 vimfileencodingencodingname  这是 bram  moolenaar 的 vim 认 可 的 形式
 如果 没有编 码 声明 则默认 编码为 utf 8
 此 外如 果文 件 的 首字 节为 utf 8字节 顺 序标 志 bxefxbbxbf  文 件编码 也声明为 utf 8 这 是 microsoft 的 notepad  等 软件 支 持的形 式
 编码 声明指 定的 编 码名 称 必须 是 python  所认可 的编 码
 所有 词法 分析 将使 用此编 码 包括 语义 字 符串、 注 释和 标识 符
 显式 的 行拼 接
隐式 的行 拼接
 圆括号、 方括 号 或花 括号以 内的 表达式 允许分 成多 个物 理行 无需 使用 反 斜 杠
 例如 monthnames  januari  februari  maart  these  are  the  april  mei  juni  dutch  names  juli  augustus  september  for  the  months  oktober  november  december  of  the  year  隐式 的行 拼 接可 以带 有 注释
 后续 行的 缩 进不 影响 程序 结 构
 后 续行 也允 许为空白行
 隐 式 拼 接的 行之间 不会 有 newline  形 符
 隐 式拼 接 的 行 也 可以 出 现 于 三 引 号 字 符串中 见下此情 况下这 些 行不 允 许 带 有 注 释
空 白行
缩进
 一个逻辑 行 开 头处 的空 白 空格 符和 制 表符 被用 来计算 该 行的缩进 等级以决 定语句 段落 的 组织 结 构
制表 符 会 被从 左至 右替换为 一至 八个 空格这 样缩 进的 空格总 数 为八的 倍数 这是为 了与 unix  所用 的 规则一致
首 个 非空 白字 符之 前 的 空格 总 数将确 定该 行 的缩 进层次
 一个 缩进不 可 使 用反斜 杠 进行 多 行拼接 首个反斜 杠之前 的空格 将确 定缩 进 层次
 在 一个 源文 件中 如果 混合使用 制表符 和 空格符 缩 进 并使得确 定缩进 层次 需要 依赖于 制表符对 应 的空 格 数量 设置 则被 视为 不 合 规则 此情 况将 会引 发 taberror
跨 平台兼容 性注 释 由于 非 unix 平台 上文本编辑 器 本身的 特 性在一个 源文 件 中 混合 使 用 制表符和 空格 符是不 明智的
 另外 也要注 意不 同平 台还 可能 会显式地 限 制最大 缩进 层 级
行首 有时 可能会 有一 个 进纸符 它在上 述缩 进层级 计算 中会被 忽 略
处 于行首 空格 内 其他 位置的 进纸 符的 效 果未 定义例 如它可 能导 致空 格计数重 置为零
 多 个连续 行各自 的缩 进层 级将会 被放 入一个 堆 栈用来 生成 indent  和 dedent 形 符具体说 明如 下
在 读取 文件的第一 行之前 先 向 堆 栈推 入 一个 零值 它将 不再被弹 出
被推入 栈的 层 级数 值从 底 至顶 持续 增 加
每 个逻 辑 行 开 头的 行缩 进层 级将 与栈顶 行比 较
 如 果 相 同则不 做处 理
如 果新行 层级较高 则会被 推入 栈顶 并生 成 一 个 indent 形 符
如 果新 行层 级 较 低 则 应 当是 栈中 的层 级数值 之一 栈中 高 于该层 级的 所有 数值都将 被弹 出每弹出 一 级数 值 生 成一个 dedent  形符
 在 文件 末 尾 栈中 剩 余 的 每 个 大 于 零 的 数 值生成 一个 dedent 形 符
 这 是一个正 确 但令 人迷惑的 python  代码 缩进 示 例 def  perml  compute  the  list  of  all  permutations  of  l  if  lenl 1 return  l  r  for  i  in  rangelenl  s  li  li 1 p  perms  for  x  in  p  r
appendlii 1 x  return  r 以 下示例 显 示了 各 种缩 进错 误 def  perml  error  first  line  indented  for  i  in  rangelenl  error  not  indented  s  li  li 1 p  permli  li 1 error  unexpected  indent  for  x  in  p  r
appendlii 1 x  return  r  error  inconsistent  dedent  实际 上前 三个 错误 会被 解析 器发 现只 有最 后一 个错 误是由 词法 分 析器发 现的 return  r  的缩 进无 法匹 配 弹出 栈的 缩 进 层 级
形 符 之 间 的空 白
其 他形 符
除了 newline  indent 和 dedent  还存在 以 下 类别 的形 符 标 识符关 键 字字 面 值运 算符 以 及 分 隔 符
空 白字 符之 前讨 论 过的 行 终止 符除 外 不属 于形 符 而 是 用 来分 隔形符
如 果 存在二 义 性 将从 左至 右 读取尽 可能 长的 合 法字符 串组 成 一 个形 符
 标识符 和 关 键字
标识 符 或 者叫 做名 称由 以下 词法 定 义进 行描 述
python 中 的标识 符语 法是 基 于 unicode  标准附 件 uax 31 并加 入了 下文 所定 义的 细化 与 修 改 更 多细 节还 可参 见 pep 3131
在 ascii  范围 内 u 0001
u 007 f  可 用于 标 识符 的字符 与 python 2
x 一致大写 和小写 字母 a  至 z 下划 线 以及 数 字0至9但 不 可以 数 字打头
0引 入了 ascii 范围 以 外 的 额 外字符 见 pep 3131
 这些字符 的分 类 使 用包含 于 unicodedata 模块 中的 unicode  字符数 据 库版 本
标识符 的 长度 没 有限 制
对 大小 写敏 感
 identifier  xidstart  xidcontinue  idstart  all  characters  in  general  categories  lu  ll  lt  lm  lo  nl  the  underscore  and  characters  with  the  otheridstart  property  idcontinue  all  characters  in  idstart  plus  characters  in  the  categories  mn  mc  nd  pc  and  others  with  the  otheridcontinue  property  xidstart  all  characters  in  idstart  whose  nfkc  normalization  is  in  idstart  xidcontinue  xidcontinue  all  characters  in  idcontinue  whose  nfkc  normalization  is  in  idcontinue 上 文所 用 unicode  类别码的 含 义 lu  大写字 母 ll 小 写 字母 lt  词 首 大 写 字母 lm 修 饰字 母 lo 其 他 字母 nl  字母 数字 mn 非 空 白标 识 mc 含空 白标 识 nd 十 进 制 数字 pc 连 接标 点 otheridstart 由 proplist
txt  定义 的显式 字符 列表 用于 支持向 后兼 容 otheridcontinue  同上所有 标 识 符 在解 析 时会 被转 换为规 范形式 nfkc  标 识符 的 比 较 都 是基 于 nfkc
unicode 4
1 中 所 有可 用的 标识符 字 符列 表可 参见 以下 非 正 式 html  文件 httpswww
 关 键 字
 保 留的 标识符 类
 某 些 标 识符 类除 了关 键字 具有 特殊的含 义
这 些标 识符 类的 命 名模 式是 以 下划 线字 符打 头 和 结尾 不会 被 from  module  import  导入
 特 殊标 识 符 在交互式 解 释器 中被 用来存 放 最 近 一次求值 结果 它保 存 在 builtins 模 块中
 当不 处于 交 互模式 时无 特 殊含 义也 没有 预定义
 参见 import 语 句
注解 作 为 名称常 用于 连接国际 化 文本 请 参看 gettext  模 块 文 档了 解 有关 此 约定的 详情
系 统 定义 的名 称 在非正式 场 合 下被 叫做 dunder  名 称
 这些 名称是 由解 释器 及 其实 现 包括 标 准库 定 义的
 现有系统 定 义名 称相 关的讨论 请参 见 特殊方 法名称 等章 节
未 来的 python  版本中 还将 定义 更 多 此类 名称
 任 何情 况下 任 何不 遵 循文 档 所 显式 指 明的 名称 使用 方 式都 可 能导致 无 警告的 错误
 类的 私有 名称
 这种 名称 在类 定义 中使用时 会以 一种混合 形式 重写以 避 免在基类 及派 生类的 私有属性 之间出 现 名 称 冲突
 参 见标识符 名称
 字面 值
字 面值 用于 表 示一 些内 置 类型 的常量
字符 串 和 字 节串 字 面 值
字 符串 字 面值 拼接
多 个相 邻的 字 符串 或字 节串 字面 值 以空白 符分 隔所 用 的引号 可 以彼 此 不 同其 含义 等同 于全 部 拼 接 为 一体
因此 hello  world  等 同于 helloworld
 此 特性 可以 减少 反斜 杠的使 用 以 方便地将 很 长的 字 符串 分成 多个 物理行甚 至 每部 分字 符串 还 可分别加 注 释例 如 re
compileazaz  letter  or  underscore  azaz 09 letter  digit  or  underscore 注意 此 特性 是 在句 法层面 定义 的 但 是在 编译 时实 现
在 运 行 时 拼接 字符 串表 达式 必 须使 用运算 符
还 要 注意字 面值 拼接时 每个部分 可 以使 用不 同的引 号风 格甚 至混 合使 用原 始 字符串 和三 引号 字符 串 格式化字 符 串字面 值 也可与 普通 字符 串字 面 值拼接
格 式化字符 串字面值
 数字字面 值
数 字 字 面值 有 三种 类 型整型数、 浮 点 数 和 虚数
 没有 专门 的复 数字面值 复数 可 由一个 实数 加一 个 虚 数合 成
注 意数 字字 面值 并 不包 含 正负号1 这 样的负数 实 际上 是由 单目 运算 符和 字面值1 合成 的
 整 型数字 面 值
整 型数 字面 值由 以下 词 法 定义 进行 描述 integer  decinteger  bininteger  octinteger  hexinteger  decinteger  nonzerodigit  digit 00 bininteger 0 b  b  bindigit  octinteger 0 o  o  octdigit  hexinteger 0 x  x  hexdigit  nonzerodigit 1
f  整型数 字面 值的 长度 没有限制 能 一 直大 到 占 满可 用内 存
在 确定 数字 大小时字 面 值 中的 下 划线 会 被 忽略
 它 们可 用来 将 数 码分 组以 提高 可读 性
一 个下划 线 可放 在 数 码之 间 也可放 在基数 说明 符例如0 x  之后
注意 非 零的 十进 制数 开头不 允 许 有 额 外的 零
 这是 为了 避免与 python  在版本3
0 之前所使 用的 c  风格 八进 制字面 值相 混淆
 一些 整型 数 字面值 的 示例 如下721474836470 o 1770 b 1001101113792281625142643375935439503360 o 3770 xdeadbeef 1000000000000 b 11100101 在3
6版 更 改允 许在 字面 值 中使 用 下划 线 进行 分 组
 浮点 数字 面值
 浮点 数 字 面 值 由 以 下词 法定义 进 行 描述 floatnumber  pointfloat  exponentfloat  pointfloat  digitpart  fraction  digitpart 
 digitpart  exponent  e  e  digitpart  注 意整 型 数部 分和 指数部 分 在解 析时 总是 以10为基数
 例如077 e 010是 合 法 的 且表 示的数 值与77 e 10相 同
 浮点 数 字 面值允 许 的范围依 赖 于 具 体 实现
 对于 整型数 字面值支 持以 下划 线 进 行 分组
 一些 浮点 数 字 面 值 的示例 如下3
141593 在3
6 版更 改允 许在 字面值中 使 用 下划 线 进行 分 组
 虚数字 面 值
 运算 符
以下 形符 属 于运算 符
分 隔符
以下 形符 在 语法 中 归 类为 分隔符
 句点 也 可出 现于 浮点数 和虚 数字 面值中
连续 三个 句点有 表示 一个 省 略符 的特殊 含义
 以 上列 表 的后 半部分 为增 强 赋值操 作 符在词 法 中 作为 分隔 符但 也 起到 运算 作用
 以下可 打印 ascii  字符 作 为其 他形 符 的组成 部分时 具 有特 殊含义 或 是对 词法 分 析 器有 重 要意 义以下 可 打 印 ascii  字 符 不 在 python  词法 中使 用
如 果出现 于 字 符串字 面 值和 注释 之 外将 无条件 地引 发错 误 脚注1 httpswww
 简 单语句
 简单语 句由 一个 单独 的逻辑 行构 成
多 条简单 语 句 可 以存 在于 同一 行内 并以 分号分 隔
简 单 语句 的句 法 为 simplestmt  expressionstmt  assertstmt  assignmentstmt  augmentedassignmentstmt  annotatedassignmentstmt  passstmt  delstmt  returnstmt  yieldstmt  raisestmt  breakstmt  continuestmt  importstmt  futurestmt  globalstmt  nonlocalstmt
表 达式 语句
表达 式语句用 于计算 和写 入值 大多是在交 互模 式下 或 者 通常 情 况调 用一 个 过 程 过 程就是不返 回 有 意义 结果 的函 数 在 python  中 过程 的 返回 值 为 none
表 达 式语句的其他使 用 方 式也 是允 许 且有 特定 用处的
 表 达 式语句的 句法 为 expressionstmt  starredexpression  表 达式 语句会对 指定 的 表达式列 表也 可能 为单 一表 达式进行 求值
在 交互 模式 下如果 结果 值不为 none  它 会通过 内置 的 repr  函 数转 换为 一个 字符 串 该结 果 字符串 将以 单独 一行 的 形式 写 入 标准 输出 例 外情 况 是 如果 结果 为 none  则 该过程 调用 不产 生任 何输出

 赋 值 语 句
赋 值语 句 用 于 将 名称 重绑 定 到 特 定值 以及修 改属性 或可变对 象的 成 员 项 assignmentstmt  targetlist  starredexpression  yieldexpression  targetlist  target  target  target  identifier  targetlist  targetlist  attributeref  subscription  slicing  target  请参 阅 原型 一节了解 属 性引用 抽取 和 切片 的 句法 定 义
 赋值 语句 会 对 指定的 表 达 式列 表 进 行求 值 注意 这 可能 为单 一表达式 或 是由逗号 分隔 的 列 表 后 者将 产生 一个 元组 并将 单一结 果对象从 左 至 右逐 个赋 值 给 目标 列表
 赋 值是 根 据目 标列 表 的 格式 递 归地 定 义的
 当目标 为 一 个可 变对 象 属 性引 用、抽 取或 切 片的 组成部分 时该 可 变 对象 必须 最 终 执行 赋值 并决 定其有 效性 如果 赋值 操作 不可接 受也 可能引 发异 常
 各种 类 型可用 的规则和 引 发 的异 常 通 过对 象类 型 的定 义 给出参 见 标 准 类 型 层级 结构一 节
 对 象 赋值 的目标对象 可 以包 含于 圆括 号或 方括 号内 具 体操 作 按 以 下 方 式递 归地 定 义
 如果目 标 列表 为 后 面不 带逗 号、可 以包 含 于 圆括 号内的 单一 目标则 将对 象赋 值给该 目标
 否 则该 对 象 必 须为具有 与目 标 列 表相 同项 数的可 迭 代对象 这些 项将 按从 左 至右 的顺序被 赋值 给对 应的目 标
 如果 目标 列表 包 含一 个带 有星 号前缀 的目 标 这 称为 加星 目标则该对 象 至 少必 须为 与目 标列表 项数 减一相 同项 数的 可 迭代对象
 该可 迭 代 对象前 面 的项 将按 从 左至 右 的顺 序 被赋 值给 加星 目 标 之 前的 目标
 该可 迭代 对象末 尾的 项将 被赋 值 给 加星目 标之 后 的目标
 然后 该可 迭 代对象中 剩 余项 的列 表将 被 赋 值给 加 星 目标 该 列表 可 以 为 空
否 则 该对象 必 须 为 具有 与目 标 列 表相 同 项数 的可 迭代对 象这些 项将 按从 左 至右 的顺 序被 赋值给对 应的目 标
对 象赋 值给单 个目标 的 操作 按以下方 式递归 地定 义
如 果目 标为标识 符名 称 如果 该名 称未 出现 于当前 代码 块的 global  或 nonlocal 语 句 中该 名称 将 被绑 定 到 当前 局 部命 名空间 的对 象
否 则该 名称 将被分 别绑 定到 全局 命名空 间 或由 nonlocal  所确定 的 外 层命 名 空 间的 对象
 如果 该名 称已 经被 绑定 则将被重新绑定
 这可能 导致之 前 被 绑定 到该 名称的对象 的引用 计数变为 零造成该 对象 进入 释放 过程 并调用其 析构器如果存 在
如 果 该对 象 为属 性引 用引 用中的原 型表 达式 会被 求值
 它 应该产 生一 个具 有可 赋值 属性 的 对 象 否则将引 发 typeerror
该 对象 会 被要 求 将可 赋 值 对 象赋 值给指 定的 属性 如 果它 无法 执行赋 值则 会引 发 异 常通 常 应 为 attributeerror  但 并 不强 制要求
 注 意 如果 该 对象为 类实 例 并且 属 性引 用 在赋值 运 算符 的两 侧 都 出现 则右 侧 表 达式 a
x  可以 访 问 实例 属 性或如果 实例属 性不 存 在类 属 性
 左侧 目 标 a
x 将 总 是设 定 为实 例属 性 并 在必 要 时创 建该实例 属 性
因 此 a
x  的 两次出现 不一定指向 相 同 的 属性 如 果右 侧表达 式指向 一个 类属 性 则左 侧 会创 建一 个新 的实 例 属性 作 为 赋值的 目 标 class  cls  x 3 class  variable  inst  cls  inst
x  as 3 此描 述不 一 定 作 用 于 描述 器属 性例如 通 过 property  创建 的特征 属 性
 如 果 目 标为一 个 抽取 项 引 用 中 的原 型表达式 会被 求值
它 应当 产 生 一个 可变 序 列 对象例 如 列表 或一 个映 射 对象 例如 字 典
 接 下来 该 抽取表达 式 会被 求 值
如 果原型 为 一 个 可 变 序列对 象 例 如列 表抽 取 应 产 生 一个 整 数
 如 其为 负 值 则 再加上序 列 长 度
 结 果值 必 须为一 个小 于 序 列 长 度 的非负 整 数 序 列 将把 被赋 值 对象赋 值给 该整 数 指 定 索引 号 的 项
 如 果索引 超 出 范 围 将 会 引发 indexerror  给 被抽 取 序列 赋 值不 能 向列 表 添 加 新 项
如 果原型 为一个 映 射 对象例如 字典抽取 必须具有与 该映 射的键类 型 相兼 容的 类 型然 后映 射中会创 建一个将 抽 取映 射 到 被 赋值 对 象 的 键值对
 这可 以 是 替换 一 个 现 有 键 值对 并 保 持 相同键 值也 可以 是插 入 一个 新 键值对如 果具 有 相 同值的 键不 存在
 对于用 户 定 义 对象 会 调用 setitem 方 法并附 带适 当 的参数
 如果 目 标为 一 个切片 引用中 的原 型表 达式会被 求 值
 它应当 产生 一 个 可变 序列 对象 例 如列 表
被 赋值 对 象应 当是 一个相同 类 型 的 序列 对象
接下 来 下界与 上 界 表达式 如 果存 在的 话将 被求 值 默 认 值 分别 为 零和序 列长 度
 上下边界 值应 当 为整数
如 果某 一边 界为 负值 则会 加上 序列 长 度
求 出的 边 界会被 裁剪 至 介于 零 和序 列 长 度的 开区 间中
 最后将 要求 序 列对 象 以被 赋值 序列的 项替 换 该切片
 切 片 的 长度 可 能 与被赋 值 序 列的 长度不 同 这 会 在目标 序列允 许 的情 况下 改 变 目标序 列的 长 度
cpython  implementation  detail 在当 前 实 现 中目 标的 句法 被当作 与 表达 式的 句法 相同 无效的 句 法会 在代 码生 成阶段 被 拒 绝 导 致 不太 详细 的错 误信 息
虽 然 赋值的 定义 意味着 左手 边与 右手 边的 重叠 是 同时 进行 的例 如 a  b  b  a  会 交 换 两个 变 量的 值但在赋值 给变量的多 项 集 之内 的 重叠 是 从 左至 右进 行的这 有时会 令人 混淆
 例 如以 下 程 序将会打印 出02 x 01 i 0 i  xi 12 i  is  updated  then  xi  is  updated  printx  参 见 pep 3132扩 展的可迭 代对象拆包 对 target 特 性 的规范 说明
 增强赋值 语 句
增 强 赋值 语句 就 是在 单个 语句中将 二 元 运算 和 赋值 语句合 为一体 augmentedassignmentstmt  augtarget  augop  expressionlist  yieldexpression  augtarget  identifier  attributeref  subscription  slicing  augop  请参 阅原型 一节 了解 最后 三 种 符号的 句法 定义
增 强赋 值 语 句 将对 目标 和 表 达式 列表求 值与 普通 赋值语 句不 同 的是前 者不 能 为可 迭 代对象 拆包 对两 个操 作 数相应 类 型的 赋值 执 行指 定 的二 元运 算 并 将结果 赋值 给原 始 目标
 目 标 仅会 被 求 值 一 次
增 强 赋值 语句 例如 x 1 可 以 改 写 为 x  x 1 获 得类 似 但并 非完 全等 价 的 效果
 在增强赋 值的 版本 中 x 仅会被 求值 一次
 而且 在可 能的情 况下 实际 的运 算是 原地 执行 的也 就是说 并不 是创建一个 新 对象并 将其赋 值给 目标 而 是直 接修改原 对象
不 同于 普通 赋值 增 强赋 值 会在对 右手边 求值 之前 对 左手 边求值
 例如 ai  fx 首 先 查找 ai  然 后 对 fx  求 值 并 执 行 加法 操作 最 后 将 结 果 写回 到 ai
除了 在单 个语 句 中赋 值给 元组 和多 个目标 的 例外 情况 增强 赋 值语 句的 赋值 操作 处理方 式 与 普 通赋值 相同
 类似 地除 了可 能 存 在 原 地 操作 行为 的例 外 情 况增 强 赋 值语 句执行的 二元运 算 也与 普通 二元 运 算 相同
 对 于属性 引用 类目 标针对常规 赋 值的 关于类 和 实例属 性的 警 告 也 同 样适 用
带标 注的 赋 值语句
标注 赋值 就是在 单个 语句 中 将 变 量或 属 性 标注 和可 选的赋 值语 句合 为一 体 annotatedassignmentstmt  augtarget  expression  starredexpression  yieldexpression  与普 通赋 值 语句 的差 别在于仅 允 许 单个 目 标
对 于 将简单 名 称作 为赋值目标 的情况 如 果是 在 类 或模 块 作 用域中标 注会 被求值 并 存 入 一个 特殊的 类 或 模块属 性 annotations  中 这 是一 个 将 变量名 称如 为私有 会 被 移除映 射 到 被求 值 标注 的字 典
 此属性 为可 写并 且在类 或模 块体 开 始 执 行 时如果 静态 地 发现标注就会自 动 创 建
 对 于将 表达 式 作为 赋 值目标 的情况 如果 是 在类或 模 块作 用域 中标 注会被 求值 但不 会保 存
如果一 个 名 称在 函数 作用域 内被 标 注则 该 名称 为该 作用域 的局 部变 量
 标注绝不 会在 函 数 作 用域内 被 求值 和保存
如果 存在右 手 边带 标 注 的 赋值 会在 对 标注 求 值之 前 如果适 用执 行实 际的 赋 值
如果 用作 表达 式 目标 的 右手 边不 存在则 解释 器 会对 目标求值 但最后 的 setitem 或 setattr  调用 除 外
参 见 pep 526变 量标 注的 语法 该提 议增 加了 标 注 变量 也 包 括类 变 量和 实例 变 量类 型 的语法 而 不 再是 通过 注 释 来 进 行 表达
 pep 484 类 型 提 示该 提 议 增加 了 typing 模 块以 便为 类型 标注提 供标 准 句法 可 被 静 态 分 析工 具 和 ide  所 使 用
 在3
8 版 更 改现在 带 有标 注的赋 值 允许 在右 边以 同样 的表 达 式 作为 常规 赋 值
之 前 某 些 表达 式例 如未 加 圆 括号 的 元 组 表 达 式 会导致 语 法 错误
assert  语 句
assert  语 句 是 在 程 序 中 插 入 调试性 断 言 的简 便方 式 assertstmt  assert  expression  expression 简 单形 式 assert  expression 等 价于 if  debug  if  not  expression  raise  assertionerror  扩展形 式 assert  expression 1 expression 2 等 价 于 if  debug  if  not  expression 1 raise  assertionerrorexpression 2 以上 等价 形式 假定 debug  和 assertionerror 指 向 具 有指定 名称的 内置 变量
在 当前实 现 中 内 置 变量 debug  在 正常 情况 下为 true  在请求 优化 时为 false  对 应命 令 行 选项 为 o
如 果在编 译时请 求优 化 当前 代码 生成 器 不 会 为 assert  语 句 发 出任 何代 码
请 注 意不 必在 错误 信息 中包 含 失 败 表达式 的源 代码 它 会 被 作 为 栈 追 踪的 一部 分被 显 示
赋 值 给 debug 是 非法 的
 该 内 置变 量 的 值会在 解释 器启 动时 确定
pass  语句
passstmt  passpass  是一 个 空 操作 当它 被 执 行时什 么都 不 发 生
它 适合当 语法 上需 要一 条语 句但 并不 需 要执 行任何代 码时 用来临 时占 位 例如 def  farg  pass  a  function  that  does  nothing  yet  class  c  pass  a  class  with  no  methods  yet
del  语句
delstmt  del  targetlist  删除 是 递 归 定义 的与赋 值的定 义方式非 常类 似
 此 处不再 详 细 说 明只 给出 一些提 示
目 标列 表 的删 除将 从左 至 右递归 地删 除每 一 个 目标
 名称 的删 除将从局 部 或 全 局命名 空 间 中移 除 该 名 称 的绑 定具 体作用域 的确定 是 看该 名称 是 否 有在 同一 代码 块 的 global 语 句中 出现
 如果 该名称 未 被绑 定将会 引发 nameerror
 属 性 引用、 抽 取和切 片的删 除 会 被传 递给 相 应的 原型对 象删除 一 个 切 片 基本 等价于 赋值 为一 个右侧类 型 的空 切片 但即 便 这一 点也是 由切 片对象 决定 的
在3
2 版 更改 在之 前版 本 中 如果一 个名 称 作为 被嵌套 代码块中的 自由 变量 出 现则 将 其 从局 部 命 名空 间中删 除 是非法 的
return  语 句
returnstmt  return  expressionlistreturn 在 语法 上 只会出 现于 函数 定义 所 嵌 套的 代 码不 会 出现 于类 定义所 嵌 套的代 码
如果提 供 了表 达 式 列表 它 将被求 值否则 以 none  替 代
return  会离开 当 前函 数 调用并 以表 达式列 表或 none  作 为 返回 值
当 return  将控 制流传 出一个 带有 finally 子句的 try  语 句时 该 finally 子 句会 先 被执 行然 后再真 正离开该函 数
在一 个生成器 函 数中 return 语 句 表 示生 成器 已完 成并 将导 致 stopiteration  被引 发
返 回 值 如果 有的 话 会被 当作 一个 参数用 来构 建 stopiteration 并成 为 stopiteration
value 属 性
 在 一 个异步 生成器 函 数中 一个 空的 return  语句 表示 异 步 生 成 器 已完 成 并将导 致 stopasynciteration  被 引发
 一个 非 空 的 return  语 句在异 步生 成 器函数 中会导 致语法 错误
yield  语句
yieldstmt  yieldexpressionyield  语 句在 语 义上 等同 于 yield  表 达 式
 yield  语 句 可 用来 省 略 在使 用等 效 的 yield  表达 式 语句时所 必 须的 圆 括号
 例 如以 下 yield  语句 yield  expr  yield  from  expr  等 同 于以 下 yield  表达式语 句 yield  expr  yield  from  expryield 表达 式和语句 仅在 定 义 generator 函 数时 使 用并 且仅 被 用 于生 成 器 函数 的函 数体 内部
在函 数 定义 中 使 用 yield 就足以 使得 该定义创 建的 是 生成 器函 数而非普 通 函 数
 有 关 yield 语 义的 完整 细 节请参 看 yield 表达式 一节
raise  语 句
raisestmt  raise  expression  from  expression  如果 不带 表达式 raise  会重 新引 发当 前 作用 域内 最后 一个激活 的异 常
如 果当前 作 用域 内 没有激 活的异 常将 会 引 发 runtimeerror  来 提示错误
 否则的 话 raise 会 将第 一 个 表达 式 求值 为异常 对象
它 必须 为 baseexception 的 子 类 或实例
如 果它 是 一个类 当 需要 时会 通 过 不带 参数地 实例 化该类 来 获 得异常 的实 例
 异 常 的类 型为异常 实例的 类 值为实 例本 身
当 异常 被引发 时通 常会 自 动创 建 一 个回溯 对象 并将 其关 联 到可 写 的 traceback 属 性
 你可 以创 建一个 异常 并 同 时 使 用 withtraceback 异常方 法该 方法 将 返回同 一 异常 实 例并 将回 溯对象设 为其 参数设 置自 己的 回溯就 像 这 样 raise  exceptionfoo  occurred
withtracebacktracebackobjfrom 子句 用于 异常串 连如 果有 该子句 则第 二个 表达式必 须为另 一个 异常或实 例 它将 作为可 写的 cause  属性 被 关 联 到所 引发 的异 常
如 果 引 发 的异常 未被 处理 两个 异常 都 将被打 印 出 来 try 
 traceback  most  recent  call  last  file  stdin  line 2 in  module  zerodivisionerror  division  by  zero  the  above  exception  was  the  direct  cause  of  the  following  exception  traceback  most  recent  call  last  file  stdin  line 4 in  module  runtimeerror  something  bad  happened  如果 一个异 常 在 异 常处 理器 或 finally  clause  中被 引 发类 似 的机制会 隐式地 发 挥 作用 之前的异 常将 被关 联到新 异 常的 context  属性 try 
 traceback  most  recent  call  last  file  stdin  line 2 in  module  zerodivisionerror  division  by  zero  during  handling  of  the  above  exception  another  exception  occurred  traceback  most  recent  call  last  file  stdin  line 4 in  module  runtimeerror  something  bad  happened  异 常 串连可通 过 在 from 子 句中 指定 none  来显 式 地加 以抑制 try 
 traceback  most  recent  call  last  file  stdin  line 4 in  module  runtimeerror  something  bad  happened 有 关异常的 更 多信息可 在异常 一节 查看有 关处理异常 的 信息 可在 try  语句 一节 查看
在3
3版 更改 none 现 在 允 许 被用作 raise  x  from  y  中 的 y
3
3新 版 功能 使 用 suppresscontext  属 性 来 抑制 异常上 下文 的 自 动显示
break  语 句
breakstmt  breakbreak 在语 法 上 只会 出现 于 for 或 while 循 环所嵌套 的代码 但 不会 出现 于该 循环 内部 的函数 或 类定 义所 嵌套 的代 码
它 会终 结 最 近 的 外 层 循环 如果 循环 有可选 的 else  子句 也会跳 过该 子句
 如 果 一 个 for  循 环 被 break 所 终 结 该 循 环 的 控制 目标 会 保 持 其 当前 值
当 break  将 控 制 流传 出 一 个 带 有 finally  子 句 的 try 语句 时该 finally 子 句 会 先 被 执 行 然后 再真 正离 开该 循环
continue  语句
continuestmt  continuecontinue  在 语法 上只 会 出 现 于 for 或 while  循 环 所 嵌 套 的 代码 中但 不会 出 现于 该 循 环 内 部的 函数或 类 定 义 中
它 会 继 续 执行最 近的外层 循环 的 下一 个轮 次
当 continue  将 控制 流 传出 一个 带有 finally  子 句的 try  语句 时该 finally  子句会 先被执 行 然后 再真 正 开 始循 环的下 一 个轮 次
import 语 句
future 语 句
future  语 句 是 一种 针对 编 译 器的 指 令 指 明某 个 特定 模 块 应 当使 用 在 特定的 未来某个 python 发行 版中 成为标 准特性 的语 法或 语 义
future 语 句的目 的是 使 得 向在 语言中引 入 了不 兼容 改 变的 python 未来 版本 的迁移 更 为容 易
它 允许 基 于每 个 模块 在某种 新特 性成 为 标准 之 前 的发行 版中 使用 该特 性
 futurestmt  from  future  import  feature  as  identifier  feature  as  identifier  from  future  import  feature  as  identifier  feature  as  identifier  feature  identifierfuture  语 句 必 须在 靠近模 块开 头 的 位 置出现
 可以 出 现在 future 语 句 之 前 行只 有 模 块的文 档字符 串 如 果 存在 注释空行 以及 其他 future 语 句
唯 一 需要 使用 future 语 句 的 特 性 是 标 注 参 见 pep 563
future  语 句 所启 用的所 有历 史特 性仍 然为 python 3 所 认可
其 中包括 absoluteimport  division  generators  generatorstopunicodeliterals  printfunction  nestedscopes  和 withstatement
它们 都 已成 为 冗余 项因 为它们总 是 为已 启用 状 态 保 留 它 们 只 是 为 了 向后兼 容
future 语句 在 编 译时 会被识别 并 做特殊对 待 对核 心构 造语 义的改 变常 常 是 通过 生成 不同的 代 码 来 实 现
新 的 特 性 甚 至可 能会 引 入新的不 兼容语法例 如 新 的 保留 字 在 这种 情况下编译器 可能需 要以 不 同 的方式 来解 析 模块
 这 样 的决 定 不能 推迟到 运行 时 方 才作出
对 于任何给定的 发布 版本 编译 器 要知道哪些 特性名 称已 被定义 如 果 某个 future  语句包 含未知 的 特性 则会引发编 译时 错 误
 直 接 运行 时的 语义 与任 何 import 语句 相 同存 在一个后文 将详 细说 明的 标 准模 块 future 它 会 在执 行 future 语 句 时以 通 常 的 方 式 被导 入
 相应的运 行时 语 义 取决 于 future  语句 所启 用 的 指 定特性
请 注意以下 语 句 没 有任 何 特 别之处 import  future  as  name  这并 非 future 语 句 它 只 是 一 条没有 特殊语 义或 语 法限制 的 普 通 import  语 句
在 默认 情况 下通过 对 code  compiled  by  calls  to  the 内 置函 数 exec  和 compile  的 调用所 编译的 代码如果 出 现 于一 个包 含有 future  语句 的 模 块 m 之 中就会 使用 future  语 句所关 联的 语 法 和 语 义
此 行为 可 以 通过 compile 的 可选 参数加 以控 制 请 参阅 该 函 数的文 档以了 解 详情
 在 交 互 式 解 释器提示 符中 键入 的 future 语 句 将在 解释器 会话此后的 交互 中有 效
 如 果 一个解释 器的启 动使用 了 i 选 项 启 动 并传 入了 一个 脚 本名 称来 执行 且 该 脚本 包含 future  语句它将 在 交互 式会 话开 始 执 行脚 本之 后 保 持 有 效
 参 见 pep 236 回到 future  有关 future  机制 的最 初 提议
global 语 句
globalstmt  global  identifier  identifierglobal 语 句 是作用 于整 个当前 代码块 的 声明
它 意味 着 所列出 的 标识符 将被 解读 为全局 变量
 要 给 全局 变量 赋 值不可 能不 用 到 global 关 键字 不 过 自 由 变量也可 以指 向 全局 变 量而不必 声明为 全局 变 量
 在 global  语句 中 列 出的名 称 不 得在 同一代 码 块 内该 global  语句 之前 的位 置中 使 用
 在 global 语句 中 列出的名 称 不得 被定义 为正 式形 参不 也得出 现于 for  循环 的 控制 目标、 class 定 义、函 数 定 义、 import 语句 或 变量 标注之中
cpython  implementation  detail  当前 的 实现 并未 强制 要 求所有的 上 述限制 但程 序 不应当滥 用这 样的 自 由因为未 来的实 现可 能 会改 为强 制 要求并静 默 地 改变 程序 的含 义
 程序 员注 意事 项 global  是对 解 析器的 指 令
它 仅 对与 global  语 句 同 时被解 析的 代码 起作用
 特别 地 包含 在 提供 给内 置 exec 函 数字 符串 或代码对 象 中的 global  语句并 不会 影 响包 含该 函数 调用的代 码 块而 包 含 在这 种 字符 串 中的 代码也 不会 受 到包 含该 函数 调 用 的代 码中 的 global 语 句影 响
 这同 样 适 用于 eval  和 compile  函数
nonlocal  语 句
nonlocalstmt  nonlocal  identifier  identifiernonlocal 语 句 会使 得 所列 出的名称指 向之 前在最近 的包 含作 用域 中绑 定 的除 全局 变 量以外的变 量
这 种功 能很 重 要 因为 绑定 的默认 行为 是 先搜 索 局部命名 空 间
这个 语 句允 许被封 装的代码 重新 绑 定局 部 作用 域以 外且 非全局 模块 作 用 域 当中 的变 量
 与 global 语 句中 列 出的名称 不 同 nonlocal  语句 中 列出 的名称 必 须 指向之前存 在于包 含作 用域之中的 绑 定 在 这个 应当 用来 创 建新 绑 定的 作用 域 不能 被无 歧义 地 确 定
nonlocal 语句 中列 出的名称 不得 与 之前存 在于 局部 作用 域中 的 绑定 相冲 突
 参见 pep 3104 访 问外 层作用 域中 的名称 有关 nonlocal  语句 的 规范 说 明
 最高 层级 组件
python 解 释 器可 以从 多种 源获得输 入作 为标 准 输 入或 程序参 数 传入 的 脚本以 交互方式 键入 的语 句 导 入 的模 块源 文件 等 等
 这一 章 将 给出 在这 些 情 况下所 用的语 法
完 整的 python  程序
虽 然语言规 范 描述 不必 规定 如 何发起 调 用语 言 解释 器 但 对完 整的 python  程 序 加 以说 明 还是很有 用的
 一 个完整 的 python 程 序会在最小 初 始化环 境 中被 执行 所有 内 置和标 准 模块均 为 可用但 均处 于未 初始 化 状 态只 有 sys  各种系统 服务 builtins  内置 函 数、 异常 以及 none  和 main  除 外
最 后一个 模 块 用 于为 完整程 序的 执 行提供 局部和 全 局命 名空 间
适 用于一 个 完整 python 程 序的 语 法即 下节所描 述的 文件 输 入
解 释 器也 可以 通 过交互 模式被 发 起调 用在 此情况 下它 并不读 取和 执行 一个 完整程 序而 是 每次 读取和 执行 一条 语 句 可能 为复合 语句
此时 的 初始 环境与一 个完 整 程序 的相 同每 条 语 句 会在 main  的命 名 空间中 被执 行
 一个 完整 程 序可 通过 三种 形式 被 传 递给解释 器 使 用 c 字 符串 命 令 行 选 项使用 一个文 件作 为第 一个 命 令行参数或 者使 用标 准 输入
如 果文 件或 标准 输入是一 个 tty 设置解 释 器会进入交 互模 式 否则的 话它会将 文件 当作 一 个 完整 程序 来执 行
 文件 输入
所 有 从非 交互 式文件读取 的输入都 具有 相同的 形式 fileinput  newline  statement  此 语法用 于 下 列几 种 情 况解 析一 个完 整 python 程序 时 从文件或 字 符串 解析 一个 模块 时 解析 一个 传递 给 exec 函 数 的字符 串时
 交 互式 输入
 交 互模 式 下 的输 入 使 用以 下语法 进 行 解析 interactiveinput  stmtlist  newline  compoundstmt  newline  请 注 意在 交互模 式下一 条最 高 层级 复合语 句必须 带 有 一 个空 行这 对 于帮助解 析 器确 定 输入 的结 束 是 必须 的
 表达 式 输入
eval  被用 于 表达 式 输入
 它会 忽 略开 头的空 白
传 递给 eval  的 字符 串 参 数 必须 具有以 下 形式 evalinput  expressionlist  newline
 附 录
 交 互 模 式
错 误 处理
 当 发 生 错误 时解 释器 会打印 错 误信 息和错 误 堆 栈
 在交互 模式 下将 返回 到 主命令 提 示符 如果 输 入 内 容 来自 文件 在打印 错误 堆栈 之 后程序 会 以 非 零 状态退 出
这 里所 说的 错误 不包括 try  语 句 中由 except  所 捕获的 异常
 有 些 错误 是无 条件致 命 的 会 导致 程 序以非零状态退 出 比如 内部 逻辑矛盾 或内 存耗尽
所 有 错误信 息都 会被 写入标 准错 误 流而 命令的 正常 输出则被 写入 标准输 出流
 将 中断字 符 通常 为 controlc 或 delete  键入 主 要 或辅 助提 示 会取 消 输入 并返 回主 提 示 符
1 在 执行 命令 时键入 中断引 发 的 keyboardinterrupt  异 常可 以由 try  语 句 处理
 可执 行的 python 脚 本
 在 bsd 等 类 unix 系 统 上 python 脚 本可 以 直接 执 行 就 像 shell 脚 本一样 第 一行添加 usrbinenv  python 3
5 假设 解释 器 位 于 用户 的 path  脚本的 开 头并 将文 件 设置为 可执 行
必 须是文件的 前两个 字符
 在某 些平 台上 第 一行 必须以 unix  样式的行 结尾 n  结 束 而不 是 以 windowsrn 行 结尾
 请注 意 散列或 磅 字 符在 python  中 代表 注释 开 始
可以 使用 chmod  命 令 为 脚 本 提 供 可执 行 模 式或权 限
py  在 windows 系 统 上没 有可 执 行 模式 的概 念
 python 安装 程序 自动 将
py 文 件 与 python
exe 相 关 联这 样双 击 python  文 件就 会 将其 作为 脚本运 行
扩 展 也可 以 是
pyw 在这种 情况 下 会隐 藏 通常 出现的控 制台窗 口
交互 式启 动 文 件
当您以 交互方 式使 用 python 时 每次启 动解 释器 时都 会 执 行一 些标准 命 令这 通 常 很 方便
 您可 以通过 将名 为 pythonstartup 的环境 变量 设置 为包含 启动 命令 的文 件 名来实现
 这类 似 于 unix  shell 的
profile  功 能
此 文件 只会 在交 互式会 话时 读 取而非在 python  从 脚 本读 取 指令 或是 在 给 定 devtty 为 指令 的 明确来 源 时 后者 反 而 表 现得像 是一个 交 互 式 会 话
 该文 件执行 时所在的命 名 空 间 与交互 式指 令相同 所以 它定 义或 导 入的 对象 可以 在 交 互 式会 话中直接 使用
 你也 可以 在 该文 件 中更 改提示 符 sys
ps 1 和 sys
ps 2
如 果你想 从当 前 目 录中 读取 一个额 外的 启 动 文件你 可以 使 用 像 ifos
py  execopen
read 这 样 的代码在 全 局 启动 文件中对 它进行编 程
 如 果 要 在 脚本 中使 用 启动 文件 则必 须在脚本 中 显 式 执行此 操作 import  os  filename  os
 定 制模块
python  提供 了两 个钩 子 来让你 自定 义它 sitecustomize  和 usercustomize
要 查 看 其工作 原理 首先需要 找到 用户 sitepackages  目录 的位 置
启 动 python  并 运行 此代码 import  site  site
5 sitepackages  现 在您 可以 在该 目录中 创建 一个 名为 usercustomize
py 的 文件 并 将所 需内 容 放入其 中
它 会影 响 python 的 每次 启动 除非 它以 s  选项 启动 以禁 用 自 动导入
sitecustomize  以 相同的 方 式工作 但通 常由 计 算机管理 员在全 局 sitepackages 目 录中 创 建并在 usercustomize  之前 被导入
 有关详 情请 参 阅 site 模 块的文 档
脚 注1 gnu  readline 包的 问题可能 会 阻止这种 情 况
课 前 甜 点
 如 果你 经 常 在 电 脑上工 作总 会有 些任务 会想 让 它 自 动 化
比 如对一大 堆文 本文 件进 行 查找 替换对很 多照 片文 件 按 照比 较复 杂的 规则 重命 名 并 放入 不同 的文 件夹
 也 可能 你想写 一个小型 的数 据库 应用 一 个特定 的界 面应用 或者 一个 简单 的游戏
 如果 你是 专业 的软 件开 发 人 员你 可能需 要编 写 一 些 ccjava 库但 总觉 得通 常 的 开 发 的 流程 编写、 编译、测 试、 再 次编 译等 太 慢了
可 能给 这样的 库 写 一 组测试 就是 很麻烦 的工 作 了
或 许 你 写 了 个软 件 可 以支持 插 件 扩展 语 言但 你 不想 为了 自 己 这一 个 应用专 门设计 和实 现一 种新 语言 了
那 么 python  正好 能 满 足你 的需 要
对 于这些 任 务你 也可 以写 unix  脚 本 或 者 windows  批处 理完成 但 是 shell 脚 本 最擅 长移动 文件 和替 换文 本并 不 适 合 gui 界 面或 者 游戏 开发
你 可以写一 个 ccjava 程 序但 是 可能 第 一 版本 的草稿 都要 很长 的开发 时间
python  的 使用则 更加 简 单 可 以 在 windowsmac  os  x  以及 unix 操 作系 统上 使用 而且 可以 帮你 更 快 地 完 成工作
python  很容 易使 用 但它是 一种 真正 的编程 语言 提供了很 多 数 据 结构 也支 持大型 程序 远 超 shell  脚 本或 批处 理 文件的 功能
python 还 提 供比 c  语言 更 多的错 误检 查而 且 作为 一种 超高 级 语言它 有 高 级的 内 置数 据类 型比 如灵 活的数组 和字 典
正 因为这 些更 加通用的 数据类型 python  能够 应付更多 的问 题 超过 awk  甚至 perl 而且 很多 东 西 在 python  中 至少 和那 些语言同 样 简 单
python  允许你划 分程 序模块在 其他的 python 程 序中重 用
 它 内 置 了 很多的 标准 模块 你可以在 此基础上 开发 程序—— 也可以 作为 例 子 开 始学习 python  编 程
 例如 文件 输入 输出 系统 调用 套 接字 甚 至图形界 面 接口 工作 包 比如 tk 
python  是一种 解 释 型语 言在程 序 开 发 阶段 可 以 为 你 节省 大 量 时间 因为不需 要编 译和 链接
解 释器 可 以 交 互式使用 这 样就 可以方 便 地尝 试 语 言特 性 写 一些一 次性 的 程序 或者 在自 底向 上的 程序开发 中 测试 功 能
它 也是 一个 顺手的桌 面 计 算 器
python  程 序 的 书 写是紧 凑而 易读 的
python 代码 通常 比 同样 功能 的 ccjava 代 码要短 很 多 原 因列举 如下 高级数 据 类型 允 许 在一 个 表 达式 中 表示 复杂 的操 作 代码块 的 划分 是按 照缩 进而不 是成 对 的花括号 不需要 预先 定义 变量或 参数
python  是 可 扩 展的 如果 你知 道 怎么 写 c 语 言 程 序就能很 容 易地 给 解释 器添 加 新的内 置函 数或模 块 不论 是让 关键 的程 序以最 高 速度运行 还是 把 python  程 序链 接到 只提供预编 译程序 的库 比 如硬件相 关的 图 形 库
一旦你真 正 链 接上了就 能在 python  解释器 中扩展或者 控制 c  语 言 编 写的应用 了
 顺 便 提一 下 这种 语言的 名 字 python  意为 蟒蛇来 自于 bbc  节目 montypython  的飞 行 马 戏团 而 与爬 行 动物 没有关 系
在 文档 中 用 monty  python  来 开玩 笑不只 是 可 以的 还是推 荐的现 在你已 经对 python  跃跃欲 试 了 想要深入 了解 一些 细节 了
 因为 学 习语 言的最佳 方式是 使用 它本 教 程邀 请你 一边 阅 读一边 在 python  解释 器中玩 耍
在 下 一章节 会讲解使 用解 释器的方法
 看 起 来相 当枯燥 但 是对 于尝 试后 续的 例子 来说 是非 常关 键 的
 教程 的其 他 部 分 将 通 过示 例介绍 python 语 言和 系统 中 的 不同功 能 开始是 比较简 单的 表 达式、 语句 和数 据 类型然 后是 函数和 模块最终 接触一 些高 级 概念 比 如异 常、用户 定 义 的 类
类
 名称 和 对象
对 象具有个 性多 个名 称在 多 个作 用域 内 可以 绑定 到 同一 个对 象
 这在 其他 语言 中 称为别 名
乍一 看 python 时 通常 不 会 理 解这 一 点 在处理 不可 变 的 基本 类型 数字字符 串元 组 时可 以 安全 地忽 略它
但 是别 名对 涉 及可变 对 象 如 列 表 字典和 大多 数 其他 类型 的 python 代码 的语 义可 能会产 生惊 人 的影响
通 常这 样 做是为 了使 程序受益 因为别 名 在某 些方 面 表现 得像 指 针
 例如 传递 一 个 对 象的 代价 很小 因 为 实现 只传递 一 个指 针 如 果 函 数 修 改了 作为 参数 传 递 的对 象调 用 者将看 到更改这 就 不 需要 像 pascal 中那 样使 用 两 个 不同的 参 数传 递 机 制
python  作 用 域和 命 名 空间
作 用域 和命 名空 间示 例
 这 个 例子演 示了 如何 引用 不同 作用 域和 名称 空间以 及 global 和 nonlocal 会 如何影 响变 量绑定 def  scopetest  def  dolocal  spam  local  spam  def  dononlocal  nonlocal  spam  spam  nonlocal  spam  def  doglobal  global  spam  spam  global  spam  spam  test  spam  dolocal  printafter  local  assignment  spam  dononlocal  printafter  nonlocal  assignment  spam  doglobal  printafter  global  assignment  spam  scopetest  printin  global  scope  spam  示例 代 码的 输出是 after  local  assignment  test  spam  after  nonlocal  assignment  nonlocal  spam  after  global  assignment  nonlocal  spam  in  global  scope  global  spam  请注 意局 部赋值 这是 默认 状 态 不会 改变 scopetest 对 spam  的绑定
 nonlocal  赋值 会 改 变 scopetest 对 spam  的绑 定而 global  赋值 会改变 模 块层 级的 绑定
 您还 可以在 global  赋 值之 前 看 到 之前没有 spam  的绑 定
 初 探 类
类 引入 了 一 些新 语 法三种新 对 象 类型 和一 些新 语义
 类定义语 法
最 简单 的类定 义看起 来像 这 样 class  classname  statement 1
 statementn 类定 义与函数 定 义 def 语句一 样 必须被 执行 才会 起作 用
你 可以尝 试将 类定义放 在 if 语 句 的 一个 分 支或是函 数的 内部
 在实 践中 类定 义内 的 语 句通 常都 是 函 数定义但也 允 许有 其 他 语 句有时 还 很 有用 我们会 稍 后再 回来 说明这个 问 题
 在类 内部 的函 数定 义 通常 具有 一 种 特 别形式 的参 数列 表这是 方法 调 用的 约定 规 范所指明 的 这个 问题 也将 在稍 后再 说明
 当进入 类 定义 时 将 创 建 一个 新的 命名 空 间并 将 其用作局 部作 用 域 因此 所有 对 局 部变 量的赋 值都 是在这 个新 命名 空 间之 内
 特别 的函数 定义 会 绑 定 到这 里 的 新 函 数 名称
当 从结尾 处 正 常 离开 类 定义 时 将 创 建 一个 类 对象
 这 基 本 上 是 一 个 包围在类 定义所 创建 命名 空 间 内 容 周围 的 包 装 器 我 们将 在 下 一 节 了 解 有 关 类 对象的 更 多信 息
原 始 的 在 进 入 类 定 义之 前起作用 的 局 部 作用 域 将 重新 生效 类 对 象将 在这 里被绑 定到 类定 义头 所给 出 的类 名称 在这 个 示 例 中为 classname
 类 对 象
 类对象 支持 两 种操 作属 性引用 和 实 例 化
属 性引 用使用 python  中 所 有 属 性 引 用 所 使用 的 标准语 法 obj
 有效的 属 性 名称 是类 对象 被 创 建时存 在 于 类 命名 空间 中的所 有 名 称
 因此 如果 类定 义是 这 样 的 class  myclass  a  simple  example  class  i 12345 def  fself  return  hello  world 那么 myclass
i  和 myclass
f  就 是 有效 的属性 引用 将 分 别返 回一个 整 数和 一个 函数 对象
类 属性 也可以 被赋 值 因 此 可 以通 过 赋 值来更 改 myclass
i 的值
 doc  也是 一个 有效 的 属 性将 返回所 属 类 的文 档 字 符串 a  simple  example  class
类的 实 例 化 使用 函 数 表示法
 可以把 类对 象视 为 是 返 回该 类的 一个 新 实例 的 不 带 参数 的 函 数
 举 例 来 说 假设 使用 上 述的 类 x  myclass 创 建 类 的 新 实 例 并 将此 对 象 分 配 给 局部变 量 x
 实 例化 操 作 调 用 类对 象会 创建 一个 空 对 象
 许多 类喜 欢创 建 带有 特定 初始 状态 的自 定 义实 例
为 此类 定义 可能 包含一个 名 为 init 的特 殊方 法 就 像这 样 def  initself  self
data  当一个类 定义 了 init 方 法 时 类的 实 例 化操 作 会 自 动为 新 创 建的 类 实 例发 起调 用 init
因此 在 这 个 示例 中可 以 通 过 以下 语 句 获 得 一 个 经 初始化 的 新 实例 x  myclass 当 然 init  方 法 还 可以 有 额外 参数 以 实 现更高 灵活 性
 在 这 种 情 况 下 提供 给 类实 例 化 运 算符 的 参 数将 被 传 递给 init
 例如 class  complex 
 实 例 对象
 现 在我 们 能用实 例对 象做什么？ 实 例对 象理 解 的 唯 一 操 作是 属 性引用
有 两 种 有效 的 属 性名 称数 据属性 和 方法
 数据 属 性对 应于 smalltalk 中 的实例 变量 以及 c  中的 数据 成 员
 数据属 性不需要 声明 像局 部变 量一样 它们 将在第 一 次 被 赋值 时产 生
 例 如 如 果 x  是 上 面 创 建 的 myclass  的实例则 以 下代码段 将打 印 数值16且不 保 留 任 何 追 踪信 息 x
counter 另 一 类实例 属 性 引 用称 为方法
方 法 是从 属于 对 象 的函 数
在 python  中 方 法 这 个术 语并 不是类 实例 所 特 有 的 其 他 对 象也 可以 有方 法
例 如 列 表对象 具 有 append  insert  remove  sort  等方 法
 然 而 在 以 下 讨 论 中 我 们 使 用方 法一 词 将 专指 类 实例 对象 的方 法 除 非 另外显 式 地 说 明
 实例 对 象的 有效 方 法 名 称 依 赖于 其 所 属 的 类
 根 据 定义 一 个 类中 所有 是 函数 对 象的 属性 都 是 定 义 了 其实 例 的 相应方 法
因 此在 我们的 示 例 中 x
f  是有 效 的 方 法 引用 因 为 myclass
f 是 一 个 函数 而 x
i  不是方 法因 为 myclass
i  不是一 个 函数
 但是 x
f  与 myclass
f  并 不是 一 回事 它是一 个方法对 象 不 是 函数对象
 方法对 象
通 常方 法在 绑 定 后 立即 被 调用 x
f  在 myclass 示 例中 这 将 返 回字符 串 hello  world
但 是 立即调 用一 个方法并不 是必 须的 x
f  是 一个方 法 对 象 它 可以 被保 存 起来 以 后 再调 用
例 如 xf  x
f  while  true  printxf 将继续 打印 hello  world  直到 结束
 当一 个 方法 被调用时 到底 发生了什 么？你可能 已经注 意 到上面 调用 x
f 时 并 没有 带 参数 虽 然 f 的函 数定义 指定 了一个 参数
 这 个参 数 发 生 了什么 事？当 不带参 数 地调 用 一个 需 要参数的 函数时 python  肯定 会 引发 异常 即 使参 数 实 际 未被 使用
 实际 上你可 能已经 猜到了 答案方 法的特 殊 之 处 就在 于实 例 对象 会 作为函 数的 第 一个参 数被传 入
在 我们的 示例中 调用 x
f 其 实 就相 当 于 myclass
总 之调用一 个具有 n  个参数 的方 法 就相 当 于调 用再 多一 个参 数的 对应函 数这 个参 数值 为 方法所 属 实 例对象位 置 在其他 参数 之前
 如 果你 仍然无 法理解 方法 的 运 作 原 理 那么 查看实现 细节 可能会 澄 清问 题
当 一个实例的 非 数 据属 性被 引 用时 将搜索 实例 所属 的 类
如 果被 引 用 的属 性名 称 表示 一 个有 效的类 属性 中 的函 数对 象 会通 过打包 指向 查找 到的 实例 对象 和 函数对 象 到一个 抽象对 象的方式 来 创建 方法 对 象 这 个抽 象 对象 就 是方 法对象
 当 附带 参 数列 表 调 用 方法 对象时 将 基于实 例对 象和参 数 列 表构 建一个 新的 参数 列 表 并 使 用这 个新 参数 列 表 调 用相应 的函 数对 象
 类和实 例 变量
一般 来 说实 例变量 用 于每 个实例的 唯一数 据 而类变量 用 于 类 的 所 有 实例共 享的 属性 和方 法 class  dog  kind  canine  class  variable  shared  by  all  instances  def  initself  name  self
name  unique  to  e  buddy  正如 名 称 和 对象中已 讨 论 过 的共 享 数 据 可能 在 涉 及 mutable  对 象 例 如 列表 和 字典 的 时 候 导致 令人 惊 讶 的 结 果
例 如 以下 代码 中 的 tricks 列 表 不 应 该被用 作类变 量因 为 所有 的 dog 实 例 将 只 共 享一 个 单 独 的列 表 class  dog  tricks  mistaken  use  of  a  class  variable  def  initself  name  self
tricks  unexpectedly  shared  by  all  dogs  roll  over  play  dead  正 确 的 类 设 计 应该使 用 实 例变量 class  dog  def  initself  name  self
补 充说 明
继 承
 当 然如 果不 支持继承 语 言特性 就不值得称 为类
派 生类 定 义 的语 法如 下 所示 class  derivedclassnamebaseclassname  statement 1
 statementn  名称 baseclassname  必须 定义于 包含 派 生类定 义的 作用域 中
也 允 许 用其他 任意 表 达 式 代替 基 类 名 称 所 在的 位置
 这 有 时也可 能会 用得 上 例如 当 基类定 义在另 一个 模块中的 时 候 class  derivedclassnamemodname
baseclassname  派生 类 定义 的执行过 程 与基 类 相同
 当构 造 类对 象时 基类会 被记 住
 此 信 息将被 用来 解析 属 性 引用 如果 请求 的属 性在 类中找 不 到 搜索 将转 往 基 类 中 进 行 查 找
如 果 基 类本 身也 派 生自 其 他某个 类 则 此规 则将 被递 归地应 用
派 生类 的 实 例化 没有 任何特殊之 处 derivedclassname  会创 建该 类的 一个新 实 例
 方法 引用 将按 以下 方 式解析搜索相应 的类属 性如 有必要 将按 基类 继 承 链 逐步 向 下 查找 如 果 产生 了一 个函 数对 象则 方 法 引 用就 生效
 派生 类可 能 会重 写 其基 类 的 方法
 因 为方 法 在 调 用 同 一 对 象 的其他 方法 时没 有 特 殊 权 限所 以调用同 一基类 中 定 义 的另 一方法 的 基 类 方 法 最 终 可 能 会 调 用 覆 盖 它 的派生 类的 方法
对 c  程 序 员 的 提示 python 中 所 有 的方 法实 际上 都 是 virtual  方法
 在派生 类 中的 重载 方法 实 际 上可能想 要 扩 展 而 非 简 单 地替 换 同名 的 基 类 方法
 有一 种方式 可以 简 单地 直接 调用 基 类 方法 即 调 用 baseclassname
有 时这对 客户 端来 说 也是 有 用 的
 请 注意 仅当 此基 类可 在全 局作 用域中 以 baseclassname 的 名 称 被访问 时 方 可 使用 此方 式
python 有两 个内 置 函数 可 被 用 于 继 承 机 制 使 用 isinstance  来 检 查 一个实 例 的 类 型 isinstanceobj  int  仅会 在 obj
class  为 int  或 某个 派 生 自 int  的 类 时为 true
 使用 issubclass  来检 查类 的 继 承 关 系 issubclassbool  int  为 true  因 为 bool  是 int 的子 类
 但 是 issubclassfloat  int  为 false 因 为 float  不 是 int  的 子类
 多重继 承
python  也支 持一 种 多 重 继 承
 带 有 多个 基 类 的 类定 义 语 句如 下 所 示 class  derivedclassnamebase 1 base 2 base 3 statement 1
 statementn 对 于 多 数 应 用来 说 在最 简 单 的情 况下 你 可以 认 为 搜 索 从 父 类 所 继承 属性 的操作 是深 度优 先、 从 左至 右的 当 层次结 构 中 存在 重叠 时 不会在 同 一个 类中 搜 索 两次
 因此 如果某 一属 性在 derivedclassname 中 未 找 到则 会到 base 1 中 搜索 它然 后递 归地 到 base 1的 基类 中搜索 如果 在 那 里未找 到再 到 base 2中 搜索 依 此类推
 真 实 情况 比 这个 更 复 杂一 些方法 解 析顺 序会动 态改 变 以 支持 对 super  的协同 调用
 这种方 式在某 些其 他 多 重 继 承 型 语 言中 被 称 为后 续方 法调 用它 比 单 继 承型 语 言 中 的 super 调 用 更 强 大
 动态 改变 顺序是有 必要的 因 为所 有多重 继承 的情况 都 会 显 示 出 一 个 或 更 多的 菱 形关 联即 至 少有 一 个父类可 通 过多 条路 径被 最底层 类所 访 问
 例 如 所有 类 都是 继 承自 object 因 此任 何 多 重 继承的情 况 都 提供了 一条 以上 的路 径 可 以通 向 object
为 了确保 基 类不 会被 访问 一 次以 上动 态 算 法 会用 一 种 特 殊方 式将搜索 顺 序线 性 化 保留 每个 类所 指 定 的 从 左 至右 的顺 序只 调用 每 个父 类一次并 且保 持 单 调即一个 类可以 被子 类化 而 不影 响其父 类 的优 先顺 序
总 而言 之这 些 特 性使得 设计 具 有多重 继 承的 可 靠 且 可 扩展 的类成 为 可能
 要 了解 更 多 细 节 请参 阅 httpswww
私 有变量
 杂 项 说明
有时 会需 要使 用类 似于 pascal  的 record 或 c  的 struct  这 样 的数据 类型将一 些命 名数 据 项捆 绑 在 一起
 这种 情况 适合 定 义一 个空 类 class  employee  pass  john  employee  create  an  empty  employee  record  fill  the  fields  of  the  record  john
salary 1000一 段需 要 特 定 抽 象 数 据类 型的 python 代 码 往往可 以 被 传 入一 个 模 拟 了 该数 据类 型的 方法 的类 作 为替 代
例 如 如 果 你 有一 个基 于文件 对象 来格 式化某 些 数据 的函 数你 可 以定 义 一个带 有 read 和 readline  方 法从 字 符 串 缓存获 取 数据 的 类 并 将 其 作 为参 数 传入
 实 例方 法 对象也具 有 属性 m
self 就是 带有 m  方法 的实 例 对象 而 m
func 则 是该 方 法 所对 应的 函数 对 象
迭 代器
到 目 前 为止 您 可能 已经注意 到大 多数 容 器对 象都 可 以 使 用 for 语 句 for  element  in 123 printelement  for  element  in 123 printelement  for  key  in  one 1 two 2 printkey  for  char  in 123 printchar  for  line  in  openmyfile
txt  printline  end 这 种访 问 风格清 晰、简 洁 又 方 便
 迭代器 的使 用 非常普 遍 并 使得 python  成为 一 个 统 一的 整体
在 幕后 for  语 句 会 在 容器对 象上 调 用 iter
 该函 数返 回 一 个 定义了 next 方 法的 迭代 器对 象此 方 法将 逐一 访问 容器 中的 元素
 当 元素 用 尽时 next  将引 发 stopiteration 异常 来 通知终 止 for  循 环
 你可 以 使 用 next 内置函数 来调 用 next  方 法这 个例 子 显 示 了它 的 运作 方式 s  abc  it  iters  it  iterator  object  at 0 x 00 a 1 db 50 nextit  a  nextit  b  nextit  c  nextit  traceback  most  recent  call  last  file  stdin  line 1 in  module  nextit  stopiteration  看过 迭代器协 议的 幕 后 机 制 给 你的 类 添 加 迭代 器 行 为就 很 容 易 了
定 义一 个 iter  方 法 来 返 回 一 个 带 有 next 方 法的 对象
 如 果类已 定义 了 next  则 iter  可 以 简单 地返 回 self  class  reverse  iterator  for  looping  over  a  sequence  backwards
生成 器
生 成 器是 一个 用于 创 建 迭 代 器 的简 单 而强 大的 工具
它们 的写 法 类似于 标 准 的 函数但 当 它 们 要 返回 数 据时会 使用 yield  语 句
 每 次在 生 成 器 上调 用 next  时它会 从上次 离 开 的 位 置恢 复执 行它 会 记住 上次 执 行语 句时 的所 有 数 据 值
一个 显示如何 非 常 容 易地 创建 生 成 器 的 示 例如 下 def  reversedata  for  index  in  rangelendata 111 yield  dataindex  for  char  in  reversegolf 
 f  l  o  g  可 以用 生 成 器 来完 成的 操作 同 样 可以 用前 一 节所 描 述 的基 于 类 的 迭代 器来 完成
但生 成器的 写法 更为紧 凑因 为它 会自 动 创 建 iter  和 next 方 法
另 一个 关键特 性在 于局 部变 量 和执 行 状态 会在每 次 调 用 之间 自动 保存
 这 使 得该函 数 相 比使用 self
index  和 self
data 这种 实例 变量 的 方 式 更 易 编写 且 更 为 清 晰
 除 了会自 动 创建 方法 和 保存 程 序状 态当生成 器终 结时它 们还 会自动 引发 stopiteration
 这些 特性结 合 在一 起 使 得创 建迭代 器能 与编 写常 规函 数 一 样 容易
 生 成器 表达 式
某 些 简 单的生 成器可以 写成简 洁的 表达 式代 码 所用 语法 类似 列 表 推 导 式但 外 层 为 圆括 号而 非 方括号
 这种表 达 式 被设 计 用于 生成 器将 立即被 外层函 数所 使 用 的 情 况
生 成 器表 达式 相 比 完整 的生成器 更紧 凑但 较 不灵 活相 比 等 效的 列表 推导 式 则更 为节 省 内存
 例如 sumii  for  i  in  range 10 sum  of  squares 285 xvec 102030 yvec 753 sumxy  for  xy  in  zipxvec  yvec  dot  product 260 uniquewords  setword  for  line  in  page  for  word  in  line
name  for  student  in  graduates  data  golf  listdatai  for  i  in  rangelendata 111 f  l  o  g 脚 注1存在 一 个例 外
模块 对象 有一 个秘 密的只 读属 性 dict 它返回用 于实 现 模 块 命 名 空间 的字典 dict  是 属 性但 不是 全局名称
 显然使 用 这 个 将 违 反命名 空间实 现的抽 象 应 当 仅 被 用于事 后调试器 之 类 的 场 合
 其 他流 程 控制 工 具
除了 刚 刚 介 绍 过 的 while  语句 python  中也会 使用 其他语 言中常 见 的 流 程 控制语 句只 是 稍 有变 化
if 语 句
 可能最 为 人 所 熟 知 的 编 程 语 句 就 是 if  语 句 了
 例如 x  intinputplease  enter  an  integer  please  enter  an  integer 42 if  x 0
 more 可 以 有 零 个或 多 个 elif 部分 以及一个 可选 的 else  部分
 关键字 elif  是 else  if  的缩 写 适 合 用于避免 过 多的 缩进
 一个 if 
elif 
 序列 可以看 作是 其他 语 言中 的 switch 或 case  语 句的 替 代
for 语 句
python 中 的 for  语句 与你 在 c  或 pascal  中 所用到 的有 所不 同
 python 中的 for  语句 并不 总 是 对算 术 递增 的数 值进行迭代 如同 pascal  或 是给 予用户 定义 迭 代步 骤 和 暂停条 件的 能力 如同 c  而 是 对 任意 序 列进 行迭代例 如列表或 字符 串条 目的迭代 顺序与 它们 在 序 列 中出 现的 顺序 一 致
例 如 此 处英 文 为 双 关语 measure  some  strings 
 cat 3 window 6 defenestrate 12 在遍 历同 一 个 集合 时修 改 该 集 合 的 代 码可能很 难获 得 正 确的 结果
通 常 更 直 接 的做法 是循环 遍历 该集 合 的 副 本或 创 建 新集 合 strategy  iterate  over  a  copy  for  user  status  in  users
range 函 数
如 果你 确实 需 要 遍历一 个 数 字 序 列 内 置函 数 range 会派 上用场
 它生 成算术级 数 for  i  in  range 5
01234 给定 的终 止 数 值并不在 要 生成 的序 列里 range 10 会 生 成10个 值 并且 是以合法 的索引 生成 一 个 长 度为10 的 序列
range  也可 以以 另一个 数字 开 头或 者以指 定 的幅 度增 加 甚 至 是 负数有 时这 也被 叫做步 进 range 51056789 range 01030369 range 1010030104070 要以 序列的索 引 来 迭代 您可以 将 range  和 len 组 合 如下 a  mary  had  a  little  lamb  for  i  in  rangelena 
0 mary 1 had 2 a 3 little 4 lamb  然 而在 大多 数这 类 情况 下使 用 enumerate 函 数比较方 便 请 参 见循 环的 技 巧
 如果 你 只 打印 range  会 出现 奇 怪的结 果 printrange 10 range 010 range  所返 回 的 对象 在 许多 方面 表现 得 像一 个 列表 但实 际上 却 并不 是
此 对 象会 在你 迭代 它 时 基于 所希望 的序列 返回 连 续的 项但它 没有 真正 生成 列表这 样 就 能节 省 空 间
 我 们称 这 样 对 象为 iterable 也 就是 说 适合作 为这样的 目标对象 函 数和 结构期望从 中获 取连 续的 项直到 所 提供 的 项 全部 耗 尽
 我们已经 看到 for  语 句 就 是这 样 一种 结构而 接受 可 迭 代 对 象 的 函数 的一 个例 子是 sum  sumrange 401236 稍 后我 们 将看到更 多返 回 可迭 代对象 以及 将 可 迭代对象作 为 参数 的函 数
最后也 许你 会 很 好 奇如 何 从一 个指 定 范 围 内 获 取 一个 列表
以 下是 解决 方案 listrange 40123 在数 据 结构 章 节 中 我 们将 讨论 list  的 更 多细 节
break 和 continue 语 句以 及循环 中的 else  子句
break  语 句 和 c  中 的类 似 用 于 跳出最近 的 for  或 while  循环
 循 环 语句 可 能带有 else  子句 它会 在 循 环 耗 尽 了 可迭 代 对 象 使用 for  或循 环条 件变 为 假 值使 用 while 时 被 执 行但 不 会在 循环 被 break 语句 终止 时 被执 行
以 下搜 索 素 数 的 循 环 就是这 样的 一个 例子 for  n  in  range 210
2 is  a  prime  number 3 is  a  prime  number 4 equals 225 is  a  prime  number 6 equals 237 is  a  prime  number 8 equals 249 equals 33 是的 这是 正确 的 代码
 仔细 看 else 子 句 属 于 for 循 环 不属于 if 语 句
当 和循 环一 起使 用时 else  子句 与 try 语 句 中的 else  子句 的共 同点多于 if 语 句中 的同 类 子句 try  语句中的 else  子 句会在 未 发 生 异 常 时 执行 而 循 环 中的 else 子 句则 会 在未 发生 break 时 执行
 有关 try  语 句 和异常 的 更多 信 息 请 参 阅 处 理异 常
continue  语句 也 是借 鉴自 c  语 言 表 示继 续循环 中的 下 一 次 迭代 for  num  in  range 210
pass 语 句
pass 语 句 什么也不 做
 当 语法上需 要 一个 语 句但 程序需要什么 动作 也 不 做 时可 以 使用 它
例 如 while  true 
 这通 常用于 创 建 最 小的 类 class  myemptyclass 
pass  的另 一个 可以使 用的 场合 是 在 你 编写 新 的代 码 时作 为 一 个 函数 或条 件子 句体的 占位 符 允 许 你保 持在 更抽 象的 层 次 上 进 行思考
 pass  会被 静默 地 忽 略 def  initlogargs 
定 义 函 数
 函数 定义 的更 多形式
给 函数 定义 有 可 变 数 目的参 数也 是可行的
 这 里 有三 种 形 式 可 以 组 合 使用
 参数 默认 值
 关 键 字 参 数
 特殊 参 数
 任 意 的 参 数 列 表
 最 后 最 不 常用 的 选 项 是 可以 使用 任意 数量的 参数 调 用函数
 这些 参 数 会 被 包含 在 一个 元 组里 参 见 元组 和 序列
 在可 变 数量 的 参数之 前可 能 会出 现 零个 或 多 个普 通参 数
 def  writemultipleitemsfile  separator  args  file
joinargs 一 般来 说 这些可 变参 数 将在 形 式参 数 列表 的末 尾因 为它 们 收 集传递 给函 数 的 所 有剩余输 入 参 数
 出现 在 args 参 数之后的 任 何 形 式参 数都 是‘ 仅关 键字参数’ 也 就 是 说 它 们 只 能作为 关 键 字 参 数而不 能是 位置 参数
 def  concatargs  sep 
 解包参数 列 表
 当 参数已 经 在 列 表 或元 组中 但要 为需 要单 独位 置 参数 的函 数 调 用 解包 时会发 生相 反的 情况
 例如内 置的 range 函数 需 要单独 的 start 和 stop  参 数
 如果 它 们不能 单独 使用可 以 使用操 作符来编 写函 数调 用以 便 从列 表 或 元组中解 包参 数 listrange 36 normal  call  with  separate  arguments 345 args 36 listrangeargs  call  with  arguments  unpacked  from  a  list 345 同样 的方 式 字 典 可使用 操 作 符 来 提 供关 键字 参 数 def  parrotvoltage  statea  stiff  actionvoom 
lambda 表 达 式
 可 以 用 lambda 关 键字 来创 建 一 个 小 的 匿名 函数
 这个 函 数 返 回两 个参 数的和 lambda  a  b  ab 
lambda  函数 可以在 需 要函数 对 象 的任何 地方 使 用
 它们 在 语法 上限于 单个表 达式
 从语 义 上 来说它们 只是正 常 函 数 定 义 的 语 法 糖
与嵌 套 函 数定 义一 样 lambda 函 数 可 以 引用 所包 含域 的 变 量 def  makeincrementorn 
 f  makeincrementor 42 f 042 f 143 上面 的例 子 使用 一个 lambda  表 达 式 来返 回一 个函数
另一 个用 法是 传递 一个小 函数 作为 参 数 pairs 1 one 2 two 3 three 4 four  pairs
 文 档字 符 串
以 下是有 关 文档 字 符串 的 内 容和 格 式的 一些 约定
 第一行 应该 是 对象目 的的 简要 概 述
为 简洁起 见它 不应显 式 声明 对 象的 名称 或类型 因为 这 些可 通过 其他 方 式 获得 除 非 名称 恰 好 是 描 述 函数操 作的动 词
这 一 行 应 以大写 字 母 开 头以 句 点 结尾
 如果文 档字 符串 中有 更 多 行则第 二 行 应为 空白 从 而在 视觉上将 摘要 与其余 描 述 分开
 后 面 几行 应该 是 一个或 多个 段落 描 述对 象 的调 用约 定它 的副作 用 等
python 解析器 不会从 python  中 删 除 多 行字 符串文 字的 缩进 因 此处理 文档的 工 具必 须 在需 要 时 删除 缩进
 这 是 使用以 下约 定 完成的
文 档 字符 串第一 行之 后 的第 一个 非 空 行 确 定整个 文档 字符 串 的 缩进 量
 我 们不 能使 用第 一行 因为它 通常 与字 符串 的开 头 引 号相邻 因此 它的 缩进 在字 符 串文 字中 不明 显
 然后 从字 符 串的所有 行的 开头剥离 与 该缩进等 效的空格
 缩进 更少 的行不应该 出现 但是如果 它们 出 现 则应 该 剥离它们 的所有前 导空格
应在转 化制表符 为空 格后测试 空格的 等 效性通常 转化 为8 个空格
下 面是 一个 多 行 文 档字 符 串的例子 def  myfunction 
 函数标注
函数 标注 是关 于用 户自 定义 函数 中使 用的 类 型的 完全 可选 元数 据信 息有关 详情 请 参阅 pep 3107 和 pep 484
函数 标 注以 字 典 的形 式 存放 在 函数 的 annotations  属 性中并 且不会影 响函 数 的任何其 他部分
 形参 标注 的 定义 方 式 是 在形 参名 称后 加上 冒号 后 面 跟一 个表达 式该表 达式 会被 求值 为标 注的值
 返回 值标 注的 定 义 方 式 是 加上 一个 组 合符 号 后 面跟 一个 表达 式该标 注位 于形参列 表 和 表示 def  语句 结束的冒 号之 间
 下 面 的示例有 一个位 置参数 一个 关 键字 参 数以 及 返 回 值带 有相 应 标注 def  fham  str  eggs  str  eggs  str 
 小插曲 编码风格
 现在 你将要 写 更长 更 复 杂的 python 代 码 是时 候 讨 论 一 下 代 码 风格了
大 多数语 言 都 能以不 同 的 风 格 被编写 或更 准确地 说被格式 化 有 些 比 其 他的更 具 有 可 读性
 能让其他 人 轻松阅 读你 的代 码 总 是一 个好 主意 采用 一 种好 的编 码风 格对此 有很大 帮助
 对于 pythonpep 8 已经成 为大 多数 项目所遵循 的 风格 指南 它 促 进了 一种非 常 易 读 且令 人赏 心悦 目的 编码 风 格
 每 个 python  开发人 员都 应该在 某个 时候阅 读 它 以下 是 为你提 取的 最 重 要 的几 个 要点使 用4个 空格缩 进不 要使用 制 表 符
4 个 空格 是一 个 在小 缩进 允 许更 大的 嵌 套 深度 和大 缩 进更 容易阅 读的 一 种 很 好的 折中 方案
 制表 符会引 入 混 乱最好 不要 使 用它
 换 行使一 行不超 过79 个 字符
 这 有助 于使 用 小型 显 示器 的 用户 并 且可以 在 较 大 的显 示器上 并排放置 多 个代 码文件
 使用 空行分 隔 函 数和 类以及 函数 内 的较 大的代码 块
 如果 可 能把 注释 放 到单独 的一行
 使用 文档 字 符 串
在 运算符前后 和逗 号后使 用 空 格 但不 能 直接在 括号 内使 用 a  f 12 g 34
 以一 致 的规 则 为你 的 类和 函数命 名按照 惯例 应使 用 uppercamelcase 来命名 类而 以 lowercasewithunderscores 来 命名 函 数和 方法
 始终应 使 用 self 来 命 名第 一个方法 参数 有 关 类和方 法 的更 多信息 请参 阅 初探 类
 如 果 你的代 码 旨 在用 于国际 环境 请不 要使 用花 哨 的编 码
python  默认 的 utf 8或 者纯 ascii  在任 何 情况 下 都 能有最 好的表 现
 同 样 哪 怕只 有很 小的可 能 遇 到 说 不同 语 言的人 阅 读 或维 护 代 码也 不要 在标识 符 中使 用非 ascii  字 符
 脚注1实 际 上 通过 对象 引用调 用会 是 一个 更好 的 表 述 因 为如 果 传递 的是 可 变 对象 则 调用者 将 看 到被 调 用者对 其 做出 的任何 更改插入 到 列 表中 的 元素
 数据 结 构
本章 将 详 细 介 绍一些 您 已经 了解 的内容 并 添加了 一些 新 内 容
 列表 的 更多特 性
列表 数据 类型还 有 很多 的方 法
这 里 是 列表 对象 方法 的 清单 list
appendx  在列 表 的末尾 添 加 一个元 素
 相当 于 alena  x 
extenditerable 使用可 迭 代 对象 中 的所有 元素来扩 展列 表
 相 当 于 alena  iterable 
inserti  x 在 给定的 位置插入 一 个 元素
 第一 个参数 是要 插入 的 元素 的 索 引 所以 a
insert 0 x  插入 列表 头部 a
insertlena  x  等同 于 a
appendx 
removex  移除 列表 中第 一个值 为 x 的元 素
 如 果 没有 这 样的 元素则 抛出 valueerror  异 常
popi  删除列 表 中 给定 位置 的元 素 并 返回 它
如 果没 有给 定位置 a
pop  将 会 删除 并 返回 列表 中 的最 后 一个 元素
方 法 签 名 中 i  两边的 方括 号 表示这 个 参数是可 选的而 不是 要 你输 入 方括 号
 你 会在 python  参考 库 中 经 常 看 到这 种 表 示方法
list
clear  删除 列 表 中所 有 的元素
 相当于 del  a 
indexx  start  end 返 回列 表中 第 一 个值为 x  的元 素 的 从 零 开 始的索引
如 果没 有这 样 的元 素将 会 抛 出 valueerror  异常
 可 选参 数 start 和 end  是切片 符号 用 于将搜 索 限 制 为 列 表的特 定 子 序列
 返 回的 索引 是 相对于 整 个 序 列的 开 始计算 的 而不 是 start 参数
countx  返 回元 素 x 在 列 表 中出 现的次 数
sortkeynone  reversefalse  对列 表 中的 元素进行 排序 参 数可 用于 自定义 排序 解释 请 参见 sorted 
reverse 反 转列 表中 的元 素
copy 返 回列 表的 一个浅拷 贝
相 当于 a 
列 表方 法示 例 fruits  orange  apple  pear  banana  kiwi  apple  banana  fruits
pop  pear  你可 能已经 注意 到 像 insert  remove  或者 sort 方法 只 修改 列表没有打 印出返 回值——它 们返 回 默 认值 none 
1 这是 python 中 所有可 变数 据 结构 的 设计原则
你 可能会注 意到 的另 一 件 事是 并 非 所有数 据或可 以 排 序 或 比 较
 例 如 nonehello 10就 不 可排 序因 为 整 数 不能 与字 符 串比 较 而 none  不 能 与其他类型 比较
 并且 还 存 在 一些 没有定 义顺 序关 系的类型
 例如34 j 57 j  就不是 一个 合法 的比 较
 列 表作为 栈使用
 列 表方法 使 得 列 表作为堆 栈非 常容 易最 后一 个插 入 最先 取 出 后进 先 出
要 添 加 一 个元 素到 堆栈 的顶端 使 用 append 
 要从 堆 栈 顶部取 出一 个 元素 使用 pop  不用指 定索 引
例 如 stack 345 stack
列 表作 为队 列使用
列 表也 可以用 作队列 其 中 先 添 加的 元 素 被 最先取 出 先进 先出 然而 列表 用 作这 个 目的 相当 低效
 因为 在 列 表的 末尾 添 加和 弹出 元素 非常 快 但 是在 列 表 的 开 头插 入或 弹出 元素 却很 慢因 为所 有的 其他 元素 都必 须移 动一 位
若 要 实现 一个队 列 collections
deque 被设 计用于 快速地从 两 端操 作
例 如 from  collections  import  deque  queue  dequeeric  john  michael  queue
 列表 推 导式
 嵌 套的 列表推 导式
列 表推导式 中的 初始表达 式可以是 任何表 达式 包 括 另一个列 表推 导式
 考 虑下 面 这个3 x 4的 矩阵它 由3个长 度为4的 列表组 成 matrix 
下面的列 表推导 式将 交换 其行 和 列 rowi  for  row  in  matrix  for  i  in  range 4159261037114812如上 节所 示嵌 套 的列 表推导式 是基 于跟随其 后的 for  进 行求值的 所以 这 个例子等 价于 transposed  for  i  in  range 4
 transposed 159261037114812 反过 来说也等 价于 transposed  for  i  in  range 4
 transposed 159261037114812 实 际应 用中 你应该 会更 喜 欢 使 用内 置函数 去 组 成复 杂 的流 程 语 句
 zip 函 数将 会很好 地处 理这 种情 况 listzipmatrix 159261037114812关于 本 行中 星 号的 详细 说明参 见解 包参数 列表
del 语句
 有一 种 方式 可以 从 列 表按 照 给定 的 索引 而不 是值 来移除 一个 元素 那就 是 del  语句
 它不 同于会 返回一 个值 的 pop 方 法
 del 语句 也可以 用来 从 列表 中 移除切 片或 者 清空 整个列表 我们之 前用 过的 方式是 将一 个空列 表赋 值 给 指定的 切片
例 如 a 1166
5 del  a  a  del  也可以被 用来删 除 整个 变 量 del  a 此 后再 引用 a  时会 报 错直 到另 一个值 被赋 给它
 我 们 会 在后 面 了解 到 del  的其他 用法
 元组 和序列
集 合
python 也包 含有 集 合类 型
集合 是由 不重 复元 素 组成 的 无 序的集
 它的 基本用 法包括 成员 检测 和消除重 复元 素
 集合 对 象也 支 持像联 合交 集 差集 对 称差分 等数 学 运算
 花括号 或 set 函 数 可以 用来 创 建集 合
注意要创建一 个空 集合 你 只能 用 set  而 不能 用因 为后 者 是 创建一 个空 字典 这 种数 据 结 构我 们会 在下 一节 进行讨论
以 下 是一 些简 单 的示例 basket  apple  orange  apple  pear  orange  banana  printbasket  show  that  duplicates  have  been  removed  orange  banana  pear  apple  orange  in  basket  fast  membership  testing  true  crabgrass  in  basket  false  demonstrate  set  operations  on  unique  letters  from  two  words 
 a  setabracadabra  b  setalacazam  a  unique  letters  in  a  a  r  b  c  d  a  b  letters  in  a  but  not  in  b  r  d  b  a  b  letters  in  a  or  b  or  both  a  c  r  d  b  m  z  l  a  b  letters  in  both  a  and  b  a  c  a  b  letters  in  a  or  b  but  not  both  r  d  b  m  z  l 类似 于列 表推 导 式集合也 支 持 推导 式形 式 a  x  for  x  in  abracadabra  if  x  not  in  abc  a  r  d
 字典
循环 的技 巧
深入 条件 控制
 序列 和其 它类 型的 比较
 序 列 对 象通 常可 以 与相 同序 列类 型的 其他 对象 比较
 这种 比较 使用 字典 式顺 序 首先 比较 开 头的两个对 应 元 素如 果 两者 不 相 等则比 较 结果就 由此 确 定如 果两 者 相等 则 比较之后的 两个 元素以 此 类 推 直 到有一 个 序列被耗 尽
如 果 要比较的 两个 元 素本 身 又 是相 同 类型的 序列则 会递 归 地执行字典 式顺 序比较
 如果 两个 序列中 所 有的 对应元 素都 相 等 则 两个序列 也将 被 视为 相 等
 如果 一 个 序列是 另一 个 的初 始子 序列 则较 短的 序 列就 被视为较 小较少
 对于字 符串 来 说 字 典式顺 序是 使用 unicode 码 位序号 对单 个字符 排 序
下 面是 一些 相同 类 型序列 之间 比 较 的例 子123124123124 abc  c  pascal  python 1234124121211231
012 aa  ab 12 abc  a 4注 意 对 不同 类型对 象来 说 只 要待 比较对 象 提 供了 合适 的 比较 方法 就 可 以 使 用和 来比 较
例如混 合数值类 型 是 通 过他 们 的数值 进行 比较 的所 以0 等于0
0 等等
 否则解 释 器 将 抛 出一个 typeerror  异 常 而不 是 随便 给出 一 个 结 果
脚 注1别 的 语言可能 会返 回一个 可 变 对象他们允 许方法连续 执 行例如 dinsertaremovebsort
 错误 和异 常
到 目前 为止 我 们还 没有提 到错 误 消 息 但是 如果 你已经 尝 试过 那些 例子 你 可 能已 经看 过了 一些 错 误消 息
目 前至 少 有 两 种 可区 分 的错 误 语法 错误 和 异 常
语 法 错误
语法 错 误又 称 解析 错 误可 能是 你在学习 python  时最容 易遇 到 的错 误 while  true  printhello  world  file  stdin  line 1 while  true  printhello  world  syntaxerror  invalid  syntax 解 析 器会 输出出 现语法 错 误 的那 一 行 并 显 示一 个箭 头 指向这行 里 面检测到 的第 一个错 误
错误是 由箭头 指 示的 位置上 面的 token  引起的 或 者 至 少是 在这 里被 检测 出的 在示 例中 在 print 这 个 函数中 检 测到 了错误 因 为在它 前面 少 了 个 冒 号
文 件名和 行号 也会被 输出 以 便输入 来自 脚本 文 件 时你 能 知道 去哪 检 查
异 常
 即使语 句 或 表 达 式在 语 法上是 正 确的但 在尝 试执 行 时它 仍 可能会 引发错 误
 在 执行时 检测 到的 错误 被 称为异 常异 常 不 一定会 导 致 严重 后果 你将 很 快学 会 如 何 在 python 程 序 中 处理 它们
 但 是 大 多数 异常 并不 会 被程序处理 此时 会 显示 如下所示的错误 信息1010 traceback  most  recent  call  last  file  stdin  line 1 in  module  zerodivisionerror  division  by  zero 4 spam 3 traceback  most  recent  call  last  file  stdin  line 1 in  module  nameerror  name  spam  is  not  defined 22 traceback  most  recent  call  last  file  stdin  line 1 in  module  typeerror  cant  convert  int  object  to  str  implicitly 错 误信息的 最后一行 告 诉 我 们程 序 遇 到 了什 么类 型的 错 误
 异 常有 不 同的 类型而其 类型名称 将 会作 为 错误信息的 一部分中打 印出 来上 述示 例中的 异 常 类 型依次 是 zerodivisionerror  nameerror 和 typeerror
 作 为异 常类 型打印的 字符 串是 发 生的内置 异常 的 名 称
 对 于所 有 内 置异 常 都是 如此但对 于 用 户定 义 的异 常 则不一定 如 此虽 然这是一 个 有用 的 规范
 标 准 的 异 常 类 型是 内置的 标识 符而不 是保留 关键 字
这 一行 的剩 下 的部 分根 据 异常 类型 及 其 原因提 供详 细信 息
错 误消 息的开 头部 分以堆 栈 回 溯的形 式显 示发 生 异常 的上 下文
 通常它 会包 含 列出 源 代 码行 的 堆 栈回 溯 但 是它 将不 会显 示从 标准 输 入读 取 的行
 内 置 异 常列出 了内 置异 常 和它们的 含义
处 理 异常
抛 出 异常
raise  语 句允 许 程 序员 强制发 生指定的 异常
 例如 raise  nameerrorhithere  traceback  most  recent  call  last  file  stdin  line 1 in  module  nameerror  hithereraise  唯一 的 参 数 就 是 要 抛 出 的 异常
这个 参 数必 须是 一 个异常 实例 或者 是一个 异 常类 派生 自 exception  的类
如 果传递 的是一 个异常 类它 将通过 调用 没有 参 数的 构 造 函 数 来 隐 式实 例化 raise  valueerror  shorthand  for  raise  valueerror 如 果你 需要确定是 否 引发了 异常但 不 打算 处 理它则 可以 使 用 更简 单的 raise  语 句形 式重新 引发异 常 try 
 异 常 链
 raise  runtimeerror  from  exc 这 在你 要转换异 常 时很 有用
 例如 def  func 
traceback  most  recent  call  last  file  stdin  line 4 in  moduleruntimeerrorfor  more  information  about  chaining  mechanics  see 内 置 异 常
用户 自定义异常
 程序可以 通 过创建新 的异 常 类 来 命 名 它们自 己的 异常 有关 python  类的 更多 信 息 请参 阅类
 异 常通 常应 该直 接 或间接地 从 exception  类派 生
 可以 定义异常 类它 可以 执 行 任 何其 他类 可以 执行的任 何 操 作 但 通常 保 持 简单 只 提供 一 些属性这 些 属性 允 许处理程序 为 异常提取 有 关错 误的 信息
 在 创建可能引 发 多 个不 同错 误的模 块时 通常 的 做法 是为 该模 块定 义 的异 常 创 建 基类 并为 不同 错 误条 件创 建特定 异常类 的 子类 class  errorexception  base  class  for  exceptions  in  this  module
message  message  大多 数 异常都定 义 为名 称以 error  结尾 类 似 于标准 异 常 的命名
 许多 标 准 模块 定义 了它 们 自己的 异 常 以报 告它 们 定 义的函 数中 可能 出现 的错 误
 有关类的 更多 信息 请参见 类章 节
 定 义 清理 操作
try  语 句有 另 一 个可 选 子 句 用于定义 必须在 所 有 情况下 执行 的清理 操作
例如 try 
 goodbye  world  traceback  most  recent  call  last  file  stdin  line 2 in  module  keyboardinterrupt  如 果存在 finally  子句 则 finally  子 句将 作为 try  语 句结 束前 的最 后 一项 任务被执 行
 finally 子 句不 论 try  语句是 否产 生 了异 常都会被执行
 以下 几 点讨论 了当异 常发 生 时一些更 复杂的情 况如 果在 执行 try  子 句期间 发生 了 异常该异 常可由 一个 except 子 句进 行 处理
 如果异 常没有 被某个 except  子 句所 处理 则该 异常 会在 finally  子句执 行 之 后被 重 新 引 发
 异常 也 可能 在 except  或 else 子 句执行期 间 发 生
同 样地 该 异常会在 finally  子句 执行之 后被重新引发
 如果在执行 try  语句 时遇 到一个 break  continue 或 return  语 句 则 finally  子句 将在 执行 break  continue 或 return  语 句之 前被 执行
如 果 finally 子句 中包 含 一个 return  语 句则返回 值将来自 finally  子 句的某 个 return  语句 的返 回值而非 来自 try  子句的 return 语 句的 返 回值
 例如 def  boolreturn 
 boolreturn  false 一 个更 为 复杂 的 例 子 def  dividex  y 
0 executing  finally  clause  divide 20 division  by  zero  executing  finally  clause  divide 21 executing  finally  clause  traceback  most  recent  call  last  file  stdin  line 1 in  module  file  stdin  line 3 in  divide  typeerror  unsupported  operand  types  for  str  and  str 正 如你所看 到的 finally 子句 在 任何情 况下 都会 被执 行
 两 个字符 串相 除所 引 发的 typeerror  不 会 由 except  子句 处 理 因 此 会 在 finally 子 句执 行 后被重 新 引 发
 在实 际应 用程 序 中 finally 子 句 对于 释放外部资 源例 如文 件 或者网 络 连接 非常有用无 论是否 成功 使用 资源
预定义的 清 理操 作
某些对 象 定义 了在 不再 需要 该对 象 时 要执 行的 标 准清 理操 作 无 论使 用 该对 象的 操作是成 功还 是失 败清 理操 作都 会 被执 行
 请 查 看 下面 的示例 它尝试打 开一个 文件 并把 其内 容 打印 到屏 幕上
 for  line  in  openmyfile
txt  printline  end 这 个 代 码 的 问 题 在 于它 在这部 分 代 码 执行 完 后 会使 文件在 一段 不确 定 的 时间 内 处于打 开 状 态
 这在 简 单 脚本 中不 是 问 题 但对 于较 大 的应 用程 序来说 可能是个 问 题
 with 语句 允许 像文 件这样 的 对 象 能够 以一 种确 保它 们 得到 及时 和正 确 的清 理的 方式 使用
 with  openmyfile
txt  as  f  for  line  in  f  printline  end 执 行 完语 句后 即使在 处理 行时 遇到 问题 文件 f  也 始终会被 关 闭
 和文件 一 样 提供 预定 义清 理操 作的对象将 在其 文 档中 指 出 这一 点
浮点算术 争议 和限 制
表 示 性错误
 本小 节将详细解 释0
1的例子并 说明 你可以怎样 亲自 对 此类 情况 进 行 精确 分析
 假 定前 提是 已基 本熟 悉 二进 制浮 点表示 法
表 示 性 错误是指某 些 其 实是 大 多数 十 进制 小 数无 法以 二 进制 以2为 基数的 计 数 制精 确表 示这 一事 实造 成 的错误
 这就是为 什么 python  或者 perl 、 c 、 c 、 java 、 fortran  以及 许 多 其他 语言 经 常不会 显示你 所期 待的 精 确 十 进 制数 值 的 主 要 原因
 为什么会这 样？110是 无法 用 二进 制 小数 精确 表 示的
目前2000年11 月几 乎所 有 使 用 ieee 754 浮点 运 算标 准的机器 以及 几乎 所有系 统平台 都会 将 python  浮点数 映射 为 ieee 754 双精度 类型
754 双精 度 类 型包 含53 位精度因此 在 输入时 计算 会尽 量将0
1 转换为以 j 2 n  形 式所 能 表示 的最 接近分 数其 中 j 为 恰好 包 含53个二进 制位的整 数
重 新 将110 j 2 n 写为 j 2 n 10并 且由于 j  恰好 有53位 即252但253 n 的 最佳 值 为5625225610253 true 也 就是说56是唯 一 的 n 值 能令 j  恰 好 有53 位
 这样 j 的最佳 可 能值 就是 经 过 舍 入的 商 q  r  divmod 25610 r 6由于余数 超 过10的 一半 最佳 近 似值 可通 过 四舍五入 获 得 q 17205759403792794这样在754双 精度 下110的 最 佳 近 似 值 为7205759403792794256分 子和 分母 都除 以二 则结果小 数 为3602879701896397255请 注意由 于 我们 做了 向上 舍入 这个 结果实 际 上 略 大 于110 如果 我 们 没 有 向上 舍入 则 商 将会 略小 于110
但 无 论如 何它 都 不 会 是精 确的110因 此计 算永 远不 会 看到110 它实 际看到 的 就 是上面所 给出 的 小数它 所 能达 到 的最 佳754双 精度 近似 值0
0如 果我 们将 该 小数 乘 以1055我们 可以 看 到 该 值输 出 为55 位的 十进 制数360287970189639710552551000000000000000055511151231257827021181583404541015625 这 意 味着 存储在计 算机 中 的 确 切数 值 等 于十进 制数 值0
许多 语 言包 括较 旧版 本 的 python 都不 会显 示这个完 整 的十 进制数 值 而 是 将 结 果舍 入为17 位有 效数字 format 0
10000000000000001 fractions  和 decimal 模 块 可 令 进行 此 类 计算 更加 容易 from  decimal  import  decimal  from  fractions  import  fraction  fraction
python 教程
输 入 输 出
 有几 种方 法可 以 显 示程 序的 输 出数 据可 以以 人 类 可读 的形 式打印出 来 或 者写入 文件 以供 将来 使 用
 本章将 讨 论 一 些可 能性
更 漂亮 的输 出 格式
 格式化字 符串 文 字
格 式化 字符 串字面值常 简 称为 f 字 符 串 能 让 你 在字符 串 前 加上 f  和 f  并将 表 达式写成 expression  来在 字符 串 中包 含 python  表 达 式的 值
可 选 的 格式 说 明符 可 以 跟在 表达 式 后面
这样 可以 更好地控 制值 的 格式 化方 式
以 下 示例 将 pi 舍 入到小 数 点后 三位 import  math  printfthe  value  of  pi  is  approximately  math
在 后 传递 一个 整数可 以让 该字 段成为最 小字 符宽 度
 这在 使列 对 齐时很有 用
 table  sjoerd 4127 jack 4098 dcab 7678 for  name  phone  in  table
 sjoerd 4127 jack 4098 dcab 7678其 他 的 修 饰 符可 用于在 格式化之 前转 化值
 a 应 用 ascii  s 应 用 str 还有 r 应用 repr  animals  eels  printfmy  hovercraft  is  full  of  animals
 有 关这些格式 规 范的 参考 请参阅 参 考指南 格式 规格 迷你语言
 字符串的 format 方 法
str
format  方 法的 基 本用 法 如下 所 示 printwe  are  the  who  say 
formatknights  ni  we  are  the  knights  who  say  ni  花括 号和 其 中 的字符 称为 格式字 段将替 换 为 传 递给 str
format  方法的对 象
花括 号中 的 数字 可用 来表 示传递 给 str
format 方 法的 对 象的 位置
formatspam  eggs  eggs  and  spam 如 果 在 str
format 方法中使 用 关键 字 参 数则 使用参 数的名 称引用它们 的值
 printthis  food  is  adjective
 位置 和关 键 字 参 数 可以任 意组 合 printthe  story  of 01 and  other
 如果你 有一个非 常长的 格 式 字符 串你不 想 把 它 拆开 那 么 你最 好是 按名 称而 不是 按位 置引用 变量来 进行 格式化
 这可 以通过 简单地 传 递 字 典并 使 用 方 括号 访 问键 来完成
formattable  jack 4098 sjoerd 4127 dcab 8637678这 也可以 通过 使 用符号 将 table 作 为关键字 参 数 传递
formattable  jack 4098 sjoerd 4127 dcab 8637678 这在 与内置 函数 vars  结合使 用时 非常有 用 它会 返回 包 含所 有 局部变 量的 字典
 例 如下 面几 行 代码生 成一 组整 齐的 列 其中 包含给定 的 整 数 和它 的平方以 及立方 for  x  in  range 111
111248392741664525125636216749343864512981729101001000关 于使 用 str
format 进行 字符串 格式 化的 完整概 述 请 参阅 格式字符 串语 法
手 动 格式 化 字符 串
旧的 字符 串格 式化 方法
运 算符 求余 也 可 用于 字符 串 格式 化
给 定 string  values 则 string  中的实 例会以 零个 或多 个 values 元素 替换
 此操作 通常 被称为字 符 串插 值
 例 如 import  math  printthe  value  of  pi  is  approximately 5
可在 printf  风 格的 字 符串格 式 化 部 分找 到更 多信 息
 读写 文件
open  返 回一 个 file  object 最 常用 的 有两 个参 数 openfilenamemode
 f  openworkfile  w 第 一 个 参 数是包 含文 件 名 的 字符串
 第二 个参 数是 另 一个字 符 串其 中包 含一 些描 述 文件 使用 方 式的字符
mode  可以是 r  表示 文件 只能 读 取 w 表 示只 能写 入已 存在 的同 名文 件会 被删 除还有 a 表 示打 开 文 件以 追 加内容 任 何写入的 数据 会 自动 添 加 到 文件 的 末 尾
r 表 示 打 开文 件进行读 写
mode 参 数 是 可选 的省 略时 默认 为 r
通 常文 件是 以 text  mode 打 开的这 意 味 着从 文 件 中 读取 或 写入 字 符 串 时都 会 以指定 的编 码方 式 进 行 编 码
 如 果未 指 定 编码格 式默 认值与 平台 相 关参 见 open
在 mode  中追 加 的 b 则 以 binary  mode  打开 文件现 在数 据 是以 字节 对 象 的 形式 进行 读写的
 这个 模式应 该用 于 所 有 不包含 文本 的文 件
在文本 模 式下 读 取 时 默 认会 把平 台特定的行 结束符 unix  上的 nwindows 上的 rn 转 换为 n
在文本 模 式 下写 入时默 认会把出现 的 n 转换 回平 台特定 的结束符
这 样在 幕后 修 改 文 件数 据 对 文本文件 来 说没 有问 题但是 会破坏二进 制 数据 例 如 jpeg  或 exe  文 件 中 的 数据
 请一定 要注意在读 写此类 文 件 时 应 使 用二 进制 模 式
 在 处理文件 对象时 最 好 使用 with  关 键字
优 点是 当子句 体结束 后 文 件会 正确 关闭即使 在 某个 时刻引 发了 异常
 而且 使 用 with  相比 等 效的 tryfinally  代码块要 简短 得 多 with  openworkfile  as  f 
closed  true  如 果 你 没 有使 用 with 关 键字 那么 你应该调 用 f
close 来 关闭文 件并 立即释 放它 使用 的所有 系统 资源
如 果 你 没有 显式地关 闭 文件 python  的垃 圾 回收器 最终将销毁 该 对 象并 为你 关 闭打开的 文 件但 这个文 件可 能会 保持 打开 状态 一段 时间
 另 外 一 个风险 是 不同 的 python 实现 会在不 同的 时 间进 行清 理
通过 with  语句或 者调 用 f
close 关 闭文 件 对象 后尝 试 使 用 该 文件 对象将 自 动失 败
 f
 文 件对 象 的 方法
 本节 中 剩下的 例 子 将假 定 你已 创建 名 为 f 的文 件对 象
要 读取 文 件 内 容请 调用 f
readsize  它会读 取 一 些 数 据 并将其 作 为 字符 串在文本 模 式下 或字 节串 对象 在二 进制模 式 下返 回
 size  是 一 个 可 选 的 数 值 参数
 当 size 被 省略或 者 为负 数时将读 取并 返回 整个 文 件的内容 如 果文 件 的大 小 是 你的机 器内 存的 两 倍就会出 现 问题
 当取 其他值时 将读 取 并 返 回至 多 size 个 字符 在文本 模式 下或 size 个 字节 在二进 制模式下
如 果已 到达文 件末尾 f
read  将返 回一 个空 字 符串
readline  从 文 件中 读取 一行 换 行 符 n  留在 字 符串 的末尾如 果文 件不 以 换行 符结尾则 在 文件的最 后一 行省 略
这 使得 返回 值 明确 无误 如果 f
readline  返回一 个空 的 字 符串 则表示 已 经 到达 了 文件 末尾 而 空 行 使用 n  表示该 字 符串 只 包含 一个 换行符
 f
readline  要从 文 件中读 取行 你 可以 循环 遍 历 文 件对象
 这是 内存高 效快 速的 并 简 化代码 for  line  in  f 
 second  line  of  the  file 如 果 你想 以 列 表的形 式读 取文 件 中的 所有 行你也 可 以使 用 listf 或 f
writestring 会 把 string 的内 容写 入 到文 件 中并 返回 写 入 的字符 数
 f
writethis  is  a  testn 15在 写入其他 类型 的 对象之 前 需要 先 把它 们 转 化 为 字符 串 在文本 模 式 下 或 者 字 节对象 在二 进制 模 式下 value  the  answer 42 s  strvalue  convert  the  tuple  to  string  f
tell  返 回一 个 整 数给 出 文件对象 在文 件中的当 前 位置表示 为二 进制 模式 下 时从 文件 开 始的字节 数以 及文 本模 式 下的 意义不明 的 数字
要 改变 文件 对 象的位置 请 使 用 f
通 过向 一个 参考 点添 加 offset 来计 算位 置 参考 点由 whence 参数 指 定
 whence  的0 值表 示从 文件 开头起 算1 表示使用 当前 文件位 置2 表 示使 用文 件末 尾作 为 参 考点
 whence  如果 省略则默认 值为0即使 用文 件开 头作 为参 考点
read 1 bd  在文 本 文 件 那 些在模 式字 符 串 中 没 有 b 的 打 开 的 文 件中 只 允 许 相 对于 文 件开 头 搜 索 使 用 seek 02搜 索到文件 末尾 是个 例 外并 且 唯 一有 效的 offset  值是 那些能 从 f
tell 中 返 回的 或 者是 零
其他 offset  值都 会 产生未 定义 的 行为
文 件 对 象有一 些额 外的 方法例 如 isatty 和 truncate  它们 使用 频率较低有 关 文 件对象 的 完 整 指 南请 参阅库参 考
 使用 json 保存 结构 化数 据
 字 符 串 可 以很 轻 松地 写 入文 件并 从文 件中 读取 出来
 数 字 可 能 会费 点 劲因为 read  方 法 只 能 返回 字符 串 这 些 字 符串 必 须 传递 给 类 似 int  的函 数它 会接 受 类 似123这 样的 字 符 串 并 返 回 其数 字 值123
当 你想 保存 诸如 嵌 套列 表和 字 典这 样 更复 杂 的 数 据类 型 时 手动 解 析和序 列化 会变得复 杂
python  允许 你使 用 称为 json  javascript  object  notation  的流 行数 据交 换 格 式 而不 是让 用 户不 断的 编 写 和调 试代 码以 将 复 杂的 数据类 型 保存 到文 件中
 名为 json  的标 准模 块 可 以 采 用 python  数据 层 次结 构并 将 它们 转 化 为 字符 串表示 形式 这个过程 称 为 serializing 
从 字符 串表 示 中 重建 数 据称 为 deserializing 
在 序列化 和反 序列 化之间 表示 对 象的字符 串可能 已存 储在文件 或数据 中 或 通过 网 络 连接 发 送 到某 个远 程机器
 注解 json 格 式 通常 被现代 应用 程序 用于 允许 数据 交 换
许 多程 序 员 已经 熟悉它 这使其成 为互 操作性 的良 好 选择
 如 果你 有一 个 对 象 x 你可 以用一行 简单 的 代 码来查 看它 的 json 字 符串 表示 import  json  json
dumps 1 simple  list 1 simple  listdumps  函数 的另 一 个 变体 叫 做 dump 它 只是 将对 象序 列化为 textfile 
 因 此 如果 f  是一 个 text  file 对象 我 们可以 这 样 做 json
dumpx  f  要再 次 解码 对 象如 果 f 是 一个打开 的 以供 阅 读的 text  file  对象 x  json
loadf  这 种简单的 序列 化技 术可 以处 理列 表和 字典 但是 在 json 中序列 化任意 类的 实例 需要 额外 的努 力
 json  模块 的参考 包含 对 此的 解 释
参 见 pickle 封 存 模 块与 json 不 同 pickle  是 一 种允 许对 任意 复杂 python 对 象进 行 序列 化的协 议
因 此它为 python  所特 有不能 用于 与其他 语言 编写的应 用 程序 通信
默 认 情况 下它 也 是 不 安 全 的 如果 数据 是 由熟 练的 攻 击者 精心 设 计 的 则 反 序列 化 来自 不 受 信 任 来源 的 pickle  数 据 可 以执 行任 意 代码
 交互 式 编辑 和 编 辑历 史
某 些 版 本 的 python  解释 器支持编 辑当前 输入 行和编 辑 历史 记录类 似 kornshell 和 gnu  bash  shell  的功能
这 个 功 能 使用 了 gnu  readline 来 实现一 个 支 持 多种编 辑方式 的 库
 这个 库有 它 自己 的 文档在 这 里我们 就不 重 复 说 明了
tab  补全 和编 辑历史
 默 认 交互式 解释器 的 替代品
使 用 python  解释 器
 调用 解 释器
 传 入参 数
 如果 可能 的话 解释 器 会读 取命令 行 参数 转 化为 字符 串 列 表存 入 sys  模 块中的 argv  变量 中
 执行 命 令 import  sys 你 可以 导 入 这个 模 块并访问 这个 列表
 这个 列表 最少 也会有 一 个 元 素 如 果 没有 给定 输入参 数 sys
argv 0 就 是 个 空字 符 串
 如 果 给 定 的 脚 本 名 是 表 示 标 准 输入 sys
argv 0 就是
 使 用 c  command 时 sys
argv 0就 会 是 c
 如 果 使 用 选项 m  modulesys
argv 0 就是 包 含目 录的模 块 全 名
 在 ccommand 或 m  module  之 后 的 选 项 不 会被 解 释 器处 理而 会直 接 留在 sys
argv  中给 命令 或模块 来处理
 交互 模 式
 在终 端 tty  输 入 并 执 行指 令 时 我 们说解释 器 是 运 行 在 交互 模 式 interactive  mode
 在 这种 模式中 它 会显 示主提 示符 primary  prompt  提 示 输 入下一 条指 令通常 用三 个大 于号表 示连 续 输入 行的时 候它 会 显示 次要 提示 符默 认 是三个 点

进入 解释 器时 它 会先 显示欢 迎信息、 版本 信 息、版权声 明然 后 就会 出 现提 示符 python 3
 多 行 指令 需要 在连 续的 多行 中输入
比如 以 if  为例 theworldisflat  true  if  theworldisflat 
 be  careful  not  to  fall  off  有 关交互 模式 的更 多 内 容请 参 考 交互 模 式
解 释器 的运行环 境
 源文件 的 字符编 码
默 认情 况 下 python  源码 文件 以 utf 8编 码 方 式 处 理
 在 这 种编 码方 式中 世界 上 大多 数语 言 的 字符都可 以同 时用 于字符串字 面值、 变量或 函 数 名 称 以及 注 释 中——尽 管 标 准库中 只用 常规 的 ascii 字 符 作 为 变量或函 数 名 而 且任 何可移 植的 代 码 都应 该 遵 守 此 约 定
 要 正 确 显 示 这些 字 符 你的 编 辑 器必 须 能识 别 utf 8 编 码 而且 必须使用 能 支 持 打 开 的 文件中所 有字 符的 字 体
 如 果不 使用默 认 编 码 要 声 明文 件所 使用的编 码文 件的第 一行要 写成 特 殊的 注释
 语 法如下 所示 coding  encoding  其中 encoding 可以 是 python 支 持的 任意 一种 codecs
 比 如 要 声 明 使 用 windows 1252 编码 你 的源 码文 件 要写 成 coding  cp 1252 关于 第 一行 规则 的 一 种例 外情况 是源 码以 unix  shebang  行 开头
 这种情况 下编 码声 明 就要 写在文 件 的第二 行
例 如 usrbinenv  python 3 coding  cp 1252脚 注1在 unix 系 统中 python 3
x  解释 器默 认安装后 的执 行文件并 不 叫 作 python  这 样 才 不会 与同 时 安 装的 python 2
x 冲 突
python 的 非正 式 介 绍
 在 下面 的 例子 中 通过提 示 符 与
的 出 现 与否来 区分 输入和输 出如果 你 想复 现这些 例 子当提 示符 出现 后你 必 须在 提 示 符 后键 入例 子 中的 每 一 个 词 不 以 提 示 符 开 头 的那 些 行是 解 释器 的输出
 注 意 例子 中 某 行中 出现第二 个 提 示符意 味着 你必 须键 入一 个空白 行这 是 用来 结束多 行 命令 的
这个 手 册 中的许 多例子都 包含 注 释甚 至交 互 性 命 令 中也有
python 中 的 注释以 井 号开头 并 且一 直 延 伸 到该 文 本 行结 束 为止
 注 释可 以出 现在 一 行 的开 头或 者是 空白 和代 码的后 边 但 是 不能 出现 在 字符 串中 间
 字符串中 的井 号就 是井号
 因为 注释 是用 来 阐明 代码 的 不 会被 python  解释 所 以 在键 入这些例 子 时注 释 是 可以 被忽 略的
 几个 例 子 this  is  the  first  comment  spam 1 and  this  is  the  second  comment 
python 作为 计算 器使 用
 数字
 字符串
列表
 走 向编 程 的第一步
 当 然我 们可以 将 python 用 于更 复杂 的任务而不 是仅 仅 两个和两个 一起添加
 例 如我 们可 以 编写 斐 波那 契 数列的 初始 子序 列如下 所示 fibonacci  series 
0112358 这个例子 引入了 几个新的 特 点
第一行 含有 一 个多重 赋值 变 量 a 和 b 同时 得 到了 新值0 和1
最后 一 行又 用了 一 次 多 重赋 值 这 体 现 出了 右 手 边的 表达 式在 任何 赋值 发生 之前就 被求 值 了
 右 手边的表达 式是 从 左到 右被 求 值的
 while 循 环只 要 它的条 件这里 指 a 10 保持 为 真就 会一 直 执行
 python 和 c  一 样 任何 非 零 整 数都 为 真零为假
 这个条件 也 可 以是 字符串 或是 列 表 的 值事 实上 任何 序 列都 可以 长 度 非零 就为真空 序 列就 为 假
在这 个 例子 里 判断 条 件 是 一个简 单 的 比 较
标 准的比 较 操作 符 的 写 法和 c 语言 里 是一 样 小于、大 于、 等于、 小于或 等 于、大 于 或等 于以 及不 等 于
循 环 体是缩进的缩进 是 python 组 织语 句的 方式
 在 交 互 式命 令行 里你 得给每 个缩进 的 行敲 下 tab 键 或者 多个 空格 键
 实 际上用 文本 编辑 器的 话 你要 准备 更复 杂的 输入 方 式 所有像样 的 文本 编辑器 都有自动 缩进的 设 置
 交互式 命令行里 当 一个 组 合 的 语句 输 入 时需 要 在最后敲 一个 空 白行 表示完 成 因为 语 法分析 器猜 不 出 来你 什么时 候 打的 是 最 后 一 行
注意 在同 一块 语句 中的每一 行都要 缩进 相 同的长度
 print  函 数将所 有 传 进来 的参 数 值 打 印出来
 它和 直接 输入 你要 显示 的表 达式比 如我们之前 在计 算器 的例 子里做的不 一样 print  能 处 理多个 参数 包 括浮点数 字符 串
字符 串会打印 不带 引号的内 容 并 且在参 数项之间 会 插入 一个 空 格这 样 你就 可以很 好的 把东 西格 式化像 这 样 i 256256 printthe  value  of  i  is  i  the  value  of  i  is 65536关键字 参数 end  可以 用来 取消 输出 后面 的换 行 或 是用 另外一个 字符串 来结尾 a  b 01 while  a 1000
01123581321345589144233377610987脚 注1因 为比有 更高 的 优先 级所 以32会 被解 释成32因 此结 果是9
为 了避 免这 个并且 得 到 结果9你可以 用这个式 子32
2和 其他 语言 不一样的是 特 殊 字 符 比如说 n 在 单引 号
和双引 号
 里有 一样 的 意义
这 两种引 号 唯 一 的区 别是 你不需要 在 单引号里 转义 双 引号但 是你 必 须把 单引 号转义 成反 之亦 然
模块
 如 果你 从 python 解释器 退 出 并再 次进 入之前的 定义函 数 和变 量都会丢 失
因 此 如果你 想编写 一个 稍长 些的 程序最 好使 用 文本 编辑器 为解释 器准备输入 并将该 文件作 为输入 运 行
这被称 作 编 写脚 本
随 着程序变 得越 来越长你 或 许 会想把它 拆 分成 几个文件 以 方便 维护
 你亦 或想在 不同的 程序 中使 用一个 便 捷的 函 数而 不必 把这 个函 数复制到 每一个 程 序 中去
 为支持这 些 python 有 一种方法 可以 把 定义 放 在 一个 文件里并在 脚本 或解 释器的 交 互式 实例 中使 用它们
 这 样 的 文件 被称作 模块 模块中的 定义可以导 入到其 它模 块或者主模 块你在 顶 级和 计算器 模式 下执行 的脚本 中可 以 访 问 的 变 量集 合
 模 块 是 一 个 包含 python  定义 和语 句的 文 件
文 件 名就 是模 块名 后跟文 件后缀
py 
 在 一个 模块 内部 模块 名 作为 一个 字符 串 可 以 通 过 全 局 变 量 name 的值获 得
例 如 使 用 你最 喜爱 的文本编辑 器 在 当前 目 录 下创 建 一 个 名为 fibo
py  的文 件 文 件 中 含 有以 下 内容 fibonacci  numbers  module  def  fibn  write  fibonacci  series  up  to  n  a  b 01 while  a  n  printa  end  a  b  b  ab  print  def  fib 2 n  return  fibonacci  series  up  to  n  result  a  b 01 while  a  n  result
appenda  a  b  b  ab  return  result  现在 进入 python  解释 器 并 用以下 命令导入该 模块 import  fibo  在当 前的 符 号表 中这 并 不 会直 接 进 入到定 义 在 fibo  函 数内的 名 称 它只是进入 到模块 名 fibo 中
 你可 以用 模块名 访问这 些函 数 fibo
name  fibo  如果 你想 经常 使用某个 函数 你可 以 把它赋值给 一个局 部变 量 fib  fibo
有关模 块的 更 多信 息
以 脚本的方式 执行模 块
 当你 用 下 面方 式运行 一个 python 模 块 python  fibo
py  arguments 模 块 里的代 码会被 执行 就 好 像你导 入了模 块 一样但是 name 被 赋 值 为 main
这 意味 着通过在 你 的模 块 末尾添 加 这 些 代 码 if  name  main  import  sys  fibintsys
argv 1你 既可 以把这 个文 件 当 作 脚 本又可 当作 一个可调 入的 模块 来 使用 因 为 那段解 析命 令行 的代 码 只 有在 当模块 是 以 main 文 件 的方 式执 行 的时 候 才会 运行 python  fibo
py 500112358132134如 果模块 是被导入的 那 些 代码是不运 行 的 import  fibo 这 经常 用于 为模 块提 供 一个 方便的用户 接口 或用于测 试以 脚 本的 方式 运行模 块从 而执 行一 些测试 套 件
模 块搜 索 路径
 编译过 的 python 文 件
 标准 模 块
python 附 带 了一个 标准模 块库 在 单独的文 档 python 库 参考 以下称 为库 参考中 进 行了 描述
 一 些模 块内 置于 解 释器 中它们 提 供对不 属于语言 核 心但仍 然 内置的 操作的 访问 以提高 效率 或提 供对 系统 调用 等 操作 系统原 语 的访 问
这 些模 块的 集 合是 一个 配置 选 项它 也取 决于底 层平 台
 例如 winreg  模块只在 windows  操作 系统上提供
 一个 特别值 得注 意的 模块 sys  它 被 内 嵌到 每一 个 python  解 释 器 中
 变 量 sys
ps 1 和 sys
ps 2 定义用作 主要 和 辅助 提示 的 字 符串 import  sys  sys
ps 1 c  c  printyuck  yuck  c  这两 个 变量只 有在 编 译 器 是交互 模式 下 才被 定 义
sys
path  变量 是一 个 字符串 列 表 用 于确定 解 释器 的模块 搜 索 路径
 该 变量 被初 始化为从 环境 变量 pythonpath  获 取 的 默认 路径 或 者 如果 pythonpath  未设 置 则 从 内置 默认 路 径 初始 化
你 可以使 用标 准 列表 操 作对 其进 行 修 改 import  sys  sys
dir  函数
内 置函 数 dir  用 于 查找 模 块 定 义 的 名称
 它返 回一 个排序过 的 字符 串 列表 import  fibo  sys  dirfibo  name  fib  fib 2 dirsys  breakpointhook  displayhook  doc  excepthook  interactivehook  loader  name  package  spec  stderr  stdin  stdout  unraisablehook  cleartypecache  currentframes  debugmallocstats  framework  getframe  git  home  xoptions  abiflags  addaudithook  apiversion  argv  audit  baseexecprefix  baseprefix  breakpointhook  builtinmodulenames  byteorder  calltracing  callstats  copyright  displayhook  dontwritebytecode  excinfo  excepthook  execprefix  executable  exit  flags  floatinfo  floatreprstyle  getasyncgenhooks  getcoroutineorigintrackingdepth  getallocatedblocks  getdefaultencoding  getdlopenflags  getfilesystemencodeerrors  getfilesystemencoding  getprofile  getrecursionlimit  getrefcount  getsizeof  getswitchinterval  gettrace  hashinfo  hexversion  implementation  intinfo  intern  isfinalizing  lasttraceback  lasttype  lastvalue  maxsize  maxunicode  metapath  modules  path  pathhooks  pathimportercache  platform  prefix  ps 1 ps 2 pycacheprefix  setasyncgenhooks  setcoroutineorigintrackingdepth  setdlopenflags  setprofile  setrecursionlimit  setswitchinterval  settrace  stderr  stdin  stdout  threadinfo  unraisablehook  version  versioninfo  warnoptions  如果 没有 参 数 dir 会列 出 你 当前 定 义 的名称 a 12345 import  fibo  fib  fibo
fib  dir  builtins  name  a  fib  fibo  sys  注意 它 列 出所 有类型 的名 称 变量模 块函数 等等
dir 不 会列出 内 置 函数 和变 量的 名 称
如 果你 想 要 这些 它们的 定义 是 在标 准模 块 builtins  中 import  builtins  dirbuiltins  arithmeticerror  assertionerror  attributeerror  baseexception  blockingioerror  brokenpipeerror  buffererror  byteswarning  childprocesserror  connectionabortederror  connectionerror  connectionrefusederror  connectionreseterror  deprecationwarning  eoferror  ellipsis  environmenterror  exception  false  fileexistserror  filenotfounderror  floatingpointerror  futurewarning  generatorexit  ioerror  importerror  importwarning  indentationerror  indexerror  interruptederror  isadirectoryerror  keyerror  keyboardinterrupt  lookuperror  memoryerror  nameerror  none  notadirectoryerror  notimplemented  notimplementederror  oserror  overflowerror  pendingdeprecationwarning  permissionerror  processlookuperror  referenceerror  resourcewarning  runtimeerror  runtimewarning  stopiteration  syntaxerror  syntaxwarning  systemerror  systemexit  taberror  timeouterror  true  typeerror  unboundlocalerror  unicodedecodeerror  unicodeencodeerror  unicodeerror  unicodetranslateerror  unicodewarning  userwarning  valueerror  warning  zerodivisionerror  buildclass  debug  doc  import  name  package  abs  all  any  ascii  bin  bool  bytearray  bytes  callable  chr  classmethod  compile  complex  copyright  credits  delattr  dict  dir  divmod  enumerate  eval  exec  exit  filter  float  format  frozenset  getattr  globals  hasattr  hash  help  hex  id  input  int  isinstance  issubclass  iter  len  license  list  locals  map  max  memoryview  min  next  object  oct  open  ord  pow  print  property  quit  range  repr  reversed  round  set  setattr  slice  sorted  staticmethod  str  sum  super  tuple  type  vars  zip
 包
 包是 一种通 过 用带 点 号 的模 块 名来构 造 python  模块 命 名 空 间 的方 法
 例如 模 块 名 a
b  表 示 a 包 中 名 为 b 的 子 模 块
正 如模 块的使 用使 得 不同 模 块 的 作 者不 必担 心 彼 此的 全局 变量 名称 一样使用 加点 的模 块 名 可以 使得 numpy 或 pillow 等 多模块软 件 包的 作 者 不必担 心 彼 此的 模块名称一 样
 假设你 想 为 声 音文 件 和声 音数 据的 统 一处 理 设计 一 个模 块 集合一 个包
 由 于 存 在很多不 同的 声音 文 件 格 式通 常 由 它 们 的 扩 展 名来 识别 例 如
wav 
aiff 
au 因 此为 了 不 同 文 件格 式间的 转换 你可 能需 要 创 建和 维 护一个不断增长 的 模 块 集合
你 可 能还 想对 声 音 数据 还做 很 多 不同的 处 理 例 如混 声添 加 回声 使 用均衡 器功能 创 造 人 工立 体 声 效 果因 此 为 了实 现这 些 处理 你将 另 外写 一个 无 穷 尽的 模 块流
 这是 你的 包 的 可能结 构 以分 层 文件 系统 的形式 表示 sound  toplevel  package  init
 当导 入这 个包 时 python  搜索 sys
path 里 的目录 查 找 包的 子目 录
必 须 要 有 init
py  文 件才 能 让 python 将包 含 该文 件的目 录 当 作 包
 这 样 可以 防止 具有 通 常名 称例如 string  的 目录 在无意 中隐 藏稍后 在模 块搜 索路径上 出现 的有效 模 块
在 最简单的情 况下 init
py 可 以只是一个 空 文 件但它也 可以 执 行包 的初 始化代 码或 设置 all 变量 具 体将 在 后文介 绍
 包的用 户 可 以从 包 中导入单 个模块例如 import  sound
echo  这 会加 载子 模块 sound
echo 
 但 引用它时 必须使用 它 的全 名
7 atten 4 导 入子 模块的另 一种 方法 是 from  sound
effects  import  echo  这也 会 加载 子模 块 echo 并 使 其在没 有包 前 缀的 情 况 下 可 用因此 可以 按如下 方式使 用 echo
7 atten 4另 一 种形式 是 直 接 导 入所 需 的函 数或变 量 from  sound
echo  import  echofilter 同样这 也 会加 载子 模 块 echo 但 这会 使 其函 数 echofilter  直接可 用 echofilterinput  output  delay 0
7 atten 4 请注 意 当使用 from  package  import  item 时 item  可 以是 包的 子 模 块或子 包 也可以 是包 中定 义 的其 他名 称如函 数类 或变 量
 import  语句 首先 测试 是 否在包 中 定义了 item  如 果 没有它 假定 它 是一 个 模块 并尝试 加载它
 如 果找 不 到 它则 引发 importerror  异常
 相反 当使 用 import  item
subsubitem 这 样 的语法 时除了 最 后 一项 之外 的 每一 项 都 必 须 是一 个包 最 后 一 项可 以是模块 或包但 不能 是 前一 项中定义 的类或 函 数或 变量
 从包中 导 入
当 用户 写 from  sound
effects  import 会发生什 么？理 想情 况 下人 们希 望这 会 以某 种方 式传 递 给文 件 系统找 到包 中 存在 哪些子 模块 并 将 它们全部导入
 这可 能 需要 很长 时间 导入 子 模块 可能会产 生 不 必要 的 副作 用这 种副 作 用只 有 在显 式导 入子模 块 时才 会 发生
 唯 一 的 解决 方 案是 让包 作者提供 一 个 包的显 式索 引
import  语句 使用 下面 的规范如 果 一个 包的 init
py 代码定 义了一 个名为 all 的 列 表它会 被视为在 遇到 from  package  import  时 应该 导入 的模块名 列表
 在发 布 该包 的 新 版本 时包 作 者可 以决 定是否让 此 列 表保持 更新
 包 作者 如果 认为 从 他们 的包 中导 入 的 操作 没有 必 要被 使用 也可以 决定 不支持 此列 表
例 如 文件 soundeffectsinit
py  可 以 包含 以下代码 all  echo  surround  reverse 这 意味 着 from  sound
effects  import 将 导 入 sound  包 的 三个 命 名子 模 块
如 果没 有 定义 allfrom  sound
effects  import 语 句不会 从包 sound
effects  中导 入 所 有子 模块 到 当 前 命 名空 间 它 只 确 保导 入了 包 sound
effects  可能 运行 任何 在 init
py  中 的 初始 化代 码 然后 导 入包 中 定义 的任 何 名称
 这 包括 init
py  定义的 任何 名 称 以 及 显 式加 载的 子模 块
它 还包 括 由 之 前 的 import 语 句显 式加载的包 的任何 子模 块
 思考 下 面 的代 码 import  sound
effects  import  在 这 个例子 中 echo 和 surround 模 块 是 在执 行 from
import  语句时 导 入到当 前命名 空 间中 的因 为 它 们定 义在 sound
effects  包 中
这 在 定义 了 all 时也 有效
 虽然 某些 模块被设 计为 在 使用 import 时 只导 出 遵 循 某些 模式的名 称 但 在生 产代 码中它 仍 然被 认 为是 不 好的做 法
 请 记住 使用 from  package  import  specificsubmodule  没 有任 何 问 题实际上 除非 导入 的模 块需 要 使用 来自 不同包的 同名 子模 块否 则 这是推 荐的 表 示法
子 包参 考
当包 被构 造成 子 包时 与示例 中的 sound  包 一样 你 可 以 使 用绝对 导 入来 引 用 兄弟 包 的子模 块
 例 如 如 果 模块 sound
vocoder  需要 在 sound
effects  包中使 用 echo  模 块它 可以 使 用 from  sound
effectsimport  echo 
 你 还可 以 使 用 import 语 句 的 from  module  import  name  形 式 编写相 对 导 入
这些导 入 使用前 导 点 来 指示 相 对 导入 中涉及 的当 前 包和 父包
 例如 从 surround  模 块 你 可以 使用 from 
filters  import  equalizer  请 注 意 相对 导入是 基于当 前 模 块 的 名称 进行 导 入的
由 于 主模块 的名称 总 是 main  因 此 用 作 python  应 用 程 序 主 模块 的 模 块 必须始 终 使 用绝 对 导 入
 多 个目 录 中 的包
 包支持 另 一个 特殊属性 path 
 它被 初 始 化为 一 个 列 表 其 中包 含 在执 行该 文 件 中 的 代 码之前 保存 包的 文件 init
py 的 目 录的 名 称
这 个变 量 可以 修改 这 样做会 影 响 将 来 对 包中 包含的 模块和 子包的 搜索
虽然 通 常 不 需 要 此 功能但它 可用 于扩 展程 序 包 中 的模块集
 脚注1实际 上函数 定义也 是 被 执 行 的语 句模 块级函数 定 义的 执行 在模 块 的全局 符 号 表 中输入 该 函 数名
标 准库简介
 操 作 系 统接口
os  模块 提 供 了许 多与 操 作系 统 交 互的 函 数 import  os  os
systemmkdir  today  run  the  command  mkdir  in  the  system  shell 0 一定 要 使 用 import  os 而 不是 from  os  import 
 这 将避 免 内建 的 open 函 数被 os
open  隐 式替换 掉 因为它们 的使 用方式 大不 相同
 内 置的 dir  和 help 函 数可用 作交 互 式 辅助工 具用于处 理大 型模 块如 os  import  os  diros  returns  a  list  of  all  module  functions  helpos  returns  an  extensive  manual  page  created  from  the  modules  docstrings 对 于 日常 文 件和 目录管理 任 务 shutil 模 块提供了 更易于使 用 的 更高 级别 的接口 import  shutil  shutil
 文 件 通配 符
glob  模 块提 供了 一 个在 目录中 使 用通 配符 搜索创建 文 件 列 表 的 函数 import  glob  glob
 命令 行 参 数
通 用 实 用程 序脚本 通常需要 处理 命令 行 参 数
 这 些参 数 作为 列表 存 储 在 sys  模 块的 argv  属性 中
 例如以 下 输出 来 自 在 命令行 运 行 python  demo
pyone  two  three  import  sys  printsys
py  one  two  threeargparse 模块提 供 了一种 更 复杂 的机制 来 处理 命 令 行 参数
 以下脚 本 可 提 取一 个 或多 个文 件名 并可 选择 要显 示 的 行 数 import  argparse  parser  argparse
parseargs  printargs 当 在 通 过 python  top
txt  beta
txt 在 命令 行运 行时 该 脚本会 将 args
lines  设为5并 将 args
filenames  设为 alpha
错 误 输 出重 定向和 程 序 终止
sys 模 块还具有 stdin  stdout  和 stderr  的属性
 后者对 于 发出 警告和 错误 消息 非常有 用即使 在 stdout 被 重 定向 后 也 可 以 看 到它们 sys
writewarning  log  file  not  found  starting  a  new  onen  warning  log  file  not  found  starting  a  new  one  终止脚 本的 最直 接方 法是使 用 sys
exit 
字 符 串模式 匹配
re  模块 为 高 级字符 串处理提 供 正则表达 式工具
对 于复杂的 匹 配和 操作 正则 表达 式 提供 简洁 优 化的 解决 方案 import  re  re
subrbaz 1 r 1 cat  in  the  the  hat  cat  in  the  hat 当 只 需要 简 单 的功 能时 首 选 字符 串方法因 为它们更 容 易阅读 和 调试 tea  for  too
 数学
互 联 网访 问
有 许 多 模 块 可用 于访 问互 联网 和 处理互 联 网协 议
 其中两个 最 简单 的 urllib
request  用于从 url  检索数据 以 及 smtplib  用 于 发 送 邮 件 from  urllib
quit 请注意第 二个示 例需要 在 localhost  上 运行 的邮件服 务器

日 期和 时间
datetime  模 块提 供了 以 简单和 复杂的 方式操 作日 期和时 间 的类
虽 然 支 持日期 和时 间算 法但 实现 的重 点是 有效的成 员提取以 进行输 出格 式 化 和操作
 该模块 还支 持可感知 时 区的对 象
数 据 压 缩
常 见的 数据存 档 和 压 缩格式 由模 块 直接支 持包 括 zlib  gzip  bz 2 lzma  zipfile  和 tarfile
 import  zlib  s  bwitch  which  has  which  witches  wrist  watch  lens 41 t  zlib
性能测 量
一 些 python  用 户对了解 同一问 题的不同 方 法的 相对性 能产 生了 浓厚 的兴 趣
python 提 供了 一种可 以立 即回 答这 些 问题 的测 量工具
 例如 元组 封 包和 拆 包功 能 相 比传统的交 换参数可 能更 具吸引力
timeit 模 块可以 快速 演 示 在 运行 效率 方 面 一定的优 势 from  timeit  import  timer  timerta  ab  bt  a 1 b 2
54962537085770791 与 timeit  的 精细粒度 级别 相反 profile  和 pstats  模块提供 了 用于 在较大 的代码块中 识别 时间 关键部 分的 工具
 质 量 控制
 开 发 高质量软 件的一 种 方法 是在 开发过程 中为 每个 函 数 编 写 测 试并 在开 发 过程中 经常 运行这些 测试
doctest 模块提 供了 一个 工具用于 扫描模块 并验证 程 序文 档字 符串中 嵌入 的测 试
 测 试构造就像将典 型 调用 及其 结果 剪切 并 粘贴 到 文 档 字符 串一样简 单
这通 过向用 户提 供示例来 改进文 档并 且 它允 许 doctest 模 块 确保 代码 保持 对 文档 的真 实 def  averagevalues  computes  the  arithmetic  mean  of  a  list  of  numbers
testmod  automatically  validate  the  embedded  testsunittest 模 块不 像 doctest 模 块那 样易于使 用 但它 允许 在一 个单 独 的文 件 中维 护更 全面 的测 试集 import  unittest  class  teststatisticalfunctionsunittest
 自带 电 池
python 有 自 带电 池的理念
 通 过 其包的复 杂 和强 大功 能可 以 最 好地 看到 这一 点
例 如 xmlrpc
client 和 xmlrpc
server  模块使 远程过 程调用 的实现 几近轻 松
尽 管 模块 名称中 有 xml 字 样但 用 户不 需要 直接 了解或处理 xml
 email  包是 一个用 于管 理 电子 邮件 的库 包 括 mime 和 其 他基 于 rfc 2822的邮 件文 档
与 smtplib  和 poplib  实际上发送和接 收 消 息不 同电 子邮 件包 具有 完 整的工 具集 用于 构 建 或解 码复 杂的消 息结构 包括 附 件以 及实 现互 联网编码 和标 头 协议
  json  包为解 析这 种流 行 的数据交 换 格式 提供了 强大 的 支 持
 csv 模 块支 持以 逗 号分隔 值格式直 接 读 取 和 写入 文 件 这些 格式通 常由 数据库和 电子 表格支 持
 xml 处 理由 xml
elementtree  xml
dom  和 xml
sax 包支持
 这 些模 块和软 件 包 共同 大大 简 化 了 python 应 用程 序和 其他 工 具之 间的 数 据交 换
 sqlite 3 模块是 sqlite  数 据 库库 的包 装器 提 供了一个 可以 使用稍 微 非 标准 的 sql 语 法更新和 访问 的 持久数 据 库
 国际 化由 许多 模 块支持包 括 gettext  locale 以及 codecs  包
标 准库 简 介——第 二部 分
 第二 部 分涵 盖 了 专业 编 程所 需要 的更高 级的 模块
这 些模块很 少用 在小脚 本 中
 格式 化输 出
reprlib 模块 提供 了一个定 制化 版本 的 repr 函 数 用于 缩略显示 大型 或深 层 嵌 套的容 器对 象 import  reprlib  reprlib
pprint  模 块提 供了 更 加复 杂的打 印控制 其 输出的内 置对 象和用 户 自 定义对象 能 够 被 解释 器直 接读 取
 当 输出 结果 过 长 而需要折 行 时美 化输出机制 会添 加 换 行符 和缩 进以 更清 楚地 展示 数据 结构 import  pprint  t  black  cyan  white  green  red  magenta 
pprintt  width 30 black  cyan  white  green  red  magenta  yellow  bluetextwrap  模块能够 格式 化文 本段 落以 适应 给定的 屏 幕宽 度 import  textwrap  doc  the  wrap  method  is  just  like  fill  except  that  it  returns 
locale 模 块处 理与 特定地 域 文化 相关 的数据 格 式
locale 模块 的 format  函数 包含 一个 grouping  属性 可直 接将数 字 格式 化 为带 有组 分隔 符的 样式 import  locale  locale
 模 板
使用二 进制数 据记录 格式
struct  模 块提 供了 pack 和 unpack 函 数用 于 处 理不定 长度的 二进 制 记 录 格式
 下 面的 例子展 示 了 在不 使用 zipfile  模块 的 情 况 下 如何 循 环遍 历 一个 zip  文 件的 所 有头 信息
pack  代码 h  和 i  分 别代 表两 字 节 和 四字 节 无 符 号整 数
 代表它们 是标 准尺寸 的 小端 字节 序 import  struct  with  openmyfile
多 线 程
线 程是一 种对 于非 顺 序依 赖的 多个 任务 进 行 解 耦的技 术
多 线程可 以提 高应 用 的响 应 效率 当 接收 用 户 输入 的同 时保 持 其他 任 务在后 台 运行
 一个 有关 的应用 场景 是将 io  和 计算 运 行 在 两个并 行 的 线程中
 以下代 码 展 示了 高阶 的 threading 模 块如 何在 后 台 运 行任 务 且不 影 响主程 序 的继 续运行 import  threading  zipfile  class  asynczipthreading
多 线 程 应 用 面 临的 主 要挑战 是相 互协调的多个线 程之 间 需要 共 享数据或 其 他 资源
 为 此 threading  模 块 提 供了多 个同步操 作原语包括 线 程 锁、事件、 条件 变量 和 信号 量
尽管 这些 工 具非常强大 但微 小的 设 计错误 却可 以导 致 一些 难以 复 现 的 问题
 因 此 实 现多 任务 协作 的 首选 方法是 将 所有 对 资 源的 请 求集 中到一个 线程 中然 后使用 queue  模块 向该 线 程 供 应来自 其他 线程 的请 求
应 用 程序 使 用 queue  对 象 进行线 程间通信 和协 调 更易 于设计更 易读 更 可靠
 日 志
logging 模 块提供 功 能齐 全 且灵活 的 日志 记录 系统
 在最简单的 情况 下日 志消息被发 送 到文 件或 sys
stderr  import  logging  logging
criticalcritical  error  shutting  down 这会 产 生 以下 输 出 warningrootwarningconfig  file  server
conf  not  found  errorrooterror  occurred  criticalrootcritical  error  shutting  down 默认 情况 下 informational 和 debugging  消息被压制 输出会 发 送 到标 准错 误流
其他 输出 选项 包括 将消 息转 发 到电 子 邮件 数据 报 套接 字或 http  服 务器
 新 的 过滤 器可以 根据 消息 优先级 选择 不同 的 路 由 方式 debuginfowarningerror 和 critical
 日志系 统可 以直接 从 python  配 置 也可 以从 用户配 置文 件加 载 以 便 自定 义日志 记录 而无 需更 改 应用 程序
 弱 引用
python  会自 动进 行 内存 管理 对大 多数 对 象 进 行引 用计 数并 使用 garbagecollection 来 清除 循 环 引 用
当 某个 对 象的 最 后 一 个引用 被移除后 不久就 会释 放 其所 占用的 内 存
 此方 式对 大多 数应 用 来说 都 适用 但偶 尔也必 须在 对 象 持 续被 其 他 对 象所 使 用 时跟踪 它们
 不幸 的是 跟踪 它们 将创建 一个 会 令 其永久化的 引用
 weakref  模块 提供 的工 具可 以不 必 创建 引用 就能 跟 踪对 象
 当对 象 不再需 要时 它将 自 动 从 一 个弱 引用 表 中被 移除 并为 弱引 用 对 象 触发 一个 回调
 典 型应 用 包 括 对创 建开 销 较大的 对 象进 行 缓存 import  weakref  gc  class  a 
 用 于 操 作列 表的工 具
许 多对 于数 据 结 构的 需 求 可以 通过内置 列 表类 型来满足
 但是 有时也会 需要 具 有不 同效 费 比的 替 代实 现
array 模 块 提 供了 一种 array  对象它类 似于 列 表 但 只能存 储类型一 致的 数 据且存 储密集更 高
下面的 例 子演示 了一 个 以 两个字 节 为 存储 单元的无符 号 二进 制 数 值 的数 组 类型码 为 h 而对于 普 通列 表来 说每 个条 目 存储 为 标 准 python  的 int 对象通 常要 占 用16个字 节 from  array  import  array  a  arrayh 40001070022222 suma 26932 a 13 arrayh 10700 collections  模块提 供 了一种 deque 对 象它 类似 于列 表但从 左端 添加和 弹 出 的速 度 较快 而在 中间查找 的 速度 较慢
此 种 对象 适用于实 现队 列和 广度优 先树搜索 from  collections  import  deque  d  dequetask 1 task 2 task 3 d
appendm  在替代 的列 表实现以 外标准 库也提 供了 其他工具 例 如 bisect 模块 具有用于 操作有序 列 表的 函 数 import  bisect  scores 100 perl 200 tcl 400 lua 500 python  bisect
insortscores 300 ruby  scores 100 perl 200 tcl 300 ruby 400 lua 500 pythonheapq 模 块提 供了 基 于常 规列 表来实现堆 的函 数
最小 值 的 条 目总 是保 持 在 位 置 零
这对 于 需要 重 复访问 最小 元素 而 不希 望 运 行 完 整列表 排序 的应 用 来说非常 有 用 from  heapq  import  heapify  heappop  heappush  data 1357924680 heapifydata  rearrange  the  list  into  heap  order  heappushdata 5 add  a  new  entry  heappopdata  for  i  in  range 3 fetch  the  three  smallest  entries 501
十 进 制浮 点运 算
decimal 模块提 供了 一种 decimal 数 据类型用 于 十 进 制 浮点 运 算
相 比内置的 float  二进制 浮点 实现 该类 特别 适用 于财 务应 用 和其 他需 要精 确 十 进制表 示 的用 途控制 精 度控制四 舍 五 入以满足法 律或 监管 要求 跟踪 有效 小数 位 或用 户期 望结 果 与手工完 成的 计 算 相匹 配的 应用程 序
例 如 使 用十进制 浮点和 二进制浮 点数 计算70 美分 手 机和5％ 税的 总 费 用会 产生 的不 同结 果
 如 果 结果四 舍五 入到 最接近的分 数差 异 会更大 from  decimal  import  rounddecimal 0
73 decimal  表示 的 结果 会保 留尾 部的零 并根 据 具有 两个 有效 位的被 乘数自动推 出四 个 有效 位
 decimal 可 以 模拟 手工 运 算来避 免当二 进制 浮 点数 无法 精 确 表 示 十 进制 数时 会导 致的 问题
 精确表 示特 性 使得 decimal  类能 够 执 行 对于二 进制 浮点数来说 不适 用 的模运 算和 相 等性 检 测 decimal 1
0 falsedecimal 模 块 提供 了运算 所 需 要 的 足 够 精度 getcontext
 虚拟环 境 和 包
 概 述
python 应 用程序 通常 会使 用 不 在 标准 库 内的 软 件包 和 模块
 应用 程序 有时需 要 特定版 本的 库因 为应 用程 序可 能 需 要修 复 特定的 错 误或 者可以使用 库的 过时 版本 的接口 编 写 应用 程序
 这 意 味着 一个 python  安装 可 能无 法 满 足 每 个应 用程 序的 要求
 如果 应 用程序 a  需要 特定 模块 的1
0版 本但应 用程 序 b 需要2
0版 本则需求存 在冲 突安 装版本1
0或2
0将 导致某一 个 应 用程序无法 运行
 这个 问题的 解决方案是 创建 一 个 virtual  environment  一个 目录树 其 中 安装 有特定 python  版本 以及 许多其 他包
 然 后 不 同的 应用 将可 以 使 用 不 同 的虚 拟 环 境
 要 解 决先 前需 求相 冲 突 的 例 子应 用程 序 a 可 以 拥 有 自己 的 安装 了1
0版本 的 虚拟环境 而应用程 序 b 则拥有安 装 了2
0版本 的另一 个虚 拟 环 境
 如 果 应 用 程 序 b  要 求将某 个库升 级到3
0 版本 也不 会 影 响 应用程序 a 的 环 境
 创 建虚 拟 环境
 用于 创建和 管理虚 拟 环 境 的 模 块称 为 venv
venv 通 常会 安装你 可 用 的 最 新版 本 的 python
 如果 您的系 统上 有多 个 版 本的 python  您可以 通 过运行 python 3 或您想 要的 任何 版本 来选择特 定 的 python 版本
 要 创建 虚拟 环境 请确 定要 放 置它 的目 录 并 将 venv 模块 作为脚 本运 行目录 路 径 python 3 m  venv  tutorialenv  如果 tutorialenv  目 录不 存 在它 将为你创建 一个 并 在其 中 创建 包含 python  解释器标 准 库 和各 种支持文 件的副 本的 目 录
 虚拟环 境 的 常用目 录 位置 是
这个名 称 通 常会 令该 目录 在 你 的终 端中保持 隐藏从而 避免 需要对 所在 目录 进行额外 解 释 的 一 般名 称
 它还 能防 止与某些 工具所支 持的
env  环境 变量定义 文件 发生 冲突
创建 虚 拟环 境后 您可以激 活它
 在 windows 上 运行 tutorialenvscriptsactivate
bat  在 unix  或 macos 上 运 行 source  tutorialenvbinactivate 这个脚 本是 为 bash  shell 编 写 的
如 果 你 使用 csh  或 fish  shell 你 应该 改 用 activate
csh 或 activate
fish 脚 本
 激活 虚拟环境 将改 变你 所用终端 的 提示符以显 示你正在 使用 的虚 拟 环 境 并修 改 环境 以使 python  命令 所运 行的 将 是已 安装的 特定 python  版 本
例如 source  envstutorialenvbinactivate  tutorialenv  python  python 3
使 用 pip 管理 包
你可以 使 用一 个名 为 pip 的 程 序来 安 装、升 级和移除 软件 包
 默认情况 下 pip 将从 python  package  index  httpspypi
org  安装 软 件包
你可 以 在浏览器 中 访问 python  package  index  或是使 用 pip 受 限 的搜索 功能 tutorialenv  pip  search  astronomy  skyfield  elegant  astronomy  for  python  gary  galactic  astronomy  and  gravitational  dynamics
pip 有许 多子 命令 search 、 install 、 uninstall 、 freeze 等等
 请参 阅 安装 python  模 块指 南 以了 解 pip 的 完整文 档
您可以 通 过指 定包的名称来 安装最新 版 本的 包 tutorialenv  python  m  pip  install  novas  collecting  novas  downloading  novas 3
3您还可 以 通过 提供 包名称 后跟 和 版本号 来安装特定 版本的 包 tutorialenv  python  m  pip  install  requests 2
0 如果你 重 新运 行这 个 命 令 pip 会注意 到已 经 安 装了 所 请求 的版 本 并且 什么都 不做
 您 可以提供不同 的 版本 号 来获 取 该 版本 或 者 您可 以运行 pip  installupgrade 将 软件 包升 级到 最新 版本 tutorialenv  python  m  pip  install  upgrade  requests  collecting  requests  installing  collected  packages  requests  found  existing  installation  requests 2
0 pip  uninstall  后跟一 个 或 多 个 包名称将 从 虚 拟 环 境中 删除 包
pip  show 将显 示有关 特 定包 的信 息 tutorialenv  pip  show  requests  metadataversion 2
4 sitepackages  requirespip  list 将 显示虚 拟 环境 中安装的 所 有 软 件包 tutorialenv  pip  list  novas 3
0 pip  freeze  将生 成 一 个 类似 的已安 装 包 列表 但输出 使用 pip  install  期 望的 格式
 一个 常见 的约 定 是 将 此列 表放 在 requirements
txt 文 件中 tutorialenv  pip  freeze  requirements
0 然 后可 以将 requirements
txt  提交 给 版本 控 制并 作为 应用程序 的一部分 提供
 然后 用户 可以 使用 install  r 安装所有 必 需的包 tutorialenv  python  m  pip  install  r  requirements
0 pip  有更 多 选 择
 有关 pip  的 完 整 文档 请 参 阅安 装 python  模 块指 南
 当您编写一 个 包并希 望 在 python  包 索引 中使 它可用时 请 参考 分发 python  模 块指 南
 接下来？
 阅 读本 教 程 可 能会 增 强您对使 用 python  的兴 趣您 应 该 热衷 于 应用 python  来 解 决 您的实 际问题
 你应 该去 哪里 了解 更 多？本教程是 python  文档集的 一 部分
其 他文 档 python 标 准 库您 应该浏 览本手册该 手 册 提供 了有关 标准库中 的类型 功 能和 模 块 的完 整尽 管 简洁 参考 资料
标 准 的 python 发 行版 包含很 多的 附加 代码
 有 些模 块可以 读取 unix  邮 箱通过 http 检 索文 档 生 成随 机 数解 析命令行选 项 编 写 cgi 程序 压缩 数据 以 及许 多 其 他 任务
浏 览 标准 库参 考可 以 了 解更多 可用 的内 容
 安 装 python 模 块 解释 了 怎么 安装由 其 他 python 开发 者编 写的 模块
 python  语 言 参 考 python  的语法和 语义的 详细解 释
尽管 阅 读完 非常 繁重但 作为 语 言本身 的完 整 指南是有 用 的
 更多 python 资源 httpswww
org 主 要 的 python 网 站
 它 包含代码 文档以 及 指向 web 上 与 python 相 关的 页 面 的链 接
该网 站世界很 多 地区 都 有镜 像如欧 洲 日本和澳 大利 亚 镜像可 能 比主 站 点更 快具 体取决 于您 的地 理位置
org  快速 访 问 python  的 文档
org  the  python  package  index  以前 也被 昵 称为 cheese  shop 1 是可下 载用 户 自制 python  模块 的 索引
 当你要开 始发布代 码时 你可 以在 此处进行 注册 以便 其他 人 能 找 到它
comrecipeslangspython  python  cookbook  是一 个相 当大的 代码 示例集 更多 的模 块和 有 用 的脚 本
特 别 值 得注 意 的 贡献 收 集 在 一 本 名 为 python  cookbookoreilly ＆ associatesisbn 0596007973 的书 中
 httpwww
org 从 会议 和用 户 组 会议中收 集与 python 相关 的 视频的链 接
org  ecientific  python  项目包 括用于 快速阵列 计 算和 操作 的 模块以及 用 于 诸如 线 性 代数 傅里叶 变换 非线 性求 解器 随机 数 分布 统计 分析 等的 一系 列 包
 对于 与 python 相 关的 问题 和 问 题 报告 您可以 发布到 新 闻 组 comp
python 或 者 将它 们 发 送到 邮 件 列表 pythonlistpython
 新 闻 组 和邮件 列表 是 互通 的因 此发 布到 一个 地方 将 自 动 转发 给 另 一个
 每天有数 百个帖 子询 问和回答 问 题 建议 新 功能 以及 宣 布新模 块
邮件列 表 档 案可 在 httpsmail
orgpipermail 上 找到
 在 发 问 之 前请 务 必查 看以 下 列表 常见 问题或 简 写为 faq
常 见 问题 包含 了 很 多 一次 又一 次 问到 的问 题 及答 案并 且可能 已 经包 含 了 您 的问题 的解 决方案
备 注1 cheese  shop 是 monty  python  的一 个短 剧一 位顾客 来到 一家 奶酪商 店但 无论 他 要哪 种奶酪 店 员 都说 没有货
 命令行 与环境
cpython  解析 器 会 扫描 命令 行与环 境用于 获取各 种设 置 信息
cpython  implementation  detail  其 他 实现 的命 令行方 案 可 能有 所不同
 更 多 相 关 资源 请 参 阅其 他实 现
命 令行
对 python 发 起调 用 时你 可以 指定以 下的 任 意选 项 python  bbdehiioqssuvvwx  c  command  m  modulename  script  args  当然最 常见的 用例 就是 简单地 启动执行 一个脚 本 python  myscript
接 口 选项
通 用选 项
hhelp  打 印全 部 命令行 选项的简 短描 述
vversion 打 印 python 版本号 并退出
示例输 出 信息 如下 python 3
0 b 2 如果重 复给出 则打 印有关 构建 的更 多 信 息 例如 python 3
0201610053
6 新版 功能 vv  选 项
其 他选 项
不应 当 使用 的选 项
j 保 留给 jython  使用
 环境变 量
 调试 模 式变量
设置 这些 变 量只会在 python  的调试 版本 中产 生影 响
pythonthreaddebug 如果设 置 python 将打 印 线程调 试 信息
 需 要使 用 withpydebug 构 建选项配 置 python
pythondumprefs 如 果 设置 python  在关 闭 解 释器 及转 储对 象 和 引用计 数 后仍 将 保持 活动
 需 要使 用 withtracerefs  构 建 选 项 配 置 python
编辑 器和集 成开 发环境
 有很多 支持 python 编 程语言的 集 成开发 环境
 大多 数 编 辑 器和 集 成开 发 环境支持 语法高亮 调试 工 具和 pep 8检查
 请访问 python  editors 和 integrated  development  environments  以 获取完 整 列表
 安装和 使 用 python
这一部 分 文档专门 介绍在 不同 平台上 配置 python  环境 的一般方法 解 释器的 调用 以 及方 便使 用 python 的 技 巧
 命 令行 与环 境1
命令 行1
 接口 选 项1
通 用选 项1
其 他 选项1
不 应当 使 用的 选项1
 环境变 量1
调 试模 式变 量2
在 unix 平 台中 使 用 python 2
获 取最新 版 本 的 python 2
 在 linux 中2
 在 freebsd  和 openbsd 上2
 在 opensolaris  系 统上2
 构建 python 2
 与 python 相 关的 路径 和 文件2
 杂项3
 在 windows  上使 用 python 3
 完整 安 装 程序3
安 装 步 骤3
删除 maxpath  限制3
 无 ui 安装3
免 下 载安 装3
 修 改安 装3
 microsoft  store 包3
 已知 的 问 题3
 nuget
org  安装包3
 可 嵌入 的包3
 python  应用 程 序3
 嵌入 python 3
 替代 捆 绑包3
 配置 python 3
 附录 设 置环 境变量3
 查找 python  可 执行 文 件3
 utf 8模式3
 适用 于 windows  的 python  启动 器3
入门3
 从命 令 行3
 从虚 拟环境3
 从脚 本3
从 文件关 联3
 shebang  lines 的参数3
自 定义3
 通 过 ini  文件 自定义3
 自 定 义默认的 python  版本3
 诊断3
查 找模 块3
 附加 模块3
在 windows  上编 译 python 3
 其 他平 台4
 在苹 果 系统 上 使 用 python 4
 获取 和 安装 macpython 4
 如 何 运行 python  脚本4
 运行有 图 形 界 面的脚本4
 配 置4
 ide 4
安 装 额外 的 python  包4
 mac 上的图 形界 面编 程4
在 mac 上 分 发 python 应 用程 序4
 其他 资 源5
编 辑器和 集成 开发环境
 在 苹果 系统 上 使用 python
 作者 bob  savage  bobsavagemac
com 运 行 mac  os  x 的 macintosh  上 的 python  原则 上 与 任何 其 他 unix 平台 上的 python  非常 相似但 是还 有 一些 额外的 功能 例 如 ide  和包 管理 器值 得一 提
获取 和安 装 macpython
8附带 apple 预安 装 的 python 2
7
 如果 你愿意可 以从 python  网站 httpswww
org  安装 最新 版本 的 python 3
python 的当 前通 用二 进制版本 可 以 在 mac 的新 intel  和传 统 ppc  cpu 上 本地 运 行
 你 安装 后 得到 的东西 有会 有 一个 python 3
9 文件 夹在 你的 applications 文 件 夹中
 在 这里 你可 以找 到 idle 它 是 作为 官 方 python  发 行版 标准 组成 部分的 开发 环 境以及 pythonlauncher  它负 责处 理在 finder  中 双 击 python  脚本的 操作
 框架 libraryframeworkspython
framework  包括 python  可执 行 文 件和库
 安装 程 序将 此 位 置 添加 到 shell 路 径
 要 卸载 macpython  你 可 以 简 单 地 移 除 这 三 个 项 目
 python  可 执行 文 件 的 符 号链 接放 在 usrlocalbin 中
apple 提 供 的 python  版 本 分别 安装 在 systemlibraryframeworkspython
framework 和 usrbinpython  中
 你永 远 不 应 修 改 或删 除 这 些内 容因为 它 们由 apple  控 制并 由 apple 或 第 三方 软件 使用
 请 记住如果 你选 择从 python
org  安装 较新 的 python 版 本 那 么你 的 计算机 上将 安 装 两个 不同 但 都有用 的 python 因 此 你的路 径和 用法 与你 想要 执 行的 操作 一 致 非 常重 要
idle  包 含 一 个 帮 助 菜单 允 许 你 访 问 python 文 档
 如果您 是 python  的 新 手你 应该 开始 阅 读 该文 档 中 的教 程 介绍
 如 果你 熟悉 其 他 unix  平 台 上 的 python  那 么 你 应 该 阅 读 有 关 从 unix  shell  运 行 python  脚 本的部 分
如 何运 行 python 脚 本
 在 mac  os  x  上开始 使 用 python  的 最 佳方法 是通 过 idle  集成 开发 环境参 见 ide 部 分 并在 ide 运 行时 使用帮 助菜单
 如果要从 终端窗 口 命令行或 finder  运 行 python  脚 本首先 需要 一 个编 辑器 来创建 脚 本
 mac  os  x  附 带了许 多 标 准 的 unix  命 令 行 编 辑 器 如 vim  和 emacs 
 如 果你 想要 一 个更 mac  化的 编 辑 器 那么 programbbedit  或来自 bare  bones  software 的 textwrangler  参见 httpwww
html  是 不 错 的选 择 就 如 textmate  参见 httpsmacromates
com 
 其 他 编 辑器 包 括 programgvim  httpmacvimdev
iomacvim  和 aquamacs  httpaquamacs
org 
要 从终端窗 口 运 行 脚 本必须确 保 fileusrlocalbin 位于 shell  搜索 路径 中
 要从 finder  运 行 你 的脚 本 你 有 两个 选择 把脚 本拖拽 到 pythonlauncher  选 择 pythonlauncher 作 为通过 finder  info 窗口 打 开 脚 本 或任 何
py  脚 本 的 默 认 应 用 程 序 然 后 双 击 脚 本
 pythonlauncher 有 各 种 首 选 项 来 控 制 脚 本 的启 动 方式
拖 拽 方 式允许你 为一 次调用更改 这些 选 项或使用 其首 选 项菜 单 全 局更改 内容
运 行 有 图形 界面 的 脚本
 对 于旧 版本 的 python  你需要注 意 一个 mac  os  x  的怪 异 之 处与 aqua  窗口管 理 器通 信的程 序换而 言之 任何 具有图形 界 面 的程 序 需 要 以 特 殊方式运行
 使用 pythonw  而不 是 python 来启动这 样的 脚 本
对 于 python 3
9 你可 以使 用 python  或者 pythonw
 配置
os  x  上 的 python  遵 循所有标准的 unix 环 境 变量例 如 pythonpath 但 是 为 finder  启 动的 程序 设置 这些 变 量是 非标准的因 为 finder  在 启 动 时不 读取 你的
profile  或
cshrc 
你 需要 创建一个文 件
plist 
有关详 细信 息请 参阅 apple 的 技术 文 档 qa 1067
更 多 关于在 macpython 中 安装 python  包的 信息参阅 安装 额外 的 python 包部分
ide
macpython 附 带标准的 idle  开发 环境
有 关使用 idle 的详 细 介 绍请 访 问 httpwww
html 
安 装额外的 python 包
 有几个 方 法 可以 安 装额 外 的 python  包 可 以 通过 标准的 python  distutils 模 式 python  setup
py  install 安装 软 件包
 许 多 包 也 可 以 通 过 setuptools  扩展 或 pip 包 装器安 装 请参 阅 httpspip
io 
mac 上 的图形 界面 编 程
 使用 python  在 mac 上 构 建 gui  应用 程序 有 多种选择
pyobjc  是一个 python 到 apple  的 objectiveccocoa 框 架 的 绑定这 是 大多数 现代 mac  开发 的基 础
有 关 pyobjc  的 信息 请访 问 httpspypi
 标准 的 python  gui 工具 包是 tkinter  基于 跨平 台 的 tk 工 具包 httpswww
tk 
 apple 的 os  x  捆绑 了 aqua 原 生版本的 tk 最 新版 本 可 以从 httpswww
com 下 载和 安 装它 也可以从源 代码 构 建
wxpython  是另 一种流行的 跨 平台 gui 工 具包可 在 mac  os  x 上 本 机运 行
软件包和 文档可从 httpswww
org  获得
pyqt 是 另一 种 流行 的跨 平台 gui 工 具包 可在 mac  os  x 上 本机 运行
更 多信 息可在 httpsriverbankcomputing
comsoftwarepyqtintro  上 找到
 在 mac 上分 发 python 应 用 程 序
在 mac  上部署独 立 python 应用 程序 的标 准工 具 是 py 2 app 
 有关 安装 和使用 py 2 app  的更多 信息 请访 问 httpundefined
orgpythonpy 2 app 
 其 他资 源
macpython  邮件 列表是 mac  上 python 用户和开 发人员的优 秀 支持 资 源 httpswww
orgcommunitysigscurrentpythonmacsig 另 一个有 用的 资源是 macpython  wiki  httpswiki
在 unix 平 台 中 使用 python
 获取 最新版本的 python
 在 linux 中
python  预 装在 大 多 数 linux  发行版上 并作 为一 个 包提 供给 所有其 他 用户
 但是您 可 能想 要 使用 的某些 功能 在发 行版 提供的 软件 包中 不 可用
 这时 您 可以 从源 代码 轻松 编 译最 新版 本的 python
 如果 python  没 有预 先安 装并 且不在 发行 版 提供 的库 中您 可 以 轻 松 地为 自己使用的 发行 版创 建 包
 参阅 以下 链 接参 见 httpswww
html 对 于 debian 用 户 httpsen
orgportalpackaging 对 于 opensuse  用 户 httpsdocsold
html  对 于 fedora  用户 httpwww
html  对于 slackware  用户
在 freebsd  和 openbsd 上
 freebsd  用户 使用 以 下 命 令 添 加包 pkg  install  python 3 openbsd 用户 使用 以下 命 令添 加包 pkgadd  r  python  pkgadd  ftpftp
tgz  例如 i 386 用 户 获 取 python 2
1 的 可 用 版 本 pkgadd  ftpftp
 在 opensolaris  系 统上
 构建 python
 如 果你想自己 编译 cpython 首 先要 做的是获 取 source 
 您可 以下 载最 新版 本的源 代 码 也可 以直 接 提 取 最新 的 clone 
如果 你想 要 制 作补 丁则需 要克隆 代码
 构建 过程 由 常 用命 令组成
configure  make  make  install  特定 unix  平台 的配 置选 项和注意事项通 常记 录 在 python  源代 码的 根 目录 下的 readme
rst  文件中
警告 make  install  可 以覆 盖 或伪 装 python 3二 进制 文件
 因 此建 议使 用 make  altinstall 而 不是 make  install  因 为 后 者 只 安 装了 execprefixbinpythonversion 
与 python 相关 的路 径和 文 件
杂 项
 在 windows 上 使用 python
 本文 档 旨在 概述 在 microsoft  windows 上 使用 python 时 应了 解的 特定 于 windows 的 行 为
与 大 多 数 unix  系统 和 服 务不 同 windows 系 统没 有预 安 装 python
多年 来 cpython  团队已经编 译了 每 一个 发 行 版 的 windows  安装 程 序 msi  包 已 便 windows  用 户 下 载 和 安 装
 这 些安 装 程 序 主要 用 于每 个用 户单 独安 装 python  时添 加核心 解释 器 和库
 安 装程 序还 可以 为 一台 机 器 的所 有用 户安装并 且 可 以 为 应 用程 序本地 分发 提供 单 独的 zip  文 件
 如 pep 11中所述 python  仅支 持微软产 品 支 持生 命周期 内的 windows  版 本
这 意味 着 python 3
9 支 持 windows  vista 和更 新版 本
 如果 需要 windowsxp  支持 请安装 python 3
windows 提 供 了许 多不同 的安装 程 序 每个 安 装程 序都有 一定 的优 点和 缺 点
 完整 安装 程序内 含所 有 组件 对于 使 用 python  进行 任何 类型项 目的 开发 人员 而言它 是最 佳 选择
microsoft  store  包是 一个 简 单的 python 安装 适 用于 运行 脚本 和 包以及使 用 idle 或 其他 开发 环 境
它需 要 windows 10 但可 以 安 全地 安装 而 不 会 破坏 其他程序
 它 还提供 了许 多 方 便的 命 令来启动 python  及其工 具
nuget
org 安 装包是 用于 持续 集成 系 统的轻 量 级 安装
它 可用于构建 python  包或运行 脚 本 但 不可 更 新且 没有 用 户界 面 工具
 可嵌入 的包是 python  的 最小 安装 包适 合嵌 入到 更 大的应 用程 序 中
完 整安 装程 序
安 装 步骤
四 个 python 3
9安 装程 序可 供下 载32 位 和64位 版本 的各 有两 个
 webinstaller  网络安 装 包 是一 个小的 初始化 工具 它将 在安 装过 程中 根 据 需 要 自 动 下 载所需 的组 件
 offline  installer 离线 安装 包内 含默 认安 装 所需 的 组件 可选 择功 能仍需 要 internet 连接 下载
请 参 阅 免下 载 安装 以了解在 安 装 过程 中避 免下载 的其他 方 法
启 动安装 程 序后 可以 选 择 以下两个 选 项之 一图 片 如 果 选 择 install  now 立即 安 装您 不需要 成 为管 理员除非 需要 对 c 运 行库 进行系 统更 新或者 为所有 用户 安 装适 用于 windows  的 python  启动 器 python 将安装 到 您的 用户 目 录中适 用于 windows 的 python 启动 器将 根 据第 一页 底部的 选 项 安 装将 安装 标准库 测试套 件 启动 器 和 pip  如果 选择 将安装 目录 将 添 加 到 path  快捷 方式 仅对 当前 用户 可 见 选 择自 定义 安装 将 允许 您选 择要 安装 的功 能、安 装 位置、其他 选项 或 安装 后的操 作
 如果 要安 装 调 试符号 或 二 进制 文件 您需 要使用 此选项
如 要为 全部用 户 安装应选 择自定 义 安装
在这 种情 况下您可 能需要提供 管理 凭据 或批准 python  将 安装 到 program  files 目 录中 适 用 于 windows 的 python  启动 器将 安装 到 windows 目 录中 安 装期 间 可以选 择可 选功 能标 准库 可以 预 编 译为 字 节 码如 果选 中 安装 目 录 将添 加 到系 统 path  快捷 方式所有 用 户可 用
 删除 maxpath 限 制
 历史 上 windows 的 路径 长度 限制 为260 个字 符
 这 意 味 着长 于此的 路 径将 无法 解 决并导致 错 误
在 最 新版 本的 windows 中 此限 制可被扩 展到大 约32000个字 符
但需 要让管 理 员激活启 用 win 32长 路径 组策 略或在 注册 表键 hkeylocalmachinesystemcurrentcontrolsetcontrolfilesystem 中 设置 longpathsenabled 为1
 这允 许 open  函数 os 模 块和 大多 数 其他 路 径 功 能 接受 并 返回 长 度 超 过260 个字符 的 路 径
更 改上 述 选 项后无需 进一 步配 置
在3
6版 更改 python  中 启 用 了对长 路径 的 支持
 无 ui  安 装
 免下 载安装
由 于 下 载的 初 始安装包 中未 包含 python  的某 些可 选功 能如果选择 安装 这些功能 可 能需 要 internet 连 接
 为了 避 免这种需 要 可 以 按需 下 载所 有 可能 的组件 以 创 建一个完整的 布局该布 局将不 再 需 要 internet 连 接而不 管所 选择的 特性是什 么
 请注 意 此 下载可 能 比要求的 要大 但是 如 果要执行 大 量安装 则拥 有 本 地缓 存​​的 副 本 非常 有 用
从 命 令 提示符 执 行 以下命令 以下载 所 有可能 的必需文 件
 请 记得要 将 python 3
exe  替换 为安装程 序的 实 际 名 称并在 单独的 目 录 中创 建子目录 以避免 同名文件间 的冲 突
exe  layout  optional  target  directory  您 也可 以指定 quiet  选项 来隐藏 进度显 示
修改 安 装
microsoft  store 包
3
2 新版 功能
microsoft  store 包 是 一个易 于 安装的 python  解释器 主 要 用于交 互 式使 用例如 学生
要 安 装软件 包请确 保您 拥有 最新 的 windows 10更新并 在 microsoft  store  应用程 序中搜索 python 3
9
 确保 您选择 的应用程 序由 python  softwarefoundation 发布 并安 装
警 告 python 将始 终在 microsoft  store  上免 费 提供
如 果 要求您 付款则 表 示您没有 选择正确 的包
 安装完成 后可以 在开始菜 单中 找 到 它来启动 python
 或者可以 在 命令 提示 符或 powershell 会话 中 输入 python  来启动
此 外可以 输入 pip 或 idle 来 使用 pip  和 idle
idle 也在开 始菜 单中
 所 有这 三 个 命令 也可以使用 版本 号 后缀 例如 python 3
exe  和 python 3
exe  以 及 python
exe 其中3
x 是您 要 启 动的特 定版 本例 如3
9
在设 置主页 应用和 功能 页 面中 点选管 理可 选功能 选 择与每个 命 令关 联的 python 版本
 建议 确保 pip  和 idle 与 选 择 的 python 版 本一致
 可以 使 用 python  m  venv  创 建虚 拟环 境 并激活并 正常使 用
如 果你 已经安 装了另一个 版 本的 python  并将 它 添加 到你 的 path 变 量中 那么 它将 作 为 python
exe 而不 是来 自 microsoft  store  的 那个
要 访问新安 装请使用 python 3
exe  或 python 3
exe 
py
exe  启动器将 检 测此 python 安 装 版但 会优先使 用来 自 传统安装 器 的安 装版
要 删 除 python  请打 开 设置并 使用应用 程序 和功能 或者在 开始中找 到 python  然 后右 键单 击以 选 择卸载
 卸载将删 除该 已安 装 python 程序 中 的所 有软 件 包但 不会 删除 任 何虚拟环境
已 知的问 题
 由于 microsoft  store 应 用程序 的 限制 python  脚 本可能无 法对 共享位置 如 temp  和 注册 表 进 行完全写 入 访问
 相反它将 写入 私人副 本
如 果 脚本必须 修改共 享位置 则需 要安 装完 整安 装 程序
nugetorg  安装 包
3
2新 版功能
nuget
org  是 一 个精简的 python  环境 用 于 在没 有全 局安 装 python 的 系统的 持续 集 成和构建
 虽然 nuget  是
net 的包 管 理器但 是对于 包 含构 建时工具 的 包来 说它 也 可以很好 地工作
访 问 nuget
org  获取有 关使 用 nuget 的 最新 信息
 下面 的摘 要对 python  开发人 员来说已 经足 够了
  nuget
exe  命令 行 工 具可 以直 接 从 httpsaka
msnugetclidl 下 载 例 如使 用 curl  或 powershell
 使 用 该工具 安装64位 或32 位 最 新 版本的 python  nuget
要 选择特 定 版本 请添 加 version 3
y 
输 出目录可 以 从
更 改包 将安装 到子 目录中
 默认 情况 下 子 目 录 的 名称与 包的 名 称相 同如 果没 有 excludeversion 选项 则此 名称将包 含 已安 装的 特定 版本
子 目 录里 面 是 一个 包含 python 安装 的 tools  目录 without  excludeversion 
2通 常 nuget  包不可升 级 应该 平 行 安装较 新 版本 并使用 完整 路径引 用
或 者 手动删 除程序包 目录 并再 次安 装
如果 在构 建 之 间 不保 留文 件许多 ci 系 统将 自动 执 行此操 作
 除 了 tools  目录外还 有一 个 buildnative 目 录
 它 包含一个 msbuild  属性 文件 python
props  可以 在 c 项 目 中使 用 该文 件来引 用 python  安装
包 含 这 些设 置将自 动在 生成 中使 用标 头和 导入库
nuget
org  上的 包 信息页 是 www
orgpackagespython 对 于64位 版本和 www
orgpackagespythonx 86 表 示32位 版本
 可 嵌入 的包
python  应用 程 序
嵌 入 python
用 本地 代码 编 写的 应用 程序通常 需 要 某种形 式的 脚本语 言嵌 入式 python  发 行版 可以 用 于此目 的
通常 应用 程 序的大部 分都是 本机代码 某 些部分 将调用 python
exe  或直 接 使 用 python 3
dll 
无论是 哪种情 况将 嵌入 的发行版解 压 缩 到 应用程序安 装的 子目 录中 就足 以提 供可加 载的 python 解 释器
 与 应 用 程 序 使用 一 样包 可以 安 装 到 任何位置 因 为在 初始 化 解释器之前 有 机会 指 定搜 索 路径
否 则使 用 嵌 入 式发行 版 和 常规 安装之间 没有根本 区别
 替 代捆绑 包
除 了 标 准的 cpython 发行 版之外 还有 一 些包含 附 加 功能 的修 改包
以下 是热 门版本 及其 主要 功能的 列表 activepython  具有 多平 台兼 容 性 的 安 装 程序 文档 pywin 32 anaconda  流行的科 学模块 如 numpyscipy  和 pandas  和 conda 包 管 理器
canopy 具有 编 辑 器和 其他 开 发工 具 的 全面 的 python 分 析环 境
winpython  特 定于 windows  的 发行 版 包含 用于 构建 包的预构建 科学包 和工具
请 注意 这些软 件包 可能 不包 含 最 新版本的 python  或 其他库并 且 不由 核心 python  团队 维护或支 持
配 置 python
要 从命 令 提 示符 方便 地运 行 python 您 可以 考 虑在 windows 中更 改一 些默 认环 境变 量
 虽 然安 装程序提 供 了为您配 置 path 和 pathext  变量的选 项但这仅 适 用 于单版 本、 全局安装
 如果 您经常 使用多个 版 本 的 python 请考虑 使用 适用 于 windows 的 python 启动 器
 附 录设 置环 境变量
 查找 python  可 执行文 件
 在3
5 版 更 改
除 了使 用自 动 创建 的 python  解释 器 的 开始 菜 单项 之 外 您可 能 还 想在 命令 提示符 下启 动 python
安装程 序有 一 个选 项可以 为您 设置
 在 安 装程序 的第 一页上可 以 选 择标 记为将 python  添加到 环境变 量的 选项以 使安 装 程 序将 安装位置添 加到 path 
 还添加 了 scripts  文件 夹的位置
 这允许你 输 入 python  来运 行解 释器 并且 pip 用 于包 安装 程序
因此 您还 可以 使用 命 令行选 项执 行脚本 请参阅命 令行 文档
 如果 在 安装 时未启 用此 选 项则始终 可 以重 新运行 安装 程序选 择修 改并 启用 它
或者 您可 以 使 用 附录设 置 环 境 变 量的 方 法手 动修 改 path 
 您需要 将 python 安装目 录添 加到 path 环 境变 量 中该 内容 与 其他 条目 用 分号 分隔
示 例 变量 可 能 如下 所 示假 设 前两个 条目 已经存在 cwindowssystem 32 cwindowscprogram  filespython 3
utf 8 模式
 适用于 windows  的 python 启 动 器
3
3 新 版功能
 用于 windows  的 python  启 动 器是 一个实 用程 序可 帮助 定位 和 执行 不 同的 python  版本
 它 允 许 脚本 或 命 令行指 示特 定 python 版本 的 首选项 并将定位 并执 行该 版 本
与 path  变量不 同启 动器将 正确 选择 最合 适 的 python 版本
 它更 倾向 于按用 户安装 而 不是系 统安 装并 按语 言 版 本 排序 而不 是使 用最 新 安装 的版本
启 动 器最 初是 在 pep 397 中指 定的
入 门
shebang  lines
shebang  lines 的参 数
shebang  lines 还 可 以指 定 要传 递给 python  解释 器 的其 他选 项
例 如 如果你有 一 个 shebang  lines  usrbinpython  v 然 后 python 将 以 v 选 项 启 动
自 定义
 诊断
 查找模块
 附加 模块
 尽 管 python 的 目标 是在 所有平 台中 都可 移 植 但是 windows 有 一 些独 特 的特性
 在 标准 库和外 部 都有 一些模 块 和 代码 片 段在使 用 这 些特 性
特 定于 windows 的 标准 模块 记录 在 windows 系 统相关 模块 中
pywin
mark  hammond 的  pywin 32模 块是 一组 用于高 级 windows 特 定支 持的模 块
这包括 以下 实用 程 序组 件 对 象 模 型 com  win 32 api 调用 注册 事件 日志 microsoft  foundation  classes  mfc 用 户界面 pythonwin  是 pywin 32附 带 的一 个 示 例 mfc 应 用程序
它 是 一 个内 置调试 器 的 可 嵌入 ide
 参 见 win 32 how  do  i
 tim  golden 著 python  and  com  david  和 paul  boddie 著
cxfreeze
cxfreeze 是 一个 distutils 的扩 展参见扩 展 distutils 它 将 python 脚 本包 装 成可 执行的 windows 程 序
exe  文件
 完 成 此 操 作 后您 可以 分 发 应 用 程 序而 无 需用 户 安 装 python
wconio
由 于 python 的 高 级终 端 处理层 curses  仅限 于 类 unix 系 统 因 此 windows 还有 一个 独立 的库用 于 python 的 windows  控制 台 io 
wconio 是 turboc  的 conio
h 装 饰器 用于 创 建文本 用户 界面
在 windows 上 编 译 python
 其 他 平台
 随着 python  的 不断发 展不再支 持以前 曾经 支持 的 一 些 平 台由 于缺 少 用户 或 开发 人员
 检查 pep 11了解 所 有 不支持的 平 台 的 详 细 信 息
 windows  ce 仍然 受 支持
 cygwin  安 装包也 提供 安装 python 解释 器 cf
 cygwin  package  source  maintainer  releases 有 关具 有 预 编译安 装 程 序 平台的 详 细信 息请参 阅 python  for  windows
python 20 有 什么 新变化
 作者 a
 kuchling 和 moshe  zadka
 概 述
what  about  python 16
 新开发 流 程
unicode
 列表推 导 式
augmented  assignment
字符 串 的 方法
garbage  collection  of  cycles
 其 他 核 心变化
minor  language  changes
changes  to  builtin  functions
 移植 python
 扩展 嵌入 更改
distutils  使 模块 易于 安 装
xml 模 块
sax 2 support
dom  support
relationship  to  pyxml
 模 块 更 改
新 增模块
idle 改 进
删除 和弃 用的 模块
 致 谢
作者 感谢以 下人 士对本文 的 各 种 草稿 提 出建议 david  bolen  mark  hammondgregg  hauser  jeremy  hylton  fredrik  lundh  detlef  lannert  aahzmaruch  skip  montanaro  vladimir  marangozov  tobias  polzin  guido  vanrossum  neil  schemenauer  and  russ  schmidt
python 21 有 什么 新 变化
 作者 a
 概述
python 2
1 的最 终 版本于2001 年4月17日 发布
pep 227 nested  scopes
 参见 pep 227 statically  nested  scopes  由 jeremy  hylton 撰 写 并实 现
pep 236 future  directives
 参见 pep 236 back  to  the  future 由 tim  peters  撰 写主 要由 jeremy  hylton 实 现
pep 207 rich  comparisons
 the  new  magic  methodnames  are  运 算 方法 名 称 lt  le  gt  ge  eq  ne  the  magic  methods  are  named  after  the  corresponding  fortran  operators
参见 pep 207 rich  comparisons  written  by  guido  van  rossum  heavily  based  on  earlier  work  by  david  ascher  and  implemented  by  guido  van  rossum
pep 230 warning  framework
 参见 pep 5 guidelines  for  language  evolution  written  by  paul  prescod  to  specify  procedures  to  be  followed  when  removing  old  features  from  python
 pep 230 warning  framework  由 guido  van  rossum  撰 写并实 现
pep 229 new  build  system
 参 见 pep 229 using  distutils  to  build  python 由 a
 kuchling  撰 写 并实 现
pep 205 weak  references
referenceerror  参 见 pep 205弱 引用 由 fred  l
 drake  jr 撰 写 并 实 现
pep 232 function  attributes
参见 pep 232 function  attributes  由 barry  warsaw 撰 写并 实现
pep 235 importing  modules  on  caseinsensitive  platforms
pep 217 interactive  display  hook
pprint  l 123 recursion  on  list  with  id 135143996 参见 pep 217 display  hook  for  interactive  use  由 moshe  zadka  撰写 并 实现
pep 208 new  coercion  model
参见 pep 208 reworking  the  coercion  model  written  and  implemented  by  neil  schemenauer  heavily  based  upon  earlier  work  by  marcandr é lemburg
pep 241 metadata  in  python  packages
 参 见 pep 241 metadata  for  python  software  packages  由 a
 kuchling  撰 写并 实现
新 增 和 改 进的 模块
other  changes  and  fixes
 致谢
作 者感 谢以 下 人 员对 本文 的 各 种草 案提 出建 议 graeme  cross  davidgoodger  jay  graves  michael  hudson  marcandr é lemburg  fredriklundh  neil  schemenauer  thomas  wouters
python 22 有什 么新 变 化
 作 者 a
概 述
peps 252 and 253 type  and  class  changes
old  and  new  classes
descriptors
multiple  inheritance  the  diamond  rule
attribute  access
related  links
pep 234 iterators
参 见 pep 234 iterators  由 kaping  yee 和 gvr 撰写 由 python  labs 小组主 要由 gvr 和 tim  peters  实 现
pep 255 simple  generators
参 见 pep 255简 单 生 成器 written  by  neil  schemenauer  tim  peters  magnus  lie  hetland
pep 237 统一 长整 数 和 整 数
pep 238 changing  the  division  operator
unicode  changes
参 见 pep 261 support  for  wide  unicode  characters  written  by  paul  prescod
pep 227 nested  scopes
 参见 pep 227 statically  nested  scopes 由 jeremy  hylton  撰写并 实 现
 新增 和 改 进 的 模块
interpreter  changes  and  fixes
other  changes  and  fixes
 致谢
 作 者感 谢 以下 人员 为本 文的 各种 草案 提供 建 议更 正 和帮助 fred  bremmerkeith  briggs  andrew  dalke  fred  l
 carel  fellinger  davidgoodger  mark  hammond  stephen  hansen  michael  hudson  jack  jansenmarcandr é lemburg  martin  von  l ö wis  fredrik  lundh  michael  mclaynick  mathewson  paul  moore  gustavo  niemeyer  don  odonnell  joonaspaalasma  tim  peters  jens  quade  tom  reinhardt  neil  schemenauerguido  van  rossum  greg  ward  edward  welbourne
python 23 有 什 么新 变化
 作 者 a
pep 218 a  standard  set  datatype
pep 255 simple  generators
参 见 pep 255简单生 成器 written  by  neil  schemenauer  tim  peters  magnus  lie  hetland
pep 263 source  code  encodings
参 见 pep 263 defining  python  source  code  encodings 由 marcandr é lemburg  和 martin  von  l ö wis 撰 写由 suzuki  hisao  和 martin  von  l ö wis 实 现
pep 273 从 zip  压 缩包导入 模块
参 见 pep 273  从 zip  压 缩包导 入模块 written  by  james  c
pep 277 unicode  file  name  support  for  windows  nt
参 见 pep 277 unicode  file  name  support  for  windows  nt  由 neil  hodgson 撰 写由 neil  hodgson  martin  von  l ö wis  和 mark  hammond 实 现
pep 278 通 用 换行支 持
参见 pep 278通 用换 行支持由 jack  jansen  撰 写 并实 现
pep 279 enumerate
 li  result 可 以使 用 enumerate 重 写为 for  i  item  in  enumeratel 
 li  result 参见 pep 279 内 置函 数 enumerate 由 raymond  d
 hettinger  撰写并 实现
pep 282 logging 包
参 见 pep 282 logging 系 统 由 vinay  sajip  和 trent  mick 撰写由 vinay  sajip  实 现
pep 285布 尔 类 型
参 见 pep 285添 加布 尔类型 由 gvr  撰写 并实 现
pep 293 codec  error  handling  callbacks
参见 pep 293 codec  error  handling  callbacks 由 walter  d ö rwald  撰 写并实 现
pep 301 distutils 的 软件 包 索引 和元数 据
参 见 pep 301 distutils 的软件 包 索引 和元数据 由 richard  jones 撰 写并 实现
pep 302 new  import  hooks
pep 305 逗 号 分隔文 件
参见 pep 305 csv 文 件 api 由 kevin  altis  dave  cole  andrew  mcnamara  skip  montanaro  cliff  wells  撰写并实 现
pep 307 pickle  enhancements
参 见 pep 307 extensions  to  the  pickle  protocol  pep  由 guido  van  rossum 和 tim  peters  撰写 和实 现
扩 展切 片
 其他语言 特 性 修 改
 two  new  constants  true  and  false  were  added  along  with  the  builtin  bool  type  as  described  in  section  pep 285布尔 类型 of  this  document
 builtin  types  now  support  the  extended  slicing  syntax  as  described  in  section 扩展 切片 of  this  document
 also  the  dict  constructor  now  accepts  keyword  arguments  to  simplify  creating  small  dictionaries  dictred 1 blue 2 green 3 black 4 blue 2 black 4 green 3 red 1由 just  van  rossum 贡 献
 the  assert  statement  no  longer  checks  the  debug  flag  so  you  can  no  longer  disable  assertions  by  assigning  to  debug
string  changes
zfill 60 goofy 由 walter  d ö rwald 贡 献
 a  new  type  object  basestring  has  been  added
 性能 优化
 新 增改 进和 弃用 的 模块
gnugetoptf  filename  output  v  fv  f  filename  v  output 由 peter å strand  贡献
 the  grp  pwd  and  resource  modules  now  return  enhanced  tuples  import  grp  g  grp
heappopheap 3 heap 5711由 kevin  oconnor 贡 献
 the  idle  integrated  development  environment  has  been  updated  using  the  code  from  the  idlefork  project  httpidlefork
 s  seqdict  dirs  see  that  other  dictionary  methods  are  implemented  cmp  contains  delitem  doc  getitem  init  iter  len  module  repr  setitem  clear  get  haskey  items  iteritems  iterkeys  itervalues  keylist  keys  pop  popitem  setdefault  update  valuelist  values  由 raymond  hettinger 贡献
 the  dom  implementation  in  xml
datetime 类 型
optparse 模 块
py  options  options  h  help  show  this  help  message  and  exit  iinput  inputinput  set  input  filename  llength  lengthlength  set  maximum  length  of  output 有 关更 多详 细信 息 请 参 见模 块的文 档
pymalloc  a  specialized  object  allocator
 参见 httpshg
 构建 和 c  api  的 改 变
portspecific  changes
other  changes  and  fixes
移 植到 python
 致谢
 作 者 感 谢 以 下 人 员 为本 文 的 各种草案 提供建 议更正 和帮 助 jeff  bauersimon  brunning  brett  cannon  michael  chermside  andrew  dalke  scottdavid  daniels  fred  l
 david  fraser  kelly  gerberraymond  hettinger  michael  hudson  chris  lambert  detlef  lannertmartin  von  l ö wis  andrew  macintyre  lalo  martins  chad  netzer  gustavoniemeyer  neal  norwitz  hans  nowak  chris  reedy  francesco  ricciardivinay  sajip  neil  schemenauer  roman  suzi  jason  tishler  just  vanrossum
python 24有 什么新 变化
 作 者 a
 kuchling 本文介绍 了2005年3月30日 发 布 的 python 2
1的 新功 能
pep 218内置集 合 对象
 参 见 pep 218 添 加内置 set  对象 类 型最 初由 greg  wilson  提出 由 raymond  hettinger 最终实现
pep 237 统一长整 数 和整 数
pep 289生 成器表达 式
代替 for  link  in  getalllinks  if  link
 参 见 pep 289 生 成 器表 达 式 proposed  by  raymond  hettinger  and  implemented  by  jiwon  seo  with  early  efforts  steered  by  hyeshik  chang
pep 292 simpler  string  substitutions
safesubstitutepage 33 title  参见 pep 292 simpler  string  substitutions 由 barry  warsaw  撰写 并 实 现
pep 318 decorators  for  functions  and  methods
 参见 pep 318 decorators  for  functions  methods  and  classes  written  by  kevin  d
orgmoinpythondecoratorlibrary  该 wiki  页 面 包 含几 个装饰 器示 例
pep 322 反向迭 代
 参见 pep 322反向 迭代由 raymond  hettinger  撰写 并实现
pep 324新 的子进程模 块
参 见 pep 324 子 进程新 的 进程 模块由 peter å strand  在 fredrik  lundh 等 人的协 助下撰 写并实 现
pep 327十进制 数据类 型
为什 么 需要 十进制？
 因此 创建了 decimal  类型
decimal 类 型
context 类 型
 参见 pep 327 十 进 数据 类 型由 facundo  batista  撰写 由 facundo  batista  eric  price  raymond  hettinger  aahz  和 tim  peters  实现
pep 328 多行 导入
pep 331 localeindependent  floatstring  conversions
 参 见 pep 331 localeindependent  floatstring  conversions 由 christian  r
 reis 撰 写由 gustavo  carneiro 实 现
其他 语 言 特 性 修 改
 black 4 blue 2 green 3 red 1 yellow 5 由 raymond  hettinger 贡 献
 integer  operations  will  no  longer  trigger  an  overflowwarning
 transpose 123456142536 transpose 由 raymond  hettinger  贡献
 encountering  a  failure  while  importing  a  module  no  longer  leaves  a  partiallyinitialized  module  object  in  sys
 性 能 优化
 新 增 改进 和弃 用 的 模块
cookielib
 该模 块 由 john  j
 lee 贡 献
doctest
构 建和 c  api  的改 变
portspecific  changes
移 植 到 python
致 谢
作者 感 谢以 下 人 员对本 文各种 草稿给 予 的建 议更 正和协 助 koray  can  hyeshik  chang  michael  dyck  raymond  hettinger  brian  hurt  hamishlawson  fredrik  lundh  sean  reifschneider  sadruddin  rejeb
python 25 有什 么新变化
 作者 a
 conditional  expressions  were  finally  added  to  the  languageusing  a  novel  syntax  see  section  pep 308 条 件 表达式
 the  newwith  statement  will  make  writing  cleanup  code  easier  section  pep 343 with  语句
 values  can  now  be  passed  into  generators  sectionpep 342生 成 器的新 特性
 imports  are  now  visible  as  either  absoluteor  relative  section  pep 328绝 对 导 入和 相对导 入
 some  corner  casesof  exception  handling  are  handled  better  section  pep 341 统一 tryexceptfinally
pep 308条件 表 达式
pep 309 部分功 能应 用
这 里 有 一个很小 但 很现 实的 例 子 import  functools  def  log  message  subsystem  write  the  contents  of  message  to  the  specified  subsystem
wrapsf  def  wrapperargs  kwds  print  calling  decorated  function  return  fargs  kwds  return  wrapper 参见 pep 309 partial  function  application  pep  由 peter  harris 提 出并 撰写 由 hyeshik  chang 和 nick  coghlan  实现并 由 raymond  hettinger 适配
pep 314 python  软件 包的 元 数据 v
 参见 pep 314 python 软件 包的元 数据 v 1
1 pep  由 a
 kuchling  richard  jones 和 fred  drake  提 出 并 撰写 由 richard  jones 和 fred  drake  实 现
pep 328绝对导 入和 相 对导 入
参 见 pep 328导 入 多行和 绝对 相 对导 入 pep  由 aahz 撰写 由 thomas  wouters 实 现
pep 338将 模块 作为 脚本执 行
参 见 pep 338将 模块作 为 脚 本执 行 pep 由 nick  coghlan  撰写 并实 现
pep 341统 一 tryexceptfinally
参见 pep 341统一 tryexcept 和 tryfinally  pep  由 georg  brandl 撰 写由 thomas  lee 实 现
pep 342生成 器的 新特 性
 这 些 改变的 累积 效 应 是让 生成 器从单向的 信 息生 产 者变成 了既 是生产 者又 是消费 者
参见 pep 342通 过 增强型 生 成器 实 现协 程 pep 由 guido  van  rossum  和 phillip  j
 eby 撰写由 phillip  j
 eby  实现
 包括一些更高 级的 使用生 成器作 为 协程 的 示 例
 这些 功能 的早 期 版本在 pep 288由 raymond  hettinger 撰 写 和 pep 325 由 samuele  pedroni  撰 写 中提 出
orgwikicoroutine 协 程的 wikipedia  条目
pep 343 with 语句
5 you  need  to  add  the  followingdirective  to  your  module  from  future  import  withstatement  该语 句在 python 2
6 中始 终 启用
 注 解 in  this  case  f  is  the  same  object  created  by  open  because  file
writing  context  managers
contextlib  模块
writeline 参 见 pep 343 with 语 句 pep  written  by  guido  van  rossum  and  nick  coghlan  implemented  by  mike  bland  guido  van  rossum  and  neal  norwitz
 contextlib  模块 的 文 档
pep 352异 常作 为新型的 类
参见 pep 352 异 常所 需的超 类 pep 由 brett  cannon  和 guido  van  rossum 撰 写由 brett  cannon  实 现
pep 353使用 ssizet  作 为 索 引类型
参 见 pep 353使 用 ssizet  作为 索引 类 型 pep 由 martin  von  l ö wis 撰 写 并 实现
pep 357 index 方 法
 参 见 pep 357 允许 将任 何对象 用 于切片 pep  由 travis  oliphant 撰 写 并实 现
其 他语言 特性 修改
 几 个例 子 httpwww
 for  example  to  find  the  longest  string  in  a  list  you  can  do  l  medium  longest  short  prints  longest  print  maxl  keylen  prints  short  because  lexicographically  short  has  the  largest  value  print  maxl 由 steven  bethard  和 raymond  hettinger 贡 献
 two  new  builtin  functions  any  and  all  evaluate  whether  an  iterator  contains  any  true  or  false  values
由 marcandr é lemburg 实现
 one  error  that  python  programmers  sometimes  make  is  forgetting  to  include  an  init
 as  an  example  this  is  now  legal  class  c  pass  由 brett  cannon 实 现

交 互解 释 器 变 更
 性能 优化
 新增 改进 和删除 的 模块
ctypes 包
 参见 httpstarship
netcrewthellerctypes  ctypes  的主 页 含 教程参 考和 常见 问题 解 答
 ctypes 模 块 的文 档
elementtree 包
hashlib  包
参 见 hashlib 模 块的 文 档
sqlite 3 包
wsgiref  包
serveforever  参 见 httpwww
org  wsgi  相 关 资 源的 核心 网 站
 pep 333 python  web 服 务器 网 关接 口 v 1
0 pep 由 phillip  j
 eby  撰 写
 构 建 和 c  api 的改变
 see  the  earlier  section  pep 353 使用 ssizet 作 为索 引类 型 for  a  discussion  of  this  change
portspecific  changes
移 植 到 python
 because  of  the  pep 342 changes  described  in  section  pep 342生 成器的 新 特性 its  now  possible  for  giframe  to  be  none
 see  the  earlier  section  pep 353使用 ssizet  作为 索 引 类型 for  a  discussion  of  this  change
 致谢
作 者 感 谢以 下人 员对本 文各 种草稿 给予 的建 议更 正和 协 助 georg  brandlnick  coghlan  phillip  j
 eby  lars  gust ä bel  raymond  hettinger  ralfw
 grossekunstleve  kent  johnson  iain  lowe  martin  von  l ö wisfredrik  lundh  andrew  mcnamara  skip  montanaro  gustavo  niemeyer  paulprescod  james  pryor  mike  rovner  scott  weikart  barry  warsaw  thomaswouters
python 26 有 什么 新 变化
作 者 a
python
 参见 the 3 xxx  series  of  peps  which  contains  proposals  for  python 3
开 发过 程 的变化
new  issue  tracker  roundup
新 的文档 格式 使用 sphinx  的 restructuredtext
 参见 documenting  python  描述如何 编写 python  文档
 sphinx  sphinx  工具 链 的 文 档和 代码
 docutils  restructuredtext  的 基础 解 析 器 和 工 具集
pep 343 with  语 句
注解 in  this  case  f  is  the  same  object  created  by  open  because  file
writing  context  managers
contextlib  模块
writeline  参 见 pep 343 with 语 句 pep  written  by  guido  van  rossum  and  nick  coghlan  implemented  by  mike  bland  guido  van  rossum  and  neal  norwitz
 contextlib 模块 的文 档
pep 366 从主 模块 显式 相对导入
pep 370分 用户 的 sitepackages  目录
 参 见 pep 370分 用户的 sitepackages  目录 pep  由 christian  heimes 撰写 并 实 现
pep 371多 任务 处 理包
 参见 multiprocessing  模块 的文档
 pep 371 添加多任 务处理 包 pep 由 jesse  noller 和 richard  oudkerk 撰 写由 richard  oudkerk 和 jesse  noller 实 现
pep 3101 高 级字 符串格式
pep 3105 print  改 为 函 数
 参 见 pep 3105 print 改 为函数 pep  由 georg  brandl  撰写
pep 3110异常 处 理的 变更
参见 pep 3110 在 python 3000 中捕 获异 常 pep  由 collin  winter  撰写并 实现
pep 3112 字 节 字面 值
参见 pep 3112 python 3000 中 的字节 字面 值 pep 由 jason  orendorff  撰写补 丁2
6由 christian  heimes 撰 写
pep 3116新 io 库
 参 见 pep 3116 新 io  pep  written  by  daniel  stutzbach  mike  verdone  and  guido  van  rossum
pep 3118 修改缓 冲区 协议
 参 见 pep 3118修 改 缓冲 区 协 议 pep 由 travis  oliphant  和 carl  banks  撰写 由 travis  oliphant 实 现
pep 3119 抽象基 类
 参见 pep 3119引入 抽象基 类 pep  written  by  guido  van  rossum  and  talin
pep 3127整 型文字支 持和语法
oct 420 o 52 bin 1730 b 10101101 the  int  and  long  builtins  will  now  accept  the 0 o  and 0 bprefixes  when  base 8 or  base 2 are  requested  or  when  the  baseargument  is  zero  signalling  that  the  base  used  should  be  determinedfrom  the  string  int 0 o 52042 int 1101213 int 0 b 1101213 int 0 b 1101013 参见 pep 3127 整型 文字 支持 和语法 pep  written  by  patrick  maupin  backported  to 2
pep 3129 类装 饰器
 its  nowlegal  to  write  foo  bar  class  a  pass 这 相当 于 class  a  pass  a  foobara 参见 pep 3129类 装饰 器 pep 由 collin  winter  撰写
pep 3141 a  type  hierarchy  for  numbers
fractions 模块
其 他 语言 特性修 改
对 python  语言 核心 进 行的 小改 动 directories  and  zip  archives  containing  a  main
userdict  uda 1 udb  string  fud  a  b 由 alexander  belopolsky  在 bpo 1686487中 贡献
 its  also  become  legal  to  provide  keyword  arguments  after  a  args  argument  to  a  function  call
count 02 由 raymond  hettinger 贡 献 the  builtin  types  now  have  improved  support  for  extended  slicing  syntax  accepting  various  combinations  of  start  stop  step
difference 246789 set 1035 由 raymond  hettinger  贡献
 many  floatingpoint  features  were  added
 性能优化
interpreter  changes
 新 增 和 改 进的 模 块
由 raymond  hettinger  贡献
 another  change  to  the  collections  module  is  that  the  deque  type  now  supports  an  optional  maxlen  parameter  if  supplied  the  deques  size  will  be  restricted  to  no  more  than  maxlen  items
append 4 dq  deque 234 maxlen 3 由 raymond  hettinger 贡 献
 the  cookie  modules  morsel  objects  now  support  an  httponly  attribute
由 christian  heimes 和 mark  dickinson  贡 献
 mmap  objects  now  have  a  rfind  method  that  searches  for  a  substring  beginning  at  the  end  of  the  string  and  searching  backwards
methodcallerreplace  old  new  replacerold  wine  in  old  bottles  new  wine  in  new  bottles 由 gregory  petrosyan 提供 建议 之后由 georg  brandl  贡献
 the  attrgetter  function  now  accepts  dotted  names  and  performs  the  corresponding  attribute  lookups  instname  operator
name  instname  str  instnamehelp  helper  由 barry  warsaw 提 供建 议之 后由 georg  brandl  贡 献
 the  os  module  now  wraps  several  new  system  calls
 由 paul  moore 在 bpo 2439中 贡 献
 the  pyexpat  modules  parser  objects  now  allow  setting  their  buffersize  attribute  to  change  the  size  of  the  buffer  used  to  hold  character  data
svn  由 tarek  ziad é在 bpo 2663 中 贡 献
 integrating  signal  handling  with  gui  handling  event  loops  like  those  used  by  tkinter  or  gtk  has  long  been  a  problem  most  software  ends  up  polling  waking  up  every  fraction  of  a  second  to  check  if  any  gui  events  have  occurred
由 adam  olsen  在 bpo 1583 中 贡 献
 the  siginterrupt  function  is  now  available  from  python  code  and  allows  changing  whether  signals  can  interrupt  system  calls  or  not
warnings 1 multiple  warnings  raised  由 brett  cannon 贡献
 the  textwrap  module  can  now  preserve  existing  whitespace  at  the  beginnings  and  ends  of  the  newlycreated  lines  by  specifying  dropwhitespacefalse  as  an  argument  s  this  sentence  has  a  bunch  of 
由 dwayne  bailey  在 bpo 1581073中贡献
 the  threading  module  api  is  being  changed  to  use  properties  such  as  daemon  instead  of  setdaemon  and  isdaemon  methods  and  some  methods  have  been  renamed  to  use  underscores  instead  of  camel  case  for  example  the  activecount  method  is  renamed  to  activecount
extractall  由 alan  mcintyre  在 bpo 467924中 贡献
 the  open  read  and  extract  methods  can  now  take  either  a  filename  or  a  zipinfo  object
ast  模 块
futurebuiltins  模块
the  json  module  javascript  object  notation
plistlib  模块属 性 列表 解析器
ctypes  enhancements
improved  ssl  support
 参 见 ssl 模 块 的 文档
deprecations  and  removals
 gopherlib  模块已 被移 除
 rgbimg 模块 已被 移除
 构建和 c  api 的 改 变
特定 于 windows  的更 改
特 定 于 mac  os  x  的更 改 mac  os  x
 现 在 在编译 python  的 框架 版本时可 以为 configure 脚 本添 加 withframeworkname 选 项 来 指 定要 使 用的 框架名 称
 macfs 模 块已 被删 除
这 反过 来要 求删 除 macostools
touched 函 数因为它 依赖 于 macfs  模 块
 bpo 1490190许 多其 他 mac  os 模 块已 弃 用并 将在 python 3
0 中被 删 除 builtinsuites  aepack  aetools  aetypes  applesingle  appletrawmain  appletrunner  argvemulator  audiomac  autogil  carbon  cfmfile  codewarrior  colorpicker  easydialogs  explorer  finder  framework  findertools  ic  icglue  icopen  macerrors  macos  macfs  macostools  macresource  miniaeframe  nav  netscape  osaterminology  pimp  pixmapwrapper  stdsuites  systemevents  terminal  和 terminalcommand
特定 于 irix 的 更改
许 多 旧 的 irix 专 用模块 已被弃 用 并将 在 python 3
0中 删除 al  和 alcd  cddb  cdplayer  cl 和 cl  device  errno  filefl  和 fl  flp  fm  get  glws  gl  和 gl  in  ioctljpeg  panelparser  readcd  sv 和 sv  torgb  videoreader 和 wait
移 植到 python
 致谢
作 者 感谢 以下人员 对 本文 各种草 稿给 予 的建 议 更正 和协 助 georg  brandlsteve  brown  nick  coghlan  ralph  corderoy  jim  jewett  kent  johnsonchris  lambacher  martin  michlmayr  antoine  pitrou  brian  warner
python 27 有什么 新变化
作 者 a
ca  本文介绍 了 python 2
7的 新 功能
 python 2
7 于2010年7月3日 发 布
python 2 x 的 未来
changes  to  the  handling  of  deprecation  warnings
python 31 features
就 像 python 2
6集 成了 python 3
0 的 特 性一样2
7 版也 集成 了 python 3
1中 的一 些 新 特性
2
x 系列 继 续提 供迁 移到3
x  系列 的工 具
3
1 功能 的 部 分 列 表 这 些功 能已反向 移植 到2
7 the  syntax  for  set  literals 123 is  a  mutable  set
 the  new  format  specifier  described  in  pep 378 千位 分 隔 符的 格 式说 明符
pep 372 adding  an  ordered  dictionary  to  collections
 参 见 pep 372将有 序词典 添加 到集合 中 pep 由 armin  ronacher 和 raymond  hettinger  撰 写由 raymond  hettinger 实现
pep 378 千 位 分隔符 的格 式说明符
参见 pep 378 千位 分隔符的 格式说 明 符 pep 由 raymond  hettinger  撰写由 eric  smith 实 现
pep 389 the  argparse  module  for  parsing  command  lines
 参见 argparse  documentation  argparse  模块的文 档 页 面
升级 optparse 代 码 part  of  the  python  documentation  describing  how  to  convert  code  that  uses  optparse
 pep 389 argparse 新 的 命令 行解 析模块 pep 由 steven  bethard  撰 写并 实 现
pep 391 dictionarybased  configuration  for  logging
 for  moreinformation  see  配置 函数
 参见 pep 391 基于字 典的日志配 置 pep 由 vinay  sajip  撰写 并实 现
pep 3106 dictionary  views
 参 见 pep 3106改 造 dict
values 和
pep 3137 the  memoryview  object
 bytearraybbcde  参见 pep 3137 不变字节 和 可 变缓 冲区 pep  written  by  guido  van  rossum
其他 语 言特 性 修改
 对 python 语 言核 心 进 行的小改动 the  syntax  for  set  literals  has  been  backported  from  python 3
 相当于 with  a  as  a  with  b  as  b 
interpreter  changes
性 能优 化
 新增 和 改进 的模 块
 新模 块 importlib
这 是 一些 例子 from  importlib  import  importmodule  anydbm  importmoduleanydbm  standard  absolute  import  anydbm  module  anydbm  from  ppythonlibanydbm
 新模 块 sysconfig
ttk  themed  widgets  for  tk
 更新 的模 块 unittest
参 见 httpwww
更 新的 模 块 elementtree
 构建 和 c  api 的改变
 胶 囊
 refer  to 给 扩 展模 块提供 c  apifor  more  information  on  using  these  objects
特定 于 windows 的 更改
特 定于 mac  os  x  的 更 改
在2
13 版更 改 as  of 2
 特 定 于 freebsd 的更 改
other  changes  and  fixes
移 植 到 python
 对 于 c  扩展模块 c  extensions  that  use  integer  format  codes  with  the  pyargparse  family  of  functions  will  now  raise  a  typeerror  exception  instead  of  triggering  a  deprecationwarning  bpo 5080
 对 于嵌 入 python 的 应用程序 the  pysyssetargvex  function  was  added  letting  applications  close  a  security  hole  when  the  existing  pysyssetargv  function  was  used
new  features  added  to  python 27 maintenance  releases
two  new  environment  variables  for  debug  mode
2
15 新 版功 能
pep 434 idle  enhancement  exception  for  all  branches
pep 466 network  security  enhancements  for  python
pep 466 python 2
7中 添加的 相关 功 能 hmac
pep 466 python 2
8 中添 加 的相关 功 能 hashlib
 contributed  by  zachary  ware  in  bpo 21671 for  cve 20140224 pep 466 python 2
9 中添 加 的相 关功 能 most  of  python 3
pep 477 backport  ensurepip  pep 453 to  python
文 档更 改 as  part  of  this  change  the  安装 python  模块 and  分 发 python  模 块 sections  of  the  documentation  have  been  completely  redesigned  as  shortgetting  started  and  faq  documents
 most  packaging  documentation  hasnow  been  moved  out  to  the  python  packaging  authority  maintained  pythonpackaging  user  guide  and  the  documentation  of  the  individual  projects
however  as  this  migration  is  currently  still  incomplete  the  legacyversions  of  those  guides  remaining  available  as  安 装 python 模块旧 版 and 分 发 python 模 块遗 留 版 本
参见 pep 453 python 安 装中 pip  的显 式 引 导 pep  由 donald  stufft 和 nick  coghlan  撰写由 donald  stufftnick  coghlanmartin  von  l ö wis 和 ned  deily  实现
pep 476 enabling  certificate  verification  by  default  for  stdlib  http  clients
pep 493 适用 于 python 27 的 https  验 证 迁 移工具
new  make  regenall  build  target
由 victor  stinner  在 bpo 23404中 贡献
2
14 新版 功 能
removal  of  make  touch  build  target
 由 victor  stinner  在 bpo 23404中 贡 献
 在2
14 版更 改
 致 谢
 作者 要感 谢以 下人 员为 本文 的 各 种 草 案 提供 建议更 正 和 帮助 nick  coghlanphilip  jenvey  ryan  lovett  r
 david  murray  hugh  seckerwalker
python 30有什 么新 变 化
作者 guido  van  rossumthis  article  explains  the  new  features  in  python 3
 常见的 绊 脚石
print  is  a  function
 printthere  are 232 possibilities  sepwhich  produces  there  are 4294967296 possibilities  注意 the  print  function  doesnt  support  the  softspace  feature  of  the  old  print  statement
views  and  iterators  instead  of  lists
ordering  comparisons
 整数
text  vs  data  instead  of  unicode  vs 8 bit
 see  also  the  unicode  指 南 which  was  updated  for  python 3
overview  of  syntax  changes
 新语 法
修改的 语 法
 移除 的 语法
changes  already  present  in  python
 the  corresponding  sections  in  python 2
6有什 么新 变 化 should  beconsulted  for  longer  descriptions
 pep 343 with 语 句
 the  with  statement  is  now  a  standard  feature  and  no  longer  needs  to  be  imported  from  the  future
 also  check  out  writing  context  managers  and  contextlib 模 块
 pep 366 从 主 模 块 显式 相对 导入
 this  enhances  the  usefulness  of  the  m  option  when  the  referenced  module  lives  in  a  package
 pep 370分 用 户 的 sitepackages  目 录
 pep 371 多任 务 处 理包
 pep 3101 高级字 符串 格式
6 description  mentions  the  format  method  for  both 8 bit  and  unicode  strings
0 only  the  str  type  text  strings  with  unicode  support  supports  this  method  the  bytes  type  does  not
 the  plan  is  to  eventually  make  this  the  only  api  for  string  formatting  and  to  start  deprecating  the  operator  in  python 3
 pep 3105 print  改 为 函数
 this  is  now  a  standard  feature  and  no  longer  needs  to  be  imported  from  future
 pep 3110 异 常 处理 的 变 更
 the  except  exc  as  var  syntax  is  now  standard  and  except  exc  var  is  no  longer  supported
 of  course  the  as  var  part  is  still  optional
 pep 3112 字节 字 面 值
 string  literal  notation  and  its  variants  like  b
 now  produces  a  literal  of  type  bytes
 pep 3116 新 io  库
 the  io  module  is  now  the  standard  way  of  doing  file  io
 the  builtin  open  function  is  now  an  alias  for  io
 pep 3118 修 改 缓冲 区协 议
 the  old  builtin  buffer  is  now  really  gone  the  new  builtin  memoryview  provides  mostly  similar  functionality
 pep 3119 抽 象基 类
 the  abc  module  and  the  abcs  defined  in  the  collections  module  plays  a  somewhat  more  prominent  role  in  the  language  now  and  builtin  collection  types  like  dict  and  list  conform  to  the  collections
 pep 3127整 型文 字 支 持和 语 法
 as  mentioned  above  the  new  octal  literal  notation  is  the  only  one  supported  and  binary  literals  have  been  added
 pep 3129类 装饰 器
library  changes
 heres  the  list  旧 名称 新 名称 winreg  winreg  configparser  configparser  copyreg  copyreg  queue  queue  socketserver  socketserver  markupbase  markupbase  repr  reprlib  test
pep 3101 a  new  approach  to  string  formatting
changes  to  exceptions
miscellaneous  other  changes
operators  and  special  methods
builtins
 构 建 和 c  api  的 改变
 性能
 移 植 到 python
 see 2 to 3 自动将 python 2代 码转为 python 3 代码 for  more  on  this  tool
0 please  see  将 扩展 模 块 移 植 到 python 3
python 31有 什 么 新变 化
作 者 raymond  hettingerthis  article  explains  the  new  features  in  python 3
pep 372 有 序字典
pep 378 千位 分 隔 符的 格式 说 明 符
参 见 pep 378千位 分 隔符 的 格 式 说明 符 pep  由 raymond  hettinger 撰写 并由 eric  smith  和 mark  dickinson 实 现
其 他语 言 特性 修 改
 新 增 改进 和弃 用 的模 块
性能优 化
 由 amaury  forgeot  darc 和 antoine  pitrou 贡 献
 added  a  heuristic  so  that  tuples  and  dicts  containing  only  untrackable  objects  are  not  tracked  by  the  garbage  collector
由 antoine  pitrou  在 bpo 4688中 贡 献
 enabling  a  configure  option  named  withcomputedgotos  on  compilers  that  support  it  notably  gcc  sunpro  icc  the  bytecode  evaluation  loop  is  compiled  with  a  new  dispatch  mechanism  which  gives  speedups  of  up  to 20 depending  on  the  system  the  compiler  and  the  benchmark
由 antoine  pitrou 以 及其他一 些参 与者 在 bpo 4753中贡 献
 the  decoding  of  utf 8 utf 16 and  latin 1 is  now  two  to  four  times  faster
由 antoine  pitrou  和 amaury  forgeot  darc 在 bpo 4868 中贡献
 the  json  module  now  has  a  c  extension  to  substantially  improve  its  performance
 由 bob  ippolito 在 bpo 4136 中 贡 献
并由 antoine  pitrou  和 benjamin  peterson 转 换 为 py 3
1 unpickling  now  interns  the  attribute  names  of  pickled  objects
由 jake  mcguire  和 antoine  pitrou 在 bpo 5084 中贡 献

idle
 由 roger  d
 serwy  在 bpo 5150 中 贡献

 构 建 和 c  api 的 改变
移 植 到 python
whats  new  in  python
0 a 0 date  五月202020 this  article  explains  the  new  features  in  python 3
 注解 prerelease  users  should  be  aware  that  this  document  is  currently  in  draft  form
summary  release  highlights
new  features
other  language  changes
new  modules
improved  modules
optimizations
build  and  c  api  changes
deprecated
removed
porting  to  python
python 32 有什 么新 变 化
 作者 raymond  hettingerthis  article  explains  the  new  features  in  python 3
 参见 pep 392 python 3
2发 布 计划
pep 384 定 义 稳定的 abi
参 见 pep 384 定 义 稳 定的 abi  pep  由 martin  von  l ö wis 撰写
pep 389 argparse  命 令行解 析模 块
pep 391 基 于字 典的 日志配 置
criticalabnormal  termination 20110217111436694 root  critical  abnormal  termination  参 见 pep 391 基于字 典 的日 志配置 pep 由 vinay  sajip  撰 写
pep 3148 concurrentfutures  模块
pep 3147 pyc 仓库 目 录
 参见 pep 3147 pyc 仓 库目 录 pep 由 barry  warsaw 撰 写
pep 3149 abi  version  tagged  so  files
so 参 见 pep 3149 abi  version  tagged 
so  files  pep  由 barry  warsaw 撰 写
pep 3333 python  web 服 务器网 关接 口 v
 参见 pep 3333 python  web  服务 器 网关 接口 v 1
1 pep  由 phillip  eby 撰写
 其 他 语 言 特 性修 改
新 增 改 进和弃 用的模 块
email
elementtree
doctype  handles  a  doctype  declaration  两个方 法 被 弃用 xml
getchildren 被 listelem  替 代
getiterator  被 element
iter  替代
由 florent  xicluna 和 fredrik  lundh  在 bpo 6472 中贡献

functools
由 raymond  hettinger  贡献
 to  aid  in  porting  programs  from  python 2 the  functools
 由 raymond  hettinger 贡 献

itertools
collections
subtractdogs 2 cats 8 regular  subtraction  tally  counterdogs 3 cats 5 由 raymond  hettinger 贡 献
 the  collections
movetoendx  listd  a  b  d  e  x  由 raymond  hettinger  贡献
 the  collections
reverse  d  dequem  i  b  a  l  a  s  m  i  s  由 raymond  hettinger 贡 献

threading
datetime 和 time
math
abc
io
getvalue  bg 3805 showroom  main  chassis  bx 7899 warehouse  reserve  cog  bl 6988 receiving  primary  sprocket  由 antoine  pitrou 在 bpo 5506 中贡 献

reprlib
x  由 raymond  hettinger  在 bpo 9826 和 bpo 9840中贡 献

logging
csv
contextlib
由 michael  foord 在 bpo 9110中 贡 献

decimal  and  fractions
由 mark  dickinson  和 raymond  hettinger 贡献

ftp
txt  as  f  for  line  in  f  processline 由 tarek  ziad é 和 giampaolo  rodol à在 bpo 4972 贡 献由 georg  brandl  在 issue 8046和 bpo 1286 贡 献
the  ftptls  class  now  accepts  a  context  parameter  which  is  assl
由 giampaolo  rodol à 在 bpo 8806中贡 献

popen
 由 antoine  pitrou 和 brian  curtin 在 bpo 7461 和 bpo 10554中 贡献

select
gzip  和 zipfile
decode 42 decompress  and  convert  to  textthree  shall  be  the  number  thou  shalt  count 由 anand  b
 pillai 在 bpo 3488 中贡献 由 antoine  pitrou  nir  aides 和 brian  curtin  在 bpo 9962 bpo 1675951 bpo 7471 和 bpo 2846中 贡献
also  the  zipfile
tarfile
hashlib
algorithmsavailable  md 2 sha 256 sha 512 dsawithsha  mdc 2 sha 224 md 4 sha 256 sha 512 ripemd 160 sha 1 mdc 2 sha  sha 384 md 2 ecdsawithsha 1 md 4 md 5 sha 1 dsasha  sha 224 dsaencryption  dsa  ripemd 160 sha  md 5 sha 384由 carl  chenet  在 bpo 7418 中建 议

ast
call  object  at 0 x 101739 a 10由 benjamin  peterson 和 georg  brandl  实 现

os
 由 victor  stinner 贡献

shutil
由 tarek  ziad é贡 献
in  addition  the  shutil  module  now  supports  archiving  operations  forzipfiles  uncompressed  tarfiles  gzipped  tarfiles  and  bzippedtarfiles
 由 tarek  ziad é贡献

sqlite
 由 r
 david  murray  和 shashwat  anand 在 bpo 8845中 贡献

html
socket
ssl
 由 antoine  pitrou  在 bpo 8850 bpo 1589 bpo 8322 bpo 5639 bpo 4870 bpo 8484 和 bpo 8321中 贡 献

nntp
 由 antoine  pitrou  在 bpo 9360 中 贡献由 andrew  vant 在 bpo 1926 中 贡 献

certificates
imaplib
由 lorenzo  m
 catucci  和 antoine  pitrou  在 bpo 4471中 贡 献

httpclient
unittest
random
 由 raymond  hettinger  在 bpo 9025中 贡 献

poplib
由 giampaolo  rodol à 在 bpo 8807 中贡献

asyncore
 由 giampaolo  rodol à在 bpo 6706 中 贡 献

tempfile
temporarydirectory  as  tmpdirname  printcreated  temporary  dir  tmpdirname 由 neil  schemenauer 和 nick  coghlan  在 bpo 5178 中 贡献

inspect
pydoc
2 b  由 ron  adam  在 bpo 2001 中 贡 献

dis
由 nick  coghlan 在 bpo 9147 中贡献

dbm
 由 ray  allen 在 bpo 9523中建 议

ctypes
site
2 sitepackages 由 tarek  ziad é 在 bpo 6693 中 贡 献

sysconfig
 还有 一个方 便 的命令 行界 面 cpython 32 python  m  sysconfig  platform  win 32 python  version 3
2 srcdir  cpython 32 userbase  cdocuments  and  settingsraymondapplication  datapython 由 tarekziad é 移 出 distutils

pdb
由 georg  brandl  antonio  cuni 和 ilya  sandler 贡 献

configparser
urllibparse
 encodinglatin 1 typetelenovelanamebfdf 3 ndeeste 1 elisa 3 fas  detailed  in  解析 ascii 编 码字 节 all  the  urllib
parse  functions  nowaccept  asciiencoded  byte  strings  as  input  so  long  as  they  are  notmixed  with  regular  strings
 if  asciiencoded  byte  strings  are  givenas  parameters  the  return  types  will  also  be  an  asciiencoded  bytestrings  urllib
mailbox
turtledemo
多线 程
由 antoine  pitrou  贡献
 regular  and  recursive  locks  now  accept  an  optional  timeout  argument  to  their  acquire  method
性 能 优化
由 alexandre  vassalotti  antoine  pitrou  和 unladen  swallow 团 队在 bpo 9410和 bpo 3873 中贡 献
 the  timsort  algorithm  used  in  list
 由 antoine  pitrou 在 bpo 7451中 贡献 由 raymond  hettinger 和 antoine  pitrou  在 bpo 10314中贡 献
 recursive  locks  created  with  the  threading
由 antoine  pitrou 在 bpo 3001 中贡 献
 the  fastsearch  algorithm  in  stringlib  is  now  used  by  the  split  rsplit  splitlines  and  replace  methods  on  bytes  bytearray  and  str  objects
unicode
编解 码器
文档
idle
由 raymond  hettinger  在 bpo 5150 中 贡献
 idle  on  mac  os  x  now  works  with  both  carbon  aquatk  and  cocoa  aquatk
 由 kevin  walzer  ned  deily 和 ronald  oussoren 在 bpo 6075中 贡 献

 代码 库
构 建和 c  api  的改 变
由 antoine  pitrou 在 bpo 9203 中贡 献
 the  option  withwctypefunctions  was  removed
由 amaury  forgeot  darc 在 bpo 9210中 贡 献
 hash  values  are  now  values  of  a  new  type  pyhasht  which  is  defined  to  be  the  same  size  as  a  pointer
 移植 到 python
python 33有什 么新变化
 本 文介 绍 了 python 3
3相比3
2的 新 增特 性
3 于2012年9 月29日 发布
有关 完整 详 细信 息 请 参 见 changelog
 参见 pep 398 python 3
3 发 布 计划
 摘要 发布 重点
pep 405 虚 拟 环境
 参见 pep 405 python  虚拟 环 境 pep 由 carl  meyer  撰写 由 carl  meyer 和 vinay  sajip  实 现
pep 420隐 式 命 名 空间 包
py  marker  files  and  can  automatically  span  multiple  pathsegments  inspired  by  various  third  party  approaches  to  namespacepackages  as  described  in  pep 420 参见 pep 420 隐 式命名 空间包 pep  由 eric  v
 smith 撰写 由 eric  v
 smith 和 barry  warsaw  实现
pep 3118新 的 内存 视图 实现 和缓冲协 议文档
相 关特性
api  changes
由 stefan  krah  在 bpo 10181 中贡 献
 参 见 pep 3118修 改缓 冲区协 议
pep 393灵活的 字符 串表 示
functionality
performance  and  resource  usage
 参 见 pep 393 灵 活 的字 符串表 示 pep 由 martin  von  l ö wis  撰 写由 torsten  becker  和 martin  von  l ö wis 实现
pep 397适 用于 windows  的 python 启 动器
 参 见 pep 397 适用 于 windows 的 python  启动 器 pep  由 mark  hammond  和 martin  v
 l ö wis  撰写由 vinay  sajip  实现
 launcher  documentation  适用 于 windows 的 python  启 动器 installer  path  modification 查找 python  可执 行文 件
pep 3151 重写 os  和 io 异 常 的层 次结 构
txt 参 见 pep 3151重 写 os 和 io  异 常的层 次结 构 pep 由 antoine  pitrou  撰 写并实 现
pep 380委 托给 子生 成 器 的 语法
pep 409 清除异 常 上 下文
 keyerrorx 参 见 pep 409清 除 异常上下 文 pep  由 ethan  furman  撰写 由 ethan  furman  和 nick  coghlan  实现
pep 414 显式 的 unicode  文本
 参 见 pep 414显 式的 unicode 文本 pep 由 armin  ronacher  撰 写
pep 3155类和函 数的 限 定 名 称
meth  at 0 x 7 f 46 b 9 fe 31 e 0 参 见 pep 3155类和 函 数 的限 定名 称 pep 由 antoine  pitrou  撰写 并实现
pep 412 keysharing  dictionary
参 见 pep 412 keysharing  dictionary  pep  由 mark  shannon 撰 写 并 实现
pep 362 函数 签名 对象
 参 见 pep 362函 数 签 名对 象 pep 由 brett  cannonyury  selivanovlarry  hastingsjiwon  seo 撰 写 由 yury  selivanov 实 现
pep 421添加 sysimplementation
simplenamespace
 参 见 pep 421 添 加 sys
implementation  pep 由 eric  snow 撰 写 并实 现
using  importlib  as  the  implementation  of  import
new  apis
visible  changes
其 他语言特 性修 改
对 python 语 言核 心进 行 的小 改动 added  support  for  unicode  name  aliases  and  named  sequences
由 ezio  melotti 在 bpo 12753 中贡 献
 unicode  database  updated  to  ucd  version 6
由 petri  lehtinen  在 bpo 12170 中 贡献
 the  rjust  ljust  and  center  methods  of  bytes  and  bytearray  now  accept  a  bytearray  for  the  fill  argument
 由 antoine  pitrou 在 bpo 13748中 贡献
 dict
 由 filip  gruszczy ń ski 在 bpo 13521 中贡献
 the  error  messages  produced  when  a  function  call  does  not  match  the  function  signature  have  been  significantly  improved
 由 benjamin  peterson 贡献

a  finergrained  import  lock
 由 antoine  pitrou  在 bpo 9260 中贡 献

builtin  functions  and  types
 新 增 模块
faulthandler
ipaddress
 由 google  和 peter  moody  在 bpo 3144 中 贡 献

lzma
由 nadeem  vawda 和 per ø yvind  karlsen  在 bpo 6715 中 贡献

 改进的模块
abc
 由 pablo  galindo 在 bpo 11610 中贡 献
abc
array
 由 oren  tirosh 和 hirokazu  yamamoto  在 bpo 1172711 中 贡 献

base
binascii
bz
 由 nadeem  vawda 在 bpo 5863中 贡献
 bz 2
由 nir  aides 在 bpo 1625 中贡 献
 bz 2
codecs
collections
contextlib
crypt
curses
window  class  has  a  new  getwch  method  to  get  a  wide  character  the  curses  module  has  a  new  ungetwch  function  to  push  a  wide  character  so  the  next  getwch  will  return  it 由 i ñ igo  serna  在 bpo 6755 中 贡 献

datetime
decimal
py  decimal 加 速 pi 42
02秒0
345 秒120 倍 telco 172
19秒5
68秒30倍 psycopg 3
57 秒0
29 秒12倍相 关特 性 the  floatoperation  signal  optionally  enables  stricter  semantics  for  mixing  floats  and  decimals
api  changes  c 模 块 上下 文限 制如下表 具体 取决 于计 算机 体 系 结构32 位64位 maxprec 425000000999999999999999999 maxemax 425000000999999999999999999 minemin 425000000999999999999999999 in  the  context  templates  defaultcontext  basiccontext  and  extendedcontext  the  magnitude  of  emax  and  emin  has  changed  to 999999
email
ftplib
functools
gc
hmac
http
html
imaplib
由 sijin  joseph 在 bpo 8808 中 贡献

inspect
 由 meador  inge 和 nick  coghlan 在 bpo 13062 中 贡 献
a  new  getgeneratorlocals  function  has  been  added
 由 meador  inge  在 bpo 15153中 贡 献

io
由 david  townshend  在 bpo 12760中贡献
the  constructor  of  the  textiowrapper  class  has  a  new  writethroughoptional  argument
itertools
logging
math
mmap
multiprocessing
nntplib
committers 由 giampaolo  rodol à 在 bpo 9795中贡 献

os
pdb
由 georg  brandl 在 bpo 14210中 贡献
pickle
由 richard  oudkerk  在 bpo 14166中 贡献

pydoc
re
 由 serhiy  storchaka  在 bpo 3665中 贡献

sched
select
shlex
shutil
 新的 函 数 diskusage  provides  total  used  and  free  disk  space  statistics
signal
smtpd
smtplib
socket
socketserver
sqlite
ssl
 由 victor  stinner  在 bpo 12049中贡 献
 the  ssl  module  now  exposes  a  finergrained  exception  hierarchy  in  order  to  make  it  easier  to  inspect  the  various  kinds  of  errors
stat
 由 giampaolo  rodol à在 bpo 14807 中贡 献

struct
subprocess
sys
tarfile
tempfile
textwrap
threading
time
types
unittest
urllib
webbrowser
xmletreeelementtree
zlib
性 能 优 化
构建和 c  api  的改变
changes  to  pythons  build  process  and  to  the  c  api  include  新 的 pep 3118相 关功 能 pymemoryviewfrommemory  pep 393添 加了 新的 unicode  类型 宏和 函数高 阶 api  pyunicodecopycharacters  pyunicodefindchar  pyunicodegetlength  pyunicodegetlength  pyunicodenew  pyunicodesubstring  pyunicodereadchar  pyunicodewritechar  低 阶 api  pyucs 1 pyucs 2 pyucs 4 类型 pyasciiobject  和 pycompactunicodeobject 结构 pyunicodeready  pyunicodefromkindanddata  pyunicodeasucs 4 pyunicodeasucs 4 copy  pyunicodedata  pyunicode 1 bytedata  pyunicode 2 bytedata  pyunicode 4 bytedata  pyunicodekind  使用 pyunicodekind  枚举 pyunicodewcharkind  pyunicode 1 bytekind  pyunicode 2 bytekind  pyunicode 4 bytekind  pyunicoderead  pyunicodereadchar  pyunicodewrite  pyunicodemaxcharvalue  pyargparsetuple  现 在接受 c 格 式 的 bytearray  bpo 12380
弃用
不 支持的操 作 系统
 由 于缺少维 护人 员不 再支 持 os 2 和 vms  系统
 由 于维 护 负担 将 comspec  设 置为 command
com  的 windows 平 台含 windows 2000 不再受 支持
osf 支 持 在3
2 中 被 弃用现 在 已经 被 完 全 删 除
已 弃用 的 python 模 块、函数 和方法
 check  especially  the  使用 subprocess  模块替 换旧 函数 section  bpo 11377
 已 弃 用 的 c  api 函 数 和类 型
pyunicode 已经 在 pep 393弃用并 将于 python 4 中移除
 所 有使 用此类 型的函数 都 已弃 用 unicode  functions  and  methods  using  pyunicode  and  pyunicodetypes  pyunicodefromunicode  使用 pyunicodefromwidechar  或 pyunicodefromkindanddata  pyunicodeasunicode  pyunicodeasunicode  pyunicodeasunicodeandsize  使用 pyunicodeaswidecharstring  pyunicodeasdata  使用 pyunicodedata  以 及 pyunicoderead  和 pyunicodewrite  pyunicodegetsize  pyunicodegetsize 使 用 pyunicodegetlength 或 pyunicodegetlength  pyunicodegetdatasize 使 用 pyunicodegetlengthstr  pyunicodekindstr  仅 适 用于 现成 的 字符串 pyunicodeasunicodecopy 使用 pyunicodeasucs 4 copy  或 pyunicodeaswidecharstring  pyunicodegetmaxfunctions  and  macros  manipulating  pyunicode  strings  pyunicodestrlen  使用 pyunicodegetlength  或 pyunicodegetlength  pyunicodestrcat 使用 pyunicodecopycharacters  或 pyunicodefromformat  pyunicodestrcpy  pyunicodestrncpy  pyunicodecopy  使 用 pyunicodecopycharacters 或 pyunicodesubstring  pyunicodestrcmp  使 用 pyunicodecompare  pyunicodestrncmp  使 用 pyunicodetailmatch  pyunicodestrchr  pyunicodestrrchr 使 用 pyunicodefindchar  pyunicodefill 使用 pyunicodefill  pyunicodematch 编码 器 pyunicodeencode 使用 pyunicodeasencodedobject  pyunicodeencodeutf 7 pyunicodeencodeutf 8使 用 pyunicodeasutf 8 或 pyunicodeasutf 8 string  pyunicodeencodeutf 32 pyunicodeencodeutf 16 pyunicodeencodeunicodeescape  use  pyunicodeasunicodeescapestring  pyunicodeencoderawunicodeescape  use  pyunicodeasrawunicodeescapestring  pyunicodeencodelatin 1 使用 pyunicodeaslatin 1 string  pyunicodeencodeascii  使用 pyunicodeasasciistring  pyunicodeencodecharmap  pyunicodetranslatecharmap  pyunicodeencodembcs  使 用 pyunicodeasmbcsstring 或 pyunicodeencodecodepage 和 cpacp  codepage  pyunicodeencodedecimal  pyunicodetransformdecimaltoascii
 弃用 的 功能
移 植 到 python
本节 列 出 了 先前 描述的 更改 以 及 可 能需要 更改代 码的 其 他 错误修 正
porting  python  code
porting  c  code
building  c  extensions
command  line  switch  changes
 bpo 10998 由é ric  araujo 贡 献
 when  python  is  started  with  s  import  site  will  no  longer  add  sitespecific  paths  to  the  module  search  paths
python 34有 什么新 变 化
 作者 r
参 见 pep 429 python 3
4发布 计划
摘 要发布 重点
新 的 语法特 性 no  new  syntax  features  were  added  in  python 3
其 他 的新 特性 pip  能够 随 时 可用 pep 453
 新 的 库 模块 asyncio  new  provisional  api  for  asynchronous  io  pep 3156
 the  ipaddress  module  api  has  been  declared  stable  安 全 改进 secure  and  interchangeable  hash  algorithm  pep 456
cpython  实现 的 改进 safe  object  finalization  pep 442
 新的 特性
pep 453 explicit  bootstrapping  of  pip  in  python  installations
 注解 to  avoid  conflicts  between  parallel  python 2 and  python 3 installations  only  the  versioned  pip 3 and  pip 3
 文 档更 改 as  part  of  this  change  the  安 装 python  模 块 and  分发 python  模 块 sections  of  the  documentation  have  been  completely  redesigned  as  shortgetting  started  and  faq  documents
 most  packaging  documentation  hasnow  been  moved  out  to  the  python  packaging  authority  maintained  pythonpackaging  user  guide  and  the  documentation  of  the  individual  projects
however  as  this  migration  is  currently  still  incomplete  the  legacyversions  of  those  guides  remaining  available  as  安 装 python 模 块旧 版 and  分 发 python 模 块 遗 留版 本
 参见 pep 453 python  安装 中 pip 的 显式 引导 pep 由 donald  stufft  和 nick  coghlan 撰写 由 donald  stufftnick  coghlanmartin  von  l ö wis 和 ned  deily  实现
pep 446 newly  created  file  descriptors  are  noninheritable
setinheritable 参 见 pep 446 make  newly  created  file  descriptors  noninheritable  pep 由 victor  stinner  撰 写并 实 现
improvements  to  codec  handling
 this  means  that  encodingbinary  data  to  and  from  its  hexadecimal  representation  for  examplecan  now  be  written  as  from  codecs  import  encode  decode  encodebhello  hex  b 68656 c 6 c 6 f  decodeb 68656 c 6 c 6 f  hex  bhellothe  binary  and  text  transforms  provided  in  the  standard  library  aredetailed  in  二 进制 转 换 and  文字转 换
pep 451 a  modulespec  type  for  the  import  system
 see  the 弃用 section  for  a  list  of  methodsthat  should  be  replaced  and  their  replacements
 其 他 语言特性修 改
 对 python  语言 核 心 进行 的小 改 动 unicode  database  updated  to  ucd  version 6
新 增 模 块
asyncio
参 见 pep 3156 asynchronous  io  support  rebooted  the  asyncio  module  pep  由 guido  van  rossum 领导 编写 和 实 现
ensurepip
enum
 参 见 pep 435 adding  an  enum  type  to  the  python  standard  library  pep  由 barry  warsaweli  bendersky 和 ethan  furman  撰写 由 ethan  furman  实现
pathlib
 参 见 pep 428 the  pathlib  module  objectoriented  filesystem  paths  pep 由 antoine  pitrou 撰 写并 实 现
selectors
statistics
参 见 pep 450 adding  a  statistics  module  to  the  standard  library  pep 由 steven  daprano  撰写 并实 现
tracemalloc
 it  provides  the  followinginformation  trace  where  an  object  was  allocated  statistics  on  allocated  memory  blocks  per  filename  and  per  line  number  total  size  number  and  average  size  of  allocated  memory  blocks  compute  the  differences  between  two  snapshots  to  detect  memory  leaks  参见 pep 454 add  a  new  tracemalloc  module  to  trace  python  memory  allocations  pep  由 victor  stinner 撰 写并实 现
改 进 的 模块
abc
aifc
argparse
audioop
base
collections
colorsys
contextlib
dbm
dis
doctest
email
 for  details  see  the  contentmanagerdocumentation  and  the  email  示例
 these  api  additions  complete  thebulk  of  the  work  that  was  planned  as  part  of  the  email 6 project
 thecurrently  provisional  api  is  scheduled  to  become  final  in  python 3
5 possibly  with  a  few  minor  additions  in  the  area  of  error  handling
contributed  by  r
filecmp
functools
参 见 pep 443 singledispatch  generic  functions  pep  由ł ukasz  langa 撰 写并实现
gc
glob
hashlib
hmac
html
http
idlelib  与 idle
importlib
inspect
ipaddress
logging
marshal
mmap
multiprocessing
operator
os
pdb
pickle
 参 见 pep 3154 pickle  protocol 4 pep  由 antoine  pitrou 撰写并 由 alexandre  vassalotti 实 现
plistlib
poplib
pprint
pty
pydoc
re
resource
select
shelve
shutil
smtpd
smtplib
socket
sqlite
ssl
stat
struct
subprocess
sunau
sys
tarfile
the  tarfile  module  now  supports  a  simple 命令 行界 面 when  called  as  ascript  directly  or  via  m
 this  can  be  used  to  create  and  extracttarfile  archives
 contributed  by  berker  peksag  in  bpo 13477
textwrap
threading
traceback
types
urllib
unittest
venv
wave
weakref
xmletree
 an  example  can  be  seen  at  pull  api 进 行 非阻 塞解 析
zipfile
cpython  implementation  changes
pep 445 customization  of  cpython  memory  allocators
参 见 pep 445 add  new  apis  to  customize  python  memory  allocators  pep 由 victor  stinner  撰写并实 现
pep 442 safe  object  finalization
参 见 pep 442 safe  object  finalization  pep  由 antoine  pitrou  撰 写 并 实 现
pep 456 secure  and  interchangeable  hash  algorithm
pep 436 argument  clinic
 注解 the  argument  clinic  pep  is  not  fully  up  to  date  with  the  state  of  the  implementation
 参 见 pep 436 the  argument  clinic  dsl  pep 由 larry  hastings  撰写并实 现
other  build  and  c  api  changes
其他改 进
significant  optimizations
弃用
deprecations  in  the  python  api
deprecated  features
 移除
 不再支 持 的操作 系 统
 从源 代码 和构 建工 具 中删 除了 对 以 下 操 作系统 的 支 持 os 2 bpo 16135
 windows 2000 变 更集 e 52 df 05 b 496 a
 windows  系统 中 comspec 指 向 command
com  的 版 本 bpo 14470
api 与 特 性 的 移 除
code  cleanups
移植 到 python
本节 列出 了先 前描 述 的更改 以 及 可 能 需 要更改 代 码的 其 他 错误修 正
  python  命令 行为 的 变 化
 the  python  command  and  most  stdlib  scripts  as  well  as  argparse  now  output  version  information  to  stdout  instead  of  stderr  for  issue  list  see 其 他改 进 above
python  api  的变 化
c  api 的 变化
 的 变 化
pep 476 enabling  certificate  verification  by  default  for  stdlib  http  clients
python 35有 什 么新 变化
 编者 elvis  pranskevichus  elvismagic
 参见 pep 478 python 3
5 发 布计 划
 摘要 发 布 重点
 新的语法 特性 pep 492使 用 async  和 await  语法 实 现 协程
 pep 465 新 的矩 阵乘 法运算 符 a  b
新 的库 模 块 typing  pep 484类 型 提示
 zipapp  pep 441 改 进 python  zip 应 用 程序支持
 新 的内 置特 性 bytes  args  bytearray  args  pep 461 adding  formatting  to  bytes  and  bytearray
cpython 实现的改进 when  the  lctype  locale  is  the  posix  locale  c  locale  sys
 标准 库中 的 重大 改进 collections
安 全改进 sslv 3 is  now  disabled  throughout  the  standard  library
windows  改 进 a  new  installer  for  windows  has  replaced  the  old  msi
 see  在 windows  上 使 用 python  for  more  information
新 的特 性
pep 492使 用 async 和 await  语 法 实 现协 程
close 将 输 出 coro 2 waiting  for  lock  coro 2 holding  the  lock  coro 1 waiting  for  lock  coro 2 releasing  the  lock  coro 1 holding  the  lock  coro 1 releasing  the  locknote  that  both  async  for  and  async  with  can  only  be  used  inside  acoroutine  function  declared  with  async  def
注 解在3
2 版 更改 starting  with  cpython 3
2 aiter  can  directly  return  asynchronous  iterators
 returning  an  awaitable  object  will  result  in  a  pendingdeprecationwarning
see  more  details  in  the  异步 迭 代 器 documentation  section
参 见 pep 492 使用 async  和 await  语法 实现 协程 pep 由 yury  selivanov  撰写并实 现
pep 465用于 矩 阵 乘 法 的专 用中 缀 运 算 符
 矩 阵乘 法 在数学 科 学工程 学 的许多 领域 中是 一 种 常见 的操作使 用运 算符 可以 编 写 更 简洁 的代码 s  h  beta  r
t  h  beta  r  代替 s  dotdoth  beta  r
10 支持 新的 运 算符 import  numpy  x  numpy
 参见 pep 465用 于矩阵 乘 法 的专 用中 缀 运算 符 pep 由 nathaniel  j
 smith  撰 写由 benjamin  peterson  实 现
pep 448 additional  unpacking  generalizations
 fna 1 c 3 b 2 d 41234 similarly  tuple  list  set  and  dictionary  displays  allow  multipleunpackings  see 表 达 式列 表 and 字 典 显示 range 4401234 range 4401234 range 4456701234567 x 1 y 2 x 1 y 2 参见 pep 448 additional  unpacking  generalizations  pep  由 joshua  landau 撰 写由 neil  girdharthomas  wouters  和 joshua  landau 实现
pep 461 percent  formatting  support  for  bytes  and  bytearray
 例 如 bhello  b  bworld  bhello  world  bxi  yf 12
 参见 pep 461 adding  formatting  to  bytes  and  bytearray  pep  由 ethan  furman  撰写 由 neil  schemenauer 和 ethan  furman  实 现
pep 484 类 型提示
 参 见 typing 模 块文档 pep 484 类 型提示 pep  由 guido  van  rossumjukka  lehtosalo 和ł ukasz  langa 撰 写 由 guido  van  rossum  实 现
 pep 483类 型提 示理论 pep  由 yury  selivanov 撰 写
pep 471 osscandir  function  a  better  and  faster  directory  iterator
name 参见 pep 471 os
scandir  function  a  better  and  faster  directory  iterator  pep  由 ben  hoyt  在 victor  stinner  的 帮 助下 撰 写并实 现
pep 475 retry  system  calls  failing  with  eintr
 compare  printhello  world  和 while  true  try  printhello  world  break  except  interruptederror  continuepep 475 implements  automatic  retry  of  system  calls  on  eintr
below  is  a  list  of  functions  which  are  now  retried  when  interrupted  bya  signal  open  和 io
open  faulthandler  模块 的功 能 os  函 数 fchdir  fchmod  fchown  fdatasync  fstat  fstatvfs  fsync  ftruncate  mkfifo  mknod  open  posixfadvise  posixfallocate  pread  pwrite  read  readv  sendfile  wait 3 wait 4 wait  waitid  waitpid  write  writev 特 例 os
close  和 os
dup 2 现在 会忽 略 eintr 错 误不 重 试系 统 调 用请 参 阅 pep  了 解 基本 原 理 select 函 数 devpoll
poll  kqueue
control  poll
poll  select  socket 类 的 方 法 accept  connect 除 了非阻 塞套接 字 recv  recvfrom  recvmsg  send  sendall  sendmsg  sendto  signal
sigtimedwait 和 signal
参 见 pep 475 retry  system  calls  failing  with  eintr  pep  and  implementation  written  by  charlesfran ç ois  natali  and  victor  stinner  with  the  help  of  antoine  pitrou  the  french  connection
pep 479 change  stopiteration  handling  inside  generators
pep 485 a  function  for  testing  approximate  equality
00001 false 参见 pep 485—— 用于 测试 近似相 等的 函 数 pep 由 christopher  barker  撰 写 由 chris  barker  和 tal  einat  实现
pep 486 make  the  python  launcher  aware  of  virtual  environments
 参见 pep 486 make  the  python  launcher  aware  of  virtual  environments  pep  由 paul  moore 撰 写并 实 现
pep 488 elimination  of  pyo  files
参见 pep 488 elimination  of  pyo  files  pep  由 brett  cannon 撰 写 并 实现
pep 489 multiphase  extension  module  initialization
 参见 pep 489 multiphase  extension  module  initialization  pep 由 petr  viktorin  stefan  behnel  和 nick  coghlan 撰写 由 petr  viktorin 实现
其他 语言特性 修改
 对 python 语 言核 心 进行 的 小 改 动 added  the  namereplace  error  handlers
新 增模块
typing
zipapp
参见 pep 441 improving  python  zip  application  support
 改 进的 模块
argparse
asyncio
3
1 中的 更 新 the  ensurefuture  function  and  all  functions  that  use  it  such  as  loop
3
2 中的更 新 new  loop
bz
cgi
cmath
code
collections
doc  ordinate 由 berker  peksag 在 bpo 24064 中 贡 献
the  userstring  class  now  implements  the  getnewargsrmod  casefold  formatmap  isprintable  andmaketrans  methods  to  match  the  corresponding  methods  of  str
collectionsabc
compileall
concurrentfutures
configparser
 示例 import  configparser  conv  convlist  lambda  v  e
getlistlist  a  b  c  d  e  f  g 由ł ukasz  langa  在 bpo 18159 中贡 献

contextlib
getvalue  warningrootwarningn 由 berker  peksag 在 bpo 22389 中 贡 献

csv
curses
dbm
difflib
distutils
doctest
email
enum
dog 11由 ethan  furman  在 bpo 21706 中 贡献

faulthandler
functools
glob
gzip
heapq
mergereverseda  reversedb  keylen  reversetrue 555556666777889 由 raymond  hettinger 在 bpo 13742 中贡 献

http
httpclient
remotedisconnected  pass 由 martin  panter 在 bpo 3566 中贡献

idlelib  与 idle
imaplib
imghdr
importlib
inspect
arguments  ordereddicta  spam  b  ham  args  由 yury  selivanov  在 bpo 24190 中贡献
a  new  class  method  signature
io
ipaddress
08由 peter  moody  和 antoine  pitrou  在 bpo 16531中贡 献
a  new  reversepointer  attribute  for  the  ipv 4 network  andipv 6 network  classes  returns  the  name  of  the  reverse  dns  ptr  record  import  ipaddress  addr  ipaddress
arpa  由 leon  weber 在 bpo 20480 中贡 献

json
linecache
locale
56由 c é dric  krier  在 bpo 13918 中 贡 献

logging
errorexception  excinfoex  errorrootexception 由 yury  selivanov  在 bpo 20537 中 贡献
the  handlers
lzma
math
multiprocessing
operator
os
commonpathusrlib  usrlocallib  usr  由 rafik  draoui 和 serhiy  storchaka  在 bpo 10395中贡 献

pathlib
samefilep 2 true 由 vajrasky  kok  和 antoine  pitrou 在 bpo 19775中 贡献
the  path
writetextham 3 由 christopher  welborn 在 bpo 20218中 贡献

pickle
poplib
re
srematch  object  span 03 matchbbc  由 serhiy  storchaka  在 bpo 9179 中贡献
the  number  of  capturing  groups  in  regular  expressions  is  no  longerlimited  to 100
error  multiple  repeat  at  position 16 line 3 column 7 由 serhiy  storchaka  在 bpo 22578 中贡 献

readline
selectors
shutil
signal
smtpd
smtplib
sndhdr
socket
ssl
memory  bio  support  由 geert  jansen 在 bpo 21965 中贡献
the  new  sslobject  class  has  been  added  to  provide  ssl  protocolsupport  for  cases  when  the  network  io  capabilities  of  sslsocket  arenot  necessary  or  are  suboptimal
applicationlayer  protocol  negotiation  support  由 benjamin  peterson 在 bpo 20188 中贡献
where  openssl  support  is  present  the  ssl  module  now  implements  theapplicationlayer  protocol  negotiation  tls  extension  as  described  inrfc 7301
sqlite
subprocess
 例 如 subprocess
sys
sysconfig
tarfile
threading
time
timeit
tkinter
traceback
types
unicodedata
unittest
unittestmock
urllib
wsgiref
xmlrpc
xmlsax
zipfile
 其他 模块 级 更 改
 性 能 优化
 构建 和 c  api  的改 变
增加了 calloc  函数 pymemrawcalloc  pymemcalloc  pyobjectcalloc
victor  stinner  贡献 于 bpo 21233
 新的 encodingdecoding  帮助 函数 pydecodelocale  替 代 pychar 2 wchar  pyencodelocale  替 代 pywchar 2 char
由 victor  stinner 在 bpo 18395 中贡 献
a  new  pycodecnamereplaceerrors  function  to  replace  the  unicodeencode  error  with  n
弃用
 新 关键 字
已弃用 的 python  行 为
 不 支持 的操 作 系统
 已弃 用的 python  模 块、 函 数 和 方法
 移除
api  与特性 的移除
移植 到 python
本节 列出了先前描 述 的 更改 以及可 能 需要 更 改代码 的 其他 错 误 修 正
python 行为 的改 变
 由 于一个 疏忽之 前的 python 版 本 会 错误地 接受 以下语 法 f 1 for  x  in 1 args  f 1 for  x  in 1 kwargs  python 3
改 变 了 的 python  api
c  api 中的 改变
 refer  to  协 程对象 for  new  types  structures  and  functions
python 354 的显著 变化
new  make  regenall  build  target
 由 victor  stinner  在 bpo 23404 中贡献
3
4 新版 功能
removal  of  make  touch  build  target
由 victor  stinner 在 bpo 23404 中 贡献
在3
4 版更改
python 36 有 什 么 新 变 化
编 者 elvis  pranskevichus  elvismagic
io 本文解 释了与3
5 相 比 python 3
6中 的新 功能
 python 3
6 于2016年12 月23日 发 布
 请 参 阅 changelog 以 获 取完整 的更改 列 表
 参 见 pep 494 python 3
6发布 计 划
摘要 发布 重点
 新 的特 性
pep 498格 式化 的字 符串 文字
pep 526 变量 注释 的 语法
pep 515 数字文 字中 的下 划线。
pep 525 异步 生 成 器
参 见 pep 525异步 生 成器 pep  由 yury  selivanov 撰 写并实 现
pep 530 异 步推导
pep 530 adds  support  for  using  async  for  in  list  set  dictcomprehensions  and  generator  expressions  result  i  async  for  i  in  aiter  if  i 2 additionally  await  expressions  are  supported  in  all  kinds  ofcomprehensions  result  await  fun  for  fun  in  funcs  if  await  condition 参 见 pep 530异步 推 导 pep 由 yury  selivanov 撰 写并 实现
pep 487 自定 义类 创 建
new  as  described  in 创建 类对象
 参见 pep 487自定义 类创建 pep  由 martin  teichmann  撰 写并 实现
pep 487 descriptor  protocol  enhancements
name  name  class  model  intfield  intfield 参 见 pep 487自 定义类 创建 pep 由 martin  teichmann 撰写 并 实现
pep 519 添加文 件系 统 路径 协议
参见 pep 519添 加 文件 系统 路 径协 议 pep 由 brett  cannon  和 koos  zevenhoven 撰写
pep 495 消 除本 地 时间的歧义
 参见 pep 495 消除 本地 时间的 歧 义 pep 由 alexander  belopolsky  和 tim  peters 撰 写 由 alexander  belopolsky  实现
pep 529将 windows 文件 系 统 编 码更 改 为 utf
 有关详 细信 息 和 可能 需要的 代 码修 改的 讨论 请参见 pep 529
pep 528 将 windows 控制 台编码更改 为 utf
参见 pep 528 将 windows 控 制台 编 码更 改为 utf 8 pep 由 steve  dower  撰写 并 实现
pep 520保 留 类属性定义 顺序
 参见 pep 520 保 留类 属性定义顺 序 pep 由 eric  snow  撰 写 并 实现
pep 468保留 关键 字参 数 顺序
参见 pep 468 保 留 关键字参 数顺 序 pep 由 eric  snow 撰写 并实现
 新的 dict  实现
pep 523 向 cpython  添 加框 架评 估 api
 参 见 pep 523 向 cpython  添 加 框架评估 api  pep  由 brett  cannon 和 dino  viehland 撰 写
pythonmalloc 环 境 变 量
 effectsof  debug  hooks  新分 配的 内 存 中填 充字 节0 xcb 释 放的内存中填 充了字 节0 xdb  detect  violations  of  the  python  memory  allocator  api
在 缓冲区 开始之前检 测写 操作 缓冲区下溢在 缓 冲 区结束后检测 写操 作缓冲 区 溢 出 check  that  the  gil  is  held  when  allocator  functions  of  pymemdomainobj  ex  pyobjectmalloc  and  pymemdomainmem  ex  pymemmalloc  domains  are  called
 检查是 否保留了 gil 也是 python 3
6 的新 特 性
 由 victor  stinner  在 bpo 26516和 bpo 26564 中 贡 献

dtrace  和 systemtap 探测支 持
python  can  now  be  built  withdtrace  which  enables  static  markersfor  the  following  events  in  the  interpreter 函 数调 用返回 垃圾 收集开 始完成 执行 的代 码 行
 更多信 息请参见使用 dtrace  和 systemtap 检 测 cpython 
当 前的实现 已在 linux  和 macos 上 进行 了测 试
 将来可 能 会添加其 他标记
其他 语言特 性修改
 对 python  语言核 心进行 的小 改 动 a  global  or  nonlocal  statement  must  now  textually  appear  before  the  first  use  of  the  affected  name  in  the  same  scope
新增 模块
secrets
警 告 note  that  the  pseudorandom  generators  in  the  random  module  should  not  be  used  for  security  purposes
参见 pep 506 secrets 模 块被 加入 python  标准 库 pep 由 steven  daprano  撰写 并 实现
 改进的 模块
array
 由 serhiy  storchaka 在 bpo 26492 中贡 献
ast
由 victor  stinner  在 bpo 26146中 贡献
asyncio
binascii
cmath
collections
concurrentfutures
contextlib
datetime
decimal
asintegerratio 15750 由 stefan  krah 和 mark  dickinson  在 bpo 25928中贡 献

distutils
email
encodings
enum
faulthandler
fileinput
hashlib
httpclient
idlelib  与 idle
在3
2 中新 增 多 个对 自动 补全 的修正
由 louie  lu  在 bpo 15786 中 贡 献
在3
3 中新 增 module  browser 在 file 菜 单中 之前称 为 class  browser 现在 会在 最高层 级函 数和 类之外显 示嵌 套的 函数和类
 由 guilherme  polo  cheryl  sabella 和 terry  jan  reedy  在 bpo 1612262 中贡献
 之前 以扩 展 形 式实 现 的 idle 特性已 作 为正 常 特性重新实 现
它们 的 设置 已 从 extensions 选 项 卡移 至其 他对话框 选项卡
由 charles  wohlganger 和 terry  jan  reedy  在 bpo 27099中实现
settings  对话框 options  中 的 configure  idle 已 经被 部分 重 写 以 改 进 外 观 和功能
由 cheryl  sabella  和 terry  jan  reedy  在 多个 问 题项中 贡献
 在3
4中新 增字 体样 本 现 在 包括 一组 非 拉丁字 符以便 用户 能 更好 地 查看所选 特 定字 体 的效 果
由 terry  jan  reedy  在 bpo 13802中 贡献
样 本 可以 被 修 改 以 包 括其他 字 符
由 serhiy  storchaka 在 bpo 31860中 贡 献
在3
6 中 新增 编辑 器代码 上下 文 选项 已经过 修改
 box  会 显示 所 有 上 下文 行直 到最 大 行数
 点击 一个 上下 文行 会使 编辑器 跳转到该行
 自定 义 主题的上 下文 颜 色 已 添加到 settings  对 话框 的 highlights  选 项卡
 由 cheryl  sabella  和 terry  janreedy  在 bpo 33642 bpo 33768和 bpo 33679 中贡献
在 windows 上 会 有新 的 api 调用将 tk  对 dpi  的调 整告 知 windows
在 windows 8
1或10 上如 果 python  二 进制码 的 dpi 兼 容 属性 未 改变 并且 监视 器 分辨 率 大 于96 dpi 这应 该会 令文 本和 线条 更清 晰
 否则的 话 它应 该 不 造成影 响
由 terry  jan  reedy  在 bpo 33656中 贡献
在3
7 中新 增超过 n  行默 认 值为50 的输 出 将被 折叠 为 一个 按 钮
 n 可 以在 settings  对话 框的 general 页 的 pyshell 部 分中进 行修 改
数 量 较少但是 超 长的 行 可 以 通过在 输 出 上 右击 来折叠
被折 叠 的 输 出可 通过双 击按 钮来 展开 或是 通过 右击 按钮 来 放 入 剪贴板 或是 单 独的窗口
 由 tal  einat 在 bpo 1529353 中贡 献

importlib
inspect
json
logging
math
multiprocessing
os
pathlib
pdb
pickle
pickletools
pydoc
random
re
readline
rlcompleter
shlex
site
sqlite
socket
socketserver
ssl
statistics
struct
subprocess
sys
telnetlib
time
timeit
tkinter
traceback
 f  traceback  most  recent  call  last  file  stdin  line 1 in  module  file  stdin  line 1 in  f  file  stdin  line 1 in  f  file  stdin  line 1 in  f  previous  line  repeated 995 more  times  recursionerror  maximum  recursion  depth  exceeded 由 emanuel  barry  在 bpo 26823中 贡献

tracemalloc
 由 victor  stinner 在 bpo 26588 中贡 献

typing
unicodedata
unittestmock
urllibrequest
urllibrobotparser
venv
warnings
winreg
winsound
xmlrpcclient
zipfile
zlib
性 能优化
构 建 和 c  api 的 改变
 其 他改进
弃 用
新关 键字
 已弃用的 python  行 为
已 弃用 的 python  模 块、 函 数和 方 法
已 弃 用 的 c  api 函 数和 类 型
弃用的 构 建选 项
移 除
api 与 特 性的 移 除
 移植 到 python
本 节列 出了先 前描 述的更 改 以及可能 需 要 更改代码的 其 他错误修正
  python  命 令行 为 的变化
python  api 的更 改
 type 的 子类 如 果未重 载 type
new 将 不 再能 使 用 一个 参数的 形式 来获 取对象 的类型
c  api 中 的改变
cpython  字 节 码 的改 变
python 362中 的 重 要 变 化
new  make  regenall  build  target
由 victor  stinner 在 bpo 23404 中贡 献
3
2 新 版功能
removal  of  make  touch  build  target
 由 victor  stinner  在 bpo 23404 中贡 献
在3
2版 更改
python 364 中 的重 要 变化
python 365中的 重 要 变化
python 367中 的 重要变化
python 3610中 的 重要 变 化
出 于重要的 安全性考量 asyncio
createdatagramendpoint  的 reuseaddress 形参不 再 被支 持
 这是由 udp  中 的套接 字 选 项 soreuseaddr 的行 为导致 的
更多细 节 请 参阅 loop
createdatagramendpoint 的 文档
 由 kyle  stanley  antoinepitrou  和 yury  selivanov  在 bpo 37228中 贡献

python 37有什 么 新变 化
编者 elvis  pranskevichus  elvismagic
io  本文解 释了 python 3
7 相 比3
6 的新 增特 性
7于2018年6 月27 日发布
 完整的 详情 可参 阅 更新日志
 摘 要发 布重 点
新 的 语法特 性 pep 563类型 标注 延迟求 值
 向 后不 兼容的 语 法更改 async  和 await 现 在是 保留的关 键字
 新的 库模 块 contextvars  pep 567上 下 文 变量 dataclasses  pep 557 数据 类 importlib
resources 新的内 置 特性 pep 553 新的 breakpoint 函 数
对 python  数据 模型的改 进 pep 562 自定义可 访问 的 模块 属性
 pep 560 typing 模 块和泛 型类 型 的核心 支持
 dict 对 象会 保 持 插入 时的顺序这 个特 性正 式宣 布 成 为 python 语 言官方 规范的 一 部分
标准 库 中的 重大 改进 asyncio  模 块添加了新 的 功能 重大改进 请参 阅可用性 与 性能提升
 time  模块现在 提供纳 秒级精度函 数 的 支 持
cpython 实 现的 改进避免 使用 ascii  作为默认 的 文 本编 码 pep 538 传 统 c  区域 强 制转 换 pep 540强制 utf 8运 行 时模 式 pep 552确定 性的
pyc  文 件新 的 python 开 发 模式 pep 565 改 进的 deprecationwarning  处理 c  api  的改 进 pep 539 用 于线程本 地 存储的 新 c  api  文档 的改 进 pep 545 python  文 档翻 译新的文 档翻 译 japanesefrench 和 korean
 此版 本在 诸多方面 有显 著的 性 能改进
性 能 优化章节 详 细列 出了 它们
 和之 前的 python  版 本 存在 兼容 性的 更 改列 表请参 阅移植 到 python 3
7 章节
新的特 性
pep 563 延 迟的 标注求 值
随 着 pep 3107加 入标 注功 能并 在 pep 526 进一步细 化 python  中 类型 提示 的出 现揭示 了 两 个明 显 的 可 用性 问 题标注 只 能使 用 在 当前作 用域中 已 经存 在的名称 也就是 说它们 不支 持任 何 形式 的前 向 引 用 而 且——标 注源码对 python  程序的 启动 时间有 不利的 影响
 这两 个问题 都可 以通过 延迟 标 注求 值 来解决
在 定 义 标注 的时候 编译 器并 不会编 译 执 行 相应 表达 式的 代码 而是保 存与 相应表 达式 的 ast 等价 的字 符 串形 式
 如 果有 需要 标注可 以在运 行时使用 typing
gettypehints  进行 解 析
 在不 需要 这 种 解析 的通 常 情况 下标 注的存储 成本更低 因 为解 析器 只 需处理 较 短的 字符 串且启 动时 间更 短
 在 可 用性 方面 标注 现在支 持 向前 引 用 以 使以 下 句法 有效 class  c  classmethod  def  fromstringcls  source  str  c 
 由 于 此修改 会破坏兼 容性 在 python 3
7 中此 种 新的 行 为需 要在每个 模块 层级 上使用 future 导 入 来启用 from  future  import  annotations  它将在 python 3
10 中成为 默认行为
 参 见 pep 563 延迟 的标 注 求值 pep 由ł ukasz  langa 撰写 并 实 现
pep 538 传统 c  区域 强 制转换
python 3 系 列有一个 持续 的挑 战就 是 为处理7 比特位 ascii  文本的 假定 编 码确 定 合 理的 默认 策略 目前的 设定 是在 非 windows 平 台上 使用 默认 的 c  或 posix  区 域设置
pep 538更 新 了 默认 的解 释器 命令 行接口 以自 动将 上 述 区 域 强制 转 换为 可 用 的 基 于 utf 8的 区域具 体 描述 可参 见有关新 增 环 境变量 pythoncoerceclocale  的文 档
 以这 种 方 式自动设置 lcctype  意味 着 核心解 释器 和 能 感 知区 域 的 c 扩 展例如 readline  都 将会假定 utf 8 已被用 作默 认的文本 编码而 不 再是 ascii
pep 11 中的 平台 支持 定义也 已被 更 新 以 限制 完 整文 本处 理支持 适当配 置的 基于 非 ascii 的 语言 区 域
作 为此 更 改 的一部 分当 使用任何 已定 义的强 制 转 换目 标 区域 时目 前 为 c
utf 8 c
utf 8 和 utf 8 stdin  和 stdout 默 认的 处理 器现 在 将为 surrogateescape  而不是 strict
 而无 论 是什 么区 域 stderr 默认的 处理器 仍 为 backslashreplace
默 认情况 下 区 域 强 制转换 会 静 默进行但 为了 辅 助调试潜 在的 区域相关集 成 问题 可以通 过 设置 pythoncoerceclocalewarn  来请 求 显 式 地 启 用警 告 信 息 直接 在 stderr  上 发 出
此设 置还 会使 得 python  运 行时 在 核心 解释 器初 始化 时如 果传统 c 区 域仍 然处于 激活状 态时 发 出警 告
虽 然 pep 538的 区域强制 转 换的 好处 在于它 还会 同 时影 响扩 展 模 块 例如 gnu  readline  以及 子 进程 包括运 行非 python  应 用和 旧 版本 python  的 子 进程但它 也存在 需要 所运行 系统 必须 存在 适合 的目 标区 域 的 缺点
 为了更好 地处 理没有 可 用 适合的 目标 区 域 的情 况例 如在 rhelcentos 7上 就 会出现此 情 况 python 3
7还 实 现 了 pep 540强 制 utf 8运行 时模式
 参见 pep 538强 制转 换传 统 c  区域 到基 于 utf 8的 区 域 pep  由 nick  coghlan  撰 写并 实 现
pep 540强制 utf 8 运行 时模 式
新 的 x  utf 8命 令行 选项和 pythonutf 8环 境变 量可 被 用来 启用 cpython 的 utf 8模 式
当 处 于 utf 8 模 式时 cpython  会忽 略 区域 设置 并默 认 使用 utf 8 编码
用于 sys
stdin  和 sys
stdout 流的 错误处理 器将 设置为 surrogateescape
 强 制 utf 8 模 式可被用 来在 嵌入 的 python 解释 器中改变文 本处理行 为 而不会改 变嵌入方应 用的区 域设 置
pep 540 的 utf 8模 式的好处 是不 必 关 心运 行所 在 系统 中有 哪些 可用区 域即可工 作 但 它 也存 在对 扩 展模块例 如 gnu  readline 、运 行 非 python 应 用的 子进 程 以 及 运行旧版本 python  的子进 程不起作 用的 缺点
为 了减 小与 这些组件 通信时 破坏 文本数 据的风险 python 3
7还 实现 了 pep 540强 制 utf 8运 行时 模式
utf 8模 式在语言区 域为 c  或 posix 并 且 pep 538区域强 制转换特 性 无法将其 修改为 某种 基于 utf 8的 替 代项 时会被默 认启 用无 论 修 改 失败 是 由 于设置了 pythoncoerceclocale 0 lcall  还是 由于缺 少适 合的 目标 区 域
 参见 pep 540增 加了 新的 utf 8 模 式 pep 由 victor  stinner  撰 写并实现
pep 553内 置的 breakpoint
7 包 含了 新 的 内置 breakpoint  函数 作为 一种 简单方便 地进 入 python  调 试器 的 方式
内 置 breakpoint 会 调用 sys
 在默 认 情况 下后 者会导 入 pdb 然 后 再调用 pdb
settrace  但 是通过 将 sys
breakpointhook 绑 定到你选 定 的 函数 breakpoint  可以进入 任何 调试 器
此 外环境 变 量 pythonbreakpoint 可被设 置 为你 选定的调 试器的可 调用 对象
设置 pythonbreakpoint 0 会完 全 禁 用 内置 breakpoint
 参见 pep 553内 置的 breakpoint  pep  由 barry  warsaw 撰 写 并实 现
pep 539 用于 线 程局部 存储 的新 c  api
虽 然 python 已提 供了 用 于 线程 局部存 储支 持的 c  api 但 原 有的线 程局部存 储 tls  api  使用 int 来 表示 所有平台 上的 tls 密钥
 对于官 方 支 持的 平台 而 言 这通 常不是 问 题 但这既 不符 合 posix  标准 也 不具 备 任 何实 际 意义 上的 可移植性
pep 539 通 过 向 cpython  提 供 了一 个新的 线程 特定 存 储 tss  api 来 改变这一 点它取 代了原 有 的 cpython  内部 tls  api  的 使用 并 且原有 api  已弃用
 tss  api  使用 一种 新类 型 pytsst 而 非 int  来 表 示 tss 密 钥这 是一种不 透 明 类型 其定 义 可能 依赖于 下层 的 tls 实现
 因 此 这将 允许在 以 无法 安 全地 转换为 int 的 方式 定 义原生 tls  密 钥的 平台上构 建 cpython
请 注意在原 生 tls  密钥定义方 式无 法被 安全 地转 换 为 int 的平台 上 原 有 tls  api  中的 全部 函数 将无法执 行 并会 立 即 返回 失败 信息
这 样能 清楚 地表 明 原 有 api 在 无法 可靠 使用 的 平台上 不受 支 持 并且 不会 再尝 试添加 此 类 支持
 参见 pep 539 在 cpython 中 用 于 线 程局 部存储 的新 capi  pep 由 erik  m
 bray  撰 写由 masayuki  yamamoto  实 现
pep 562 定制 对模 块 属 性 的 访问
7允 许在 模 块 上 定义 getattr 并且 当 以 其他 方式 找不 到某个模 块 属 性时 将会 调 用 它
 在 模 块 上定 义 dir 现 在 也是 允许 的
 一个典 型 的可能 有用的 例子是已 弃 用 模块 属 性 和惰性 加 载
参 见 pep 562模块 的 getattr 和 dir  pep  由 ivan  levkivskyi  撰 写并 实现
pep 564具 有纳 秒级 精度 的新 时间 函数
现代 系 统 的时钟精 度 可 以 超 过 由 time
time 函 数 及其 变 化 形 式所返 回的浮点 数的有 限精 度
为 了 避 免精 度损 失 pep 564 在 time 模 块中 增加了 原有 计时 器 函数 的六 个新 纳 秒 版变 化形式 time
timens 这 些新函 数会 以整 数值 的 形式 返 回 纳秒 数
测 量表明 在 linux 和 windows 上 time
timens  的精 度大 约比 time
time  要 高3倍
参 见 pep 564增 加 具 有 纳秒 级 精 度的新 时间 函数 pep 由 victor  stinner  撰写 并实 现
pep 565在 main  中 显示 deprecationwarning
pep 560 对 typing  模 块 和泛 型类 型 的 核 心 支 持
pep 484最 初的 设计 方式使 其不 会 向核 心 cpython 解 释 器 引 入任 何更 改
现 在 类 型 提示 和 typing  模块 已 被社 区 广泛使 用 因 此这 个限 制已 被取 消
这 个 pep 引入 了两个特 殊方 法 classgetitem 和 mroentries  这 些方 法 现在 被 typing  中的大 多数类 和特 殊构 造 所使 用
结 果就 是 与类型 相关 的各 类操作 的速 度提升 了7倍 泛 型类 型可以 在 没有元 类 冲突的 情 况下 被使用 而 typing 模块中 几 个长期存 在的 错误 也已被 修正
参 见 pep 560对 typing  模块 和泛型类 型的 核 心支 持 pep  由 ivan  levkivskyi  撰写 并 实 现
pep 552 基于哈 希值 的 pyc 文件
pep 545 python  文 档翻 译
pep 545 描述 了创建 和维护 python  文档 翻译的 整 个过 程
新增 了 三个新 的 翻 译版 本日 语 httpsdocs
orgja  法语 httpsdocs
orgfr  韩语 httpsdocs
orgko 参 见 pep 545 python  文 档 翻译 pep 由 julien  palard  inada  naoki 和 victor  stinner  撰 写并 实现
python  开发模 式 x  dev
新的 x  dev  命 令 行选 项 或新的 pythondevmode  环 境变 量可 被用 来启 用 python 开发 模式
在 开发模 式 下 python  将执 行 额外的 如 果默 认启用 会 导 致开 销过 大的运 行 时 检查
请 参阅 python  开发 模式 文 档 查 看 完整 说明
 其他语言特 性 修 改
 await 表 达式 和包 含 async  for 子 句的推导式 不允许在格 式 化字 符串字 面值的表 达 式中 使用
在 python 3
7中此 限制已被 取 消
现在 可以将超 过255 个 参数 传 递给一个函 数 而现 在 一个 函 数 也 可以 拥有 超过255 个形 参
 由 serhiy  storchaka 在 bpo 12844和 bpo 18896 中贡献
 现 在 bytes
fromhex 和 bytearray
fromhex  会忽略所 有 ascii  空白符 而 非仅 是空格 符
 由 robert  xiao 在 bpo 28927中贡 献
 str  bytes  和 bytearray  获得了对 新 isascii 方 法 的 支持 该方法 可 被用 来 测试是 个字符串 或字 节串 是否 仅 包含 ascii  字 符
由 inada  naoki  在 bpo 32677中 贡 献
 现在 当 from 
失败 时 importerror 会显 示模 块名 称和模 块 file 路 径
由 matthias  bussonnier  在 bpo 29546中 贡 献
 现 在已 支持涉 及将子 模块 绑定到 一 个 名 称的 绝 对导 入的 循环导 入
由 serhiy  storchaka 在 bpo 30024中 贡献
 现 在 object
formatx 等 价于 strx 而 非 formatstrself 
由 serhiy  storchaka  d  bpo 28974中 贡 献
 为更 好 地支持栈 跟 踪 的动 态创 建现在 types
tracebacktype 可以 从 python 代码 中 被实 例 化 并 且回溯 对象 的 tbnext  属性现 在是可 写 的
 由 nathaniel  j
 smith  在 bpo 30579中贡 献
 当使 用 m  开关时 现 在 sys
path 0 会 主 动扩 展 为完 整 的 起始 目 录 路径 而 不是 保 持为空 目 录 这将 允许 在 发生导入时 从 当前 工作 目录 导 入由 nick  coghlan  在 bpo 33053 中贡献
 新 的 x  importtime  选项或 pythonprofileimporttime  环 境变 量 可被用 来显 示每 次 模块 导入的时 间
 由 victor  stinner 在 bpo 31415中 贡献

 新增 模 块
contextvars
新的 contextvars  模 块和一 组新 的 c  api 引 入了对 上 下文变 量 的支持
 上 下文 变量在 概念上 类 似于线 程 局 部变 量
与 tls  不同 上下文变 量能正确 地支持 异 步代 码
asyncio 和 decimal  已 得 到 更新以 使用 和支持 开 箱即 用的 上 下 文 变量
特 别 是激活 的 decimal  上下 文现在 将存储 在上 下文变 量中它 允 许十 进制运 算在异步 代 码 中 使 用正 确的 上 下 文
参 见 pep 567 上 下文变 量 pep  由 yury  selivanov  撰 写 并实现
dataclasses
新 的 dataclass 装 饰器 提供了 一种 声明数 据类 的方 式
 数据 类使 用变 量 标注来描 述其 属性
它 的 构造 器 和其 他魔 术方法例 如 repreq 以及 hash  会 自 动地 生 成
 示例 dataclass  class  point  x  float  y  float  z  float 0
0 参见 pep 557 数据 类 pep 由 eric  v
 smith  撰写并实 现
importlibresources
新 的 importlib
resources  模 块提 供了 一 些新 的 api 和一个 新 的 abc 用 于访问、 打开和 读取 包内 的资 源
资源基本 上类 似 于包 内 的文件 但它们 不一 定是 物理 文 件系统 中实 际的 文 件
模 块加 载器 可以 提供 getresourcereader 函数它会返回 一个 importlib
resourcereader  实 例 来支持这 个新 api
 内置 的文 件 路 径 加载 器和 zip  文 件加载器 都 支持此 特性
 由 barry  warsaw  和 brett  cannon 在 bpo 32248 中 贡 献
 参 见 importlibresources 用 于先 前 python  版 本 的 pypi 下层 接 口
改 进的模块
argparse
 新的 argumentparser
parseintermixedargs 方法 允许 混 合选 项与位 置参 数
 由 paul
j 3在 bpo 14191中 提供

asyncio
asyncio 模 块 获得 了 许 多 新的特 性、可 用性 和性能提 升
 重 要的改变 包括 新的暂定 asyncio
run  函数 可被用于 通过 自动 创 建和 销毁事 件循 环来基 于同 步代 码 运行 协 程
由 yury  selivanov  在 bpo 32314 中贡献
 asyncio 增 加支 持 contextvars
calllater  loop
callat 并 且 future
adddonecallback 具 有 新的可 选仅关键 字 参数 context 
 现 在 tasks 会 自动跟 踪其 上下文
 详 情参见 pep 567
由 yury  selivanov  在 bpo 32436中 贡献
 增加了 新的 asyncio
createtask 函 数作 为 asyncio
createtask  的快 捷 方式
 由 andrew  svetlov  在 bpo 32311中贡 献
 新的 loop
starttls  方 法可用 于升 级现 有的 tls  连 接
 由 yury  selivanov 在 bpo 23749 中 贡 献
新 的 loop
sockrecvinto  方法允许 直接 从 套接 字读 取数 据放 入 所 提供 的缓 冲区 从 而 可以 减 少数 据复 制
 由 antoine  pitrou  在 bpo 31819中贡 献
 新的 asyncio
currenttask 函 数 可 返回 当前 运 行 的 task  实 例以及 新的 asyncio
alltasks  函数可返 回 给 定循 环中所 有 现存 task  实 例的 集 合
 task
currenttask  和 task
alltasks  方法 已弃 用
由 andrew  svetlov 在 bpo 32250 中贡献
 新的暂 定 bufferedprotocol 类允 许 通过 手动 控制 接收缓 冲 区来 实现 流式协议
由 yury  selivanov  在 bpo 32251中贡 献
新 的 asyncio
getrunningloop 函 数可 返回 当前 运行 的循 环如 果 没有 循环在 运行 则引 发 runtimeerror
这 与 asyncio
geteventloop  不同后 者 在没 有循 环在运 行 时将创 建一 个 新的事 件循环
由 yury  selivanov  在 bpo 32269中提供
 新的 streamwriter
waitclosed  协程 方法 允 许 执行 等待 直到 流写入器被关 闭
新 的 streamwriter
isclosing 方 法可用于确定 写入 器是 否 被关 闭
由 andrew  svetlov 在 bpo 32391中 贡 献
新 的 loop
socksendfile 协程 方 法允许 在可 能的 情况 下使 用 os
sendfile  发送文 件
 由 andrew  svetlov  在 bpo 32410中贡献
 新的 future
getloop 和 task
getloop  方法 会 返回 创建 task  或 future  对 象 的事件 循环的 实 例
 server
getloop  允许为 asyncio
server  对象执 行同 样 操作
 由 yury  selivanov 在 bpo 32415 中以及 由 srinivas  reddy  thatiparthy 在 bpo 32418中 贡献
 现在可以控制 asyncio
server 的 实例 如何 开启 服务
 之前服务在创建 后将 立即 开启 服务
新的 startserving  关键字参数已添 加到 loop
createserver  和 loop
createunixserver 并 且 server
startserving 和 server
serveforever 可 被用来分 离服 务的 实例化和 服 务的开 启
 新 的 server
isserving 方 法会 在 服务 开启 时返 回 true
现 在 server  对 象已是异 步 上下文 管理器 srv  await  loop
 由 yury  selivanov 在 bpo 32662中贡 献
 由 loop
calllater  所返回的 回调 对象已获 得 新 的 when  方法该 方法 会 返回一 个排 入计 划 日程 的绝 对时间 戳
 由 andrew  svetlov  在 bpo 32741中 贡献
 loop
createdatagramendpoint 方 法已获得 对 unix 套接字的支持
 由 quentin  dawans 在 bpo 31245 中贡 献
 asyncio
createacceptedsocket 方法 及 其对 应 的 unix  套接 字变 体 现 在 接受 sslhandshaketimeout  关 键 字参 数
由 neil  aspinall  在 bpo 29970 中 贡献
新的 handle
cancelled  方法会 在 回调被 取 消时 返回 true
 由 marat  sharafutdinov 在 bpo 31943 中贡 献
 asyncio 源已 被 转换 为 使 用 asyncawait 语 法
由 andrew  svetlov  在 bpo 32193 中贡 献
新 的 readtransport
isreading 方 法可用于 确定 传 输 的读取状 态
此外对 readtransport
resumereading  和 readtransport
pausereading 的 调用现在 是 幂 等 的
由 yury  selivanov 在 bpo 32356中 贡 献
 接 受 套接字路 径的 循环方 法现 在支 持传入 路 径 类对 象
由 yury  selivanov 在 bpo 32066 中贡 献
在 asyncio  中 linux 上 的 tcp  套接 字现在创 建时默认 带 有 tcpnodelay  旗 标 设 置
由 yury  selivanov  和 victor  stinner 在 bpo 27456中 贡献
 在被 取消任务 中发生的 异 常不 会 再被记 录
由 yury  selivanov 在 bpo 30508 中贡 献
新 的 windowsselectoreventlooppolicy  和 windowsproactoreventlooppolicy  类
 由 yury  selivanov  在 bpo 33792 中贡献
 部分 asyncio  api  改为 已弃用
binascii
b 2 auu  函数 现在接受可选 的 backtick  关键 字 参数
当 其 为真值 时零 会以 而非空 格来表 示
由 xiang  zhang  在 bpo 30103中 贡献

calendar
htmlcalendar  类具有 新的 类属 性 可以 简化所生 成 html 日历 中 css 类的 自定 义
 由 oz  tiram 在 bpo 30095中贡 献

collections
namedtuple 现 在支 持默认值
由 raymond  hettinger 在 bpo 32320中贡 献

compileall
compiledir 增 加了新 的 invalidationmode  形参 可用于 启用 基 于 哈希 值的
pyc  有效 性检 测
失 效 模式 也 可 以 在 命令行 中 使 用新的 invalidationmode  参数来 指 定
 由 benjamin  peterson 在 bpo 31650 中贡献

concurrentfutures
processpoolexecutor  和 threadpoolexecutor  现在 支持 新的 初 始化器 以及 initargs  构造 器参 数
 由 antoine  pitrou  在 bpo 21423中 贡献
processpoolexecutor 现 在能 通过 新的 mpcontext 参 数来 接 受 多 进 程上下文
 由 thomas  moreau 在 bpo 31540 中 贡献

contextlib
 新的 nullcontext  是 一个 比 exitstack  更简单 和快 速 的无 操作上 下文管理 器
 由 jessebakker  在 bpo 10049 中 贡献
 增加了新 的 asynccontextmanager  abstractasynccontextmanager 和 asyncexitstack  以 补 充它 们所 对应的同 步 项
 由 jelle  zijlstra  在 bpo 29679和 bpo 30241 中以及 由 alexander  mohr  和 ilya  kulakov 在 bpo 29302 中 贡 献

cprofile
cprofile 命令 行 现 在接 受 m  modulename 作为脚 本 路 径的 替代
 由 sanyam  khurana 在 bpo 21862中 贡献

crypt
crypt  模 块现在 支 持 blowfish 哈 希方 法
由 serhiy  storchaka 在 bpo 31664 中贡 献
mksalt 函 数现 在允 许指 定哈 希操作 的轮数
由 serhiy  storchaka  在 bpo 31702 中贡 献

datetime
 新 的 datetime
fromisoformat  方 法 会基 于由 datetime
isoformat 所输出 的某一 特 定格式 字 符 串 构 建 datetime 对 象
 由 paul  ganssle 在 bpo 15873 中贡献
tzinfo  类现在 支 持 小 于 一分钟的 偏移 量
 由 alexander  belopolsky 在 bpo 5288 中 贡 献

dbm
dumb 现 在 支 持 读取只 读文 件 并且在 其未 改变 时不 再写入索 引 文 件
decimal
decimal  模块 现 在使 用 上 下文 变 量 来储 存 十进制值 上下 文
由 yuryselivanov  在 bpo 32630中 贡献

dis
dis  函数 现在 能够反 汇编嵌 套的代 码 对象 推导 式、 生成 器表达 式和 嵌套 函数 的 代 码以及 用 于构 建 嵌套类 的 代 码
反 汇编 递归的 最 大深 度由新的 depth 形参 来 控制
 由 serhiy  storchaka  在 bpo 11822 中 贡献

distutils
rst  现在包含 在 distutils 的标 准 readme 列 表之 中 因而也 包 含在 源 码发 布 之中
由 ryan  gonzalez  在 bpo 11913中贡 献

enum
functools
singledispatch  现在支 持 使用 类型标注 来注册 实 现
由ł ukasz  langa  在 bpo 32227 中 贡 献

gc
 新 的 gc
freeze 函数允 许 冻结由 垃圾回 收器所 跟 踪的 所 有对 象并 将 它们从未 来 的集 合中排 除
这可 以在 posix  fork 调 用 之前使 用以令 gc 友 好 地进行 写 入 时 复制 或 加速 收集
 新 的 gc
unfreeze 函数会 反 转此操 作
此 外 gc
getfreezecount 可被用 于获取 冻结对 象的 数量
 由 lizekun 在 bpo 31558中贡 献

hmac
hmac  现在具有 经优 化的一 次 性 digest  函 数 其速 度比 hmac  要快三 倍
由 christian  heimes  在 bpo 32433 中贡 献

httpclient
httpconnection 和 httpsconnection  现在 支持 新的 blocksize  参数 以 提 升 上 传 吞 吐 量
由 nir  soffer  在 bpo 31945 中贡献

httpserver
simplehttprequesthandler  现在 支 持 http  ifmodifiedsince 标头
 如 果目 标文 件 在该 标点指 定 的 时 间 之后 未 被修 改则服务 器会 返回304响应 状态
 由 pierre  quentel 在 bpo 29654 中贡献
simplehttprequesthandler  接受 新 的 directory 参 数 并增 加了 新的 directory  命 令行参数
 通 过此 形 参服务 器 可以 对服 务指定 目录默 认情 况下 它 使用当前 工 作 目录
 由 st é phane  wirtel 和 julien  palard  在 bpo 28707中 贡献
 新 的 threadinghttpserver 类使用 线 程来处理 使用 threadingmixin  的请 求
它会 在 http
server  附带 m 运 行 时被使用
 由 julien  palard  在 bpo 31639 中贡 献

idlelib 与 idle
多 个对自 动补全的 修 正
由 louie  lu  在 bpo 15786中 贡献
module  browser  在 file  菜 单中 之 前称 为 class  browser 现 在会 在 最高层 级 函数 和 类之 外显 示嵌 套的 函数 和类
由 guilherme  polo  cheryl  sabella  和 terry  jan  reedy  在 bpo 1612262中 贡献
settings 对 话框 options 中的 configure  idle  已经被部 分 重写 以 改进外 观和功能
 由 cheryl  sabella  和 terry  jan  reedy 在多个 问 题项中贡 献
 字体 样本 现在 包括一 组非 拉丁字 符以 便 用 户 能更 好 地 查 看所 选特定字 体 的效 果
 由 terry  jan  reedy 在 bpo 13802中 贡献
样本 可 以被修改 以 包括其他 字 符
由 serhiy  storchaka  在 bpo 31860中 贡献
 之前以 扩展 形式 实 现的 idle  特性 已作 为 正常 特性 重新实现
 它们 的 设置 已从 extensions  选 项卡 移至其 他对 话框 选项 卡
由 charles  wohlganger 和 terry  jan  reedy 在 bpo 27099 中实 现
 编辑器代 码 上下 文选项已 经过 修 改
 box  会显示 所 有上下文 行 直到最大行 数
点击 一 个上 下 文行 会使 编辑器 跳转到 该 行
自 定义主 题的上下文颜 色 已添加到 settings  对话 框 的 highlights 选 项卡
由 cheryl  sabella  和 terry  janreedy 在 bpo 33642 bpo 33768和 bpo 33679 中 贡献
 在 windows  上 会有新 的 api  调用 将 tk 对 dpi 的 调整告知 windows
在 windows 8
1或10 上 如果 python 二进 制码的 dpi 兼 容 属性 未改变 并且监 视器分辨 率 大于96 dpi  这应 该会令 文 本 和线 条更 清 晰
否 则 的话 它 应该 不 造 成 影响
 由 terry  jan  reedy  在 bpo 33656中 贡献
 在3
1中 新 增超 过 n 行 默 认值为50 的 输出将 被 折叠为一 个按 钮
 n 可 以在 settings 对 话 框 的 general 页 的 pyshell 部 分中进 行修 改
数 量较少 但是 超长 的 行 可 以通 过在 输 出上右 击来 折 叠
 被折叠的 输出 可通 过双 击按 钮来 展开 或是 通 过右 击按 钮来放 入剪贴板 或是 单 独 的 窗 口
由 tal  einat  在 bpo 1529353中 贡 献
上 述 修改 已被反 向移 植 到3
6维护发 行 版中
 在3
4中新 增 在 run 菜 单中 增加 了 run  customized  以使 用自 定义 设置 来运 行 模块
输 入 的任何命令行 参 数 都 会 被加 入 sys
 它 们在 下 次自定 义运 行时 会再 次显 示 在窗 体 中
 用户 也可 以 禁 用 通 常 的 shell  主模 块重 启
由 cherylsabella  terry  jan  reedy  等 人在 bpo 5680和 bpo 37627中 贡 献
在3
5中新 增在 idle  编辑 器窗 口中 增加 了可 选的 行序号
 窗 口打 开 时默 认不 带行序号除 非 在 配置 对 话框的 general  选项 卡中 进行设 置
已 打开窗 口中的 行 序号可 以在 options  菜单 中 显示 和隐 藏
由 tal  einat  和 saimadhav  heblikar 在 bpo 17535 中 贡 献

importlib
io
 新 的 textiowrapper
reconfigure 方法 可 用 于根 据 新 的设置 重 新配置 文本 流
由 antoine  pitrou 在 bpo 30526 以及 inada  naoki  在 bpo 15216中 贡献

ipaddress
methods  of  ipaddress
ipv 6 network  和 ipaddress
ipv 4 network  中 新 的 subnetof 以 及 supernetof  方 法可用 于网 络包 含 测 试
 由 michel  albert 和 cheryl  sabella 在 bpo 20825 中贡献

itertools
islice 现 在接 受类 整 数对 象作 为 start  stop  和 slice 参 数
由 will  roberts 在 bpo 30537中 贡 献

locale
locale
formatstring  中新 的 monetary  参数可用 于转 换所 使用 的 千位分 隔符 和 分 组字 符串
 由 garvit 在 bpo 10379中 贡献
 现在 locale
getpreferredencoding  函数 在 android  上或 是在 强制 utf 8模 式 下 总 是 返回 utf 8
logging
logger  实例 现在可以 被 pickle
 由 vinay  sajip 在 bpo 30520 中 贡献
 新的 streamhandler
setstream  方法 可用于 在句 柄 创建之 后替 换 日 志流
 由 vinay  sajip 在 bpo 30522 中 创 建
现 在可以 在传递 给 logging
fileconfig  的配置 信 息 中 对句柄 构造 器 指 定关 键字 参 数
由 preston  landers  在 bpo 31080中 贡献
math
新 的 math
remainder 函 数实 现 了 ieee 754 风格 的余 数运 算
由 markdickinson  在 bpo 29962中 贡 献

mimetypes
msilib
新的 database
close  方 法可 用于 关闭 msi  lastin  firstout  数据 库
 由 berker  peksag  在 bpo 20486中 贡 献

multiprocessing
新 的 process
close  方法 会显 式 地 关闭 进 程 对 象 并 释放 与其 关 联 的所有 资源
如 果 底层 进程仍 在 运 行 则将引发 valueerror
 由 antoine  pitrou 在 bpo 30596 中 贡献
新 的 process
kill 方 法可 用于 在 unix  上使 用 sigkill 信 号来 终 止进 程
 由 vitor  pereira 在 bpo 30794中 贡献
由 process  所 创建的 非守护 线程 现 在 会在进 程退 出 时被 合并
 由 antoinepitrou 在 bpo 18966 中 贡献

os
fwalk  现在 接受 bytes 类 型 的 path  参数
由 serhiystorchaka 在 bpo 28682 中贡献
os
scandir  已 获 得 对文件 描述 器的 支持
由 serhiy  storchaka  在 bpo 25996 中 贡 献
 新 的 registeratfork  函 数 允许注 册 python  回调以 便在 进程 分 叉 中 执行
由 antoine  pitrou 在 bpo 16500 中贡献
 增加 了 os
preadv  结 合 了 os
readv 与 os
pread  的 功 能以及 os
pwritev  函数 结合 了 os
writev 和 os
pwrite  的 功 能
由 pablo  galindo  在 bpo 31368中贡 献
os
makedirs 的 mode  参 数 不再 影 响新创建 的中间 层级 目 录的 文件 权限
 由 serhiy  storchaka  在 bpo 19930中 贡献
os
dup 2现 在会返 回新 的文 件描述 器
 之前返 回的 总 是 none
由 benjamin  peterson  在 bpo 32441中 贡献
 在 solaris 及 其派 生系统 上 os
stat 所返 回的结 构现 在会 包含 stfstype  属 性
由 jes ú s  cea  avi ó n 在 bpo 32659 中 贡 献

pathlib
在 posix  类系统 上新的 path
ismount 方 法现在 可用于 确定 一 个 路 径是否 为挂 载点
由 cooper  ry  lees  在 bpo 30897中 贡 献

pdb
settrace 现 在 接受 一个可 选 的限 关键 字参数 header
 如 果给出 它 会 在 调 试 开始 之 前被打 印到 控制 台
 由 barry  warsaw 在 bpo 31389中 贡献
pdb 命 令行 现在 接受 m  modulename  作为 对 脚 本 文 件的替 代
 由 mario  corchero 在 bpo 32206 中 贡 献

pycompile
compile  及 其 扩展 形式 compileall  现在 会通 过 无条件地 为基 于 哈 希值 的 有效 性验 证 创 建
pyc  文 件来支 持 sourcedateepoch 环境 变量
 这 样可以确 保当
pyc  文件 被主 动创 建时 可重 现 的 生 成
由 bernhard  m
 wiedemann 在 bpo 29708 中贡 献

pydoc
pydoc 服务 器现 在可 以绑 定到 由新 的 n  命 令 行参 数所 指 定 的 任意 主机 名
 由 feanil  patel 在 bpo 31128中 贡献

queue
 新 的 simplequeue  类是 一 个无界 的 fifo  lastin  firstout 队 列
 由 antoine  pitrou 在 bpo 14976中 贡 献

re
旗 标 re
locale  和 re
unicode  可 以 在 组的 范围 内 设 置
 由 serhiy  storchaka  在 bpo 31690中 贡献
re
split  现在 支持 基 于匹配 一 个空 字符 串 的 模 式 例 如 rb 或 进行 拆分
 由 serhiy  storchaka  在 bpo 25054 中 贡献
 使用 re
locale  旗 标 编译 的 正 则 表 达 式 不 再 依 赖 于编译时 的 区 域设 置
 区 域设 置 仅 在 已编 译 正 则 表 达式 被使 用时 才 被 应 用
 由 serhiy  storchaka  在 bpo 30215中贡 献
现 在如 果 一 个 正则 表 达式 包 含 语义 将在未来 发 生 改 变的字符 集 构 造则 会 引发 futurewarning  例如 嵌 套 集与 集合操作 等
 由 serhiy  storchaka  在 bpo 30349中贡献
 已编 译 正则 表 达 式 和匹 配对 象现 在可以使 用 copy
copy 和 copy
deepcopy 进 行拷 贝
由 serhiy  storchaka  在 bpo 10076中 贡献

signal
signal
setwakeupfd 函 数 新增 的 warnonfullbuffer 参 数 可 以指定 当 唤 醒缓 冲区溢出 时 python 是 否 要 在 stderr 上打印 警 告 信 息
 由 nathaniel  j
 smith 在 bpo 30050中 贡献

socket
 新增 的 socket
getblocking 方 法 会在套 接字 处 于 阻塞模 式时 返回 true  否 则 返回 false
 由 yury  selivanov  在 bpo 32373 中 贡献
新 的 socket
close 函 数 可 关 闭所传 入的套 接字文 件描述 符
应 该用此 函数来代 替 os
close 以 获得 更 好 的 跨平 台 兼容 性
 由 christian  heimes 在 bpo 32454 中 贡 献
socket  模 块现 在会 公 开 socket
tcpcongestion  linux 2
13 socket
37 以及 socket
12常量
 由 omar  sandoval  在 bpo 26273 以 及 nathaniel  j
 smith  在 bpo 29728中贡献
 已加 入对 socket
afvsock 套 接 字 的 支 持以允 许在 虚拟 机 及 其宿主 机之间进 行通讯
 由 cathy  avery 在 bpo 27584 中 贡 献
套 接 字 现 在默 认会 根据 文件 描 述 符自动 检测 所属族、 类型 和 协 议
 由 christian  heimes 在 bpo 28134 中 贡献

socketserver
serverclose  现在会等 待 所 有 非守 护线程完 成
serverclose  现 在会 等 待所有 子进程 完成
为 socketserver
forkingmixin  和 socketserver
threadingmixin  类增 加 了新 的 socketserver
forkingmixin
blockonclose 类 属 性
该类属 性 值设为 false  以保 持3
7之 前 的行 为
sqlite
现 在当 下层 的 sqlite 库版 本为3
6
11 及以上 时 sqlite 3
connection 会 开放 backup  方 法
由 lele  gaifax 在 bpo 27645中 贡 献
sqlite 3
connect  的 database  参数 现在接 受任何 pathlike  object 而 不是 只接受 字符 串
由 anders  lorentsen 在 bpo 31843 中贡献

ssl
string
template  现在 允许 你 有选择 地分 别 修 改 带 大括 号 的占位 符和不带 大括号的 占 位 符所对应 的 正 则表 达式 模式
 由 barry  warsaw 在 bpo 1198569中贡 献

subprocess
subprocess
run  函数 接受 新 的 captureoutput 关 键字 参数
当 其为 真值 时 将 会 捕获 stdout  和 stderr
 这相 当于 将 subprocess
pipe 作 为 stdout  和 stderr  参数 传入
 由 bo  bayles 在 bpo 32102 中 贡 献
subprocess
run 函 数和 subprocess
popen 构 造 器现 在接受 text  关键字 参数 作为 universalnewlines  的别名
 由 andrew  clegg  在 bpo 31756中 贡 献
在 windows 中 当重定 向标准 句柄时 closefds  的默 认值由 false  改为 true
 现 在 可 以在 重定 向标准 句柄 时 将 closefds 设为 真 值
参 阅 subprocess
这意 味 着现 在 closefds 在所 有受 支持 的平台 上默 认值均 为 true
 由 segev  finer  在 bpo 19764中 贡献
 在 subprocess
run  期 间或在 popen  上下 文管 理 器中 subprocess  模块现 在能 更优 雅地处 理 keyboardinterrupt
它现在 会等待一 小段时 间以 便子 进程 退出 然后 再 继续处 理 keyboardinterrupt 异 常
 由 gregory  p
 smith  在 bpo 25942 中贡 献

sys
 新增 sys
breakpointhook 钩 子 函 数供 内置 的 breakpoint  进行 调用
由 barry  warsaw  在 bpo 31353中 贡献
 在 android 中 新增 的 sys
getandroidapilevel 会 返回构 建时 的 androidapi 版本
 由 victor  stinner 在 bpo 28740 中 贡献
 新的 sys
getcoroutineorigintrackingdepth  函数 会返回 当 前 协程 的 由新 的 sys
setcoroutineorigintrackingdepth 所 设定 的 原始 跟 踪 深度
 asyncio  已转 换 为 使 用 这个 新 api 代 替已 弃 用 的 sys
 由 nathaniel  j
 smith 在 bpo 32591 中贡 献

time
pep 564向 time  模块 增加六 个具 有 纳秒 级精 度的 新函 数 time
timens 增加 了新 的时钟 标识符 time
clockboottime  linux 与 time
clockmonotonic  相似 不 同点 在于它 还包括 任 何 系统 挂起 的 时 间
clockprof  freebsd  netbsd 和 openbsd  高 精 度的分 进程 cpu  计 时器
clockuptime  freebsd  openbsd  该时 间 的绝 对值 是 系统 运行 且未 挂 起的时 间 提 供准 确 的正 常 运 行时 间度 量
新 的 time
threadtime 和 time
threadtimens  函 数可用 于 获取 每 线 程 的 cpu 时 间度 量
由 antoine  pitrou  在 bpo 32025中 贡献
新 的 time
pthreadgetcpuclockid  函数 会 返回特 定 线程 中 cpu 时 钟的 时钟 id
tkinter
 新的 tkinter
spinbox  类现 已可 用
由 alan  moore 在 bpo 32585 中贡 献

tracemalloc
traceback 的行 为更接 近正规的 回溯 会对所有 帧按从 最旧到 最 新来排 序
format 现在 接受负的 limit 并会 将结 果截 短 至 排 在第 abslimit 位的 旧帧
如 果要获 得 旧的行 为请 在 traceback
format 中使 用新 的 mostrecentfirst 参 数
 由 jessebakker  在 bpo 32121中 贡 献

types
新 的 wrapperdescriptortype  methodwrappertypemethoddescriptortype 和 classmethoddescriptortype 类 现已 可用
 由 manuel  krebber  和 guido  van  rossum  在 bpo 29377 以及 serhiystorchaka  在 bpo 32265中贡 献
 新的 types
resolvebases  函数 会以 pep 560 所规定 的 方式 动 态解析 mro  条 目
由 ivan  levkivskyi  在 bpo 32717 中贡献

unicodedata
 内 部 的 unicodedata 数 据库 已 升级 为 使用 unicode 11
 由 benjaminpeterson 贡献

unittest
 新 的 k  命令 行 选项 允许 通过名 称子 字 符 串 或 类 似 于 unix  shell 的 模 式来 筛 选测试 项
例 如 python  m  unittest  k  foo 将运行 footests
testsomething  bartests
testfoo  但不 会运行 bartests
 由 jonas  haag 在 bpo 32071中 贡献

unittestmock
现在 sentinel  属性会 在它们被 复制或 封存 时 保存 其标 识
由 serhiy  storchaka 在 bpo 20804中 贡献
新 的 seal 函 数允 许 mock 对 实例 进行 密封这将禁 止 进 一步 创建属性模拟
 密封会以递归 方式 应 用于 自身模拟的所 有属 性
由 mario  corchero 在 bpo 30541 中贡献

urllibparse
quote 已经从 rfc 2396 更新 为 rfc 3986将添 加到 默认情 况 下从 未引 用的字 符集
由 christian  theune  和 ratnadeepdebnath  在 bpo 16285 中 贡献

uu
uu
encode  函数 现 在接 受可选 的 backtick 关 键 字 参数
 当 其 为真时 零 会 以 而 非空 格来 表示
由 xiang  zhang  在 bpo 30103 中贡献

uuid
 新的 uuid
issafe  属 性会从 平台 中继有关 是 否 使 用多进 程 安全模 式 来 生 成所需 uuid  的信息
 由 barry  warsaw 在 bpo 22807中 贡献
uuid
getnode 现 在 更 倾 向于 统一 管理 的 mac 地 址而不 是本地 管理的 mac  地址
 这样 可 以 更 好 地 保 证 从 uuid
uuid 1 返 回的 uuid  的 全局 唯一 性
如 果 只有本 地 管 理的 mac 地 址可用则 返回 首个找 到 的 此 类地 址
 由 barrywarsaw 在 bpo 32107 中贡献

warnings
xmletree
find  方法 中的 elementpath 描 述 词现 在 可 以将 当前 节点 文 本 与
 text 进行 比较 而不 仅是 子节 点 中的文本
 描述 词还允 许 添加空 格 以 提高可 读性
 由 stefan  behnel  在 bpo 31648 中贡 献

xmlrpcserver
registerfunction 现 在可以被 用作 装饰器
 由 xiang  zhang 在 bpo 7769中 贡 献

zipapp
 函 数 createarchive 现 在接受 可选的 filter  参 数以 允 许 用 户选择 哪些文 件应被 加 入归 档包
由 irmen  de  jong  在 bpo 31072中 贡献
 函数 createarchive 现 在接受 可选的 compressed  参数以 生 成 压 缩归 档包
 另外 也加 入了 命令行 选项 compress  以 支 持 压缩
 由 zhimingwang  在 bpo 31638中 贡 献

zipfile
zipfile 现 在 接受新 的 compresslevel 形 参 以控制 压 缩级 别
 由 bobayles 在 bpo 21417 中 贡献
zipfile  所创建 的归档 包中 的子目 录现在 会按字母 表 顺 序保存
 由 bernhard  m
 wiedemann 在 bpo 30693中 贡献

c  api  的 改变
已 实现 了用 于线 程本地 存储的 新 api
 相关 概 述 请 参阅 pep 539用 于线程 局部存 储 的新 c  api  完整参 考文 档请 查 看 thread  specific  storage  tss  api
由 masayuki  yamamoto 在 bpo 25658中 贡献
新 的 上 下 文 变量 功能开 放了许 多 新 的 c  api
 新 的 pyimportgetmodule  函数 会 返 回 之 前所导 入 的 具有 给定名 称的模 块
 由 eric  snow  在 bpo 28411中贡献
 新 的 pyreturnrichcompare 宏 可以 简 化 丰 富比较函 数的 编 写
 由 petrvictorin 在 bpo 23699 中贡 献
 新 的 pyunreachable 宏 可 用 于 标记 不 可到达的 代码路 径
 由 barrywarsaw 在 bpo 31338 中 贡献
tracemalloc  现在通 过新 的 pytracemalloctrack  和 pytracemallocuntrack  函数 公 开 了 一 个 c  api
由 victor  stinner 在 bpo 30054 中贡 献
新 的 importfindloadstart 和 importfindloaddone  静 态 标 记可用于 跟 踪模 块导 入
由 christian  heimes  在 bpo 31574 中 贡 献
结构体 pymemberdef  pygetsetdef  pystructsequencefieldpystructsequencedesc  和 wrapperbase  的 字段 name  和 doc 现 在 的 类型为 const  char  而不 是 char 
 由 serhiy  storchaka  在 bpo 28761中 贡 献
pyunicodeasutf 8 andsize 和 pyunicodeasutf 8 的结 果类型 现在是 const  char 而非 char 
由 serhiy  storchaka  在 bpo 28769 中贡 献
pymappingkeys  pymappingvalues 和 pymappingitems  的 结 果现 在 肯定是列 表而 非可 能是 列 表也 可能 是元组
 由 oren  milman 在 bpo 28280中 贡 献
添 加了 函 数 pysliceunpack 和 pysliceadjustindices
 由 serhiy  storchaka  在 bpo 27867 中 贡 献
pyosafterfork  已 弃 用 建 议改 用 新的 functions  pyosbeforeforkpyosafterforkparent  和 pyosafterforkchild
 由 antoinepitrou 在 bpo 16500中 贡献
 曾经作为 公 共 api 一 部分 的 pyexcrecursionerrorinst 单 例 已被 移除 因 为它的 成 员永 远 不会 被 清 理可 能在 解释器 的最 终 化 过程中 导 致段错 误
由 xavier  de  gaye 在 bpo 22898 和 bpo 30697中 贡献
 添 加 c  api 对 使用 timezone 的 构造 器 pytimezonefromoffset 和 pytimezonefromoffsetandname 的 时区 的支 持以及通 常 pydatetimetimezoneutc 使 用 utc 单 例
由 paul  ganssle  在 bpo 10381中贡 献
pythreadstartnewthread  和 pythreadgetthreadident 的结 果类 型以 及 pythreadstatesetasyncexc 的 id  参数 类型 由 long 改为 unsigned  long
由 serhiy  storchaka  在 bpo 6532 中贡 献
现 在 pyunicodeaswidecharstring  如 果第二 个参数为 null  并且 wchart 字 符串包 含空字 符则 会 引 发 valueerror
由 serhiystorchaka  在 bpo 30708 中 贡献
 对启动顺序以及动 态内存分 配器 管理 的更改 意 味着 早 已记 录在 案 的对 在调 用大多数 c  api  函 数之 前调 用 pyinitialize 的 要求 的 依赖现 在变 得更 加强烈未 遵 循此要求 可能 导 致嵌 入式 应 用 程序 中 的段 错 误
 请参阅 此文 档的 移植 到 python 3
7一 节以及 c  api  文 档的在 python  初 始 化之 前 一节了 解更 多细节
新 的 pyinterpreterstategetid  会 返回给 定解 释器的 唯一 id
 由 eric  snow 在 bpo 29102 中贡献
现 在当 启用 utf 8模 式时 pydecodelocale  pyencodelocale  会使用 utf 8 编码
由 victor  stinner  在 bpo 29240中贡献
pyunicodedecodelocaleandsize 和 pyunicodeencodelocale  现在 会为 surrogateescape  错误句 柄使用 当前 区域 编码
由 victor  stinner  在 bpo 29240中 贡献
pyunicodefindchar 的 start 和 end  形参 的行 为现 在调 整为 与字 符串 切片 类似
 由 xiang  zhang 在 bpo 28822 中贡 献

构建的 改变
 性能 优化
 其他 cpython  实现 的改变
跟 踪钩子 现在 可以选择 不接 收 line 而是 选择 从解 释器 接收 opcode 事 件具 体做法 是在 被跟踪 的帧 上相 应地 设 置 新的 ftracelines  和 ftraceopcodes  属 性
由 nick  coghlan  在 bpo 31344中贡献
修复了一 些命名空 间包 模块 属 性的一致 性问 题
命 名空 间模 块 对象 的 file 被设 置 为 none 原 先未 设置对象 的 spec
origin 也 被设 置为 none  之前为字 符 串 namespace
 参 见 bpo 32305
 而且 命名 空间 模块对 象的 spec
loader  被设置 的值 与 loader 相 同 原 先 前者 被设 置为 none
参 见 bpo 32303
 locals 字典 现在 以变 量定义的 词法顺序 显示
 原 先未 定义 顺 序
由 raymond  hettinger 在 bpo 32690 中贡献
 distutils  upload 命 令 不会 再 试图将 行结 束 字符 cr  改为 crlf
 这修 复了 sdists 的 一个 以与 cr  等价 的字节结 束的 数据 损坏 问题
 由 bo  bayles  在 bpo 32304中贡献

 已弃 用的 python  行 为
 在 推导 式和生成 器 表 达式 中的 yield 语 句包 括 yield 和 yield  from 子 句现 在已弃用 最 左 端 的 for  子 句 中 的 可迭代 对象 表达式 除 外
 这确 保了 推 导式总是 立即返 回适 当 类 型的 容器 而不 是有可能 返 回 generatoriterator  对 象这样 生 成器 表 达式 不 会试 图将 它 们 的 隐式 输出 与任 何来 自 显式 yield 表 达 式的 输出 交错 起来
 在 python 3
7 中这 样 的 表达 式会 在编 译 时 引 发 deprecationwarning  在 python 3
8 中则 将引 发 syntaxerror
由 serhiy  storchaka  在 bpo 10544 中 贡献
从 object
complex  返回一个 complex  的 子类的行 为 已 弃用 并将 在 未 来 的 python  版本 中引 发错 误
这使 得 complex 的 行为 与 object
int 和 object
float 保持 一致
 由 serhiystorchaka 在 bpo 28894中 贡献

 已 弃用 的 python 模 块、函数和 方法
aifc
openfp 已 弃用 并 将在 python 3
9中被 移 除
请改用 aifc
open
 由 brian  curtin 在 bpo 31985中 贡 献

asyncio
 对 asyncio
lock 和其 他 asyncio 同步原 语的 await  实例 的 直接支持 已弃 用
想 要获 取并释 放同 步 资 源必 须使 用异步上 下文 管理 器
 由 andrewsvetlov  在 bpo 32253中 贡 献
asyncio
currenttask 和 asyncio
alltasks 方 法 已弃 用
由 andrew  svetlov  在 bpo 32250 中贡 献

collections
在 python 3
8 中 collections
abc 内的抽象 基类将不会 再通过 常 规的 collections 模块 公 开
这 有助 于 更清晰 地 区别 具体 类 与抽 象 基 类
由 serhiy  storchaka 在 bpo 25988中贡 献

dbm
dumb 现在支持 读取只 读 文件且当 其 未被 更改时 不会再写 入 索引 文件
现 在 如 果索 引 文 件丢失 并 在 r 与 w  模 式下 被 重新 创 建 则 会发出 已 弃 用警 告在 未来的 python  发 布版中将 改 为错 误
 由 serhiy  storchaka 在 bpo 28847中 贡献

enum
gettext
 使用非整数 值在 gettext  中选 择复数 形 式 现在 已弃 用
它从未 正确 地发 挥作 用
由 serhiy  storchaka  在 bpo 28692 中 贡献

importlib
 下 列方 法 metapathfinder
findmodule 被 metapathfinder
findspec  替代和 pathentryfinder
findloader  被 pathentryfinder
findspec  替 代 都 在 python 3
4 中 已 弃 用现 在会 引发 deprecationwarning
由 matthias  bussonnier 在 bpo 29576 中贡献 importlib
resourceloader  abc  已弃 用推 荐改 用 importlib
locale
format 已弃用 请改 用 locale
formatstring
由 garvit 在 bpo 10379中 贡献

macpath
macpath  现在已弃 用将 在 python 3
8 中 被 移 除
 由 chi  hsuan  yen 在 bpo 9850中 贡献

threading
dummythreading  和 dummythread 已 弃用
 构建禁用 线 程的 python  已不 再可 能
请 改用 threading
由 antoine  pitrou  在 bpo 31370 中贡 献

socket
socket
htons  和 socket
ntohs 中 的静默 参 数截 断 已弃 用
在 未来 的 python 版 本 中如 果 传 入 的参 数 长度大于16 比特位 将会 引 发异 常
由 oren  milman 在 bpo 28332中 贡献

ssl
wrapsocket  已弃 用
 请 改用 ssl
wrapsocket
 由 christian  heimes  在 bpo 28124 中贡献

sunau
openfp 已 弃用 并 将 在 python 3
9 中被移 除
请 改用 sunau
open
 由 brian  curtin 在 bpo 31985 中 贡献

sys
 已 弃用 sys
setcoroutinewrapper 和 sys
未 写 入文 档的 sys
callstats  函数 已弃用并将 在未来的 python  版 本中 被移除
由 victor  stinner  在 bpo 28799中 贡献

wave
openfp 已 弃用并将 在 python 3
9中被移除
 请改用 wave
open
 由 brian  curtin  在 bpo 31985 中贡 献

已弃 用 的 c  api  函 数和 类型
 如果 pylimitedapi  未设定或 设定为范 围在0 x 03050400和0 x 03060000 不含之间 或为0 x 03060100 或更 高的 值函 数 pyslicegetindicesex  已弃用 并被一 个宏 所 替代
 由 serhiystorchaka 在 bpo 27867 中 贡献
pyosafterfork 已 弃用
 请改用 pyosbeforeforkpyosafterforkparent  或 pyosafterforkchild
 由 antoinepitrou 在 bpo 16500 中贡 献

 平台支 持的 移除
api 与 特 性的 移除
 下列 特 性与 api 已从 python 3
7中移 除 os
statfloattimes 函 数已 被 移 除
 它在 python 2
3中 被 引 入 用 于向下 兼容 python 2
2 并自 python 3
1 起 就 已 弃 用
 在 re
sub 的 替换 模块中 由与一 个 ascii 字 母 构成 的未 知转 义 在 python 3
5中 已弃用 现在 将 会 引发 错误
 在 tarfile
add 中 移除了 对 exclude 参 数的 支持
 它在 python 2
7和3
2中已弃用
 请改用 filter 参 数
 ntpath 模 块中 的 splitunc  函 数在 python 3
1中 已弃 用 现在已 被移除
 请改 用 splitdrive 函数
namedtuple 不 再 支 持 verbose  形参 或 source 属性该 属性 会显 示 为 具名 元组 类所生成 的 源 代码
 这是 加速 类创 建 的 设 计优 化的一 部 分
 由 jelle  zijlstra  在 bpo 28638中 贡 献进 一 步的 改进由 inada  naoki  serhiy  storchaka  和 raymond  hettinger  贡献
 函数 bool  float  list  和 tuple 不 再接受 关键字 参数
 int  的第 一 个参 数 现在 只能 作为位 置参 数 传入
 移除了 之 前 在 python 2
4中 已弃 用的 plistlib  模块 的 类 plist  dict  和 internaldict
 作 为函 数 readplist  和 readplistfrombytes  返回 结果的 dict  值 现在 为 普通 dict
 你不 能 再使 用 属性 访问 来获取 这些 字 典的 项
 asyncio
socketpair 函 数 已 被移 除
 请 改用 socket
socketpair  函数 它自 python 3
5起就 在 所 有 平 台上 可 用
 asyncio
socketpair 在 python 3
5 及更 新版本 上 只是 socket
socketpair 的别名
 asyncio  不 再将 selectors  和 overlapped 模块导 出为 asyncio
selectors  和 asyncio
请 将 from  asyncio  import  selectors 替 换为 import  selectors
现 在 已禁 止 直接实例 化 ssl
sslsocket 和 ssl
sslobject  对象
相应 构造 器从未 写入 文 档、 也从 未作为 公有构 造 器进行测 试 或设计
用 户应 当 使 用 ssl
wrapsocket 或 ssl
 由 christian  heimes 在 bpo 32951 中贡 献
 未被 使用 的 distutils  installmisc 命 令 已被 移除
 由 eric  n
 vander  weele 在 bpo 29218 中贡 献

移除 的 模块
fpectl  模块 已被 移 除
它 从未 被默 认启 用从 未在 x 8664 上正确发挥 效 果并 且它 对 python  abi 的 改变 会导 致 c  扩 展 的意外 损坏
 由 nathanielj
 smith  在 bpo 29137中 贡献

windows  专属 的 改变
python  启 动 器 py
exe 可 以 接受32 位或64 位 标记而 不 必 同时指 定 一 个小 版 本
 因此 py 332和 py 364 与 py 3
732 均为 有效 并且现 在 还 接受 m 64和 m
n 64 来强 制使 用64 位 python  命令 即使 是 本 应使用32位 的时 候
如 果指定 版 本 不可 用则 py
exe  将报 错退 出
 由 steve  barnes  在 bpo 30291 中贡 献
 启动 器 可 以 运 行 py 0 来列 出已 安 装的所 有 python  默 认 版本 会 以星 号 标出
 运行 py 0 p 将同时 列 出相 应 的路 径
 如 果运行 py 时 指定 了 无 法 匹配的 版 本它 将显 示简短 形式 的可 用版 本 列表
 由 steve  barnes 在 bpo 30362 中贡献

移 植 到 python
本 节列 出 了 先前 描述 的更 改 以及 可能需 要更改代 码的 其他错 误修 正
python 行 为 的更 改
更改 的 python  api
c  api  中 的改 变
函 数 pyslicegetindicesex 被 认为 对 于大 小可 变的 序 列 来说 并不 安 全
 如果 切片 索引 不是 int 的 实 例 而是 实 现 了 index  方法 的对 象则 序列 可 以 在 其 长 度被 传 给 pyslicegetindicesex  之 后 调整 大小
 这可能 导致 返 回超 出 序列 长度的索引 号
 为了 避 免可 能的 问题 请 使 用 新 增的 函数 pysliceunpack  和 pysliceadjustindices
由 serhiystorchaka 在 bpo 27867 中贡 献

cpython 字 节 码的 改变
 新增 了两 个 操作 码 loadmethod  和 callmethod
 由 yury  selivanov 和 inada  naoki  在 bpo 26110 中 贡 献
storeannotation 操 作码 已被 移除
由 mark  shannon  在 bpo 32550 中 贡献

windows 专 属 的 改变
用于重 载 sys
path  的 文件 现 在命 名为 pythonexecutable
pth  而不是 sys
请参 阅 查找 模 块了 解更 多信 息
 由 steve  dower  在 bpo 28137 中 贡献

 其他 cpython  实现的 改变
 为了 准 备在 未来 对公 开的 cpython  运 行 时 初始 化 api 进 行潜 在更 改 请 参阅 pep 432获 取 最 初但略为过 时 的 文稿 cpython  内 部 的 启动 和配置 管 理 逻辑已 经过大 幅 重 构
 虽然 这 些更 新旨 在 对嵌入 式 应用 程 序和 常规 的 cpythoncli 用户 都完全透 明但它 们在 这里被提及是 因为重 构会 改 变解 释 器启动 期间 许多操作 的内 部 顺 序因 此可能 提 示出原 先隐 藏 的 缺 陷这可能存 在 于嵌 入式 应用程 序中 或是 在 cpython 自 身内 部
最 初由 nick  coghlan  和 eric  snow 作为 bpo 22257的一 部 分贡 献 并由 nick  eric  和 victor  stinner 在一 系列 其他 问题报 告中进一 步 更 新
已知会 受到 影 响的 一 些 细节 pysysaddwarnoptionunicode  目 前对 嵌入式应用程 序 不 可 用 因为在 调用 pyinitialize  之 前需 要创 建 unicode  对象
请改用 pysysaddwarnoption
 嵌入式 应用 程序 通 过 pysysaddwarnoption 所添加 的 警告 过 滤器 现在 应该 以 更高 的一 致性 优 先于 由 解 释器 所设 置的 默 认过滤器 由于 默 认警 告 过滤 器的 配置 方式 发生了变 化将 pybyteswarningflag 设 置 为大 于 一 的值 不再 足 以在发 出 byteswarning 消息的 同时 将 其 转换为异 常
而是改 为 必 须设置旗 标 以便 首 先 发出 警 告以 及添 加显 式的 errorbyteswarning  警告 过滤器 来将其转换 为异常
由于 编 译器 处理文档 字符串 的方 式 发生了 变 化 一 个仅 由文档字 符 串 构 成的 函数 体 中隐 式 的 return  none 现 在被 标 记 为在与 文 档字 符 串 相 同 的 行而不 是 在函 数的标题 行
 当前 异常 状态 已从帧对 象移到 协程 对 象
这 会简 化解 释 器 并修 正由 于在 进 入或退 出生 成器 时具有交 换异 常状态而导致 的一些模 糊错 误
由 mark  shannon  在 bpo 25612中贡献

python 371中 的重 要变 化
从3
1开 始 pyinitialize 现 在 始终会读 取 并遵循与 pymain  相 同的 环境设置在 更早 的 python  版本 中 它会遵 循 一个错 误 定 义 的环 境 变量 子集而在 python 3
0中 则会由 于 bpo 34247 而 完全 不读取它 们
如 果不 想要此 行为 请在 调用 pyinitialize  之前将 pyignoreenvironmentflag  设为1
在3
1 中 上 下文变 量 的 c  api 已 获得更新 以使 用 pyobject 指针
另 请参阅 bpo 34762
在3
1中 当提供不带 末尾新行 的输入时 tokenize  模块 现在 会隐 式 地添 加 newline 形符
 此行 为 现在 已 与 c 词 法 分析 器 的内 部行 为相 匹配
由 ammar  askar  在 bpo 33899 中贡献

python 372 中的重 要变化
 在3
2 中 windows 下 的 venv  不再 复制原 来的 二进 制文件 而是 改为创 建名为 python
exe  和 pythonw
exe  的重 定向 脚本
 这解 决了 一 个长 期 存在 的问 题 即所 有 虚拟环境 在每 次 python 升 级后都 必须进 行升级 或是 重新 创建
然 而要注 意 此发 布版 仍 然要求 重新 创建 虚 拟 环境 以获 得新 的 脚本
python 376中 的重 要变化
出 于重 要的 安全性 考量 asyncio
createdatagramendpoint  的 reuseaddress  形参 不再 被 支持
 这是 由 udp  中 的套接字 选 项 soreuseaddr  的 行为 导致的
 更多细 节 请参 阅 loop
createdatagramendpoint  的 文档
 由 kyle  stanley  antoinepitrou  和 yury  selivanov  在 bpo 37228中贡 献

python 38有 什么 新变 化
 编者 raymond  hettinger 本 文 解释 了 python 3
8 相比3
7 的新增 特 性
 完整 的详 情 可 参阅 更 新日志
 摘要发 布 重点
新 的特 性
 赋值 表 达式
 新增 的 语法 可在表达 式内部 为变 量赋 值
它 被 昵称为 海 象运 算符因为 它很像 是海 象的 眼睛 和 长 牙
在 这 个示例 中 赋值 表达式 可 以 避免 调用 len  两 次 if  n  lena 10 printflist  is  too  long  n  elements  expected 10 类似 的 益处还 可出现在 正则表 达式 匹配 中需 要 使 用两 次 匹配对 象 的 情 况中 一次检 测用于匹 配是 否发 生另 一次 用 于提 取子 分组 discount 0
0 此 运算 符也适用 于 配合 while 循 环 计 算一 个值 来 检测循 环 是否 终止而同 一个值 又在 循环体 中 再 次 被使 用的 情况 loop  over  fixed  length  blocks  while  block  f
read 256 processblock  另一 个值 得介 绍的 用例 出 现 于列 表 推 导式 中在 筛选 条 件 中 计算 一个 值 而同一个 值 又 在 表 达 式 中 需要 被 使 用 cleanname
title  for  name  in  names  if  cleanname  normalizenfc  name  in  allowednames 请 尽量 将 海象 运算 符的 使用限 制在 清晰的 场合中 以 降低 复 杂性 并提 升可 读性
 请参阅 pep 572 了 解 详情
由 morehouse  在 bpo 35224中 贡献

仅限 位置 形参
 新增了 一个 函数形参 语法 用来指明某 些函 数形参 必须使 用仅限 位 置而 非关 键 字参 数的 形式
 这种 标记语法与 通 过 help 所 显示 的使用 larryhastings 的 argument  clinic  工 具标记 的 c  函数 相同
 在下 面的 例子中形参 a  和 b  为仅限 位置 形参 c 或 d  可 以是 位置 形参 或关 键字 形参而 e 或 f 要 求为 关键字形 参 def  fa  b  c  d  e  f  printa  b  c  d  e  f 以 下 均为合 法的 调用 f 102030 d 40 e 50 f 60 但是以下均为 不合 法的调用 f 10 b 20 c 30 d 40 e 50 f 60 b  cannot  be  a  keyword  argument  f 1020304050 f 60 e  must  be  a  keyword  argument 这种 标 记形式的一个 用例是 它 允许 纯 python  函 数 完整 模 拟 现 有的 用 c 代 码编写的函数 的 行 为
例如 内置 的 divmod  函数 不 接受关 键 字 参数 def  divmoda  b  emulate  the  built  in  divmod  function  return  a  b  a  b 另 一 个用例 是在 不需 要形参名 称 时 排除 关 键字参 数
 例 如内置 的 len  函数的 签名 为 lenobj 
这 可以排除如 下这 种笨拙的调用 形 式 lenobjhello  the  obj  keyword  argument  impairs  readability  另一 个益 处是将形 参标 记为仅 限位置 形参将 允许 在 未 来 修改 形参 名而 不会破坏客 户 的代码
 例 如 在 statistics  模 块 中 形参 名 dist 在 未来 可 能 被修改
 这使 得以 下 函 数 描述 成为 可能 def  quantilesdist  n 4 methodexclusive 
 由 于 在左侧 的形 参不会被 公 开为可 用 关键 字 其 他形 参 名仍可在 kwargs 中 使 用 def  fa  b  kwargs 
 f 1020 a 1 b 2 c 3 a  and  b  are  used  in  two  ways 1020 a 1 b 2 c 3这 极 大 地 简化了 需要 接 受任意 关 键 字 参 数 的函数 和 方法 的实 现
例 如以 下是 一段 摘 自 collections  模块的代 码 class  counterdict  def  initself  iterablenone  kwds  note  iterable  is  a  possible  keyword  argument  请 参阅 pep 570 了 解 详 情
由 pablo  galindo  在 bpo 36540中 贡 献

 用 于 已 编译字 节码 文 件 的并 行 文件 系统 缓 存
 新增的 pythonpycacheprefix 设 置 也可 使用 x  pycacheprefix 可 将 隐 式 的字 节码 缓存 配 置 为使 用单 独的 并 行 文 件系 统 树而 不 是 默认 的 每个源 代码目 录下的 pycache  子 目录
 缓 存的 位置 会 在 sys
pycacheprefix  中报告 none  表示默 认位置 即 pycache  子 目录
由 carl  meyer 在 bpo 33499 中贡 献

调试 构 建使 用与 发布 构 建 相同 的 abi
python  现在 不论是 以发 布模式 还 是调试 模式进 行构 建 都将 使用 相 同 的 abi
在 unix 上 当 python 以 调试 模式 构建 时现在将 可以 加 载以发 布 模式构 建的 c 扩展和 使用 稳 定版 abi 构 建 的 c 扩 展
发 布构建 和调 试构 建现 在都 是 abi 兼 容 的定义 pydebug  宏不会 再 启用 pytracerefs  宏 它引 入了 唯一的 abi  不兼 容性
 pytracerefs 宏添加 了 sys
getobjects 函 数和 pythondumprefs  环境 变量它可 以使 用 新的
configure  withtracerefs  构建 选 项来 设置
 由 victorstinner 在 bpo 36465中 贡献
在 unix  上 c 扩展不 会 再 被链接到 libpython 但 android  和 cygwin 例 外
现在 静态链 接 的 python 将 可 以 加载使 用共 享 库 python  构建 的 c 扩 展
由 victor  stinner  在 bpo 21536中 贡 献
 在 unix 上 当 python  以调 试模式 构建 时导入 操 作 现 在也 会查 找在 发布模式 下编 译 的 c 扩 展以 及 使用 稳定 版 abi 编译 的 c  扩展
 由 victor  stinner 在 bpo 36722 中贡献
 要将 python  嵌入 到一 个 应用 中 必 须 将新 增 的 embed 选 项传 给 python 3 config  libs  embed 以 获得 lpython 3
8 将 应用 链接 到 libpython
要 同 时 支持3
8和旧 版 本 请 先尝 试 python 3 config  libsembed 并在此 命 令失 败 时 回退 到 python 3 config  libs 即 不带 embed
 增加 一 个 pkgconfig  python 3
8 embed 模块 用 来将 python  嵌 入到 一个 应用中 pkgconfig  python 3
8 embed  libs  包 含 lpython 3
要 同 时支 持3
8 和旧 版本 请 先尝 试 pkgconfig  pythonx
yembed  libs  并在 此 命令失 败时回退到 pkgconfig  pythonx
y  libs 即 不带 embed  请将 x
y  替换 为 python  版本号
 另一方 面 pkgconfig  python 3
8 libs 不 再包 含 lpython 3
 c 扩 展不 可被链接 到 libpython  但 android 和 cygwin 例 外这 两 者的 情 况由 脚 本处 理此 改变 是 故意 被设 为 向 下 不兼 容的
 由 victor  stinner 在 bpo 36721 中贡 献

f  字符 串支 持 用于 自 动 记 录表 达式 和调 试文档
增 加 说 明 符用 于 fstring
 形式为 fexpr 的 f  字 符串将扩 展表示为 表达 式文 本加 一 个等 于号再 加 表 达 式 的求值结 果
例如 user  ericidle  membersince  date 1975731 fuser  membersinceuserericidle  membersincedatetime
date 1975731通 常的 f  字符串 格 式说 明符 允许 更 细致地控 制 所 要显示的 表达 式结果 delta  date
days 16075说 明符 将 输 出整个表 达 式 以便详细 演示 计算 过 程 printftheta  cosradianstheta
866由 eric  v
 smith  和 larry  hastings 在 bpo 36817中 贡 献

pep 578 python 运行 时审核 钩 子
pep 587 python  初始化 配 置
pep 587 增加 了一 个新 的 c  api  用来 配置 python  初始化提 供对 整 个 配 置 过 程的 更细 致控 制 以及 更 好 的错误 报 告
新 的结 构 pyconfig  pypreconfig  pystatus  pywidestringlist  新的 函数 pyconfigclear  pyconfiginitisolatedconfig  pyconfiginitpythonconfig  pyconfigread  pyconfigsetargv  pyconfigsetbytesargv  pyconfigsetbytesstring  pyconfigsetstring  pypreconfiginitisolatedconfig  pypreconfiginitpythonconfig  pystatuserror  pystatusexception  pystatusexit  pystatusiserror  pystatusisexit  pystatusnomemory  pystatusok  pywidestringlistappend  pywidestringlistinsert  pybytesmain  pyexitstatusexception  pyinitializefromconfig  pypreinitialize  pypreinitializefromargs  pypreinitializefrombytesargs  pyrunmain  此 pep 还为这 些 内部 结 构添 加了 pyruntimestate
preconfigpypreconfig  类型和 pyinterpreterstate
config  pyconfig  类 型 字段
config  成 为 新 的引 用配置替 代全 局配置 变量 和其 他私有变 量
请参 阅 python  初始 化 配置获 取详 细 文档
请参 阅 pep 587了 解 详情
 由 victor  stinner 在 bpo 36763中贡 献

pep 590 vectorcall 用 于 cpython 的快 速调用 协议
具有 外部数据 缓冲 区 的 pickle  协议
 当使用 pickle 在 python 进 程间 传输 大 量数 据 以 充分发 挥多核或 多 机处 理的 优 势 时 非常重要 一 点是 通过减 少内存 拷贝来优化 传 输 效率 并 可 能应 用一些定 制 技 巧例如针 对特 定 数 据 的 压缩
pickle  协议5 引入了 对于外部缓 冲 区的 支持 这 样 pep 3118兼 容的 数据 可 以与 主 pickle 流 分开 进 行传输 这是由 通信层 来确定的
 请参阅 pep 574了 解 详情
由 antoine  pitrou  在 bpo 36785 中贡 献

其 他 语言 特性 修 改
在 之前 版 本中 continue  语句 不允 许在 finally 子 句中使 用这是 因 为具 体实现存在 一个问 题
在 python 3
8 中此 限 制已 被取消
 由 serhiy  storchaka 在 bpo 32489 中贡 献
 bool  int 和 fractions
fraction 类型现 在 都 有 一个 asintegerratio  方法与 float 和 decimal
decimal 中 的 已有 方 法类似
这 个微 小的 api  扩展 使 得 numerator  denominator  x
asintegerratio 这 样的写法 在多 种 数字类型 上通用成 为 可 能
 由 lisa  roach 在 bpo 33073 和 raymond  hettinger 在 bpo 37819中 贡献
 int  float  和 complex 的 构造 器 现在 会使用 index 特 殊方 法如 果该 方法 可用 而对 应的方 法 method  int  float 或 complex  方法 不 可 用的话
 由 serhiy  storchaka 在 bpo 20092 中 贡 献
添 加 nname  转义符 在 正则 表达 式中的 支 持 notice  copyright ©2019 copyrightyearpattern  re
group 12019由 jonathan  eunice  和 serhiy  storchaka  在 bpo 30688 中贡献
 现 在 dict  和 dictview 可 以使 用 reversed  按插 入顺序反 向迭代
由 r é mi  lapeyre  在 bpo 33462中贡献
 在函数 调用中 允 许使 用的关 键 字 名称语 法受到 进一 步的 限 制
特 别 地 fkeywordarg  不 再被允 许
关键字 参数 赋值形式的 左侧 绝不允 许一般标 识符以外 的其他 内容
 由 benjamin  peterson 在 bpo 34641中 贡 献
 在 yield 和 return  语 句中 的一般可 迭代 对象 解包 不再要 求加 圆括 号
 这 使得 yield  和 return 的语 法与 正常 的赋值语 法 更为一致 def  parsefamily  lastname  members  family
upper  members  parsesimpsons  homer  marge  bart  lisa  maggie  simpsons  homer  marge  bart  lisa  maggie  由 david  cuthbert  和 jordan  chapman 在 bpo 32117中贡 献
当 类 似10203040 这样 在 代 码中少了一 个逗 号 时 编译器 将显 示 syntaxwarning 并 附 带 更有 帮助的提 示
这 相 比 原来 用 typeerror 来 提 示 第 一 个 元 组是 不 可调 用的 更容 易 被 理 解
由 serhiy  storchaka  在 bpo 15248中 贡献
 datetime
date  或 datetime
datetime  和 datetime
timedelta 对 象之 间 的算术运 算现 在将 返回 相 应子类 的 实例 而不 是 基类 的实 例
这 也会影响 到 在 具体 实现中 直 接或间 接 地 使用了 datetime
timedelta  算术运 算的 返回 类 型 例如 astimezone
 由 paul  ganssle  在 bpo 32417中贡 献
当 python  解释器 通过 ctrlc  sigint 被 中 断并 且 所产 生 的 keyboardinterrupt  异 常未 被 捕 获 python  进程 现在会 通过 一个 sigint  信 号 或 是 使 得发 起 调用 的进 程能检 测到它 是 由 ctrlc 操 作 杀 死 的 正确 退出 代码 来退出
 posix  和 windows 上 的终 端会 相应 地 使 用 此代码在 交互式 会话中 终止 脚 本
 由 google  的 gregory  p
 smith  在 bpo 1054041 中 贡 献
某 些 高级编程 风格要 求 为现 有 的 函数 更新 types
codetype 对象
 由于 代 码对 象 是不 可变的 需 要基 于现 有 代 码对 象模型 创建 一个 新的 代 码 对象
 使用19个 形参 将会 相当繁 琐
现 在新的 replace  方法 使得 通过 少量 修 改的 形 参创 建 克隆 对象成 为 可 能
 下 面是一 个修 改 statistics
mean 函 数来防止 data  形参 被 用 作关 键字 参数 的 例子 from  statistics  import  mean  meandata 10209040 mean
 typeerror  mean  got  some  positionalonly  arguments  passed  as  keyword  arguments  data  由 victor  stinner 在 bpo 37032 中贡献
 对于 整 数 现在 pow  函数 的 三参数形 式在底数 与 模数 不可约 的情况 下允许 指数 为负 值
随后 它 会在 指数为1 时计算 底数的模 乘逆元并 对其 他负 指 数计算反 模 的 适当 幂次
 例如要计算38 模137的 模 乘逆 元则 可写为 pow 381137119119381371 模乘 逆元在求 解 线性 丢番 图 方程 会被 用到
例 如 想要 求 出4258𝑥147𝑦369的 整 数解 首先应 重写 为4258𝑥≡369 mod 147然后求 解 x 369 pow 42581147147 y 4258 x 3691474258 x 147 y 369 由 mark  dickinson 在 bpo 36027中 贡献
 字典 推 导式 已与 字典 字面值 实现 同步 会先 计算 键再 计 算值 dict  comprehension  cast  inputrole  inputactor  for  i  in  range 2 role  king  arthur  actor  chapman  role  black  knight  actor  cleese  dict  literal  cast  inputrole  inputactor  role  sir  robin  actor  eric  idle 对执 行 顺 序的保证 对 赋 值表 达式 来说 很有 用 因为 在 键 表达 式中 赋值 的 变 量将可 在值 表达 式中 被 使用 names  martin  von  l ö wis ł ukasz  langa  walter  d ö rwald  n  normalizenfc  name
casefold  n  for  name  in  names  martin  von  l ö wis  martin  von  l ö wis ł ukasz  langa ł ukasz  langa  walter  d ö rwald  walter  d ö rwald  由 j ö rn  heissler 在 bpo 35224 中 贡 献
 object
reduce  方法 现在 可返 回长 度为 二至 六 个元 素的 元组
 之前 的 上限 为五个
 新 增的 第六个 可选 元素是签 名为 obj  state  的可调用 对象
这样 就允许 直接 控制特 定对 象 的 状 态更新
如 果元 素值不为 none 该 可调用 对象将优 先 于对 象的 setstate  方法
 由 pierre  glaser 和 olivier  grisel 在 bpo 35900 中 贡 献

新 增模块
 改进 的模 块
ast
ast  节点现在 具有 endlineno  和 endcoloffset  属性它 们 给出节点 结束的精确 位置
这 只适用于 具 有 lineno 和 coloffset 属性 的节点
新 增 函 数 ast
getsourcesegment 返 回指 定 ast 节 点 的源 代码
 由 ivan  levkivskyi 在 bpo 33416中贡献
ast
parse  函数 具有 一些新的 旗标 typecommentstrue  导致 其返 回与特定 ast  节点 相关 联 的 pep 484 和 pep 526 类型 注 释文 本 modefunctype  可被用 于解析 pep 484签 名类 型注 释 为函 数定 义 ast  节 点而 返 回 featureversion 3 n  允许 指定一 个更早 的 python 3版 本
 例如 featureversion 34将把 async  和 await 视 为非保留 字
 由 guido  van  rossum 在 bpo 35766 中 贡 献

asyncio
run 已 经从 暂 定状 态晋级为稳 定 api
 此函 数 可被 用于 执行 一个 coroutine 并返回结果 同 时 自 动管 理 事件循环
 例如 import  asyncio  async  def  main  await  asyncio
runmain  这大 致等 价于 import  asyncio  async  def  main  await  asyncio
close 实 际的 实现要 更 复杂 许多
因 此 asyncio
run  应该 作为运行 asyncio  程序的首 选方式
由 yury  selivanov  在 bpo 32314 中贡 献
 运行 python  m  asyncio  将 启 动一个 原生 异步 repl
这允 许快 速体 验 具有 最 高层 级 await 的 代码
 这 时 不再 需 要 直接 调用 asyncio
run  因 为 此操 作会 在每 次 发起 调用 时产生一 个 新事件 循 环 python  m  asyncio  asyncio  repl 3
sleep 10 resulthello  hello 由 yury  selivanov 在 bpo 37028 中贡献
 异 常 asyncio
cancellederror  现 在 继 承自 baseexception 而不 是 exception  并 且不 再 继 承自 concurrent
 由 yury  selivanov  在 bpo 32528 中 贡献
 在 windows 上现在 默 认 的 事 件 循环为 proactoreventloop
 由 victorstinner  在 bpo 34687 中 贡 献
proactoreventloop 现 在 也支 持 udp
由 adam  meily  和 andrew  svetlov  在 bpo 29883 中贡 献
proactoreventloop  现 在可 通过 keyboardinterrupt  ctrlc  来 中断
由 vladimir  matveev 在 bpo 23057 中 贡 献
添 加了 asyncio
getcoro  用来获 取 asyncio
task 中的 已包 装协 程
由 alex  gr ö nholm  在 bpo 36999中 贡 献
asyncio 任 务 现 在 可 以被命名 或者 是 通过 将 name 关键字 参数 传给 asyncio
createtask  或 createtask  事 件循 环方 法或 者 是通 过在任 务 对 象 上调用 setname  方 法
任 务 名 称在 asyncio
task  的 repr 输出 中 可 见 并且 还 可以 使用 getname  方法 来 获 取
 由 alex  gr ö nholm 在 bpo 34270 中贡献
将 对 happy  eyeballs  的 支持添 加到 asyncio
 要 指定 此行为 已增 加了 两个 新 的形 参 happyeyeballsdelay 和 interleave
 happy  eyeballs  算法可 提 升 支持 ipv 4 和 ipv 6的 应 用的响 应速度 具 体 做 法 是 尝 试 同 时 使 用两者 进 行 连接
 由 twisteroid  ambassador 在 bpo 33530 中贡 献

builtins
collections
collections
namedtuple 的 asdict  方 法现 在将返 回 dict 而 不是 collections
此项 更 改是 由于 普通字典 自 python 3
7 起 已 保 证 具 有 确 定的元素 顺 序
 如 果 还 需 要 ordereddict  的 额 外特 性 建 议 的解 决 方案是 将 结果转换 为 需要 的 类 型 ordereddictnt
由 raymond  hettinger 在 bpo 35864中贡 献

cprofile
cprofile
profile 类 现 在 可被用 作 上下 文管理 器
 在运 行 时对一 个代 码 块实 现 性能分析 import  cprofile  with  cprofile
 由 scott  sanderson 在 bpo 29235 中 贡献

csv
csv
dictreader  现在 将返 回 dict  而不 是 collections
此 工 具现在 会更快 速且 消 耗更少 内存同 时 仍然保留 字段顺序
 由 michaelselik 在 bpo 34003中 贡 献

curses
 添加了一个 新 变量 用于 保存下层 ncurses  库 的结构版 信息 ncursesversion
 由 serhiy  storchaka  在 bpo 31680 中贡献

ctypes
 在 windows 上 cdll  及其子 类现 在 接 受 winmode 形 参来指 定 用 于 底层 loadlibraryex  调用的 旗标
 默认旗标 被设为仅 加载 来自可信任 位置的 dll 依 赖 项 包 括 dll 的 存 放 路径 如 果加载 初始 dll  时 使用 了完 整 或 部 分路 径以 及 通过 adddlldirectory 添加的 路径
由 steve  dower 在 bpo 36085中 贡 献

datetime
 添加 了新 的替代 构造 器 datetime
fromisocalendar 和 datetime
fromisocalendar  它 们 分 别基 于 iso 年 份、 周 序号 和周 内日 序号 来构造 date 和 datetime  对象这 两者 分别 是其所 对应 类中 isocalendar  方 法的 逆 操作
 由 paul  ganssle  在 bpo 36004中 贡献

functools
lrucache  现在 可直 接作为 装饰 器而不是作 为 返回装 饰器的 函 数
 因 此这两种 写 法 现在 都被 支持 lrucache  def  fx 
由 raymond  hettinger  在 bpo 36772 中 贡献
 添加 了 新的 functools
cachedproperty  装饰 器用于在实 例 生命 周 期内 缓存的 已计 算 特 征属 性
data 由 carl  meyer  在 bpo 21145中贡献 添加 了新的 functools
singledispatchmethod  装 饰 器 可使 用 singledispatch 将 方法转换 为 泛 型函数 from  functools  import  singledispatchmethod  from  contextlib  import  suppress  class  taskmanager  def  initself  tasks  self
tasks  if  x  not  in  targets 由 ethan  smith  在 bpo 32380中 贡献
gc
getobjects  现 在 能 接 受 一个可 选 的 generation 形 参来 指 定一 个用 于获取 对 象的 生 成器
 由 pablo  galindo 在 bpo 36016中贡献

gettext
 添加 了 pgettext 及 其变化 形 式
由 franz  glasner é ric  araujo  和 cheryl  sabella 在 bpo 2504 中贡 献

gzip
添 加 mtime 形 参到 gzip
compress  用于 可重 现 的 输出
由 guo  citeo  在 bpo 34898中 贡献
对 于特 定 类型 的无 效或已 损 坏 gzip  文 件现在将引发 badgzipfile  而 不 是 oserror
 由 filip  gruszczy ń ski  michele  orr ù 和 zackery  spytz  在 bpo 6584 中贡献

idle 与 idlelib
 超过 n 行默认 值为50的 输 出将 被折 叠 为一个 按 钮
 n  可以在 settings  对话框的 general  页的 pyshell  部 分中进行修 改
 数量 较少 但是 超长 的行 可 以通 过在 输出 上右 击 来 折叠
 被折叠 的 输 出可通 过 双 击按 钮来 展开 或 是通 过右 击按钮 来放 入 剪 贴 板或 是单独的 窗口
 由 tal  einat 在 bpo 1529353 中 贡 献
 在 run 菜 单 中增 加了 run  customized 以 使 用 自定 义设置 来运 行模 块
 输入 的任 何 命 令行 参数都会 被 加入 sys
它 们 在下次 自 定义 运行 时会 再 次显 示在 窗体 中
用 户也 可以 禁 用 通常的 shell 主 模块 重启
由 cherylsabella  terry  jan  reedy  等人 在 bpo 5680和 bpo 37627中贡 献
 在 idle 编 辑器 窗口中 增 加 了 可 选的 行 号
窗口 打开时 默认不 显示 行号 除非在配 置对话 框的 general  选 项 卡 中特 别设 置
 已 打开 窗口 中 的行 号可 以在 options  菜单 中 显 示 和隐藏
 由 tal  einat 和 saimadhav  heblikar  在 bpo 17535中 贡献
 现在 会 使用 os 本 机编码 格式 在 python  字符 串和 tcl 对象 间进 行转 换
 这 允 许在 idle  中处理 emoji  和 其 他 非 bmp  字符
 这些 字符将可被 显示 或 是 从 剪 贴 板 复制 和粘 贴
字 符 串从 tcl  到 python 的 来 回转换现在 不 会 再 发生 失败
 过去 八 年 有 许 多人 都为 此 付 出 过 努 力问 题最 终由 serhiy  storchaka  在 bpo 13153 中解决
 在3
1中 新增 添加 切换 光 标闪 烁 停止 的选项
 由 zackery  spytz 在 bpo 4603中贡 献
esc 键现 在 会关闭 idle  补全提示 窗口
由 johnny  najera 在 bpo 38944中 贡 献
上述 修 改 已被反向 移 植到3
7 维护 发 行版 中
 添加 关键字 到 模块 名 称补 全列 表
 由 terry  j
 reedy 在 bpo 37765 中贡 献

inspect
inspect
getdoc  函数现 在 可以找 到 slots 的文 档 字符 串 如果 该属 性 是一 个 元 素 值 为文 档字 符 串的 dict 的话
这 提供 了类 似于目 前已 有 的 property  classmethod 和 staticmethod  等函 数的 文 档选项 class  audioclip  slots  bitrate  expressed  in  kilohertz  to  one  decimal  place  duration  in  seconds  rounded  up  to  an  integer  def  initself  bitrate  duration  self
duration  ceilduration  由 raymond  hettinger 在 bpo 36326 中 贡献

io
 在开发 模式 x  env  和 调试构 建 中 io
iobase 终 结器现 在会 在 close 方 法失败 时 将异 常 写入日 志
发生的 异常 在发布构 建中默 认会被静 默忽 略
由 victor  stinner  在 bpo 18748中 贡献

itertools
itertools
accumulate 函 数增 加了可 选 的 initial  关键字 参数 用来指 定 一个 初始值 from  itertools  import  accumulate  listaccumulate 1053015 initial 100010001010101510451060由 lisa  roach  在 bpo 34659 中贡 献

jsontool
添加 选项 jsonlines  用于 将 每个输 入行 解 析为 单独 的 json  对象
 由 weipeng  hong 在 bpo 31553 中贡 献

logging
 为 logging
basicconfig 添 加 了 force 关 键字参数 当 设为真 值 时关联到 根日 志 记 录器的 任 何现有处 理程 序都将 在 执行由 其他参 数 所 指定 的配 置之 前被移除 并 关闭
 这解 决了一个长 期存在的问 题
当 一个日志 处理 器 或 basicconfig 被 调用 时对 basicconfig 的后 续 调用 会 被静 默地忽略
 这导致 使用 交互 提 示符 或 jupyter  笔 记 本 更新、试 验或 讲解各 种 日志配 置选 项 变得相当 困难
 由 raymond  hettinger 提议 由 donghee  na 实 现并 由 vinay  sajip  在 bpo 33897中 完 成 审 核

math
添加 了 新的 函数 math
dist 用于 计 算两点 之 间的欧 几里得 距离
由 raymond  hettinger  在 bpo 33089中贡 献
扩 展了 math
hypot 函 数 以 便处 理更多 的维 度
之前它 仅 支 持2 d 的 情况
由 raymond  hettinger  在 bpo 33089中贡 献
添 加 了新 的函 数 math
prod 作为 的 sum  同 类 该 函数 返 回 start  值默 认值1 乘以 一个数字 可迭代对 象的积 prior 0
126 由 pablo  galindo 在 bpo 35606中 贡献
 添加 了 两个 新的 组合 函数 math
perm  和 math
comb 103 combinations  of 10 things  taken 3 at  a  time 120由 yash  aggarwal  keller  fuchs  serhiy  storchaka 和 raymondhettinger  在 bpo 37128 bpo 37178和 bpo 35431 中 贡献
 添 加了 一个 新函 数 math
isqrt  用于 计 算精 确整 数平 方根而无 需 转 换为浮点 数
该 新函 数支 持任 意 大整 数
它 的执 行速度 比 floorsqrtn  快但 是比 math
sqrt  慢 r 650320427 s  r 2 isqrts 1 correct 650320426 floorsqrts 1 incorrect 650320427由 mark  dickinson  在 bpo 36887中 贡献
 函数 math
factorial  不再接受 非 整数 类 参数
 由 pablo  galindo 在 bpo 33083中 贡 献

mmap
mmap
mmap 类现 在 具有一 个 madvise 方 法用 于访问 madvise  系 统调 用
由 zackery  spytz  在 bpo 32941中 贡献

multiprocessing
添 加 了新 的 multiprocessing
sharedmemory 模块
由 davin  potts  在 bpo 35813 中贡 献
在 macos 上 现在默 认使 用 的启动 方式是 spawn  启动 方式
 由 victorstinner 在 bpo 33725 中 贡献

os
 在 windows 上添 加 了新函 数 adddlldirectory 用于在导入 扩展 模块或 使 用 ctypes  加载 dll  时为 本 机依 赖提 供额 外 搜索 路 径
由 steve  dower 在 bpo 36085中 贡 献
 添加 了新的 os
memfdcreate  函 数用 于 包装 memfdcreate  系 统调用
 由 zackery  spytz 和 christian  heimes 在 bpo 26836 中贡献
 在 windows 上 大 部分 用于 处 理重 解析 点 包 括 符号 链接和 目 录 连接 的手动 逻 辑 已 被委 托给操作系 统
特 别地 os
stat  现在 将 会遍 历 操 作系 统 所支持 的任 何内 容而 os
lstat  将只 打开被 标 识为名 称 代 理 的 重 解析 点而 其要由 os
stat  打开 其他 的重 解 析点
 在 所有 情 况下 statresult
stmode  将 只 为 符 号链接 而 非其 他 种 类 的重解 析 点设 置 siflnk
要 标 识其 他种类 的 重 解 析点 请检 查新 的 statresult
streparsetag 属 性
 在 windows 上 os
readlink 现 在 能 够读 取目 录 连接
 请 注 意 islink 会对 目录 连接返 回 false  因此 首 先检 查 islink  的 代码 将连 续把 连接 视 为目 录而 会 处理 os
readlink  所 引发错 误 的代 码 现 在 会把 连接 视为 链接
 由 steve  dower 在 bpo 37834 中贡 献

ospath
返 回布 尔 值结 果 的 os
path 函 数 例 如 exists  lexistsisdir  isfile  islink  以及 ismount  现在 对于 包 含 在 os  层级 无法 表示的字 符 或字 节的 路径 将会返回 false  而 不是引 发 valueerror 或 其 子类 unicodeencodeerror 和 unicodedecodeerror
 由 serhiystorchaka  在 bpo 33721中贡献
expanduser  在 windows 上 现在 改用 userprofile  环境 变 量而 不 再使 用 home  后 者 通 常不 会 为一 般用 户 账户设置
 由 anthony  sottile 在 bpo 36264 中 贡 献
isdir  在 windows 上将 不再为 不 存在的 目录 的 链接 返回 true
realpath 在 windows  上 现在 会 识别 重解析 点包 括 符号链 接 和目 录 连接
由 steve  dower  在 bpo 37834中 贡 献

pathlib
pickle
pickle 扩 展 子 类化针 对 c  优化 的 pickler  现在可 通过定义 特殊 的 reduceroverride  方 法 来重载 函数 和 类 的 封 存 逻辑
 由 pierre  glaser  和 olivier  grisel  在 bpo 35900 中 贡 献

plistlib
添 加了新 的 plistlib
uid  并启动 了对 读取和 写入 经过 nskeyedarchiver  编 码的 二进 制 plists 的 支持
 由 jon  janzen 在 bpo 26707中贡 献

pprint
pprint 模 块为 一 些函数添 加了 sortdicts  形参
默 认情 况下 这 些函 数 会继 续 在 渲染或打 印之前 对字 典进 行排 序
但 是如果 sortdicts 设 为假值 则字 典将 保持键插 入 时的 顺序
 这 在调 试期 间 与 json 输 入 进行 比 较时 会很有用
 除 此之 外还 增 加了 一个 方便的 新函 数 pprint
pp 它 类似 于 pprint
pprint 但 它的 sortdicts 默 认为 false  from  pprint  import  pprint  pp  d  dictsourceinput
txt  由 r é mi  lapeyre  在 bpo 30670 中 贡献

pycompile
compile  现在 支 持静默模 式
由 joannah  nanjekye  在 bpo 22640中 贡献

shlex
新 增 了 shlex
join 函 数作为 shlex
split  的逆操 作
 由 bobayles 在 bpo 32102中 贡献

shutil
copytree 现 在接 受新 的 dirsexistok 关键字参 数
由 josh  bronson  在 bpo 20849中贡献
shutil
makearchive 现 在对新的 归 档 默认使 用 modern  paxposix
12001 格式以 提升 可移植 性和标准 一致 性此 特性 继 承自 对 tarfile 模 块的 相应 更改
 由 c
 gerlach 在 bpo 30661中贡献
shutil
rmtree  在 windows 上 现 在会 移除目录 连接而 不 会 递归 地先 移 除其 中的 内容
 由 steve  dower 在 bpo 37834中 贡 献

socket
添 加了 便 捷的 createserver  和 hasdualstackipv 6函 数以 自动化在 创建 服务器套 接 字 时 通常情 况下 所必须的 任务包 括 在同 一 套接字 中同 时 接 受 ipv 4和 ipv 6 连接
由 giampaolo  rodol à在 bpo 17561 中 贡 献
socket
ifnametoindex 和 socket
ifindextoname  函 数已 经 在 windows  上 实 现
 由 zackeryspytz  在 bpo 37007中 贡 献

ssl
 增 加了 posthandshakeauth 和 verifyclientposthandshake  分别启 用和 初始化 tls 1
3握 手 后验 证
由 christian  heimes  在 bpo 34670 中 贡献

statistics
sys
 添加了 新 的 sys
unraisablehook  函 数可 被 重 载 以便 控制 如 何处理 不可引 发的 异 常
 它会 在发 生了 一个 异常 但 python 没 有办 法处 理 时 被调 用
 例如 当 一 个析 构器 在垃 圾回 收 时 gc
collect 所 引发 的异 常
 由 victor  stinner  在 bpo 36829中贡 献

tarfile
tarfile 模 块 现 在对 新 的 归 档默 认使用 modern  pax  posix
12001格式 而不 再是之 前的 gnu 专属 格式
这 通 过标 准化 和 可扩 展格 式的 统一编 码 utf 8 提 升了 跨平台 可 移 植性还 提供 了其他一些益 处
由 c
 gerlach  在 bpo 36268中 贡 献

threading
 添 加了 新 的 threading
excepthook 函数 用来 处理 未捕 获的 threading
run  异常
 它可 被重载 以 便 控制如 何处 理未 捕 获的 threading
run  异常
 由 victor  stinner 在 bpo 1230540 中贡 献
添 加了新 的 threading
getnativeid 函 数以 及 threading
thread 类 的 nativeid  属 性
它 们 会 返 回内 核 所分配 给当 前线 程的 原生 整 数线 程 id
 此 特性 仅 在特 定 平 台上可 用参 见 getnativeid 了 解详 情
 由 jaketesler  在 bpo 36084中贡 献

tokenize
 当 提供 不 带末尾 新 行的输 入 时 tokenize 模块 现 在 会隐 式 地添加 newline  形 符
此行 为现在 已与 c  词法分析 器的 内部行 为相匹配
 由 ammar  askar 在 bpo 33899 中 贡献

tkinter
在 tkinter
spinbox 中添 加了 方法 selectionfromselectionpresent  selectionrange  和 selectionto
 由 juliette  monsel 在 bpo 34829 中贡 献
在 tkinter
canvas 类 中添 加了方 法 moveto
 由 juliette  monsel  在 bpo 23831中 贡 献
tkinter
photoimage 类 现在 具 有 transparencyget 和 transparencyset  方 法
由 zackery  spytz 在 bpo 25451中 贡 献

time
 为 macos 10
12 添加了 新的 时钟 clockuptimeraw
 由 joannahnanjekye 在 bpo 35702 中 贡献

typing
typing 模块 加入 了一些新 特 性一 个 带 有 键专属类 型的 字典 类型
 参 见 pep 589和 typing
 typeddict 只 使用字符 串 作为 键
默认情 况下 每 个 键都 要 求 提 供
指 定 totalfalse 以 允 许 键作 为可 选项 class  locationtypeddict  totalfalse  latlong  tuple  gridsquare  str  xycoordinate  tuple  literal  类型
 参 见 pep 586和 typing
 literal  类 型 指明 一个 形 参或 返 回值被限 定为一 个或多个 特 定 的字 面值 def  getstatusport  int  literalconnected  disconnected 
 final 变量、 函数、 方法 和类
参 见 pep 591 typing
final 和 typing
 final  限定 符 会指示 静态 类 型检 查 器限 制 进 行子 类化、重载 或重 新赋 值 pi  finalfloat 3
1415926536 协 议定义
 参见 pep 544 typing
protocol  和 typing
简单的 abc  例如 typing
supportsint 现在 是 protocol 的 子类
 新 的 协议 类 typing
 新 的 函数 typing
getorigin 和 typing
unicodedata
unittest
 添 加 了 asyncmock 以支 持异 步版本的 mock
 同 时 也添加了 相应 的 断言 函数 用 于 测试
由 lisa  roach  在 bpo 26467中贡 献
unittest 添加了 addmodulecleanup  和 addclasscleanup  以 支持 对 setupmodule 和 setupclass  进行清理
 由 lisa  roach 在 bpo 24412中 贡献
 一 些 模拟断言 函数 现在也 会在失 败时 打印一 个实 际调 用 列表
由 petterstrandmark  在 bpo 35047中 贡 献
unittest 模 块已支 持通过 unittest
isolatedasynciotestcase  来使 用 协程作 为测试 用例
由 andrew  svetlov  在 bpo 32972 中贡 献
示例 import  unittest  class  testrequestunittest
venv
 现 在 venv 在 所 有 平台 上都 会 包含 activate
ps 1 脚本用 于在 powershellcore 6
1 下 激 活虚 拟环 境
由 brett  cannon  在 bpo 32718 中贡献

weakref
 由 weakref
proxy 返回 的代理 对象现在除 其他 算 术 运算 符外 也支 持 矩阵 乘法运 算 符和
 由 mark  dickinson 在 bpo 36669 中贡献

xml
 作 为对 dtd  和外部 实体检 索的缓解 在默认情 况下 xml
minidom 和 xml
sax  模 块 不再 处理 外 部实 体
 由 christian  heimes 在 bpo 17239中 贡 献
xml
etree
elementtree 模块 中 的
find 方法 支持 通 配符 搜 索例 如 tag  此搜索 会忽略命 名 空间 以及 返 回给 定命名 空间中 所有标 签的 namespace
由 stefan  behnel  在 bpo 28238 中贡献
xml
elementtree  模 块 提供 了实现 c 14 n 2
0的 新 函数– xml
etree
elementtree
canonicalize
 由 stefan  behnel 在 bpo 13611 中 贡 献
xml
xmlparser  的目 标 对 象 可通 过 新的回调 方 法 startns 和 endns  来接受 命 名空 间声明 事 件
此外 xml
treebuilder  目标可 被 配置 为处理有 关注释 和 处 理指令 事件 以将 它 们包 含在 所 生成的树 当 中
由 stefan  behnel  在 bpo 36676和 bpo 36673 中 贡献

xmlrpc
serverproxy  现 在支 持 可选 的 headers 关 键 字参 数作为随 同每 次 请求发送 的 http  标头 序列
 此 特 征 的作 用 之一 是使 得 从 默 认 的基础 认 证 升级 到更 快速 的会 话认证成 为 可能
 由 c é dric  krier 在 bpo 35153 中 贡 献

性 能优化
 构建 和 c  api  的改 变
 默认的 sys
abiflags  成为一 个空字符 串 pymalloc  的 m 旗 标 不 再有 意 义无 论是 否启用 pymalloc  构建都 是兼容 abi  的因 此 已被 移 除
由 victor  stinner  在 bpo 36707中 贡 献
改变 的例子只会安装 python 3
8 程序不再有 python 3
8 m 程序
 只会 安 装 python 3
8 config  脚本 不再 有 python 3
8 mconfig  脚 本
 m 旗标 已 经 从动 态 库 文 件 名后缀中移 除包 括标准库 中的扩展模块以 及第 三方 包所 产生 和安装的 模 块 例如从 pypi 下 载的模 块
以 linux 为例 python 3
7 的后 缀
so 在 python 3
8中 改为
cpython 38 x 8664 linuxgnu
so
 重新 组织 了所 有 头文 件以 更 好 地区分不 同 种 类的 api  include
h 应为 可 移植的 公有稳 定版 c  api
h  应 为 cpython  专属 的不 稳 定 版 c  api  公有 api 部分 私有 api  附 加 py  or  py 前缀
h 应 为 cpython 特别专 属的私有 内部 c  api
此 api 不具备向 下 兼 容 保 证并且不 应 在 cpython 以 外 被使 用
 它们的 公开 仅 适 用 于特 别 限 定 的需求 例 如 调 试器和 性 能分析 等 必 须 直接访问 cpython 内部数 据而不 通过 调用函 数的应用
 此 api 现 在是通过 make  install  安 装的
 由 victor  stinner 在 bpo 35134 和 bpo 35081 中贡 献相关工 作由 eric  snow 在 python 3
7 中发 起
 某 些 宏已 被转换为 静 态内联函数形参 类 型和返 回类型 定 义 良好 它 们不再会 有与宏相 关的 问 题 变量具有 局部作 用域
例如 pyincref  pydecref  pyxincref  pyxdecref  pyobjectinit  pyobjectinitvar  私有 函数 pyobjectgctrack  pyobjectgcuntrack  pydealloc  由 victor  stinner 在 bpo 35059中 贡 献
 pybytearrayinit 和 pybytearrayfini  函 数 已被移 除
 它们 自 python 2
4 和 python 3
0 起就没有 任 何 用处被排 除在 受限 api  稳定 版 abi  之外 并且 未被写入文档
由 victor  stinner  在 bpo 35713 中贡 献
 pyexceptionclassname 的 结 果类 型现在 是 const  char 而非 char 
由 serhiy  storchaka  在 bpo 33818中 贡献
 modulessetup
dist  与 modulessetup 两 者的共存已被移 除
之 前 在更 新 cpython  源 码 树时 开发 者必 须 手动 拷贝 modulessetup
dist  在源 码 树内 到 modulessetup 在 构建 树内 以 反 映 上游 的任 何改变
旧特性对 打 包者 来说有 一点益 处但代 价是对追踪 cpython 开发 进 程的开发者 造成 经常 性的 麻 烦因 为忘记 拷贝 该文件可能导致 构 建失败
现 在构建 系统 总 是 会从 源码 树内 的 modulessetup 读取数 据
建 议希 望定制该 文 件 的开 发者 在 cpython  的一 个 git  分叉 或补 丁 文 件中 维护他 们的更 改 就 如他 们对 源码 树 做 任 何其他 改 变时 一样
 由 antoine  pitrou 在 bpo 32430 中 贡献
 将 python  数 字转 换为 c  整型的函 数例如 pylongaslong  以及 带有 i  之类整 型转 换格 式 单 元 的参 数解 析函数例 如 pyargparsetuple 现在如 果可 能 将 会 使 用 index 特 殊方 法而 不是 int
 对于 带有 int  方 法但 没有 index  方法 的 对 象 例 如 decimal 和 fraction  将 会 发出 弃 用 警告
 对于 实现 了 index 的 对象 pynumbercheck  现在将 返回1
 pynumberlong  pynumberfloat  和 pyfloatasdouble 现 在如 果可能也 将会 使用 index  方 法
由 serhiy  storchaka  在 bpo 36048和 bpo 20092 中贡 献
 堆分 配 类型 对象 现在 将 增加 它们 在 pyobjectinit 及 其对 应 的宏 pyobjectinit 中的 引 用 计数 而不 是在 pytypegenericalloc  中
 修改实例 分配或中 止分 配的 类 型 可能 需要 进 行 调整
 由 elizondo 在 bpo 35810中贡 献
 新增 函 数 pycodenewwithposonlyargs 允 许创 建代码 对象 例 如 pycodenew  但带 有 一个 额 外 的 posonlyargcount  形 参 以 指明仅限 位置参 数 的 数量
由 pablo  galindo  在 bpo 37221中 贡 献
 pysetpath  现在会 将 sys
executable  设为 程序 完 整 路 径 pygetprogramfullpath  而不 是程 序 名称 pygetprogramname
 由 victor  stinner  在 bpo 38234中 贡 献

 弃 用
api 与 特 性的移除
 移植 到 python
本 节列出了 先 前描 述 的更改以 及可 能需 要更 改代码 的其他 错误 修 正
python  行为 的改 变
更 改 的 python  api
 在 windows 上 os
getcwdb 函 数 现 在 会使用 utf 8编码 格式而 不是 ansi  代 码页 请参 看 pep 529 了 解 具体原因
 该函 数在 windows  上 不再被弃 用
由 victor  stinner  在 bpo 37412 中 贡 献
现 在 subprocess
popen  在 某些 情况 下 会 使用 os
posixspawn 以 获得 更 好的 性能
在 适 用 于 linux  的 windows  子系 统和 qemu  用 户 模拟 器上 使用 os
posixspawn 的 popen  构 造器 不 会 再 因为找不 到 程序这 样的错误 引发异 常
而是 让子进程 失败并 返 回一 个 非零 的 returncode
由 joannah  nanjekye 和 victor  stinner  在 bpo 35537中 贡献
 the  preexecfn  argument  of  subprocess
 imap
logout  方法不会 再静默 地 忽略任 意异 常
 由 victor  stinner  在 bpo 36348 中 贡献
 函数 platform
popen  已被 移 除 它自 python 3
3起 就已 被弃 用 请 改 用 os
popen
由 victor  stinner  在 bpo 35345中贡献
 当传 入 多模 数据 时 statistics
mode 函 数不 会再 引发 异 常
 它 将改 为返回在 输入 数 据 中遇 到 的第 一 个模 式
 由 raymond  hettinger  在 bpo 35892中贡 献
 tkinter
treeview 类 的 selection  方 法不 再 接受 参 数
带 参 数 调用 该 方法 来改 变 选择 在 python 3
6中已 弃用
 请 使用 专门 方 法例 如 selectionset  来改变 选择
 由 serhiy  storchaka 在 bpo 31508 中贡献
 xml
minidom  的 writexml  toxml  和 toprettyxml 方法 以及 xml
etree 的 write  方 法现 在 会保 留用 户 指定 的 属 性顺序
由 diego  rojas  和 raymond  hettinger 在 bpo 34160 中贡 献
附带 r  旗标 打开 的 dbm
dumb  数 据 库现在 将是 只读的
 如 果 数据库不 存在 附 带 r  和 w 旗标 的 dbm
open 不 会 再创建数 据 库
 由 serhiy  storchaka 在 bpo 32749中 贡 献
 在 xmlparser  的子 类 中定义的 doctype  方法将 不会 再 被调用 并 将 导致 发出 runtimewarning  而不 是 deprecationwarning
 请在 目标上定 义 doctype  方 法 来处 理 xml  doctype 声明
 由 serhiy  storchaka 在 bpo 29209 中贡献
现 在 当自 定义元 类未在 传给 type
new 的 命 名 空间 中 提供 classcell  入 口 时将引发 runtimeerror
 在 python 3
63
7 中 是 则 是 引 发 deprecationwarning
 由 serhiy  storchaka  在 bpo 23722中贡 献
 cprofile
profile 类 现在可 被用 作 上 下文管理 器
由 scott  sanderson 在 bpo 29235 中 贡献
 shutil
copytree  和 shutil
move  会 使用 平 台专 属的 fastcopy  系统 调用 参见 依 赖于具 体平 台 的高效拷 贝 操作一 节
copyfile 在 windows  上的 默 认 缓冲区 大小从16 kib 改为1 mib
 pygchead  结 构已被 完全 改变
 所有接 触到该 结构的 代码 都应当 被重写
参 见 bpo 33597
 pyinterpreterstate 结 构已被移 入 internal 头文 件特 别 是 includeinternalpycorepystate
h
不 透明的 pyinterpreterstate 作 为 仅 有 api  以 及稳 定版 abi  的一 部 分 仍然 可用
 文档 指明该 结 构的 任何字段 都不 是 公有 的 因此我 们 希望没人 在使 用它 们
 但是 如果 你 确实依 赖其中某 一 个 或 更 多 个 私 有字段并 且 没有 其他 替代 选项 则请开一 个 bpo  问题
我 们 将 尽力帮 助 你进行 调整 可能 包 括 向公 有 api 添 加访 问器 函数
 参见 bpo 35886
现在 所有平 台 下的 mmap
flush 方 法 都会在 成功时返 回 none 并在 错误 时引 发异常
之 前 它的 行为 取 决于具 体 平台 windows  下会在 成 功时 返 回非 零 值在 失败时返 回零
 unix 下 会在 成功时 返 回 零在 失败 时 引发错 误
 由 berker  peksag  在 bpo 2122 中贡献
 xml
minidom  和 xml
sax 模块 默 认将不 再 处理 外部 实 体
由 christian  heimes  在 bpo 17239中 贡献
 从 只读 的 dbm 数 据库 dbm
dumb  dbm
gnu 或 dbm
ndbm 删 除键 将会 引发 error  dbm
error  dbm
error  或 dbm
error 而 不 是 keyerror
由 xiang  zhang 在 bpo 33106中贡 献
简 化 了字 面 值 的 ast
所 有常 量将 被表示 为 ast
constant 的 实 例
 实 例 化 旧类 num  str  bytes  nameconstant 和 ellipsis  都将 返回 constant  的实例
 由 serhiy  storchaka  在 bpo 32892中贡 献
 expanduser 在 windows  上现在 改用 userprofile  环 境 变量 而不再 使 用 home 后 者 通 常不会为 一 般用 户账户设 置
由 anthony  sottile  在 bpo 36264中 贡献
 异常 asyncio
cancellederror  现在 继 承自 baseexception  而不是 exception  并且不 再继 承 自 concurrent
 由 yury  selivanov 在 bpo 32528 中 贡献
当使 用 asyncio
task 的实 例时 函数 asyncio
waitfor 现 在会 正确 地等 待撤 销
 在 此之 前 当 达 到 timeout 时它 会被 撤销并 立 即返回
 由 elvis  pranskevichus 在 bpo 32751 中 贡 献
当 将 socket  作为 name 形参传 入时函 数 asyncio
getextrainfo  现 在 会返回 一个 可安 全 使用的套 接 字对 象
由 yury  selivanov 在 bpo 37027 中 贡 献
 asyncio
bufferedprotocol  已经晋 级为稳 定 api
在 windows  上对扩 展模块的 dll 依 赖 以及 通过 ctypes 加 载 的 dll  的解 析现在 将更 为安 全
只有系 统路 径、包 含相信 dll  或 pyd 文件 的 路 径以 及通 过 adddlldirectory  添加 的目 录才 会被作为 加载时依 赖的搜 索位 置
 特别地 path  和当 前 工作 目录 将不 再 被使用对 它们的 修 改将不 再对 正常 的 dll 解 析产生影 响
如 果 你的 应用依 赖于 这些机制 你 应 当先 检 查 adddlldirectory 如果它存 在就 用它 在加 载你的 库 时 添 加你的 dll  目 录
 请 注意 windows 7用户 还 需要 确保 windows  更 新包 kb 2533623已安 装这 一 点 也 会 由安 装器 进行验证
 由 steve  dower  在 bpo 36085 中贡献
 关联到 pgen 的 头文 件 和函 数在其被 纯 python  实现 取代后 已被 移 除
 由 pablo  galindo 在 bpo 36623 中 贡献
 types
codetype  在构造器 的第二个 位置 新 增了 一 个形参 posonlyargcount 以 支 持 在 pep 570中定义 的仅 限位 置参 数
第 一 个参 数 argcount  现在 表 示位 置参 数的 总 数量包 括仅限 位置参数
 types
codetype  中新 增的 replace  方法可 用于 让 代码支持 future 特 性
c  api 中 的改变
cpython 字节 码的 改变
 解释 器循环已通过将块 堆栈 展开 逻辑 移 入编 译器 获得了简 化
 编译器 现 在会发 出 显式 指令 来 调 整值堆 栈并为 break  continue  和 return 调 用清 除代码
移 除 了操 作码 breakloop  continueloop  setuploop  和 setupexcept
添 加了新的 操 作码 rotfour  beginfinally  callfinally 和 popfinally
 修 改 了 endfinally  和 withcleanupstart  的行 为
 由 mark  shannon  antoine  pitrou  和 serhiy  storchaka 在 bpo 17611 中 贡 献
 添 加了 新的 操作码 endasyncfor  用于处 理当等 待 async  for 循环的 下一 项 时 引发的异常
由 serhiy  storchaka  在 bpo 33041中 贡 献
 mapadd 现 在会 预期 值为栈 的 第一个 元素而 键为 第二 个元素
作 出此改变 以使 得 字 典推 导 式能 如 pep 572 所提 议 的 那样 键 总是会 在值 之前被 求 值
由 j ö rn  heissler 在 bpo 35224中 贡 献

 演 示 和工 具
 添 加了一个检测 脚 本用于对访 问 变 量 的 不同 方式进行 计时 toolsscriptsvaraccessbenchmark
由 raymond  hettinger  在 bpo 35884 中贡献
 以 下 是自 python 3
3 以来性 能提 升 情况的总结 python  version 3
3 基准 测 试 是 在 intel ® core ™ i 74960 hq  处理器 上 运 行从 python
org  获取的 macos 64 位版 得到 的 数据
基准测 试 脚本 显 示 时间 以 纳 秒为单 位
python 381 中 的重 要 变化
 出于重 要 的安 全性考 量 asyncio
createdatagramendpoint 的 reuseaddress 形 参不再 被支持
这 是由 udp  中 的 套接字选项 soreuseaddr 的 行为 导 致的
 更 多细节 请参阅 loop
createdatagramendpoint  的 文档
由 kyle  stanley  antoinepitrou  和 yury  selivanov 在 bpo 37228中 贡献

python 39 有什 么新变 化
发 布版 本3
0 日期 十 一 月132020编者ł ukasz  langa  本文介 绍了 python 3
9 相比3
8 的新 特 性
 python 3
9发布 于2020年10 月5日
完 整的 详 情可参 阅更 新日志
参 见 pep 596 python 3
9 发布计 划
 摘 要 发 布 重点
你 应该 在你 的代码中 检 查 deprecationwarning
在 python 2
7 仍受 支持的 时 候 有许 多旧功 能在 python 3 中被保留 以 维 持 对 python 2
7的 向 下兼 容
随着对 python 2 支 持的 结束这 些向 下兼容 层已 经 被 移除或 即将 被 移除
它们 中的大 部分都 持续多 年 引发 deprecationwarning  警告
例如使 用 collections
mapping  而不 是 collections
mapping 自2012 年发布 的 python 3
3开 始即 会引 发 deprecationwarning
 请使 用 w  default  命 令 行 选项测试 你的应 用程 序 来查看 deprecationwarning 和 pendingdeprecationwarning  甚至 可 以 使用 werror  将它们 视为错误
 可以使 用警告过 滤 器 来 忽略 来自 第 三方 代 码的警告
9 是 最后一个 提供 这 些 python 2 向下 兼容 层的版 本以 给 予 python 项 目维护 者更 多时 间来 组织移除 python 2 支持 并添 加 python 3
9 支 持
collections  模 块 中抽 象基 类的别名 例如 collections
abc
mapping 的 别 名 collections
mapping 会为 向下 兼容最后 保 留一 个发行 版
 它 们 将 在 python 3
10中 被 移 除
 更一般 地说 请尝 试在 python 开发 模 式下 运行你的 测试这 可以帮 助你 的 代 码兼容 以 后 的 python  版本
注有 许 多之前存 在的 弃 用也在此 python  版本 中 被移 除
具 体请参 阅移 除一 节
 新的 特性
 字 典 合并与 更新运算 符
合并 与 更新 运 算符已被加入 内置的 dict 类
 它们 为现 有 的 dict
update 和 d 1 d 2 字 典合 并方法 提供了 补充
示 例 x  key 1 value 1 from  x  key 2 value 2 from  x  y  key 2 value 2 from  y  key 3 value 3 from  y  x  y  key 1 value 1 from  x  key 2 value 2 from  y  key 3 value 3 from  y  y  x  key 2 value 2 from  x  key 3 value 3 from  y  key 1 value 1 from  x 请 参阅 pep 584 了解 详情
 由 brandt  bucher  在 bpo 36144中贡献

 新增 用于 移 除前 缀和 后 缀的 字 符 串方 法
增加 了 str
removeprefixprefix 和 str
removesuffixsuffix 用于 方 便地 从字符串 移 除 不需要的 前缀 或后缀
 也增加了 bytes  bytearray  以及 collections
userstring 的对 应方 法
请参 阅 pep 616 了解 详 情
由 dennis  sweeney  在 bpo 39939中贡献

 标准 多项 集 中的 类型标注 泛型
新的 解析 器
9使 用 于基于 peg 的 新解 析 器 替 代 ll 1
新 解 析 器的 性能与旧 解析器 大致相当但 peg  在设 计新语言 特 性时 的形 式 化 比 ll 1 更 灵活
我 们将 在 python 3
10及之 后 版本 中开 始使用 这 种 灵活 性
ast 模 块会 使用 新 解 析器 并 会 生成 与旧 解析 器 一 致 的 ast
在 python 3
10 中旧解 析 器将 被移 除 依赖于它 的所有功 能也 将被 移除 主要是 parser  模 块它 早 已 被弃 用
 只 有 在 python 3
9 中你 可以 使用命 令行开关 x  oldparser 或 环 境变 量 pythonoldparser 1切换 回 ll 1解析 器
请 参 阅 pep 617了解 详 情
 由 guido  van  rossum  pablo  galindo  和 lysandros  nikolaou  在 bpo 40334中 贡献

 其他 语言特 性 修改
 import  现在 会引 发 importerror 而不是 valueerror  后者 曾经 会 在相对 导 入 超出其最 高 层 级 包时发 生
 由 ngalim  siregar  在 bpo 37444中贡献
 python  现在 会 获取 命令 行中指 定的脚 本文 件名 例如 python 3 script
py  的 绝对 路径 main  模块 的 file  属 性将 是一个 绝对路径 而 不是 相对路径
 现在 此路径在 当前 目录 通过 os
chdir 被 改变 后仍 将保持 有效
作为 附 带效果回 溯 信 息 也 将 在 此 情 况下为 main  模块帧显 示绝 对 路径
由 victor  stinner  在 bpo 20443中贡 献
在 python  开发 模 式以及调 试 编 译版 本 中现在 会针 对字 符串 编码 和解码 操 作 检查 encoding  和 errors 参数
例 如 open  str
encode  和 bytes
 默 认设 置 下 为 保 证 性 能 errors  参 数 只会在第 一 次 发 生 编 码解 码 错误 时被检查 并 且 对于 空字 符 串 encoding  参数 有 时会 被忽 略
由 victor  stinner 在 bpo 37388 中贡 献

replace  s  n  对于所 有非 零的 n 都 将返 回 s  而 不 是空 字符 串
现 在此方法 会与
replace  s  保持 一致
 对于 bytes 和 bytearray  对象也 有类 似 的修 改
由 serhiy  storchaka 在 bpo 28029 中贡献
 任 何有效 的表达 式现 在都 可被用 作 decorator
 在 之前 版本 中 相 关 语 法 则更 为严 格
请 参 阅 pep 614了解详 情
由 brandt  bucher  在 bpo 39702中 贡 献
改 进了 typing 模 块 的 帮 助 信 息
 现 在 将 为 所 有特 殊形 式 和特 殊 通用 别名 例如 union  和 list  显 示 文 档字符 串
使 用 help  时传入 通用 别 名 例 如 listint  将显示对 应实 体 类 型 这 里 对应 的 是 list  的帮助信 息
由 serhiy  storchaka  在 bpo 40257 中 贡献
 aclose  asend  athrow 的 并行 运行 现在已被禁止 且 agrunning  现 在 会反 映异步 生成 器的实际 运行 状态
由 yury  selivanov 在 bpo 30773 中贡 献
调 用 iter  方法 时发生 的 非预 期错 误 不会再被 in  运 算 符 以 及 operator 的 contains  indexof 和 countof  中的 typeerror  所掩 盖
由 serhiy  storchaka  在 bpo 40824中 贡献

 新增 模块
zoneinfo
zoneinfo 模 块为 标准库引 入了 iana  时 区 数据 库
 它添加了 zoneinfo
zoneinfo 这 是一 个 基于 系统时区 数据的 实 体 datetime
tzinfo  实 现
示例 from  zoneinfo  import  zoneinfo  from  datetime  import  datetime  timedelta  daylight  saving  time  dt  datetime 2020103112 tzinfozoneinfoamericalosangeles  printdt 202010311200000700 dt
tzname  pst  作为不包含 iana  数 据 库 的平台的 一 个回 退数 据 源还 以第 一方 软 件包 的形 式 发布了 tzdata  模块通 过 pypi 发 行并 由 cpython 核 心 团队维护
 参见 pep 615 在标准库 中支 持 iana 时 区数 据 库 pep  由 paul  ganssle  撰写 并实 现
graphlib
 添加 了新 的 graphlib 模 块其中 包 含 graphlib
topologicalsorter 类来提 供图的拓 扑 排序功能
 由 pablo  galindo  tim  peters 和 larryhastings  在 bpo 17005中 贡 献

改 进的模块
ast
 将 indent 选 项 添加 到 dump  这允 许它 产 生多行缩 进的输 出
由 serhiy  storchaka 在 bpo 37995中贡 献
添 加了 ast
unparse 作 为 ast 模块 中的 一 个 函数 它可 被 用来 反解析 ast
ast  对象 并产 生相应的 代 码 字 符 串 当 它被 解析 时 将 会 产 生一 个等 价的 ast
ast  对象
 由 pablo  galindo 和 batuhan  taskaya  在 bpo 38870 中贡 献
 为 ast 节 点 添 加了 文档 字符串 其 中 包 含 asdl 签 名 可被 用来构 造对应 的节 点
 由 batuhan  taskaya 在 bpo 39638 中贡 献

asyncio
compileall
 为重 复的
pyc  文件添加 了使 用 硬软 件的 可能 性 hardlinkdupes 形 参 以及 hardlinkdupes  命令 行选 项
由 lum í r  frenzy  balhar 在 bpo 40495 中贡 献
新 增 了 一些 用于 在结 果
pyc  文件 中操 纵路径的 选项 stripdirprependdir  limitsldest  形参 以 及 s  p  e 命 令行 选 项
 并使 得为 优化 等级 多 次 指定选项 成 为可 能
由 lum í r  frenzy  balhar  在 bpo 38112中 贡献

concurrentfutures
 将 新的 cancelfutures  形 参 添加到 concurrent
shutdown 可 以 取消 尚 未开 始运 行 的所有 挂起的 future 而 不必 等待 它们 完 成运 行再关 闭 执行 器
 由 kyle  stanley 在 bpo 39349 中贡 献
 从 threadpoolexecutor 和 processpoolexecutor 中 移除了守 护 线 程
 这 改 善与 与子解释 器 的 兼容性 及 它们 在关 闭进 程 时 的 可预 测性
 由 kylestanley 在 bpo 39812 中贡 献
现 在 processpoolexecutor  中的 工作进 程 仅 会 在没 有可重用 的空 闲工作进 程 时 按 需产生
这 优 化 了 启动开销 并 减少了由 空 闲工 作进 程 导 致的 cpu  时 间损失
 由 kyle  stanley 在 bpo 39207中 贡献

curses
增 加了 curses
gettabsize 以 及 curses
settabsize 函 数
 由 anthonysottile 在 bpo 38312 中 贡 献

datetime
datetime
date  的 isocalendar 以 及 datetime
datetime  的 isocalendar  等 方法 现 在将 返回 namedtuple  而不是 tuple
 由 donghee  na 在 bpo 24416 中 贡 献

distutils
upload  命令 现在 会创建 sha 2256和 blake 2 b 256 哈 希 摘 要
它会 在禁 用 md 5摘 要的 平 台上 跳过 md 5
由 christian  heimes  在 bpo 40698 中 贡 献

fcntl
增 加了 fofdgetlk  fofdsetlk 和 fofdsetlkw 等 常量
 由 donghee  na 在 bpo 38602中贡 献

ftplib
现在 ftp  和 ftptls 当 它们的构 造器 所 给定 的超时 参 数 为零 以 防止创 建 非 阻塞套 接 字时会引 发 valueerror
由 donghee  na  在 bpo 39259 中贡献

gc
 当垃 圾回收 器 进行某 些 复活 对象的收 集 时 在 终 结器被 执行 之 后 这 些对 象可 以在 隔离 周期 之外 被访 问 不会 阻止 对 所 有仍然 无法 访 问 的 对 象的收 集
 由 pablo  galindo 和 tim  peters 在 bpo 38379 中 贡 献
增 加了 一 个新 的 函 数 gc
isfinalized 用 来检 测一 个对 象是否 已被 垃 圾回 收器所 终结
 由 pablo  galindo 在 bpo 39322 中 贡献

hashlib
http
 添加 http 状 态 码103 earlyhints 418 imateapot 和425 tooearly 到 http
由 donghee  na  在 bpo 39509以 及 ross  rhodes 在 bpo 39507中 贡献

idle 与 idlelib
 添加了 切换 光标闪 烁停 止的选项
 由 zackery  spytz  在 bpo 4603中 贡献
esc 键 现在 会关 闭 idle  补全 提示 窗口
 由 johnny  najera 在 bpo 38944 中 贡 献
 添 加关 键 字 到模 块 名 称补 全 列表
由 terry  j
 reedy  在 bpo 37765 中 贡献
 上述修 改已 被反向 移 植 到3
8 维护发 行版中
imaplib
 现在 imap 4 和 imap 4 ssl 的 构造 器具 有可 选的 timeout 形 参
并 且 现 在 open 方法 也 具有 可选的 timeout  形参提 供同样的 修改
imap 4 ssl  和 imap 4 stream 中 被 重载的方 法也 应用 了 这个 修 改
 由 donghee  na  在 bpo 38615中 贡献
 增加 了 imaplib
unselect
unselect 会释 放关 联到 选定邮 箱 的 服务 器资 源并 将 服务 器返 回到 已认 证状态
 此命 令会执 行与 imaplib
close  相 同的 动作 区 别 在于它不 会 从 当前 选定 邮 箱 中 永 久性地移除 消 息
由 donghee  na 在 bpo 40375 中贡献

importlib
 为提 升与 import  语句 的一 致性现 在 importlib
resolvename  对 于 无效 的相 对导 入尝 试会引 发 importerror 而 不 是 valueerror
由 ngalim  siregar 在 bpo 37444中 贡献
发 布不 可变模 块 对象的 导入加 载器 除 了发 布单独模 块 以外 现在也 可 以 发 布 不 可变 包
由 dino  viehland  在 bpo 39336中贡 献
 添加了 带有 对 包数 据中 子 目录支 持的 importlib
files  函 数 与 importlibresources 1
5版的 反 向端 口 相 匹配
 由 jason  r
 coombs  在 bpo 39791中 贡 献
来自 importlibmetadata 1
6
1 版的 已更 新 importlib
metadata
inspect
arguments 已 从 ordereddict  改 为常规 字典
由 inada  naoki 在 bpo 36350 和 bpo 39775中 贡 献

ipaddress
ipaddress 现 在支 持 ipv 6作 用域 地址 即带 有 scopeid  前缀 的 ipv 6地 址
ipv 6 作 用域 地 址可 使用 ipaddress
ipv 6 address  来解 析
作 用域 的区 id  如果 存在 可 通过 scopeid  属性 来获 取
由 oleksandr  pavliuk 在 bpo 34788中 贡 献

math
对 math
gcd  函 数进行了 扩展以 处理 多 个参 数
在 之前 版 本中 它 只 支持 两 个参 数
由 serhiy  storchaka 在 bpo 39648中 贡献
增 加了 math
lcm 返 回 指定 参数 的最小 公 倍数
 由 mark  dickinsonananthakrishnan  和 serhiy  storchaka  在 bpo 39479和 bpo 39648中 贡献
增 加了 math
nextafter 返 回从 x 往 y 方 向的 下一个 浮点数 值
由 victor  stinner  在 bpo 39288中 贡献
 增加了 math
ulp 返 回一个浮 点数 的 最小 有 效比 特 位
由 victorstinner 在 bpo 39310中 贡献

multiprocessing
multiprocessing
simplequeue 类 新增 了 close 方 法用 来显 式地 关闭 队列
由 victor  stinner  在 bpo 30966中贡 献

nntplib
现 在 nntp  和 nntpssl  当它 们 的 构造 器 所 给 定的超 时参 数 为零 以防 止创 建 非 阻塞套 接字时会引发 valueerror
 由 donghee  na 在 bpo 39259中贡 献

os
增 加了 cldkilled  和 cldstopped  作为 sicode
 由 donghee  na 在 bpo 38493中 贡 献
 对外 公开 了 linux 专 属的 os
pidfdopen  bpo 38692和 os
ppidfdbpo 38713 用 于文 件描述符的 进程 管 理
 现 在 os
unsetenv  函数 在 windows  上也已 可用
 由 victor  stinner 在 bpo 39413中 贡献
现在 os
putenv  和 os
unsetenv  函数将 总是 可 用
 由 victorstinner 在 bpo 39395中 贡献
增 加 了 os
waitstatustoexitcode 函数 将等 待 状态转换 为退出码
由 victor  stinner  在 bpo 40094中贡 献

pathlib
pdb
在 windows  上 pdb 现 在 支持
 由 tim  hopper  和 danlidralporter  在 bpo 20523 中贡 献

poplib
现在 pop 3和 pop 3 ssl  当 它 们的构造器 所 给定 的超时 参 数 为零 以 防 止 创建非阻 塞套 接 字时 会 引 发 valueerror
由 donghee  na  在 bpo 39259中 贡献

pprint
现 在 pprint 能美 化打 印 types
 由 carl  bordumhansen  在 bpo 37376中贡 献

pydoc
 文档 字符串的显 示 现在 不仅 针对类、 函 数、方 法 等也针 对任何 具有自 己的 doc 属 性的 对 象
由 serhiy  storchaka 在 bpo 40257 中贡献

random
增 加 了新的 random
randbytes  方 法生 成随 机 字节 串
由 victor  stinner 在 bpo 40286中贡 献

signal
对 外 公开了 linux  专 属的 signal
pidfdsendsignal  用于 向使用文件 描 述符 而 非 pid 的进 程发送 信号
 bpo 38712
smtplib
 现在 smtp  和 smtpssl  当它 们 的构造器所 给定 的 超时参 数为零以 防止 创建 非 阻塞 套 接字时 会引发 valueerror
 由 donghee  na 在 bpo 39259 中贡献
 现在 lmtp  构 造器 具有 可 选的 timeout 形 参
由 donghee  na  在 bpo 39329 中 贡献

socket
socket  模 块现在 会在 linux 4
1或更 高版 本上导 出 canrawjoinfilters  常 量
由 stefan  tatschner 和 zackery  spytz  在 bpo 25780中 贡献
现 在 socket  模块 会在 支持 的平 台 上支 持 canj 1939协 议
 由 karl  ding 在 bpo 40291上 贡献
现在 socket 模 块 具有 socket
sendfds 和 socket
fds  方法
 由 joannah  nanjekye  shinya  okano  和 victor  stinner 在 bpo 28724中贡 献

time
sys
 增加 了 新的 sys
platlibdir  属性 平 台专 属库 目 录 的名称
它被 用于 构建 标准 库的 路径 以及已 安装扩 展模 块的路 径
它 在大 多数平 台 上等于 lib
 在 fedora  和 suse 上它等 于64位 平台上 的 lib 64
 由 janmat ě jek  mat ě j  cepl  charalampos  stratakis 和 victor  stinner 在 bpo 1294959中 贡献
 之 前的 版本 中 sys
stderr 在 非交互 模 式时 是带 块 缓冲 的
现在 stderr 默 认 总是 为行 缓冲 的
由 jendrik  seipp  在 bpo 13601 中 贡献

tracemalloc
增 加了 tracemalloc
resetpeak 用 于将 跟 踪的 内存 块峰值 大 小设为 当 前大 小以 测量特定 代 码 段的 峰 值
由 huon  wilson 在 bpo 40630 中贡献

typing
pep 593引 入 了一种 typing
annotated  类 型 以 使用 上下 文 专属 的元 数 据来 装 饰现 有类 型 并 将 新 的 includeextras 形 参添 加 到 typing
gettypehints 以 在运行 时 访问 元数据
 由 till  varoquaux 和 konstantin  kashin 贡献

unicodedata
unicode  数据 库已 更新到13
0 版
venv
由 venv 所 提 供 的 激活 脚本现 在总 是会使用 venvprompt 设 置的 值来 一致 地指 明它们 的 自定 义提 示符
 在之前 版 本中 某些 脚 本 会 无条 件地 使用 venvprompt 而 另一 些 脚本只 在其 恰 好 被设 置 时 这是默 认 情况 才 会使用 还有的 脚本会 改用 venvname
由 brett  cannon  在 bpo 37663中 贡 献

xml
当 把 xml
elementtree  序列化 为 xml  文 件 时属 性 内部的 空 白字符现在 将被 保留
不同的 行结 束符 不会 再被正 规 化 为 n
这是 对 于如何解 读 xml 规 范2
11 节的相关讨 论 的 最终结 果
由 mefistotelis  在 bpo 39011中贡 献

 性能优 化
 优 化 了 在推 导式中为 临 时变量 赋 值的 惯 用方 式
现 在 推 导式中 的 for  y  in  expr  会与简 单赋 值 语句 y  expr 一 样 快 速
 例 如 sums  s  for  s  in 0 for  x  in  data  for  s  in  s  x 不 同于 运算符这个 惯 用 方式 不会 使变 量泄 露到 外部 作 用域 中
 由 serhiy  storchaka  在 bpo 32856中 贡献
 优化 了 多线程 应 用 中的 信号处 理
 如 果一个线 程不 是获得 信 号 的主 线程字 节 码求 值循 环不 会 在每条 字节 码指令 上 被打 断 以检查 无法 被处理 的挂起 信 号
只 有主 解 释器 的 主线程 能 够处理 信号
 在 之 前版 本中 字 节码 求值 循环 会在 每 条指令 上被 打断 直到 主 线程 处理了信 号
由 victor  stinner  在 bpo 40010 上 贡献
 在 freebsd  上使 用 closefrom  优化 了 subprocess 模 块
 由 ed  maste  conrad  meyer  kyle  evans  kubilay  kocak 和 victor  stinner  在 bpo 38061 中贡 献
 pylongfromdouble  对 于 匹配 long  的 值 执 行速度现 在加 快 了1
87倍
 由 sergey  fedoseev  d  bpo 37986 中 贡献
 多个 python  内置类 型 range  tuple  set  frozenset  list  dict 现在 通过 使 用 pep 590 向 量调 用协 议 得到加 速
由 dong  hee  na  mark  shannon  jeroen  demeyer  和 petr  viktorin 在 bpo 37207中 贡 献
当 另 一集 合远大于 基础集 合的情 况 下优 化了 differenceupdate  的 性能
 由 evgeny  kapun  提议由 michele  orr ù 在 bpo 8425 中 贡 献代码
 python 的 小对 象 分配 器 obmalloc
c 现 在允许至 多 一 个 空 位可 用 于 立 即重用而 不必 将 其返 回 给 os
 这可 以防 止简单 循环中 的多 余消 耗在 每次迭代 中 可 以创 建和 销毁 全新的 空位
 由 tim  peters 在 bpo 37257中 贡 献
浮 点数 运算 中的 floor  division  现在 会有更好 的 性能
并 且此 运算 的 zerodivisionerror 的消 息 也已 更新
 由 donghee  na 在 bpo 39434 中贡献
 使 用 utf 8和 ascii  编解 码 器 解 码 短 ascii 字 符 串 现在会 加快大 约15
由 inada  naoki 在 bpo 37348 中贡 献
 以下 是对 从 python 3
4 到 python 3
9 的 提 升 提升 情况的 总结 python  version 3
3 以上结果 是 由以 下变量 访问 基准 测试脚 本所生 成 的 toolsscriptsvaraccessbenchmark
该 基 准测 试脚 本以纳 秒 为 单位 显示时 间
基 准测 试数 据是在 一块 intel ® core ™ i 74960 hq  处理 器 运行 从 python
org 获取的 macos 64位 编译版 本所得到 的
弃 用
移 除
移 植到 python
 本节 列出 了先前描 述的 更 改以 及 可能 需要 更改 代 码的 其 他错 误修 正
python  api 的 变化
c  api  的 变 化
 堆 分 配 类型 的 实例例 如 使用 pytypefromspec  和 类 似 api  创建的实 例自 python 3
8 起 会 带有 一个 对其 类型 对 象的引 用
正如 python 3
8的 c  api  中的 改 变部 分所述 对于 大 部 分情 况 来 说 这应 当不 会有 任何副 作 用 但对于 具有 自定义 tptraverse  函数 的类型 来 说 则要 确保 所有堆 分配 类 型 的自定 义 tptraverse 函 数可 访 问 对象 的 类型
示例 int  footraversefoostruct  self  visitproc  visit  void  arg  rest  of  the  traverse  function  if  pyversionhex 0 x 03090000 this  was  not  needed  before  python 3
9 python  issue 35810 and 40217 pyvisitpytypeself  endif 如果 你的遍 历函数委 托 给了 基类或其 他类 的 tptraverse 则 要确保 pytypeself  只被 访 问 一 次
 请 注意应 当 只 有 堆 类 型可访 问 tptraverse 中的 类型
 举例 来说如 果 你的 tptraverse  函数 包括 以下 内 容 basetptraverseself  visit  arg 则要 添加 if  pyversionhex 0 x 03090000 this  was  not  needed  before  python 3
9 python  issue 35810 and 40217 if  basetpflags  pytpflagsheaptype  a  heap  types  tptraverse  already  visited  pytypeself  else  pyvisitpytypeself  else  参阅 bpo 35810 和 bpo 40217了 解更 多 信 息
 pyevalcallobject  pyevalcallfunction  pyevalcallmethod  和 pyevalcallobjectwithkeywords 函 数已被弃 用
请改 用 pyobjectcall 及 其变 化形式
 详 情参 见 bpo 29548

cpython  字节 码的 改变
 添加了 loadassertionerror 操 作 码 用 于处 理 assert 语 句
 在之 前的 版本中 如果 assertionerror  异常 被 屏 蔽则 assert  语句将 不能正 常运作
 由 zackery  spytz 在 bpo 34880中 贡献
 compareop  操作码 已被 拆 分为 四 个单 独指 令 compareop 用于 富 比 较 isop 用 于 is 和 is  not 检测 containsop  用于 in  和 not  in 检 测 jumpifnotexcmatch  用于 检查 tryexcept  语 句中 的异 常
由 mark  shannon  在 bpo 39156中 贡献

 构 建的 改变
 将 withplatlibdir  选项 添加 到 configure 脚本平台专 属库 目 录的名称 保 存 在新 的 sys
platlibdir  属性 中
 请参 阅 sys
platlibdir 属 性了解 详情
由 jan  mat ě jek  mat ě j  cepl  charalampos  stratakis 和 victor  stinner  在 bpo 1294959 中贡 献
 countallocs  特殊 构 建 宏已 被移 除
由 victor  stinner  在 bpo 39489 中贡献
 在非 windows  平 台上 现在需 要用 setenv 和 unsetenv 函 数 来构建 python
由 victor  stinner  在 bpo 39395 中 贡献
 在非 windows 平 台上创 建 bdistwininst  安装 器 现在已不 受官方支 持
详情 参见 bpo 10945
当 在 macos  上 用 源 代码 编 译 python  时 tkinter 现在 会链 接 到 非 系统 的 tcl  和 tk 框 架如果它 们被安 装 到 libraryframeworks 的 话就如 在较 旧的 macos  发 行版 上 的情 况一 样
如 果通过 使 用 enable  universalsdk  或 isysroot 明 确地 配置 了 macos  sdk  则 只会搜索 sdk  本身
 默认 行为 仍然 可以 通过 withtcltkincludes  和 with  tcltklibs 来 覆盖
 由 ned  deily  在 bpo 34956 中贡 献
 python 现 在 可以 针对 windows 10 arm 64 进行 编译
 由 steve  dower  在 bpo 33125中贡 献
现 在当 使用 pgo 时一 些单 独 的测试 会 被跳过
 这些测 试 显 著增加 了 pgo 任务的 时 间 并且可能 无助 于 提升最 终 可 执行文 件 的 优化 程度
 这样能 使任 务加速大 约15倍
运 行完整 的单元测 试 是很慢 的
这个 改变 可 能 导致优 化程序 稍 差 的构 建因为 将被 执 行的 代 码分支 不够多
 如果 你 愿 意等待更 缓慢 的构 建 则 可 以使用
 profiletaskm  test  pgo  extended  来恢 复 旧版 本的 行为
 我们不保 证哪 个 pgo  任务 集能 产 生 更快的 构建
 关 心 此问 题的 用户应 当自 行运 行 相关 基 准测 试 因 为结果 可能 取决 于具体 环境、 工作负 载 以 及编 译工 具 链
请参 阅 bpo 36044和 bpo 37707 了解 详情

c  api 的 改变
新 的特 性
 pep 573添 加 了 pytypefrommoduleandspec  用于通 过 类来 关 联 一 个 模块 pytypegetmodule  和 pytypegetmodulestate 用 于获取 模 块及 其状态 以及 pycmethod 和 methmethod  用于允 许一个 方法 访问 其定义所 在的类
由 marcel  plch  和 petr  viktorin  在 bpo 38787 中贡 献
增加 了 pyframegetcode 函 数获 取帧代 码
增 加了 pyframegetback 函数 获 取帧的 下一 个外部帧
由 victor  stinner  在 bpo 40421中 贡献
 将 pyframegetlinenumber  添加 到受 限的 c  api
由 victor  stinner  在 bpo 40421中 贡献
增加 了 pythreadstategetinterpreter  和 pyinterpreterstateget 函 数用 于 获取 解释器
 增 加了 pythreadstategetframe  函数 用于 获 取 python 线 程 状态的 当前 帧
增 加了 pythreadstategetid  函 数获 取 python  线程 状态的唯 一标 识 符
 由 victor  stinner 在 bpo 39947中贡 献
将新 的公 有 pyobjectcallnoargs 函 数添 加到 c  api 该 函数 可不 带 任何参数 调 用 一个 python  可调 用对象
它 是 不 带参 数调 用 python  可调 用 对象 最有 效率 的方 式
由 victor  stinner 在 bpo 37194 中贡 献
 受 限 c  api 中 的改 变如果 定 义 了 pylimitedapi  宏提 供 pyenterrecursivecall  和 pyleaverecursivecall 作为 常规函 数用 于受 限 api
在之 前版本 中是 使用 宏定 义但 这些宏 不能 与无法 访 问 pythreadstate
recursiondepth  字 段的 受限 c  api 一 同编 译该 结构体 在受 限 c  api  中是不 透 明 的
 pyobjectinit  和 pyobjectinitvar  已成 为 常规 不透明 函数以 隐藏 实 现 细 节
由 victor  stinner  在 bpo 38644和 bpo 39542中 贡献
 增加了 pymoduleaddtype 函 数 以协 助 将类 型加 入到 模块 中
由 donghee  na 在 bpo 40024中 贡 献
将 pyobjectgcistracked  和 pyobjectgcisfinalized 函 数添 加到公 有 api 以 允许 分别 查询 python  对象 当前是 正在 被 追踪 还 是已 经被垃 圾回收 器所 终 结
由 pablo  galindo  salgado 在 bpo 40241 中贡 献
增 加 了 pyobjectfunctionstr 以 获 取函 数类 对 象 的用 户友 好的 表 示形 式
由 jeroen  demeyer  在 bpo 37645中修 正
增加了 pyobjectcallonearg  用 于调 用具 有一个 位置 参数 的 对 象由 jeroen  demeyer  在 bpo 37483中修正

 移植 到 python
evalframe  pep 523现 在 需要 有新 的 强 制性形 参 tstate  pythreadstate
 由 victor  stinner 在 bpo 38500 中贡 献
扩 展模 块 pymoduledef 的 mtraverse  mclear  和 mfree  等函数 在 模 块状 态被 请求 但尚未被 分配 时 将不会 再 被调用
 这 种情况 出现在 模 块被创 建之 后且模 块 被执行 pymodexec  函 数 之 前 的 时刻
 更准 确地说 这 些函数 在 msize 大 于0并 且模 块状态 即 pymodulegetstate 的返 回 值 为 null 时 将 不会 被调用
 没有模块 状态 的扩 展 模块 msize 0 不会 受到 影响
 现 在如 果 pyaddpendingcall 是 在子 解释 器 内部 被 调用 该 函数 会 被排入 子解 释器 的 调 用 日程 而不 是 由主 解释 器调 用
 每个 子解 释器 现 在都 拥 有 它们 自己的 调用 日程 列表
 由 victor  stinner 在 bpo 39984 中 贡 献
当 e  选项 被使用 如果 pyconfig
useenvironment 设 为0时将不 再使用 windows  注 册表 来初始 化 sys
path
这会 影响 在 windows 上嵌 入 python  的操 作
由 zackery  spytz 在 bpo 8901 中贡献
 全局 变 量 pystructsequenceunnamedfield 现在为 常量并 且指 向一 个字 符串 常 量
 由 serhiy  storchaka  在 bpo 38650 中贡 献
现 在 pygchead 结 构是不透 明的
 它 只 在内部 c  api  pycoregc
h  中定 义
 由 victor  stinner  在 bpo 40241中 贡 献
 pyunicodecopy  pyunicodefill  pyunicodewstrlength  pyunicodefromunicode  pyunicodeasunicode  pyunicodeasunicode  以及 pyunicodeasunicodeandsize  在 c 中 被 标记为 已 弃 用
它 们 自 python 3
3起 就已 被 pep 393弃用
 由 inada  naoki 在 bpo 36346 中贡献
 pyfatalerror  函数会被 一 个 自 动 记录当 前 函数名称 的宏 所替 代除 非 已定义 了 pylimitedapi 宏
由 victor  stinner 在 bpo 39882 中贡 献
 vectorcall  协 议现 在要 求 调 用者 只 传 入字 符 串作 为键 名
请 参 阅 bpo 37540了解详 情
多 个 宏和 函数 的 实 现 细 节现在 已被 隐 藏 pyobjectisgc  宏 已被 转换 为函数
 pyobjectnew  宏已 成为 pyobjectnew 宏 的 别名而 pyobjectnewvar  宏已成 为 pyobjectnewvar 宏 的别 名
它 们将不 再 直接访 问 pytypeobject
tpbasicsize 成 员
 pytypehasfeature 现在总是 会调 用 pytypegetflags
在之 前版本中当 受限的 c  api  未被使 用时 它会直 接访 问 pytypeobject
tpflags  成 员
 pyobjectgetweakrefslistptr 宏已 被 转 换 为函数 该宏 会直 接访问 pytypeobject
tpweaklistoffset  成员
 pyobjectcheckbuffer 宏 已被转换 为函数 该宏 会直接 访 问 pytypeobject
tpasbuffer  成 员
 现在 pyindexcheck 总 是被声明 为不 透明 函数 以隐藏 实 现 细 节 pyindexcheck  宏已 被 移除
 该 宏会直接 访 问 pytypeobject
tpasnumber  成员
详 情请 参 阅 bpo 40170

移 除
 pyfpe
h 的 pyfpestartprotect  和 pyfpeendprotect  宏已 从受 限 的 c  api 中 被排 除
由 victor  stinner  在 bpo 38835中 贡献
 pytypeobject  的 tpprint 空 位已 被移 除
它 在 python 2
7 及 之前的版 本 中被用 来将 对 象打印 到文件
 自 python 3
0起 它已 被 忽略 并 且不 再 使 用
由 jeroen  demeyer  在 bpo 36974中 贡献
 受 限 c  api 中 的改变 如果 定义 了 pylimitedapi  宏以 下 函 数已 从受 限 c  api  中排除 pythreadstatedeletecurrent  由 joannah  nanjekye 在 bpo 37878 中 贡献
 pycheckrecursionlimit  pynewreference  pyforgetreference  pytracemallocnewreference  pygetreftotal  在 受限 c  api 中 从未 使用 的垃 圾箱 机 制
 pytrashunwindlevel  pytrashcanbegincondition  pytrashcanbegin  pytrashcanend  pytrashcansafebegin  pytrashcansafeend 已将 下 列 函数 和 定义 移至 内部 c  api  pydebugprinttotalrefs  pyprintreferences  pyprintreferenceaddresses  pytracemallocconfig  pyaddtoallobjects  pytracerefs  构建 专属 由 victor  stinner 在 bpo 38644和 bpo 39542 中贡献
 移 除 了 pyruntime
getframe  钩 子 并移 除 了 pythreadstategetframe 宏该 宏 是 pyruntime
getframe 的 一 个别名
它 们仅由 内部 c  api  对 外公 开
同 样地 移除 了 pythreadframegetter  类 型
由 victor  stinner 在 bpo 39946 中 贡 献
从 c  api  移除了下列函 数
 请显 式 地调 用 pygccollect 来 清空所 有自由 列 表
由 inada  naoki  和 victor  stinner 在 bpo 37340 bpo 38896 和 bpo 40428中 贡献
 pyasyncgenclearfreelists  pycontextclearfreelist  pydictclearfreelist  pyfloatclearfreelist  pyframeclearfreelist  pylistclearfreelist  pymethodclearfreelist 和 pycfunctionclearfreelist  绑 定方法对 象的自 由列 表已 被移 除
 pysetclearfreelist 集 合 自 由 列表已 在 python 3
4中 被 移除
 pytupleclearfreelist  pyunicodeclearfreelist  unicode 自 由列 表已 在 python 3
3 中被移除
 移除 了 pyunicodeclearstaticstrings  函 数
由 victor  stinner  在 bpo 39465 中贡 献
移除 了 pyunicodematch
它已被 pep 393 所弃用 并自 python 3
3起 不 再 可用
可 以改 用 pyunicodetailmatch 函数
 由 inada  naoki 在 bpo 36346中 贡 献
清 除 了 已 定义 但 未 实现的接 口 的头 文 件
 被 移 除 了公 共 api  符号有 pybytesinsertthousandsgroupinglocale  pybytesinsertthousandsgrouping  pyinitializefromargs  pyinitializefromwideargs  pyfloatrepr  pyfloatdigits  pyfloatdigitsinit  pyframeextendstack  pyaiterwrappertype  pynullimportertype  pycmpwrappertype  pysortwrappertype  pynoargsfunction
 由 pablo  galindo  salgado  在 bpo 39372中 贡 献

更新 日志
python 下一版
发 布日期 xxxxxxxx
 安全
 bpo 42051模 块 plistlib  不再 接受 xml 属性 列表文 件中 的实体声 明避 免引发 xml  脆弱 性
此更 改不应 该影响 用户 使用 因 为实 体声 明在常规 属性 列表 文 件 中 不被 使用
核心 与内置
 bpo 42218 修正了 peg 解 析器 中导致 调 试 模式 崩溃的错误
 现 在在 左 递 归规 则 中 检查 错误以 避 免 此类错 误没 有得 到及 时处 理并在 其 他地 方出 现长距 离 崩溃 的情 况
 bpo 42214 修正了 peg  解 析器 在 检查 barryasflufl  规 则中的标 记时 可 能的 崩 溃
由 pablo  galindo  修 正
 bpo 41910记 录 object
eq 的默 认实现
 bpo 42057修复 窥孔 优 化程序 对 条件 跳 转 jumpifnotexcmatch 对 的 错误优化
 bpo 41984 垃圾回 收 器现 在 会跟 踪所 有用户 定义类
由 brandt  bucher  修复
库
 文档
 测试
 构建
windows
macos
idle
c  api
python 390 final
 库
测试
 构 建
python 390 release  candidate
核心 与内 置
库
文 档
 bpo 40979重 构 typing
rst 将超 过70个 类、 函 数和 装 饰器组 织至新的 子小节
测 试
构建
windows
c  api
python 390发 布候选 版
发 布日期20200811
 核 心与内 置
 bpo 38156 正 确地 处理 pyosstdioreadline 中 eof  之后的中 断
库
 bpo 41497 在 dis 模 块中 修复 潜在 的 unicodedecodeerror
 bpo 41490更 新 ensurepip 以安 装 pip 20
1 和 setuptools 49
 bpo 41467在 windows 上 修 复 asyncio  recvinto 当 套 接字管 道 被 关闭时 的返 回值 brokenpipeerror  返回0 而不是 空字节串 b 
 bpo 41425 让 tkinter 文档示 例可运 行
 bpo 41384当 传给 tkinter
optionmenu 的 选项未 知 时引 发 tclerror 而不 是 typeerror
 bpo 38731修复 了 pycompile 模块 命 令行界面 下 的 nameerror
 bpo 41317在 asyncio
sockaccept 中 使用 adddonecallback 以 在 撤 销时 及 早退订读 取器
 bpo 41364减 少 uuid  的 导 入开 销
 bpo 41341在 gettypehints  中对 typing
forwardref 递归 求 值
 bpo 41182选择器 使用基 于 defaultselector  的实 现 bpo 40726 处理 在 ast
incrementlineno 上 endlineno 为 none  的情况
 文档
 bpo 41045添 加了 关于 fstrings  调试 功能 的文 档
 bpo 41314将 from  future  import  annotations  的默 认 值 由4
0变更 到3
10 参 考 pep 563 的 变更
windows
 bpo 41492 修复 了 uac  提示的描 述
 bpo 28791更 新 windows 版 本以 支持 sqlite 3
21
0
idle
 bpo 41468改进 idie  运行 错误 信息也 许用户永 远都 看不 到
python 390 beta
安 全
核心 与内 置
库
文 档
macos
idle
c  api
python 390 beta
安全
 核 心与 内置
库
 测试
构 建
windows
macos
idle
c  api
python 390 beta
库
构 建
python 390 beta
 核心与内 置
 库
测试
 构建
windows
macos
idle
c  api
python 390 beta
安 全
 核 心与 内 置
库
文档
 测试
构 建
windows
macos
 工具 示 例
c  api
python 390 alpha
安 全
核 心 与内置
库
 文档
 bpo 39879 updated 数 据 模型 docs  to  include  dict  insertion  order  preservation
 测 试
构 建
windows
macos
idle
工具 示例
c  api
python 390 alpha
安 全
核心 与内 置
库
 文档
 测 试
构 建
windows
macos
idle
工具 示例
c  api
没 有 模块状 态 的扩 展 模 块 msize 0不会 受到 影响
python 390 alpha
 安全
 核心 与内 置
库
文 档
 测试
构 建
windows
idle
c  api
python 390 alpha
 核心 与 内置
库
 文 档
 构 建
idle
c  api
python 390 alpha
发 布 日期20191218
 安全
 核心 与内置
 库
文档
测 试
构 建
windows
macos
idle
c  api
python 390 alpha
安 全
 bpo 38418修复 os
system 的 审计 事 件被命名 为 os
system 
 bpo 38243 在 将文 档 页渲 染为 html 时 会对 xmlrpc
docxmlrpcserver 的服 务器标 题 进行 转义
 由 donghee  na  在 bpo 38243中 贡献
 bpo 38174将 厂商 化 的 expat 库版 本 更新至2
8 这解 决了 cve 201915903
 bpo 37764 修复 了 email
getunstructured  在 邮件头不 包含末尾 空 格以 及 在其包 含无 效的 已编 码 字 等特 定情 况下进 入 无限循 环 的问题
 由 ashwin  ramaswami  贡献 补 丁
 bpo 37363 adds  audit  events  for  the  range  of  supported  run  commands  see  命 令行 与环 境
 bpo 34631 在 windows  安 装 程序中 将 openssl 更新为1
1 c  bpo 34155 fix  parsing  of  invalid  email  addresses  with  more  than  one  e
核 心与 内置
 库
 文 档
 测试
 bpo 38117 使 用 openssl 1
1 d 进行 测试 bpo 38018 increase  code  coverage  for  multiprocessing
 构建
windows
 bpo 38492删 除 pythonw
exe 依 赖的 microsoft  c  执 行 库
 bpo 38117将 绑 定 的 openssl 更 新到1
 bpo 10945正 式 取 消 对在 非 windows  系 统上创建 bdistwininst  安 装 程 序的 支持
 bpo 35360 更新 windows  构 建 以 使用 sqlite 3
macos
 bpo 38117 在 macos 安装 程 序中 将 openssl  更新 为1
1 d
 bpo 35360更新 macos  安 装 程序 以使用 sqlite 3
 bpo 34631 在 macos  安装 程序 中将 openssl 更 新为1
1 c
idle
工 具示 例
c  api
python 380 beta
 发 布日 期20190604
 安 全
核 心 与内置
 库
文档
 测 试
 bpo 37081使 用 openssl 1
1 c 进 行测试 bpo 36829 add  test
构 建
增 加一 个 pkgconfig  python 3
8 embed 模块 用来 将 python 嵌 入到一 个 应用中 pkgconfig  python 3
8 embed  libs  包 含 lpython 3
 要同 时支 持3
8 和旧 版 本 请 先尝试 pkgconfig  pythonx
yembed  libs  并在此命令失败时 回退 到 pkgconfig  pythonx
y  libs  即 不 带 embed  请 将 x
y  替 换为 python  版本 号
windows
macos
idle
 工 具 示 例
c  api
python 380 alpha
发 布日期20190506
安 全
 bpo 36742 于函 数 urlsplit  中 修复 了 对于预 规格 化字符 的不 当处 理 过 程
核 心与内置
库
semaphoretracker  so  it  is  reused  by  child  processes  bpo 31292 为包 含 include  指 令的 文 件 修 复 setup
py  check  restructuredtext
 文 档
 bpo 36425 新增 的 文档 翻译 简体 中 文
测试
 构 建
windows
macos
idle
工具 示例
c  api
python 380 alpha
 发布日 期20190325
 安全
核 心与 内 置
 bpo 36236在 python 初 始 化时 如果 当 前 目 录被 移 除 则它将 不再 会 被添 加 到 sys
path 中
 bpo 36262 修 复了 在 floatstr  complexstr  pickle
load  marshal
load  等 所用的 函数 pydgstrtod 中进行从 字符串 到浮 点数 的转 换时偶有 发 生 的 一 个内 存 泄漏 问题
 库
文档
 测 试
 构建
windows
idle
 bpo 36176修复 idle  自动补全 和 calltip  悬浮 窗的颜色
 避 免 与 linux 暗色 主题 冲 突略 微 加深 了 calltip 的 背景 颜 色
 bpo 23216将 文档 字符串添 加 到 idle  的搜索模 块
 工 具示 例
c  api
python 380 alpha
发布 日期20190225
核心 与内 置
 库
文档
测 试
windows
idle
 bpo 24310 idle 文 档设 置 对话 框字体 选 项卡 示 例
python 380 alpha
发 布 日 期20190203
安 全
核 心与内 置
库
 文档
 bpo 33604更 新 hmac  md 5默认 报告 deprecationwarning 并 将 在3
8移 除
 bpo 33503修复 错误的 pypi 链 接 bpo 33421为 typing
asynccontextmanager  添加 缺失 的文档
 测试
 bpo 26704添加了 对 一 个 实例 方法进 行双重 修 补的 测试演示
 补 丁作 者为 anthony  sottile
 bpo 33655 忽略 运行 在 bsd 平台 的 zfs 上 时 testposixfallocate 的 失 败
构 建
windows
 bpo 35402更新 windows  构建以 使用 tcl 和 tk 8
9 bpo 35401 将 windows 内 部版 本更 新 到 openssl 1
 bpo 33316 pythreadreleaselock  always  fails  bpo 33184在 windows  安装 程序 中将 openssl  更 新为1
macos
 bpo 35401在 macos  安装程 序中将 openssl  更 新 为1
 bpo 34405 在 macos 安 装程 序中 将 openssl  更新 为1
0 i 
 bpo 33184在 macos  安装 程序 中 将 openssl 更新为1
idle
 bpo 35769 将 idle 的新 文件 名从 untitled 更改为 untitled  bpo 35660 fix  imports  in  idlelib
 bpo 35641 当函 数没有 文档 字符串 时正 确地 格式 化 calltip
 工 具示 例
c  api
 bpo 35259基 于 pylimitedapi 有条 件地声明 pyfinalizeex 3
6中 新增
 补丁 作者 arthur  neufeld
python 370 正式 版
发 布 日期20180627
 库
c  api
python 370 rc
发布日期20180612
 核心 与内 置
 库
文 档
 构 建
windows
idle
python 370 beta
发 布 日 期20180530
 核 心 与内 置
库
 文档
 bpo 33604 更 新 hmac  md 5 默认报 告 deprecationwarning  并 将 在3
8 移除
 bpo 33503修复 错 误的 pypi 链接 bpo 33421为 typing
asynccontextmanager  添 加缺失的 文档
 测 试
 bpo 33655 忽略运 行 在 bsd 平 台的 zfs  上 时 testposixfallocate 的 失败
 bpo 32604删除 xxsubinterpreters 模 块用 于测 试 和相关的 帮 助程 序
该 模块 最 初 最 初是 在3
7 b 1 中 添加 的
构建
macos
idle
python 370 beta
 发 布日期20180502
 核心 与 内 置
 bpo 33363 在 异步 函数 外 使 用 async  with 和 async  for  时抛 出 syntaxerror 异 常
 bpo 33128修复导 致 pathfinder 在 sys
metapath 上 出现两 次 的错 误
由 pablo  galindo  salgado 提 供补丁
 bpo 33231修 复 normalizestring  中潜 在 的 内 存泄 漏
 库
 文 档
 测试
构建
windows
 bpo 33184 在 windows  安装程 序中将 openssl 更新 为1
macos
 bpo 33184在 macos  安装程 序 中 将 openssl  更新 为1
idle
工 具示 例
python 370 beta
发 布 日 期20180329
 安 全
 核 心与 内 置
 库
 文 档
测 试
 构 建
windows
macos
idle
 工 具 示 例
c  api
python 370 beta
 发 布日 期20180227
 安全
 核心与 内置
 库
 文档
 测试
构建
windows
macos
idle
工 具示例
python 370 beta
 发布 日期20180130
核 心与 内置
 库
文 档
测试
 构 建
 bpo 32593 放 弃对 freebsd 9 及更 早 版 本的支 持
windows
macos
c  api
python 370 alpha
发布日 期20180108
 核 心 与 内置
库
文 档
 测试
windows
工 具 示例
c  api
python 370 alpha
 发 布 日期20171205
 核 心与 内置
 库
文档
测试
 构建
 bpo 28791 更新 windows  构建以使用 sqlite 3
 bpo 28791 更新 os  x 安装程 序以 使用 sqlite 3
windows
macos
 bpo 31392更 新 macos 安 装 程序以 使用 openssl 1
idle
 工具 示例
c  api
python 370 alpha
 发布 日期20171016
 核心与 内置
 bpo 31709 取 消对 异 步 aiter 的 支持
 库
文 档
构 建
 bpo 31624 删除 对 bsdos 的 支持
idle
c  api
python 370 alpha
发布 日 期20170919
安全
 核 心与内 置
 库
文 档
 测 试
 构建
 bpo 29572 更 新 windows  构 建和 os  x 安 装 程 序 以 使用 openssl 1
 bpo 28208 更 新 windows  构建 和 os  x  安 装 程 序 以 使 用 sqlite 3
 bpo 28248 更 新 windows 构建 和 os  x  安 装 程 序以使 用 openssl 1
windows
 bpo 31392更 新 windows  构 建以使 用 openssl 1
idle
 工 具示例
c  api
python 366 正 式 版
 发布日 期20180627在3
6版 本中没 有 新 的 更改
python 366 rc
 发布 日 期20180611
 核 心与 内置
 bpo 33231修复 normalizestring  中潜 在的 内存泄 漏
 库
 bpo 33127 ssl  模块现 在 使用 libressl 2
1 编译
文档
 bpo 33503 修复 错误 的 pypi 链 接 bpo 33421为 typing
asynccontextmanager 添加缺 失的 文档
测 试
 bpo 33655 忽 略 运行 在 bsd 平 台 的 zfs  上时 testposixfallocate  的 失败
 构 建
windows
 bpo 33184 更 新 windows  构 建以 使用 openssl 1
macos
 bpo 33184 更新 macos  安装 程序以 使用 openssl 1
idle
工具 示例
c  api
python 365 正 式 版
发 布 日 期20180328
测 试
 构 建
python 365 rc
发 布 日期20180313
安 全
核心 与内置
 库
文档
 测试
 构 建
windows
macos
idle
工 具示 例
c  api
python 364正式 版
发布 日期20171218 从3
4 rc 1 到3
4 正式版中 没有 新的 代 码更改
python 364 rc
发 布日 期20171205
 核心 与内 置
库
文 档
测 试
构 建
 bpo 28791 更新 windows  构 建以 使用 sqlite 3
 bpo 28791 更 新 os  x  安装 程序以 使 用 sqlite 3
windows
macos
 bpo 31392更 新 macos 安 装 程 序 以 使用 openssl 1
idle
 工 具示 例
c  api
python 363正 式 版
发 布日期20171003
 库
 构建
python 363 rc
发 布 日 期20170918
安 全
 核心与 内置
 库
文 档
 测试
构 建
windows
idle
工具示例
python 362 正式版
 发 布 日期20170717自 rc 2 起 没有更 改
python 362 rc
 发布 日期20170707
 安 全
python 362 rc
发 布 日 期20170617
核心 与 内置
库
 安 全
 库
idle
c  api
构 建
文 档
工 具 示 例
 测 试
windows
python 361正式 版
发 布 日期20170321
核 心 与 内置
 构建
python 361 rc
 发布 日期20170304
 核 心与 内置
 库
idle
windows
c  api
文档
测 试
构 建
 bpo 29572更新 windows  构建 和 os  x 安装 程 序以使用 openssl 1
python 360 正式版
发 布 日期20161223 自 rc 2起没 有更改
python 360 rc
 发布 日期20161216
 核心与内 置
 工 具示例
windows
 构 建
python 360 rc
发布 日期20161206
核心 与 内 置
库
c  api
文档
 工具 示例
python 360 beta
发 布日 期20161121
核 心与 内置
库
 文 档
测试
构建
python 360 beta
 发 布 日 期20161031
 核 心与内 置
库
windows
 构建
 bpo 28208更新 windows  构建和 os  x  安 装 程 序 以使用 sqlite 3
 bpo 28248更 新 windows  构 建 和 os  x  安 装 程序以使 用 openssl 1
 测 试
python 360 beta
发 布日期20161010
 核心 与内置
 库
windows
c  api
构 建
 测 试
python 360 beta
发 布日期20160912
核 心与内 置
 库
idle
c  api
测试
构 建
更 新 os  x 安 装 包使 用 sqlite 3
1和 xz 5
2版本
 工具示 例
windows
 bpo 27883在 windows  上将 sqlite 更 新 到3
0
python 360 alpha
发布日 期20160815
核 心与 内 置
 库
idle
测 试
windows
构建
python 360 alpha
发 布日期20160711
 核心 与内置
 库
 安全
库
安 全
库
idle
c  api
 构建
 bpo 26930 更 新 windows 构 建以使用 openssl  openssl 1
 在 gnuhurd 系统 中不 使用 大文 件 支持
 工具示例
 文档
 测试
python 360 alpha
发 布 日 期20160613
 核心与内 置
库
 安 全
库
安 全
 库
idle
文 档
 测试
windows
构 建
 bpo 26930更 新 os  x 10
5仅32 位 安 装 程序 以构 建并 链 接 openssl 1
windows
c  api
工 具示 例
python 360 alpha
发 布日 期20160516
核心 与 内置
 库
 安 全
库
 安全
 库
安 全
 库
idle
文档
 测试
构 建
 bpo 26465 更 新 windows  构 建 openssl 1
 bpo 26465更新 os  x 10
5 仅32位 安装 程序以 构建并 链 接 openssl 1
 bpo 26268 更新 windows 构 建 openssl 1
windows
 工具示 例
c  api
python 355正 式版
 发布日期 e 20180204 在3
5 版 本 中 没 有 新的 更改
python 355 rc
 发 布日 期20180123
 安全
核心 与内 置
库
python 354正 式版
发布 日期20170807
库
python 354 rc
 发 布 日 期20170723
安 全
 核心 与 内 置
库
文 档
测 试
 构建
windows
c  api
python 353正式版
 发 布 日期20170117 there  were  no  code  changes  between 3
python 353 rc
发 布日期20170102
核 心 与内 置
库
安全
 库
 安 全
库
idle
c  api
文 档
 测试
工 具 示例
windows
构建
 bpo 28248更 新 windows  构建 和 os  x 安装 程 序以使用 openssl 1
python 352 正 式版
 发 布 日期20160626
 核心与 内置
 bpo 26930 更 新 windows  构建以 使用 openssl  openssl 1
 测试
idle
python 352 rc
 发布日 期20160612
核心 与内置
 安全
库
 安全
库
 安全
 库
 安 全
库
 安全
 库
idle
 文档
 测试
 构建
 bpo 26465更新 windows  构建 openssl 1
 bpo 26930更新 os  x 10
5 仅32 位安装程 序 以 构建 并链 接 openssl 1
 bpo 26268更新 windows  构建 openssl 1
windows
 工具示例
windows
python 351 正 式 版
 发布日 期20151206
核 心与 内 置
windows
python 351 rc
 发布 日期20151122
核 心与内置
 库
idle
文档
 测试
构 建
windows
工具 示例
python 350正 式版
发 布日期20150913
构 建
python 350 rc
发布 日期20150909
 库
 构建
python 350 rc
发 布日 期20150907
 核心 与内置
 库
python 350 rc
 发 布 日期20150825
 核心 与 内置
 库
python 350 rc
 发布日期20150809
 核 心 与内 置
库
idle
 文 档
测 试
python 350 beta
发 布日 期20150726
 核心 与 内 置
库
 构建
 bpo 24603 更新 windows 构 建和 os  x 10
5安 装程 序 以使用 openssl 1
python 350 beta
 发布日期20150705
 核心 与内置
 库
测 试
文档
 构 建
 bpo 24432 更 新 windows  构 建 和 os  x 10
5安 装程序 以 使 用 openssl 1
python 350 beta
 发布日 期20150531
 核心 与内置
 库
python 350 beta
发 布日 期20150524
 核心 与 内 置
库
idle
 测试
 文 档
 工 具 示例
python 350 alpha
 发布 日期20150419
核心与内 置
库
构 建
测试
 工 具示 例
c  api
python 350 alpha
发布 日期20150328
 核 心与内 置
库
构建
 测试
工 具示例
python 350 alpha
发 布日 期20150309
核心 与 内置
 库
构 建
 bpo 23686更新 os  x 10
5 安装 程序以 使 用 openssl 1
c  api
windows
python 350 alpha
 发布 日 期20150208
 核心与 内置
升 级 unicode 数 据 库到7
0 版本
 库
 bpo 23248从最新 的 openssl  git  master 更新 ssl  错误 代 码
 在 html
entities 包 中增 加 all 变 量
 bpo 22085在 tkinter  中删 除 了对 tk 8
3的 支持
idle
构建
 bpo 22592 放 弃对 borland  c 编 译 器构 建 python 的支持
distutils  模 块仍然 支持它来 构建 扩展
 bpo 22591放 弃 对 msdos 的 支持尤 其是 djgpp 编 译 器 gcc  的 msdos 端 口
c  api
 文 档
 测试
 bpo 21275修复 kfreebsd  上的 套接 字测试
 bpo 20635 添加了 针对 tk  几何管理 器 的 测试
 增加 freeze  包 的测 试用例
 bpo 20743 修 复 testtcl  中的引 用泄 漏
 bpo 21097 将 testnamespacepkgs 移 至 testimportlib
工具 示例
 bpo 21906让 toolsscriptsmd 5 sum
py 可 以工作在 python 3
 由 zachary  ware 提供补 丁
为2 to 3添 加 yield  from 的支 持
windows
 bpo 23260更 新 windows 安装 器 the  bundled  version  of  tcltk  has  been  updated  to 8
 bpo 22644 openssl 的 捆 绑版 本 已更新 到1
有 关 旧版 本的信息请 参阅 history  文件
python  有什么 新变化？
