术语对照表 文档说明 这些文档生成自 原文档由 一个专门为 文档写的文档生成器创建 本文档和它所用工具链的开发完全是由志愿者完成的这和 本身一样 如果您想参与进来请阅读 解决 了解如何参与 我们随时欢迎新的志愿者非常感谢 创造了用于早期 文档的工具链以及撰写了非 常多的文档 软件包 项目创建了 文本格式和 软 件套件 从他的 项目中获得 了很多好的想法 文档贡献者 编码与解码经过 转码的可打印数据 源代码 此模块会执行转换后可打印的传输编码与解码具体定义见 转换后可打印的编码格式被设计用于只包含相对较少的不可打印字符的数据如果存在大量这样的字符通过 模块所提供的 编码方案会更为紧凑例如当发送图片文件时 解码 文件的内容并将已解码二进制数据结果写入 文件 和 必须为 二进制文件对象 如果提供了可选参数 且为真值下划线将被解码为空格 此函数可用于解码 编码的 头数据具体描述见 编码 文件的内容并将转换后可打印的数据结果写入 文件 和 必须为 二进制文件对象 是一个 非可选的旗标它控制是否要编码内嵌的空格与制表符当为真值时将编码 此类内嵌空白符当为假值时则保持原样不进行编码 请注意出现在行尾的 空格与制表符总是会被编码具体描述见 旗标控 制空格符是否要编码为下划线具体描述见 类似 区别在于它接受一个源 并返回对应的已解码 类型 区别在于它接受一个源 并返回对应的已编码 在默认情况下它会发送 值给 函数的 形参 参见 模块 编码与解码 数据 服务器 基于线程的并行 线程本地数据 线程本地数据是特定线程的数据 管理线程本地数据只需要创建一个 或者一个子类型的实例并在实例中储存属性 在不同的线程中实例的值会不同 一个代表线程本地数据的类 更多相关细节和大量示例参见 模块的文档 线程对象 锁对象 原始锁是一个在锁定时不属于特定线程的同步基元组件 在 中它是能用的最低级的同步基元组件由 扩展模块直接实现 原始锁处于 锁定 或者 非锁定 两种状态之一 它被创建时为非锁定状态 它有两个基本方法 和 当状态为非锁定时 将状态改为 锁定 并立即返回 当状态是锁定时 将阻塞至其他线程调用 将其改为非锁定状态然后 调用重置其为锁定状态并返回 只在锁定状态下调用 它将状态改为非锁定并立即返回 如果尝试释放一个非锁定的锁则会引发 异常 锁同样支持 上下文管理协议 当多个线程在 等待状态转变为未锁定被阻塞然后 重置状态为未锁定时只有一个线程能继续执行至于哪个等待线程继续执行没有定义并且会根据实现而不同 所有方法的执行都是原子性的 实现原始锁对象的类 一旦一个线程获得一个锁会阻塞随后尝试获得锁的 线程直到它被释放任何线程都可以释放它 需要注意的是 其实是一个工厂函数返回平台支持的具体锁类中最 有效的版本的实例 可以阻塞或非阻塞地获得锁 当调用时参数 设置为 缺省值阻塞直到锁被释 放然后将锁锁定并返回 在参数 被设置为 的情况下调用将不会发生阻塞 如果调用时 设为 会阻塞并立即返回 否则将锁锁定并返回 当浮点型 参数被设置为正值调用时只要无法获得锁将最 多阻塞 设定的秒数 参数被设置为 时将无 限等待 当 为 时 指定的值将被忽略 如果成功获得锁则返回 否则返回 例如发生 超时 的时候 在 版更改 新的 形参 在 版更改 现在如果底层线程实现支持则可以通过 上的信号 中断锁的获取 释放一个锁 这个方法可以在任何线程中调用不单指获得锁的线程 当锁被锁定将它重置为未锁定并返回 如果其他线程正在等待这个锁 解锁而被阻塞只允许其中一个允许 在未锁定的锁调用时会引发 异常 没有返回值 如果获得了锁则返回真值 递归锁对象 重入锁是一个可以被同一个线程多次获取的同步基元组件 在内部它在基元锁的锁定非锁定状态上附加了 所属线程 和 递归等级 的概念 在锁定状态下某些线程拥有锁 在非锁定状态下 没有线程拥有它 若要锁定锁线程调用其 方法一旦线程拥有了锁方法将返回 若要解锁线程调用 方法 对可以嵌套只有最终 最外面一对的 将锁解开才能让其他线程继续处理 阻塞 递归锁也支持 上下文管理协议 此类实现了重入锁对象 重入锁必须由获取它的线程释放 一旦线程获得了 重入锁同一个线程再次获取它将不阻塞线程必须在每次获取它时释放一 次 需要注意的是 其实是一个工厂函数返回平台支持的具体递归锁类 中最有效的版本的实例 可以阻塞或非阻塞地获得锁 当无参数调用时 如果这个线程已经拥有锁递归级别增加一并立即 返回 否则如果其他线程拥有该锁则阻塞至该锁解锁 一旦锁被解锁 不属于任何线程则抢夺所有权设置递归等级为一并返回 如果多 个线程被阻塞等待锁被解锁一次只有一个线程能抢到锁的所有权 在 这种情况下没有返回值 当发起调用时将 参数设为真值则执行与无参数调用时一样 的操作然后返回 当发起调用时将 参数设为假值则不进行阻塞 如果一个 无参数调用将要阻塞则立即返回 在其他情况下执行与无参 数调用时一样的操作然后返回 当发起调用时将浮点数的 参数设为正值时只要无法获得锁 将最多阻塞 所指定的秒数 如果已经获得锁则返回 如果超时则返回假值 在 版更改 新的 形参 释放锁自减递归等级 如果减到零则将锁重置为非锁定状态不被任 何线程拥有并且如果其他线程正被阻塞着等待锁被解锁则仅允许 其中一个线程继续 如果自减后递归等级仍然不是零则锁保持锁定 仍由调用线程拥有 只有当前线程拥有锁才能调用这个方法 如果锁被释放后调用这个方法 会引起 异常 没有返回值 条件对象 条件变量总是与某种类型的锁对象相关联锁对象可以通过传入获得或者在缺省的情况下自动创建 当多个条件变量需要共享同一个锁时传入一个锁很有用 锁是条件对象的一部分你不必单独地跟踪它 条件变量遵循 上下文管理协议 使用 语句会在它包围的代码块内获取关联的锁 和 方法也能调用关联锁的相关方法 其它方法必须在持有关联的锁的情况下调用 方法释放锁然后阻塞直到其它线程调用 方法或 方法唤醒它 一旦被唤醒 方法重新获取锁并返回 它也可以指定超时时间 注意 方法和 方法并不会释放锁这意味着被唤醒的线程不会立即从它们的 方法调用中返回而是会在调用了 方法或 方法的线程最终放弃了锁的所有权后返回 使用条件变量的典型编程风格是将锁用于同步某些共享状态的权限那些对状态的某些特定改变感兴趣的线程它们重复调用 方法直到看到所期望的改变发生而对于修改状态的线程它们将当前状态改变为可能是等待者所期待的新状态后调用 方法或者 方法 例如下面的代码是一个通用的无限缓冲区容量的生产者消费者情形 使用 循环检查所要求的条件成立与否是有必要的因为 方法可能要经过不确定长度的时间后才会返回而此时导致 方法调用的那个条件可能已经不再成立 这是多线程编程所固有的问题 方法可自动化条件检查并简化超时计算 选择 还是 取决于一次状态改变是只能被一个还是能被多个等待线程所用 例如在一个典型的生产者消费者情形中添加一个项目到缓冲区只需唤醒一个消费者线程 实现条件变量对象的类 一个条件变量对象允许一个或多个线程在被其它线 程所通知之前进行等待 如果给出了非 的 参数则它必须为 或者 对象并且它将被用作底层锁 否则将会创建新的 对象并将其 用作底层锁 在 版更改 从工厂函数变为类 请求底层锁 此方法调用底层锁的相应方法返回值是底层锁相应方法的 返回值 释放底层锁 此方法调用底层锁的相应方法 没有返回值 等待直到被通知或发生超时 如果线程在调用此方法时没有获得锁将会 引发 异常 这个方法释放底层锁然后阻塞直到在另外一个线程中调用同一个条件 变量的 或 唤醒它或者直到可选的超时发 生 一旦被唤醒或者超时它重新获得锁并返回 当提供了 参数且不是 时它应该是一个浮点数代 表操作的超时时间以秒为单位可以为小数 当底层锁是个 不会使用它的 方法释放锁因为 当它被递归多次获取时实际上可能无法解锁 相反使用了 类的内部接口即使多次递归获取它也能解锁它 然后在重新获取锁 时使用另一个内部接口来恢复递归级别 返回 除非提供的 过期这种情况下返回 在 版更改 很明显方法总是返回 等待直到条件计算为真 应该是一个可调用对象而且它 的返回值可被解释为一个布尔值 可以提供 参数给出最大等 待时间 这个实用方法会重复地调用 直到满足判断式或者发生超时 返 回值是判断式最后一个返回值而且如果方法发生超时会返回 忽略超时功能调用此方法大致相当于编写 因此规则同样适用于 锁必须在被调用时保持获取并在返 回时重新获取 随着锁定执行判断式 新版功能 默认唤醒一个等待这个条件的线程 如果调用线程在没有获得锁的情况下 调用这个方法会引发 异常 这个方法唤醒最多 个正在等待这个条件变量的线程如果没有线程 在等待这是一个空操作 当前实现中如果至少有 个线程正在等待准确唤醒 个线程 但是依赖这个行为并不安全 未来优化的实现有时会唤醒超过 个 线程 注意被唤醒的线程实际上不会返回它调用的 直到它可以重 新获得锁 因为 不会释放锁只有它的调用者应该这样做 唤醒所有正在等待这个条件的线程 这个方法行为与 相似 但并不只唤醒单一线程而是唤醒所有等待线程 如果调用线程在调用这 个方法时没有获得锁会引发 异常 信号量对象 例子 事件对象 这是线程之间通信的最简单机制之一一个线程发出事件信号而其他线程等待该信号 一个事件对象管理一个内部标识调用 方法可将其设置为 调用 方法可将其设置为 调用 方法将进入阻塞直到标识为 实现事件对象的类 事件对象管理一个内部标识调用 方法可将其 设置为 调用 方法可将其设置为 调用 方法将进入阻塞直到标识为 这个标识初始时为 在 版更改 从工厂函数变为类 当且仅当内部标识为 时返回 将内部标识设置为 所有正在等待这个事件的线程将被唤醒 当标 识为 时调用 方法的线程不会被被阻塞 将内部标识设置为 之后调用 方法的线程将会被阻塞 直到调用 方法将内部标识再次设置为 阻塞线程直到内部变量为 如果调用时内部标识为 将立即 返回 否则将阻塞线程直到调用 方法将标识设置为 或 者发生可选的超时 当提供了 参数且不是 时它应该是一个浮点数代表操 作的超时时间以秒为单位可以为小数 当且仅当内部旗标在等待调用之前或者等待开始之后被设为真值时此方法 将返回 也就是说它将总是返回 除非设定了超时且操 作发生了超时 在 版更改 很明显方法总是返回 定时器对象 栅栏对象 在 语句中使用锁 条件和信号量 这个模块提供的带有 和 方法的对象可以被用作 语句的上下文管理器 当进入语句块时 方法会被调用退出语句块时 会被调用 因此以下片段 相当于 现在 和 对象可以用作 语句的上下文管理器 常用路径操作 的实现 新版功能 源代码 概述 函数 关于导入的抽象基类 资源 源码 新版功能 这个模块使得 的导入系统提供了访问包内的资源的功能 如果能够导入一个包那么就能够访问那个包里面的资源 资源可以以二进制或文本模式方式被打开或读取 资源非常类似于目录内部的文件要牢记的是这仅仅是一个比喻 资源和包不是与文件系统上的物理文件和目录一样存在着 注解 加载器想要支持资源读取应该实现一个由 指定的 方法 新版功能 新版功能 新版功能 版后已移除 新版功能 版后已移除 新版功能 在 版更改 新版功能 新版功能 在 版更改 在 版更改 新版功能 版后已移除 新版功能 在 版更改 版后已移除 使用 来代替 在 版更改 在 版更改 新版功能 新版功能 新版功能 版后已移除 新版功能 版后已移除 新版功能 新版功能 新版功能 返回 新版功能 新版功能 新版功能 新版功能 在 版更改 在 版更改 接受一个 类路径对象 新版功能 在 版更改 接受一个 类路径对象 新版功能 新版功能 在 版更改 新版功能 在 版更改 新版功能 在 版更改 在 版更改 版后已移除 在 版更改 版后已移除 版后已移除 新版功能 新版功能 在 版更改 接受一个 类路径对象 新版功能 注解 新版功能 在 版更改 示例 生成伪随机数 簿记功能 初始化随机数生成器 如果 被省略或为 则使用当前系统时间 如果操作系统提供 随机源则使用它们而不是系统时间有关可用性的详细信息请参阅 函数 如果 是 类型则直接使用 对于版本 默认的 或 对象转换为 并使用它的所有位 对于版本 用于从旧版本的 再现随机序列用于 和 的算法生成更窄的种子范围 在 版更改 已移至版本 方案该方案使用字符串种子中的所有位 版后已移除 在将来 必须是下列类型之一 或 返回捕获生成器当前内部状态的对象 这个对象可以传递给 来恢复状态 应该是从之前调用 获得的并且 将 生成器的内部状态恢复到 被调用时的状态 用于字节数据的函数 生成 个随机字节 此方法不可用于生成安全凭据 那应当使用 新版功能 整数用函数 从 返回一个随机选择的元素 这相当于 但实际上并没有构建一个 对象 位置参数模式匹配 不应使用关键字参数因为该函数可能以意 外的方式使用它们 在 版更改 在生成均匀分布的值方面更为复杂 以前 它使用了像 这样的形式它可以产生稍微不均匀的分布 返回随机整数 满足 相当于 返回带有 位随机的 整数 此方法随 生成器一 起提供其他一些生成器也可以将其作为 的可选部分提供 如果可用 启用 来处理任意大范围 在 版更改 此方法现在接受零作为 的值 序列用函数 从非空序列 返回一个随机元素 如果 为空则引发 从 中选择替换返回大小为 的元素列表 如果 为空则引发 如果指定了 序列则根据相对权重进行选择 或者如果给出 序列则根据累积权重可能使用 计算进行选择 例如相对权重 相当于累积权重 在内部相对权重在进行 选择之前会转换为累积权重因此提供累积权重可以节省工作量 如果既未指定 也未指定 则以相等的概率进行选 择 如果提供了权重序列则它必须与 序列的长度相同 一个 指定了 和 或 可使用 所返回的能与 值进行相互运算的任何数字类型包括 但不包括 权重为负值的行为未有定义 如果权重为负值则将引发 对于给定的种子具有相等加权的 函数通常产生与重复调用 不同的序列 使用的算法使用浮点运算来实现内 部一致性和速度 使用的算法默认为重复选择的整数运算以 避免因舍入误差引起的小偏差 新版功能 在 版更改 如果所有权重均为负值则将引发 将序列 随机打乱位置 可选参数 是一个 参数函数在 中返回随机浮点数 默认情况下这是函数 要改变一个不可变的序列并返回一个新的打乱列表请使用 请注意即使对于小的 的排列总数也可以快速增长大于大 多数随机数生成器的周期 这意味着长序列的大多数排列永远不会产生 例如长度为 的序列是可以在 随机数生成器的周期 内拟合的最大序列 可选 形参 返回从总体序列或集合中选择的唯一元素的 长度列表 用于无重复的 随机抽样 返回包含来自总体的元素的新列表同时保持原始总体不变 结果列表按选 择顺序排列因此所有子切片也将是有效的随机样本 这允许抽奖获奖者 样本被划分为大奖和第二名获胜者子切片 总体成员不必是 或 如果总体包含重复则每次出现 都是样本中可能的选择 重复的元素可以一个个地直接列出或使用可选的仅限关键字形参 来指定 例如 等价于 要从一系列整数中选择样本请使用 对象作为参数 对于从大 量人群中采样这种方法特别快速且节省空间 如果样本大小大于总体大小则引发 在 版更改 增加了 形参 版后已移除 在将来 必须是一个序列 的实例 将不再被支持 集合必须先转换为 或 最好是固定顺序以 使抽样是可重现的 实值分布 以下函数生成特定的实值分布 如常用数学实践中所使用的那样 函数参数以分布方程中的相应变量命名大多数这些方程都可以在任何统计学教材中找到 返回 范围内的下一个随机浮点数 返回一个随机浮点数 当 时 当 时 取决于等式 中的浮点舍入终点 可以包括或 不包括在该范围内 返回一个随机浮点数 使得 并在这些边界之间使 用指定的 和 边界默认为零和一 参数默 认为边界之间的中点给出对称分布 分布 参数的条件是 和 返回值的范围介 于 和 之间 指数分布 是 除以所需的平均值它应该是非零的 该参 数本应命名为 但这是 中的保留字 如果 为 正则返回值的范围为 到正无穷大如果 为负则返回值从负 无穷大到 分布 不是 函数 参数的条件是 和 概率分布函数是 高斯分布 是平均值 是标准差 这比下面定义的 函数略快 多线程注意事项当两个线程同时调用此方法时它们有可能将获得相同的 返回值 这可以通过三种办法来避免 让每个线程使用不同的随机数生 成器实例 在所有调用外面加锁 改用速度较慢但是线程安全的 函数 对数正态分布 如果你采用这个分布的自然对数你将得到一个正态分布 平均值为 和标准差为 可以是任何值 必须 大于零 正态分布 是平均值 是标准差 冯 米塞斯 分布 是平均角度以弧度表示介于 和 之间 是浓度参数必须大于或等于零 如果 等 于零则该分布在 到 的范围内减小到均匀的随机角度 帕累托分布 是形状参数 威布尔分布 是比例参数 是形状参数 替代生成器 关于再现性的说明 有时能够重现伪随机数生成器给出的序列是很有用处的 通过重用一个种子值只要没有运行多线程相同的序列就应当可在多次运行中重现 大多数随机模块的算法和种子函数都会在 版本中发生变化但保证两个方面不会改变 如果添加了新的播种方法则将提供向后兼容的播种机 当兼容的播种机被赋予相同的种子时生成器的 方法将继续产生 相同的序列 例子 基本示例 模拟 的示例使用重新采样和替换来估计一个样本的均值的置信区间 使用 重新采样排列测试 来确定统计学显著性或者使用 值 来观察药物与安慰剂的作用之间差异的示例 多服务器队列的到达时间和服务交付模拟 参见 撰写的视频教程使用一些基本 概念进行统计分析包括模拟 抽样 改组和交叉验证 编写的市场模拟显示了该模块提供的 许多工具和分布的有效使用高斯 均匀 样本 变量 选择 三角和随 机范围等 撰写的教程涵盖了概率论基础知识如何编写模拟以及如何使用 进行数据分析 例程 默认的 返回在 范围内 的倍数 所有这些数值间隔相等并能精确表示为 浮点数 但是在此间隔上有许多其他可表示浮点数是不可能的选择 例如 就不是 的整数倍 以下规范程序采取了一种不同的方式 在间隔上的所有浮点数都是可能的选择 它们的尾数取值来自 尾数 范围内整数的均匀分布 指数取值则来自几何分布其中小于 的指数的出现频率为下一个较大指数的一半 该类中所有的 实值分布 都将使用新的方法 该规范程序在概念上等效于在 范围内对所有 的倍数进行选择的算法 所有这样的数字间隔都相等但大多必须向下舍入为最接近的 浮点数表示形式 这个数值是等于 的未经正规化的最小正浮点数 参见 生成伪随机浮点数值 为 所撰写的描述如何生成相比通过 正常生成的数值更细粒度浮点数的论文 异步 是用来编写 并发 代码的库使用 语法 被用作多个提供高性能 异步框架的基础包括网络和网站服务数据库连接库分布式任务队列等等 往往是构建 密集型和高层级 结构化 网络代码的最佳选择 提供一组 高层级 用于 并发地 运行 协程 并对其执行过程实现完全控制 执行 网络 和 控制 子进程 通过 队列 实现分布式任务 同步 并发代码此外还有一些 低层级 以支持 库和框架的开发者 实现 创建和管理 事件循环以提供异步 用于 网络化 运行 子进程处 理 信号 等等 使用 实现高效率协议 通过 语法 桥接 基于回调的库和代码 参考引用 高层级 协程与任务 流 同步原语 子进程 队列集 异常低层级 事件循环 传输和协议 策略 平台支持指南与教程 高层级 索引 低层级 索引 用 开发注解 的源代码可以在 中找到 对象 注解 对象 对象 对象 一个同步的队列类 源代码 模块实现了多生产者 多消费者队列 这特别适用于消息必须安全地在多线程间交换的线程编程 模块中的 类实现了所有所需的锁定语义 模块实现了三种类型的队列它们的区别仅仅是条目取回的顺序 在 队列中先添加的任务先取回 在 队列中最近被添加的条目先取回操作类似一个堆栈 优先级队列中条目将保持排序 使用 模块 并且最小值的条目第一个返回 在内部这三个类型的队列使用锁来临时阻塞竞争线程然而它们并未被设计用于线程的重入性处理 此外模块实现了一个 简单的 队列类型 这个特殊实现为小功能在交换中提供额外的保障 模块定义了下列类和异常 队列构造函数 是个整数用于设 置可以放入队列中的项目数的上限 当达到这个大小的时候插入操作将阻 塞至队列中的项目被消费掉 如果 小于等于零队列尺寸为无限 大 优先级队列构造函数 是个整数用于设置可以放入队列中的项 目数的上限 当达到这个大小的时候插入操作将阻塞至队列中的项目被消 费掉 如果 小于等于零队列尺寸为无限大 最小值先被取出 最小值条目是由 返回的条 目 条目的典型模式是一个以下形式的元组 如果 元素没有可比性数据将被包装在一个类中忽略数据值仅 仅比较优先级数字 无界的 队列构造函数 简单的队列缺少任 务跟踪等高级功能 新版功能 对空的 对象调用非阻塞的 时 引发的异常 对满的 对象调用非阻塞的 时 引发的异常 对象 队列对象 或者 提供下列描述的公共方法 返回队列的大致大小 注意 不保证后续的 不被阻塞 也不保证 不被阻塞 如果队列为空返回 否则返回 如果 返回 不保证后续调用的 不被阻塞 类似的如果 返回 也不保证后续调用的 不被阻塞 如果队列是满的返回 否则返回 如果 返回 不保证后续调用的 不被阻塞 类似的如果 返回 也不保证后续调用的 不被阻塞 将 放入队列 如果可选参数 是 并且 是 默认则在必要时阻塞至有空闲插槽可用 如果 是个 正数将最多阻塞 秒如果在这段时间没有可用的空闲插槽将 引发 异常 反之 是 如果空闲插槽立即可用则 把 放入队列否则引发 异常 在这种情况下 将被忽略 相当于 从队列中移除并返回一个项目 如果可选参数 是 并且 是 默认值则在必要时阻塞至项目可得到 如果 是个正数将最多阻塞 秒如果在这段时间内项目不 能得到将引发 异常 反之 是 如果一个项目 立即可得到则返回一个项目否则引发 异常 这种情况下 将被忽略 系统 之前以及所有版本的 系统中如果 是 并且 是 这个操作将进入基础锁的不间断等待 这意 味着没有异常能发生尤其是 将不会触发 异常 相当于 提供了两个方法用于支持跟踪 排队的任务 是否 被守护的消费者线程 完整的处理 表示前面排队的任务已经被完成 被队列的消费者线程使用 每个 被用于获取一个任务 后续调用 告诉队列该任务的处理 已经完成 如果 当前正在阻塞在所有条目都被处理后将解除阻塞意味着 每个 进队列的条目的 都被收到 如果被调用的次数多于放入队列中的项目数量将引发 异常 阻塞至队列中所有的元素都被接收和处理完毕 当条目添加到队列的时候未完成任务的计数就会增加 每当消费者线程调 用 表示这个条目已经被回收该条目所有工作已经完成未 完成计数就会减少 当未完成计数降到零的时候 阻塞被解除 如何等待排队的任务被完成的示例 对象 对象提供下列描述的公共方法 返回队列的大致大小 注意 不保证后续的 不被阻塞 如果队列为空返回 否则返回 如果 返回 不保证后续调用的 不被阻塞 将 放入队列 此方法永不阻塞始终成功除了潜在的低级错误 例如内存分配失败 可选参数 和 仅仅是为了保持 的兼容性而提供其值被忽略 相当于 仅为保持 兼容性而提供 从队列中移除并返回一个项目 如果可选参数 是 并且 是 默认值则在必要时阻塞至项目可得到 如果 是个正数将最多阻塞 秒如果在这段时间内项目不 能得到将引发 异常 反之 是 如果一个项目 立即可得到则返回一个项目否则引发 异常 这种情况下 将被忽略 相当于 参见 类 一个用于多进程上下文的队列类而不是多线程 是无界队列的一个替代实现具有快速的不需要锁并且 支持索引的原子化 和 操作 内存映射文件支持 新版功能 将字节串解读为打包的二进制数据 源代码 此模块可以执行 值和以 对象表示的 结构之间的转换 这可以被用来处理存储在文件中或是从网络连接等其他来源获取的二进制数据 它使用 格式字符串 作为 结构布局的精简描述以及与 值的双向转换 注解 默认情况下打包给定 结构的结果会包含填充字节以使得所涉及的 类型 保持正确的对齐类似地对齐在解包时也会被纳入考虑 选择此种行为的 目的是使得被打包结构的字节能与相应 结构在内存中的布局完全一致 要 处理平台独立的数据格式或省略隐式的填充字节请使用 大小和 对齐而不是 大小和对齐详情参见 字节顺序大小和对齐方式 某些 的函数以及 的方法接受一个 参数 这将指向实现了 缓冲协议 并提供只读或是可读写缓冲的对象 用于此目的的最常见类型为 和 但许多其他可被视为字节数组的类型也实现了缓冲协议因此它们无需额外从 对象复制即可被读取或填充 函数和异常 格式字符串 格式字符串是用来在打包和解包数据时指定预期布局的机制 它们使用指定被打包解包数据类型的 格式字符 进行构建 此外还有一些特殊字符用来控制字节顺序大小和对齐方式 字节顺序大小和对齐方式 格式字符 示例 注解 所有示例都假定使用一台大端机器的本机字节顺序 大小和对齐方式 打包解包三个整数的基础示例 解包的字段可通过将它们赋值给变量或将结果包装为一个具名元组来命名 格式字符的顺序可能对大小产生影响因为满足对齐要求所需的填充是不同的 以下格式 指定在末尾有两个填充字节假定 类型按 个字节的边界对齐 这仅当本机大小和对齐方式生效时才会起作用标准大小和对齐方式并不会强制进行任何对齐 参见 模块 被打包为二进制存储的同质数据 模块 打包和解包 数据 类 模块还定义了以下类型 返回一个新的 对象它会根据格式字符串 来写入和读取 二进制数据 一次性地创建 对象并调用其方法相比使用同样的格式 调用 函数更为高效因为这样格式字符串只需被编译一次 注解 传递给 和模块层级函数的已编译版最新格式字符串会被缓存 因此只使用少量格式字符串的程序无需担心重用单独的 实例 已编译的 对象支持以下方法和属性 等价于 函数使用了已编译的格式 将等于 等价于 函数使用了已编译的格式 等价于 函数使用了已编译的格式 缓冲区的字节大小必 须等于 等价于 函数使用了已编译的格式 缓冲区的字节大 小从位置 开始必须至少为 等价于 函数使用了已编译的格式 缓冲区的大小必 须为 的整数倍 新版功能 用于构造此 对象的格式字符串 在 版更改 格式字符串类型现在是 而不再是 计算出对应于 的结构大小亦即 方法所产生的字节 串对象的大小 文件处理 源代码 类解析并封装了 的 程序和其他 客户端所使用的 文件格式 的实例或其子类的实例会被用来封装来自 文件的数据 如 果有初始化参数它将指明要解析的文件 如果未给出参数则位于用户家 目录的 文件 即 所确定的文件 将会被读取 在其他情况下则将引发 异常 解析 错误将引发 并附带诊断信息包括文件名 行号以及终 止令牌 如果在 系统上未指明参数则当 文件中有密码 时如果文件归属或权限不安全归属的用户不是运行进程的用户或者可 供任何其他用户读取或写入将引发 这实现了与 和其他使用 的程序同等的安全行为 在 版更改 添加了 权限检查 在 版更改 当未将 作为参数传入时会使用 来查找 文件的位置 当在源文本中遇到语法错误时由 类引发的异常 此异常的实例提 供了三个有用属性 为错误的文本说明 为源文件的名 称而 给出了错误所在的行号 对象 实例具有下列方法 针对 的身份验证者返回一个 元组 如果 文件不包含针对给定主机的条目则返回关联到 条目的元组 如果匹配的主机或默认条目均不可用则返回 将类数据以 文件的格式转储为一个字符串 这会丢弃注释并可能 重排条目顺序 的实例具有一些公共实例变量 将主机名映射到 元组的字典 如果存在 条目则会表示为使用该名称的伪主机 将宏名称映射到字符串列表的字典 注解 密码会被限制为 字符集的一个子集 所有 标点符号均可用作 密码但是要注意空白符和非打印字符不允许用作密码 这是 文件 解析方式带来的限制在未来可能会被解除 颜色选择对话框 源代码 模块提供了 类作为原生颜色选择对话框的接口 实现了一个模式颜色选择对话框窗口 类继承自 类 创建一个颜色选择对话框 调用此方法将显示相应窗口等待用户进行选择 并将选择的颜色 或 返回给调用者 参见 模块 标准对话框模块 源代码 概述 使用 模块 通过敲下 来开始 当你在写一个新脚本时考虑加上这些语句 在 版更改 在 版更改 函数 在 版更改 脚注 底层多线程 高阶文件操作 源代码 模块提供了一系列对文件和文件集合的高阶操作 特别是提供了一些支持文件拷贝和删除的函数 对于单个文件的操作请参阅 模块 警告 即便是高阶文件拷贝函数 也无法拷 贝所有的文件元数据 在 平台上这意味着将丢失文件所有者和组以 及 数据 在 上资源钩子和其他元数据不被使用 这意味着 将丢失这些资源并且文件类型和创建者代码将不正确 在 上将不 会拷贝文件所有者 和替代数据流 目录和文件操作 依赖于具体平台的高效拷贝操作 从 开始所有涉及文件拷贝的函数 以及 将会使用平台专属的 系统调用以便更高效地拷贝文件 参见 意味着拷贝操作将发生于内核之中避免像在 中那样使用用户空间的缓冲区 在 上将会使用 来拷贝文件内容不含元数据 在 上将会使用 在 上 将会使用更大的默认缓冲区 而非 并且会使用基于 的 变种形式 如果快速拷贝操作失败并且没有数据被写入目标文件则 将在内部静默地回退到使用效率较低的 函数 在 版更改 示例 这个示例就是上面所描述的 函数的实现其中省略了文档字符串 它还展示了此模块所提供的许多其他函数 另一个使用 辅助函数的例子 这将会拷贝除 文件和以 打头的文件或目录以外的所有条目 另一个使用 参数来添加记录调用的例子 示例 这个例子演示了如何在 上删除一个目录树其中部分文件设置了只读属性位 它会使用 回调函数来清除只读属性位并再次尝试删除 任何后续的失败都将被传播 归档操作 归档程序示例 在这个示例中我们创建了一个 压缩的 归档文件其中包含用户的 目录下的所有文件 结果归档文件中包含有 使用 的归档程序示例 在这个例子中与 上面的例子 类似我们演示了如何使用 但这次是使用 我们现在具有如下的目录结构 在最终的归档中应当会包括 但不应当包括 因此我们使用以下代码 列出结果归档中的文件我们将会得到 查询输出终端的尺寸 获取终端窗口的尺寸 对于两个维度中的每一个会分别检查环境变量 和 如果定义了这些变量并且其值为正整数则将使用这些值 如果未定义 或 这是通常的情况则连接到 的终端将通过发起调用 被查 询 如果由于系统不支持查询或是由于我们未连接到某个终端而导致查询终端 尺寸不成功则会使用在 形参中给出的值 默认 为 这是许多终端模拟器所使用的默认尺寸 返回的值是一个 类型的具名元组 另请参阅 新版功能 在 版更改 在 版更改 在 版更改 版后已移除 在 版更改 参见 新版功能 新版功能 新版功能 从 存档中导入模块 源代码 此模块添加了从 格式档案中导入 模块 和包的能力 通常不需要明确地使用 模块内置的 机制会自动将此模块用于 档案路径的 项目上 通常 是字符串的目录名称列表 此模块同样允许 的一项成为命名 文件档案的字符串 档案可以容纳子目录结构去支持包的导入并且可以将归档文件中的路径指定为仅从子目录导入 比如说路径 将只会从档案中的 子目录导入 任何文件都可以存在于 档案之中但是只有 和 文件是能够导入的 不允许导入 中的动态模组 请注意如果档案中只包含 文件 不会尝试通过添加对应的 文件修改档案意思是如果 档案不包含 文件导入或许会变慢 在 版更改 以前不支持带有档案注释的 档案 参见 编写的 文件格式文档此格式和使用的算法的创建者 从 压缩包导入模块 由 编写他也提供了实现 遵循 的规范但是使用 编写的使用了 中描述的导入钩的实现 新导入钩 添加导入钩来有助于模块运作 此模块定义了一个异常 异常由 对象引发 这是 的子类因此也可 以捕获为 对象 是用于导入 文件的类 创建新的 实例 必须是指向 文件的路径 或者 文件中的特定路径 例如 的 将在 文件 中的 目录中查找模块 只要它存在 如果 没有指向一个有效的 档案引发 搜索由 指定的模块 必须是完全合格的点分 的模块名 它返回 实例本身如果模块被找到或者返回 如果没找到指定模块 可选的 被忽略这是为了与导入 器协议兼容 返回指定模块的代码对象 如果不能找到模块会引发 错误 返回与 相关联的数据 如果不能找到文件则引发 错误 在 版更改 曾经是 被引发而不是 如果导入了指定的模块 则返回为该模块设置的值 如果未 找到模块则引发 错误 新版功能 返回指定模块的源代码 如果没有找到模块则引发 如果档案包含模块但是没有源代码返回 如果由 指定的模块是一个包则返回 如果不能找到 模块则引发 错误 加载由 指定的模块 必须是完全限定的点分 的模块名 它返回已加载模块或者当找不到模块时引发 错误 导入器关联的 文件的文件名没有可能的子路径 文件中搜索的模块的子路径 这是一个指向 文件根目录的 对象的空字符串 当与斜杠结合使用时 和 属性等价于赋予 构造器的原始 参数 示例 这是一个从 档案中导入模块的例子 请注意 模块不需要明确地使用 堆队列算法 源码 这个模块提供了堆队列算法的实现也称为优先队列算法 堆是一个二叉树它的每个父节点的值都只会小于或大于所有孩子节点的值 它使用了数组来实现从零开始计数对于所有的 都有 和 为了便于比较不存在的元素被认为是无限大 堆最有趣的特性在于最小的元素总是在根结点 这个 与教材的堆算法实现有所不同具体区别有两方面 我们使用了从零开始的索引 这使得节点和其孩子节点索引之间的关系不太直观但更加适合因为 使用从零开始的索引 我们的 方法返回最小的项而不是最大的项这在教材中称为最小堆而最大堆在教材中更为常见因为它更适用于原地排序 基于这两方面把堆看作原生的 也没什么奇怪的 表示最小的元素同时 维护了堆的不变性要创建一个堆可以使用 来初始化为 或者你可以通过一个函数 来把一个 转换成堆 定义了以下函数 将 的值加入 中保持堆的不变性 弹出并返回 的最小的元素保持堆的不变性 如果堆为空抛出 使用 可以只访问最小的元素而不弹出它 将 放入堆中然后弹出并返回 的最小元素 该组合操作比 先调用 再调用 运行起来更有效率 将 转换成堆原地线性时间内 弹出并返回 中最小的一项同时推入新的 堆的大小不变 如果堆为空则引发 这个单步骤操作比 加 更高效并且在使用固定 大小的堆时更为适宜 组合总是会从堆中返回一个元素并将其替 换为 返回的值可能会比添加的 更大 如果不希望如此可考虑改用 它的 组合会返回两个值中较小的一个将较 大的值留在堆中 该模块还提供了三个基于堆的通用功能函数 将多个已排序的输入合并为一个已排序的输出例如合并来自多个日志文 件的带时间戳的条目 返回已排序值的 类似于 但返回一个可迭代对象 不会一次性地将数据全部放入内存并假定每个输入流都是已排序的从小 到大 具有两个可选参数它们都必须指定为关键字参数 指定带有单个参数的 用于从每个输入元素中提取比 较键 默认值为 直接比较元素 为一个布尔值 如果设为 则输入元素将按比较结果逆 序进行合并 要达成与 类似的行为所有可迭代对象必须是已从大到小排序的 在 版更改 添加了可选的 和 形参 从 所定义的数据集中返回前 个最大元素组成的列表 如 果提供了 则其应指定一个单参数的函数用于从 的每个 元素中提取比较键 例如 等价于 从 所定义的数据集中返回前 个最小元素组成的列表 如 果提供了 则其应指定一个单参数的函数用于从 的每个 元素中提取比较键 例如 等价于 后两个函数在 值较小时性能最好 对于更大的值使用 函数会更有效率 此外当 时使用内置的 和 函数会更有效率 如果需要重复使用这些函数请考虑将可迭代对象转为真正的堆 基本示例 优先队列实现说明 优先队列 是堆的常用场合并且它的实现包含了多个挑战 排序稳定性你该如何令相同优先级的两个任务按它们最初被加入时的顺序返 回 如果优先级相同且任务没有默认比较顺序则 对的元组比 较将会中断 如果任务优先级发生改变你该如何将其移至堆中的新位置 或者如果一个挂起的任务需要被删除你该如何找到它并将其移出队列 针对前两项挑战的一种解决方案是将条目保存为包含优先级 条目计数和任务对象 个元素的列表 条目计数可用来打破平局这样具有相同优先级的任务将按它们的添加顺序返回 并且由于没有哪两个条目计数是相同的元组比较将永远不会直接比较两个任务 不可比较任务问题的另一种解决方案是创建一个忽略任务条目并且只比较优先级字段的包装器类 其余的挑战主要包括找到挂起的任务并修改其优先级或将其完全移除 找到一个任务可使用一个指向队列中条目的字典来实现 移除条目或改变其优先级的操作实现起来更为困难因为它会破坏堆结构不变量 因此一种可能的解决方案是将条目标记为已移除再添加一个改变了优先级的新条目 理论 堆是通过数组来实现的其中的元素从 开始计数对于所有的 都有 且 为了便于比较不存在的元素被视为无穷大 堆最有趣的特性在于 总是其中最小的元素 上面的特殊不变量是用来作为一场锦标赛的高效内存表示 下面的数字是 而不是 在上面的树中每个 单元都位于 和 之上 体育运动中我们经常见到二元锦标赛模式每个胜者单元都位于另两个单元之上并且我们可以沿着树形图向下追溯胜者所遇到的所有对手 但是在许多采用这种锦标赛模式的计算机应用程序中我们并不需要追溯胜者的历史 为了获得更高的内存利用效率当一个胜者晋级时我们会用较低层级的另一条目来替代它因此规则变为一个单元和它之下的两个单元包含三个不同条目上方单元胜过了两个下方单元 如果此堆的不变量始终受到保护则序号 显然是最后的赢家 删除它并找出下一个赢家的最简单算法方式是家某个输家让我们假定是上图中的 号单元移至 号位置然后将这个新的 号沿树下行不断进行值的交换直到不变量重新建立 这显然会是树中条目总数的对数 通过迭代所有条目你将得到一个 复杂度的排序 此排序有一个很好的特性就是你可以在排序进行期间高效地插入新条目前提是插入的条目不比你最近取出的 号元素更好 这在模拟上下文时特别有用在这种情况下树保存的是所有传入事件胜出条件是最小调度时间 当一个事件将其他事件排入执行计划时它们的调试时间向未来方向延长这样它们可方便地入堆 因此堆结构很适宜用来实现调度器我的 音序器就是用的这个 用于实现调度器的各种结构都得到了充分的研究堆是非常适宜的一种因为它们的速度相当快并且几乎是恒定的最坏的情况与平均情况没有太大差别 虽然还存在其他总体而言更高效的实现方式但其最坏的情况却可能非常糟糕 堆在大磁盘排序中也非常有用 你应该已经了解大规模排序会有多个运行轮次即预排序的序列其大小通常与 内存容量相关随后这些轮次会进入合并通道轮次合并的组织往往非常巧妙 非常重要的一点是初始排序应产生尽可能长的运行轮次 锦标赛模式是达成此目标的好办法 如果你使用全部有用内存来进行锦标赛替换和安排恰好适合当前运行轮次的条目你将可以对于随机输入生成两倍于内存大小的运行轮次对于模糊排序的输入还会有更好的效果 另外如果你输出磁盘上的第 个条目并获得一个可能不适合当前锦标赛的输入因为其值要胜过上一个输出值它无法被放入堆中因此堆的尺寸将缩小 被释放的内存可以被巧妙地立即重用以逐步构建第二个堆其增长速度与第一个堆的缩减速度正好相同 当第一个堆完全消失时你可以切换新堆并启动新的运行轮次 这样做既聪明又高效总之堆是值得了解的有用内存结构 我在一些应用中用到了它们并且认为保留一个 模块是很有意义的 脚注 当前时代的磁盘平衡算法与其说是巧妙不如说是麻烦这是由磁盘的寻址 能力导致的结果 在无法寻址的设备例如大型磁带机上情况则相当不同 开发者必须非常聪明地极为提前地确保每次磁带转动都尽可能地高效 就是说能够最好地加入到合并进程中 有些磁带甚至能够反向读取 这也被用来避免倒带的耗时 请相信我真正优秀的磁带机排序看起来 是极其壮观的排序从来都是一门伟大的艺术 索引 属性 意义 登录名 定义了以下函数 在 版更改 参见 模块 针对用户组数据库的接口与本模块类似 模块 用 开发 异步编程与传统的顺序编程不同 本页列出常见的错误和陷阱并解释如何避免它们 模式 默认情况下 以生产模式运行 为了简化开发 还有一种 模式 有几种方法可以启用异步调试模式 将 环境变量设置为 使用 开发模式 将 传递给 调用 除了启用调试模式外还要考虑 将 的日志级别设置为 例如下面的代码 片段可以在应用程序启动时运行 配置 模块以显示 警告 一种方法是使用 命令行选项 启用调试模式时 检查 未被等待的协程 并记录他们这将消除被遗忘的等待问题 许多非线程安全的异步 例如 和 方法如果从错误的线程调用则会引发异常 如果执行 操作花费的时间太长则记录 选择器的执行时间 执行时间超过 毫秒的回调将会载入日志 属性 可用于设置以秒为单位的最小执行持续时间 这被视为缓慢 并发性和多线程 运行阻塞的代码 不应该直接调用阻塞 绑定代码 例如如果一个函数执行 秒的 密集型计算那么所有并发异步任务和 操作都将延迟 秒 可以用执行器在不同的线程甚至不同的进程中运行任务以避免使用事件循环阻塞 线程 请参阅 方法了解详情 日志 检测 协同程序 检测就再也没异常 如果调用 但不等待 对象将异常传播到用户代码 在这种情况下当 对象被垃圾收集时 将发出一条日志消息 未处理异常的例子 输出 激活调试模式 以获取任务创建处的跟踪信息 调试模式的输出 随机读写文本行 自动将 代码转为 代码 是一个 程序它可以读取 的源代码并使用一系列的修复器 来将其转换为合法的 代码 标准库已包含了丰富的修复器这足以处理几乎所有代码 不过 的支持库 是一个很灵活通用的库所以还可以编写你自己的 修复器 使用 修复器 支持库 源代码 版后已移除 将切换到 解析器 参见 可能会包含 的 解析器所不能解析的新语法 模块可能会在未来的 版本中被移出标准库 请考虑使用第三方替代例如 或 注解 并不稳定并可能在未来大幅修改 本段落中的剩余文本是该模块的原始文档 在 版更改 在 版更改 协议客户端 对象 对象 在 版更改 新版功能 由服务器返回的状态码 版后已移除 版后已移除 版后已移除 示例 安全哈希与消息摘要 哈希算法 可变长度摘要 和 算法提供安全的 至 或 位可变长度摘要 为此它们的摘要需指定一个长度 算法不限制最大长度 返回当前已传给 方法的数据摘要 这是一个大小为 的字节串对象字节串中可包含 的完整取值范围 类似于 但摘要会以两倍长度字符串对象的形式返回其中仅包 含十六进制数码 这可以被用于在电子邮件或其他非二进制环境中安全地交 换数据值 密钥派生 创建哈希对象 常数 盐值长度构造器所接受的最大长度 个性化字符串长度构造器所接受的最大长度 最大密钥长度 哈希函数可输出的最大摘要长度 示例 开发人员 异常 等待 完成 轮询对象 边缘触发和水平触发的轮询 对象 对象 大多数 系统支持 系统调用为服务器提供了更好的可伸缩性使服务器可以同时服务于大量客户端 的伸缩性更好因为该调用内部仅列出所关注的文件描述符而 会构造一个 在其中将所关注的描述符所对应的 打开然后重新遍历整个 因此 复杂度是 最高文件描述符而 是 文件描述符数量 在轮询对象中注册文件描述符 这样将来调用 方法时将检查文 件描述符是否有未处理的 事件 可以是整数也可以是带有 方法的对象该方法返回一个整数 文件对象已经实现了 因此它们也可以用作参数 是可选的位掩码用于指定要检查的事件类型它可以是常量 和 的组合如下表所述 如果未指定本参 数默认将会检查所有 种类型的事件 常数 意义 有要读取的数据 有紧急数据需要读取 准备输出写不会阻塞 某种错误条件 挂起 流套接字的对侧关闭了连接或关闭了写入到一 半的连接 无效的请求描述符未打开 注册已注册过的文件描述符不会报错且等同于只注册一次该描述符 修改一个已注册的文件描述符等同于 尝试 修改未注册的文件描述符会抛出 异常错误码为 删除轮询对象正在跟踪的某个文件描述符 与 方法类似 可以是整数也可以是带有 方法的对象该方法返回一个 整数 尝试删除从未注册过的文件描述符会抛出 异常 轮询已注册的文件描述符的集合并返回一个列表列表可能为空也可能 有多个 二元组其中包含了要报告事件或错误的描述符 是文件描述符 是一个位掩码表示该描述符所报告的事件 表示可以读取 表示该描述符可以写入依此类推 空列表表示调用超时没有任何文件描述符报告事件 如果指定了 它将指定系统等待事件时等待多长时间后返回以毫秒为单位 如果 为空 负数 或 则本调用将阻塞直到轮询对 象发生事件为止 在 版更改 现在当本函数被信号中断时重试超时将从头开始计时 不会抛出 异常 除非信号处理程序抛出异常相关原 理请参阅 对象 对象 用于区分事件的标识值 其解释取决于筛选器但该值通常是文件描述符 在构造函数中该标识值可以是整数或带有 方法的对象 在内部存储整数 内核筛选器的名称 常数 意义 获取描述符并在有数据可读时返回 获取描述符并在有数据可写时返回 请求 当在 中监视的一个或多个请求事件发生时 返回 监视进程 上的事件 观察网络设备上的事件在 上不可用 每当监视的信号传递到进程时返回 建立一个任意的计时器 筛选器操作 常数 意义 添加或修改事件 从队列中删除事件 返回事件 禁用事件 在第一次发生后删除事件 检索事件后重置状态 内部事件 内部事件 筛选特定 条件 请参阅返回值 筛选特定标志 和 筛选标志 常数 意义 套接字缓冲区的低水线 筛选标志 常数 意义 已调用 发生写入 文件已扩展 属性已更改 链接计数已更改 文件已重命名 对文件的访问权限已被撤销 常数 意义 进程已退出 该进程调用了 进程已执行新进程 内部筛选器标志 内部筛选器标志 跨 执行进程 在 的子进程上返回 无法附加到子对象 筛选器标志在 上不可用 常数 意义 链接已建立 链接已断开 链接状态无效 筛选特定数据 用户自定义值 对 压缩算法的支持 源代码 此模块提供了使用 压缩算法压缩和解压数据的一套完整的接口 模块包含 用于读写压缩文件的 函数和 类 用于增量压缩和解压的 和 类 用于一次性压缩和解压的 和 函数 此模块中的所有类都能安全地从多个线程访问 文件压缩和解压 增量压缩和解压 一次性压缩或解压缩 压缩 此参数为一个 字节类对象 如果给定 它必须为 至 之间的整数 默认值为 对于增量压缩请改用 解压缩 此参数为一个 字节类对象 如果 是多个压缩数据流的拼接则解压缩所有数据流 对于增量解压缩请改用 在 版更改 支持了多数据流的输入 用法示例 以下是 模块典型用法的一些示例 使用 和 来显示往复式的压缩 使用 进行增量压缩 上面的示例使用了十分非随机的数据流即 块数据流 随机数据的压缩率通常很差而有序 重复的数据通常会产生很高的压缩率 用二进制模式写入和读取 压缩文件 语言服务 提供了许多模块来帮助使用 语言 这些模块支持标记化 解析 语法分析 字节码反汇编以及各种其他工具 这些模块包括 访问 解析树 创建 对象 转换 对象 异常和错误处理 对象 示例 的模拟 抽象语法树 抽象文法 节点类 字面值 表达式 中的辅助函数 与 解析树一起使用的常量 与 解析树一起使用的常量 检验 关键字 对 代码使用的标记解析器 对输入进行解析标记 示例 模糊缩进检测 模块浏览器支持 对象 对象 编译 源文件 字节码反汇编器 字节码分析 分析函数 字节码说明 操作码集合 开发者工具集 命令行语法 命令行选项 编程接口 弱引用 弱引用对象 弱引用对象没有 以外的方法和属性 一个弱引用对象如果存在就允许通过调用它来获取引用 如果引用已不存在则调用引用对象将返回 检测一个弱引用对象是否仍然存在应该使用表达式 通常需要使用引用对象的应用代码应当遵循这样的模式 使用单独的存活测试会在多线程应用中制造竞争条件其他线程可能导致某个弱引用在该弱引用被调用前就失效上述的写法在多线程应用和单线程应用中都是安全的 特别版本的 对象可以通过子类化来创建 在 的实现中就使用了这种方式来减少映射中每个条目的内存开销 这对于将附加信息关联到引用的情况最为适用但也可以被用于在调用中插入额外处理来提取引用 这个例子演示了如何将 的一个子类用于存储有关对象的附加信息并在引用被访问时影响其所返回的值 示例 这个简单的例子演示了一个应用如何使用对象 来提取之前出现过的对象 然后对象的 可以在其它数据结构中使用而无须强制对象保持存活但处于存活状态的对象也仍然可以通过 来提取 终结器对象 使用 的主要好处在于它能更简便地注册回调函数而无须保留所返回的终结器对象 例如 终结器也可以被直接调用 但是终结器最多只能对回调函数发起一次调用 你可以使用 方法来注销一个终结器 该方法将销毁终结器并返回其被创建时传给构造器的参数 除非你将 属性设为 否则终结器在程序退出时如果仍然存活就将被调用 例如 比较终结器与 方法 假设我们想创建一个类用它的实例来代表临时目录 当以下事件中的某一个发生时这个目录应当与其内容一起被删除 对象被作为垃圾回收 对象的 方法被调用或 程序退出 我们可以尝试使用 方法来实现这个类如下所示 从 开始 方法不会再阻止循环引用被作为垃圾回收并且模块全局变量在 期间不会被强制设为 因此这段代码在 上应该会正常运行而不会出现任何问题 然而 方法的处理会严重地受到具体实现的影响因为它依赖于解释器垃圾回收实现方式的内部细节 更健壮的替代方式可以是定义一个终结器只引用它所需要的特定函数和对象而不是获取对整个对象状态的访问权 像这样定义后我们的终结器将只接受一个对其完成正确清理目录任务所需细节的引用 如果对象一直未被作为垃圾回收终结器仍会在退出时被调用 基于弱引用的终结器还具有另一项优势就是它们可被用来为定义由第三方控制的类注册终结器例如当一个模块被卸载时运行特定代码 注解 如果当程序退出时你恰好在守护线程中创建终结器对象则有可能该终结器不 会在退出时被调用 但是在一个守护线程中 和 同样不能保证执行清理 文件格式 本章中描述的模块解析各种不是标记语言且与电子邮件无关的杂项文件格式 文件读写 模块内容 变种与格式参数 对象 对象 示例 配置文件解析器 快速起步 支持的数据类型 回退值 受支持的 文件结构 值的插值 映射协议访问 定制解析器行为 旧式 示例 对象 对象 异常 文件处理 对象 编码与解码 数据 对象 对象 异常 生成与解析 文件 示例 通用格式化输出 版后已移除 因为被使用的次数很少此格式化模块已经被弃用了 策略 事件循环策略是各个进程的全局对象 它控制事件循环的管理 每个事件循环都有一个默认策略可以使用策略 更改和定制该策略 策略定义了上下文的概念每个上下文管理一个单独的事件循环 默认策略将 定义为当前线程 通过使用自定义事件循环策略可以自定义 和 函数的行为 策略对象应该实现 抽象基类中定义的 获取和设置策略 可以使用下面函数获取和设置当前进程的策略 返回当前进程域的策略 将 设置为当前进程域策略 如果 设为 将恢复默认策略 策略对象 抽象事件循环策略基类定义如下 异步策略的抽象基类 为当前上下文获取事件循环 返回一个实现 接口的事件循环对象 该方法永远返回 在 版更改 将当前上下文的事件循环设置为 创建并返回一个新的事件循环对象 该方法永远返回 获取子进程监视器对象 返回一个实现 接口的监视器对象 该函数仅支持 将当前子进程监视器设置为 该函数仅支持 附带下列内置策略 默认的 策略 在 上使用 而在 上使用 不需要手动安装默认策略 已配置成自动使用默认策略 在 版更改 在 上现在默认会使用 一个使用 事件循环实现的替代事件循环策略 可用性 使用 事件循环实现的另一种事件循环策略 可用性 进程监视器 进程监视器允许定制事件循环如何监视 子进程 具体来说事件循环需要知道子进程何时退出 在 中子进程由 和 函数创建 定义了 抽象基类子监视器必须要实现它并具有四种不同实现 已配置为默认使用 和 请参阅 子进程和线程 部分 以下两个函数可用于自定义子进程监视器实现它将被 事件循环使用 返回当前策略的当前子监视器 将当前策略的子监视器设置为 必须实现 基类定义的方法 注解 第三方事件循环实现可能不支持自定义子监视器 对于这样的事件循环禁止 使用 或不起作用 注册一个新的子处理回调函数 安排 在进程的 与 相等 时调用 指定另一个同进程的回调函数替换之前的回调处理函数 回调函数 必须是线程安全 删除进程 与 相等的进程的处理函数 处理函数成功删除时返回 没有删除时返回 给一个事件循环绑定监视器 如果监视器之前已绑定另一个事件循环那么在绑定新循环前会先解绑原 来的事件循环 注意循环有可能是 如果监视器已准备好使用则返回 使用 不活动的 当前子监视器生成子进程将引发 新版功能 关闭监视器 必须调用这个方法以确保相关资源会被清理 此实现会为每个生成的子进程启动一具新的等待线程 即使是当 事件循环运行在非主 线程上时它也能可靠地工作 当处理大量子进程时也不存在显著的开销 每个子进程结束时为 但当每个进程启动线程时则需要额外的内存 此监视器会默认被使用 新版功能 此实现会在实例化时注册一个 信号处理程序 这可能会破坏为 信号安装自定义处理程序的第三方代码 此监视器会在收到 信号时通过显式地轮询每个进程来避免干扰其 他代码生成的进程 该监视器一旦被安装就不会限制从不同线程运行子进程 该解决方案是安全的但在处理大量进程时会有显著的开销 每收到一个 时为 新版功能 该实现会使用主线程中的活动事件循环来处理 信号 如果主线 程没有正在运行的事件循环则其他线程无法生成子进程 会引发 此监视器会在收到 信号时通过显式地轮询每个进程来避免干扰其 他代码生成的进程 该解决方案与 同样安全并同样具有 复杂 度但需要主线程有正在运行的事件循环才能工作 这种实现直接调用 来获取所有已结束的进程可能会中 断其它代码洐生进程并等待它们结束 在处理大量子监视器时没有明显的开销 每次子监视器结束 该解决方案需要主线程有正在运行的事件循环才能工作这与 一样 这个实现会轮询处理文件描述符 以等待子进程终结 在某些方面 是一个理想的子进程监视器实现 它不需要使用 信号或线程不会介入任何在事件循环以外发起的进程并能随事件循环发 起的子进程数量进行线性伸缩 其主要缺点在于 是 专属的 并且仅在较近版本的核心 上可用 新版功能 自定义策略 新版功能 注解 脚注 参见 在 版更改 在 版更改 在 版更改 参见 接口选项 新版功能 在 版更改 参见 将模块作为脚本执行 由 撰写并实现 由 撰写并实现 命令行与环境 解析 结果 标准运算符替代函数 将运算符映射到函数 以下表格显示了抽象运算是如何对应于 语法中的运算符和 模块中的函数的 运算 语法 函数 加法 字符串拼接 包含测试 除法 除法 按位与 按位异或 按位取反 按位或 取幂 标识 标识 索引赋值 索引删除 索引取值 左移 取模 乘法 矩阵乘法 取反算术 取反逻辑 正数 右移 切片赋值 切片删除 切片取值 字符串格式化 减法 真值测试 比较 比较 相等 不等 比较 比较 原地运算符 许多运算都有原地版本 以下列出的是提供对原地运算符相比通常语法更底层访问的函数例如 相当于 换一种方式来讲就是 等价于语句块 在这些例子中请注意当调用一个原地方法时运算和赋值是分成两个步骤来执行的 下面列出的原地函数只执行第一步即调用原地方法 第二步赋值则不加处理 对于不可变的目标例如字符串 数字和元组更新的值会被计算但不会被再被赋值给输入变量 对于可变的目标例如列表和字典原地方法将执行更新因此不需要后续赋值操作 等价于 等价于 等价于 其中 和 为序列 等价于 等价于 等价于 等价于 等价于 新版功能 等价于 等价于 等价于 等价于 等价于 等价于 服务器 源代码 参见 对象 新版功能 在 版更改 新版功能 在 版更改 对象 对象 对象 对象 在 版更改 在 版更改 命令 所采取的行动 接受来自客户端的问候语并将其存储在 中 将服务器设 置为基本命令模式 接受来自客户的问候并将其存储在 中 将服务器设置为扩 展命令模式 不采取任何措施 干净地关闭连接 重置 和 但不重置问候语 返回有关命令语法的最少信息 返回代码 服务器不知道该地址是否有效 报告该命令未实现 文本处理服务 本章介绍的模块提供了广泛的字符串操作和其他文本处理服务 在 二进制数据服务 之下描述的 模块也与文本处理高度相关 此外也请参阅 内置字符串类型的文档 文本序列类型 常见的字符串操作 字符串常量 自定义字符串格式化 格式字符串语法 格式规格迷你语言 格式示例 模板字符串 辅助函数 正则表达式操作 正则表达式语法 模块内容 正则表达式对象 正则对象 匹配对象 正则表达式例子 检查对子 模拟 制作一个电话本 文字整理 查找所有副词 查找所有的副词及其位置 原始字符串标记 写一个词法分析器 计算差异的辅助工具 对象 的示例 对象 示例 的命令行接口 文本自动换行与填充 数据库 因特网字符串预备 接口 初始化文件 行缓冲区 历史文件 历史列表 启动钩子 示例 的补全函数 对象 示例 以下是一些如何使用 包来读取 写入和发送简单电子邮件以及更复杂的 邮件的示例 首先让我们看看如何创建和发送简单的文本消息文本内容和地址都可能包含 字符 解析 标题可以通过使用 模块中的类来轻松完成 以下是如何发送包含可能在目录中的一系列家庭照片的 消息示例 以下是如何将目录的全部内容作为电子邮件消息发送的示例 以下是如何将上述 消息解压缩到文件目录中的示例 以下是如何使用备用纯文本版本创建 消息的示例 为了让事情变得更有趣我们在 部分中包含了一个相关的图像我们保存了一份我们要发送的内容到硬盘中然后发送它 如果我们发送最后一个示例中的消息这是我们可以处理它的一种方法 直到输出提示上面的输出是 脚注 感谢 提供最初的灵感和示例 数学统计函数 新版功能 源代码 该模块提供了用于计算数字 数据的数理统计量的函数 此模块并不是诸如 等第三方库或者诸如 等针对专业统计学家的专有全功能统计软件包的竟品 此模块针对图形和科学计算器的水平 除非明确注释这些函数支持 和 当前不支持同其他类型是否在数字塔中的行为 混合类型的集合也是未定义的并且依赖于实现 如果你输入的数据由混合类型组成你应该能够使用 来确保一个一致的结果比如 平均值以及对中心位置的评估 对分散程度的评估 函数细节 异常 只定义了一个异常 的子类表示统计相关的异常 对象 工具可用于创建和操纵 随机变量 的正态分布 这个类将数据度量值的平均值和标准差作为单一实体来处理 正态分布的概念来自于 中央极限定理 并且在统计学中有广泛的应用 返回一个新的 对象其中 代表 算术平均值 而 代表 标准差 若 为负数将会引发 一个只读特征属性表示特定正态分布的 算术平均值 一个只读特征属性表示特定正态分布的 中位数 一个只读特征属性表示特定正态分布的 众数 一个只读特征属性表示特定正态分布的 标准差 一个只读特征属性表示特定正态分布的 方差 等于标准差的平方 传入使用 和 基于 估算出的 和 形参创建一个正态分布实例 可以是任何 并且应当包含能被转换为 类型 的值 如果 不包含至少两个元素则会引发 因为估算中心值至少需要一个点而估算分散度至少 需要两个点 对于给定的平均值和标准差生成 个随机样本 返回一个由 值组成的 当给定 时创建一个新的底层随机数生成器实例 这适用于创 建可重现的结果即使对于多线程上下文也有效 使用 概率密度函数 计算一个随机变量 趋向于给定值 的相对可能性 在数学意义上它是当 趋向于零时比率 的极限 相对可能性的计算方法是用一个狭窄区间内某个样本出现的概率除以区间 的宽度因此使用密度一词 由于可能性是相对于其他点的它的 值可以大于 使用 累积分布函数 计算一个随机变量 小于等于 的概 率 在数学上它表示为 计算反向累积分布函数也称为 分位数函数 或 百分点 函数 在数学 上它表示为 找出随机变量 的值 使得该变量小于等于该值的概率等于给定的 概率 测量两个正态概率分布之间的一致性 返回介于 和 之间的值 给出 两个概率密度函数的重叠区域 将指定正态分布划分为 个相等概率的连续分隔区 返回这些分隔区 对应的 个分隔点的列表 将 设为 以使用四分位默认值 将 设为 以使用十分 位 将 设为 以使用百分位即给出 个分隔点来将正态分布 分隔为 个大小相等的组 计算 标准分 即以高于或低于正态分布的平均值的标准差数值的形式来描 述 新版功能 的实例支持加上 减去 乘以或除以一个常量 这些运算被 用于转换和缩放 例如 不允许一个常量除以 的实例因为结果将不是正态分布 由于正态分布是由独立变量的累加效应产生的因此允许表示为 实例的 两组独立正态分布的随机变量相加和相减 例如 新版功能 示例和用法 适合用来解决经典概率问题 举例来说如果 考试的历史数据 显示分数呈平均值为 且标准差为 的正态分布则可以确定考试分数处于 和 之间的学生的百分比舍入到最接近的整数应为 求 分数的 四分位 和 十分位 为了估算一个不易解析的模型分布 可以生成用于 蒙特卡洛模拟的输入样本 当样本量较大并且成功试验的可能性接近 时正态分布可以被用来模拟 二项分布 例如一次开源会议有 名与会者和两个可分别容纳 人的会议厅 会上有一场关于 的演讲和一场关于 的演讲 在往届会议中 的与会者更愿意去听关于 的演讲 假定人群的偏好没有发生改变那么 演讲的会议厅不超出其容量上限的可能性是多少 在机器学习问题中也经常会出现正态分布 上有一个 朴素贝叶斯分类器的好例子 挑战的问题是根据对多个正态分布的特征测量值包括身高 体重和足部尺码来预测一个人的性别 我们得到了由八个人的测量值组成的训练数据集 假定这些测量值是正态分布的因此我们用 来总结数据 接下来我们遇到一个特征测量值已知但性别未知的新人 从是男是女各 的 先验概率 出发我们通过将该先验概率乘以给定性别的特征度量值的可能性累积值来计算后验概率 最终预测值应为最大后验概率值 这种算法被称为 或 访问 解析树 警告 模块已被弃用并将在未来的 版本中移除 对于大多数用例你 都可以使用 模块来控制抽象语法树 的生成和编译阶段 语言参考 参见 模块 代表解析树内部节点的有用常量 模块 代表解析树叶子节点和测试节点值的函数的有用常量 创建 对象 转换 对象 异常和错误处理 对象 对象具有以下方法 和 相同 和 相同 和 相同 和 相同 和 相同 示例 的模拟 高层级 索引 这个页面列举了所有能用于 的高层级 集 队列集 子进程集 用于生成子进程和运行 命令的工具包 创建一个子进程 运行一个 命令 示例 执行一个 命令 请参阅 子进程 相关文档 流 用于网络 处理的高级 集 建立一个 连接 建立一个 连接 启动 服务 启动一个 服务 接收网络数据的高级 对象 发送网络数据的高级 对象 示例 客户端样例 请参阅 文档 同步 异常 类似 等函数在超时时候被引发 请注意 与内建异常 无关 当一个 对象被取消的时候被引发 请参阅 示例 在取消请求发生的运行代码中如何处理 异常 请参阅完整的 专用异常 列表 上手指南 新版功能 使用 模拟方法调用 使用 的常见场景 模拟函数调用 记录对象上的方法调用你可能需要替换一个对象上的方法用于确认此方法被系统中的其他部分调用过并且调用时使用了正确的参数 使用了 本例中的 之后它有方法和属性可以让你针对它是被如何使用的下断言 注解 在多数示例中 与 两个类可以相互替换而 是一个更适用的类通常情况下使用它就可以了 如果 被调用它的 属性就会变成 更重要的是我们可以使用 或者 方法来确认它在被调用时使用了正确的参数 在如下的测试示例中验证对于 的调用会导致 的调用 对象上的方法调用的 异步迭代器 异步上下文管理器 注解 在查找对象的名称空间中修补对象使用 使用起来很简单阅读 在哪里打补丁 来快速上手 还有一个 用于在一定范围内设置字典中的值并在测试结束时将字典恢复为其原始状态 注解 注解 用户密码数据库 方便的 浏览器控制器 源码 模块提供了一个高级接口允许向用户显示基于 的文档 在大多数情况下只需从该模块调用 函数就可以了 在 下图形浏览器在 下是首选但如果图形浏览器不可用或 显示不可用则将使用文本模式浏览器 如果使用文本模式浏览器则调用进程将阻塞直到用户退出浏览器 如果存在环境变量 则将其解释为 分隔的浏览器列表以便在平台默认值之前尝试 当列表部分的值包含字符串 时它被解释为一个文字浏览器命令行用于替换 的参数 如果该部分不包含 则它只被解释为要启动的浏览器的名称 对于非 平台或者当 上有远程浏览器时控制过程不会等待用户完成浏览器而是允许远程浏览器在显示界面上维护自己的窗口 如果 上没有远程浏览器控制进程将启动一个新的浏览器并等待 脚本 可以用作模块的命令行界面 它接受一个 作为参数 还接受以下可选参数 如果可能在新的浏览器窗口中打开 在新的浏览器页面标签中打开 这些选择当然是相互排斥的 用法示例 定义了以下异常 发生浏览器控件错误时引发异常 定义了以下函数 使用默认浏览器显示 如果 为 则尽可能在同一浏览器窗 口中打开 如果 为 则尽可能打开新的浏览器窗口 如果 为 则尽可能打开新的浏览器页面标签 如果 为 则会尽可能置前窗口请注意在许多窗口管理器下无论此变 量的设置如何都会置前窗口 请注意在某些平台上尝试使用此函数打开文件名可能会起作用并启动 操作系统的关联程序 但是这种方式不被支持也不可移植 使用 参数会引发 如果可能在默认浏览器的新窗口中打开 否则在唯一的浏览器窗 口中打开 如果可能在默认浏览器的新页面标签中打开 否则等效于 返回浏览器类型为 指定的控制器对象 如果 为 则返回适用于调用者环境的默认浏览器的控制器 注册 浏览器类型 注册浏览器类型后 函数可以返回该 浏览器类型的控制器 如果没有提供 或者为 将在没有参数的情况下被调用以在需要时创建实例 如果 提供了 则永远不会调用 并且可能是 将 设置为 使得这个浏览器成为 不带参数调 用的首选结果 否则只有在您计划设置 变量或使用与您声 明的处理程序的名称相匹配的非空参数调用 时此入口点才有用 在 版更改 添加了仅关键字参数 预定义了许多浏览器类型 此表给出了可以传递给 函数的类型名称以及控制器类的相应实例化这些都在此模块中定义 类型名 类名 注释 注释 是 的 桌面环境的文件管理器只有在 运行时 才有意义 一些可靠地检测 的方法会很好仅检查 变量是 不够的 另请注意 的 命令会使用名称 此实现选择运行的 的最佳策略 仅限 平台 仅限 平台 新版功能 添加了对 的支持 以下是一些简单的例子 浏览器控制器对象 浏览器控制器提供三个与模块级便捷函数相同的方法 使用此控制器处理的浏览器显示 如果 为 则尽可能打开 新的浏览器窗口 如果 为 则尽可能打开新的浏览器页面标签 如果可能在此控制器处理的浏览器的新窗口中打开 否则在唯一 的浏览器窗口中打开 别名 如果可能在此控制器处理的浏览器的新页面标签中打开 否 则等效于 脚注 这里命名的不带完整路径的可执行文件将在 环境变量给出的目录中 搜索 内置类型 以下部分描述了解释器中内置的标准类型 主要内置类型有数字 序列 映射 类 实例和异常 有些多项集类是可变的 它们用于添加 移除或重排其成员的方法将原地执行并不返回特定的项绝对不会返回多项集实例自身而是返回 有些操作受多种对象类型的支持特别地实际上所有对象都可以比较是否相等 检测逻辑值以及转换为字符串使用 函数或略有差异的 函数 后一个函数是在对象由 函数输出时被隐式地调用的 逻辑值检测 任何对象都可以进行逻辑值的检测以便在 或 作为条件或是作为下文所述布尔运算的操作数来使用 一个对象在默认情况下均被视为真值除非当该对象被调用时其所属类定义了 方法且返回 或是定义了 方法且返回零 下面基本完整地列出了会被视为假值的内置对象 被定义为假值的常量 和 任何数值类型的零 空的序列和多项集 产生布尔值结果的运算和内置函数总是返回 或 作为假值 或 作为真值除非另行说明 重要例外布尔运算 和 总是返回其中一个操作数 布尔运算 这些属于布尔运算按优先级升序排列 运算 结果 注释 注释 这是个短路运算符因此只有在第一个参数为假值时才会对第二个参数求值 这是个短路运算符因此只有在第一个参数为真值时才会对第二个参数求值 的优先级比非布尔运算符低因此 会被解读为 而 会引发语法错误 比较 数字类型 存在三种不同的数字类型 整数 浮点数 和 复数 此外布尔值属于整数的子类型 整数具有无限的精度 浮点数通常使用 中的 来实现有关你的程序运行所在机器上浮点数的精度和内部表示法可在 中查看 复数包含实部和虚部分别以一个浮点数表示 要从一个复数 中提取这两个部分可使用 和 标准库包含附加的数字类型如表示有理数的 以及以用户定制精度表示浮点数的 数字是由数字字面值或内置函数与运算符的结果来创建的 不带修饰的整数字面值包括十六进制 八进制和二进制数会生成整数 包含小数点或幂运算符的数字字面值会生成浮点数 在数字字面值末尾加上 或 会生成虚数实部为零的复数你可以将其与整数或浮点数相加来得到具有实部和虚部的复数 完全支持混合运算当一个二元算术运算符的操作数有不同数值类型时较窄类型的操作数会拓宽到另一个操作数的类型其中整数比浮点数窄浮点数比复数窄 不同类型的数字之间的比较同比较这些数字的精确值一样 构造函数 和 可以用来构造特定类型的数字 所有数字类型复数除外都支持下列运算有关运算优先级请参阅运算符优先级 运算 结果 注释 完整文档 和 的和 和 的差 和 的乘积 和 的商 和 的商数 的余数 取反 不变 的绝对值或大小 将 转换为整数 将 转换为浮点数 一个带有实部 和虚部 的 复数 默认为 复数 的共轭 的 次幂 的 次幂 注释 也称为整数除法 结果值是一个整数但结果的类型不一定是 运算 结果总是向负无穷的方向舍入 为 为 为 而 为 不可用于复数 而应在适当条件下使用 转换为浮点数 从浮点数转换为整数会被舍入或是像在 语言中一样被截断请参阅 和 函数查看转换的完整定义 也接受字符串 和附带可选前缀 或 的 分别表 示非数字 以及正或负无穷 将 和 定义为 这是编程语言的普遍做 法 接受的数字字面值包括数码 到 或任何等效的 字符具有 特征属性的代码点 请参阅 查看具有 特征属性的代码点的完整列表 所有 类型 和 还包括下列运算 运算 结果 截断为 舍入到 位小数半数值会舍入到偶数 如果省略 则默认为 的最大 的最小 有关更多的数字运算请参阅 和 模块 整数类型的按位运算 按位运算只对整数有意义 计算按位运算的结果就相当于使用无穷多个二进制符号位对二的补码执行操作 二进制按位运算的优先级全都低于数字运算但又高于比较运算一元运算 具有与其他一元算术运算 相同的优先级 此表格是以优先级升序排序的按位运算列表 运算 结果 注释 和 按位 或 和 按位 异或 和 按位 与 左移 位 右移 位 逐位取反 注释 负的移位数是非法的会导致引发 左移 位等价于乘以 右移 位等价于除以 作向下取整除法 使用带有至少一个额外符号扩展位的有限个二进制补码表示有效位宽度为 或以上执行这些计算就足 以获得相当于有无数个符号位时的同样结果 整数类型的附加方法 类型实现了 此外它还提供了其他几个方法 返回以二进制表示一个整数所需要的位数不包括符号位和前面的零 更准确地说如果 非零则 是使得 的唯一正整数 同样地当 小到足以具有 正确的舍入对数时则 如果 为零 则 返回 等价于 新版功能 返回表示一个整数的字节数组 整数会使用 个字节来表示 如果整数不能用给定的字节数来表示 则会引发 参数确定用于表示整数的字节顺序 如果 为 则最高位字节放在字节数组的开头 如果 为 则最高位字节放在字节数组的末尾 要请求主机系统上的原生 字节顺序请使用 作为字节顺序值 参数确定是否使用二的补码来表示整数 如果 为 并且给出的是负整数则会引发 的 默认值为 新版功能 返回由给定字节数组所表示的整数 参数必须为一个 或是生成字节的可迭代对象 参数确定用于表示整数的字节顺序 如果 为 则最高位字节放在字节数组的开头 如果 为 则最高位字节放在字节数组的末尾 要请求主机系统上的原生 字节顺序请使用 作为字节顺序值 参数指明是否使用二的补码来表示整数 新版功能 返回一对整数其比率正好等于原整数并且分母为正数 整数的比率总是用 这个整数本身作为分子 作为分母 新版功能 浮点类型的附加方法 类型实现了 还具有以下附加方法 返回一对整数其比率正好等于原浮点数并且分母为正数 无穷大会引发 而 则会引发 如果 实例可用有限位整数表示则返回 否则返回 两个方法均支持与十六进制数字符串之间的转换 由于 浮点数在内部存储为二进制数因此浮点数与 十进制数 字符串之间的转换往往会导致微小的舍入错误 而十六进制数字符串却允许精确地表示和描述浮点数 这在进行调试和数值工作时非常有用 以十六进制字符串的形式返回一个浮点数表示 对于有限浮点数这种表示 法将总是包含前导的 和尾随的 加指数 返回以十六进制字符串 表示的浮点数的类方法 字符串 可以带有 前导和尾随的空格 请注意 是实例方法而 是类方法 十六进制字符串采用的形式为 可选的 可以是 或 和 是十六进制数码组成的字符串 是带有可选前导符的十进制整数 大小写没有影响在 或 中必须至少有一个十六进制数码 此语法类似于 标准的 小节中所描述的语法也是 以上所使用的语法 特别地 的输出可以用作 或 代码中的十六进制浮点数字面值而由 的 格式字符或 的 所生成的十六进制数字符串由为 所接受 请注意 是十进制数而非十六进制数它给出要与系数相乘的 的幂次 例如十六进制数字符串 表示浮点数 即 对 应用反向转换会得到另一个代表相同数值的十六进制数字符串 数字类型的哈希运算 对于可能为不同类型的数字 和 要求 时必定 详情参见 方法的文档 为了便于在各种数字类型 包括 和 上实现并保证效率 对数字类型的哈希运算是基于为任意有理数定义统一的数学函数因此该运算对 和 的全部实例以及 和 的全部有限实例均可用 从本质上说此函数是通过以一个固定质数 进行 降模给出的 的值在 中可以 的 属性的形式被访问 目前所用的质数设定在 为 位的机器上 而在 为 位的机器上 详细规则如下所述 如果 是一个非负的有理数且 不可被 整除则定义 为 其中 是对 模 取反 如果 是一个非负的有理数且 可被 整除但 不能 则 不能对 降模以上规则不适用在此情况下则定义 为常数值 如果 是一个负的有理数则定义 为 如果结果哈希值为 则将其替换为 特定值 和 被用作正无穷 负无穷和空值所分别对应的哈希值 所有可哈希的空值都具有相同的哈希值 对于一个 值 会通过计算 将实部和虚部的哈希值结合起来并 进行降模 以使其处于 范围之内 同样地如果结果为 则将其替换为 为了阐明上述规则这里有一些等价于内置哈希算法的 代码示例可用于计算有理数 或 的哈希值 迭代器类型 支持在容器中进行迭代的概念 这是通过使用两个单独方法来实现的它们被用于允许用户自定义类对迭代的支持 将在下文中详细描述的序列总是支持迭代方法 容器对象要提供迭代支持必须定义一个方法 返回一个迭代器对象 该对象需要支持下文所述的迭代器协议 如果容器 支持不同的迭代类型则可以提供额外的方法来专门地请求不同迭代类型的 迭代器 支持多种迭代形式的对象的例子有同时支持广度优先和深度优先 遍历的树结构 此方法对应于 中 对象类型结构体 的 槽位 迭代器对象自身需要支持以下两个方法它们共同组成了 迭代器协议 返回迭代器对象本身 这是同时允许容器和迭代器配合 和 语 句使用所必须的 此方法对应于 中 对象类型结构体 的 槽位 从容器中返回下一项 如果已经没有项可返回则会引发 异常 此方法对应于 中 对象类型结构体的 槽位 定义了几种迭代器对象以支持对一般和特定序列类型 字典和其他更特别的形式进行迭代 除了迭代器协议的实现特定类型的其他性质对迭代操作来说都不重要 一旦迭代器的 方法引发了 它必须一直对后续调用引发同样的异常 不遵循此行为特性的实现将无法正常使用 生成器类型 的 提供了一种实现迭代器协议的便捷方式 如果容器对象 方法被实现为一个生成器它将自动返回一个迭代器对象从技术上说是一个生成器对象该对象提供 和 方法 有关生成器的更多信息可以参阅 表达式的文档 序列类型 有三种基本序列类型 和 对象 为处理 二进制数据 和文本字符串 而特别定制的附加序列类型会在专门的小节中描述 通用序列操作 大多数序列类型包括可变类型和不可变类型都支持下表中的操作 被提供用来更容易地在自定义序列类型上正确地实现这些操作 此表按优先级升序列出了序列操作 在表格中 和 是具有相同类型的序列 和 是整数而 是任何满足 所规定的类型和值限制的任意对象 和 操作具有与比较操作相同的优先级 拼接 和 重复 操作具有与对应数值运算相同的优先级 运算 结果 注释 如果 中的某项等于 则结果 为 否则为 如果 中的某项等于 则结果 为 否则为 与 相拼接 或 相当于 与自身进行 次拼接 的第 项起始为 从 到 的切片 从 到 步长为 的 切片 的长度 的最小项 的最大项 在 中首次出现项的索引号 索引号在 或其后且在 之 前 在 中出现的总次数 相同类型的序列也支持比较 特别地 和 的比较是通过比较对应元素的字典顺序 这意味着想要比较结果相等则每个元素比较结果都必须相等并且两个序列长度必须相同 完整细节请参阅语言参考的 比较运算 部分 注释 虽然 和 操作在通常情况下仅被用于简单的成员检测某些 专门化序列 例如 和 也使用它们进行子序 列检测 小于 的 值会被当作 来处理 生成一个与 同类型的空序 列 请注意序列 中的项并不会被拷贝它们会被多次引用 这一点 经常会令 编程新手感到困扰例如 具体的原因在于 是一个包含了一个空列表的单元素列表所以 结果中的三个元素都是对这一个空列表的引用 修改 中的任何一个元素实际上都是对这一个空列表的修改 你可以用以下方式创 建以不同列表为元素的列表 进一步的解释可以在 条目 如何创建多维列表 中查看 如果 或 为负值则索引顺序是相对于序列 的末尾 索引号会 被替换为 或 但要注意 仍然为 从 到 的切片被定义为所有满足 的索引号 的项组成的序列 如果 或 大于 则使用 如果 被省略或为 则使用 如果 被省略或为 则使用 如果 大于等于 则切片为空 从 到 步长为 的切片被定义为所有满足 的索引号 的项组成的序列 换句话说索引号 为 以此类推当达到 时停止 但一 定不包括 当 为正值时 和 会被减至不大于 当 为负值时 和 会被减至不大于 如果 或 被省略或为 它们会成为终止值 是哪一端的终止值 则取决于 的符号 请注意 不可为零 如果 为 则当作 处理 拼接不可变序列总是会生成新的对象 这意味着通过重复拼接来构建序列的 运行时开销将会基于序列总长度的乘方 想要获得线性的运行时开销你必 须改用下列替代方案之一 如果拼接 对象你可以构建一个列表并在最后使用 或是写入一个 实例并在结束时获取它的值 如果拼接 对象你可以类似地使用 或 或者你也可以使用 对象进行原地拼接 对象是可变的并且具有高效的重分配机制 如果拼接 对象请改为扩展 类 对于其它类型请查看相应的文档 某些序列类型 例如 仅支持遵循特定模式的项序列因此并不支 持序列拼接或重复 当 在 中找不到时 会引发 不是所有实现 都支持传入额外参数 和 这两个参数允许高效地搜索序列的子序 列 传入这两个额外参数大致相当于使用 但是不会复 制任何数据并且返回的索引是相对于序列的开头而非切片的开头 不可变序列类型 不可变序列类型普遍实现而可变序列类型未实现的唯一操作就是对 内置函数的支持 这种支持允许不可变类型例如 实例被用作 键以及存储在 和 实例中 尝试对包含有不可哈希值的不可变序列进行哈希运算将会导致 可变序列类型 列表 列表是可变序列通常用于存放同类项目的集合其中精确的相似程度将根据应用而变化 可以用多种方式构建列表 使用一对方括号来表示空列表 使用方括号其中的项以逗号分隔 使用列表推导式 使用类型的构造器 或 构造器将构造一个列表其中的项与 中的项具有相同的的值与 顺序 可以是序列 支持迭代的容器或其它可迭代对象 如果 已经是一个列表将创建并返回其副本类似于 例如 返回 而 返回 如果没有给出参数构造器将创建一个空列表 其它许多操作也会产生列表包括 内置函数 列表实现了所有 一般 和 可变 序列的操作 列表还额外提供了以下方法 此方法会对列表进行原地排序只使用 来进行各项间比较 异常不 会被屏蔽 如果有任何比较操作失败整个排序操作将失败而列表可 能会处于被部分修改的状态 接受两个仅限以关键字形式传入的参数 仅限关键字参数 指定带有一个参数的函数用于从每个列表元素中提取比较键 例 如 对应于列表中每一项的键会被计算一次然后在 整个排序过程中使用 默认值 表示直接对列表项排序而不计算 一个单独的键值 可以使用 将 风格的 函数转换为 函数 为一个布尔值 如果设为 则每个列表元素将按反向 顺序比较进行排序 当顺序大尺寸序列时此方法会原地修改该序列以保证空间经济性 为提 醒用户此操作是通过间接影响进行的它并不会返回排序后的序列请使 用 显示地请求一个新的已排序列表实例 方法确保是稳定的 如果一个排序确保不会改变比较结果相等 的元素的相对顺序就称其为稳定的 这有利于进行多重排序例如先 按部门 再接薪级排序 有关排序示例和简要排序教程请参阅 排序指南 在一个列表被排序期间尝试改 变甚至进行检测也会造成未定义的影响 的 实现会在排序期 间将列表显示为空如果发现列表在排序期间被改变将会引发 元组 元组是不可变序列通常用于储存异构数据的多项集例如由 内置函数所产生的二元组 元组也被用于需要同构数据的不可变序列的情况例如允许存储到 或 的实例 可以用多种方式构建元组 使用一对圆括号来表示空元组 使用一个后缀的逗号来表示单元组 或 使用以逗号分隔的多个项 使用内置的 或 构造器将构造一个元组其中的项与 中的项具有相同的值与顺 序 可以是序列 支持迭代的容器或其他可迭代对象 如果 已经是一个元组会不加改变地将其返回 例如 返回 而 返回 如果没有给出参数构造器将创建一个空元组 请注意决定生成元组的其实是逗号而不是圆括号 圆括号只是可选的生成 空元组或需要避免语法歧义的情况除外 例如 是在调用函 数时附带三个参数而 则是在调用函数时附带一个三元组 元组实现了所有 一般 序列的操作 对于通过名称访问相比通过索引访问更清晰的异构数据多项集 可能是比简单元组对象更为合适的选择 对象 文本序列类型 字符串的方法 风格的字符串格式化 二进制序列类型 操作二进制数据的核心内置类型是 和 它们由 提供支持该对象使用 缓冲区协议 来访问其他二进制对象所在内存不需要创建对象的副本 模块支持高效地存储基本数据类型例如 位整数和 双精度浮点值 对象 对象是由单个字节构成的不可变序列 由于许多主要二进制协议都基于 文本编码因此 对象提供了一些仅在处理 兼容数据时可用并且在许多特性上与字符串对象紧密相关的方法 首先表示 字面值的语法与字符串字面值的大致相同只是添加了一 个 前缀 单引号 同样允许嵌入 双 引号 双引号 同样允许嵌入 单 引号 三重引号 三重单引号 三重双引号 字面值中只允许 字符无论源代码声明的编码为何 任何 超出 的二进制值必须使用相应的转义序列形式加入 字面值 像字符串字面值一样 字面值也可以使用 前缀来禁用转义序列处 理 请参阅 字符串和字节串字面值 了解有关各种 字面值形式的详 情包括所支持的转义序列 虽然 字面值和表示法是基于 文本的但 对象的行为实 际上更像是不可变的整数序列序列中的每个值的大小被限制为 如果违反此限制将引发 这种限制是有意设计用以强 调以下事实虽然许多二进制格式都包含基于 的元素可以通过某些 面向文本的算法进行有用的操作但情况对于任意二进制数据来说通常却并 非如此盲目地将文本处理算法应用于不兼容 的二进制数据格式往往 将导致数据损坏 除了字面值形式 对象还可以通过其他几种方式来创建 指定长度的以零值填充的 对象 通过由整数组成的可迭代对象 通过缓冲区协议复制现有的二进制数据 另请参阅 内置类型 由于两个十六进制数码精确对应一个字节因此十六进制数是描述二进制数 据的常用格式 相应地 类型具有从此种格式读取数据的附加类方法 此 类方法返回一个解码给定字符串的 对象 字符串必 须由表示每个字节的两个十六进制数码构成其中的 空白符会被 忽略 在 版更改 现在会忽略所有 空白符而不 只是空格符 存在一个反向转换函数可以将 对象转换为对应的十六进制表示 返回一个字符串对象该对象包含实例中每个字节的两个十六进制数字 如果你希望令十六进制数字符串更易读你可以指定单个字符分隔符作为 形参包含于输出中 默认会放在每个字节之间 第二个可选的 形参控制间距 正值会从右开始计算分隔符的位置 负值则是从左开始 新版功能 在 版更改 现在支持可选的 和 形参以在十六进制输出的字节之间插入分隔符 由于 对象是由整数构成的序列类似于元组因此对于一个 对象 将为一个整数而 将为一个长度为 的 对象 这与文本字符串不同索引和切片所产生的将都是一个长度为 的字符串 对象的表示使用字面值格式 因为它通常都要比像 这样的格式更好用 你总是可以使用 将 对象转换为一个由整数构成的列表 注解 针对 用户的说明在 系列中允许 位字符串 所提供的最接近内置二进制数据类型的对象与 字符串进行各 种隐式转换 这是为了实现向下兼容的变通做法以适应 最初只支 持 位文本而 文本是后来才被加入这一事实 在 中 这些隐式转换已被取消 位二进制数据与 文本间的转换必须 显式地进行 与字符串对象的比较结果将总是不相等 对象 和 操作 风格的字节串格式化 内存视图 集合类型 对象是由具有唯一性的 对象所组成的无序多项集 常见的用途包括成员检测 从序列中去除重复项以及数学中的集合类计算例如交集 并集 差集与对称差集等等 关于其他容器对象请参看 与 等内置类以及 模块 与其他多项集一样集合也支持 和 作为一种无序的多项集集合并不记录元素位置或插入顺序 相应地集合不支持索引 切片或其他序列类的操作 目前有两种内置集合类型 和 类型是可变的 其内容可以使用 和 这样的方法来改变 由于是可变类型它没有哈希值且不能被用作字典的键或其他集合的元素 类型是不可变并且为 其内容在被创建后不能再改变因此它可以被用作字典的键或其他集合的元素 除了可以使用 构造器非空的 不是 还可以通过将以逗号分隔的元素列表包含于花括号之内来创建例如 两个类的构造器具有相同的作用方式 返回一个新的 或 对象其元素来自于 集合 的元素必须为 要表示由集合对象构成的集合所有的内层集 合必须为 对象 如果未指定 则将返回一个新的 空集合 集合可用多种方式来创建 使用花括号内以逗号分隔元素的方式 使用集合推导式 使用类型构造器 和 的实例提供以下操作 返回集合 中的元素数量即 的基数 检测 是否为 中的成员 检测 是否非 中的成员 如果集合中没有与 共有的元素则返回 当且仅当两个 集合的交集为空集合时两者为不相交集合 检测是否集合中的每个元素都在 之中 检测集合是否为 的真子集即 检测是否 中的每个元素都在集合之中 检测集合是否为 的真超集即 返回一个新集合其中包含来自原集合以及 指定的所有集合中的 元素 返回一个新集合其中包含原集合以及 指定的所有集合中共有的 元素 返回一个新集合其中包含原集合中在 指定的其他集合中不存在 的元素 返回一个新集合其中的元素或属于原集合或属于 指定的其他 集合但不能同时属于两者 返回原集合的浅拷贝 请注意非运算符版本的 以及 和 方 法会接受任意可迭代对象作为参数 相比之下它们所对应的运算符版本则 要求其参数为集合 这就排除了容易出错的构造形式例如 而推荐可读性更强的 和 均支持集合与集合的比较 两个集合当且仅当每个 集合中的每个元素均包含于另一个集合之内即各为对方的子集时则相等 一个集合当且仅当其为另一个集合的真子集即为后者的子集但两者不相 等时则小于另一个集合 一个集合当且仅当其为另一个集合的真超集即 为后者的超集但两者不相等时则大于另一个集合 的实例与 的实例之间基于它们的成员进行比较 例如 返回 也一样 子集与相等比较并不能推广为完全排序函数 例如任意两个非空且不相交 的集合不相等且互不为对方的子集因此以下 所有 比较均返回 由于集合仅定义了部分排序子集关系因此由集合构成的列表 方法的输出并无定义 集合的元素与字典的键类似必须为 混合了 实例与 的二进制位运算将返回与第一个操作数 相同的类型 例如 将返回 的实例 下表列出了可用于 而不能用于不可变的 实例的操作 更新集合添加来自 中的所有元素 更新集合只保留其中在所有 中也存在的元素 更新集合移除其中也存在于 中的元素 更新集合只保留存在于集合的一方而非共同存在的元素 将元素 添加到集合中 从集合中移除元素 如果 不存在于集合中则会引发 如果元素 存在于集合中则将其移除 从集合中移除并返回任意一个元素 如果集合为空则会引发 从集合中移除所有元素 请注意非运算符版本的 和 方法将接受 任意可迭代对象作为参数 请注意 和 方法的 参数可能是一个 为支持对一个等价的 进行搜索会根据 临时创建一个该类型对象 映射类型 对象会将 值映射到任意对象 映射属于可变对象 目前仅有一种标准映射类型 字典 关于其他容器对象请参看 与 等内置类以及 模块 字典的键 几乎 可以是任何值 非 的值即包含列表 字典或其他可变类型的值此类对象基于值而非对象标识进行比较不可用作键 数字类型用作键时遵循数字比较的一般规则如果两个数值相等 例如 和 则两者可以被用来索引同一字典条目 但是请注意由于计算机对于浮点数存储的只是近似值因此将其用作字典键是不明智的 字典可以通过将以逗号分隔的 键 值 对列表包含于花括号之内来创建例如 或 也可以通过 构造器来创建 返回一个新的字典基于可选的位置参数和可能为空的关键字参数集来初始 化 字典可用多种方式来创建 使用花括号内以逗号分隔 键 值 对的方式 使用字典推导式 使用类型构造器 如果没有给出位置参数将创建一个空字典 如果给出一个位置参数并且其 属于映射对象将创建一个具有与映射对象相同键值对的字典 否则的话 位置参数必须为一个 对象 该可迭代对象中的每一项本身必须 为一个刚好包含两个元素的可迭代对象 每一项中的第一个对象将成为新字 典的一个键第二个对象将成为其对应的值 如果一个键出现一次以上该 键的最后一个值将成为其在新字典中对应的值 如果给出了关键字参数则关键字参数及其值会被加入到基于位置参数创建 的字典 如果要加入的键已存在来自关键字参数的值将替代来自位置参数 的值 作为演示以下示例返回的字典均等于 像第一个例子那样提供关键字参数的方式只能使用有效的 标识符作 为键 其他方式则可使用任何有效的键 这些是字典所支持的操作因而自定义的映射类型也应当支持 返回字典 中使用的所有键的列表 返回字典 中的项数 返回 中以 为键的项 如果映射中不存在 则会引发 如果字典的子类定义了方法 并且 不存在则 操作将调用该方法并附带键 作为参数 随后 将返回或引发 调用所返回或引发的任何对象或异常 没有其他操作或方法会发起调用 如果未定义 则会引发 必须是一 个方法它不能是一个实例变量 上面的例子显示了 实现的部分代码 还有另一 个不同的 方法是由 所使用 的 将 设为 将 从 中移除 如果映射中不存在 则会引发 如果 中存在键 则返回 否则返回 等价于 返回以字典的键为元素的迭代器 这是 的快捷方式 移除字典中的所有元素 返回原字典的浅拷贝 使用来自 的键创建一个新字典并将键值设为 是一个返回新字典的类方法 默认为 所有值都只引用一个单独的实例因此让 成为一个可变对象例 如空列表通常是没有意义的 要获取不同的值请改用 字典推导式 如果 存在于字典中则返回 的值否则返回 如果 未给出则默认为 因而此方法绝不会引发 返回由字典项 键 值 对 组成的一个新视图 参见 视图对象文 档 返回由字典键组成的一个新视图 参见 视图对象文档 如果 存在于字典中则将其移除并返回其值否则返回 如果 未给出且 不存在于字典中则会引发 从字典中移除并返回一个 键 值 对 键值对会按 后进先出 的顺序被返回 适用于对字典进行消耗性的迭代这在集合算法中经常被使 用 如果字典为空调用 将引发 在 版更改 现在会确保采用 顺序 在之前的版本中 会返回一个任意的键值对 返回一个逆序获取字典键的迭代器 这是 的快 捷方式 新版功能 如果字典存在键 返回它的值 如果不存在插入值为 的键 并返回 默认为 使用来自 的键值对更新字典覆盖原有的键 返回 接受另一个字典对象或者一个包含键值对以长度为二的 元组或其他可迭代对象表示的可迭代对象 如果给出了关键字参数 则会以其所指定的键值对更新字典 返回由字典值组成的一个新视图 参见 视图对象文档 两个 视图之间的相等性比较将总是返回 这 在 与其自身比较时也同样适用 合并 和 中的键和值来创建一个新的字典两者必须都是字 典 当 和 有相同键时 的值优先 新版功能 用 的键和值更新字典 可以是 或 的键值对 当 和 有相同键时 的值 优先 新版功能 两个字典的比较当且仅当它们具有相同的 键 值 对时才会相等不考 虑顺序 排序比较 会引发 字典会保留插入时的顺序 请注意对键的更新不会影响顺序 删除并再次 添加的键将被插入到末尾 在 版更改 字典顺序会确保为插入顺序 此行为是自 版开始的 实现细节 字典和字典视图都是可逆的 在 版更改 字典现在是可逆的 参见 可被用来创建一个 的只读视图 字典视图对象 由 和 所返回的对象是 视图对象 该对象提供字典条目的一个动态视图这意味着当字典改变时视图也会相应改变 字典视图可以被迭代以产生与其对应的数据并支持成员检测 返回字典中的条目数 返回字典中的键 值或项以 键 值 为元素的元组表示的迭代器 键和值是按插入时的顺序进行迭代的 这样就允许使用 来创建 值 键 对 另一个创建相同列 表的方式是 在添加或删除字典中的条目期间对视图进行迭代可能引发 或者无法完全迭代所有条目 在 版更改 字典顺序会确保为插入顺序 如果 是对应字典中存在的键 值或项在最后一种情况下 应为一 个 键 值 元组 则返回 返回一个逆序获取字典键 值或项的迭代器 视图将按与插入时相反的顺序 进行迭代 在 版更改 字典视图现在是可逆的 键视图类似于集合因为其条目不重复且可哈希 如果所有值都是可哈希的即 键 值 对也是不重复且可哈希的那么条目视图也会类似于集合 值视图则不被视为类似于集合因其条目通常都是有重复的 对于类似于集合的视图为抽象基类 所定义的全部操作都是有效的例如 或 一个使用字典视图的示例 上下文管理器类型 的 语句支持通过上下文管理器所定义的运行时上下文这一概念 此对象的实现使用了一对专门方法允许用户自定义类来定义运行时上下文在语句体被执行前进入该上下文并在语句执行完毕时退出该上下文 进入运行时上下文并返回此对象或关联到该运行时上下文的其他对象 此方 法的返回值会绑定到使用此上下文管理器的 语句的 子句中的 标识符 一个返回其自身的上下文管理器的例子是 文件对象会从 返回其自身以允许 被用作 语句中的上下 文表达式 一个返回关联对象的上下文管理器的例子是 所 返回的对象 此种管理器会将活动的 上下文设为原始 上 下文的一个副本并返回该副本 这允许对 语句的语句体中的当前 上下文进行更改而不会影响 语句以外的代码 退出运行时上下文并返回一个布尔值旗标来表明所发生的任何异常是否应当 被屏蔽 如果在执行 语句的语句体期间发生了异常则参数会包含 异常的类型 值以及回溯信息 在其他情况下三个参数均为 自此方法返回一个真值将导致 语句屏蔽异常并继续执行紧随在 语句之后的语句 否则异常将在此方法结束执行后继续传播 在此 方法执行期间发生的异常将会取代 语句的语句体中发生的任何异常 传入的异常绝对不应当被显式地重新引发 相反地此方法应当返回一个 假值以表明方法已成功完成并且不希望屏蔽被引发的异常 这允许上下文管 理代码方便地检测 方法是否确实已失败 定义了一些上下文管理器来支持简易的线程同步 文件或其他对象的快速关闭以及更方便地操作活动的十进制算术上下文 除了实现上下文管理协议以外不同类型不会被特殊处理 请参阅 模块查看相关的示例 的 和 装饰器提供了实现这些协议的便捷方式 如果使用 装饰器来装饰一个生成器函数它将返回一个实现了必要的 方法的上下文管理器而不再是由未经装饰的生成器函数所产生的迭代器 请注意 中 对象的类型结构中并没有针对这些方法的专门槽位 想要定义这些方法的扩展类型必须将它们作为普通的 可访问方法来提供 与设置运行时上下文的开销相比单个类字典查找的开销可以忽略不计 注解 参见 泛型 新版功能 其他内置类型 解释器支持一些其他种类的对象 这些对象大都仅支持一两种操作 模块 模块唯一的特殊操作是属性访问 这里 为一个模块而 访问定义在 的符号表中的一个名称 模块属性可以被赋值 请注意 语句严格来说也是对模块对象的一种操作 不要求存在一个名为 的模块对象而是要求存在一个对于名为 的模块的 永久性 定义 每个模块都有一个特殊属性 这是包含模块的符号表的字典 修改此字典将实际改变模块的符号表但是无法直接对 赋值 你可以写 这会将 定义为 但是你不能写 不建议直接修改 内置于解释器中的模块会写成这样 如果是从一个文件加载则会写成 类与类实例 关于这些类型请参阅 对象 值与类型 和 类定义 函数 函数对象是通过函数定义创建的 对函数对象的唯一操作是调用它 实际上存在两种不同的函数对象内置函数和用户自定义函数 两者支持同样的操作调用函数但实现方式不同因此对象类型也不同 更多信息请参阅 函数定义 方法 方法是使用属性表示法来调用的函数 存在两种形式内置方法例如列表的 方法和类实例方法 内置方法由支持它们的类型来描述 如果你通过一个实例来访问方法即定义在类命名空间内的函数你会得到一个特殊对象 绑定方法 或称 实例方法 对象 当被调用时它会将 参数添加到参数列表 绑定方法具有两个特殊的只读属性 操作该方法的对象而 是实现该方法的函数 调用 完全等价于调用 与函数对象类似绑定方法对象也支持获取任意属性 但是由于方法属性实际上保存于下层的函数对象中 因此不允许设置绑定方法的方法属性 尝试设置方法的属性将会导致引发 想要设置方法属性你必须在下层的函数对象中显式地对其进行设置 更多信息请参阅 标准类型层级结构 代码对象 代码对象被具体实现用来表示伪编译的可执行 代码例如一个函数体 它们不同于函数对象因为它们不包含对其全局执行环境的引用 代码对象由内置的 函数返回并可通过从函数对象的 属性从中提取 另请参阅 模块 可以通过将代码对象而非源码字符串传给 或 内置函数来执行或求值 更多信息请参阅 标准类型层级结构 类型对象 类型对象表示各种对象类型 对象的类型可通过内置函数 来获取 类型没有特殊的操作 标准库模块 定义了所有标准内置类型的名称 类型以这样的写法来表示 空对象 此对象会由不显式地返回值的函数所返回 它不支持任何特殊的操作 空对象只有一种值 这是个内置名称 会生成同一个单例 该对象的写法为 省略符对象 此对象常被用于切片 参见 切片 它不支持任何特殊的操作 省略符对象只有一种值 这是个内置名称 会生成 单例 该对象的写法为 或 未实现对象 此对象会被作为比较和二元运算被应用于它们所不支持的类型时的返回值 请参阅 比较运算 了解更多信息 未实现对象只有一种值 会生成这个单例 该对象的写法为 布尔值 布尔值是两个常量对象 和 它们被用来表示逻辑上的真假不过其他值也可被当作真值或假值 在数字类的上下文中例如被用作算术运算符的参数时它们的行为分别类似于整数 和 内置函数 可被用来将任意值转换为布尔值只要该值可被解析为一个逻辑值参见之前的逻辑值检测 部分 该对象的写法分别为 和 内部对象 有关此对象的信息请参阅 标准类型层级结构 其中描述了栈帧对象 回溯对象以及切片对象等等 特殊属性 语言实现为部分对象类型添加了一些特殊的只读属性它们具有各自的作用 其中一些并不会被 内置函数所列出 一个字典或其他类型的映射对象用于存储对象的可写属性 类实例所属的类 由类对象的基类所组成的元组 类 函数 方法 描述器或生成器实例的名称 类 函数 方法 描述器或生成器实例的 新版功能 此属性是由类组成的元组在方法解析期间会基于它来查找基类 此方法可被一个元类来重载以为其实例定制方法解析顺序 它会在类实例 化时被调用其结果存储于 之中 每个类会保存由对其直接子类的弱引用组成的列表 此方法将返回一个由仍 然存在的所有此类引用组成的列表 例如 脚注 有关这些特殊方法的额外信息可参看 参考指南 基本定制 作为结果列表 与 是相等的元组的情况也类似 它们必须如此因为解析器无法区分这些操作数的类型 区分大小写的字符是指所属一般类别属性为 或 之一的字符 要格式化单独一个元组那么你应当提供一个单例元组其唯一的元素就是 要被格式化的元组 模糊缩进检测 源代码 目前该模块旨在作为脚本调用 但是可以使用下面描述的 函数将其导入 注解 此模块提供的 可能会在将来的版本中更改此类更改可能无法向后兼容 如果 是目录而非符号链接则递归地在名为 的目录树中下行沿途检查所有 文件 如果 是一个 普通 源文件将检查其中的空格相关问题 诊断消息将使用 函数写入到标准输出 此旗标指明是否打印详细消息 如果作为脚本调用则是通过 选项来增 加 此旗标指明是否只打印包含空格相关问题文件的文件名 如果作为脚本调用 则是通过 选项来设为真值 如果检测到模糊缩进则由 引发 在 中捕 获并处理 此函数由 用来处理由 模块所生成的标记 参见 模块 用于 源代码的词法扫描程序 未创建文档的模块 平台特定模块 这些模块用于实现 模块除此之外没有文档 几乎没有必要创建这些文档 在 和 平台上实现 在 上实现 启动并行任务 新版功能 源码 和 模块提供异步执行回调高层接口 异步执行可以由 使用线程或由 使用单独的进程来实现 两者都是实现抽像类 定义的接口 对象 例子 类是 的子类它使用进程池来异步地执行调用 会使用 模块这允许它绕过 全局解释器锁 但也意味着只可以处理和返回可封存的对象 模块必须可以被工作者子进程导入 这意味着 不可以工作在交互式解释器中 从提交给 的回调中调用 或 方法会导致死锁 在 版更改 如果其中一个工作进程被突然终止 就会马上触发 可预计的行为没有定义但执行器上的操作或它的 对象会被冻结或死锁 在 版更改 添加 参数允许用户控制由进程池创建给工作 者进程的开始方法 加入 和 参数 例子 对象 模块函数 类 对象被取消时会触发 对象执行超出给定的超时数值时引发 当执行器被某些原因中断而且不能用来提交或执行新任务时就会被引发派生 于 的异常类 新版功能 当某个操作在一个当前状态所不允许的 上执行时将被引发 新版功能 当 中的其中一个工作者初始化失败时会引发派生于 的异常类 新版功能 当 中的其中一个工作者不完整终止时比如被外部 杀死会引发派生于 原名 的异常类 新版功能 用于 字符的工具 模块提供了一些 字符的名称常量以及在各种 字符类中执行成员检测的函数 所提供的控制字符常量如下 名称 含义 标题开始控制台中断 文本开始 文本结束 传输结束 查询附带 流量控制 确认 蜂鸣器 退格 制表符 的别名 水平制表符 换行 的别名 新行 垂直制表符 换页 回车 开始替换字符集 恢复默认字符集 数据链接转义 用于流程控制 块模式流程控制 用于流程控制 设备控制 否定确认 同步空闲 末端传输块 取消 媒体结束 替换 退出 文件分隔符 组分隔符 块模式终止符 单位分隔符 空格 删除 请注意其中有许多在现今已经没有实际作用 这些助记符是来源于数字计算机之前的电传打印机规范 此模块提供了下列函数对应于标准 库中的函数 检测 字母数字类字符它等价于 或 检测 字母类字符它等价于 检测字符值是否在 位 集范围内 检测 空白字符包括空格或水平制表符 检测 控制字符在 到 或 范围内 检测 十进制数码即 至 它等价于 检测任意 可打印字符不包括空白符 检测 小写字母字符 检测任意 可打印字符包括空白符 检测任意 可打印字符不包括空白符或字母数字类字符 检测 空白字符包括空格换行回车进纸水平制表和垂直制表 检测 大写字母字符 检测 十六进制数码 这等价于 检测 控制字符码位值 至 检测非 字符码位值 及以上 这些函数接受整数或单字符字符串当参数为字符串时会先使用内置函数 进行转换 请注意所有这些函数都是检测根据你传入的字符串的字符所生成的码位值它们实际上完全不会知晓本机的字符编码格式 以下两个函数接受单字符字符串或整数形式的字节值它们会返回相同类型的值 返回对应于 的下个 比特位的 值 返回对应于给定字符的控制字符字符比特值会与 进行按位与运算 返回对应于给定 字符的 比特位字符字符比特值会与 进行 按位或运算 以下函数接受单字符字符串或整数值它会返回一个字符串 返回 字符 的字符串表示形式 如果 是可打印字符则字 符串为字符本身 如果该字符是控制字符 则字符串由一个插 入符 加相应的大写字母组成 如果该字符是 删除符 则字符串为 如果该字符设置了元比特位 元比特 位会被去除应用以上规则后将在结果之前添加 一个 元素的字符串数据其中按从 到 的顺序包含 了三十二个 控制字符的 助记符另加空格符的助记符 系统相关的参数和函数 调试和分析 对 文件进行编码和解码 源代码 版后已移除 此模块以 格式对文件进行编码和解码该格式允许 文件以 格式表示 仅处理数据分支 模块定义了以下功能 将带有文件名 输入 的二进制文件转换为 文件 输出 输出参数 可以是文件名或类文件对象 和 方法的任何对象 解码 文件输入 输入 可以是支持 和 方法 的文件名或类文件对象 生成的文件将写入名为 的文件除非参 数为 在这种情况下从 文件中读取输出文件名 还定义了以下异常 当无法使用 格式编码某些内容时例如文件名太长而无法放入文件 名字段中或者输入未正确编码的 数据时会引发异常 参见 模块 支持模块包含 到二进制和二进制到 转换 注释 还有一个替代的 功能更强大的编码器和解码器接口详细信息请参见源代码 如果您在非 平台上编码或解码文本文件它们仍将使用旧的 换行符约定回车符作为行尾 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 源代码 对象用来链接 底层回调式代码 和高层异步等待式代码 函数 对象 的面板栈扩展 面板是具有添加深度功能的窗口因此它们可以从上至下堆叠为栈只有显示每个窗口的可见部分会显示出来 面板可以在栈中被添加 上移或下移也可以被移除 函数 模块定义了以下函数 返回面板栈中的底部面板 返回一个面板对象将其与给定的窗口 相关联 请注意你必须显式 地保持所返回的面板对象 如果你不这样做面板对象会被垃圾回收并从面 板栈中被移除 返回面板栈中的顶部面板 在面板栈发生改变后更新虚拟屏幕 这不会调用 因 此你不必自己执行此操作 对象 对象如上面 所返回的对象是带有栈顺序的多个窗口 总是会有一个窗口与确定内容的面板相关联面板方法会负责窗口在面板栈中的深度 对象具有以下方法 返回当前面板之上的面板 返回当前面板之下的面板 将面板推至栈底部 如果面板被隐藏不可见则返回 否则返回 隐藏面板 这不会删除对象它只是让窗口在屏幕上不可见 将面板移至屏幕坐标 将与面板相关联的窗口改为窗口 将面板的用户指向设为 这被用来将任意数据与面板相关联数据可 以是任何 对象 显示面板面板可能已被隐藏 将面板推至栈顶部 返回面板的用户指针 这可以是任何 对象 返回与面板相关联的窗口对象 解释器基类 交互解释器对象 在解释器中编译并运行一段源码 所用参数与 一样 的默认值为 则为 可 能发生以下情况之一 输入不正确 引发了一个异常 或 将通过调用 方法打印语法回 溯信息 返回 输入不完整需要更多输入函数 返回 方法 返回 输入完整 返回了一个代码对象 将通过调用 执行代码该方法也会处理运行时异常 除外 返回 该返回值用于决定使用 还是 来作为下一行的输入提 示符 执行一个代码对象 当发生异常时调用 来显示回溯 除 允许传播以外的所有异常都会被捕获 有关 的说明该异常可能发生于此代码的其他位置 并且并不总能被捕获 调用者应当准备好处理它 显示刚发生的语法错误 这不会显示堆栈回溯因为语法错误并无此种信息 如果给出了 它会被放入异常来替代 解析器所提供的默 认文件名因为它在从一个字符串读取时总是会使用 输出 将由 方法来写入 显示刚发生的异常 我们移除了第一个堆栈条目因为它从属于解释器对象的 实现 输出将由 方法来写入 在 版更改 将显示完整的链式回溯而不只是主回溯 将一个字符串写入到标准错误流 所有派生类都应重载此 方法以提供必要的正确输出处理 交互式控制台对象 跟踪 语句执行 新版功能 编程接口 源代码 解析 属性 索引 值 值如果不存在 方案说明符 网络位置部分 空字符串 分层路径 空字符串 最后路径元素的参数 空字符串 查询组件 空字符串 片段识别 空字符串 用户名 密码 主机名小写 端口号为整数如果存在 结构化解析结果 在 版更改 添加了 解析功能 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 属性 索引 值 值如果不存在 方案说明符 网络位置部分 空字符串 分层路径 空字符串 查询组件 空字符串 片段识别 空字符串 用户名 密码 主机名小写 端口号为整数如果存在 结构化解析结果 在 版更改 在 版更改 注解 在 版更改 属性 索引 值 值如果不存在 空字符串 片段识别 空字符串 结构化解析结果 在 版更改 解析 编码字节 在 版更改 结构化解析结果 新版功能 新版功能 新版功能 新版功能 在 版更改 在 版更改 在 版更改 新版功能 参数 参见 统一资源标识符 统一资源标识符 通用语法 解析电子邮件信息 源代码 使用以下两种方法的其中一种以创建消息对象结构直接创建一个 对象使用字典接口添加消息头并且使用 和其他相关方法添加消息负载或者通过解析一个电子邮件消息的序列化表达来创建消息对象结构 包提供了一个可以理解包含 文档在内的绝大多数电子邮件文档结构的标准语法分析程序 你可以传递给语法分析程序一个字节串 字符串或者文件对象语法分析程序会返回给你对应于该对象结构的根 实例 对于简单的 非 的消息这个根对象的负载很可能就是一个包含了该消息文字内容的字符串 对于 消息调用根对象的 方法会返回 其子项可以通过负载操纵方法来进行访问例如 还有 事实上你可以使用的语法分析程序接口有两种 和增量式的 当你的全部消息内容都在内存当中或者整个消息都保存在文件系统内的一个文件当中的时候 非常有用 当你从可能会为了等待更多输入而阻塞的数据流当中读取消息比如从套接字当中读取电子邮件消息的时候 会更合适 会增量读取并解析消息并且只有在你关闭语法分析程序的时候才会返回根对象 请注意语法分析程序可以进行有限的拓展你当然也可以完全从零开始实现你自己的语法分析程序 将 包中内置的语法分析程序和 类连接起来的所有逻辑代码都包含在 类当中所以如有必要自定义的语法分析程序可以通过实现自定义的对应 方法来创建对应的消息对象树 附加说明 在解析语义的时候请注意 大多数非 类型的消息都会被解析为一个带有字符串负载的消息 对象 这些对象在调用 的时候会返回 调用 的时候会产生一个空列表 所有 类型的消息都会被解析成一个容器消息对象 该对象的负 载是一个子消息对象列表 外层的容器消息在调用 的时候 会返回 在调用 的时候会产生一个子部分列表 大多数内容类型为 例如 和 的消息也会被解析为一个负载是长度为 的列表的容器对 象 在它们身上调用 方法会返回 调用 所产生的单个元素会是一个子消息对象 一些不遵循标准的消息在其内部关于它是否为 类型前后不一 这些消息可能在消息头的 字段中写明为 但 它们的 方法的返回值可能是 如果这种消息被 类解析它们的 属性列表当中会有一个 类的实例 关于更多信息详见 指定域的配置钩子 在 版更改 模块内容 在 版更改 新版功能 新版功能 新版功能 命令行界面 参见 分用户的 目录 语句定义 注解 版后已移除 新版功能 新版功能 在 版更改 参见 在 版更改 新版功能 新版功能 注解 异步 处理器 源码 版后已移除 请使用 替代 注解 该模块仅为提供向后兼容 我们推荐在新代码中使用 该模块提供用于编写异步套接字服务客户端与服务端的基础构件 只有两种方法让单个处理器上的程序同一时间完成不止一件事 多线程编程是最简单和最流行的方法但是还有另一种非常不同的技术它可以让你拥有多线程的几乎所有优点而无需实际使用多线程 它仅仅在你的程序主要受 限制时有用那么 如果你的程序受处理器限制那么先发制人的预定线程可能就是你真正需要的 但是网络服务器很少受处理器限制 如果你的操作系统在其 库中支持 系统调用几乎所有操作系统那么你可以使用它来同时处理多个通信通道在 正在后台时进行其他工作 虽然这种策略看起来很奇怪和复杂特别是起初它在很多方面比多线程编程更容易理解和控制 模块为您解决了许多难题使得构建复杂的高性能网络服务器和客户端的任务变得轻而易举 对于会话应用程序和协议伴侣 模块是非常宝贵的 这两个模块背后的基本思想是创建一个或多个网络 通道 类的实例 和 创建通道会将它们添加到全局映射中如果你不为它提供自己的 映射 则由 函数使用 一旦创建了初始通道调用 函数将激活通道服务该服务将一直持续到最后一个通道包括在异步服务期间已添加到映射中的任何通道关闭 进入一个轮询循环其在循环计数超出或所有打开的通道关闭后终止 所有 参数都是可选的 形参默认为 导致循环仅在所有通道关 闭时终止 形参为适当的 或 调用设置超 时参数以秒为单位 默认值为 秒 形参如果为 则表示 应优先使用 默认为 描述 版后已移除 新版功能 在 版更改 高阶函数和可调用对象上的操作 对象 对象是由 创建的可调用对象 它们具有三个只读属性 一个可调用对象或函数 对 对象的调用将被转发给 并 附带新的参数和关键字 最左边的位置参数将放置在提供给 对象调用的位置参数之前 当调用 对象时将要提供的关键字参数 对象与 对象的类似之处在于它们都是可调用 可弱引用的对象并可拥有属性 但两者也存在一些重要的区别 例如前者不会自动创建 和 属性 而且在类中定义的 对象的行为类似于静态方法并且不会在实例属性查找期间转换为绑定方法 目录 具有两个主要窗口类型分别是命令行窗口和编辑器窗口 用户可以同时打开多个编辑器窗口 对于 和 平台都有各自的主菜单 如下记录的每个菜单标识着与之关联的窗口类型 导出窗口例如使用 编辑在文件中查找 是编辑器窗口的的一个子类型 它们目前有着相同的主菜单但是默认标题和上下文菜单不同 在 上只有一个应用程序菜单 它根据当前选择的窗口动态变化 它具有一个 菜单并且下面描述的某些条目已移动到符合 准则的位置 文件菜单 命令行和编辑器 编辑菜单命令行和编辑器 撤销操作 撤销当前窗口的最近一次操作 最高可以撤回 条操作记录 重做 重做当前窗口最近一次所撤销的操作 剪切 复制选区至系统剪贴板然后删除选区 复制 复制选区至系统剪贴板 粘贴 插入系统剪贴板的内容至当前窗口 剪贴板功能也可用于上下文目录 全选 选择当前窗口的全部内容 查找 打开一个提供多选项的查找窗口 再次查找 重复上次搜索如果结果存在 查找选区 查找当前选中的字符串如果存在在文件中查找 打开文件查找对话框 将结果输出至新的输出窗口 替换 打开 查找并替换 对话框 前往行 提示完成 展开文本 展开键入的前缀以匹配同一窗口中的完整单词重复以获得不同的扩展 显示调用贴士 在函数的右括号后打开一个带有函数参数提示的小窗口 请参阅下面的编 辑和导航部分中的 显示周围括号 突出显示周围的括号 格式菜单仅 编辑器 增加缩进 将选定的行右移缩进宽度默认为 个空格 减少缩进 将选定的行向左移动缩进宽度默认为 个空格 注释 在所选行的前面插入 取消注释 从所选行中删除开头的 或 制表符化 将 前导 空格变成制表符 注意我们建议使用 个空格来缩进 代码 取消制表符化 将 所有 制表符转换为正确的空格数 缩进方式切换 打开一个对话框以在制表符和空格之间切换 缩进宽度调整 打开一个对话框以更改缩进宽度 社区接受的默认值为 个空格 格式段落 在注释块或多行字符串或字符串中的选定行中重新格式化当前以空行分隔 的段落 段落中的所有行的格式都将少于 列其中 默认为 删除尾随空格 通过将 应用于每行包括多行字符串中的行删除行尾非空 白字符之后的尾随空格和其他空白字符 除 窗口外在文件末尾删除多 余的换行符 运行菜单仅 编辑器 运行模块 执行 检查模块 如果没有错误重新启动 以清理环境然后执行模 块 输出显示在 窗口中 请注意输出需要使用 打印 或 写入 执行完成后 将保留焦点并显示提示 此时可以交互地探索执行 的结果 这类似于在命令行执行带有 的文件 运行 定制 与 运行模块 相同但使用自定义设置运行该模块 命令行参数 扩展 就像在命令行上传递一样 该模块可以在命令行管理程序中运 行而无需重新启动 检查模块 检查 编辑器 窗口中当前打开的模块的语法 如果尚未保存该模块则 会提示用户保存或自动保存如在 空闲设置 对话框的 常规 选项 卡中所选择的那样 如果存在语法错误则会在 编辑器 窗口中指示大概 位置 打开或唤醒 窗口 菜单仅 编辑器 查看最近重启 将 窗口滚动到上一次 重启 重启 重新启动 以清理环境 上一条历史记录 循环浏览历史记录中与当前条目匹配的早期命令 下一条历史记录 循环浏览历史记录中与当前条目匹配的后续命令 中断执行 停止正在运行的程序 调试菜单仅 编辑器 跳转到文件行 调试器切换 激活后在 中输入的代码或从编辑器中运行的代码将在调试器下运行 在编辑器中可以使用上下文菜单设置断点 此功能不完整具有实验性 堆栈查看器 在树状目录中显示最后一个异常的堆栈回溯可以访问本地和全局 自动打开堆栈查看器 在未处理的异常上切换自动打开堆栈查看器 选项菜单命令行和编辑器 配置 打开配置对话框并更改以下各项的首选项字体 缩进 键绑定 文本颜色 主题 启动窗口和大小 其他帮助源和扩展名 在 上通过在应用程序 菜单中选择首选项来打开配置对话框 有关详细信息请参阅帮助和首选 项下的 首选项设置 大多数配置选项适用于所有窗口或将来的所有窗口 以下选项仅适用于活动窗口 显示隐藏代码上下文仅 编辑器 显示隐藏行号仅 编辑器 缩放还原高度 菜单命令行和编辑器 列出所有打开的窗口的名称选择一个将其带到前台必要时对其进行去符号化 帮助菜单命令行和编辑器 关于 显示版本版权许可证荣誉等 帮助 显示此 文档详细介绍菜单选项基本编辑和导航以及其他技巧 文档 访问本地 文档如果已安装或启动 浏览器并打开 显示最新的 文档 海龟演示 使用示例 代码和 绘图运行 模块 可以在常规选项卡下的配置 对话框中添加其他帮助源 有关帮助菜单选项的更多信息请参见下面的 帮助源 小节 上下文菜单 编辑和导航 编辑窗口 按键绑定 在本节中 是指 和 上的 键以及 上的 键 向左删除 向右删除 向左删除单词 向右删除单词 方向键和 移动 和 按单词移动 跳转到行首尾 跳转到文档首尾 一些有用的 绑定是从 继承的 行首 行尾 删除行但未将其放入剪贴板 删除下一个字符 自动缩进 完成 提示 代码上下文 窗口 中断执行命令 历史命令 文本颜色 启动和代码执行 命令行语法 如果有参数 启动失败 运行用户代码 中的用户输出 开发 应用程序 在没有子进程的情况下运行 版后已移除 帮助和偏好 帮助源 首选项设置 上的 扩展 检查对象 源代码 模块提供了一些有用的函数帮助获取对象的信息例如模块 类 方法 函数 回溯 帧对象以及代码对象 例如它可以帮助你检查类的内容获取某个方法的源代码取得并格式化某个函数的参数列表或者获取你需要显示的回溯的详细信息 该模块提供了 种主要的功能类型检查 获取源代码 检查类与函数 检查解释器的调用堆栈 类型和成员 函数获取对象的成员例如类或模块 函数名以 开始的函数主要作为 的第 个参数使用 它们也可用于判定某对象是否有如下的特殊属性 类型 属性 描述 模块 文档字符串 文件名内置模块没有文件名 类 文档字符串 类定义时所使用的名称 限定名称 该类型被定义时所在的模块的 名称 方法 文档字符串 该方法定义时所使用的名称 限定名称 实现该方法的函数对象 该方法被绑定的实例若没有 绑定则为 函数 文档字符串 用于定义此函数的名称 限定名称 包含已编译函数的代码对象 回溯 此级别的框架对象 框架 原始编译字节码的字符串 单元变量名称的元组通过包含 作用域引用 字节码中使用的常量元组 创建此代码对象的文件的名称 编码的行号到字节码索引的映 射 定义此代码对象的名称 局部变量名称的元组 局部变量的数量 需要虚拟机堆栈空间 参数名和局部变量的元组 生成器 名称 限定名称 框架 生成器在运行吗 协程 名称 限定名称 框架 文档字符串 此函数或方法的原始名称 限定名称 在 版更改 在 版更改 注解 在 版更改 在 版更改 新版功能 在 版更改 新版功能 新版功能 新版功能 在 版更改 新版功能 在 版更改 在 版更改 在 版更改 新版功能 新版功能 注解 在 版更改 在 版更改 新版功能 在 版更改 在 版更改 名称 意义 新版功能 在 版更改 注解 在 版更改 新版功能 参见 类与函数 版后已移除 在 版更改 在 版更改 在 版更改 注解 例如 版后已移除 注解 新版功能 版后已移除 新版功能 新版功能 在 版更改 注解 在 版更改 在 版更改 在 版更改 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 注解 命令行界面 一个被弃用的 的别名 在 版更改 根据 这个类是 的别名 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 一个简单的示例 索引 域 新版功能 多语种国际化服务 源代码 模块为 模块和应用程序提供国际化 和本地化 服务 它同时支持 消息编目 和更高级的 基于类的 后者可能更适合于 文件 下方描述的接口允许用户使用一种自然语言编写模块和应用程序消息并提供翻译后的消息编目以便在不同的自然语言下运行 同时还给出一些本地化 模块及应用程序的小技巧 基于类的 与 相比 模块的基于类的 提供了更多的灵活性和更强的便利性 这是本地化 应用程序和模块的推荐方法 定义了一个 类该类实现了 格式文件的解析并且具有用于返回字符串的方法 本类的实例也可以将自身作为函数 安装到内建命名空间中 本函数实现了标准的 文件搜索算法 它接受一个 它与 接受的域相同 可选参数 与 中的相同 可选参数 是多条字符串的列 表其中每条字符串都是一种语言代码 在 版更改 代替 被引发 新版功能 新版功能 警告 在 版更改 例如 新版功能 新版功能 警告 致谢 以下人员为创建此模块贡献了代码 反馈 设计建议 早期实现和宝贵的经验 脚注 被取代的模块 本章中描述的模块均已弃用仅保留用于向后兼容 它们已经被其他模块所取代 解析器的命令行选项 背景 术语 位置位置 教程 默认值 参考指南 创建解析器 填充解析器 定义选项 解析参数 清理 示例 获取底层平台的标识数据 源代码 注解 特定平台按字母顺序排列 包括在 小节之中 跨平台 平台 平台 平台 获取 版本信息并将其返回为元组 其中 是一个元组 无法确定的条目会被设为 所有元组条目均为字符串 平台 尝试确定可执行文件默认为 解释器所链接到的 版本 返 回一个字符串元组 当查找失败时其默认值将设为给定的 形参值 请注意此函数对于不同 版本向可执行文件添加符号的方式有深层的关 联可能仅适用于使用 编译出来的可执行文件 文件将按 个字节的分块来读取和扫描 另一种 实现 源代码 模块提供了一种对象表示的产生方式它会对结果字符串的大小进行限制 该方式被用于 调试器也适用于某些其他场景 此模块提供了一个类 一个实例和一个函数 该类提供了格式化服务 适用于实现与内置 相似的方法其中附加 了针对不同对象类型的大小限制以避免生成超长的表示 这是 的一个实例用于提供如下所述的 函数 改变此对 象的属性将会影响 和 调试器所使用的大小限制 这是 的 方法 它会返回与同名内置函数所返回字符串 相似的字符串区别在于附带了对多数类型的大小限制 在大小限制工具以外此模块还提供了一个装饰器用于检测对 的递归调用并改用一个占位符来替换 用于为 方法检测同一线程内部递归调用的装饰器 如果执行 了递归调用则会返回 否则执行正常的 调用 例如 新版功能 对象 实例对象包含一些属性可以用于为不同对象类型的表示提供大小限制还包含一些方法可以格式化特定的对象类型 创建递归表示形式的深度限制 默认为 代表命名对象类型的条目数量限制 对于 的默认值为 对 于 为 对于其他则为 表示整数的最大字符数量 数码会从中间被丢弃 默认值为 表示字符串的字符数量限制 请注意字符源会使用字符串的正常表示形式 如果表示中需要用到转义序列在缩短表示时它们可能会被破坏 默认值 为 此限制用于控制在 对象上没有特定的格式化方法可用的对象类型的 大小 它会以类似 的方式被应用 默认值为 内置 的等价形式它使用实例专属的格式化 供 使用的递归实现 此方法使用 的类型来确定要调用哪 个格式化方法并传入 和 类型专属的方法应当调用 来执行递归格式化在递归调用中使用 作为 的值 特定类型的格式化方法会被实现为基于类型名称来命名的方法 在方法名称 中 会被替换为 对 这些方法的分派会由 来处理 需要对值进行递归格式化的类型 专属方法应当调用 子类化 对象 通过 使用动态分派允许 的子类添加对额外内置对象类型的支持或是修改对已支持类型的处理 这个例子演示了如何添加对文件对象的特殊支持 警告 漏洞 参见 对象 示例 新版功能 新版功能 脚注 解析器的命令行选项 源代码 版后已移除 背景 术语 参数 选项 可选参数 参数 必选选项 位置位置 教程 返回两个值 例如 调用指定函数 参考指南 默认值 考虑一下 参考指南 创建解析器 默认 默认 默认 默认 默认 默认 默认 默认 填充解析器 教程 定义选项 存储此选项的参数默认 将常量值附加到列表 调用指定函数 打印用法消息包括所有选项和文档 默认 默认 默认 教程 示例 示例 示例 示例 示例 示例 解析参数 输入参数的位置 默认 清理 容器的抽象基类 新版功能 该模块曾是 模块的组成部分 源代码 该模块定义了一些 抽象基类它们可用于判断一个具体类是否具有某一特定的接口例如这个类是否可哈希或其是否为映射类 容器抽象基类 与 解析树一起使用的常量 源码 此模块提供表示解析树终端令牌的叶节点的数值的常量 请参阅 发行版中的文件 以获取语言语法上下文中名称的定义 名称映射到的特定数值可能会在 版本之间更改 该模块还提供从数字代码到名称和一些函数的映射 这些函数镜像了 头文件中的定义 将此模块中定义的常量的数值映射回名称字符串的字典允许生成更加人类 可读的解析树表示 对终端标记值返回 对非终端标记值返回 如果 是表示输入结束的标记则返回 标记常量是 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 的权标值 标记生成器不使用以下标记类型值但 模块需要这些标记类型值 标记值用于表示注释 标记值用于表示非终止换行符 标记表示 代码逻辑行的 结束当在多条物理线路上继续执行逻辑代码行时会生成 标记 指示用于将源字节解码为文本的编码的标记值 返 回的第一个标记将始终是一个 标记 在 版更改 补充 和 标记 在 版更改 补充 和 标记 在 版更改 移除 和 标记 和 现在被标记为 标记 在 版更改 新版功能 源代码 配置变量 用法示例 安装路径 其他功能 终端控制功能 模块定义了将 放入 和 模式的函数 因为它需要 模块所以只能在 上运行 模块定义了以下函数 将文件描述符 的模式更改为 如果 被省略则默认为 并传递给 将文件描述符 的模式更改为 如果 被省略则默认 为 并传递给 参见 模块 低级终端控制接口 用法示例 用法示例 版后已移除 在 版更改 用法示例 用法示例 新版功能 在 版更改 新版功能 示例 运行时服务 本章里描述的模块提供了和 解释器及其环境交互相关的广泛服务 以下是综述 系统相关的参数和函数 配置变量 安装路径 其他功能 内建对象 顶层脚本环境 警告类别 默认警告过滤器 暂时禁止警告 测试警告 数据类 模块级装饰器 类和函数 初始化后处理 类变量 仅初始化变量 冻结的实例 继承 默认工厂函数 可变的默认值 异常 为 语句上下文提供的工具 工具 例子和配方 抽象基类 退出处理器 示例 打印或检索堆栈回溯 语句定义 垃圾回收器接口 检查对象 类型和成员 类与函数 命令行界面 指定域的配置钩子 模块内容 命令行界面 内置异常 基类 下列异常主要被用作其他异常的基类 所有内置异常的基类 它不应该被用户自定义类直接继承 这种情况请使用 如果在此类的实例上调用 则会返回实例的参数表 示或者当没有参数时返回空字符串 传给异常构造器的参数元组 某些内置异常 例如 接受特 定数量的参数并赋予此元组中的元素特殊的含义而其他异常通常只接受 一个给出错误信息的单独字符串 此方法将 设为异常的新回溯信息并返回该异常对象 它通常以如 下的形式在异常处理程序中使用 所有内置的非系统退出类异常都派生自此类 所有用户自定义异常也应当派 生自此类 此基类用于派生针对各种算术类错误而引发的内置异常 当与 缓冲区 相关的操作无法执行时将被引发 此基类用于派生当映射或序列所使用的键或索引无效时引发的异常 这可以通过 来直接引发 具体异常 异常 警告 下列异常被用作警告类别请参阅 警告类别 文档了解详情 警告类别的基类 用户代码所产生警告的基类 如果所发出的警告是针对其他 开发者的则以此作为与已弃用特性 相关警告的基类 会被默认警告过滤器忽略在 模块中的情况除外 启用 开发模式 时会显示此警告 对于已过时并预计在未来弃用但目前尚未弃用的特性相关警告的基类 这个类很少被使用因为针对未来可能的弃用发出警告的做法并不常见而 针对当前已有的弃用则推荐使用 会被默认警告过滤器忽略 启用 开发模式 时会显示此警告 与模糊的语法相关的警告的基类 与模糊的运行时行为相关的警告的基类 如果所发出的警告是针对以 所编写应用的最终用户的则以此作为 与已弃用特性相关警告的基类 与在模块导入中可能的错误相关的警告的基类 会被默认警告过滤器忽略 启用 开发模式 时会显示此警告 与 相关的警告的基类 与 和 相关的警告的基类 资源使用相关警告的基类 会被默认警告过滤器忽略 启用 开发模式 时会显示此警告 新版功能 异常层次结构 内置异常的类层级结构如下 模块 源代码 是一个包它收集了多个用于处理超文本传输协议的模块 是一个低层级的 协议客户端对于高层级的 访问 请使用 包含基于 的基本 服务类 包含一些有用来实现通过 进行状态管理的工具 提供了 的持久化 也是一个通过 枚举定义了一些 状态码以及相关联消息的模块 新版功能 的子类它定义了组 状态码原理短语以及用英语书 写的长描述文本 用法 状态码 文件读写 模块内容 变种与格式参数 对象 对象 示例 读取 文件最简单的一个例子 读取其他格式的文件 相应最简单的写入示例是 由于使用 来读取 文件因此默认情况下将使用系统默认编码来解码文件并转换为 请参阅 要使用其他编码来解码文件请使用 的 参数 这同样适用于写入非系统默认编码的内容打开输出文件时指定 参数 注册一个新的变种 的更高级用法 捕获并报告错误 尽管该模块不直接支持解析字符串但仍可如下轻松完成 脚注 如果没有指定 则嵌入引号中的换行符将无法正确解析并 且在写入时使用 换行的平台会有多余的 写入 由于 模块会执行自己的通用换行符处理因此指定 应该总 是安全的 因特网字符串预备 风格的 控制 此模块提供了针对 控制的 调用的接口 有关此类调用的完整描述请参阅 指南页 它仅在当安装时配置了支持 风格的 控制的 版本上可用 此模块中的所有函数均接受一个文件描述符 作为第一个参数 这可以是一个整数形式的文件描述符例如 所返回的对象或是一个 例如 本身 这个模块还定义了与此处所提供的函数一起使用的所有必要的常量这些常量与它们在 中的对应常量同名 请参考你的系统文档了解有关如何使用这些终端控制接口的更多信息 这个模块定义了以下函数 对于文件描述符 返回一个包含 属性的列表形式如下 其中 为一个包含 特殊字符的列表每一项都是长度为 的字符串索引号为 和 的项除外这些字段如有定义则应为整数 对旗标和速度以及 数组中索引的解读必须使用在 模块中定义的符号常量来完 成 根据 列表设置文件描述符 的 属性该列表即 所返回的对象 参数确定何时改变属性 表示立即改变 表示在传输所有队列输出后再改变或 表示在传输所有队列输出并丢失所有队列输入后再改变 在文件描述符 上发送一个中断 为零表示发送时长为 秒的中断 非零值的含义取决于具体系统 进入等待状态直到写入文件描述符 的所有输出都传送完毕 在文件描述符 上丢弃队列数据 选择器指定哪个队列 表示输入队列 表示输出队列或 表 示两个队列同时 在文件描述符 上挂起一战恢复输入或输出 参数可以为 表示挂起输出 表示重启输出 表示挂起输入 或 表示重启输入 参见 模块 针对常用终端控制操作的便捷函数 示例 这个函数可提示输入密码并且关闭回显 请注意其采取的技巧是使用一个单独的 调用和一个 语句来确保旧的 属性无论在何种情况下都会被原样保存 协议客户端 源代码 这个模块定义了以下内容 在 版更改 支持了 语句 在 版更改 在 版更改 新版功能 在 版更改 在 版更改 版后已移除 在 版更改 参见 在 版更改 在 版更改 新版功能 注解 注解 在 版更改 新版功能 垃圾回收器接口 在 版更改 在 版更改 在 版更改 这个模块定义了以下函数 举个例子 参见 模块 的日志记录工具 源代码 此页面仅包含 参考信息 教程信息和更多高级用法的讨论请参阅 基础教程 进阶教程 日志操作手册这个模块为应用与库实现了灵活的事件日志系统的函数与类 使用标准库提提供的 最主要的好处是所有的 模块都可能参与日志输出包括你自己的日志消息和第三方模块的日志消息 这个模块提供许多强大而灵活的功能 如果你对 不太熟悉的话 掌握它最好的方式就是查看它对应的教程详见右侧的链接 该模块定义的基础类和函数都列在下面 记录器暴露了应用程序代码直接使用的接口 处理器将日志记录由记录器创建发送到适当的目标 过滤器提供了更精细的设施用于确定要输出的日志记录 格式器指定最终输出中日志记录的样式 记录器对象 日志级别 日志记录级别的数值在下表中给出 如果你想要定义自己的级别并且需要它们具有相对于预定义级别的特定值那么这些内容可能是你感兴趣的 如果你定义具有相同数值的级别它将覆盖预定义的值 预定义的名称丢失 级别 数值 处理器对象 有以下属性和方法 注意不要直接实例化 这个类用来派生其他更有用的子类 但是子类的 方法需要调用 初始化 实例时需要设置它的级别将过滤列表置为空并 且创建锁通过 来序列化对 的访问 初始化一个线程锁用来序列化对底层的 功能的访问底层的 功能可能不是线程安全的 使用 获取线程锁 使用 来释放线程锁 给处理器设置阈值为 日志级别小于 将被忽略 创建 处理器时日志级别被设置为 所有的消息都会被处理 参见 日志级别 级别列表 在 版更改 形参现在接受像 这样的字符串形式的 级别表达方式也可以使用像 这样的整数常量 将此处理器的 设置为 将指定的过滤器 添加到此处理器 从此处理器中删除指定的过滤器 将此处理器的过滤器应用于记录在要处理记录时返回 依次查 询过滤器直到其中一个返回假值为止 如果它们都不返回假值则将发 出记录 如果返回一个假值则处理器将不会发出记录 确保所有日志记录从缓存输出 此版本不执行任何操作并且应由子类实 现 整理处理器使用的所有资源 此版本不输出但从内部处理器列表中删除 处理器内部处理器在 被调用时关闭 子类应确保从重 写的 方法中调用此方法 经已添加到处理器的过滤器过滤后有条件地发出指定的日志记录 用获 取释放 线程锁包装记录的实际发出行为 调用 期间遇到异常时应从处理器中调用此方法 如果模块级 属性 是 则异常将被静默忽略 这是大多 数情况下日志系统需要的 大多数用户不会关心日志系统中的错误他 们对应用程序错误更感兴趣 但是你可以根据需要将其替换为自定义处 理器 指定的记录是发生异常时正在处理的记录 的默认值是 因为这在开发过程中是比较有用的 如果设置了格式器则用其对记录进行格式化 否则使用模块的默认格式 器 执行实际记录给定日志记录所需的操作 这个版本应由子类实现因此这 里直接引发 异常 有关作为标准随附的处理程序列表请参见 格式器对象 对象 属性 实例是每当有日志被记录时由 自动创建的并且可通过 手动创建例如根据从网络接收的已封存事件创建 包含与被记录的事件相关的所有信息 主要信息是在 和 中传递的它们使用 组合到 一起以创建记录的 字段 参数 用于记录由此 所表示 的事件的日志记录器名 称 请注意此名称将始终为该值即使它可以是由附加到不同祖先 日志记录器的处理程序所发出的 以数字表示的日志记录事件层级如 等 请注意这会转换为 的 两个 属性 为数字 值而 为对应的层级名称 进行日志记录调用的文件的完整路径名 记录调用所在源文件中的行号 事件描述消息可能为带有可变数据占位符的格式字符串 要合并到 参数以获得事件描述的可变数据 包含当前异常信息的异常元组或者如果没有可用异 常信息则为 发起调用日志记录调用的函数或方法名称 一个文本字符串表示当前线程中从堆栈底部直到日志 记录调用的堆栈信息 在将 实例与任何用户提供的参数合并之后返回此实例的 消息 如果用户提供给日志记录调用的消息参数不是字符串则会在其 上调用 以将它转换为字符串 此方法允许将用户定义的类用作 消息类的 方法可以返回要使用的实际格式字符串 在 版更改 通过提供用于创建记录的工厂方法已使得 的 创建更易于配置 该工厂方法可使用 和 来设置在此可查看工厂方法的签名 在创建时可使用此功能将你自己的值注入 你可以使用以下模 式 通过此模式多个工厂方法可以被链接起来并且只要它们不重载彼此的属 性或是在无意中覆盖了上面列出的标准属性就不会发生意外 属性 对象 实例会被用来方便地将上下文信息传入日志记录调用 要获取用法示例请参阅 添加上下文信息到你的日志记录输出 部分 返回一个 的实例该实例的初始化使用了下层的 实例和一个字典类对象 修改传递给日志记录调用的消息和或关键字参数以便插入上下文信息 此实现接受以 形式传给构造器的对象并使用 键名将其 加入 返回值为一个 元组其中传入了 可能经过修改的参数版本 在上述方法之外 还支持 的下列方法 以及 这些方法具有与它们在 中的对应方法相同的签名因此你可以互换使用这两种类型的实例 在 版更改 和 方法已被添加到 这些方法会委托给下层的日志记录器 线程安全 模块的目标是使客户端不必执行任何特殊操作即可确保线程安全 它通过使用线程锁来达成这个目标用一个锁来序列化对模块共享数据的访问并且每个处理程序也会创建一个锁来序列化对其下层 的访问 如果你要使用 模块来实现异步信号处理程序则可能无法在这些处理程序中使用 这是因为 模块中的锁实现并非总是可重入的所以无法从此类信号处理程序发起调用 模块级别函数 模块级属性 与警告模块集成 日历相关函数 数据美化输出 源代码 模块提供了美化打印任意 数据结构的功能这种美化形式可用作对解释器的输入 如果经格式化的结构包含非基本 类型的对象则其美化形式可能无法被加载 包含文件 套接字或类对象以及许多其他不能用 字面值来表示的对象都有可能导致这样的结果 格式化后的形式会在可能的情况下以单行来表示对象并在无法在允许宽度内容纳对象的情况下将其分为多行 如果你需要调整宽度限制则应显式地构造 对象 字典在计算其显示形式前会先根据键来排序 在 版更改 添加了对美化打印 的支持 模块定义了一个类 构造一个 实例 此构造器接受几个关键字形参 使用 关键字可设置输出流流对象使用的唯一方法是文件协议的 方法 如果未指定此关键字则 会选择 每个递归层次的缩进量由 指定默认值为一 其他值可导致输出看起来有些怪异但可使得嵌套结构更易区分 可被打 印的层级数量由 控制如果数据结构的层级被打印得过深其所包 含的下一层级会被替换为 在默认情况下对被格式化对象的层级深 度没有限制 希望的输出宽度可使用 形参来限制默认值为 个字符 如果一个结构无法在限定宽度内被格式化则将做到尽可能接近 如果 为假值默认则长序列的每一项将被格式化为单独的行 如果 为真值则将在 可容纳的的情况下把尽可能多的 项放入每个输出行 如果 为真值默认字典将被格式化 为按键排序否则将按插入顺序显示 在 版更改 增加了 形参 在 版更改 增加了 形参 模块还提供了一些快捷函数 的格式化表示作为字符串返回 和 将作为格式化形参被传入 构 造器 在 版更改 增加了 形参 在 版更改 增加了 形参 打印 的格式化表示并附带一个换行符 如果 为假 值默认字典将按键的插入顺序显示否则将按字典键排序 和 将作为格式化形参被传给 新版功能 在 上打打印 的格式化表示并附带一个换行符 如果 为 则使用 这可以替代 函数 在交互式解释器中使用以查看值你甚至可以执行重新赋值 以在特定作用域中使用 和 将作为格式化形参被传给 构 造器 在 版更改 增加了 形参 在 版更改 增加了 形参 确定 的格式化表示是否可读或是否可被用来通过 重新构建对象的值 此函数对于递归对象总是返回 确定 是否需要递归表示 此外还定义了一个支持函数 返回 的字符串表示并为递归数据结构提供保护 如果 的表示形式公开了一个递归条目该递归引用会被表示为 该表示因而不会进行其它格 式化 对象 的实例具有下列方法 返回 格式化表示 这会将传给 构造器的选项 纳入考虑 在所配置的流上打印 的格式化表示并附加一个换行符 下列方法提供了与同名函数相对应的实现 在实例上使用这些方法效率会更高一些因为不需要创建新的 对象 确定对象的格式化表示是否可读或者是否可使用 重建对象值 请注意此方法对于递归对象将返回 如果设置了 的 形参并且对象深度超出允许范围此方法将返 回 确定对象是否需要递归表示 此方法作为一个钩子提供允许子类修改将对象转换为字符串的方式 默认实现使用 实现的内部方式 返回三个值字符串形式的 已格式化版本指明结果是否可读的 旗标以及指明是否检测到递归的旗标 第一个参数是要表示的对象 第 二个是以对象 为键的字典这些对象是当前表示上下文的一部分 影响 表示的直接和间接容器如果需要呈现一个已经在 中表示的对象则第三个返回值应当为 对 方法的递归调用应当将容器的附加条目添加到此字典中 第三个参数 给出了对递归的请求限制如果没有请求限制则其值将为 此参数应当不加修改地传给递归调用 第四个参数 给出于当前 层级传给递归调用的参数值应当小于当前调用的值 示例 为了演示 函数及其形参的几种用法让我们从 获取关于某个项目的信息 以其基本形式显示了整个对象 结果可以被限制到特定的 更深层的内容将使用省略号 此外还可以设置建议的最大字符 如果一个对象无法被拆分则将超出指定宽度 计算差异的辅助工具 源代码 此模块提供用于比较序列的类和函数 例如它可被用于比较文件并可产生多种格式的不同文件差异信息包括 和上下文以及统一的 数据 有关比较目录和文件另请参阅 模块 这是一个灵活的类可用于比较任何类型的序列对只要序列元素为 对象 其基本算法要早于由 和 于 年代末期发表并以格式塔模式匹配的夸张名称命名的算法并且更加有趣 一些 其思路是找到不包含垃圾元素的最长连续匹配子序列所谓垃圾 元素是指其在某种意义上没有价值例如空白行或空白符 处理垃圾元素 是对 和 算法的一个扩展 然后同样的思路将递归 地应用于匹配序列的左右序列片段 这并不能产生最小编辑序列但确实能 产生在人们看来正确的匹配 耗时 基本 算法在最坏情况下为立方时间而在一 般情况下为平方时间 在最坏情况下为平方时间而在一 般情况下的行为受到序列中有多少相同元素这一因素的微妙影响在最佳情 况下则为线性时间 自动垃圾启发式计算 支持使用启发式计算来自动 将特定序列项视为垃圾 这种启发式计算会统计每个单独项在序列中出现的 次数 如果某一项在第一项之后的重复次数超过序列长度的 并且序 列长度至少有 项该项会被标记为热门并被视为序列匹配中的垃圾 这种启发式计算可以通过在创建 时将 参数 设为 来关闭 新版功能 形参 这个类的作用是比较由文本行组成的序列并产生可供人阅读的差异或增量 信息 统一使用 来完成行序列的比较以及相似 接近匹配行内部字符序列的比较 增量的每一行均以双字母代码打头 双字母代码 意义 行为序列 所独有 行为序列 所独有 行在两序列中相同 行不存在于任一输入序列 以 打头的行尝试将视线引至行以外而不存在于任一输入序列的差异 如果序列包含制表符则这些行可能会令人感到迷惑 这个类可用于创建 表格或包含表格的完整 文件以并排地逐 行显示文本比较行间与行外的更改将突出显示 此表格可以基于完全或上 下文差异模式来生成 这个类的构造函数 初始化 的实例 是一个可选关键字参数指定制表位的间隔默认值为 是一个可选关键字参数指定行文本自动打断并换行的列 位置默认值为 表示不自动换行 和 均是可选关键字参数会传入 被 用来生成并排显示的 差异 请参阅 文档了解参数默认值及其说明 下列是公开的方法 比较 和 字符串列表 并返回一个字符串表 示一个完整 文件其中包含各行差异的表格行间与行外的更改将 突出显示 和 均是可选关键字参数指定来源目标文件的列 标题字符串默认均为空白字符串 和 均是可选关键字参数 当只要显示上下文差 异时就将 设为 否则默认值 为显示完整文 件 默认为 当 为 时 将控制围绕突出显示差异部分的上下文行数 当 为 时 将控制在使用 超链接时突出显示差 异部分之前所显示的行数设为零则会导致 超链接将下一个突出 显示差异部分放在浏览器顶端不添加任何前导上下文 注解 和 会被当作未转义的 来解读当接收不 可信来源的输入时应该适当地进行转义 在 版更改 增加了 关键字参数 文档的默认字符 集从 更改为 比较 和 字符串列表 并返回一个字符串表 示一个包含各行差异的完整 表格行间与行外的更改将突出显示 此方法的参数与 方法的相同 是这个类的命令行前端其中包含一个很好的使 用示例 比较 和 字符串列表返回上下文差异格式的增量信息 一个产 生增量行的 所谓上下文差异是一种只显示有更改的行再加几个上下文行的紧凑形式 更 改被显示为之前之后的样式 上下文行数由 设定默认为三行 默认情况下差异控制行以 表示是通过末尾换行符来 创建的 这样做的好处是从 创建的输入将得到 适用于 的差异信息因为输入和输出都带有末 尾换行符 对于没有末尾换行符的输入应将 参数设为 这样输出内 容将统一不带换行符 上下文差异格式通常带有一个记录文件名和修改时间的标头 这些信息的部 分或全部可以使用字符串 和 来指定 修改时间通常以 格式表示 如果未指定 这些字符串默认为空 请参阅 的命令行接口 获取更详细的示例 返回由最佳近似匹配构成的列表 为一个指定目标近似匹配的序 列通常为字符串 为一个由用于匹配 的序列 构成的列表通常为字符串列表 可选参数 默认为 指定最多返回多少个近似匹配 必须大于 可选参数 默认为 是一个 范围内的浮点数 与 相似度得分未达到该值的候选匹配将被忽略 候选匹配中不超过 个的最佳匹配将以列表形式返回按相似度得分 排序最相似的排在最前面 比较 和 字符串列表返回 形式的增量信息 一个产 生增量行的 可选关键字形参 和 均为过滤函数 或为 此函数接受单个字符串参数如果其为垃圾字符串则返回真值 否则返回假值 默认为 此外还有一个模块层级的函数 它会过滤掉没有可见字符的行除非该行添加了至多一 个井号符 但是下层的 类会动态分析哪些行 的重复频繁到足以形成噪音这通常会比使用此函数的效果更好 此函数接受一个字符长度为 的字符串如果其为垃圾字 符则返回真值否则返回假值 默认为模块层级的函数 它会过滤掉空白字符空格符或制表符但包含换 行符可不是个好主意 是这个函数的命令行前端 返回两个序列中产生增量的那一个 给出一个由 或 产生的 序列提取出来 自文件 或 形参 的行去除行前缀 示例 比较 和 字符串列表返回统一差异格式的增量信息 一个产生 增量行的 所以统一差异是一种只显示有更改的行再加几个上下文行的紧凑形式 更改 被显示为内联的样式而不是分开的之前之后文本块 上下文行数由 设定默认为三行 默认情况下差异控制行 以 或 表示 是通过末尾换 行符来创建的 这样做的好处是从 创建的输入 将得到适用于 的差异信息因为输入和输出都 带有末尾换行符 对于没有末尾换行符的输入应将 参数设为 这样输出内 容将统一不带换行符 上下文差异格式通常带有一个记录文件名和修改时间的标头 这些信息的部 分或全部可以使用字符串 和 来指定 修改时间通常以 格式表示 如果未指定 这些字符串默认为空 请参阅 的命令行接口 获取更详细的示例 使用 比较 和 字节串对象列表产生以 所返 回格式表示的差异行列表也是字节串 必须是可调用对象通 常为 或 允许你比较编码未知或不一致的数据 除 之外的所有输入都必须为字 节串对象而非字符串 作用方式为无损地将所有输入 除 之外 转换 为字符串并调用 的输出会被随即转换回字节串这 样你所得到的增量行将具有与 和 相同的未知不一致编码 新版功能 对于可忽略的行返回 如果 为空行或只包含单个 则 行就是可忽略的否则就是不可忽略的 此函数被用作较旧版本 中 形参的默认值 对于可忽略的字符返回 字符 如果为空格符或制表符则 就是可忽略的否则就是不可忽略的 此函数被用作 中 形参的默认值 参见 模式匹配格式塔方法 和 对于一种类似算法的讨论 此文 于 年 月发表于 对象 的示例 以下示例比较两个字符串并将空格视为垃圾 返回一个 范围内的整数作为两个序列相似性的度量 根据经验 值超过 就意味着两个序列是近似匹配的 如果你只对两个序列相匹配的位置感兴趣则 就很方便 请注意 返回的最后一个元组总是只用于占位的 这也是元组末尾元素匹配的元素数量为 的唯一情况 如果你想要知道如何将第一个序列转成第二个序列可以使用 参见 此模块中的 函数显示了如何基于 构建简单的代码来执行有用的功能 使用 构建小型应用的 简易版本控制方案 对象 请注意 所生成的增量并不保证是 最小 差异 相反最小差异往往是违反直觉的因为它们会同步任何可能的地方有时甚至意外产生相距 页的匹配 将同步点限制为连续匹配保留了一些局部性概念这偶尔会带来产生更长差异的代价 类具有这样的构造器 可选关键字形参 和 均为过滤函数 或为 接受单个字符串作为参数的函数如果其为垃圾字符串则返回 真值 默认值为 意味着没有任何行会被视为垃圾行 接受单个字符长度为 的字符串作为参数的函数如果其 为垃圾字符则返回真值 默认值为 意味着没有任何字符会被视为 垃圾字符 这些垃圾过滤函数可加快查找差异的匹配速度并且不会导致任何差异行或 字符被忽略 请阅读 方法的 形参的描 述了解详情 对象是通过一个单独方法来使用生成增量的 比较两个由行组成的序列并生成增量一个由行组成的序列 每个序列必须包含一个以换行符结尾的单行字符串 这样的序列可以通 过文件类对象的 方法来获取 所生成的增量同样由以换 行符结尾的字符串构成可以通过文件类对象的 方法原 样打印出来 示例 此示例比较两段文本 首先我们设置文本为以换行符结尾的单行字符串构成的序列这样的序列也可以通过文件类对象的 方法来获取 接下来我们实例化一个 对象 请注意在实例化 对象时我们可以传入函数来过滤掉垃圾行和字符 详情参见 构造器说明 最后我们比较两个序列 是一个字符串列表让我们将其美化打印出来 作为单独的多行字符串显示出来则是这样 的命令行接口 这个实例演示了如何使用 来创建一个类似于 的工具 它同样包含在 源码发布包中文件名为 处理原始音频数据 概述 库中包含了几种不同的组件 它包含通常被视为语言核心中的一部分的数据类型例如数字和列表 对于这些类型 语言核心定义了文字的形式并对它们的语义设置了一些约束但没有完全定义语义 另一方面语言核心确实定义了语法属性如操作符的拼写和优先级 这个库也包含了内置函数和异常 不需要 语句就可以在所有 代码中使用的对象 有一些是由语言核心定义的但是许多对于核心语义不是必需的并且仅在这里描述 不过这个库主要是由一系列的模块组成 这些模块集可以不同方式分类 有些模块是用 编写并内置于 解释器中另一些模块则是用 编写并以源码形式导入 有些模块提供专用于 的接口例如打印栈追踪信息有些模块提供专用于特定操作系统的接口例如操作特定的硬件另一些模块则提供针对特定应用领域的接口例如万维网 有些模块在所有更新和移植版本的 中可用另一些模块仅在底层系统支持或要求时可用还有些模块则仅当编译和安装 时选择了特定配置选项时才可用 本手册以 从内到外 的顺序组织首先描述内置函数 数据类型和异常最后是根据相关性进行分组的各种模块 这意味着如果你从头开始阅读本手册并在感到厌烦时跳到下一章你仍能对 库的可用模块和所支持的应用领域有个大致了解 当然你并非 必须如同读小说一样从头读到尾 你也可以先浏览内容目录 在手册开头或在索引 在手册末尾 中查找某个特定函数 模块或条目 最后如果你喜欢随意学习某个主题你可以选择一个随机页码 参见 模块 并读上一两小节 无论你想以怎样的顺序阅读本手册还是建议先从 内置函数 这一章开始因为本手册的其余内容都需要你熟悉其中的基本概念 让我们开始吧 可用性注释 如果出现可用性 注释意味着相应函数通常存在于 系统中 但这并不保证其存在于某个特定的操作系统中 如果没有单独说明所有注明 可用性 的函数都支持基于 核心 构建的 系统 的补全函数 源代码 通过补全有效的 标识符和关键字定义了一个适用于 模块的补全函数 当此模块在具有可用的 模块的 平台被导入 一个 实例将被自动创建并且它的 方法将设置为 的补全器 示例 模块是为了使用 的 交互模式 而设计的 除非 是通过 选项运行 这个模块总是自动地被导入且配置 参见 在没有 的平台 此模块定义的 类仍然可以用于自定义行为 对象 对象具有以下方法 为 返回第 项补全 如果指定的 不包含句点字符 它将根据当前 和保留关键字定义于 模块所定义的名称进行补 全 如果为带有句点的名称执行调用它将尝试尽量求值直到最后一部分为止而 不产生附带影响函数不会被求值但它可以生成对 的调 用并通过 函数来匹配剩余部分 在对表达式求值期间引发的 任何异常都会被捕获 静默处理并返回 抽象基类 接口 模块定义了许多方便从 解释器完成和读取写入历史文件的函数 此模块可以直接使用或通过支持在交互提示符下完成 标识符的 模块使用 使用此模块进行的设置会同时影响解释器的交互提示符以及内置 函数提供的提示符 注解 底层的 库 可能使用 库来实现而不是 在 上 模块会在运行时检测所使用的是哪个库 所用的配置文件与 的不同 如果你要在程序中 载入配置字符串你可以在 中检测文本 来区 分 和 如果你是在 上使用 模拟则位于你的主目录中的初始化文件名 称为 例如 中的以下内容将开启 按键绑定 以及 补全 初始化文件 下列函数与初始化文件和用户配置有关 执行在 参数中提供的初始化行 此函数会调用底层库中的 执行一个 初始化文件 默认文件名为最近所使用的文件名 此 函数会调用底层库中的 行缓冲区 历史文件 下列函数会在历史文件上操作 载入一个 历史文件并将其添加到历史列表 默认文件名为 此函数会调用底层库中的 将历史列表保存为 历史文件覆盖任何现有文件 默认文件名为 此函数会调用底层库中的 将历史列表的最后 项添加到历史文件 默认文件名为 文件必须已存在 此函数会调用底层库中的 此函数仅当 编译包带有支持此功能的库版本 时才会存在 新版功能 设置或返回需要保存到历史文件的行数 函数会 通过调用底层库中的 以使用该值来截取历史文 件 负值意味着不限制历史文件的大小 历史列表 以下函数会在全局历史列表上操作 清除当前历史 此函数会调用底层库的 此 函数仅当 编译包带有支持此功能的库版本时才会存在 返回历史列表的当前项数 此函数不同于 后 者是返回将被写入历史文件的最大行数 返回序号为 的历史条目的当前内容 条目序号从一开始 此函数 会调用底层库中的 从历史列表中移除指定位置上的历史条目 条目位置从零开始 此函数会 调用底层库中的 将指定位置上的历史条目替换为 条目位置从零开始 此函数会调 用底层库中的 将 添加到历史缓冲区相当于是最近输入的一行 此函数会调用底 层库中的 启用或禁用当通过 读取输入时自动调用 参数应为一个布尔值当其为真值时启用自动历史当其为假值 时禁用自动历史 新版功能 启动钩子 设置或移除底层库的 回调所发起调用的函数 如果指 定了 它将被用作新的钩子函数如果省略或为 任何 已安装的函数将被移除 钩子函数将在 打印第一个提示信息之前 不带参数地被调用 设置或移除底层库的 回调所发起调用的函数 如果 指定了 它将被用作新的钩子函数如果省略或为 任 何已安装的函数将被移除 钩子函数将在打印第一个提示信息之后 开始读取输入字符之前不带参数地被调用 此函数仅当 编译包带有支持此功能的库版本时才会存在 以下函数与自定义单词补全函数的实现有关 这通常使用 键进行操作能够提示并自动补全正在输入的单词 默认情况下 设置为由 来补全交互模式解释器的 标识符 如果 模块要配合自定义的补全函数来使用则需要设置不同的单词分隔符 设置或移除补全函数 如果指定了 它将被用作新的补全函数 如果省略或为 任何已安装的补全函数将被移除 补全函数的调 用形式为 其中 为 直至其返回一个非字符串值 它应当返回下一个以 开头的候 选补全内容 已安装的补全函数将由传递给底层库中 的 回调函数来发起调用 字符串来自于底层库中 回调函数的第一个形参 获取补全函数如果没有设置补全函数则返回 获取正在尝试的补全类型 此函数会将底层库中的 变量作为一个整数返回 获取补全域的开始和结束序号 这些序号就是传给底层库中 回调函数的 和 参数 设置或获取补全的单词分隔符 此分隔符确定了要考虑补全的单词的开始和 结束位置补全域 这些函数会访问底层库的 变量 设置或移除补全显示函数 如果指定了 它将被用作新的补全 显示函数如果省略或为 任何已安装的补全显示函数将被移除 此函数会设置或清除底层库的 回 调函数 补全显示函数会在每次需要显示匹配项时以 的形式被 调用 示例 以下示例演示了如何使用 模块的历史读取或写入函数来自动加载和保存用户主目录下名为 的历史文件 以下代码通常应当在交互会话期间从用户的 文件自动执行 此代码实际上会在 运行于 交互模式 时自动运行 参见 以下示例实现了同样的目标但是通过只添加新历史的方式来支持并发的交互会话 以下示例扩展了 类以支持历史保存恢复 系统相关模块 本章节叙述的模块只在 平台上可用 相关特性 来自 运行时的有用例程 文件操作 控制台 其他函数 注册表访问 函数 常数 数据编码 便携式密码输入工具 源代码 模块提供了两个函数 提示用户输入一个密码且不会回显 用户会看到字符串 作为提示 其默认值为 在 上如有必要提示会使用替换错 误句柄写入到文件类对象 默认指向控制终端 如果不可用则指向 此参数在 上会 被忽略 如果回显自由输入不可用则 将回退为打印一条警告消息到 并且从 读取同时发出 注解 如果你从 内部调用 输入可能是在你启动 的终端中 而非在 窗口本身中完成 一个当密码输入可能被回显时发出的 子类 返回用户的登录名称 此函数会按顺序检查环境变量 和 并返回其中第一个被设置为非空字符串的值 如果均未设置则在支持 模块的系统上将返回来自密码数据库的登录名否则将引发一个异常 通常情况下此函数应优先于 使用 标准 系统符号 本模块提供标准的 系统符号 每个符号的值是其对应的整数值 符号的名称和描述来自 应该是非常全面的 提供从 值到底层系统中字符串名称的映射的字典 例如 映射为 如果要将数字的错误代码转换为错误信息请使用 在下面的列表中当前平台上没有使用的符号没有被本模块定义 已定义的符号的具体列表可参见 可用的符号包括 操作不被允许 无此文件或目录 无此进程 系统调用中断 参见 此错误被映射到异常 错误 无此设备或地址 参数列表过长 执行格式错误 错误的文件号 没有子进程 重试 内存不足 没有权限 错误的地址 需要块设备 设备或资源忙 文件已存在 跨设备链接 无此设备 不是目录 是目录 无效的参数 文件表溢出 打开的文件过多 不是打字机 文本文件忙 文件过大 设备已无可用空间 非法查找 只读文件系统 链接过多 管道已损坏 数学参数超出函数范围 数学运算结果无法表示 将发生资源死锁 文件名过长 没有可用的记录锁 功能未实现 目录非空 遇到过多的符号链接 操作将阻塞 没有所需类型的消息 标识符被移除 信道编号超出范围 级别 未同步 级别 已停止 级别 重置 链接编号超出范围 未附加协议驱动 没有可用的 结构 级别 已停止 无效的交换 无效的请求描述符 交换已满 没有阳极 无效的请求码 无效的槽位 文件锁定死锁错误 错误的字体文件格式 设备不是流 没有可用的数据 计时器已到期 流资源不足 机器不在网络上 包未安装 对象是远程的 链接已被切断 广告错误 挂载错误 发送时通讯错误 协议错误 已尝试多跳 专属错误 非数据消息 值相对于已定义数据类型过大 名称在网络上不唯一 文件描述符处于错误状态 远端地址已改变 无法访问所需的共享库 访问已损坏的共享库 中的 部分已损坏 尝试链接过多的共享库 无法直接执行共享库 非法字节序列 已中断系统调用需要重启 流管道错误 用户过多 在非套接字上执行套接字操作 需要目标地址 消息过长 套接字的协议类型错误 协议不可用 协议不受支持 套接字类型不受支持 操作在传输端点上不受支持 协议族不受支持 地址族不受协议支持 地址已被使用 无法分配要求的地址 网络已断开 网络不可达 网络因重置而断开连接 软件导致连接中止 连接被对方重置 没有可用的缓冲区空间 传输端点已连接 传输端点未连接 传输端点关闭后无法发送 引用过多无法拼接 连接超时 连接被拒 主机已关闭 没有到主机的路由 操作已在进行 操作正在进行 过期的 文件句柄 结构需要清理 不是 命名类型文件 没有可用的 信标 是命名类型文件 远程 错误 超出配额 打印或检索堆栈回溯 源代码 该模块提供了一个标准接口来提取 格式化和打印 程序的堆栈跟踪结果 它完全模仿 解释器在打印堆栈跟踪结果时的行为 当您想要在程序控制下打印堆栈跟踪结果时例如在封装解释器时这是非常有用的 这个模块使用 对象 这是存储在 中的对象类型变量并作为 的第三项被返回 这个模块定义了以下函数 在 版更改 打印回溯对象 到 的异常信息和整个堆栈回溯 这和 比有以下方面不同 如果 不为 它将打印头部 在 版更改 在 版更改 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 在 版更改 新版功能 正则表达式操作 源代码 这个模块提供了与 语言类似的正则表达式匹配操作 模式和被搜索的字符串既可以是 字符串 也可以是 位字节串 但是 字符串与 位字节串不能混用也就是说你不能用一个字节串模式去匹配 字符串反之亦然类似地当进行替换操作时替换字符串的类型也必须与所用的模式和搜索字符串的类型一致 正则表达式使用反斜杠字符 来表示特殊形式或是允许在使用特殊字符时不引发它们的特殊含义 这会与 的字符串字面值中对相同字符出于相同目的的用法产生冲突例如要匹配一个反斜杠字面值用户可能必须写成 来作为模式字符串因为正则表达式必须为 而每个反斜杠在普通 字符串字面值中又必须表示为 而且还要注意在 的字符串字面值中使用的反斜杠如果有任何无效的转义序列现在将会产生 并将在未来改为 此行为即使对于正则表达式来说有效的转义字符同样会发生 解决办法是对于正则表达式样式使用 的原始字符串表示法在带有 前缀的字符串字面值中反斜杠不必做任何特殊处理 因此 表示包含 和 两个字符的字符串而 则表示只包含一个换行符的字符串 样式在 代码中通常都会使用这种原始字符串表示法来表示 绝大部分正则表达式操作都提供为模块函数和方法在 编译正则表达式 这些函数是一个捷径不需要先编译一个正则对象但是损失了一些优化参数 参见 第三方模块 提供了与标准库 模块兼容的 接口 同时还提供 了额外的功能和更全面的 支持 正则表达式语法 模块内容 正则表达式对象 正则对象 匹配对象 匹配对象总是有一个布尔值 如果没有匹配的话 和 返回 所以你可以简单的用 语句来判断是否匹配 匹配对象支持以下方法和属性 对 进行反斜杠转义替换并且返回就像 方法中一样 转义如同 被转换成合适的字符数字引用 和命名组合 替换为相应组合的内容 在 版更改 不匹配的组合替换为空字符串 返回一个或者多个匹配的子组 如果只有一个参数结果就是一个字符串 如果有多个参数结果就是一个元组每个参数对应一个项如果没有参 数组 默认到 整个匹配都被返回 如果一个组 参数值为 相应的 返回值就是整个匹配字符串如果它是一个范围 结果就是相应的 括号组字符串 如果一个组号是负数或者大于样式中定义的组数一个 索引错误就 如果一个组包含在样式的一部分并被 匹配多次就返回最后一个匹配 如果正则表达式使用了 语法 参数就也可能是命 名组合的名字 如果一个字符串参数在样式中未定义为组合名一个 就 一个相对复杂的例子 命名组合同样可以通过索引值引用 如果一个组匹配成功多次就只返回最后一个匹配 这个等价于 这允许更方便的引用一个匹配 新版功能 返回一个元组包含所有匹配的子组在样式中出现的从 到任意多的组合 参数用于不参与匹配的情况默认为 例如 如果我们使小数点可选那么不是所有的组都会参与到匹配当中 这些组合 默认会返回一个 除非指定了 参数 返回一个字典包含了所有的 命名 子组 就是组名 参 数用于不参与匹配的组合默认为 例如 返回 匹配到的字串的开始和结束标号 默认为 意思是 整个匹配的子串 如果 存在但未产生匹配就返回 对于一个匹配对象 和一个未参与匹配的组 组 等价于 产生的匹配是 注意 将会等于 如果 匹配一 个空字符串的话 比如在 之后 为 为 和 都是 一个 例外 这个例子会从 地址中移除掉 对于一个匹配 返回一个二元组 注意如果 没有在这个匹配中就返回 默认为 就是整个匹配 的值会传递给 或 的方法 正则对象 这 个是正则引擎开始在字符串搜索一个匹配的索引位置 的值会传递给 或 的方法 正则对象 这个是正则引擎停止在字符串搜索一个匹配的索引位置 捕获组的最后一个匹配的整数索引值或者 如果没有匹配产生的话 比如对于字符串 表达式 和 将得到 而 会得到 最后一个匹配的命名组名字或者 如果没有产生匹配的话 返回产生这个实例的 正则对象 这个实例是由 正则对象的 或 方法产生的 传递到 或 的字符串 在 版更改 添加了对 和 的支持 匹配对象被看作是原子性的 正则表达式例子 检查对子 在这个例子里我们使用以下辅助函数来更好地显示匹配对象 假设你在写一个扑克程序一个玩家的一手牌为五个字符的串每个字符表示一张牌 就是 为 到 表示 到 要看给定的字符串是否有效我们可以按照以下步骤 最后一手牌 包含了一个对子或者两张同样数值的牌 要用正则表达式匹配它应该使用向后引用如下 要找出对子由什么牌组成开发者可以按照下面的方式来使用匹配对象的 方法 模拟 目前没有一个类似 函数 的替代品 正则表达式通常比 格式字符串要更强大一些但也带来更多复杂性 下面的表格提供了 格式符和正则表达式大致相同的映射 格式符 正则表达式 从文件名和数字提取字符串 你可以使用 格式化 等价的正则表达式是 制作一个电话本 将字符串用参数传递的样式分隔开 这个方法对于转换文本数据到易读而且容易修改的数据结构是很有用的如下面的例子证明 首先这里是输入 它通常来自一个文件这里我们使用三重引号字符串语法 条目用一个或者多个换行符分开 现在我们将字符串转换为一个列表每个非空行都有一个条目 最终将每个条目分割为一个由名字 姓氏 电话号码和地址组成的列表 我们为 使用了 形参因为地址中包含有被我们作为分割模式的空格符 样式匹配姓后面的冒号因此它不出现在结果列表中 如果 设置为 我们还可以从地址中获取到房间号 文字整理 替换字符串中出现的样式的每一个实例 这个例子证明了使用 来整理文字或者随机化每个字符的位置除了首位和末尾字符 查找所有副词 匹配样式 所有 的出现不仅是像 中的第一个匹配 比如如果一个作者希望找到文字中的所有副词他可能会按照以下方法用 查找所有的副词及其位置 如果需要匹配样式的更多信息 可以起到作用它提供了 匹配对象 作为返回值而不是字符串 继续上面的例子如果一个作者希望找到所有副词和它的位置可以按照下面方法使用 原始字符串标记 原始字符串记法 保持正则表达式正常 否则每个正则式里的反斜杠 都必须前缀一个反斜杠来转义 比如下面两行代码功能就是完全一致的 当需要匹配一个字符反斜杠它必须在正则表达式中转义 在原始字符串记法就是 否则就必须用 来表示同样的意思 写一个词法分析器 一个 词法器或词法分析器 分析字符串并分类成目录组 这是写一个编译器或解释器的第一步 文字目录是由正则表达式指定的 这个技术是通过将这些样式合并为一个主正则式并且循环匹配来实现的 该词法器产生以下的输出 该书的第三版不再包含 但第一版极 详细地覆盖了正则表达式模式串的编写 一般实体的定义 文件处理 源代码 文件可用来配置支持 的应用例如邮件阅读器和 浏览器如何响应具有不同 类型的文件 这个名称源自短语 例如一个 文件可能包含 这样的行 然后如果用户遇到 类型为 的邮件消息或 文档时 将被替换为一个文件名通常是一个临时文件并且将自动启动 程序来查看该文件 格式的文档见 但它并不是一个因特网标准 不过 文件在大多数 系统上都受到支持 返回一个 元组其中第一个元素是包含所要执行命令的字符串 它可被传 递给 第二个元素是对应于给定 类型的 条 目 如果找不到匹配的 类型则将返回 是所需字段的名称它代表要执行的活动类型默认值是 因 为在最通常的情况下你只是想要查看 类型数据的正文 其他可能的值 还有 和 分别用于想要创建给定 类型正文或修改 现有正文数据的情况 请参阅 获取这些字段的完整列表 是在命令行中用来替换 的文件名默认值 几乎肯定不是你想要的因此通常你要通过指定一个文件名来重载它 可以是一个包含命名形参的列表默认值只是一个空列表 列表中 的每个条目必须为包含形参名称的字符串 等于号 以及形参的值 条目可以包含形如 的命名形参它将由名为 的形 参的值所替换 例如如果命令行 是在一个 文件中并且 被设为 则结果命令行将为 在 文件中可以指定可选的 字段来检测某些外部条件例 如所使用的机器架构或窗口系统来确定是否要应用 行 将自动检查此类条件并在检查未通过时跳过条目 返回一个将 类型映射到 文件条目列表的字典 此字典必须 被传给 函数 条目会被存储为字典列表但并不需要了解 此表示形式的细节 此信息来自在系统中找到的所有 文件 用户的 文件 中的设置将覆盖系统 文件 和 中的设置 一个用法示例 开发者工具集 源代码 此模块包含与 模块内部细节有关的多个常量一些关于具体实现的详细注释以及一些能够分析封存数据的有用函数 此模块的内容对需要操作 的 核心开发者来说很有用处 的一般用户则可能会感觉 模块与他们无关 命令行语法 新版功能 当从命令行发起调用时 将对一个或更多 文件的内容进行拆解 请注意如果你查看 中保存的 对象而非 格式的细节你可能需要改用 但是当你想检查的 文件来自某个不受信任的源时 是更安全的选择因为它不会执行 字节码 例如对于一个封存在文件 中的元组 命令行选项 使用简短的操作码描述来标注每一行 输出应当写入到的文件名称 一个新的 层级所需缩进的空格数 当反汇编多个对象时保留各个反汇编的备忘记录 当指定一个以上的 文件时在每次反汇编之前打印给定的前言 编程接口 将 的符号化反汇编数据输出到文件类对象 默认为 可以是一个字符串或一个文件类对象 可以是一个将被用作 的备忘记录的 字典它可被用来对由 同一封存器创建的多个封存对象执行反汇编 由 操作码指明的每个 连续级别将会缩进 个空格 如果为 指定了一 个非零值则输出中的每个操作码将以一个简短描述来标注 的值会被用作标注所应开始的列的提示 新版功能 参数 提供包含 中所有操作码的 返回一个 三元组的序列 是 类的一个实例 是 对象形式的 参数的已解码值 是 所在的 位置 可以是一个字符串或一个文件类对象 在消除未使用的 操作码之后返回一个新的等效 字符串 优 化后的 将更为简短耗费更为的传输时间要求更少的存储空间并 能更高效地解封 推测图像类型 源代码 模块推测文件或字节流中的图像的类型 模块定义了以下类型 测试包含在命名为 的文件中的图像数据并且返回描述此类图 片的字符串 如果可选的 被提供 将被忽略并且 包 含将被测试的二进制流 在 版更改 接受一个 类路径对象 接下来的图像类型是可识别的返回值来自 值 图像格式 图像库文件 和 文件 便携式位图文件 便携式灰度图文件 便携式像素表文件 文件 光栅文件 位图文件 或 格式的 数据 文件 便携式网络图像 文件 文件 新版功能 和 格式被添加 你可以扩展此 可以被追加的这个变量识别的文件格式的列表 执行单个测试的函数列表 每个函数都有两个参数字节流和类似开放文件 的对象 当 用字节流调用时类文件对象将是 如果测试成功这个测试函数应当返回一个描述图像类型的字符串否则返 回 示例 命令行选项 参数和子命令解析器 新版功能 源代码 教程此页面包含该 的参考信息 有关 命令行解析更细致的介绍请参阅 教程 模块可以让人轻松编写用户友好的命令行接口 程序定义它需要的参数然后 将弄清如何从 解析出那些参数 模块还会自动生成帮助和使用手册并在用户给程序传入无效参数时报出错误信息 示例 以下代码是一个 程序它获取一个整数列表并计算总和或者最大值 假设上面的 代码保存在名为 的文件中它可以在命令行运行并提供有用的帮助消息 当使用适当的参数运行时它会输出命令行传入整数的总和或者最大值 如果传入无效参数则会报出错误 以下部分将引导你完成这个示例 创建一个解析器 使用 的第一步是创建一个 对象 对象包含将命令行解析成 数据类型所需的全部信息 添加参数 给一个 添加程序参数信息是通过调用 方法完成的 通常这些调用指定 如何获取命令行字符串并将其转换为对象 这些信息在 调用时被存储和使用 例如 稍后调用 将返回一个具有 和 两个属性的对象 属性将是一个包含一个或多个整数的列表而 属性当命令行中指定了 参数时将是 函数否则则是 函数 解析参数 通过 方法解析参数 它将检查命令行把每个参数转换为适当的类型然后调用相应的操作 在大多数情况下这意味着一个简单的 对象将从命令行参数中解析出的属性构建 在脚本中通常 会被不带参数调用而 将自动从 中确定命令行参数 对象 默认情况下 对象使用 来确定如何在帮助消息中显示程序名称 这一默认值几乎总是可取的因为它将使帮助消息与从命令行调用此程序的方式相匹配 例如对于有如下代码的名为 的文件 该程序的帮助信息将显示 作为程序名称无论程序从何处被调用 要更改这样的默认行为可以使用 参数为 提供另一个值 需要注意的是无论是从 或是从 参数确定的程序名称都可以在帮助消息里通过 格式串来引用 默认情况下 根据它包含的参数来构建用法消息 可以通过 关键字参数覆盖这一默认消息 在用法消息中可以使用 格式说明符来填入程序名称 大多数对 构造方法的调用都会使用 关键字参数 这个参数简要描述这个程度做什么以及怎么做 在帮助消息中这个描述会显示在命令行用法字符串和各种参数的帮助消息之间 在默认情况下 将被换行以便适应给定的空间 如果想改变这种行为见 参数 有些时候先举个例子当处理一个特别长的参数列表的时候把它存入一个文件中而不是在命令行打出来会很有意义 如果 参数提供给 构造函数之后所有类型的字符的参数都会被当成文件处理并且会被文件包含的参数替代 举个栗子 从文件读取的参数在默认情况下必须一个一行但是可参见 并且它们被视为与命令行上的原始文件引用参数位于同一位置 所以在以上例子中 的表示和 的表示相同 参数默认为 意味着参数不会被当作文件对待 正常情况下当你向 的 方法传入一个参数列表时它会 这个特性可以设置 为 来关闭 新版功能 正常情况下当你向 的 方法传入一个无效的参数列表时它将会退出并发出错误信息 如果用户想要手动捕获错误可通过将 设为 来启用该特性 新版功能 方法 方法必须知道它是否是一个选项例如 或 或是一个位置参数例如一组文件名 第一个传递给 的参数必须是一系列 或者是一个简单的参数名 例如可以选项可以被这样创建 而位置参数可以这么创建 当 被调用选项会以 前缀识别剩下的参数则会被假定为位置参数 对象将命令行参数与动作相关联 这些动作可以做与它们相关联的命令行参数的任何事尽管大多数动作只是简单的向 返回的对象上添加属性 命名参数指定了这个命令行参数应当如何处理 供应的动作有 存储参数的值 这是默认的动作 例如 存储被 命名参数指定的值 动 作通常用在选项中来指定一些标志 例如 这些是 分别用作 存储 和 值的特殊用例 另外它们的默认值分别为 和 例如 存储一个列表并且将每个参数值追加到列表中 在允许多次 使用选项时很有用 例如 这存储一个列表并将 命名参数指定的值追加到 列表中 注意 命名参数默认为 动 作一般在多个参数需要在同一列表中存储常数时会有用 例如 计算一个关键字参数出现的数目或次数 例如对于一个增长的 详情等级来说有用 请注意 将为 除非显式地设为 打印所有当前解析器中的选项和参数的完整帮助信息然后退出 默认情况下一个 动作会被自动加入解析器 关于输出是如何创建的 参与 期望有一个 命名参数在 调用 中并打印版本信息并在调用后退出 这会存储一个列表并将每个参数值加入到列表中 示例用法 新版功能 你还可以通过传递一个 子类或实现相同接口的其他对象来指定任意操作 在 中可用并会添加对布尔型操作例如 和 的支持 创建自定义动作的推荐方式是扩展 重载 方法以及可选的 和 方法 一个自定义动作的例子 更多描述见 的 参数用于保存不从命令行中读取但被各种 动作需求的常数值 最常用的两例为 当 通过 或 调用时 这些动作将 值添加到 返回的对象的属性中 在 的描述中查看案例 当 通过选项例如 或 调用并且 时 这会创建一个可以跟随零个或一个命令行参数的选项 当解 析命令行时如果选项后没有参数则将用 代替 在 描述中 查看案例 对 和 动作 命名参数必须给出 对其他动作默认为 某些命令行参数应当从一组受限值中选择 这可通过将一个容器对象作为 关键字参数传给 来处理 当执行命令行解析时参数值将被检查如果参数不是可接受的值之一就将显示错误消息 请注意 容器包含的内容会在执行任意 转换之后被检查因此 容器中对象的类型应当与指定的 相匹配 任何容器都可作为 值传入因此 对象 对象以及自定义容器都是受支持的 这也包括 该对象可被用来限制参数的选项如果我们重用之前的石头布剪刀游戏示例就可以写成这样 通常 模块会认为 和 等旗标是指明 可选的 参数它们总是可以在命令行中被忽略 要让一个选项成为 必需的则可以将 作为 关键字参数传给 如这个例子所示如果一个选项被标记为 则当该选项未在命令行中出现时 将会报告一个错误 注解 必需的选项通常被认为是不适宜的因为用户会预期 都是 可选 的因此在可能的情况下应当避免使用它们 当 生成帮助消息时它需要用某种方式来引用每个预期的参数 默认情况下 对象使用 值作为每个对象的 默认情况下对于位置参数动作 值将被直接使用而对于可选参数动作 值将被转为大写形式 因此一个位置参数 的引用形式将为 一个带有单独命令行参数的可选参数 的引用形式将为 示例如下 可以使用 来指定一个替代名称 请注意 仅改变 显示的 名称 对象的属性名称仍然会由 值确定 不同的 值可能导致 被多次使用 提供一个元组给 即为每个参数指定不同的显示信息 大多数 动作会添加一些值作为 所返回对象的一个属性 该属性的名称由 的 关键字参数确定 对于位置参数动作 通常会作为 的第一个参数提供 对于可选参数动作 的值通常取自选项字符串 会通过接受第一个长选项字符串并去掉开头的 字符串来生成 的值 如果没有提供长选项字符串则 将通过接受第一个短选项字符串并去掉开头的 字符来获得 任何内部的 字符都将被转换为 字符以确保字符串是有效的属性名称 下面的例子显示了这种行为 允许提供自定义属性名称 类 方法 将参数字符串转换为对象并将其设为命名空间的属性 返回带有成员的命名 空间 之前对 的调用决定了哪些对象被创建以及它们如何被赋 值 请参阅 的文档了解详情 要解析的字符串列表 默认值是从 获取 用于获取属性的对象 默认值是一个新的空 对象 选项值语法 方法支持多种指定选项值的方式如果它接受选项的话 在最简单的情况下选项和它的值是作为两个单独参数传入的 对于长选项名称长度超过一个字符的选项选项和值也可以作为单个命令行参数传入使用 分隔它们即可 对于短选项长度只有一个字符的选项选项和它的值可以拼接在一起 有些短选项可以使用单个 前缀来进行合并如果仅有最后一个选项或没有任何选项需要值的话 无效的参数 在解析命令行时 会检测多种错误包括有歧义的选项 无效的类型 无效的选项 错误的位置参数个数等等 当遇到这种错误时它将退出并打印出错误文本同时附带用法消息 包含 的参数 参数缩写前缀匹配 方法 在默认情况下 允许将长选项缩写为前缀如果缩写无歧义即前缀与一个特定选项相匹配的话 可产生一个以上选项的参数会引发错误 此特定可通过将 设为 来禁用 在 以外 有时在 以外用 解析参数也是有用的 这可以通过将一个字符串列表传给 来实现 它适用于在交互提示符下进行检测 命名空间对象 由 默认使用的简单类可创建一个存放属性的对象并将其 返回 这个类被有意做得很简单只是一个具有可读字符串表示形式的 如果你更喜欢类似字典的属性视图你可以使用标准 中惯常的 另一个用处是让 为一个已存在对象而不是为一个新的 对象的属性赋值 这可以通过指定 关键字参数来实现 其它实用工具 子命令 对象 工厂类用于创建可作为 的 参数传入的对象 以 对象作为其类型的参数将使用命令 行参数以所请求模式 缓冲区大小 编码格式和错误处理方式打开文件请 参阅 函数了解详情 对象能理解伪参数 并会自动将其转换为 用于 可读的 对象或是 用于可写的 对 象 新版功能 和 关键字参数 参数组 在默认情况下 会在显示帮助消息时将命令行参数分为 位置参数和可选参数两组 当存在比默认更好的参数分组概念时可以 使用 方法来创建适当的分组 方法返回一个具有 方法的参数 分组对象这与常规的 一样 当一个参数被加入分组时 解析器会将它视为一个正常的参数但是会在不同的帮助消息分组中显示 该参数 方法接受 和 参数它们可被用来定制显示内容 请注意任意不在你的自定义分组中的参数最终都将回到通常的位置参数和 可选参数分组中 互斥 创建一个互斥组 将会确保互斥组中只有一个参数在命令行中 可用 方法也接受一个 参数表 示在互斥组中至少有一个参数是需要的 注意目前互斥参数组不支持 的 和 参数 解析器默认值 在大多数时候 所返回对象的属性将完全通过检查命令行参 数和参数动作来确定 则允许加入一些无须任何命令行 检查的额外属性 请注意解析器层级的默认值总是会覆盖参数层级的默认值 解析器层级默认值在需要多解析器时会特别有用 请参阅 方法了解此类型的一个示例 获取一个命名空间属性的默认值该值是由 或 设置的 打印帮助 在大多数典型应用中 将负责任何用法和错误消息的格式化和打印 但是也可使用某些其他格式化方法 打印一段简短描述说明应当如何在命令行中发起调用 如果 为 则默认使用 打印一条帮助消息包括程序用法和通过 注册的相关参 数信息 如果 为 则默认使用 还存在这些方法的几个变化形式它们只返回字符串而不打印消息 返回一个包含简短描述的字符串说明应当如何在命令行中发起调用 反回一个包含帮助消息的字符串包括程序用法和通过 注册的相关参数信息 部分解析 有时一个脚本可能只解析部分命令行参数而将其余的参数继续传递给另一个脚本或程序 在这种情况下 方法会很有用处 它的作用方式很类似 但区别在于当存在额外参数时它不会产生错误 而是会返回一个由两个条目构成的元组其中包含带成员的命名空间和剩余参数字符串的列表 警告 前缀匹配 规则应用于 一个选项即使只是已知选项 的前缀部分解析器也能识别该选项不会将其放入剩余参数列表 自定义文件解析 从文件读取的参数见 的 关 键字参数将是一行读取一个参数 可被 重载以使用更复杂的读取方式 此方法接受从参数文件读取的字符串形式的单个参数 它返回 从该字符串解析出的参数列表 此方法将在每次按顺序从参数文件读取一行 时被调用一次 此方法的一个有用的重载是将每个以空格分隔的单词视为一个参数 下面的 例子演示了如何实现此重载 退出方法 此方法将终结程序退出时附带指定的 并且如果给出了 则会在退出前将其打印输出 用户可重载此方法以不同方式来处 理这些步骤 此方法将向标准错误打印包括 的用法消息并附带状态码 终结 程序 混合解析 许多 命令允许用户混用可选参数与位置参数 和 方法均支持这种解析风格 这些解析器并不支持所有的 特性并且当未支持的特性被使用时将会引发异常 特别地子解析器 以及同时包括可选与位置参数的互斥分组是不受支持的 下面的例子显示了 与 之间的差异前者会将 返回为未解析的参数而后者会将所有位置参数收集至 中 返回由两个条目组成的元组其中包含带成员的命名空间以及剩余参数字符串列表 当存在任何剩余的未解析参数字符串时 将引发一个错误 新版功能 升级 代码 单元测试框架 基本实例 模块提供了一系列创建和运行测试的工具 这一段落演示了这些工具的一小部分但也足以满足大部分用户的需求 这是一段简短的代码来测试三种字符串方法 继承 就创建了一个测试样例 上述三个独立的测试是三个类的方法这些方法的命名都以 开头 这个命名约定告诉测试运行者类的哪些方法表示测试 每个测试的关键是调用 来检查预期的输出 调用 或 来验证一个条件调用 来验证抛出了一个特定的异常 使用这些方法而不是 语句是为了让测试运行者能聚合所有的测试结果并产生结果报告 通过 和 方法可以设置测试开始前与完成后需要执行的指令 在 组织你的测试代码 中对此有更为详细的描述 最后的代码块中演示了运行测试的一个简单的方法 提供了一个测试脚本的命令行接口 当在命令行运行该测试脚本上文的脚本生成如以下格式的输出 在调用测试脚本时添加 参数使 显示更为详细的信息生成如以下形式的输出 以上例子演示了 中最常用的 足够满足许多日常测试需求的特性 文档的剩余部分详述该框架的完整特性 命令行界面 命令行选项 在测试运行时标准输出流与标准错误流会被放入缓冲区 成功的测试的运 行时输出会被丢弃测试不通过时测试运行中的输出会正常显示错误会 被加入到测试失败信息 当测试正在运行时 会等待当前测试完成并在完成后报告已 执行的测试的结果 当再次按下 时引发平常的 异常 当出现第一个错误或者失败时停止运行测试 只运行匹配模式或子串的测试方法和类 可以多次使用这个选项以便包含 匹配子串的所有测试用例 包含通配符的模式使用 对测试名称进行匹 配 另外该匹配是大小写敏感的 模式对测试加载器导入的测试方法全名进行匹配 例如 可以匹配到 和 但是不能匹配到 在回溯中显示局部变量 新版功能 添加命令行选项 和 新版功能 命令行选项 新版功能 命令行选项 命令行亦可用于探索性测试以运行一个项目的所有测试或其子集 探索性测试 组织你的测试代码 单元测试的构建单位是 独立的 包含执行条件与正确性检查的方案 在 中测试用例表示为 的实例 通过编写 的子类或使用 编写你自己的测试用例 一个 实例的测试代码必须是完全自含的因此它可以独立运行或与其它任意组合任意数量的测试用例一起运行 的最简单的子类需要实现一个测试方法例如一个命名以 开头的方法以执行特定的测试代码 可以看到为了进行测试我们使用了基类 提供的其中一个 方法 若测试不通过将会引发一个带有说明信息的异常并且 会将这个测试用例标记为测试不通过 任何其它类型的异常将会被当做错误处理 可能同时存在多个前置操作相同的测试我们可以把测试的前置操作从测试代码中拆解出来并实现测试前置方法 在运行测试时测试框架会自动地为每个单独测试调用前置方法 注解 多个测试运行的顺序由内置字符串排序方法对测试名进行排序的结果决定 在测试运行时若 方法引发异常测试框架会认为测试发生了错误因此测试方法不会被运行 相似的我们提供了一个 方法在测试方法运行后进行清理工作 若 成功运行无论测试方法是否成功都会运行 这样的一个测试代码运行的环境被称为 一个新的 实例作为一个测试脚手架用于运行各个独立的测试方法 在运行每个测试时 和 会被调用一次 建议你根据所测试的功能将测试用 实现集合起来 为此提供了机制 以 的类 为代表 大部分情况下调用 即可并且它会为你集合所有模块的测试用例并执行 然而如果你需要自定义你的测试套件的话你可以参考以下方法组织你的测试 复用已有的测试代码 一些用户希望直接使用 运行已有的测试代码而不需要把已有的每个测试函数转化为一个 的子类 因此 提供 类 这个 的子类可用于打包已有的测试函数并支持设置前置与后置函数 假定有一个测试函数 可以创建等价的测试用例如下其中前置和后置方法是可选的 注解 跳过测试与预计的失败 新版功能 例如以下测试 可以得到以下输出 类与函数 本节深入介绍了 的 测试用例 在 版更改 在 版更改 新版功能 注解 在 版更改 在 版更改 在 版更改 新版功能 在 版更改 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 在 版更改 新版功能 新版功能 新版功能 新版功能 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 新版功能 在 版更改 新版功能 新版功能 新版功能 子进程管理 源代码 模块允许你生成新的进程连接它们的输入 输出 错误管道并且获取它们的返回码 此模块打算代替一些老旧的模块与功能 在下面的段落中你可以找到关于 模块如何代替这些模块和功能的相关信息 参见 提出 模块的 使用 模块 常用参数 构造函数 异常 在子进程中抛出的异常在新的进程开始执行前将会被再次在父进程中抛出 最常见的被抛出异常是 例如当尝试执行一个不存在的文件时就会发生 应用程序需要为 异常做好准备 如果 调用时有无效的参数则一个 将被抛出 与 在调用的进程返回非零退出码时将抛出 所有接受 形参的函数与方法例如 和 将会在进程退出前超时到期时抛出 此模块中定义的异常都继承自 新版功能 基类 被添加 安全考量 不像一些其他的 功能此实现绝不会隐式调用一个系统 这意味着任何字符包括 元字符可以安全地被传递给子进程 如果 被明确地调用通过 设置则确保所有空白字符和元字符被恰当地包裹在引号内以避免 注入 漏洞就由应用程序负责了 当使用 函数可以作为在将被用于构造 指令的字符串中转义空白字符以及 元字符的方案 对象 助手 常数 较旧的高阶 使用 模块替换旧函数 在这一节中 改为 意味着 可以被用作 的替代 注解 在这一节中的所有 函数会在找不到被执行的程序时差不多静默地失 败 替代函数则会改为引发 此外在使用 时如果替代函数所请求的操作产生了非零返回值则将失败 并引发 操作的输出仍能以所引发异常的 属性的方式被访问 在下列例子中我们假定相关的函数都已从 模块中导入了 替代 命令替换 改为 替代 管道 改为 启动 之后再执行 调用很重要这是为了让 能在 先于 退出时接收到 另外对于受信任的输入 本身的管道支持仍然可被直接使用 改为 替代 注释 通过 来调用程序通常是不必要的 一个更现实的例子如下所示 替代 函数族 示例 示例 示例 示例 替代 返回码以如下方式处理转写 来自 模块的替代函数 注解 如果 函数的 参数是一个字符串命令会通过 来执行 如果是一个列表命令会被直接执行 和 基本上类似于 不同之处在于 如果执行失败会引发一个异常 参数被替换为 参数 必须指定 和 默认会关闭所有文件描述符但对于 你必须指明 以才能在所有平台或较旧的 版本中确保此行为 旧式的 发起函数 此模块还提供了以下来自 模块的旧版函数 这些操作会隐式地发起调用系统 并且上文所描述的有关安全与异常处理一致性保证都不适用于这些函数 返回在 中执行 产生的 在 中以 执行字符串 并返回一个 元组 会使用当前区域设置的编码格式请参阅 常 用参数 中的说明来了解详情 末尾的一个换行符会从输出中被去除 命令的退出码可被解读为子进程的返 回码 例如 可用性 和 在 版更改 添加了 支持 此函数现在返回 而不是像 及更早的版本那样返回 的值与 相同 返回在 中执行 产生的输出 和 类似于 但退出码会被忽略并且返回值为包含命令输 出的字符串 例如 可用性 和 在 版更改 添加了 支持 注释 在 上将参数列表转换为一个字符串 在 上 序列会被转换为可使用以下规则来解析的字符串对应于 运行时所使用的规则 参数以空白符分隔即空格符或制表符 用双引号标示的字符串会被解读为单个参数而不再考虑其中的空白符 一 个参数可以嵌套用引号标示的字符串 带有一个反斜杠前缀的双引号会被解读为双引号字面值 反斜杠会按字面值解读除非它是作为双引号的前缀 如果反斜杠被作为双引号的前缀则每个反斜杠对会被解读为一个反斜杠字 面值 如果反斜杠数量为奇数则最后一个反斜杠会如规则 所描述的那 样转义下一个双引号 参见 此模块提供了用于解析和转义命令行的函数 内置常量 由 模块添加的常量 模块在启动期间自动导入除非给出 命令行选项将几个常量添加到内置命名空间 它们对交互式解释器 很有用并且不应在程序中使用 当打印此对象时会打印出一条消息例如 当调用此对象时将使用指定的退出代码来引发 打印或调用的对象分别打印版权或作者的文本 当打印此对象时会打印出一条消息 当调用此对象时将以分页形式显示完整的许可证文本每 次显示一屏 新版功能 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 示例 开发工具 本章中描述的各模块可帮你编写 程序 例如 模块接受一个模块并根据该模块的内容来生成文档 和 这两个模块包含了用于编写单元测试的框架并可用于自动测试所编写的代码验证预期的输出是否产生 程序能够将 源代码翻译成有效的 源代码 本章中描述的模块列表是 类型标注支持 类型别名 泛型 用户定义的泛型类型 类型 名义性子类型 区别于 结构性子类型 模块内容 特殊类型原语 特殊类型 特殊形式 协议 常数 文档生成器和在线帮助系统 测试交互性的 示例 简单用法检查 中的示例 警告 对象 对象 对象 对象 对象 调试 单元测试框架 基本实例 命令行界面 命令行选项 探索性测试 组织你的测试代码 复用已有的测试代码 跳过测试与预计的失败 类与函数 测试用例 对象库 快速上手 类 上手指南 使用 模拟方法调用 对象上的方法调用的 自动将 代码转为 代码 使用 修复器 支持库 回归测试包 文件和目录访问 本章中描述的模块处理磁盘文件和目录 例如有一些模块用于读取文件的属性以可移植的方式操作路径以及创建临时文件 本章的完整模块列表如下 面向对象的文件系统路径 基础使用 纯路径 通用性质 运算符 访问个别部分 方法和特征属性 具体路径 方法 对应的 模块的工具 常用路径操作 迭代来自多个输入流的行 解析 结果 文件及目录的比较 类 生成临时文件和目录 示例 已弃用的函数和变量 风格路径名模式扩展 文件名模式匹配 随机读写文本行 高阶文件操作 目录和文件操作 依赖于具体平台的高效拷贝操作 示例 示例 归档操作 归档程序示例 使用 的归档程序示例 查询输出终端的尺寸参见 模块 操作系统接口包括处理比 文件对象 更低级别文件的功能 模块 的内置 库包括抽象类和一些具体的类如文件 内置函数 使用 打开文件进行读写的标准方法 处理模块 源代码 是一个收集了多个涉及 的模块的包 打开和读取 包含 抛出的异常 用于解析 用于解析 文件 查找脚本使用的模块 源码 该模块提供了一个 类可用于确定脚本导入的模块集 也可以作为脚本运行给出 脚本的文件名作为参数之后将打印导入模块的报告 记录名为 的包可以在指定的 中找到 允许指定名为 的模块实际上是名为 的包 该类提供 和 方法用于确定脚本导入的模块 集 可以是搜索模块的目录列表如果没有指定则使用 设置调试级别更高的值使类打印调试消息关于 它正在做什么 是要从分析中排除的模块名称列表 是将在模块路径中替换的 元组的 列表 将报告打印到标准输出列出脚本导入的模块及其路径以及缺少或似乎 缺失的模块 分析 文件的内容该文件必须包含 代码 一个将模块名称映射到模块的字典 请参阅 的示例用法 的示例用法 稍后将分析的脚本 将输出 报告的脚本 输出样例可能因架构而异 设置异步事件处理程序 该模块提供了在 中使用信号处理程序的机制 一般规则 函数允许定义在接收到信号时执行的自定义处理程序 少量的默认处理程序已经设置 被忽略因此管道和套接字上的写入错误可以报告为普通的 异常以及如果父进程没有更改 则其会被翻译成 异常 一旦设置特定信号的处理程序将保持安装直到它被显式重置 模拟 样式接口而不管底层实现但 的处理程序除外它遵循底层实现 执行 信号处理程序 信号处理程序不会在低级 信号处理程序中执行 相反低级信号处理程序设置一个标志告诉 稍后执行相应的 信号处理程序例如在下一个 指令 这会导致 捕获同步错误是没有意义的例如 或 它们是由 代 码中的无效操作引起的 将从信号处理程序返回到 代码这可能会 再次引发相同的信号导致 显然的挂起 从 开始你可 以使用 模块来报告同步错误 纯 中实现的长时间运行的计算例如在大量文本上的正则表达式匹配可 以在任意时间内不间断地运行而不管接收到任何信号 计算完成后将调用 信号处理程序 信号与线程 模块内容 在 版更改 信号 处理程序 和 下面列出的相关常量变成了 和 函数返回人类可读的 在 模块中定义的变量是 这是两种标准信号处理选项之一它只会执行信号的默认函数 例如在大 多数系统上对于 的默认操作是转储核心并退出而对于 的默认操作是简单地忽略它 这是另一个标准信号处理程序它将简单地忽略给定的信号 可用性 可用性 参见 对应于 击键事件的信号 此信号只能用于 可用性 新版功能 对应于 击键事件的信号 此信号只能用于 可用性 新版功能 比最高信号数多一 实时递减间隔计时器并在到期时发送 仅在进程执行时递减间隔计时器并在到期时发送 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 在 版更改 在 版更改 新版功能 新版功能 新版功能 在 版更改 新版功能 在 版更改 示例 事件循环 事件循环方法集 运行和停止循环 运行直到 的实例 被完成 如果参数是 将被隐式调度为 来运行 返回 的结果 或者引发相关异常 运行事件循环直到 被调用 如果 在调用 之前被调用循环将轮询一次 选择器并设置超时为零再运行所有已加入计划任务的回调来响应 事件 以及已加入计划任务的事件然后退出 如果 在 运行期间被调用循环将运行当前批次 的回调然后退出 请注意在此情况下由回调加入计划任务的新回调将不会运 行它们将会在下次 或 被调用 时运行 停止事件循环 返回 如果事件循环当前正在运行 如果事件循环已经被关闭返回 关闭事件循环 当这个函数被调用的时候循环必须处于非运行状态 状态的回调将 被丢弃 此方法清除所有的队列并立即关闭执行器不会等待执行器完成 这个方法是幂等的和不可逆的 事件循环关闭后不应调用其他方法 安排所有当前打开的 对象通过 调 用来关闭 在调用此方法后如果有新的异步生成器被迭代事件循环将会发 出警告 这应当被用来可靠地完成所有已加入计划任务的异步生成器 请注意当使用 时不必调用此函数 示例 新版功能 安排默认执行器的关闭并等待它合并 中的所有线程 在调用此方法后如果在使用默认执行器期间调用了 则将会引发 请注意当使用 时不必调用此函数 新版功能 安排回调 安排 在事件循环的下一次迭代时附带 参数 被调用 回调按其注册顺序被调用 每个回调仅被调用一次 可选的仅关键字型参数 允许为要运行的 指定一个自 定义 如果没有提供 则使用当前上 下文 返回一个能用来取消回调的 实例 这个方法不是线程安全的 的线程安全变体 必须被用于安排 来自其他线程 的回调 查看 并发和多线程 章节的文档 在 版更改 仅用于关键字形参的参数 已经被添加 请参阅 查看更多细节 注解 大多数 的调度函数不让传递关键字参数 为此请使用 使用 对象通常比使用 更方便 在调试和错误消息中 能更好的呈现 对象 调度延迟回调 事件循环提供安排调度函数在将来某个时刻调用的机制 事件循环使用单调时钟来跟踪时间 安排 在给定的 秒可以是 或者 后被调 用 返回一个 实例该实例能用于取消回调 只被调用一次 如果两个回调被安排在同样的时间点执行顺序 未限定 可选的位置参数 在被调用的时候传递给 如果你想 把关键字参数传递给 请使用 可选的仅关键字型参数 允许为要运行的 指定一个自 定义 如果没有提供 则使用当前上 下文 在 版更改 仅用于关键字形参的参数 已经被添加 请参 阅 查看更多细节 在 版更改 在 和更早版本的默认事件循环实现中 不能超过一天 这在 中已被修复 安排 在给定的绝对时间戳 或 被调用使 用与 同样的时间参考 这个函数的行为与 相同 返回一个 实例该实例能用于取消回调 在 版更改 仅用于关键字形参的参数 已经被添加 请参 阅 查看更多细节 在 版更改 在 和更早版本的默认事件循环实现中 和当前时间相差不能超过一天 在这 中已被修复 根据时间循环内部的单调时钟返回当前时间为一个 值 注解 在 版更改 在 和更早版本中超时 相对的 或绝对 的 不能超过一天 这在 中已被修复 参见 函数 创建 和 创建一个附加到事件循环中的 对象 这是在 中创建 的首选方式 这让第三方事件循环可以提供 对象的替代实现更好的性能或者功能 新版功能 安排一个 协程 的执行 返回一个 对象 三方的事件循环可以使用它们自己定义的 类的子类来实现互操作性 这个例子里返回值的类型是 的子类 如果提供了 参数且不为 它会使用 来 设为任务的名称 在 版更改 添加了 形参 设置一个任务工厂它将由 来使用 如果 为 则将设置默认的任务工厂 在其他情况下 必须为一个 可调用对象 且签名匹配 其中 是对活动事件循环的引用而 是一个协程对象 该可调用 对象必须返回一个兼容 的对象 返回一个任务工厂或者如果是使用默认值则返回 打开网络连接 创建网络服务 创建 服务 类型 监听 地址的 端口 返回一个 对象 参数 必须为一个返回 协议 实现的可调用对象 形参可被设为几种类型它确定了服务器所应监听的位置 如果 是一个字符串则 服务器会被绑定到 所指明 的单一网络接口 如果 是一个字符串序列则 服务器会被绑定到序列所指明 的所有网络接口 如果 是一个空字符串或 则会应用所有接口并将返回包 含多个套接字的列表通常是一个 的加一个 的 可被设为 或 以强制此套接字使 用 或 如果未设定则 将通过主机名称来确定 默认为 是用于 的位掩码 可以选择指定 以便使用预先存在的套接字对象 如果指定了此参 数则不可再指定 和 是传递给 的最大排队连接的数量默认为 可被设置为一个 实例以在所接受的连接上启用 告知内核要重用一个处于 状态的本地套接 字而不是等待其自然超时失效 如果未指定此参数则在 上将自动 设置为 告知内核只要在创建的时候都设置了这个标志就允许此 端点绑定到其它端点列表所绑定的同样的端口上 这个选项在 上 是不支持的 是用于 服务器的在放弃连接之前要等 待 握手完成的秒数 如果参数为 默认值 则为 秒 设置成 默认值 会导致创建 并立即开始 接受连接 设置成 用户需要等待 或者 以使 开始接受连接 新版功能 增加了 和 形 参 在 版更改 套接字选项 默认已为所有 连接进行了 设置 在 版更改 类中添加 支持 在 版更改 形参可以是一个字符串的序列 参见 函数是一个高层级的替代 它返回一对 和 可在 代码中使用 与 类似但是专用于 套接字族 是必要的 域套接字名称除非提供了 参数 抽象的 套接字 和 路径都是受支持的 请查看 方法的文档了解有关此方法的参数的信息 可用性 新版功能 在 版更改 形参现在可以是 对象 将已被接受的连接包装成一个传输协议对 此方法可被服务器用来接受 以外的连接但是使用 来处 理它们 参数 必须为一个返回 协议 实现的可调用对象 是一个预先存在的套接字对象它是由 返回的 可被设置为一个 以在接受的连接上启用 是为一个 连接在中止连接前等待 握 手完成的时间 单位秒 如果为 缺省 则是 秒 返回一个 对 新版功能 形参 新版功能 传输文件 升级 将现有基于传输的连接升级到 返回一个新的传输实例其中 必须在 之后立即开始使 用 传给 方法的 实例应永远不会被再次使用 参数 和 实例的方法与 和 所返回的类似 一个已经配置好的 实例 当服务端连接已升级时 如 所创建的对象 会传入 设置或者覆盖目标服务器证书中相对应的主机名 是用于 连接的在放弃连接之前要等待 握手完成的秒数 如果参数为 则使用 默认的 新版功能 监控文件描述符 开始监视 文件描述符以获取读取的可用性一旦 可用于读取 使用指定的参数调用 停止对文件描述符 读取可用性的监视 开始监视 文件描述符的写入可用性一旦 可用于写入使用指 定的参数调用 使用 传递关键字参数 给 停止对文件描述符 的写入可用性监视 另请查看 平台支持 一节了解以上方法的某些限制 直接使用 对象 异步版的 异步版的 在 版更改 和 方法一直被标记返回一个协程但是 之前实际返回的是 对象 从 开始这两个方法是协程 使用管道 在事件循环中注册 的读取端 必须为一个返回 协议 实现的可调用对象 是个 类似文件型对象 返回一对 其中 支持 接口而 是由 所实例化 的对象 使用 事件循环 被设置为非阻塞模式 在事件循环中注册 的写入端 必须为一个返回 协议 实现的可调用对象 是个 类似文件型对象 返回一对 其中 支持 接口而 是由 所实例化 的对象 使用 事件循环 被设置为非阻塞模式 注解 在 中 不支持上述方法 对于 请改 用 参见 和 方法 信号 设置 作为 信号的处理程序 此回调将与该事件循环中其他加入队列的回调和可运行协程一起由 发起调用 不同与使用 注册的信号处理程序使用此 函数注册的回调可以与事件循环进行交互 如果信号数字非法或者不可捕获就抛出一个 如果建立处 理器的过程中出现问题会抛出一个 使用 传递关键字参数 给 和 一样这个函数只能在主线程中调用 移除 信号的处理程序 如果信号处理程序被移除则返回 否则如果给定信号未设置处理程序 则返回 可用性 参见 模块 在线程或者进程池中执行代码 安排在指定的执行器中调用 示例 这个方法返回一个 对象 使用 传递关键字参数 给 在 版更改 不会再配置它所创建的线程 池执行器的 而是将其留给线程池执行器 来设置默认值 将 设为 所使用的默认执行器 应当是 的实例 版后已移除 使用不是 实例的执行器的做法已被弃用并将在 中引起错误 必须是个 的实例 错误处理 开启调试模式 获取事件循环调试模式状态 如果环境变量 是一个非空字符串就返回 否则就返回 设置事件循环的调试模式 在 版更改 现在也可以通过新的 开发模式 来启用调试模式 参见 运行子进程 回调处理 由 所返回的回调包 装器对象 取消回调 如果此回调已被取消或已被执行此方法将没有任何效果 如果此回调已被取消则返回 新版功能 由 和 所返回的回调包装器对象 这个类是 的子类 返回加入计划任务的回调时间以 值表示的秒数 时间值是一个绝对时间戳使用与 相同的时间引用 新版功能 对象 事件循环实现 带有两种不同的事件循环实现 和 默认情况下 被配置为在 上使用 而在 上使用 基于 模块的事件循环 使用给定平台中最高效的可用 也可以手动配置要使用的特定 可用性 用 构建的专为 的事件循环 可用性 参见 有关 完成端口的 文档 兼容事件循环的抽象基类 事件循环方法 一节列出了 的替代实现应当定义的所 有方法 示例 请注意本节中的所有示例都 有意地 演示了如何使用低层级的事件循环 例如 和 现代的 应用很少需要以这样的方式编写请考虑使用高层级的函数例如 的 示例 一个使用 方法来安排回调的示例 回调会显示 然后停止事件循环 参见 一个类似的 示例使用协程和 函数创建 使用 来展示当前的日期 一个每秒刷新显示当前日期的示例 回调使用 方法在 秒后将自身重新加入计划日程然后停止事件循环 参见 一个类似的 示例使用协程和 函数创建 监控一个文件描述符的读事件 使用 方法等到文件描述符收到一些数据然后关闭事件循环 参见 一个类似的 示例使用传输 协议和 方法 创建 另一个类似的 示例使用了高层级的 函数 和流 为 和 设置信号处理器 这个 示例只适用于 使用 方法为信号 和 注册处理程序 在 版更改 在 版更改 支持了 语句 在 版更改 新版功能 在 版更改 在 版更改 新版功能 新版功能 方法 在 版更改 新版功能 新版功能 新版功能 在 版更改 在 版更改 新版功能 工具函数 字体封装 类型标注支持 新版功能 源码 注解 运行时并不强制标注函数和变量类型 类型标注可被用于第三方工具 比如类型检查器 集成开发环境 静态检查器等 此模块为运行时提供了 和 规定的类型提示 最基本的支持由 和 类型组成 有关完整的规范请参阅 有关类型提示的简单介绍请参阅 函数接受并返回一个字符串注释像下面这样 在函数 中参数 预期是 类型并且返回 类型 子类型允许作为参数 类型别名 要定义一个类型别名可以将一个类型赋给别名 在本例中 和 将被视为可互换的同义词 类型别名可用于简化复杂类型签名 例如 请注意 作为类型提示是一种特殊情况并且由 取代 使用 辅助函数创建不同的类型 静态类型检查器会将新类型视为它是原始类型的子类 这对于帮助捕捉逻辑错误非常有用 您仍然可以对 类型的变量执行所有的 支持的操作但结果将始终为 类型 这可以让你在需要 的地方传入 但会阻止你以无效的方式无意中创建 请注意这些检查仅通过静态类型检查程序来强制 在运行时语句 将 设为一个函数该函数立即返回您传递它的任何参数 这意味着表达式 不会创建一个新的类或引入任何超出常规函数调用的开销 更确切地说表达式 在运行时总是为真 这也意味着无法创建 的子类型因为它是运行时的标识函数而不是实际的类型 但是可以基于 创建 并且 的类型检查将按预期工作 有关更多详细信息请参阅 注解 回想一下使用类型别名声明两种类型彼此 等效 将使静态类型检查对待所有情况下 完全等同于 当您 想简化复杂类型签名时这很有用 相反 声明一种类型是另一种 类型的子类型 将使静态类型 检查器将 当作 的 子类 这意味着 类型的值不能用于 类型的值需要的地方 当您想以最小的运行时 间成本防止逻辑错误时这非常有用 新版功能 期望特定签名的回调函数的框架可以将类型标注为 例如 通过用文字省略号替换类型提示中的参数列表 可以声明可调用的返回类型而无需指定调用签名 泛型 由于无法以通用方式静态推断有关保存在容器中的对象的类型信息因此抽象基类已扩展为支持订阅以表示容器元素的预期类型 泛型可以通过使用 模块中名为 的新工厂进行参数化 用户定义的泛型类型 用户定义的类可以定义为泛型类 作为基类定义了类 采用单个类型参数 这也使得 作为类体内的一个类型有效 基类定义了 使得 作为类型有效 泛型类型可以有任意数量的类型变量并且类型变量可能会受到限制 每个参数的类型变量必须是不同的 这是无效的 您可以对 使用多重继承 从泛型类继承时某些类型变量可能是固定的 在这种情况下 只有一个参数 在不指定类型参数的情况下使用泛型类别会为每个位置假设 在下面的例子中 不是泛型但是隐式继承自 用户定义的通用类型别名也受支持 例子 在 版更改 不再拥有一个自定义的元类 一个用户定义的泛型类能够使用抽象基本类作为基类而不会发生元类冲突 泛型元类不再被支持 参数化泛型的结果会被缓存并且在 模块中的大部分类型是可哈希且可比较相等性的 类型 名义性子类型 区别于 结构性子类型 最初 将 的静态类型系统定义为使用 名义性子类型 即是说当且仅当 是 的子类时可在需要 类时提供 类 这一要求之前也适用于抽象基类比如 这一做法的问题在于一个类必须显式地标注为支持他们这即不 也不太可能在惯用动态类型的 代码中会有人正常地去用 举例来说这符合 通过允许用户不必在类定义中显式地标注基类来解决这一问题允许静态类型检查器隐含地认为 既是 的子类型又是 的子类型 这被称为 结构性子类型 或者静态鸭子类型 此外通过继承一个特殊的类 用户能够定义新的自定义协议来充分享受结构化子类型后文中有例子 模块内容 本模块定义了如下类 函数和修饰器 注解 本模块定义了若干现存的标准库类的子类同时扩展为 以支持 中的类型变量 由于现存的标准库类在 中已经增强为支持 这些类型变得冗余 这些荣誉类型在 中被弃用但解释 器不会发起弃用警告 预期上类型检查器将会在程序的目标版本为 以上时标记这些弃用的类型 这些被弃用的类型会在 发布 的五年后从 模块中移除 详情请见 标准集合的类 型提示泛型 特殊类型原语 的泛型版本 对标注返回类型比较有用 如果要标注参数的话使用 如 的抽象容器类型是更好的选择 这个类型可以这样使用 版后已移除 这个类型可以这样用 版后已移除 版后已移除 版后已移除 注解 的泛型版本 新版功能 版后已移除 的泛型版本 新版功能 版后已移除 的泛型版本 新版功能 新版功能 版后已移除 的泛型版本 新版功能 新版功能 版后已移除 的泛型版本 新版功能 新版功能 版后已移除 版后已移除 新版功能 协议 新版功能 新版功能 用于指明标注不是类型提示的装饰器 此 装饰器生效于类或函数上 如果作用于类上的话它会递归 地作用于这个类的所定义的所有方法上但是对于超类或子类所定义的方法 不会生效 此方法会就地地修改函数 使其它装饰器起到 效果的装饰器 标记一个类或函数在运行时内不可用的装饰器 返回一个字典字典内含有函数 方法 模块或类对象的类型提示 在 版更改 新版功能 常数 注解 新版功能 底层网络接口 源代码 这个模块提供了访问 套接字 的接口 在所有现代 系统 和其他一些平台上可用 注解 一些行为可能因平台不同而异因为调用的是操作系统的套接字 这个 接口是用 的面向对象风格对 系统调用和套接字库接口的直译函数 返回一个 套接字对象 其方法是对各种套接字系统调用的实现 形参类型一般与 接口相比更高级例如在 文件 和 操作中接收操作的缓冲区分配是自动的发送操作的缓冲区长度是隐式的 参见 模块 用于简化网络服务端编写的类 模块 套接字对象的 封装 套接字协议族 模块内容 模块包含下列元素 异常 常数 函数 套接字对象 关于套接字超时的说明 超时与 方法 操作也受超时设置的约束通常建议在调用 之前调用 或将超时参数直接传递给 但是无论 套接字超时设置如何系统网络栈都有可能返回自带的连接超时错误 超时与 方法 如果 的值不是 则 方法返回的套接字将继承该超时值 若是 返回的套接字行为取决于侦听套接字的设置 如果侦听套接字处于 阻塞模式 或 超时模式则 返回的套 接字处于 阻塞模式 如果侦听套接字处于 非阻塞模式那么 返回的套接字是阻塞 还是非阻塞取决于操作系统 如果要确保跨平台时的正确行为建议手动覆盖 此设置 示例 流 这个类表示一个写入器对象该对象提供 以便于写数据至 流中 不建议直接实例化 而应改用 和 此方法会尝试立即将 写入到下层的套接字 如果写入失败数 据会被排入内部写缓冲队列直到可以被发送 此方法应当与 方法一起使用 此方法会立即尝试将一个字节串列表或任何可迭代对象写入到下层的 套接字 如果写入失败数据会被排入内部写缓冲队列直到可以被发送 此方法应当与 方法一起使用 此方法会关闭流以及下层的套接字 此方法应与 方法一起使用 如果下层的传输支持 方法则返回 否则返回 在已缓冲的写入数据被刷新后关闭流的写入端 返回下层的 传输 访问可选的传输信息详情参见 等待直到可以适当地恢复写入到流 示例 这是一个与下层的 写缓冲区进行交互的流程控制方法 当缓冲区大 小达到最高水位最大上限时 会阻塞直到缓冲区大小减少 至最低水位以便恢复写入 当没有要等待的数据时 会立即 返回 如果流已被关闭或正在被关闭则返回 新版功能 等待直到流被关闭 应当在 之后被调用以便等待直到下层的连接被关闭 新版功能 示例 使用流的 回显客户端 使用 函数的 回显客户端 参见 使用低层级 方法的 回显客户端协议 示例 使用流的 回显服务器 回显服务器使用 函数 参见 使用 方法的 回显服务器协议 示例 获取 标头 查询命令行传入 的 标头的简单示例 用法 或使用 注册一个打开的套接字以等待使用流的数据 使用 函数实现等待直到套接字接收到数据的协程 参见 使用低层级协议以及 方法的 注册一个打开的 套接字以等待使用协议的数据 示例 使用低层级的 方法来监视文件描述符的 监视文件描述 符以读取事件 示例 读写 格式文件 对象 对象 对于可查找的输出流 头将自动更新以反映实际写入的帧数 对于不可查找的流当写入第一帧时 值必须准确 获取准确的 值可以通过调用 或 并附带 被调用之前将要写入的帧数然后使用 来写入帧数据或者通过调用 并附带所有要写入的帧 在后一种情况下 将计算数据中的帧数并在写入帧数据之前相应地设置 由 返回的 对象有以下几种方法在 版更改 添加了对不可搜索文件的支持 确保 是正确的并在文件被 打开时关闭它 此方法会 在对象收集时被调用 如果输出流不可查找且 与实际写入的帧 数不匹配时引发异常 设置声道数 设置采样字节长度为 设置采样频率为 在 版更改 对此方法的非整数输入会被舍入到最接近的整数 设置总帧数为 如果与之后实际写入的帧数不一致此值将会被更改 如果输出流不可查找则此更改尝试将引发错误 设置压缩格式 目前只支持 即无压缩格式 应该是 每项的值应可用于 方法 设置所有形参 返回当前文件指针其指针含义和 以及 是一致的 写入音频数据但不更新 在 版更改 现在可接受任意 写入音频帧并确保 是正确的 如果输出流不可查找且在 被写入之后写入的总帧数与之前设定的 值不匹配将会引发错误 在 版更改 现在可接受任意 注意在调用 或 之后再设置任何格式参数是无效的而且任何这样的尝试将引发 回归测试包 注解 参见 模块 编写 回归测试 文档测试 参见 迭代器 源代码 通过 方法来迭代消息对象树是相当容易的 模块提供了一些适用于消息对象树的高层级迭代器 此函数会迭代 的所有子部分中的所有载荷逐行返回字符串载荷 它会跳过所有子部分的标头并且它也会跳过任何包含不为 字符串 的载荷的子部分 这基本上等价于使用 从一个文件读取消息 的纯文本表示形式并跳过所有中间的标头 可选的 会被传递给 此函数会迭代 的所有子部分只返回其中与 和 所指定的 类型相匹配的子部分 请注意 是可选项如果省略则仅使用主类型来进行子部分 类型的匹配 也是可选项它的默认值为 因此在默认情况下 会返回每一个 类 型为 的子部分 增加了以下函数作为有用的调试工具 它 不应当 被视为该包所支持的公共接口的组成部分 打印消息对象结构的内容类型的缩进表示形式 例如 可选项 是一个作为打印输出目标的文件类对象 它必须适用于 的 函数 是供内部使用的 如果为真值则会同时打印默认类型 库例程 此模块提供一个接口到 日常库 参考 手册页关于 设施的详细描述 此模块包装了系统的 例程族 一个能与 服务器对话的纯 库则以 模块中 类的形式提供 这个模块定义了以下函数 将字符串 发送到系统日志记录器 如有必要会添加末尾换行符 每条消息都带有一个由 和 组成的优先级标价签 可选的 参数默认值为 它确定消息的优先级 如 果未在 中使用逻辑或 对 进行编码则会使用在 调用中所给定的值 如果 未在对 的调用之前被调用则将不带参数地 调用 引发 审计事件 使用参数 后续 调用的日志选项可以通过调用 来设置 如 果日志当前未打开则 将不带参数地调用 可选的 关键字参数是在每条消息前添加的字符串默认为 去除打头的路径部分 可选的 关键字参数 默认为 是一个位字段 请参见下文了解可能的组合值 可选的 关键字参数 默认为 为没有显式编码 的消息设置默认的 引发 审计事件 使用参数 在 版更改 在之前的版本中不允许关键字参数并且要求必须有 的默认值依赖于系统库它往往为 而不是 程序文件的实际名称 重置日志模块值并且调用系统库 这使得此模块在初始导入时行为固定 例如 将在首次调用 时被调用如果 还未被调用过并且 和其他 形参会被重置为默认值 引发一个 审计事件 不附带任何参数 将优先级掩码设为 并返回之前的掩码值 调用 并 附带未在 中设置的优先级将会被忽略 默认设置为记录所有优 先级 函数 可计算单个优先级 的掩码 函数 可计算包括 在内的所有优先级的掩码 引发一个 审计事件 附带参数 此模块定义了一下常量优先级级别 高到低 设施 如果 中有定义则还有 日志选项 如果 中有定义则还 有 以及 示例 简单示例 一个简单的示例集 一个设置多种日志选项的示例其中有在日志消息中包含进程 以及将消息写入用于邮件日志记录的目标设施等 对象序列化 与其他 模块间的关系 与 间的关系 与 模块的比较 数据流格式 所使用的数据格式仅可用于 这样做的好处是没有外部标准给该格式强加限制比如 或 不能表示共享指针标准但这也意味着非 程序可能无法重新读取 封存的 对象 默认情况下 格式使用相对紧凑的二进制来存储 如果需要让文件更小可以高效地 压缩 由 封存的数据 模块包含了相应的工具用于分析 生成的数据流 源码中包含了对 协议使用的操作码的大量注释 当前共有 种不同的协议可用于封存操作 使用的协议版本越高读取所生成 对象所需的 版本就要越新 版协议是原始的人类可读协议并且向后兼容早期版本的 版协议是较早的二进制格式它也与早期版本的 兼容 版协议是在 中引入的 它为存储 提供了 更高效的机制 欲了解有关第 版协议带来的改进请参阅 版协议是在 中引入的 它显式地支持 字节对象 不能使用 解封 这是 的默认协议 版协议添加于 它支持存储非常大的对象能存储更多种类的 对象还包括一些针对数据格式的优化 它是 使用的默认协议 有 关第 版协议带来改进的信息请参阅 第 版协议是在 中加入的 它增加了对带外数据的支持并可 加速带内数据处理 请参阅 了解第 版协议所带来的改进的 详情 注解 序列化是一种比持久化更底层的概念虽然 读取和写入的是文件对 象但它不处理持久对象的命名问题也不处理对持久对象的并发访问甚至 更复杂的问题 模块可以将复杂对象转换为字节流也可以将字 节流转换为具有相同内部结构的对象 处理这些字节流最常见的做法是将它们 写入文件但它们也可以通过网络发送或存储在数据库中 模块提 供了一个简单的接口用于在 类型的数据库文件上封存和解封对象 模块接口 可以被封存解封的对象 封存类实例 持久化外部对象 为了获取对象持久化的利益 模块支持引用已封存数据流之外的对象 这样的对象是通过一个持久化 来引用的它应当是一个由字母数字类字符组成的字符串 对于第 版协议 或是一个任意对象 用于任意新版协议 模块不提供对持久化 的解析工作它将解析工作分配给用户定义的方法分别是 中的 方法和 中的 方法 要通过持久化 将外部对象封存必须在 中实现 方法该方法接受需要被封存的对象作为参数返回一个 或返回该对象的持久化 如果返回 该对象会被按照默认方式封存为数据流 如果返回字符串形式的持久化 则会封存这个字符串并加上一个标记这样 才能将其识别为持久化 要解封外部对象 必须实现 方法接受一个持久化 对象作为参数并返回一个引用的对象 下面是一个全面的例子展示了如何使用持久化 来封存外部对象 表 如果想对某些类进行自定义封存而又不想在类中增加用于封存的代码就可以创建带有特殊 表的 在 模块的 中定义了全局 表 因此可以使用 修改后的副本作为自有 表 例如 创建了一个带有自有 表的 实例它可以对 类进行特殊处理 另外下列代码 完成了相同的操作但所有 的实例都会共用同一份 表 使用 模块实现的等效代码是 处理有状态的对象 下面的示例展示了如何修改类在封存时的行为 其中 类打开了一个文本文件每次调用其 方法则返回行号和该行的字符 在封存这个 的实例时除了 文件对象其他属性都会被保存 当解封实例时需要重新打开文件然后从上次的位置开始继续读取 实现这些功能需要实现 和 方法 使用方法如下所示 类型函数和其他对象的自定义归约 新版功能 有时 可能不够灵活 特别是当我们想要基于对象类型以外的其他规则来对封存进行定制或是当我们想要对函数和类的封存进行定制的时候 对于那些情况可能要基于 类进行子类化并实现 方法 此方法可返回任意的归约元组 参见 它也可以选择返回 来回退到传统行为 如果同时定义了 和 则 方法具有优先权 注解 出于性能理由可能不会为以下对象调用 以及 和 的具体实例 以下是一个简单的例子其中我们允许封存并重新构建一个给定的类 外部缓冲区 新版功能 在某些场景中 模块会被用来传输海量的数据 因此最小化内存复制次数以保证性能和节省资源是很重要的 但是 模块的正常运作会将图类对象结构转换为字节序列流因此在本质上就要从封存流中来回复制数据 如果 待传输对象类型的实现 和 通信系统的实现都支持 第 版或更高版本所提供的外部传输功能则此约束可以被撤销 提供方 使用方 当序列化一个对象图时通信系统可以启用对所生成 对象的定制处理 发送端需要传递 参数到 或是到 或 函数该回调函数将在封存对象图时附带每个所生成的 被调用 由 所累积的缓冲区的数据将不会被拷贝到 流而是仅插入一个简单的标记 接收端需要传递 参数到 或是到 或 函数其值是一个由缓冲区组成的可迭代对象它会被传递给 该可迭代对象应当按其被传递给 时的顺序产生缓冲区 这些缓冲区将提供对象重构造器所期望的数据对这些数据的封存产生了原本的 对象 在发送端和接受端之间通信系统可以自由地实现它自己用于外部缓冲区的传输机制 潜在的优化包括使用共享内存或基于特定数据类型的压缩等 示例 下面是一个小例子在其中我们实现了一个 的子类能够用于外部缓冲区封存 重构造器 类方法 会在缓冲区的提供对象具有正确类型时返回该对象 在此小示例中这是模拟零拷贝行为的便捷方式 在使用方我们可以按通常方式封存那些对象它们在反序列化时将提供原始对象的一个副本 但是如果我们传入 然后在反序列化时给回累积的缓冲区我们就能够取回原始对象 这个例子受限于 会自行分配内存这一事实你无法基于另一个对象的内存创建 的实例 但是第三方数据类型例如 数组则没有这种限制允许在单独进程或系统间传输时使用零拷贝的封存或是尽可能少地拷贝 参见 带有外部数据缓冲区的 协议 限制全局变量 性能 较新版本的 协议第 版或更高具有针对某些常见特性和内置类型的高效二进制编码格式 此外 模块还拥有一个以 编写的透明优化器 示例 对于最简单的代码请使用 和 函数 以下示例读取之前封存的数据 参见 模块 为扩展类型提供 接口所需的构造函数 模块 用于处理和分析已封存数据的工具 模块 带索引的数据库用于存放对象使用了 模块 模块 浅层 和深层 复制对象操作 模块 高效地序列化内置类型的数据 脚注 不要把它与 模块混淆 这就是为什么 函数不可以被封存所有的匿名函数都有同一个名 字 抛出的异常有可能是 或 也可能是其他 异常 模块使用这一协议实现浅层 和深层 复制操作 对字母数字类字符的限制是由于持久化 在协议版本 中是由分行符来 分隔的 因此如果持久化 中出现任何形式的分行符封存结果就将变 得无法读取 可从进程直接访问的共享内存 日志记录配置 源代码 此页面仅包含参考信息 有关教程请参阅 基础教程 进阶教程 日志操作手册这一节描述了用于配置 模块的 配置函数 配置字典架构 描述日志记录配置需要列出要创建的不同对象及它们之间的连接例如你可以创建一个名为 的处理程序然后名为 的日志记录器将可以把它的消息发送给 处理程序 这些对象并不仅限于 模块所提供的对象因为你还可以编写你自己的格式化或处理程序类 这些类的形参可能还需要包括 这样的外部对象 描述这些对象和连接的语法会在下面的 对象连接 中定义 字典架构细节 传给 的字典必须包含以下的键 应设为代表架构版本的整数值 目前唯一有效的值是 使用 此键可允许架构在继续演化的同时保持向下兼容性 所有其他键都是可选项但如存在它们将根据下面的描述来解读 在下面提到 的所有情况下都将检查它的特殊键 以确定是否需要自定义实例化 如果需要则会使用下面 用户定义对象 所描述的机制来创建一个实例否则会使用上下文来确定要实例化的对象 对应的值将是一个字典其中每个键是一个格式器 而每 个值则是一个描述如何配置相应 实例的字典 将在配置字典中搜索键 和 默认值均为 并且 这些键会被用于构造 实例 在 版更改 一个 键 默认值为 可被添加到配置字 典的 部分这会被用来验证格式的有效性 对应的值将是一个字典其中每个键是一个过滤器 而每个值 则是一个描述如何配置相应 实例的字典 将在配置字典中搜索键 默认值为空字符串 并且该键会被用于构造 实例 对应的值将是一个字典其中每个键是一个处理程序 而每 个值则是一个描述如何配置相应 实例的字典 将在配置字典中搜索下列键 强制 这是处理程序类的完整限定名称 可选 处理程序的级别 可选 处理程序所对应格式化器的 可选 由处理程序所对应过滤器的 组成的列表 所有 其他 键会被作为关键字参数传递给处理程序类的构造器 例如给 定如下配置 为 的处理程序会被实例化为 并使 用 作为下层流 为 的处理程序会被实例化为 并附带关键字参数 对应的值将是一个字典其中每个键是一个日志记录器名称而每 个值则是一个描述如何配置相应 实例的字典 将在配置字典中搜索下列键 可选 日志记录器的级别 可选 日志记录器的传播设置 可选 由日志记录器对应过滤器的 组成的列表 可选 由日志记录器对应处理程序的 组成的列表 指定的日志记录器将根据指定的级别 传播 过滤器和处理程序来配置 这将成为根日志记录器对应的配置 配置的处理方式将与所有日志 记录器一致除了 设置将不可用之外 配置是否要被解读为在现有配置上新增 该值默认为 这意味着指定的配置将以与当前 所使用的相 同语义来替代现有的配置 如果指定的值为 配置会按照 增量配置 部分所描述的方式来处理 是否要禁用任何现有的非根日志记录器 该 设置对应于 中的同名形参 如果省略则此形参默认为 如果 为 则该省会被忽略 增量配置 为增量配置提供完全的灵活性是很困难的 例如由于过滤器和格式化器这样的对象是匿名的一旦完成配置在增加配置时就不可能引用这些匿名对象 此外一旦完成了配置在运行时任意改变日志记录器 处理程序 过滤器 格式化器的对象图就不是很有必要日志记录器和处理程序的详细程度只需通过设置级别即可实现控制对于日志记录器则可设置传播旗标 在多线程环境中以安全的方式任意改变对象图也许会导致问题虽然并非不可能但这样做的好处不足以抵销其所增加的实现复杂度 这样当配置字典的 键存在且为 时系统将完全忽略任何 和 条目并仅会处理 条目中的 设置以及 和 条目中的 和 设置 使用配置字典中的值可让配置以封存字典对象的形式通过线路传送给套接字监听器 这样长时间运行的应用程序的日志记录的详细程度可随时间改变而无须停止并重新启动应用程序 对象连接 用户定义对象 此架构支持用户定义对象作为处理程序 过滤器和格式化器 日志记录器的不同实例不需要具有不同类型因此这个配置架构并不支持用户定义日志记录器类 要配置的对象是由字典描述的其中包含它们的配置详情 在某些地方日志记录系统将能够从上下文中推断出如何实例化一个对象但是当要实例化一个用户自定义对象时系统将不知道要如何做 为了提供用户自定义对象实例化的完全灵活性用户需要提供一个 工厂 函数 即在调用时传入配置字典并返回实例化对象的可调用对象 这是用一个通过特殊键 来访问的工厂函数的绝对导入路径来标示的 下面是一个实际的例子 上面的 代码片段定义了三个格式化器 第一个的 为 是带有特殊格式字符串的标准 实例 第二个的 为 具有更长的格式同时还显式地定义了时间格式并将最终实例化一个带有这两个格式字符串的 以 源代码形式显示的 和 格式化器分别具有下列配置子字典 和 并且由于这些字典不包含特殊键 实例化方式是从上下文中推断出来的结果会创建标准的 实例 第三个格式器的 为 对应配置子字典为 并且它包含特殊键 这意味着需要用户自定义实例化方式 在此情况下将使用指定的工厂可调用对象 如果它本身就是一个可调用对象则将被直接使用 否则如果你指定了一个字符串如这个例子所示则将使用正常的导入机制来定位实例的可调用对象 调用该可调用对象将传入配置子字典中 剩余的 条目作为关键字参数 在上面的例子中调用将预期返回 为 的格式化器 将 用作特殊键是因为它不是一个有效的关键字形参名称这样就不会与调用中使用的关键字参数发生冲突 还被用作表明对应值为可调用对象的助记符 访问外部对象 访问内部对象 除了外部对象有时还需要引用配置中的对象 这将由配置系统针对它所了解的内容隐式地完成 例如在日志记录器或处理程序中表示 的字符串值 将被自动转换为值 而 和 条目将接受一个对象 并解析为适当的目标对象 但是对于 模块所不了解的用户自定义对象则需要一种更通用的机制 例如考虑 它接受一个 参数即其所委托的另一个处理程序 由于系统已经知道存在该类因而在配置中给定的 只需为相应目标处理程序的的对象 即可而系统将根据该 解析出处理程序 但是如果用户定义了一个具有 处理程序的 则配置程序将不知道 指向的是一个处理程序 为了应对这种情况通用解析系统允许用户指定 字符串字面值 将按照与 前缀类似的方式被解析为结果字符串但查找操作是在配置自身而不是在导入命名空间中进行 该机制允许按点号或按索引来访问与 所提供的方式类似 这样给定以下代码段 在该配置中字符串 将解析为带有 键的字典字符串 将解析为 字典中带有 键的字典依此类推 字符串 将解析为 而字符串 将解析为值 值可以使用 或者等价的 来访问 后一种形式仅在键包含空格或非字母数字类字符的情况下才需要使用 如果一个索引仅由十进制数码构成则将尝试使用相应的整数值来访问如果有必要则将回退为字符串值 给定字符串 这将解析为 如果字符串被指定为 系统将尝试从 中提取值并在尝试失败时回退为 导入解析与定制导入器 导入解析默认使用内置的 函数来执行导入 你可能想要将其替换为你自己的导入机制如果是这样的话你可以替换 或其超类 类的 属性 但是你必须小心谨慎因为函数是从类中通过描述器方式来访问的 如果你使用 可调用对象来执行导入并且你希望在类层级而不是在实例层级上定义它则你需要用 来装饰它 例如 如果你是在一个配置器的 实例 上设置导入可调用对象则你不需要用 来装饰 配置文件格式 其他图形用户界面 包 定义了以下异常 新版功能 新版功能 参数 标准类型层级结构 新版功能 跟踪内存分配 新版功能 源代码 示例 显示前 项 显示内存分配最多的 个文件 测试套件的输出示例 计算差异 获取两个快照并显示差异 测试套件的输出示例 输出 函数 新版功能 域过滤器 新版功能 过滤器 对内存块的跟踪进行筛选 示例 在 版更改 在 版更改 快照 统计 跟踪 在 版更改 回溯 在 版更改 在 版更改 示例 输出 编码和解码器 源代码 由 和 指定是一个受 的对象字面量语法启发的轻量级数据交换格式尽管它不仅仅是一个严格意义上的 的字集 提供了与标准库 和 相似的 接口 对基本的 对象层次结构进行编码 紧凑编码 美化输出 解码 特殊 对象解码 扩展 从命令行使用 来验证并美化输出 详细文档请参见 命令行界面 注解 是 的一个子集 由该模块的默认设置生成的 尤其是 默认的 分隔符 设置值也是 的一个子集 因此该模块 也能够用于序列化为 注解 这个模块的编码器和解码器默认保护输入和输出的顺序 仅当底层的容器未排 序时才会失去顺序 在 之前 并不保证有序因此输入 和输出通常都是乱序的除非是明确地请求 从 开始普通的 会保留顺序因此不必再为 的生 成和解析指定使用 基本使用 编码器和解码器 异常 拥有以下附加属性的 的子类 未格式化的错误消息 正在解析的 文档 新版功能 标准符合性和互操作性 格式由 和 指定 此段落详细讲了这个模块符合 的级别 简单来说 和 子类和明确提到的参数以外的参数不作考虑 此模块不严格遵循于 它实现了一些扩展是有效的 但不是有效的 尤其是 无限和 数值是被接受并输出 对象内的重复名称是接受的并且仅使用最后一对属性值对的值 自从 允许符合 的语法分析程序接收 不符合 的输入文本以来这个模块的解串器在默认状态下默认符合 字符编码 和 数值 不允许 或者 数值的表达方式 尽管这样默认情况下此模块接受并且输出 和 好像它们是有效的 数字字面值 序列化器中 参数可用于替代这个行为 反序列化器中 参数可用于替代这个行为 对象中的重复名称 具体说明了 在 对象里的名字应该是唯一的但没有规定如何处理 对象中的重复名称 默认下此模块不引发异常作为替代对于给定名它将忽略除姓值对之外的所有对 顶级非对象非数组值 过时的 指定的旧版本 要求 文本顶级值必须是 对象或数组 或 并且不能是 值布尔值数值或者字符串值 移除这个限制此模块没有并且从未在序列化器和反序列化器中实现这个限制 无论如何为了最大化地获取互操作性你可能希望自己遵守该原则 实现限制 一些 反序列化器的实现应该在以下方面做出限制 可接受的 文本大小 嵌套 对象和数组的最高水平 数字的范围和精度 字符串的内容和最大长度此模块不强制执行任何上述限制除了相关的 数据类型本身或者 解释器本身的限制以外 当序列化为 在应用中当心此类限制这可能破坏你的 特别是通常将 数字反序列化为 双精度数字从而受到该表示方式的范围和精度限制 这是特别相关的当序列化非常大的 值时或者当序列化 数值类型的实例时比如 命令行界面 源代码 如果未指定可选的 和 参数则将分别使用 和 在 版更改 输出现在将与输入顺序保持一致 请使用 选项来将输出按照键的字母顺序排序 命令行选项 要被验证或美化打印的 文件 如果 未指定则从 读取 将 输出写入到给定的 在其他情况下写入到 将字典输出按照键的字母顺序排序 新版功能 禁用非 字符的转义详情参见 新版功能 将每个输入行解析为单独的 对象 新版功能 用于空白符控制的互斥选项 新版功能 显示帮助消息 脚注 正如 的勘误表 所说明的 允许以字符串表示字面值字符 和 而 在 版中 不允许 数据库 接口 对 的重解析 源代码 此模块与 模块很相似但是改用 库 来提供某些附加功能 请注意由 与 所创建的文件格式是不兼容的 模块提供了对 库的接口 对象的行为类似于映射字典区别在于其键和值总是会在存储之前被转换为字节串 打印 对象不会打印出键和值并且 和 等方法也不受支持 针对 专属错误例如 错误引发 的引发则针对 一般映射错误例如指定了不正确的键 打开一个 数据库并返回 对象 参数为数据库 文件名称 可选的 参数可以是 值 意义 以只读方式打开现有数据库默认 以读写方式打开现有数据库 以读写方式打开数据库如果不存在则创建它 始终创建一个新的空数据库以读写方式打开 下列附加字符可被添加至旗标以控制数据库的打开方式 值 意义 以快速模式打开数据库 写入数据库将不会同步 同步模式 这将导致数据库的更改立即写入文件 不要锁定数据库 不是所有旗标都可用于所有版本的 模块常量 为包 含受支持旗标字符的字符串 如果指定了无效的旗标则会引发 可选的 参数是文件的 模式仅在要创建数据库时才会被使用 其默认值为八进制数 除了与字典类似的方法 对象还有以下方法 使用此方法和 方法可以循环遍历数据库中的每个键 遍历 的顺序是按照 的内部哈希值而不会根据键的值排序 此方法 将返回起始键 在遍历中返回 之后的的下一个键 以下代码将打印数据库 中的每个键而不会在内存中创建一个包含所有键的列表 如果你进行了大量删除操作并且想要缩减 文件所使用的空间此 例程将可重新组织数据库 除非使用此重组功能否则 对象不会 缩减数据库文件大小在其他情况下被删除的文件空间将会保留并在添 加新的 键 值 对时被重用 当以快速模式打开数据库时此方法会将任何未写入数据强制写入磁盘 关闭 数据库 基于 的接口 源代码 模块提供了对 库的接口 对象的行为类似于映射字典区别在于其键和值总是被存储为字节串 打印 对象不会打印出键和值并且 和 等方法也不受支持 此模块可与 经典 接口或 兼容接口一同使用 在 上 脚本将尝试定位适当的头文件来简化此模块的构建 针对 专属错误例如 错误引发 的引发则针对 一般映射错误例如指定了不正确的键 所使用的 实现库的名称 打开一个 数据库并返回 对象 参数为数据库文件 名称不带 或 扩展名 可选的 参数必须是下列值之一 值 意义 以只读方式打开现有数据库默认 以读写方式打开现有数据库 以读写方式打开数据库如果不存在则创建它 始终创建一个新的空数据库以读写方式打开 可选的 参数是文件的 模式仅在要创建数据库时才会被使用 其默认值为八进制数 并将被当前的 所修改 除了与字典类似的方法 对象还有以下方法 关闭 数据库 便携式 实现 源代码 注解 模块的目的是在更健壮的模块不可用时作为 模块的最终回 退项 不是为高速运行而编写的也不像其他数据库模块一样被 经常使用 模块提供了一个完全以 编写的持久化字典类接口 不同于 等其他模块它不需要外部库 与其他持久化映射一样它的键和值也总是被存储为字节串 该模块定义以下内容 针对 专属错误例如 错误引发 的引发则针 对一般映射例如指定了不正确的键 打开一个 数据库并返回 对象 参数为数 据库文件的主名称不带任何特定扩展名 创建一个 数据库时 将创建多个带有 和 扩展名的文件 可选的 参数可以是 值 意义 以只读方式打开现有数据库默认 以读写方式打开现有数据库 以读写方式打开数据库如果不存在则创建它 始终创建一个新的空数据库以读写方式打开 可选的 参数是文件的 模式仅在要创建数据库时才会被使用 其默认值为八进制数 并将被当前的 所修改 警告 当载入包含足够巨大复杂条目的数据库时有可能导致 解释器的崩 溃这是由于 编译器有栈深度限制 在 版更改 在 值为 时将总是创建一个新的数据 库 在 版更改 附带 旗标打开的数据库现在将是只读的 附带 和 旗标的打开操作不会再创建数据库 除了 类所提供的方法 对 象还提供了以下方法 同步磁盘上的目录和数据文件 此方法会由 方法来调 用 关闭 数据库 时区支持 新版功能 模块根据 的最初说明提供了具体的时区实现来支持 时区数据库 按照默认设置 会在可能的情况下使用系统的时区数据如果系统时区数据不可用该库将回退为使用 上提供的 第一方包 参见 模块 提供 和 类型 类被设计为可配合这两个 类型使用 包 由 核心开发者维护以通过 提供时区数据的第一方包 使用 是 抽象基类的具体实现其目标是通过构造器 方法或 来与 建立关联 以此方式构造的日期时间对象可兼容日期时间运算并可在无需进一步干预的情况下处理夏令时转换 这些时区还支持在 中引入的 在可能导致时间歧义的时差转换中例如夏令时到标准时的转换当 时会使用转换 之前的时差而当 时则使用转换 之后 的时差例如 当执行来自另一时区的转换时 将被设置为正确的值 数据源 模块不直接提供时区数据而是在可能的情况下从系统时区数据库或 上的第一方包 获取时区信息 某些系统重要的一点是 系统也包括在内并没有可用的 数据库因此对于要保证获取时区信息的跨平台兼容性的项目推荐对 声明依赖 如果系统数据和 均不可用则所有对 的调用都将引发 配置数据源 当 被调用时此构造器首先会在 所指定的目录下搜索匹配 的文件失败时则会在 包中查找匹配 此行为可通过三种方式来配置 默认的 未通过其他方式指定时可在 编译时 进行配置 可使用 环境变量 进行配置 在 运行时搜索路径可使用 函数来修改 编译时配置默认的 包括一些时区数据库的通用布署位置 除外该系统没有时区数据的通用位置 在 系统中下游分发者和从源码编译 的开发者知道系统时区数据布署位置他们可以通过指定编译时选项 或者更常见的是通过 旗标 来改变默认的时区路径该选项应当是一个由 分隔的字符串 在所有平台上配置值会在 中以 键的形式提供 环境配置当初始化 时在导入时或不带参数调用 时 模块将使用环境变量 如果变量存在则会设置搜索路径 这是一个以 分隔的字符串其中包含要使用的时区搜索路径 它必须仅由绝对路径而非相对路径组成 在 中指定的 相对路径部分将不会被使用但在其他情况下当指定相对路径时的行为该实 现是有定义的 将引发 而其他实现可自 由地忽略错误部分或是引发异常 要设置让系统忽略系统数据并改用 包请设置 运行时配置 搜索路径也可在运行时使用 函数来配置 通常并不建议如此操作不过在需要使用指定时区路径或者需要禁止访问系统时区的测试函数中使用它则是合理的 类 字符串表示 当在 对象上调用 时返回的字符串表示默认会使用 属性参见该属性文档中的用法注释 对于基于文件而非指定 形参所构建的对象 会回退为调用 的 是由具体实现定义的并且不一定会在不同版本间保持稳定但它保证不会是一个有效的 键 封存序列化 对象的序列化是基于键的而不是序列化所有过渡数据并且基于文件构造的 对象即使是指定了 值的对象不能被封存 文件的行为取决于它的构造方式 当使用主构造器构造时会基于键序列化一个 对象而当反序列化时反序列化过程会使用主构造器因此预 期它们与其他对同一时区的引用会是同一对象 例如如果 是一个包含基于 构建 的封存数据的字符串你可以预期出现以下的行为 当通过绕过缓存的构造器构造时 对象也会基于键序列化但当反序列化时反序列化过程会使用绕过缓存的 构造器 如果 是一个包含基于 构造的封存数据的字符串你可以 预期出现以下的行为 当通过文件构造时 对象会在封存时引发异常 如果最终用户想要封存通过文件构 造的 则推荐他们使用包装类型或自定义序列化函数或者基于 键序列化或者存储文件对象的内容并将其序列化 该序列化方法要求所需键的时区数据在序列化和反序列化中均可用类似于在序列化和反序列化环境中都预期存在对类和函数的引用的方式 这还意味着在具有不同时区数据版本的环境中当解封被封存的 时并不会保证结果的一致性 函数 获取一个包含可用 时区的在时区路径的任何位置均可用的全部有效键 的集合 每次调用该函数时都会重新计算 此函数仅包括规范时区名称而不包括特殊时区如位于 和 目录下的时区或 时区 警告 此函数可能会打开大量的文件因为确定时区路径上某个文件是否为有效 时区的最佳方式是读取开头位置的魔术字符串 注解 这些值并不被设计用来对外公开给最终用户对于面向用户的元素应用 程序应当使用 通用区域数据存储库 之类来获取更为用户 友好的字符串 另请参阅 中的提示性说明 设置或重置模块的时区搜索路径 当不带参数调用时 会被设为默认值 调用 将不会使 缓存失效因而在缓存未命中 的情况下对主 构造器的调用将只使用新的 形参必须是由字符串或 组成的 或而不是 字符串它们必须都是绝对路径 如果所传入的不是绝对路径则将引发 全局变量 一个表示时区搜索路径的只读序列 当通过键构造 时键会 与 中的每个条目进行合并并使用所找到的第一个文件 可以只包含绝对路径绝不包含相对路径无论它是如何配置的 所指向的对象可能随着对 的调用而 改变因此推荐使用 而不是从 导入 或是将 赋值给一个长期变量 有关配置时区搜索路径的更多信息请参阅 配置数据源 异常与警告 当一个 对象的构造由于在系统中找不到指定的键而失败时引发 这是 的一个子类 当 包含将被过滤掉的无效组件例如一个相对路径时引发 迭代来自多个输入流的行 二进制数据服务 本章介绍的模块提供了一些操作二进制数据的基本服务操作 有关二进制数据的其他操作特别是与文件格式和网络协议有关的操作将在相关章节中介绍 下面描述的一些库 文本处理服务 也可以使用 兼容的二进制格式例如 或所有二进制数据例如 另外请参阅 的内置二进制数据类型的文档 二进制序列类型 将字节串解读为打包的二进制数据 函数和异常 格式字符串 字节顺序大小和对齐方式 格式字符 示例 类 编解码器注册和相关基类 编解码器基类 错误处理方案 无状态的编码和解码 增量式的编码和解码 对象 对象 流式的编码和解码 对象 对象 对象 对象 编码格式与 标准编码 专属的编码格式 文字编码 二进制转换 文字转换 应用程序中的国际化域名 代码页 带 签名的 编解码器 读写 和 文件 二进制和 码互转 数字和数学模块 容器数据类型 这个模块实现了特定目标的容器以提供 标准内建容器 和 的替代选择 创建命名元组子类的工厂函数 类似列表 的容器实现了在两端快速添加 和弹出 类似字典 的容器类将多个映射集合到一个视图里面 字典的子类提供了可哈希对象的计数功能 字典的子类保存了他们被添加的顺序 字典的子类提供了一个工厂函数为字典查询提供一个默认值 封装了字典对象简化了字典子类化 封装了列表对象简化了列表子类化 封装了列表对象简化了字符串子类化 已将 容器抽象基类 移至 模块 为了保持向下兼容性它们在 版的这个模块中仍然存在 对象 新版功能 一个 类是为了将多个映射快速的链接到一起这样它们就可以作为一个单元处理 它通常比创建一个新字典和多次调用 要快很多 这个类可以用于模拟嵌套作用域并且在模版化的时候比较有用 一个 将多个字典或者其他映射组合在一起创建一个单独的可 更新的视图 如果没有 被指定就提供一个默认的空字典这样 一个新链至少有一个映射 底层映射被存储在一个列表中 这个列表是公开的可以通过 属性 存取和更新 没有其他的状态 搜索查询底层映射直到一个键被找到 不同的是写更新和删除只操作 第一个映射 一个 通过引用合并底层映射 所以如果一个底层映射更新了 这些更改会反映到 支持所有常用字典方法 另外还有一个 属性 一个创 建子上下文的方法 一个存取它们首个映射的属性 一个可以更新的映射列表 这个列表是按照第一次搜索到最后一次搜索的 顺序组织的 它是仅有的存储状态可以被修改 列表最少包含一个映射 返回一个新的 类包含了一个新映射 后面跟随当前 实例的全部映射 如果 被指定它就成为不同新的实例就是 在所有映射前加上 如果没有指定就加上一个空字典这样的话一个 调用等价于 这个方法用 于创建子上下文不改变任何父映射的值 在 版更改 添加了 可选参数 属性返回一个新的 包含所有的当前实例的映射除了第一个 这样可以在搜索的时候跳过第一个映射 使用的场景类似在 嵌套作用域中使用 关键词 用例也可以类比内建函 数 一个 的引用等价于 注意一个 的迭代顺序是通过扫描最后的映射来确定的 这给出了与 调用序列相同的顺序从最后一个映射开始 在 版更改 增加了对 和 运算符的支持相关说明见 参见 在 有支持写映射的选 项 的 模版是只读映射 它的上下文的 和 特性 也类似于 方法 属性 提供了是否对第一个映射或其他映射进行写和其 他修改的选项 一个 极简的只读版 例子和方法 这一节提供了多个使用链映射的案例 模拟 内部 链的例子 让用户指定的命令行参数优先于环境变量优先于默认值的例子 用 类模拟嵌套上下文的例子 类只更新链中的第一个映射但 会搜索整个链 然而如果需要深度写和删除也可以很容易的通过定义一个子类来实现它 对象 一个计数器工具提供快速和方便的计数 比如 一个 是一个 的子类用于计数可哈希对象 它是一个集 合元素像字典键 一样存储它们的计数存储为值 计数可以是任何整 数值包括 和负数 类有点像其他语言中的 或 元素从一个 被计数或从其他的 初始化 对象有一个字典接口如果引用的键没有任何记录就返回一个 而不是弹出一个 设置一个计数为 不会从计数器中移去一个元素 使用 来删除它 新版功能 在 版更改 作为 的子类 继承了记住插入顺序的功 能 对象进行数学运算时同样会保持顺序 结果会先按每个元 素在运算符左边的出现时间排序然后再按其在运算符右边的出现时间排序 计数器对象除了字典方法以外还提供了三个其他的方法 返回一个迭代器其中每个元素将重复出现计数值所指定次 元素会按 首次出现的顺序返回 如果一个元素的计数值小于一 将 会忽略它 返回一个列表其中包含 个最常见的元素及出现次数按常见程度 由高到低排序 如果 被省略或为 将返 回计数器中的 所有 元素 计数值相等的元素按首次出现的顺序排序 从 迭代对象 或 映射对象 减去元素 像 但是是 减去而不是替换 输入和输出都可以是 或者负数 新版功能 通常字典方法都可用于 对象除了有两个方法工作方式与字典并 不相同 这个类方法没有在 中实现 从 迭代对象 计数元素或者 从另一个 映射对象 或计数器 添加 像 但是是加上而不是替换 另外迭代对象 应该 是序列元素而不是一个 对 对象的常用案例 提供了几个数学操作可以结合 对象以生产 计数器中大于 的元素 加和减结合计数器通过加上或者减去元素的相应计数 交集和并集返回相应计数的最小或最大值 每种操作都可以接受带符号的计数但是输出会忽略掉结果为零或者小于零的计数 单目加和减一元操作符意思是从空计数器加或者减去 新版功能 添加了对一元加一元减和位置集合操作的支持 注解 计数器主要是为了表达运行的正的计数而设计但是小心不要预先排除负数 或者其他类型 为了帮助这些用例这一节记录了最小范围和类型限制 类是一个字典的子类不限制键和值 值用于表示计数但你实 际上 可以 存储任何其他值 方法在值需要排序的时候用 原地操作比如 值类型只需要支持加和减 所以分数 小数和十进制都可以用负值也可以支持 这两个方法 和 的输入和输出也一样支持负数和 多集合方法只为正值的使用情况设计 输入可以是负数或者 但 只输出计数为正的值 没有类型限制但值类型需要支持加减和比较操作 方法要求正整数计数 忽略 和负数计数 参见 在 链接 教程和例子 数学操作和多集合用例参考 在给定数量和集合元素枚举所有不同的多集合参考 对象 用法 这一节展示了 的多种用法 限长 提供了类似 过滤功能 另一个用法是维护一个近期添加元素的序列通过从右边添加和从左边弹出 一个 轮询调度器 可以通过在 中放入迭代器来实现 值从当前迭代器的位置 被取出并暂存 如果这个迭代器消耗完毕就用 将其从对列中移去否则就通过 将它移到队列的末尾 方法提供了一种方式来实现 切片和删除 例如 一个纯的 实现依赖于 来定位要弹出的元素 要实现 切片 使用一个类似的方法应用 将目标元素放到左边 通过 移去老的条目 通过 添加新的条目 然后反向 这个方法可以最小代价实现命令式的栈操作诸如 和 对象 例子 使用 作为 很轻松地将键值对组成的序列转换为键列表组成的字典 当每个键第一次遇见时它还没有在字典里面所以自动创建该条目即调用 方法返回一个空的 操作添加值到这个新的列表里 当再次存取该键时就正常操作 添加另一个值到列表中 这个计数比它的等价方法 要快速和简单 设置 为 使 用于计数类似其他语言中的 或 当一个字母首次遇到时它会查询失败则 会调用 来提供一个整数 作为默认值 后续的自增操作建立起对每个字母的计数 函数 总是返回 这是常数函数的特殊情况 一个更快和灵活的方法是使用 函数可以提供任何常量值不只是 设置 为 使 用于构建 集合 命名元组的工厂函数 命名元组赋予每个位置一个含义提供可读性和自文档性 它们可以用于任何普通元组并添加了通过名字获取值的能力通过索引值也是可以的 返回一个新的元组子类名为 这个新的子类用于创建类元组 的对象可以通过字段名来获取属性值同样也可以通过索引和迭代获取值 子类实例同样有文档字符串类名和字段名另外一个有用的 方法以 格式列明了元组内容 是一个像 一样的字符串序列 另外 可以是一个纯字符串用空白或逗号分隔开元素名比如 或者 任何有效的 标识符都可以作为字段名除了下划线开头的那些 有效 标识符由字母数字下划线组成但首字母不能是数字或下划线另外不 能是关键词 比如 或 如果 为真 无效字段名会自动转换成位置名 比如 转换成 消除关 键词 和重复字段名 可以为 或者是一个默认值的 如果一个默 认值域必须跟其他没有默认值的域在一起出现 就应用到最右边 的参数 比如如果域名 和默认值 那么 就必须指定一个参数值 默认值 默认值 如果 值有定义命名元组的 属性值就被设置 命名元组实例没有字典所以它们要更轻量并且占用更小内存 在 版更改 添加了对 的支持 在 版更改 和 参数成为 仅限关键字参数 在 版更改 添加了 参数 在 版更改 移除了 形参和 属性 在 版更改 添加了 参数和 属性 命名元组尤其有用于赋值 模块返回的元组 除了继承元组的方法命名元组还支持三个额外的方法和两个属性 为了防止字段名冲突方法和属性以下划线开始 类方法从存在的序列或迭代实例创建一个新实例 返回一个新的 它将字段名称映射到它们对应的值 在 版更改 返回一个 而不是 在 版更改 返回一个常规 而不是 因为自 起常规字典已经保证有序 如果需要 的额外 特性推荐的解决方案是将结果转换为需要的类型 返回一个新的命名元组实例并将指定域替换为新的值 字符串元组列出了字段名 用于提醒和从现有元组创建一个新的命名元组类 型 字典将字段名称映射到默认值 要获取这个名字域的值使用 函数 转换一个字典到命名元组使用 两星操作符 所述如 解包参数列表 因为一个命名元组是一个正常的 类它可以很容易的通过子类更改功能 这里是如何添加一个计算域和定宽输出打印格式 上面的子类设置 为一个空元组 通过阻止创建实例字典保持了较低的内存开销 子类化对于添加和存储新的名字域是无效的 应当通过 创建一个新的命名元组来实现它 文档字符串可以自定义通过直接赋值给 属性 在 版更改 文档字符串属性变成可写 参见 请参阅 以获取为命名元组添加类型提示的方法 它还使用 关键字提供了一种优雅的符号 对于以字典为底层的可变域名 参考 模块提供了一个装饰器和一些函数用于自动将生成的特殊 方法添加到用户定义的类中 对象 有序词典就像常规词典一样但有一些与排序操作相关的额外功能 由于内置的 类获得了记住插入顺序的能力在 中保证了这种新行为它们变得不那么重要了 一些与 的不同仍然存在 常规的 被设计为非常擅长映射操作 跟踪插入顺序是次要的 旨在擅长重新排序操作 空间效率 迭代速度和更新操作的 性能是次要的 算法上 可以比 更好地处理频繁的重新排序操作 这使其适用于跟踪最近的访问例如在 中 对于 相等操作检查匹配顺序 类的 方法有不同的签名 它接受一个可选参数 来指定弹出哪个元素 类有一个 方法可以有效地将元素移动到 任一端 之前 缺少 方法 返回一个 子类的实例它具有专门用于重新排列字典顺序的方法 新版功能 有序字典的 方法移除并返回一个 键值对 如果 值为真则按 后进先出的顺 序返回键值对否则就按 先进先出的顺序 返回键值对 将现有 移动到有序字典的任一端 如果 为真值默认 则将元素移至末尾如果 为假值则将元素移至开头 如果 不存在则会触发 新版功能 相对于通常的映射方法有序字典还另外提供了逆序迭代的支持通过 之间的相等测试是顺序敏感的实现为 对象和其他的 的相等测试是顺序敏感的字典测试 这允许 替换为任何字典可以使用的场所 在 版更改 的项 键 和值 视图 现在支持逆序迭代通过 在 版更改 赞成将关键词参数的顺序保留 通过传递给 构造器和它的 方法 在 版更改 增加了合并 与更新 运算符相关说明见 例子和用法 创建记住键值 最后 插入顺序的有序字典变体很简单 如果新条目覆盖现有条目则原始插入位置将更改并移至末尾 一个 对于实现 的变体也很有用 对象 类是用作字典对象的外包装 对这个类的需求已部分由直接创建 的子类的功能所替代不过这个类处理起来更容易因为底层的字典可以作为属性来访问 模拟一个字典类 这个实例的内容保存为一个正常字典 可以通过 实例的 属性存取 如果提供了 值 就被初始化为它的内容注意一个 的引用不会被保 留作为其他用途 实例提供了以下属性作为扩展方法和操作的支持 一个真实的字典用于保存 类的内容 对象 这个类封装了列表对象 它是一个有用的基础类对于你想自定义的类似列表的类可以继承和覆盖现有的方法也可以添加新的方法 这样我们可以对列表添加新的行为 对这个类的需求已部分由直接创建 的子类的功能所替代不过这个类处理起来更容易因为底层的列表可以作为属性来访问 模拟一个列表 这个实例的内容被保存为一个正常列表通过 的 属性存取 实例内容被初始化为一个 的 默认为 空列表 可以是迭代对象比如一个 列表或者一个 对象 提供了以下属性作为可变序列的方法和操作的扩展 一个 对象用于存储 的内容 子类化的要求 的子类需要提供一个构造器可以无参数调用或者一个参数调用 返回一个新序列的列表操作需要创建一个实现类的实例 它假定了构造器可以以一个参数进行调用这个参数是一个序列对象作为数据源 如果一个分离的类不希望依照这个需求所有的特殊方法就必须重写请参照源代码进行修改 对象 类是用作字符串对象的外包装 对这个类的需求已部分由直接创建 的子类的功能所替代不过这个类处理起来更容易因为底层的字符串可以作为属性来访问 模拟一个字符串对象 这个实例对象的内容保存为一个正常字符串通过 的 属性存取 实例内容初始化设置为 的 参数可以是任何可通过内建 函数转换为字符串的对象 提供了以下属性作为字符串方法和操作的额外支持 一个真正的 对象用来存放 类的内容 在 版更改 新方法 和 例如 函数式编程模块 本章里描述的模块提供了函数和类以支持函数式编程风格和在可调用对象上的通用操作 本章对下列模块进行说明 为高效循环而创建迭代器的函数 函数 配方 高阶函数和可调用对象上的操作 对象 标准运算符替代函数 将运算符映射到函数 原地运算符 本段落中的剩余文本是该模块的原始文档 支持面向行的命令解释器 源代码 类提供简单框架用于编写面向行的命令解释器 这些通常对测试工具管理工具和原型有用这些工具随后将被包含在更复杂的接口中 一个 实例或子类实例是面向行的解释器框架结构 实例化 本 身是没有充分理由的 它作为自定义解释器类的超类是非常有用的为了继承 的方法并且封装动作方法 可选参数 是完成键的 名称默认是 如果 不是 并且 是可用的 命令完成 会自动完成 可选参数 和 指定了 实例或子类实例将用于输入和输 出的输入和输出文件对象 如果没有指定他们将默认为 和 如果你想要使用一个给定的 确保将实例的 属性 设置为 否则 将被忽略 对象 例子 这部分提供了一个简单的例子来介绍如何使用一部分在 模块中的命令构建一个 基础的 命令比如 被添加进一个 子类方法名为 参数被转换成数字并且分发至 模组中 是 提供的帮助实用程序 例子也包含使用 方法实现基础的记录和回放的功能这个方法负责将输入转换为小写并且将命令写入文件 方法读取文件并添加记录命令至 用于即时回放 这是一个示例会话其中 显示帮助功能使用空行重复命令以及简单的记录和回放功能 参见 新版功能 参见 参见 参见 参见 参见 相关特性 参见 参见 超文本标记语言支持 对象持久化 源代码 是一种持久化的类似字典的对象 与 数据库的区别在于 中的值不是键实际上可以为任意 对象 即 模块能够处理的任何东西 这包括大部分类实例 递归数据类型以及包含大量共享子对象的对象 键则为普通的字符串 打开一个持久化字典 指定下层数据库的基准文件名 作为附带 效果会为 添加一个扩展名并且可能创建更多的文件 默认情况 下下层数据库会以读写模式打开 可选的 形参具有与 形参相同的含义 默认会使用第 版 协议来序列化值 协议版本可通过 形参来指定 由于 语义的限制 对象无法确定一个可变的持久化字典条目 在何时被修改 默认情况下 只有 在被修改对象再赋值给 时才会 写入该对象 参见 示例 如果可选的 形参设为 则 所有被访问的条目都将在内存中被缓存并会在 和 时 被写入这可以使得对持久化字典中可变条目的修改更方便但是如果访问 的条目很多这会消耗大量内存作为缓存并会使得关闭操作变得非常缓慢 因为所有被访问的条目都需要写回到字典无法确定被访问的条目中哪个 是可变的也无法确定哪个被实际修改了 注解 请不要依赖于 的自动关闭功能当你不再需要时应当总是显式地调 用 或者使用 作为上下文管理器 警告 由于 模块需要 的支持因此从不可靠的来源载入 是不安全的 与 一样载入 时可以执行任意代码 字典所支持的所有方法都被 对象所支持 因此很容易将基于字典的代码转换为需要持久化存储的代码 额外支持的两个方法 如果 打开时将 设为 则写回缓存中的所有条目 如果可行还会清空缓存并将持久化字典同步到磁盘 此方法会在使用 关闭 时自动被调用 同步并关闭持久化 对象 对已关闭 的操作将失败并引发 参见 持久化字典方案使用了广泛支持的存储格式并具有原生字典的速度 限制 示例 对接口的总结如下 为字符串 为任意对象 参见 模块 风格数据库的泛型接口 模块 所使用的对象序列化 版后已移除 参见 组数据库 该模块提供对 组数据库的访问 它在所有 版本上都可用 组数据库条目被报告为类似元组的对象其属性对应于 结构的成员下面的属性字段请参见 索引 属性 意义 组名 加密的组密码 通常为空 数字组 组内所有成员的用户名 是整数名称和密码是字符串成员列表是字符串列表 注意大多数用户未根据密码数据库显式列为所属组的成员 请检查两个数据库以获取完整的成员资格信息 还要注意以 或 开头的 可能是 引用可能无法通过 或 访问 本模块定义如下内容 返回给定数字组 的组数据库条目 如果找不到要求的条目则会引发 错误 版后已移除 从 开始弃用对 中的 或 等非 参数的支持 返回给定组名的组数据库条目 如果找不到要求的条目则会引发 错误 以任意顺序返回所有可用组条目的列表 参见 模块 用户数据库的接口与此类似 模块 针对影子密码数据库的接口与本模块类似 电子邮件与 处理包 源码 在 版更改 表示一封电子邮件信息 解析电子邮件信息 附加说明 异常和缺陷类 示例 编码器 其他工具 迭代器参见 创建虚拟环境 新版功能 源码 模块支持使用自己的站点目录创建轻量级虚拟环境可选择与系统站点目录隔离 每个虚拟环境都有自己的 二进制文件与用于创建此环境的二进制文件的版本相匹配并且可以在其站点目录中拥有自己独立的已安装 软件包集 有关 虚拟环境的更多信息请参阅 参见 打包用户指南创建和使用虚拟环境 创建虚拟环境 一个扩展 的例子 国际化服务 平台支持 模块被设计为可移植的但由于平台的底层架构和功能一些平台存在细微的差异和限制 所有平台 和 不能用来监视文件 的子进程支持 在 上默认的事件循环 支持子进程而 则不支持 也不支持 函数 有不同的机制来监视子进程 完整支持流行的 版本 在 和 上默认的事件循环使用 在这些版本上它并不支持字符设备 可以手工配置 来使用 或 以在这些较老版本的 上支持字符设备 例如 顶层脚本环境 通用操作系统服务 程序框架 本章中描述的模块是很大程度上决定程序结构的框架 目前这里描述的模块都面向编写命令行接口 本章描述的完整模块列表如下 海龟绘图 概述 可用的 和 方法概览 方法 方法 方法和对应函数 海龟动作 获取海龟的状态 度量单位设置 画笔控制 绘图状态 颜色控制 填充 更多绘图控制 海龟状态 可见性 外观 使用事件 特殊海龟方法 复合形状 方法及对应函数 窗口控制 动画控制 使用屏幕事件 输入方法 设置与特殊方法 专有方法 而非继承自 公共类 帮助与配置 如何使用帮助 文档字符串翻译为不同的语言 如何配置 和 演示脚本集 之后的变化 之后的变化 支持面向行的命令解释器 对象 例子 生成临时文件和目录 示例 以下是 模块典型用法的一些示例 已弃用的函数和变量 创建临时文件有一种历史方法首先使用 函数生成一个文件名然后使用该文件名创建文件 不幸的是这是不安全的因为在调用 与随后尝试创建文件的进程之间的时间里其他进程可能会使用该名称创建文件 解决方案是将两个步骤结合起来立即创建文件 这个方案目前被 和上述其他函数所采用 版后已移除 使用 来代替 返回一个绝对路径这个路径指向的文件在调用本方法时不存在 和 参数与 中的同名参数类似不同之处在 于不支持字节类型的文件名不支持 和 警告 使用此功能可能会在程序中引入安全漏洞 当你开始使用本方法返回的文 件执行任何操作时可能有人已经捷足先登了 的功能可以很 轻松地用 代替当然需要传递 参数 的调试器 调试器命令 数据持久化 警告 漏洞 参见 在 版更改 在 版更改 在 版更改 脚注 上下文变量 本模块提供了相关 用于管理 存储和访问上下文相关的状态 类用于声明 上下文变量 并与其一起使用 函数 和类 用于管理当前上下文和异步框架中 在多并发环境中有状态上下文管理器应该使用上下文变量而不是 来防止他们的状态意外泄露到其他代码 更多信息参见 新版功能 上下文变量 手动上下文管理 支持 上下文变量在 中有原生的支持并且无需任何额外配置即可被使用 例如以下是一个简单的回显服务器它使用上下文变量来让远程客户端的地址在处理该客户端的 中可用 并发执行 本章中描述的模块支持并发执行代码 适当的工具选择取决于要执行的任务 密集型或 密集型和偏好的开发风格事件驱动的协作式多任务或抢占式多任务处理 这是一个概述 基于线程的并行 线程本地数据 线程对象 锁对象 递归锁对象 条件对象 信号量对象 例子 事件对象 定时器对象 栅栏对象 在 语句中使用锁 条件和信号量 基于进程的并行 概述 类 上下文和启动方法 在进程之间交换对象 进程间同步 进程间共享状态 使用工作进程 参考 和异常 管道和队列 杂项 连接 对象 同步原语 共享 对象 模块 管理器 自定义管理器 使用远程管理器 代理对象 清理 进程池 监听器及客户端 地址格式 认证密码 日志 模块 编程指导 所有 方法 和 启动方式 示例 可从进程直接访问的共享内存 包 启动并行任务 对象 例子 例子 对象 模块函数 类 子进程管理 使用 模块 常用参数 构造函数 异常 安全考量 对象 助手 常数 较旧的高阶 使用 模块替换旧函数 替代 命令替换 替代 管道 替代 替代 函数族 替代 来自 模块的替代函数 旧式的 发起函数 注释 在 上将参数列表转换为一个字符串 事件调度器 调度器对象 一个同步的队列类 对象 对象以下是上述某些服务的支持模块 底层多线程 数字的抽象基类 源代码 模块 定义了数字 抽象基类 的层次结构其中逐级定义了更多操作 此模块中所定义的类型都不可被实例化 数字的层次结构的基础 如果你只想确认参数 是不是数字而不关心其类 型则使用 数字的层次 内置在类型 里的子类描述了复数和它的运算操作 这些操作有 转化至 和 和 所有的异常 和 都是抽象的 抽象的 得到该数字的实数部分 抽象的 得到该数字的虚数部分 抽象的 返回共轭复数 例如 相对于 加入了只有实数才能进行的操作 简单的说它们是转化至 和 实数同样默认支持 和 子类型 并加入 和 两种属性这两种 属性应该属于最低的级别 加入后这默认支持 摘要 摘要 子类型 加上转化至 默认支持 和 在 中加入抽象方法和比特字符串的 操作 类型接口注释 实现者需要注意使相等的数字相等并拥有同样的值 当这两个数使用不同的扩展模块时这其中的差异是很微妙的 例如用 实现 如下 加入更多数字的 当然这里有更多支持数字的 如果不加入这些就将缺少层次感 你可以用如下方法在 和 中加入 实现算数运算 我们希望实现计算因此混合模式操作要么调用一个作者知道参数类型的实现要么转变成为最接近的内置类型并对这个执行操作 对于子类 这意味着 和 必须用如下方式定义 如果 被定义成一个承认 的 一切都没有问题 如果 转回成模板失败它将返回一个属于 的值我 们需要避免 定义了一个更加智能的 因此模板需要返 回一个属于 的 或者 可能完全 不实现 接着看 的 如果它承认 一切都没有问题 如果没有成功回退到模板就没有更多的方法可以去尝试因此这里将使 用默认的实现 如果 在 之前尝试 这是可行的是通过对 的认识实现的因此这可以在交给 处理之前处理这些实例 如果 和 没有共享任何资源那么适当的共享操作涉及内置的 并且分别获得 因此 由于对任何一直类型的大部分操作是十分相似的可以定义一个帮助函数即一个生成后续或相反的实例的生成器 例如使用 如下 检验 关键字 源码 此模块允许 程序确定某个字符串是否为 关键字 如果 是一个 关键字 则返回 包含解释器定义的所有 关键字 的序列 如果所定义的任何关键字仅在特定 语句生效时被激活它们也将被包含在内 如果 是一个 的软 关键字 则返回 新版功能 包含解释器定义的所有软 关键字 的序列 如果所定义的任何软关键字仅在 特定 语句生效时被激活它们也将被包含在内 新版功能 与 兼容的压缩 生成安全随机数字用于管理密码 新版功能 源代码 模块可用于生成高加密强度的随机数适应管理密码 账户验证 安全凭据和相关机密数据管理的需要 特别地应当优先使用 来替代 模块中的默认伪随机数生成器后者被设计用于建模和仿真而不适用于安全和加密 参见 随机数 通过 模块可以访问你的操作系统所能提供的最安全的随机性来源 使用操作系统所提供的最高质量源来生成随机数的类 请参阅 了解更多细节 返回从一个非空序列中随机选取的元素 返回一个 范围之内的随机整数 返回一个具有 个随机比特位的整数 生成凭据 模块提供了一些生成安全凭据的函数适用于诸如密码重置 难以猜测的 之类的应用场景 返回一个包含 个字节的随机字节串 如果 为 或未提供则会使用一个合理的默认值 返回一个十六进制数码形式的随机字符串 字符串具有 个随机字 节每个字节转换为两个十六进制数码 如果 为 或未提 供则会使用一个合理的默认值 返回一个 安全的随机字符串包含 个随机字节 文本将使 用 编码因此平均来说每个字节将对应 个结果字符 如果 为 或未提供则会使用一个合理的默认值 凭据应当使用多少个字节 为了在面对 暴力攻击 时保证安全凭据必须具有足够的随机性 不幸的是对随机性是否足够的标准会随着计算机越来越强大并能够在更短时间内进行更多猜测而不断提高 在 年时人们认为 字节 位的随机性对于 模块所适合的典型用例来说是足够的 作为想要自行管理凭据长度的用户你可以通过为各种 函数指定一个 参数来显式地指定凭据要使用多大的随机性 该参数以字节数来表示要使用的随机性大小 在其他情况下如果未提供参数或者如果参数为 则 函数将改用一个合理的默认值 注解 该默认值可能在任何时候被改变包括在维护版本更新的时候 其他功能 如果字符串 与 相等则返回 否则返回 该处理方 式可降低 定时攻击 的风险 请参阅 了解更多 细节 应用技巧与最佳实践 本节展示了一些使用 来管理基本安全级别的应用技巧和最佳实践 生成长度为八个字符的字母数字密码 注解 应用程序不能 以可恢复的格式存储密码无论是用纯文本还是加密 它们应 当使用高加密强度的单向不可恢复哈希函数来加盐并生成哈希值 生成长度为十个字符的字母数字密码其中包含至少一个小写字母至少一个大写字母以及至少三个数字 生成 风格的密码串 生成难以猜测的临时 其中包含适合密码恢复应用的安全凭据 同步原语 源代码 同步原语被设计为与 模块的类似但有两个关键注意事项 原语不是线程安全的因此它们不应被用于 线程同步 而应当使 用 这些同步原语的方法不接受 参数请使用 函数来执行带有超时的操作 具有下列基本同步原语 实现一个用于 任务的互斥锁 非线程安全 锁可被用来保证对共享资源的独占访问 使用 的推荐方式是通过 语句 这等价于 形参 获取锁 此方法会等待直至锁为 将其设为 并返回 当有一个以上的协程在 中被阻塞则会等待解锁最终只有 一个协程会被执行 锁的获取是 公平的 被执行的协程将是第一个开始等待锁的协程 释放锁 当锁为 时将其设为 并返回 如果锁为 则会引发 如果锁为 则返回 事件对象 该对象不是线程安全的 事件可被用来通知多个 任务已经有事件发生 对象会管理一个内部旗标可通过 方法将其设为 并 通过 方法将其设为 方法会阻塞直至该旗标 被设为 该旗标初始时将被设为 形参 示例 等待直至事件被设置 如果事件已被设置则立即返回 否则将阻塞直至另一个事件调 用 设置事件 所有等待事件被设置的任务将被立即唤醒 清空取消设置事件 通过 进行等待的任务现在将会阻塞直至 方法再次被 调用 如果事件已被设置则返回 条件对象 该对象不是线程安全的 条件原语可被任务用于等待某个事件发生然后获取对共享资源的 独占访问 在本质上 对象合并了 和 的功能 多个 对象有可能共享一个 这允许关注于共享资源的特定状态的 不同任务实现对共享资源的协同独占访问 可选的 参数必须为 对象或 在后一种情况下会自 动创建一个新的 对象 形参 使用 的推荐方式是通过 语句 这等价于 获取下层的锁 此方法会等待直至下层的锁为 将其设为 并返回 唤醒最多 个正在等待此条件的任务默认为 个 如果没有任 务正在等待则此方法为空操作 锁必须在此方法被调用前被获取并在随后被快速释放 如果通过一个 锁调用则会引发 如果下层的锁已被获取则返回 唤醒所有正在等待此条件的任务 此方法的行为类似于 但会唤醒所有正在等待的任务 锁必须在此方法被调用前被获取并在随后被快速释放 如果通过一个 锁调用则会引发 释放下层的锁 当在未锁定的锁上发起调用时会引发 等待直至收到通知 当此方法被调用时如果调用方任务未获得锁则会引发 这个方法会释放下层的锁然后保持阻塞直到被 或 调用所唤醒 一旦被唤醒 会重新获取它的 锁并且此方法将返回 等待直到目标值变为 目标必须为一个可调用对象其结果将被解读为一个布尔值 最终的值 将为返回值 绑定的信号量对象 该对象不是线程安全的 是特殊版本的 如果在 中内 部计数器值增加到初始 以上它将引发一个 形参 在 版更改 使用 或 以及或者 语句 来获取锁的操作已被移除 请改用 软件打包和分发 已缓存字节码的失效 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 接受一个 类路径对象 在 版更改 在 版更改 在 版更改 在 版更改 新版功能 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 参见 模块 文件及目录的比较 源代码 模块定义了用于比较文件及目录的函数并且可以选取多种关于时间和准确性的折衷方案 对于文件的比较另见 模块 模块定义了如下函数 比较名为 和 的文件如果它们似乎相等则返回 否则 返回 如果 为真那么具有相同 签名的文件将会被认为 是相等的 否则将比较文件的内容 需要注意没有外部程序被该函数调用这赋予了该函数可移植性与效率 该函数会缓存过去的比较及其结果且在文件的 信息变化后缓 存条目失效 所有的缓存可以通过 清除 比较在两个目录 和 中由 所确定名称的文件 返回三组文件名列表 含有 相匹配的文件 含有那些不匹配的然后 列出那些 未被比较文件的名称 如果文件不存在于两目录中的任一个或者用户缺少 读取它们的权限又或者因为其他的一些原因而无法比较那么这些文件将 会被列在 中 参数 具有同 一致的含义与默认值 例如 将会比较 与 以及 与 和 将会各自出现在返回的三 个列表里的某一个列表中 清除 缓存 如果一个文件过快地修改以至于超过底层文件系统记 录修改时间的精度那么该函数可能有助于比较该类文件 新版功能 类 创建一个用于比较目录 和 的新的目录比较对象 是需 要忽略的文件名列表且默认为 是需要隐藏的文件名列表且默认为 类如 中所描述的那样对文件进行 比 较 类提供以下方法 将 与 之间的比较打印到 打印 与 及共同直接子目录的比较结果 打印 与 及共同子目录比较结果递归地 类提供了一些有趣的属性用以得到关于参与比较的目录树的各种 信息 需要注意通过 钩子所有的属性将会惰性求值因此 如果只使用那些计算简便的属性将不会有速度损失 目录 目录 经 和 过滤目录 中的文件与子目录 经 和 过滤目录 中的文件与子目录 同时存在于目录 和 中的文件和子目录 仅在目录 中的文件和子目录 仅在目录 中的文件和子目录 同时存在于目录 和 中的子目录 同时存在于目录 和 中的文件 在目录 和 中类型不同的名字或者那些 报告错 误的名字 在目录 和 中使用类的文件比较操作符相等的文件 在目录 和 中根据类的文件比较操作符判定内容不等的文件 在目录 和 中无法比较的文件 一个将 中名称映射为 对象的字典 新版功能 默认被 忽略的目录列表 下面是一个简单的例子使用 属性递归搜索两个目录以显示公共差异文件 推测声音文件的类型 伪终端工具 源代码 模块定义了一些处理伪终端概念的操作启动另一个进程并能以程序方式在其控制终端中进行读写 由于伪终端处理高度依赖于具体平台因此此功能只有针对 的代码 代码也可在其他平台上工作但是未经测试 模块定义了下列函数 分叉 将子进程的控制终端连接到一个伪终端 返回值为 请注意子进程获得 而 为 父进程返回值为子进 程的 而 为一个连接到子进程的控制终端并同时连接到子进程 的标准输入和输出的文件描述符 打开一个新的伪终端对如果可能将使用 或是针对通用 系统的模拟代码 返回一个文件描述符对 分别 表示主从两端 生成一个进程并将其控制终端连接到当前进程的标准 这常被用来应 对坚持要从控制终端读取数据的程序 在 背后生成的进程预期最后将 被终止而且当它被终止时 将会返回 会向 和 函数传入一个文件描述符供它们读取 并且它们总是应当返回一个字节串 为了强制 在子进程退出之前 返回所以应当抛出 两个函数的默认实现在每次函数被调用时将读取并返回至多 个字节 会向 回调传入伪终端的主文件描述符以从子进程读取输出 而向 传入文件描述符 以从父进程的标准输入读取数据 从两个回调返回空字节串会被解读为文件结束 条件在此之后回调将 不再被调用 如果 发出 信号则控制终端就不能再与父 进程或子进程进行通信 除非子进程将不带任何输入就退出否则随后 将一直循环下去 如果 发出 信号则会有相同 的行为结果至少是在 上 如果两个回调都发出 信号则 可能将永不返回除非在你的平 台上当传入三个空列表时 会抛出一个错误 这是一个程序缺陷 相关文档见 问题 从子进程中的 返回退出状态值 可以使用 来将退出状态转换为退出码 引发一个 审计事件 附带参数 在 版更改 现在会从子进程的 返回状态值 示例 工具集 源代码 模块包含一些在创建 应用程序时十分有用的类和函数它们可以被直接使用或者是作为基类使用 对数据字符串中的 和 进行转义 你可以通过传入一个字典作为可选的 形参来对其他字符串数据 进行转义 字典的键和值必须为字符串每个键将被替换为其所对应的值 字符 和 总是会被转义即使提供了 对字符串数据中的 和 进行反转义 你可以通过传入一个字典作为可选的 形参来对其他数据字符串 进行转义 字典的键和值必须都为字符串每个键将被替换为所对应的值 和 将总是保持不被转义即使提供了 类似于 但还会对 进行处理以将其用作属性值 返回 值是 加上任何额外要求的替换的带引号版本 将基 于 的内容选择一个引号字符以尽量避免在字符串中编码任何引号 字符 如果单双引号字符在 中都存在则双引号字符将被编码并且 将使用双引号来标记 结果字符串可被直接用作属性值 此函数适用于为 或任何使用引用实体语法的 生成属性值 这个类通过将 事件写回到 文档来实现 接口 换句话说使用 作为内容处理程序将重新产生所解析的原 始文档 应当为一个文件类对象它默认将为 为输出流的编码格式它默认将为 控制不包含内容的元素的格式化如为 默认值 则它们会以开始结束标记对的形式被发送如果设为 则它 们会以单个自结束标记的形式被发送 新版功能 形参 这个类被设计用来分隔 和客户端应用的事件处理程序 在默 认情况下它除了将请求传送给读取器并将事件传送给处理程序之外什么都 不做但其子类可以重载特定的方法以在传送它们的时候修改事件流或配置 请求 此函数接受一个输入源和一个可选的基准 并返回一个经过完整解析可供 读取的 输入源的给出形式可以为字符串 文件类对象或 对象解析器将使用此函数来针对它们的 方法实 现多态 参数 数学函数 该模块提供了对 标准定义的数学函数的访问 这些函数不适用于复数如果你需要计算复数请使用 模块中的同名函数 将支持计算复数的函数区分开的目的来自于大多数开发者并不愿意像数学家一样需要学习复数的概念 得到一个异常而不是一个复数结果使得开发者能够更早地监测到传递给这些函数的参数中包含复数进而调查其产生的原因 该模块提供了以下函数 除非另有明确说明否则所有返回值均为浮点数 数论与表示函数 返回 的上限即大于或者等于 的最小整数 如果 不是一个浮 点数则委托 返回一个 类的值 返回不重复且无顺序地从 项中选择 项的方式总数 当 时取值为 当 时取值为零 也称为二项式系数因为它等价于表达式 的多项式展开中 第 项的系数 如果任一参数不为整数则会引发 如果任一参数为负数则会引 发 新版功能 返回一个基于 的绝对值和 的符号的浮点数 在支持带符号零的平 台上 返回 返回 的绝对值 以一个整数返回 的阶乘 如果 不是整数或为负数时则将引发 版后已移除 接受具有整数值的浮点数 例如 的行为已被弃用 返回 的向下取整小于或等于 的最大整数 如果 不是浮点数 则委托 它应返回 值 返回 由平台 库定义 请注意 表达式 可 能不会返回相同的结果 标准的目的是 完全数学上到无 限精度等于 对于某个整数 使得结果具有 与 相同 的符号和小于 的幅度 的 返回带有 符号的 结果并且可能不能完全计算浮点参数 例如 是 但 的 的结果是 它不能完全表示为浮点数并且取整为令人惊讶的 出于这个 原因函数 在使用浮点数时通常是首选而 的 在 使用整数时是首选 返回 的尾数和指数作为对 是一个浮点数 是一 个整数正好是 如果 为零则返回 否则返回 这用于以可移植方式分离浮点数的内 部表示 返回迭代中的精确浮点值 通过跟踪多个中间部分和来避免精度损失 该算法的准确性取决于 算术保证和舍入模式为半偶的典型情况 在 某些非 版本中底层 库使用扩展精度添加并且有时可能会使中间 和加倍导致它在最低有效位中关闭 有关待进一步讨论和两种替代方法参见 返回给定的整数参数的最大公约数 如果有一个参数非零则返回值将是能 同时整除所有参数的最大正整数 如果所有参数为零则返回值为 不带参数的 返回 新版功能 在 版更改 添加了对任意数量的参数的支持 之前的版本只支持两个 参数 若 和 的值比较接近则返回 否则返回 根据给定的绝对和相对容差确定两个值是否被认为是接近的 是相对容差 它是 和 之间允许的最大差值相对于 或 的较大绝对值 例如要设置 的容差请传递 默认容差为 确保两个值在大约 位十进制数字 内相同 必须大于零 是最小绝对容差 对于接近零的比较很有用 必须 至少为零 如果没有错误发生结果将是 特殊值 和 将根据 规则处理 具体来 说 不被认为接近任何其他值包括 和 只 被认为接近自己 新版功能 参见 用于测试近似相等的函数 如果 既不是无穷大也不是 则返回 否则返回 注意 被认为 是 有限的 新版功能 如果 是正或负无穷大则返回 否则返回 如果 是 不是数字则返回 否则返回 返回非负整数 的整数平方根 这就是对 的实际平方根向下取整 或者相当于使得 的最大整数 对于某些应用来说可以更适合取值为使得 的最小整数 或者换句话说就是 的实际平方根向上取整 对于正数 这可以使 用 来计算 新版功能 返回给定的整数参数的最小公倍数 如果所有参数均非零则返回值将是为 所有参数的整数倍的最小正整数 如果参数之一为零则返回值为 不带参数的 返回 新版功能 返回 这基本上是函数 的反函数 返回 的小数和整数部分 两个结果都带有 的符号并且是浮点数 返回 趋向于 的最接近的浮点数值 如果 等于 则返回 示例 的方向朝上趋向于正无穷 的方向朝下趋向于负无穷 趋向于零 趋向于零的反方向 另请参阅 新版功能 返回不重复且有顺序地从 项中选择 项的方式总数 当 时取值为 当 时取值为零 如果 未指定或为 则 默认值为 并且函数将返回 如果任一参数不为整数则会引发 如果任一参数为负数则会引 发 新版功能 计算输入的 中所有元素的积 积的默认 值为 当可迭代对象为空时返回起始值 此函数特别针对数字值使用并会拒绝 非数字类型 新版功能 返回 风格的 相对于 的余数 对于有限 和有限非零 这是差异 其中 是与商 的精确值最接近的 整数 如果 恰好位于两个连续整数之间则最近的 整数 用于 余数 因此总是满足 特殊情况遵循 特别是 对于任何有限 都是 而 和 引 发 适用于任何非 的 如果余数运算的结果为零则 该零将具有与 相同的符号 在使用 二进制浮点的平台上此操作的结果始终可以完全表示不 会引入舍入错误 新版功能 返回 值 截断为 通常是整数 委托给 返回浮点数 的最小有效比特位的值 如果 是 非数字则返回 如果 为负数则返回 如果 为正数则返回 如果 等于则返回 去正规化的 可表示最小正浮点数 小于 正规 化的 最小正浮点数 如果 等于可表示最大正浮点数则返回 的最低有效比特位的值 使得小于 的第一个浮点数为 在其他情况下 是一个有限的正数则返回 的最低有效比特位 的值使得大于 的第一个浮点数为 即 的缩写 另请参阅 和 新版功能 注意 和 具有与它们的 等价函数不同的调用返回模式它们采用单个参数并返回一对值而不是通过 输出形参 返回它们的第二个返回参数 中没有这样的东西 对于 和 函数请注意 所有 足够大的浮点数都是精确整数 浮点数通常不超过 位的精度与平台 类型相同在这种情况下任何浮点 与 必然没有小数位 幂函数与对数函数 返回 次 幂其中 是自然对数的基数 这通常 比 或 更精确 返回 的 次幂减 这里 是自然对数的基数 对于小浮点数 中的减法可能导致 函数提供了一种将此数量计算为全精度的方法 新版功能 使用一个参数返回 的自然对数底为 使用两个参数返回给定的 的对数 计算为 返回 的自然对数 以对于接近零的 精确的方式计算 结果 返回 以 为底的对数 这通常比 更准确 新版功能 参见 返回表示二进制整数所需的位数不包括符号和前导 零 返回 底为 的对数 这通常比 更准确 将返回 的 次幂 特殊情况尽可能遵循 标准的附录 特别是 和 总是返回 即使 是零或 如果 和 都是有限的 是负数 不是整数那么 是未定义的并且引发 与内置的 运算符不同 将其参数转换为 类型 使用 或内置的 函数来计算精确的整数幂 返回 的平方根 三角函数 返回以弧度为单位的 的反余弦值 结果范围在 到 之间 返回以弧度为单位的 的反正弦值 结果范围在 到 之 间 返回以弧度为单位的 的反正切值 结果范围在 到 之 间 以弧度为单位返回 结果是在 和 之间 从原 点到点 的平面矢量使该角度与正 轴成正比 的点的 两个输入的符号都是已知的因此它可以计算角度的正确象限 例如 和 都是 但 是 返回 弧度的余弦值 返回 与 两点之间的欧几里得距离以一个坐标序列或可迭代对 象的形式给出 两个点必须具有相同的维度 大致相当于 新版功能 返回欧几里得范数 这是从原 点到坐标给定点的向量长度 对于一个二维点 这等价于使用毕达哥拉斯定义 计算一个直角三角形的斜边 在 版更改 添加了对 维点的支持 之前的版本只支持二维点 返回 弧度的正弦值 返回 弧度的正切值 角度转换 将角度 从弧度转换为度数 将角度 从度数转换为弧度 双曲函数 双曲函数 是基于双曲线而非圆来对三角函数进行模拟 返回 的反双曲余弦值 返回 的反双曲正弦值 返回 的反双曲正切值 返回 的双曲余弦值 返回 的双曲正弦值 返回 的双曲正切值 特殊函数 返回 处的 函数可用于计算传统的统计函数如 累积标准正态分布 新版功能 返回 处的互补误差函数 互补错误函数 定义为 它 用于 的大值从其中减去一个会导致 有效位数损失 新版功能 返回 处的 伽马函数 值 新版功能 返回 函数在 绝对值的自然对数 新版功能 常数 基本的日期和时间类型 感知型对象和简单型对象 日期和时间对象可以根据它们是否包含时区信息而分为感知型和简单型两类 充分掌握应用性算法和政治性时间调整信息例如时区和夏令时的情况下一个感知型 对象就能相对于其他感知型对象来精确定位自身时间点 感知型对象是用来表示一个没有解释空间的固定时间点 简单型 对象没有包含足够多的信息来无歧义地相对于其他 对象来定位自身时间点 不论一个简单型对象所代表的是世界标准时间 当地时间还是某个其他时区的时间完全取决于具体程序就像一个特定数字所代表的是米 英里还是质量完全取决于具体程序一样 简单型对象更易于理解和使用代价则是忽略了某些现实性考量 对于要求感知型对象的应用 和 对象具有一个可选的时区信息属性 它可被设为抽象类 的子类的一个实例 这些 对象会捕获与 时间的差值 时区名称以及夏令时是否生效等信息 模块只提供了一个具体的 类即 类 类可以表示具有相对于 的固定时差的简单时区例如 本身或北美的 和 时区等 支持时间的详细程度取决于具体的应用 世界各地的时间调整规则往往是政治性多于合理性经常会发生变化除了 之外并没有一个能适合所有应用的标准 常量 或者 对象允许的最小年份 常量 是 或 对象允许最大的年份 常量 是 有效的类型 一个理想化的简单型日期它假设当今的公历在过去和未来永远有效 属性 一个独立于任何特定日期的理想化时间它假设每一天都恰好等于 秒 这里没有闰秒的概念 包含属性 和 日期和时间的结合 属性 表示两个 对象或者 对象或者 对象之间的时间 间隔精确到微秒 一个描述时区信息对象的抽象基类 用来给 和 类提供 自定义的时间调整概念例如处理时区和或夏令时 一个实现了 抽象基类的子类用于表示相对于 世界标准时间 的偏移量 新版功能 这些类型的对象都是不可变的 子类关系 通用的特征属性 和 类型共享这些通用特性 这些类型的对象都是不可变的 这些类型的对象是可哈希的这意味着它们可被作为字典的键 这些类型的对象支持通过 模块进行高效的封存 确定一个对象是感知型还是简单型 类型的对象都是简单型的 或 类型的对象可以是感知型或者简单型 一个 对象 在以下条件同时成立时将是感知型的 不为 不返回 在其他情况下 将是简单型的 一个 对象 在以下条件同时成立时将是感知型的 不为 不返回 在其他情况下 将是简单型的 感知型和简单型之间的区别不适用于 对象 类对象 用法示例 一个标准化的附加示例 算术运算的示例 对象 用法示例 计算距离特定事件天数的例子 使用 的更多例子 对象 用法示例 使用 对象的例子 以下示例定义了一个 子类它捕获 时区的信息该时区使用 直到 年之后则使用 上述 的用法 对象 用法示例 使用 对象的例子 对象 对象 类是 的子类它的每个实例都代表一个以与 的固定时差来定义的时区 此类的对象不可被用于代表某些特殊地点的时区信息这些地点在一年的不同日期会使用不同的时差或是在历史上对民用时间进行过调整 参数必须指定为一个 对象表示本地时间与 的 时差 它必须严格限制于 和 之间否则会引发 参数是可选的 如果指定则必须为一个字符串它将被用作 方法的返回值 新版功能 在 版更改 时差不再限制为一个整数分钟值 返回当 实例被构造时指定的固定值 参数会被忽略 返回值是一个 实例其值等于本地时间 与 之间的时差 在 版更改 时差不再限制为一个整数分钟值 返回当 实例被构造时指定的固定值 如果没有在构造器中提供 则 所返回的名称将根据 值按以下规则生成 如果 为 则名称 为 否则为字符串 其中 为 的正负符号 和 分别为表示 和 的两个数码 在 版更改 由 生成的名称现在为简单的 而不再是 总是返回 返回 参数必须为一个感知型 实例其 中 值设为 类属性 时区 和 的行为 和 对象都支持 方法可用来创建由一个显式格式字符串所控制的表示时间的字符串 相反地 类会根据表示日期和时间的字符串和相应的格式字符串来创建一个 对象 下表提供了 与 的高层级比较 用法 根据给定的格式将对象转换为字符串 将字符串解析为给定相应格式的 对象 方法类型 实例方法 类方法 方法 签名 和 以下列表显示了 版 标准所要求的全部格式代码它们在带有标准 实现的所有平台上均可用 指令 意义 示例 注释 当地工作日的缩写 本地化的星期中每日的完整名称 以十进制数显示的工作日其中 表 示星期日 表示星期六 补零后以十进制数显示的月份中的 一天 当地月份的缩写 本地化的月份全名 补零后以十进制数显示的月份 补零后以十进制数表示的不带世 纪的年份 十进制数表示的带世纪的年份 以补零后的十进制数表示的小时 小时制 以补零后的十进制数表示的小时 小时制 本地化的 或 补零后以十进制数显示的分钟 补零后以十进制数显示的秒 以十进制数表示的微秒在左侧补零 偏移量格式为 空 如果是简 单型对象则为空字符串 时区名称如果对象为简单型则为空 空 字符串 以补零后的十进制数表示的一年中的 日序号 以补零后的十进制数表示的一年中的 周序号星期日作为每周的第一天 在 新的一年中第一个星期日之前 的所有日子都被视为是在第 周 以十进制数表示的一年中的周序号 星期一作为每周的第一天 在新 的一年 中第一个第期一之前的所有 日子都被视为是在第 周 本地化的适当日期和时间表示 本地化的适当日期表示 本地化的适当时间表示 字面的 字符 为了方便起见还包括了 标准不需要的其他一些指令 这些参数都对应于 日期值 指令 意义 示例 注释 带有世纪的 年份表示包 含大部分 星期 的年份 以十进制数显示的 星期中 的日序号其中 表示星期一 以十进制数显示的 星期 以星期一作为每周的第一天 第 周为 包含 月 日的星期 这些代码可能不是在所有平台上都可与 方法配合使用 年份和 星期指令并不能与上面的年份和星期序号指令相互替代 调用 时传入不完整或有歧义的 指令将引发 对完整格式代码集的支持在不同平台上有所差异因为 要调用所在平台的 库的 函数而不同平台的差异是很常见的 要查看你所用平台所支持的完整格式代码集请参阅 文档 新版功能 增加了 和 技术细节 抽象语法树 源代码 模块帮助 程序处理 语法的抽象语法树 抽象语法或许会随着 的更新发布而改变该模块能够帮助理解当前语法在编程层面的样貌 抽象语法树可通过将 作为旗标传递给 内置函数来生成或是使用此模块中提供的 辅助函数 返回结果将是一个对象树其中的类都继承自 抽象语法树可被内置的 函数编译为一个 代码对象 抽象文法 抽象文法目前定义如下 节点类 字面值 表达式 注解 中的辅助函数 新版功能 新版功能 新版功能 参见 数据压缩和存档 本章中描述的模块支持 和 数据压缩算法以及创建 和 格式的归档文件 参见由 模块提供的 归档操作 与 兼容的压缩 对 格式的支持 用法示例 命令行界面 命令行选项 对 压缩算法的支持 文件压缩和解压 增量压缩和解压 一次性压缩或解压缩 用法示例 用 算法压缩 读写压缩文件 在内存中压缩和解压缩数据 杂项 指定自定义的过滤器链 示例 使用 存档 对象 对象 对象 对象 命令行界面 命令行选项 解压缩的障碍 由于文件本身 文件系统限制 资源限制 中断 提取的默认行为 读写 归档文件 对象 对象 命令行界面 命令行选项 示例 受支持的 格式 问题 状态管理 源代码 在 版更改 注解 参见 对象 对象 在 版更改 在 版更改 在 版更改 的值 在 版更改 在 版更改 示例 对象 在 版更改 在 版更改 对象 对象 对象 风格的命令行选项解析器 内置函数 高效的数值数组 此模块定义了一种对象类型可以紧凑地表示基本类型值的数组字符 整数 浮点数等 数组属于序列类型其行为与列表非常相似不同之处在于其中存储的对象类型是受限的 类型在对象创建时使用单个字符的 类型码 来指定 已定义的类型码如下 类型码 类型 类型 以字节表示的最小尺寸 注释 字符 注释 由于平台的不同它可能为 位或 位 在 版更改 现在使用 作为 类型而不再是 已弃用的 这个改变不会影响其行为因为 自 起就是 的别名 值的实际表示会由机器的架构决定严格地说是由 实现决定 实际大小可通过 属性来获取 这个模块定义了以下类型 一个包含由 限制类型的条目的新数组并由可选的 值进行初始化该值必须为一个列表 或包含正确类型元素的可迭代对象 如果给定一个列表或字符串该 会被传给新数组的 或 方法见下文以将初 始条目添加到数组中 否则会将可迭代对象作为 传给 方法 引发一个 审计事件 附带参数 包含所有可用类型码的字符串 数组对象支持普通的序列操作如索引 切片 拼接和重复等 当使用切片赋值时所赋的值必须为具有相同类型码的数组对象所有其他情况都将引发 数组对象也实现了缓冲区接口可以用于所有支持 字节类对象 的场合 以下数据项和方法也受到支持 用于创建数组的类型码字符 在内部表示中一个数组项的字节长度 添加一个值为 的新项到数组末尾 返回一个元组 以给出用于存放数组内容的缓冲区元素 的当前内存地址和长度 以字节表示的内存缓冲区大小可通过 来计算 这在使用需要内存 地址的低层级因此不够安全 接口时会很有用例如某些 操作 只要数组存在并且没有应用改变长度的操作返回数值就是有效的 注解 当在 或 编写的代码中使用数组对象时这是有效使用此类信息的 唯一方式使用数组对象所支持的缓冲区接口更为适宜 此方法仅保留 用作向下兼容应避免在新代码中使用 缓冲区接口的文档参见 缓冲协 议 字节对调所有数组项 此方法只支持大小为 或 字节的值对 于其他值类型将引发 它适用于从不同字节序机器所生成 的文件中读取数据的情况 返回 在数组中的出现次数 将来自 的项添加到数组末尾 如果 是另一个数组 它必须具有 完全 相同的类型码否则将引发 如果 不是一个数组则它必须为可迭代对象并且其元素必须为可添加 到数组的适当类型 添加来自字符串的项将字符串解读为机器值的数组相当于使用 方法从文件中读取数据 新版功能 重命名为 以使其含义更清 晰 从 中读取 项解读为机器值并将它们添加到数 组末尾 如果可读取数据少于 项则将引发 但有效的项仍 然会被插入数组 必须为一个真实的内置文件对象不支持带有 方法的其它对象 添加来自 的项 这等价于 区别在 于如果发生类型错误数组将不会被改变 使用来自给定 字符串的数组扩展数组 数组必须是类型为 的数组否则将引发 请使用 来将 数据添加 到其他类型的数组 返回最小的 使得 为 在数组中首次出现的序号 将值 作为新项插入数组的 位置之前 负值将被视为相对于数组末 尾的位置 从数组中移除序号为 的项并将其返回 可选参数值默认为 因此 默认将移除并返回末尾项 从数组中移除首次出现的 反转数组中各项的顺序 将数组转换为一个机器值数组并返回其字节表示即相当与通过 方法写入到文件的字节序列 新版功能 被重命名为 以使其含义更清晰 将所有项作为机器值写入到 将数组转换为包含相同项的普通列表 将数组转换为一个 字符串 数组必须是类型为 的数组否 则将引发 请使用 来从其 他类型的数组生成 字符串 当一个数组对象被打印或转换为字符串时它会表示为 如果数组为空则 会被省略否则如果 为 则它是一个字符串否则它是一个数字列表 使用 保证能将字符串转换回具有相同类型和值的数组只要 类已通过 被引入 例如 参见 模块 打包和解包异构二进制数据 模块 打包和解包用于某些远程过程调用系统的 数据 文档 扩展 定义了另一种数组类型请访问 了解有关 的更多信息 警告 漏洞 在 版更改 在 版更改 在 版更改 警告 警告 在 版更改 示例 在 版更改 注解 概述 可用 备注 审计事件表 下表包含了在整个 运行时和标准库中由 或 调用引发的所有事件 这些调用是在 或更高版本中添加的 请参阅 和 了解有关处理这些事件的详细信息 此表是根据 文档生成的可能无法表示其他实现所引发的事件 请参阅你的运行时专属的文档了解实际引发的事件 下列事件只在内部被引发而不会回应任何 公共 审计事件 实参 内部 对象序列化 国际化 本章中介绍的模块通过提供选择要在程序信息中使用的语言的机制或通过定制输出以匹配本地约定来帮助你编写不依赖于语言和区域设置的软件 本章中描述的模块列表是 多语种国际化服务 基于类的 致谢 国际化服务 对话框 标准 输入对话框 源码 以上三个函数提供给用户输入期望值的类型的对话框 自定义对话框的基类 加入 和 按钮的默认行为 重写自定义按钮布局 文件选择对话框 源码 原生 加载保存 对话框 对话窗口模板 源码 渲染对话窗口 参见 读写文件 浅层 和深层 复制操作 在 版更改 在 版更改 可用性 新版功能 处理流的核心工具 源代码 概述 模块提供了 用于处理各种 类型的主要工具 三种主要的 类型分别为 文本 二进制 和 原始 这些是泛型类型有很多种后端存储可以用在他们上面 一个隶属于任何这些类型的具体对象被称作 其他同类的术语还有 流 和 类文件对象 独立于其类别每个具体流对象也将具有各种功能它可以是只读只写或读写 它还可以允许任意随机访问向前或向后寻找任何位置或仅允许顺序访问例如在套接字或管道的情况下 所有流对提供给它们的数据类型都很敏感 例如将 对象给二进制流的 方法会引发 将 对象提供给文本流的 方法也是如此 在 版更改 由于 现在是 的别名因此用于引发 的操作现在会引发 文本 文本 预期并生成 对象 这意味着无论何时后台存储是由字节组成的例如在文件的情况下数据的编码和解码都是透明的并且可以选择转换特定于平台的换行符 创建文本流的最简单方法是使用 可以选择指定编码 内存中文本流也可以作为 对象使用 的文档中详细描述了文本流的 二进制 原始 高阶模块接口 内存中的流 也可以使用 或 作为文件进行读取和写入 对于字符串 可以像在文本模式下打开的文件一样使用 可以像以二进制模式打开的文件一样使用 两者都提供完整的随机读写功能 参见 包含标准 流 和 类的层次结构 流被安排为按类的层次结构实现 首先是 抽象基类 用于指定流的各种类别然后是提供标准流实现的具体类 注解 抽象基类还提供某些方法的默认实现以帮助实现具体的流类 例如 提供了 和 的未优化实现 层次结构的顶部是抽象基类 它定义了流的基本接口 但是请注意对流的读取和写入之间没有分离 如果实现不支持指定的操作则会引发 抽象基类 是 的子类 它负责将字节读取和写入流中 的子类 提供计算机文件系统中文件的接口 抽象基类 继承了 处理原始二进制流 上的缓冲 其子类 和 分别缓冲可读 可写以及可读写的原始二进制流 提供了带缓冲的可随机访问流接口 的另一个子类 是内存中字节流 抽象基类 继承了 它处理可表示文本的流并处理字符串的编码和解码 类 继承了 是原始缓冲流 的缓冲文本接口 最后 是文本的内存流 参数名不是规范的一部分只有 的参数才用作关键字参数 下表总结了抽象基类提供的 模块 抽象基类 继承 抽象方法 方法和属性 和 和 和 继承 方法 和 继承 方法 和 和 继承 方法 和 和 基类 原始文件 代表一个包含字节数据的 层级文件的原始二进制流 它继承自 可以是以下两项之一 代表将被打开的文件路径的字符串或 对象 在此情况下 必须为 默认值 否则将会引发异常 代表一个现有 层级文件描述符的号码的整数作为结果的 对象将可访问该文件 当 对象被关闭时此 也将被关闭除非 设为 可以为 或 分别表示读取默认模式 写入 独占新建或添加 如果以写入或添加模式打开的文件不存在将自动 新建当以写入模式打开时文件将先清空 以新建模式打开时如果文件已存 在则将引发 以新建模式打开文件也意味着要写入因 此该模式的行为与 类似 在模式中附带 将允许同时读取和写 入 该类的 当附带正值参数调用时 和 方法将只执行一次系统调用 可以通过传入一个可调用对象作为 来使用自定义文件打开器 然 后通过调用 并传入 来获取文件对象所对应的 下层文件描述符 必须返回一个打开文件描述符传入 作为 的结果在功能上将与传入 类似 新创建的文件是 不可继承的 有关 参数的示例请参见内置函数 在 版更改 增加了 参数 增加了 模式 在 版更改 文件现在禁止继承 在继承自 和 的现有成员以外还提供了以 下数据属性和方法 构造函数中给定的模式 文件名 当构造函数中没有给定名称时这是文件的文件描述符 缓冲流 相比原始 缓冲 流提供了针对 设备的更高层级接口 一个使用内在字节缓冲区的二进制流 它继承自 在 方法被调用时将会丢弃缓冲区 可选参数 是一个包含初始数据的 在继承自 和 的成员以外还提供或 重载了下列方法 返回一个对应于缓冲区内容的可读写视图而不必拷贝其数据 此外改 变视图将透明地更新缓冲区内容 注解 只要视图保持存在 对象就无法被改变大小或关闭 新版功能 返回包含整个缓冲区内容的 在 中这与 相同 在 版更改 参数现在是可选的 在 中这与 相同 新版功能 一个提供对可读 不可查找的 原始二进制流的高层级访问的缓 冲二进制流 它继承自 当从此对象读取数据时可能会从下层原始流请求更大量的数据并存放到 内部缓冲区中 接下来可以在后续读取时直接返回缓冲数据 根据给定的可读 流和 创建 的构 造器 如果省略 则会使用 在继承自 和 的成员以外还 提供或重载了下列方法 从流返回字节数据而不前移位置 完成此调用将至多读取一次原始流 返回的字节数量可能少于或多于请求的数量 读取并返回 个字节如果 未给定或为负值则读取至 或是在非阻塞模式下读取调用将会阻塞 在原始流上通过单次调用读取并返回至多 个字节 如果至少缓 冲了一个字节则只返回缓冲的字节 在其他情况下将执行一次原始 流读取 在 版更改 参数现在是可选的 一个提供对可写 不可查找的 原始二进制流的高层级访问的缓 冲二进制流 它继承自 当写入到此对象时数据通常会被放入到内部缓冲区中 缓冲区将在满足某 些条件的情况下被写到下层的 对象包括 当缓冲区对于所有挂起数据而言太小时 当 被调用时 当为 对象请求 时 当 对象被关闭或销毁时 该构造器会为给定的可写 流创建一个 如果未给 定 则使用默认的 在继承自 和 的成员以外还 提供或重载了下列方法 将缓冲区中保存的字节数据强制放入原始流 如果原始流发生阻塞则应 当引发 写入 并返回写入的字节数 当处于非阻塞模 式时如果缓冲区需要被写入但原始流发生阻塞则将引发 一个提供对不可查找的 原始二进制流的高层级访问的缓冲二进 制流 它继承自 和 该构造器会为在第一个参数中给定的可查找原始流创建一个读取器和定稿器 如果省略 则使用默认的 能做到 或 所能做 的任何事 此外还会确保实现 和 一个提供对两个不可查找的 原始二进制流的高层级访问的缓冲 二进制流 一个可读另一个可写 它继承自 和 分别是可读和可写的 对象 如果省略 则使用默认的 实现了 的所有方法但 除外调用该方法将引发 警告 不会尝试同步访问其下层的原始流 你不应当将传给 它与读取器和写入器相同的对象而要改用 文本 性能 本节讨论所提供的具体 实现的性能 二进制 文本 二进制存储如文件上的文本 比同一存储上的二进制 慢得多因为它需要使用字符编解码器在 和二进制数据之间进行转换 这在处理大量文本数据如大型日志文件时会变得非常明显 此外由于使用的重构算法 和 都相当慢 是原生的内存 容器速度与 相似 多线程 对象是线程安全的只要它们封装的操作系统调用比如 下的 也是线程安全的 二进制缓冲对象例如 和 使用锁来保护其内部结构因此可以安全地一次从多个线程中调用它们 对象不再是线程安全的 可重入性 二进制缓冲对象 和 的实例不是可重入的 虽然在正常情况下不会发生可重入调用但仍可能会在 处理程序执行 时产生 如果线程尝试重入已经访问的缓冲对象则会引发 注意这并不禁止其他线程进入缓冲对象 上面的内容隐式地扩展到文本文件中因为 函数将把缓冲对象封装在 中 这包括标准流因而也会影响内置的 函数 数据库 接口模块 模块函数和常量 连接对象 对象 行对象 异常 与 类型 概述 原生支持如下的类型 因此可以将以下 类型发送到 而不会出现任何问题 类型 类型 这是 类型默认转换为 类型的方式 类型 类型 取决于 默认为 模块的类型系统可通过两种方式来扩展你可以通过对象适配将额外的 类型保存在 数据库中你也可以让 模块通过转换器将 类型转换为不同的 类型 使用适配器将额外的 类型保存在 数据库中 如上文所述 只包含对有限类型集的原生支持 要让 能使用其他 类型你必须将它们 适配 至 模块所支持的 类型中的一种 有两种方式能让 模块将某个定制的 类型适配为受支持的类型 让对象自行适配如果类是你自己编写的这将是一个很好的方式 假设你有这样一个类 现在你可将这种点对象保存在一个 列中 首先你必须选择一种受支持的类型用来表示点对象 让我们就用 并使用一个分号来分隔坐标值 然后你需要给你的类加一个方法 它必须返回转换后的值 形参 将为 注册可调用的适配器另一种可能的做法是创建一个将该类型转换为字符串表示的函数并使用 注册该函数 模块有两个适配器可用于 的内置 和 类型 现在假设我们想要存储 对象但不是表示为 格式而是表示为 时间戳 将 值转换为自定义 类型 编写适配器让你可以将定制的 类型发送给 但要令它真正有用我们需要实现从 到 再回到 的双向转换 输入转换器 让我们回到 类 我们以字符串形式在 中存储了 和 坐标值 首先我们将定义一个转换器函数它接受这样的字符串作为形参并根据该参数构造一个 对象 注解 转换器函数在调用时 总是 会附带一个 对象无论你将何种数 据类型的值发给 现在你需要让 模块知道你从数据库中选取的其实是一个点对象 有两种方式都可以做到这件事 隐式的声明类型 显式的通过列名这两种方式会在 模块函数和常量 一节中描述相应条目为 和 常量 下面的示例说明了这两种方法 默认适配器和转换器 对于 模块中的 和 类型已提供了默认的适配器 它们将会以 日期 时间戳的形式发给 默认转换器使用的注册名称是针对 的 和针对 的 通过这种方式你可以在大多数情况下使用 的 对象而无须任何额外处理 适配器的格式还与实验性的 函数兼容 下面的示例演示了这一点 如果存储在 中的时间戳的小数位多于 个数字则时间戳转换器会将该值截断至微秒精度 控制事务 有效使用 使用快捷方式 使用 对象的非标准 和 方法可以更简洁地编写代码因为不必显式创建通常是多余的 对象 相反 对象是隐式创建的这些快捷方法返回游标对象 这样只需对 对象调用一次就能直接执行 语句并遍历对象 通过名称而不是索引访问索引 模块的一个有用功能是内置的 类该类旨在用作行工厂 该类的行装饰器可以用索引如元组和不区分大小写的名称访问 使用连接作为上下文管理器 常见问题 多线程 较老版本的 在共享线程之间存在连接问题 这就是 模块不允许线程之间共享连接和游标的原因 如果仍然尝试这样做则在运行时会出现异常 唯一的例外是调用 方法该方法仅在从其他线程进行调用时才有意义 脚注 模块默认没有构建可加载扩展支持因为有一些平台带有不支持这 个特性的 库特别是 要获得可加载扩展的支持那 么在编译配置的时候必须指定 选 项 编码与解码 数据 源代码 模块为外部数据表示标准提供支持该标准的描述见 由 在 年 月撰写 它支持该 中描述的大部分数据类型 模块定义了两个类一个用于将变量打包为 表示形式另一个用于从 表示形式解包 此外还有两个异常类 是用于将数据打包为 表示形式的类 类的实例化 不附带参数 是用于相应地从字符串缓冲区解包 数据值的类 输入缓冲 区将作为 给出 参见 外部数据表示标准 这个 定义了最初编写此模块时 所用的数据编码格式 显然它已 被 所淘汰 外部数据表示标准 更新的 它提供了经修订的 定义 对象 对象 类提供以下方法 使用给定的 重置字符串缓冲区 返回数据缓冲区中的当前解包位置 将数据缓冲区的解包位置设为 你应当小心使用 和 将当前解包数据缓冲区以字符串的形式返回 表明解包完成 如果数据没有全部完成解包则会引发 异常 此外每种可通过 打包的数据类型都可通过 来解包 解包方法的形式为 并且不接受任何参数 该方法将返回解包后的对象 解包单精度浮点数 解包双精度浮点数类似于 此外以下方法可用来解包字符串 字节串以及不透明数据 解包并返回固定长度字符串 为期望的字符数量 会预设以空字节串 填充以保证 字节对齐 解包并返回固定长度数据流类似于 解包并返回可变长度字符串 先将字符串的长度解包为无符号整数再用 来解包字符串数据 解包并返回可变长度不透明数据流类似于 解包并返回可变长度字节流类似于 下列方法支持解包数组和列表 解包并返回同质条目的列表 该列表每次解包一个元素先解包一个无符号 整数旗标 如果旗标为 则解包条目并将其添加到列表 旗标为 表明列表结束 为在解包条目时调用的函数 解包并以列表形式返回由同质条目构成的固定长度数组 为期望的 缓冲区内列表元素数量 如上所述 是解包每个元素时要使 用的函数 解包并返回由同质条目构成的可变长度 先将列表的长度解包为无 符号整数再像上面的 一样解包每个元素 异常 此模块中的异常会表示为类实例代码 基本异常类 具有一个公共属性 其中包含对错误的描述 从 所派生的类 不包含额外的实例变量 以下是一个应该如何捕获这些异常的示例 协程与任务 本节将简述用于协程与任务的高层级 协程 可等待对象 运行 程序 创建任务 休眠 并发运行任务 屏蔽取消操作 超时 简单等待 在线程中运行 来自其他线程的日程安排 内省 对象 基于生成器的协程 协程 协程 通过 语法进行声明是编写 应用的推荐方式 例如以下代码段需要 会打印 等待 秒再打印 注意简单地调用一个协程并不会将其加入执行日程 要真正运行一个协程 提供了三种主要机制 函数用来运行最高层级的入口点 函数 参见上面 的示例 等待一个协程 以下代码段会在等待 秒后打印 然后 再次 等 待 秒后打印 预期的输出 函数用来并发运行作为 任务 的多个协 程 让我们修改以上示例并发 运行两个 协程 注意预期的输出显示代码段的运行时间比之前快了 秒 可等待对象 如果一个对象可以在 语句中使用那么它就是 可等待 对象 许多 都被设计为接受可等待对象 可等待 对象有三种主要类型 协程 任务 和 协程 协程属于 可等待 对象因此可以在其他协程中被等待 重要 在本文档中 协程 可用来表示两个紧密关联的概念 协程函数 定义形式为 的函数 协程对象 调用 协程函数 所返回的对象 也支持旧式的 基于生成器的 协程 任务 任务 被用来设置日程以便 并发 执行协程 当一个协程通过 等函数被打包为一个 任务该协程将自动排入日程准备立即运行 对象 是一种特殊的 低层级 可等待对象表示一个异步操作的 最终结果 当一个 对象 被等待这意味着协程将保持等待直到该 对象在其他地方操作完毕 在 中需要 对象以便允许通过 使用基于回调的代码 通常情况下 没有必要 在应用层级的代码中创建 对象 对象有时会由库和某些 暴露给用户用作可等待对象 一个很好的返回对象的低层级函数的示例是 运行 程序 执行 并返回结果 此函数会运行传入的协程负责管理 事件循环终结异步生成器 并关闭线程池 当有其他 事件循环在同一线程中运行时此函数不能被调用 如果 为 事件循环将以调试模式运行 此函数总是会创建一个新的事件循环并在结束时关闭之 它应当被用作 程序的主入口点理想情况下应当只被调用一次 示例 新版功能 在 版更改 更新为使用 注解 的源代码可以在 中找到 创建任务 休眠 阻塞 指定的秒数 如果指定了 则当协程完成时将其返回给调用者 总是会挂起当前任务以允许其他任务运行 形参 以下协程示例运行 秒每秒显示一次当前日期 并发运行任务 并发 运行 序列中的 可等待对象 如果 中的某个可等待对象为协程它将自动作为一个任务加入日程 如果所有可等待对象都成功完成结果将是一个由所有返回值聚合而成的列 表 结果值的顺序与 中可等待对象的顺序一致 如果 为 默认所引发的首个异常会立即 传播给等待 的任务 序列中的其他可等待对象 不会被 取消 并将继续运行 如果 为 异常会和成功的结果一样处理并 聚合至结果列表 如果 被取消所有被提交 尚未完成 的可等待对象也会 被取消 如果 序列中的任一 或 对象 被取消它将被当作引 发了 一样处理 在此情况下 调用 不会 被取消 这是为了防止一个已提交的 被取消导致其他 也被取消 形参 示例 注解 如果 为 则在 被标记为已完成后 取消它将不会取消任何已提交的可等待对象 例如在将一个异常传播给 调用者之后 可被标记为已完成因此在从 捕获一个 由可等待对象所引发的异常之后调用 将不会取消任 何其他可等待对象 在 版更改 如果 本身被取消则无论 取值为何消息都会被传播 屏蔽取消操作 超时 等待 可等待对象 完成指定 秒数后超时 如果 是一个协程它将自动作为任务加入日程 可以为 也可以为 或 型数值表示的等待秒数 如果 为 则等待直到完成 如果发生超时任务将取消并引发 要避免任务 取消可以加上 此函数将等待直到 确实被取消所以总等待时间可能超过 如果在取消期间发生了异常异常将会被传播 如果等待被取消则 指定的对象也会被取消 形参 示例 在 版更改 当 因超时被取消 会等待 被取消 之前版本则将立即引发 简单等待 返回两个 集合 用法 如指定 或 类型 则它将被用于控制返回之前等待的 最长秒数 请注意此函数不会引发 当超时发生时未完成的 或 将在指定秒数后被返回 指定此函数应在何时返回 它必须为以下常数之一 常数 描述 函数将在任意可等待对象结束或取消时返回 函数将在任意可等待对象因引发异常而结束时 返回 当没有引发任何异常时 它就相当于 函数将在所有可等待对象结束或取消时返回 与 不同 在超时发生时不会取消可等待对象 版后已移除 如果 中的某个可等待对象为协程它将自动作为任 务加入日程 直接向 传入协程对象已弃用因为这会导致 令人迷 惑的行为 形参 注解 会自动将协程作为任务加入日程以后将以 集合形式返回显式创建的任务对象 因此以下代码并不会有预期的行为 以上代码段的修正方法如下 直接 向 传入协程对象的方式已弃用 如果在所有 对象完成前发生超时则将引发 形参 示例 在线程中运行 在不同的线程中异步地运行函数 向此函数提供的任何 和 会被直接传给 并且当 前 会被传播允许在不同的线程中访问来自事件循 环的上下文变量 返回一个可被等待以获取 的最终结果的协程 这个协程函数主要是用于执行在其他情况下会阻塞事件循环的 密集型函 数方法 例如 在任何协程中直接调用 将会在调用期间阻塞事件循环导 致额外的 秒运行时间 而通过改用 我们可以 在不同的线程中运行它从而不会阻塞事件循环 注解 由于 的存在 通常只能被用来将 密集 型函数变为非阻塞的 但是对于会释放 的扩展模块或无此限制的 替代性 实现来说 也可被用于 密集 型函数 新版功能 来自其他线程的日程安排 向指定事件循环提交一个协程 线程安全 返回一个 以等待来自其他 线程的结果 此函数应该从另一个 线程中调用而非事件循环运行所在线程 示例 如果在协程内产生了异常将会通知返回的 对象 它也可被用来取 消事件循环中的任务 查看 并发和多线程 章节的文档 不同与其他 函数此函数要求显式地传入 参数 新版功能 内省 返回当前运行的 实例如果没有正在运行的任务则返回 如果 为 则会使用 获取当前事件循 环 新版功能 返回事件循环所运行的未完成的 对象的集合 如果 为 则会使用 获取当前事件循 环 新版功能 对象 一个与 类似 的对象可运行 协程 非线程安全 对象被用来在事件循环中运行协程 如果一个协程在等待一个 对象 对象会挂起该协程的执行并等待该 对象完成 当该 对象 完成被打包的协程将恢复执行 事件循环使用协同日程调度 一个事件循环每次运行一个 对象 而一 个 对象会等待一个 对象完成该事件循环会运行其他 回调或执行 操作 使用高层级的 函数来创建 对象也可用低 层级的 或 函数 不建议手动实 例化 对象 要取消一个正在运行的 对象可使用 方法 调用此方法将 使该 对象抛出一个 异常给打包的协程 如果取消 期间一个协程正在等待一个 对象该 对象也将被取消 可被用来检测 对象是否被取消 如果打包的协程没有 抑制 异常并且确实被取消该方法将返回 从 继承了其除 和 以外的所有 对象支持 模块 当一个 对象被创建它将复制 当前上下文然后在复制的上下文中运行其协程 在 版更改 加入对 模块的支持 在 版更改 添加了 形参 形参 请求取消 对象 这将安排在下一轮事件循环中抛出一个 异常给被封包 的协程 协程在之后有机会进行清理甚至使用 代码块抑制异常来拒绝请求 不同于 不保证 会被取消虽然抑 制完全取消并不常见也很不鼓励这样做 在 版更改 增加了 形参 以下示例演示了协程是如何侦听取消请求的 如果 对象 被取消 则返回 当使用 发出取消请求时 会被 取消其封包的协程 将传播被抛入的 异常 如果 对象 已完成 则返回 当 所封包的协程返回一个值 引发一个异常或 本身被取消时 则会被认为 已完成 返回 的结果 如果 对象 已完成其封包的协程的结果会被返回 或者当协程 引发异常时该异常会被重新引发 如果 对象 被取消此方法会引发一个 异常 如果 对象的结果还不可用此方法会引发一个 异常 返回 对象的异常 如果所封包的协程引发了一个异常该异常将被返回 如果所封包的协程 正常返回则该方法将返回 如果 对象 被取消此方法会引发一个 异常 如果 对象尚未 完成此方法将引发一个 异常 添加一个回调将在 对象 完成 时被运行 此方法应该仅在低层级的基于回调的代码中使用 要了解更多细节请查看 的文档 从回调列表中移除 指定的回调 此方法应该仅在低层级的基于回调的代码中使用 要了解更多细节请查看 的文档 返回此 对象的栈框架列表 如果所封包的协程未完成这将返回其挂起所在的栈 如果协程已成功完 成或被取消这将返回一个空列表 如果协程被一个异常终止这将返回 回溯框架列表 框架总是从按从旧到新排序 每个被挂起的协程只返回一个栈框架 可选的 参数指定返回框架的数量上限默认返回所有框架 返 回列表的顺序要看是返回一个栈还是一个回溯栈返回最新的框架回溯 返回最旧的框架 这与 模块的行为保持一致 打印此 对象的栈或回溯 此方法产生的输出类似于 模块通过 所获取的 框架 参数会直接传递给 参数是输出所写入的 流默认情况下输出会写入 返回由 包装的协程对象 新版功能 返回 的名称 如果没有一个 名称被显式地赋值默认的 实现会在 实例化期间生成一个默认名称 新版功能 设置 的名称 参数可以为任意对象它随后会被转换为字符串 在默认的 实现中名称将在任务对象的 输出中可见 新版功能 基于生成器的协程 注解 对基于生成器的协程的支持 已弃用 并计划在 中移除 基于生成器的协程是 语法的前身 它们是使用 语句创建的 生成器可以等待 和其他协程 基于生成器的协程应该使用 装饰虽然这并非强制 用来标记基于生成器的协程的装饰器 此装饰器使得旧式的基于生成器的协程能与 代码相兼容 此装饰器不应该被用于 协程 请改 用 如果 是一个 协程对象 则返回 此方法不同于 因为它对基于生成器的协程返回 如果 是一个 协程函数 则返回 此方法不同于 因为它对以 装饰的基于生成器的协程函数返回 十进制定点和浮点运算 源码 模块为快速正确舍入的十进制浮点运算提供支持 与 数据类型相比它具有以下几个优点 基于一个浮点模型它是为人们设计的并且必然具有最重要的指 导原则 计算机必须提供与人们在学校学习的算法相同的算法 摘自 十进制算术规范 数字的表示是完全精确的 相比之下 和 这样的数字 在二进制浮点中没有精确的表示 最终用户通常不希望 如二进 制浮点数表示那样被显示为 精确性延续到算术中 在十进制浮点数中 恰好 等于零 在二进制浮点数中结果为 虽然 接近于零但差异妨碍了可靠的相等性检验并且差异可能会累积 因此 在具有严格相等不变量的会计应用程序中 是首选 十进制模块包含有效位的概念因此 的结果是 保 留尾随零以表示有效位 这是货币的惯用表示方法 乘法则沿用 教科书 中保留被乘数中的所有数字的方法 例如 结果是 而 结果是 与基于硬件的二进制浮点不同十进制模块具有用户可更改的精度默认为 位可以与给定问题所需的一样大 二进制和十进制浮点都是根据已发布的标准实现的 虽然内置浮点类型只公 开其功能的一小部分但十进制模块公开了标准的所有必需部分 在需要时 程序员可以完全控制舍入和信号处理 这包括通过使用异常来阻止任何不 精确操作来强制执行精确算术的选项 十进制模块旨在支持无偏见精确的非连续十进制算术有时称为定点算术 和舍入浮点算术 摘自十进制算术规范 模块设计以三个概念为中心十进制数算术上下文和信号 十进制数是不可变的 它有一个符号系数数字和一个指数 为了保持重要性系数数字不会截断尾随零 十进制数也包括特殊值例如 和 该标准还区分 和 算术的上下文是指定精度 舍入规则 指数限制 指示操作结果的标志以及确定符号是否被视为异常的陷阱启用器的环境 舍入选项包括 以及 信号是在计算过程中出现的异常条件组 根据应用程序的需要信号可能会被忽略被视为信息或被视为异常 十进制模块中的信号有 以及 对于每个信号都有一个标志和一个陷阱启动器 遇到信号时其标志设置为 然后如果陷阱启用器设置为 则引发异常 标志是粘性的因此用户需要在监控计算之前重置它们 参见 的通用十进制算术规范 快速入门教程 通常使用小数的开始是导入模块使用 查看当前上下文并在必要时为精度 舍入或启用的陷阱设置新值 可以从整数 字符串 浮点数或元组构造十进制实例 从整数或浮点构造将执行该整数或浮点值的精确转换 十进制数包括特殊值例如 代表非数字正的和负的 和 如果 信号被捕获构造函数中的小数和浮点数的意外混合或排序比较会引发异常 新版功能 新 的重要性仅由输入的位数决定 上下文精度和舍入仅在算术运算期间发挥作用 如果超出了 版本的内部限制则构造一个十进制将引发 在 版更改 小数与 的其余部分很好地交互 这是一个小的十进制浮点飞行杂技团 也可以使用一些数学函数 方法将数字舍入为固定指数 此方法对于将结果舍入到固定的位置的货币应用程序非常有用 如上所示 函数访问当前上下文并允许更改设置 这种方法满足大多数应用程序的需求 对于更高级的工作使用 构造函数创建备用上下文可能很有用 要使用备用活动请使用 函数 根据标准 模块提供了两个现成的标准上下文 和 前者对调试特别有用因为许多陷阱都已启用 上下文还具有用于监视计算期间遇到的异常情况的信号标志 标志保持设置直到明确清除因此最好通过使用 方法清除每组受监控计算之前的标志 条目显示对 的有理逼近被舍入超出上下文精度的数字被抛弃并且结果是不精确的一些丢弃的数字不为零 使用上下文的 字段中的字典设置单个陷阱 大多数程序仅在程序开始时调整当前上下文一次 并且在许多应用程序中数据在循环内单个强制转换为 通过创建上下文集和小数程序的大部分操作数据与其他 数字类型没有区别 对象 根据 构造一个新的 对象 可以是整数字符串元组 或另一个 对象 如果没有给出 则返回 如果 是一 个字符串它应该在前导和尾随空格字符以及下划线被删除之后符合十进制 数字字符串语法 当上面出现 时也允许其他十进制数码 其中包括来自各种其他语 言系统的十进制数码例如阿拉伯印地语和天城文的数码以及全宽数码 到 如果 是一个 它应该有三个组件一个符号 表示 正数或 表示负数一个数字的 和整数指数 例如 返回 如果 是 则二进制浮点值无损地转换为其精确的十进制 等效值 此转换通常需要 位或更多位数的精度 例如 转换为 精度不会影响存储的位数 这完全由 中的位数决定 例如 记录所有五个零即使上下文精度只有三 参数的目的是确定 是格式错误的字符串时该怎么做 如果上下文陷阱 则引发异常否则构造函数返回一 个新的 其值为 构造完成后 对象是不可变的 在 版更改 现在允许构造函数的参数为 实例 在 版更改 参数在设置 陷阱时引发异常 默认情况下陷阱已关闭 在 版更改 允许下划线进行分组就像代码中的整数和浮点文字一样 十进制浮点对象与其他内置数值类型共享许多属性例如 和 所有常用的数学运算和特殊方法都适用 同样十进制对象可以复制 打印 用作字典键 用作集合元素 比较 排序和强制转换为另一 种类型例如 或 算术对十进制对象和算术对整数和浮点数有一些小的差别 当余数运算符 应用于 对象时结果的符号是 被除数 的符号而不是除数的 符号 整数除法运算符 的行为类似返回真商的整数部分截断为零而不 是它的向下取整以便保留通常的标识 和 运算符实现了 和 操作分别 如规范中所述 十进制对象通常不能与浮点数或 实例在算术运算中 结合使用例如尝试将 加到 将引发 但是可以使用 的比较运算符来比较 实例 和另一 个数字 这样可以避免在对不同类型的数字进行相等比较时混淆结果 在 版更改 现在完全支持 实例和其他数字类型之间的混合 类型比较 除了标准的数字属性十进制浮点对象还有许多专门的方法 在移出系数最右边的数字之后返回调整后的指数直到只剩下前导数字 返回 用于确定最高有效位相对 于小数点的位置 返回一对 整数表示给定的 实例作为分数 最简 形式项并带有正分母 转换是精确的 在 上引发 在 上引起 新版功能 返回一个 表示的数字 返回参数的规范编码 目前一个 实例的编码始终是规范的 因此该操作返回其参数不变 比较两个 实例的值 返回一个 实例 如果任一操作数是 那么结果是 除了所有 信号之外此操作与 方法相同 也就是说 如果两个操作数都不是信令 那么任何静默的 操作数都被视为 信令 使用它们的抽象表示而不是它们的数值来比较两个操作数 类似于 方法但结果给出了一个总排序 实例 两个 实例具有相同的数值但不同的表示形式在此排序中比较不相等 静默和发出信号的 也包括在总排序中 这个函数的结果是 如果两个操作数具有相同的表示或是 如果第一个操作数的总顺序低于第二个操作数或是 如果第一个操作数在总顺序中高于第二个操作数 有关 总排序的详细信息请参阅规范 此操作不受上下文影响且静默不更改任何标志且不执行舍入 作为例 外如果无法准确转换第二个操作数则 版本可能会引发 比较两个操作数使用它们的抽象表示而不是它们的值如 但忽略每个操作数的符号 相当于 此操作不受上下文影响且静默不更改任何标志且不执行舍入 作为例 外如果无法准确转换第二个操作数则 版本可能会引发 只返回 这种方法只符合 规范 返回参数的绝对值 此操作不受上下文影响并且是静默的没有更改标 志且不执行舍入 回到参数的否定 此操作不受上下文影响并且是静默的没有标志更改 且不执行舍入 返回第一个操作数的副本其符号设置为与第二个操作数的符号相同 例如 此操作不受上下文影响且静默不更改任何标志且不执行舍入 作为例 外如果无法准确转换第二个操作数则 版本可能会引发 返回给定数字的自然指数函数 的值 结果使用 舍入模式正确舍入 将浮点数转换为十进制数的类方法 注意 与 不同 由于 在二进制浮点中不能精确表示因此该值存储为最接近的可表示值 即 十进制的等效值是 注解 从 开始 实例也可以直接从 构造 新版功能 混合乘法加法 返回 中间乘积 没有 舍入 如果参数是规范的则为返回 否则为 目前 实例总是规范的所以这个操作总是返回 如果参数是一个有限的数则返回为 如果参数为无穷大或 则返回为 如果参数为正负无穷大则返回为 否则为 如果参数为 无论是否静默则返回为 否则为 如果参数是一个 标准的 有限数则返回 如果参数为零 次标 准数 无穷大或 则返回 如果参数为静默 返回 否则返回 如果参数带有负号则返回为 否则返回 注意 和 都可带有符号 如果参数为显式 则返回 否则返回 如果参数为次标准数则返回 否则返回 如果参数是 正负皆可则返回 否则返回 返回操作数的自然对数以 为底 结果是使用 舍入模式正确舍入的 返回操作数的以十为底的对数 结果是使用 舍入模 式正确舍入的 对于一个非零数返回其运算数的调整后指数作为一个 实例 如果运算数为零将返回 并且产生 标志 如果运算数是无限大则返回 是需要两个 逻辑运算数 的逻辑运算参考 逻辑操 作数 按位输出两运算数的 运算的结果 是一个逻辑运算 结果是操作数的按位求反 是需要两个 的逻辑运算请参阅 逻辑操作数 结果是两个运算数的按位的 运算 是需要两个 逻辑运算数 的逻辑运算参考 逻辑操 作数 结果是按位输出的两运算数的异或运算 像 一样除了在返回之前应用上下文舍入规则并且 用信号通知或忽略 值取决于上下文以及它们是发信号还是安静 与 方法相似但是操作数使用绝对值完成比较 像 一样除了在返回之前应用上下文舍入规则并且 用信号通知或忽略 值取决于上下文以及它们是发信号还是安静 与 方法相似但是操作数使用绝对值完成比较 返回小于给定操作数的上下文中可表示的最大数字或者当前线程的上下 文中的可表示的最大数字如果没有给定上下文 返回大于给定操作数的上下文中可表示的最小数字或者当前线程的上下 文中的可表示的最小数字如果没有给定上下文 如果两运算数不相等返回在第二个操作数的方向上最接近第一个操作数 的数 如果两操作数数值上相等返回将符号设置为与第二个运算数相同 的第一个运算数的拷贝 通过去除尾随的零并将所有结果等于 的转化为 来标准化数字 用于为等效类的属性生成规范值 比 如 和 都被标准化 为相同的值 返回一个字符串描述运算数的 返回值是以下十个字符串中的 一个 指示运算数为负无穷大 指示该运算数是负正常数字 指示该运算数是负的次标准数 指示该运算数是负零 指示该运算数是正零 指示该运算数是正的次标准数 指示该运算数是正的标准数 指示该运算数是正无穷 指示该运算数是肃静 非数字 指示该运算数是信号 返回的值等于舍入后的第一个运算数并且具有第二个操作数的指数 与其他运算不同如果量化运算后的系数长度大于精度那么会发出一个 信号 这保证了除非有一个错误情况量化指数恒 等于右手运算数的指数 与其他运算不同量化永不信号下溢即使结果不正常且不精确 如果第二个运算数的指数大于第一个运算数的指数那或许需要舍入 在这 种情况下舍入模式由给定 参数决定其余的由给定 参数决定如果参数都未给定使用当前线程上下文的舍入模 式 每当结果的指数大于 或小于 就会返回错误 返回 即 类进行所有算术运算所用的数制 基数 这是为保持与规范描述的兼容性而加入的 返回 除以 的余数 这与 的区别在于 所选择的余数要使其绝对值最小化 更准确地说返回值为 其中 是最接近 的实际值的整数并且如 果两个整数与实际值的差相等则会选择其中的偶数 如果结果为零则其符号将为 的符号 返回对第一个操作数的数码按第二个操作数所指定的数量进行轮转的结果 第二个操作数必须为 至 精度范围内的整数 第二个操作数的绝对值给出要轮转的位数 如果第二个操作数为正值则 向左轮转否则向右轮转 如有必要第一个操作数的系数会在左侧填充 零以达到 所指定的长度 第一个操作数的符号和指数保持不 变 检测自身与 是否具有相同的指数或是否均为 此操作不受上下文影响且静默不更改任何标志且不执行舍入 作为例 外如果无法准确转换第二个操作数则 版本可能会引发 返回第一个操作数使用第二个操作数对指数进行调整的结果 等价于返 回第一个操作数乘以 的结果 第二个操作数必须为整数 返回第一个操作数的数码按第二个操作数所指定的数量进行移位的结果 第二个操作数必须为 至 范围内的整数 第二个 操作数的绝对值给出要移动的位数 如果第二个操作数为正值则向左移 位否则向右移位 移入系数的数码为零 第一个操作数的符号和指数 保持不变 返回参数的平方根精确到完整精度 转换为字符串如果需要指数则会使用工程标注法 工程标注法的指数是 的倍数 这会在十进制位的左边保留至多 个 数码并可能要求添加一至两个末尾零 例如此方法会将 转换为 与 方法相同 保留 名称是为 了与旧版本兼容 舍入到最接近的整数发出信号 或者如果发生舍入则相应地 发出信号 如果给出 形参则由其确定舍入模式 否则由给定的 来确定 如果没有给定任何形参则会使用当 前上下文的舍入模式 舍入到最接近的整数而不发出 或 信号 如果给 出 则会应用其所指定的舍入模式否则使用所提供的 或当前上下文的舍入方法 逻辑操作数 和 方法期望其参数为 逻辑操作数 逻辑操作数 是指数位与符号位均为零的 实例并且其数字位均为 或 上下文对象 上下文是算术运算所在的环境 它们管理精度 设置舍入规则 确定将哪些信号视为异常并限制指数的范围 每个线程都有自己的当前上下文可使用 和 函数来读取或修改 返回活动线程的当前上下文 将活动线程的当前上下文设为 你也可以使用 语句和 函数来临时改变活动上下文 返回一个上下文管理器它将在进入 语句时将活动线程的当前上下文 设为 的一个副本并在退出 语句时恢复之前的上下文 如果未 指定上下文则会使用当前上下文的一个副本 例如以下代码会将当前 精度设为 位执行一个运算然后自 动恢复之前的上下文 新的上下文也可使用下述的 构造器来创建 此外模块还提供了三种预设的上下文 这是由通用十进制算术规范描述所定义的标准上下文 精度设为九 舍入 设为 清除所有旗标 启用所有陷阱视为异常但 和 除外 由于启用了许多陷阱此上下文适用于进行调试 这是由通用十进制算术规范描述所定义的标准上下文 精度设为九 舍入 设为 清除所有旗标 不启用任何陷阱因此在计算 期间不会引发异常 由于禁用了陷阱此上下文适用于希望结果值为 或 而不 是引发异常的应用 这允许应用在出现当其他情况下会中止程序的条件时仍 能完成运行 此上下文被 构造器用作新上下文的原型 改变一个字段例如 精度的效果将是改变 构造器所创建的新上下文的默认值 此上下文最适用于多线程环境 在线程开始前改变一个字段具有设置全系统 默认值的效果 不推荐在线程开始后改变字段因为这会要求线程同步避免 竞争条件 在单线程环境中最好完全不使用此上下文 而是简单地电显式创建上下文 具体如下所述 默认值为 并为 和 启用陷阱 在已提供的三种上下文之外还可以使用 构造器创建新的上下文 创建一个新上下文 如果某个字段未指定或为 则从 拷贝默认值 如果 字段未指定或为 则清空所有旗标 为一个 范围内的整数用于设置该上下文中算 术运算的精度 选项应为 小节中列出的常量之一 和 字段列出要设置的任何信号 通常新上下文应当只 设置 而让 为空 和 字段给定指数所允许的外部上限 必须在 范围内 在 范围内 字段为 或 默认值 如果设为 指数将附带打 印大写的 其他情况则将使用小写的 字段为 默认值 或 如果设为 则 实 例的指数 的表示范围在此上下文中将严格限制为 如果 为 则将适用较弱的条件 实例调整后的指数最大值为 当 为 时 一个较大的普通数值将在可能的情况下减小其指数并为其系统添加相应数量 的零以便符合指数值限制这可以保持数字值但会丢失有效末尾零的信息 例如 值为 时即允许与在 中描述的固定宽度十进制交换格 式保持兼容性 类定义了几种通用方法以及大量直接在给定上下文中进行算术运 算的方法 此外对于上述的每种 方法不包括 和 方法都有一个相应的 方法 例如对于一 个 的实例 和 的实例 就等价 于 每个 方法都接受一个 整数 即 的实例在任何接受 的实例的地方使用 将所有旗标重置为 将所有陷阱重置为零 新版功能 返回上下文的一个副本 返回 实例 的一个副本 基于 创建一个新 实例但使用 作为上下文 与 构造器不同该上下文的精度 舍入方法 旗标和陷阱会被应 用于转换过程 此方法很有用处因为常量往往被给予高于应用所需的精度 另一个好 处在于立即执行舍入可以消除超出当前精度的数位所导致的意外效果 在下面的示例中使用未舍入的输入意味着在总和中添加零会改变结果 此方法实现了 规格描述中的转换为数字操作 如果参数为字符串 则不允许有开头或末尾的空格或下划线 基于浮点数 创建一个新的 实例但会使用 作为上 下文来执行舍入 与 类方法不同上下文的 精度 舍入方法 旗标和陷阱会应用到转换中 新版功能 返回一个等于 的值即次标准化结果中的最小指数值 当发生向下溢出时指数会设为 返回一个等于 的值 使用 的通常方式是创建 实例然后对其应用算术运算这 些运算发生在活动线程的当前上下文中 一种替代方式则是使用上下文的方 法在特定上下文中进行计算 这些方法类似于 类的方法在此 仅简单地重新列出 返回 的绝对值 返回 与 的和 返回相同的 对象 对 与 进行数值比较 对两个操作数进行数值比较 对两个操作数使用其抽象表示进行比较 对两个操作数使用其抽象表示进行比较忽略符号 返回 的副本符号设为 返回 的副本符号取反 从 拷贝符号至 返回 除以 的结果 返回 除以 的结果截短为整数 两个数字相除并返回结果的整数部分 返回 返回 乘以 再加 的结果 如果 是规范的则返回 否则返回 如果 为有限的则返回 否则返回 如果 是无限的则返回 否则返回 如果 是 或 则返回 否则返回 如果 是标准数则返回 否则返回 如果 是静默 则返回 否则返回 是负数则返回 否则返回 如果 是显式 则返回 否则返回 如果 是次标准数则返回 否则返回 如果 为零则返回 否则返回 返回 的自然对数以 为底 返回 的以 为底的对数 返回操作数的 等级的指数 在操作数的每个数位间应用逻辑运算 反转 中的所有数位 在操作数的每个数位间应用逻辑运算 在操作数的每个数位间应用逻辑运算 对两个值执行数字比较并返回其中的最大值 对两个值执行忽略正负号的数字比较 对两个值执行数字比较并返回其中的最小值 对两个值执行忽略正负号的数字比较 对应于 中的单目前缀取负运算符执行取负操作 返回 和 的积 返回小于 的最大数字表示形式 返回大于 的最小数字表示形式 返回 趋向于 的最接近的数字 将 改写为最简形式 返回 的类的表示 对应于 中的单目前缀取正运算符执行取正操作 此操作将应用 上下文精度和舍入因此它 不是 标识运算 返回 的 次方如果给出了模数 则取其余数 如为两个参数则计算 如果 为负值则 必须为整数 除非 为整数且结果为有限值并可在 位内精确表示否则 结果将是不精确的 上下文的舍入模式将被使用 结果在 版中 总是会被正确地舍入 结果为 而如果 未被捕获则结果为 在 版更改 模块计算 时会使用已正确舍入的 和 函数 结果是经过良好定义的但仅限于几乎总是正确地舍 入 带有三个参数时计算 对于三个参数的形式参 数将会应用以下限制 三个参数必须都是整数 必须是非负数 或 至少有一个不为零 必须不为零且至多有 位 来自 的结果值等于使用无限精度计算 所得到的值但其计算过程更高效 结果的指数为 零无论 和 的指数是多少 结果值总是完全精确 的 返回的值等于 舍入后并且指数为 恰好返回 因为这是 对象 返回整除所得到的余数 结果的符号如果不为零则与原始除数的符号相同 返回 其中 为最接近 实际值的整数如结果 为 则其符号将与 的符号相同 返回 翻转 次的副本 如果两个操作数具有相同的指数则返回 返回第一个操作数添加第二个值的指数后的结果 返回 变换 次的副本 非负数基于上下文精度的平方根 返回 和 的差 转换为字符串如果需要指数则会使用工程标注法 工程标注法的指数是 的倍数 这会在十进制位的左边保留至多 个 数码并可能要求添加一至两个末尾零 舍入到一个整数 使用科学计数法将一个数字转换为字符串 常数 本节中的常量仅与 模块相关 它们也被包含在纯 版本以保持兼容性 位 位 该值为 已弃用因为 现在总是启用线程 版后已移除 默认值为 如果 的编译带有 选项则 版本会使用线程局部而不是协程局部上下文并且该 值为 这在某些嵌套上下文场景中将稍快一些 新版功能 向下移植到 和 舍入模式 舍入方向为 舍入方向为零 舍入方向为 舍入到最接近的数同样接近则舍入方向为零 舍入到最接近的数同样接近则舍入到最接近的偶数 舍入到最接近的数同样接近则舍入到零的反方向 舍入到零的反方向 如果最后一位朝零的方向舍入后为 或 则舍入到零的反方向否则舍入 方向为零 信号 信号代表在计算期间引发的条件 每个信号对应于一个上下文旗标和一个上下文陷阱启用器 上下文旗标将在遇到特定条件时被设定 在完成计算之后将为了获得信息而检测旗标例如确定计算是否精确 在检测旗标后请确保在开始下一次计算之前清除所有旗标 如果为信号设定了上下文的陷阱启用器则条件会导致特定的 异常被引发 举例来说如果设定了 陷阱则当遇到此条件时就将引发 异常 修改一个指数以符合表示限制 通常限位将在一个指数超出上下文的 和 限制时发生 在 可能的情况下会通过给系数添加零来将指数缩减至符合限制 其他信号的基类并且也是 的一个子类 非无限数被零除的信号 可在除法 取余队法或对一个数求负数次幂时发生 如果此信号未被陷阱捕 获则返回 或 并且由对计算的输入来确定正负符 号 表明发生了舍入且结果是不精确的 有非零数位在舍入期间被丢弃的信号 舍入结果将被返回 此信号旗标或 陷阱被用于检测结果不精确的情况 执行了一个无效的操作 表明请求了一个无意义的操作 如未被陷阱捕获则返回 可能的原 因包括 数值的溢出 表明在发生舍入之后的指数大于 如果未被陷阱捕获则结果将取 决于舍入模式或者向下舍入为最大的可表示有限数或者向上舍入为 无论哪种情况都将引发 和 信号 发生了舍入但或许并没有信息丢失 一旦舍入丢弃了数位就会发出此信号即使被丢弃的数位是零 例如将 舍入为 如果未被陷阱捕获则不经修改地返回结果 此 信号用于检测有效位数的丢弃 在舍入之前指数低于 当操作结果是次标准数即指数过小时就会发出此信号 如果未被陷阱捕 获则不经修改过返回结果 数字向下溢出导致结果舍入到零 当一个次标准数结果通过舍入转为零时就会发出此信号 同时还将引发 和 信号 为 和 的混合启用更严格的语义 如果信号未被捕获默认则在 构造器 和所有比较运算中允许 和 的混合 转换和比较都是完全精 确的 发生的任何混合运算都将通过在上下文旗标中设置 来静默地记录 通过 或 进行显式转换则不会设置旗标 在其他情况下即信号被捕获则只静默执行相等性比较和显式转换 所 有其他混合运算都将引发 以下表格总结了信号的层级结构 浮点数说明 通过提升精度来解决舍入错误 使用十进制浮点数可以消除十进制表示错误即能够完全精确地表示 这样的数然而某些运算在非零数位超出给定的精度时仍然可能导致舍入错误 舍入错误的影响可能因接近相互抵销的加减运算被放大从而导致丢失有效位 提供了两个指导性示例其中出现了精度不足的浮点算术舍入导致加法的交换律和分配律被打破 模块则可以通过充分地扩展精度来避免有效位的丢失 特殊的值 模块的数字系统提供了一些特殊的值包括 以及两种零值 和 无穷大可以使用 来构建 它们也可以在不捕获 信号捕获时通过除以零来产生 类似地当不捕获 信号时也可以通过舍入到超出最大可表示数字限制的方式产生无穷大的结果 无穷大是有符号的仿射并可用于算术运算它们会被当作极其巨大的不确定数字来处理 例如无穷大加一个常量结果也将为无穷大 某些不存在有效结果的运算将会返回 或者如果捕获了 信号则会引发一个异常 例如 会返回 表示结果不是一个数字 这样的 是静默产生的并且在产生之后参与其它计算时总是会得到 的结果 这种行为对于偶而缺少输入的各类计算都很有用处 它允许在将特定结果标记为无效的同时让计算继续运行 另一种变体形式是 它在每次运算后会发出信号而不是保持静默 当对于无效结果需要中断计算进行特别处理时这是一个很有用的返回值 中比较运算符的行为在涉及 时可能会令人有点惊讶 相等性检测在操作数中有静默型或信号型 时总是会返回 即使是执行 而不等性检测总是会返回 当尝试使用 或 运算符中的任何一个来比较两个 值时如果运算数中有 则将引发 信号如果此信号未被捕获则将返回 请注意通用十进制算术规范并未规定直接比较行为这些涉及 的比较规则来自于 标准 见第 节表 要确保严格符合标准请改用 和 方法 有符号零值可以由向下溢出的运算产生 它们保留符号是为了让运算结果能以更高的精度传递 由于它们的大小为零正零和负零会被视为相等且它们的符号具有信息 在这两个不相同但却相等的有符号零之外还存在几种零的不同表示形式它们的精度不同但值也都相等 这需要一些时间来逐渐适应 对于习惯了标准浮点表示形式的眼睛来说以下运算返回等于零的值并不是显而易见的 使用线程 函数会为每个线程访问不同的 对象 具有单独线程上下文意味着线程可以修改上下文 例如 而不影响其他线程 类似的 会为当前上下文的目标自动赋值 如果在调用 之前调用了 则 将自动创建一个新的上下文在当前线程中使用 新的上下文拷贝自一个名为 的原型上下文 要控制默认值以便每个线程在应用运行期间都使用相同的值可以直接修改 对象 这应当在任何线程启动 之前 完成以使得调用 的线程之间不会产生竞争条件 例如 例程 以下是一些用作工具函数的例程它们演示了使用 类的各种方式 常见问题 源代码 异常处理 参见 警告类别 描述 在 版更改 值 处置 为发出警告的每个位置模块行号打印第一个匹 配警告 将匹配警告转换为异常 从不打印匹配的警告 总是打印匹配的警告 为发出警告的每个模块打印第一次匹配警告无论行 号如何 无论位置如何仅打印第一次出现的匹配警告 默认警告过滤器 在 版更改 在 版更改 在 版更改 暂时禁止警告 测试警告 在 版更改 在 版更改 注解 读写 归档文件 对象 对象 命令行界面 新版功能 模块提供了简单的命令行接口以便与 归档进行交互 如果你想要创建一个新的 归档请在 选项后指定其名称然后列出应当被包含的文件名 传入一个字典也是可接受的 如果你想要将一个 归档提取到指定的目录请使用 选项 你也可以通过传入目录名称将一个 归档提取到不同的目录 要获取一个 归档中文件的列表请使用 选项 命令行选项 列出一个 中的文件名 基于源文件创建 如果未指定 则会将 提取到当前目录 检测 是否有效 更详细地输出结果 示例 如何将整个 归档提取到当前工作目录 如何通过 使用生成器函数而非列表来提取一个 归档的子集 如何基于一个文件名列表创建未压缩的 归档 使用 语句的同一个示例 如何读取一个 压缩的 归档并显示一些成员信息 如何创建一个归档并使用 中的 形参来重置用户信息 受支持的 格式 通过 模块可以创建三种 格式 格式 它支持最多 个字符 的文件名长度和最多 个字符的链接名长度 文件大小上限为 这是一种老旧但广受支持的格式 格式 它支持长文件名和链接名 大于 的 文件以及稀疏文件 它是 系统上的事实标准 完全 支持针对长名称的 扩展稀疏文件支持则限制为只读 格式 它是几乎无限制的最灵活格式 它支持长文件名和链接名大文件以及使用便捷方式存储路径名 现代的 实现包括 和 完全支持扩展 特性某些老旧或不维护的库可能不受支持但应当会将 归档 视为广受支持的 格式 这是目前新建归档的默认格式 它扩展了现有的 格式包括用于无法以其他方式存储的附加标头 存在两种形式的 标头扩展标头只影响后续的文件标头全局标头则适 用于完整归档并会影响所有后续的文件 为了便于移植在 标头中的所 有数据均以 编码 还有一些 格式的其他变种它们可以被读取但不能被创建 古老的 格式 这是来自 第七版的第一个 格式它只存储常规 文件和目录 名称长度不能超过 个字符并且没有用户分组名信息 某些归档在带有非 字符字段的情况下会产生计算错误的标头校验和 扩展格式 此格式是 格式的一个变种但并 不保持兼容 问题 最初 格式被设计用来在磁带机上生成备份主要关注于保存文件系统信息 现在 归档通常用于文件分发和在网络上交换归档 最初格式它是所有其他格式的基础的一个问题是它没有支持不同字符编码格式的概念 例如一个在 系统上创建的普通 归档如果包含非 字符则将无法在 系统上被正确读取 文本元数据例如文件名链接名用户分组名将变为损坏状态 不幸的是没有什么办法能够自动检测一个归档的编码格式 格式被设计用来解决这个问题 它使用通用字符编码格式 来存储非 元数据 在 中字符转换的细节由 类的 和 关键字参数控制 定义了用于归档中元数据的字符编码格式 默认值为 或是回退选项 根据归档是被读取还是被写入元数据必须被解码或编码 如果没有正确设置 转换可能会失败 参数定义了不能被转换的字符将如何处理 可能的取值在 错误处理方案 小节列出 默认方案为 它也被 用于文件系统调用参见 文件名命令行参数以及环境变量 对于 归档默认格式 通常是不必要的因为所有元数据都使用 来存储 仅在解码二进制 标头或存储带有替代字符的字符串等少数场景下会被使用 拖放操作支持 源代码 注解 此模块是实验性的且在为 所替代后将被弃用 模块为单个应用内部的对象提供了在同一窗口中或多个窗口间的拖放操作支持 要将对象设为可拖放你必须为其创建启动拖放进程的事件绑定 通常你要将 事件绑定到你所编写的回调函数 参见 该函数应当调用 其中 为要拖动的对象而 为发起调用的事件你的回调函数的参数 目标对象的选择方式如下 从顶至底地在鼠标之下的区域中搜索目标控件 目标控件应当具有一个指向可调用对象的 属性 如果 不存在或是返回 则将转至父控件中搜索 如果目标控件未找到则目标对象为 调用 调用 调用 来通知释放 调用 来表明拖放的结束 类处理拖放事件在事件控件的根对象上跟踪 和 事件 取消拖放进程 执行结束播放函数 在执行拖动期间为目标对象检查鼠标之下的区域 当释放模式被触发时表明拖动的结束 用于拖放进程的工厂函数 参见 客户端的 处理 和 对象 在 版更改 在 版更改 在 版更改 过去触发的 现在是 的别名 注解 警告 在 版更改 文件名形参支持 对象 对象 对象 示例 杂项服务 本章中介绍的模块提供了所有 版本中提供的各种杂项服务 这是一个概述 通用格式化输出 面向对象的文件系统路径 新版功能 源代码 该模块提供表示文件系统路径的类其语义适用于不同的操作系统 路径类被分为提供纯计算操作而没有 的 纯路径以及从纯路径继承而来但提供 操作的 具体路径 图片如果你以前从未使用过此模块或者不确定在项目中使用哪一个类是正确的则 总是你需要的 它在运行代码的平台上实例化为一个 具体路径 在一些用例中纯路径很有用例如 如果你想要在 设备上操作 路径或者相反 你不应在 上实例化一个 但是你可以实例化 你只想操作路径但不想实际访问操作系统 在这种情况下实例化一个纯路 径是有用的因为它们没有任何访问操作系统的操作 参见 模块 面向对象的的文件系统路径 参见 对于底层的路径字符串操作你也可以使用 模块 基础使用 导入主类 列出子目录 列出当前目录树下的所有 源代码文件 在目录树中移动 查询路径的属性 打开一个文件 纯路径 通用性质 路径是不可变并可哈希的 相同风格的路径可以排序与比较 这些性质尊重对应风格的大小写转换语义 不同风格的路径比较得到不等的结果并且无法被排序 运算符 访问个别部分 为了访问路径独立的部分 组件使用以下特征属性 一个元组可以访问路径的多个组件 注意盘符和本地根目录是如何重组的 方法和特征属性 具体路径 具体路径是纯路径的子类 除了后者提供的操作之外它们还提供了对路径对象进行系统调用的方法 有三种方法可以实例化具体路径 一个 的子类此类以当前系统的路径风格表示路径实例化为 或 参数的指定和 相同 一个 和 的子类此类表示一个非 文件 系统的具体路径 参数的指定和 相同 和 的子类从类表示一个 文件系统的 具体路径 参数的指定和 相同 你只能实例化与当前系统风格相同的类允许系统调用作用于不兼容的路径风格可能在应用程序中导致缺陷或失败 方法 除纯路径方法外实体路径还提供以下方法 如果系统调用失败例如因为路径不存在这些方法中许多都会引发 在 版更改 对于包含 层级无法表示字符的路径 现在将返回 而不是引发异常 返回一个新的表示当前目录的路径对象和 返回的相同 返回一个表示当前用户家目录的新路径对象和 构造含 路径返回的相同 新版功能 返回一个 对象其中包含有关此路径的信息例如 结果会在每次调用此方法时重新搜索 改变文件的模式和权限和 一样 此路径是否指向一个已存在的文件或目录 注解 如果路径指向一个符号链接 返回此符号链接是否指向存在 的文件或目录 返回展开了包含 和 的构造就和 一样 新版功能 解析相对于此路径的通配符 产生所有匹配的文件 模式表示 此目录以及所有子目录递归 换句话说它启用递归 通配 注解 在一个较大的目录树中使用 模式可能会消耗非常多的时间 引发一个 审计事件 附带参数 返回拥有此文件的用户组 如果文件的 无法在系统数据库中找到将抛 出 如果路径指向一个目录或者一个指向目录的符号链接则返回 如 果指向其他类型的文件则返回 当路径不存在或者是一个破损的符号链接时也会返回 其他错误 例如权限错误被传播 如果路径指向一个正常的文件或者一个指向正常文件的符号链接则返回 如果指向其他类型的文件则返回 当路径不存在或者是一个破损的符号链接时也会返回 其他错误 例如权限错误被传播 如果路径是一个 挂载点 在文件系统中被其他不同的文件 系统挂载的地点 在 系统此函数检查 的父级 是否处于一个和 不同的设备中或者 和 是否指向相同设备的相同 这能检测所有 以及 变种上的挂载点 上未实现 新版功能 如果路径指向符号链接则返回 否则 如果路径不存在也返回 其他错误例如权限错误被传播 如果路径指向一个 文件或者指向 文件的符号 链接则返回 如果指向其他类型的文件则返回 当路径不存在或者是一个破损的符号链接时也会返回 其他错误 例如权限错误被传播 如果路径指向一个先进先出存储或者指向先进先出存储的符号链接则返 回 指向其他类型的文件则返回 当路径不存在或者是一个破损的符号链接时也会返回 其他错误 例如权限错误被传播 如果文件指向一个块设备或者指向块设备的符号链接则返回 指 向其他类型的文件则返回 当路径不存在或者是一个破损的符号链接时也会返回 其他错误 例如权限错误被传播 如果路径指向一个字符设备或指向字符设备的符号链接则返回 指向其他类型的文件则返回 当路径不存在或者是一个破损的符号链接时也会返回 其他错误 例如权限错误被传播 当路径指向一个目录时产生该路径下的对象的路径 子条目会以任意顺序生成并且不包括特殊条目 和 如果有 文件在迭代器创建之后在目录中被移除或添加是否要包括该文件对应的路 径对象并没有规定 就像 但是如果路径指向符号链接则是修改符号链接的模式 而不是修改符号链接的目标 就和 一样但是如果路径指向符号链接则是返回符号链接 而不是目标的信息 新建给定路径的目录 如果给出了 它将与当前进程的 值 合并来决定文件模式和访问标志 如果路径已经存在则抛出 如果 为 任何找不到的父目录都会伴随着此路径被创建 它们会以默认权限被创建而不考虑 设置模仿 的 命令 如果 为 默认则找不到的父级目录会导致 被抛出 如果 为 默认则在目标已存在的情况下抛出 如果 为 则 异常将被忽略和 命令行为相同但是只有在最后一个路径组件不是现存 的非目录文件时才生效 在 版更改 形参被加入 打开路径指向的文件就像内置的 函数所做的一样 返回拥有此文件的用户名 如果文件的 无法在系统数据库中找到则抛 出 以字节对象的形式返回路径指向的文件的二进制内容 新版功能 以字符串形式返回路径指向的文件的解码后文本内容 文件先被打开然后关闭 有和 一样的可选形参 新版功能 返回符号链接所指向的路径即 的返回值 新版功能 将文件或目录重命名为给定的 并返回一个新的指向 的 实例 在 上如果 存在且为一个文件如果用户有 足够权限则它将被静默地替换 可以是一个字符串或者另一个 路径对象 目标路径可能为绝对或相对路径 相对路径将被解释为相对于当前工作目录 而 不是 相对于 对象的目录 在 版更改 添加了返回值返回新的 实例 将文件名目录重命名为给定的 并返回一个新的指向 的 实例 如果 指向一个现有文件或目录则它将被无条件地 替换 目标路径可能为绝对或相对路径 相对路径将被解释为相对于当前工作目录 而 不是 相对于 对象的目录 在 版更改 添加了返回值返回新的 实例 将路径绝对化解析任何符号链接 返回新的路径对象 组件也将被消除只有这一种方法这么做 如果路径不存在并且 设为 则抛出 如果 为 则路径将被尽可能地解析并且任何剩余部分 都会被不检查是否存在地追加 如果在解析路径上发生无限循环则抛出 新版功能 加入 参数 之前的版本相当于 值为 这就像调用 时在给定的相对 前面添加了 引发一个 审计事件 附带参数 移除此目录 此目录必须为空的 返回此目录是否指向与可能是字符串或者另一个路径对象的 相同的文件 语义类似于 与 如果两者都以同一原因无法访问则抛出 新版功能 将此路径创建为指向 的符号链接 在 下如果链接的目 标是一个目录则 必须为 默认为 在 下 的值将被忽略 注解 参数的顺序 和 是相反的 将给定的路径创建为文件 如果给出了 它将与当前进程的 值合并以确定文件的模式和访问标志 如果文件已经存在则当 为 则函数仍会成功并且将它的修改事件更新为当前事件否则抛 出 移除此文件或符号链接 如果路径指向目录则用 代替 如果 为假值默认则如果路径不存在将会引发 如果 为真值则 异常将被忽略和 命令的行为相同 在 版更改 增加了 形参 创建一个指向名为 的路径的硬链接 新版功能 将文件以二进制模式打开写入 并关闭 一个同名的现存文件将被覆盖 新版功能 将文件以文本模式打开写入 并关闭 同名的现有文件会被覆盖 可选形参的含义与 的相同 新版功能 对应的 模块的工具 以下是一个映射了 与 对应相同的函数的表 注解 尽管 和 拥有相同的重叠 的用例但是它们语义相差很大不能认为它们等价 和 和 对象库 新版功能 源代码 是一个用于测试的 库 它允许使用 对象替换受测试系统的部分并对它们如何已经被使用进行断言 提供了一个核心类 用于消除了在整个测试套件中创建大量存根 的需求 创建后就可以断言调用了哪些方法属性及其参数 还可以以常规方式指定返回值并设置所需的属性 此外 提供了用于修补测试范围内模块和类级别属性的 装饰器和用于创建独特对象的 阅读 中的案例了解如何使用 和 是为 而设计且简单易用 模拟基于 模式而不是许多模拟框架所使用的 模式 在 的早期版本要单独使用 在 获取 快速上手 类 是一个可以灵活的替换存根 的对象可以测试所有代码 是可调用的在访问其属性时创建一个新的 访问相同的属性只会返回相同的 会保存调用记录可以通过断言获悉代码的调用 是 的子类它有所有预创建且可使用的魔术方法 在需要模拟不可调用对象时可以使用 和 装饰器便于 对象临时替换特定模块中的类 默认创建 可以使用 方法的 参数指定 的替代类 创建一个新的 对象 通过可选参数指定 对象的行为 新版功能 新版功能 新版功能 新版功能 在 版更改 注解 在 版更改 注解 在 版更改 新版功能 注解 注解 在 版更改 在 版更改 在 版更改 警告 注解 在 版更改 在 版更改 例如 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 新版功能 版后已移除 版后已移除 版后已移除 版后已移除 示例 版后已移除 示例 版后已移除 与 中的所有的其它对象一样旧的对象只有在引用计数为 之后才会 被回收 模块命名空间中的名称重新指向任何新的或更改后的对象 其他旧对象的引用例如那个模块的外部名称不会被重新绑定到引用的 新对象的并且如果有需要必须在出现的每个命名空间中进行更新 有一些其他注意事项 当一个模块被重新加载的时候它的字典包含了那个模块的全区变量会 被保留 名称的重新定义会覆盖旧的定义所以通常来说这不是问题 如果 一个新模块没有定义在旧版本模块中定义的名称则将保留旧版本中的定义 这一特性可用于作为那个模块的优点如果它维护一个全局表或者对象的 缓存 使用 语句就可以测试表的存在并且跳过它的初始化如果 有需要的话 如果一个模块创建一个类的实例重新加载定义那个类的模块不影响这个实 例的方法定义 它们继续使用旧类的定义 对于子类也是一样的 在 版更改 版后已移除 新版功能 在 版更改 版后已移除 在 版更改 在 版更改 版后已移除 版后已移除 在 版更改 版后已移除 在 版更改 版后已移除 在 版更改 版后已移除 版后已移除 版后已移除 版后已移除 版后已移除 版后已移除 版后已移除 在 版更改 版后已移除 示例 生成与解析 文件 示例 生成一个 解析一个 处理模块 源码 用于处理 的 接口分组在 包中 警告 模块对于错误或恶意构造的数据是不安全的 如果你需要解析不受信任 或未经身份验证的数据请参阅 漏洞 和 包 部分 值得注意的是 包中的模块要求至少有一个 兼容的 解析器可用 解析器包含在 中因此 模块将始终可用 和 包的文档是 和 接口的 绑定的定义 处理子模块包括 一个简单而轻量级的 处理 器 定义 最小的 实现 支持构建部分 树 基类和便利函数 解析器绑定 漏洞 处理模块对于恶意构造的数据是不安全的 攻击者可能滥用 功能来执行拒绝服务攻击 访问本地文件 生成与其它计算机的网络连接或绕过防火墙 下表概述了已知的攻击以及各种模块是否容易受到攻击 种类 易受攻击 易受攻击 易受攻击 易受攻击 易受攻击 易受攻击 易受攻击 易受攻击 易受攻击 易受攻击 安全 安全 安全 安全 安全 安全 安全 安全 安全 安全 安全 安全 安全 安全 易受攻击 不会扩展外部实体并在实体发生时引发 不会扩展外部实体只是简单地返回未扩展的实体 不扩展外部实体并省略它们 从 开始默认情况下不再处理外部通用实体 狂笑递归实体扩展 攻击 也称为递归实体扩展 使用多级嵌套实体 每 个实体多次引用另一个实体最终实体定义包含一个小字符串 指数级扩展 导致几千 的文本并消耗大量内存和 时间 二次爆炸实体扩展 二次爆炸攻击类似于 攻击它也滥用实体扩展 它不是嵌 套实体而是一遍又一遍地重复一个具有几千个字符的大型实体 攻击不如 递归情况有效但它避免触发禁止深度嵌套实体的解析器对策 实体声明可以包含的不仅仅是替换文本 它们还可以指向外部资源或本地文 件 解析器访问资源并将内容嵌入到 文档中 的一些 库 从远程或本地位置检索文档类型 定义 该功能与外部实体扩展问题具有相似的含义 解压炸弹又名 适用于所有可以解析压 缩 流例如 压缩的 流或 压缩的文件的 库 对于攻击者来说它可以将传输的数据量减少三个量级或更多 上 的文档包含有关所有已知攻击向量的更多信息以及示例和参考 包 是一个纯 软件包它修改了所有标准库 解析器的子类可以防止任何潜在的恶意操作 对于解析不受信任的 数据的任何服务器代码建议使用此程序包 该软件包还提供了有关更多 漏洞如 注入的示例漏洞和扩展文档 新版功能 为 语句上下文提供的工具 源代码 此模块为涉及 语句的常见任务提供了实用的工具 更多信息请参见 上下文管理器类型 和 语句上下文管理器 工具 例子和配方 参见 语句 语句的规范描述 背景和示例 关于复数的数学函数 这一模块提供了一些关于复数的数学函数 该模块的函数的参数为整数 浮点数或复数 这些函数的参数也可为一个拥有 或 方法的 对象这些方法分别用于将对象转换为复数和浮点数这些函数作用于转换后的结果 注解 在具有对于有符号零的硬件和系统级支持的平台上涉及支割线的函数在支割 线的 两侧 都是连续的零的符号可用来区别支割线的一侧和另一侧 在 不支持有符号零的平台上连续性的规则见下文 到极坐标和从极坐标的转换 使用 矩形坐标 或 笛卡尔坐标 在内部存储 复数 这完全取决于它的 实部 和 虚部 换句话说 极坐标 提供了另一种复数的表示方法 在极坐标中一个复数 由模量 和相位角 来定义 模量 是从 到坐标原点的距离而相位角 是以弧度为单位的逆时针的从正 轴到连接原点和 的线段间夹角的角度 下面的函数可用于原生直角坐标与极坐标的相互转换 将 的相位 也称为 的 参数 返回为一个浮点数 相当于 结果处于 之间以 及这个操作的分支切断处于负实轴上从上方连续 在支持有符号零的系统 上这包涵大多数当前的常用系统这意味着结果的符号与 的 符号相同即使 的值是 注解 一个复数 的模数绝对值可以通过内置函数 计算 没有单独 的 模块函数用于这个操作 在极坐标中返回 的表达方式 返回一个数对 是 的模数 是 的相位角 相当于 通过极坐标的 和 返回复数 相当于 幂函数与对数函数 返回 的 次方 是自然对数的底数 返回给定 的 的对数 如果没有给定 返回 的自然 对数 从 到 存在一条支割线沿负实轴之上连续 返回底数为 的 的对数 它具有与 相同的支割线 返回 的平方根 它具有与 相同的支割线 三角函数 返回 的反余弦 这里有两条支割线一条沿着实轴从 向右延伸到 从下面连续延伸 另外一条沿着实轴从 向左延伸到 从上面连续延 伸 返回 的反正弦 它与 有相同的支割线 返回 的反正切 它具有两条支割线一条沿着虚轴从 延伸到 向右持续延伸 另一条是沿着虚轴从 延伸到 向左持 续延伸 返回 的余弦 返回 的正弦 返回 的正切 双曲函数 返回 的反双曲余弦 它有一条支割线沿着实轴从 到 向左延伸 从上方持续延伸 返回 的反双曲正弦 它有两条支割线一条沿着虚轴从 向右持续 延伸到 另一条是沿着虚轴从 向左持续延伸到 返回 的反双曲正切 它有两条支割线一条是沿着实轴从 延展到 从下面持续延展 另一条是沿着实轴从 延展到 从上面持 续延展 返回 的双曲余弦值 返回 的双曲正弦值 返回 的双曲正切值 分类函数 如果 的实部和虚部都是有限的则返回 否则返回 新版功能 如果 的实部或者虚部是无穷大的则返回 否则返回 如果 的实部或者虚部是 则返回 否则返回 若 和 的值比较接近则返回 否则返回 根据给定的绝对和相对容差确定两个值是否被认为是接近的 是相对容差 它是 和 之间允许的最大差值相对于 或 的较大绝对值 例如要设置 的容差请传递 默认容差为 确保两个值在大约 位十进制数字 内相同 必须大于零 是最小绝对容差 对于接近零的比较很有用 必须 至少为零 如果没有错误发生结果将是 特殊值 和 将根据 规则处理 具体 来说 不被认为接近任何其他值包括 和 只被认为接近自己 新版功能 参见 用于测试近似相等的函数 常数 数学常数 作为一个浮点数 数学常数 作为一个浮点数 数学常数 作为一个浮点数 新版功能 浮点正无穷大 相当于 新版功能 具有零实部和正无穷虚部的复数 相当于 新版功能 浮点非数字 值 相当于 新版功能 具有零实部和 虚部的复数 相当于 新版功能 请注意函数的选择与模块 中的函数选择相似但不完全相同 拥有两个模块的原因是因为有些用户对复数不感兴趣甚至根本不知道它们是什么 它们宁愿 引发异常也不想返回一个复数 另请注意被 定义的函数始终会返回一个复数尽管答案可以表示为一个实数在这种情况下复数的虚数部分为零 关于支割线的注释它们是沿着给定函数无法连续的曲线 它们是许多复变函数的必要特征 假设您需要使用复变函数进行计算您将会了解支割线的概念 请参阅几乎所有关于复变函数的不太基本的书来获得启发 对于如何正确地基于数值目的来选择支割线的相关信息一个良好的参考如下参见 表示一封电子邮件信息 读写 文件 对象 返回采样字节长度 返回采样频率 返回音频总帧数 返回一个 与 方法的输出相同 设置当前文件指针位置 以下两个方法都使用指针具体实现由其底层决定 返回 引发错误异常 对象 设置声道数 在 版更改 写入音频数据但不更新 在 版更改 现在可接受任意 写入音频数据并更新 在 版更改 现在可接受任意 标准库 语言参考 描述了 语言的具体语法和语义这份库参考则介绍了与 一同发行的标准库 它还描述了通常包含在 发行版中的一些可选组件 标准库非常庞大所提供的组件涉及范围十分广泛正如以下内容目录所显示的 这个库包含了多个内置模块 以 编写 程序员必须依靠它们来实现系统级功能例如文件 此外还有大量以 编写的模块提供了日常编程中许多问题的标准解决方案 其中有些模块经过专门设计通过将特定平台功能抽象化为平台中立的 来鼓励和加强 程序的可移植性 版本的 安装程序通常包含整个标准库往往还包含许多额外组件 对于类 操作系统 通常会分成一系列的软件包因此可能需要使用操作系统所提供的包管理工具来获取部分或全部可选组件 在这个标准库以外还存在成千上万并且不断增加的其他组件 从单独的程序 模块 软件包直到完整的应用开发框架访问 包索引 即可获取这些第三方包 概述 可用性注释 内置函数 内置常量 由 模块添加的常量 内置类型 逻辑值检测 布尔运算 比较 数字类型 迭代器类型 序列类型 文本序列类型 二进制序列类型 集合类型 映射类型 上下文管理器类型 其他内置类型 特殊属性 内置异常 基类 具体异常 警告 异常层次结构 文本处理服务 常见的字符串操作 正则表达式操作 计算差异的辅助工具 文本自动换行与填充 数据库 因特网字符串预备 接口 的补全函数 二进制数据服务 将字节串解读为打包的二进制数据 编解码器注册和相关基类 数据类型 基本的日期和时间类型 时区支持 日历相关函数 容器数据类型 容器的抽象基类 堆队列算法 数组二分查找算法 高效的数值数组 弱引用 动态类型创建和内置类型名称 浅层 和深层 复制操作 数据美化输出 另一种 实现 对枚举的支持 数字和数学模块 数字的抽象基类 数学函数 关于复数的数学函数 十进制定点和浮点运算 分数 生成伪随机数 数学统计函数 函数式编程模块 为高效循环而创建迭代器的函数 高阶函数和可调用对象上的操作 标准运算符替代函数 文件和目录访问 面向对象的文件系统路径 常用路径操作 迭代来自多个输入流的行 解析 结果 文件及目录的比较 生成临时文件和目录 风格路径名模式扩展 文件名模式匹配 随机读写文本行 高阶文件操作 数据持久化 对象序列化 注册配合 模块使用的函数 对象持久化 内部 对象序列化 数据库 接口 数据库 接口模块 数据压缩和存档 与 兼容的压缩 对 格式的支持 对 压缩算法的支持 用 算法压缩 使用 存档 读写 归档文件 文件格式 文件读写 配置文件解析器 文件处理 编码与解码 数据 生成与解析 文件 加密服务 安全哈希与消息摘要 基于密钥的消息验证 生成安全随机数字用于管理密码 通用操作系统服务 多种操作系统接口 处理流的核心工具 时间的访问和转换 命令行选项 参数和子命令解析器 风格的命令行选项解析器 的日志记录工具 日志记录配置 日志处理程序 便携式密码输入工具 终端字符单元显示的处理 用于 程序的文本输入控件 用于 字符的工具 的面板栈扩展 获取底层平台的标识数据 标准 系统符号 的外部函数库 并发执行 基于线程的并行 基于进程的并行 可从进程直接访问的共享内存 包 启动并行任务 子进程管理 事件调度器 一个同步的队列类 底层多线程 上下文变量 上下文变量 手动上下文管理 支持 网络和进程间通信 异步 底层网络接口 套接字对象的 包装器 等待 完成 高级 复用库 异步 处理器 异步 指令响应 处理器 设置异步事件处理程序 内存映射文件支持 互联网数据处理 电子邮件与 处理包 编码和解码器 文件处理 数据编码 对 文件进行编码和解码 二进制和 码互转 编码与解码经过 转码的可打印数据 对 文件进行编码与解码 结构化标记处理工具 超文本标记语言支持 简单的 和 解析器 一般实体的定义 处理模块 工具集 互联网协议和支持 方便的 浏览器控制器 用于 脚本的回溯管理器 处理模块 用于打开 的可扩展库 使用的 类 引发的异常类 语法分析程序 模块 协议客户端 协议客户端 协议客户端 服务器 服务器 状态管理 客户端的 处理 服务端与客户端模块 操作库 多媒体服务 处理原始音频数据 读写 和 文件 读写 文件 读写 格式文件 读取 分块数据 颜色系统间的转换 推测图像类型 推测声音文件的类型 国际化 多语种国际化服务 国际化服务 程序框架 海龟绘图 支持面向行的命令解释器 图形用户界面 的 接口 颜色选择对话框 字体封装 对话框 消息提示 滚动文字控件 拖放操作支持 主题部件 其他图形用户界面 包 开发工具 类型标注支持 文档生成器和在线帮助系统 测试交互性的 示例 单元测试框架 对象库 上手指南 自动将 代码转为 代码 回归测试包 调试和分析 审计事件表 的调试器 分析器 测量小代码片段的执行时间 跟踪 语句执行 跟踪内存分配 软件打包和分发 构建和安装 模块 创建虚拟环境 运行时服务 系统相关的参数和函数 内建对象 顶层脚本环境 数据类 为 语句上下文提供的工具 抽象基类 退出处理器 打印或检索堆栈回溯 语句定义 垃圾回收器接口 检查对象 指定域的配置钩子 自定义 解释器 解释器基类 编译 代码 导入模块 从 存档中导入模块 包扩展工具 查找脚本使用的模块 的实现 语言服务 访问 解析树 抽象语法树 与 解析树一起使用的常量 与 解析树一起使用的常量 检验 关键字 对 代码使用的标记解析器 模糊缩进检测 模块浏览器支持 编译 源文件 字节码反汇编器 开发者工具集 杂项服务 通用格式化输出 系统相关模块 来自 运行时的有用例程 注册表访问 专有服务 最常见的 系统调用 用户密码数据库 组数据库 风格的 控制 终端控制功能 伪终端工具 终端管道接口 的 黄页 接口 库例程 被取代的模块 解析器的命令行选项 未创建文档的模块 平台特定模块 新版功能 新版功能 新版功能 新版功能 新版功能 脚注 日志处理程序 源代码 此页面仅包含参考信息 有关教程请参阅 基础教程 进阶教程 日志记录操作手册这个包提供了以下有用的处理程序 请注意有三个处理程序类 和 实际上是在 模块本身定义的但其文档与其他处理程序一同记录在此 类位于核心 包它可将日志记录输出发送到数据流例如 或任何文件类对象或者更精确地说任何支持 和 方法的对象 返回一个新的 类 如果指定了 则实例将用它 作为日志记录输出在其他情况下将使用 如果指定了一个格式化器它会被用来格式化记录 随后记录会被写入 到 之后的流中 如果存在异常信息则会使用 来格式化并添加到流中 通过调用流的 方法来刷新它 请注意 方法是继 承自 的所以没有输出因此有时可能需要显式地调用 将实例的流设为指定值如果两者不一致的话 旧的流会在设置新的流 之前被刷新 参数 处理程序应当使用的流 返回 旧的流如果流已被改变的话如果未被改变则为 新版功能 当将已格式化的记录写入到流时被用作终止符的字符串 默认值为 如果你不希望以换行符终止你可以将处理程序类实例的 属性设为空字符串 在较早的版本中终止符被硬编码为 新版功能 类位于核心 包它可将日志记录输出到磁盘文件中 它从 继承了输出功能 返回一个 类的新实例 将打开指定的文件并将其用作日志 记录流 如果未指定 则会使用 如果 不为 则会将其用作打开文件的编码格式 如果 为真值则文 件打开会被推迟至第一次调用 时 默认情况下文件会无限增长 如果指定了 它会被用于确定编码格式错误的处理方式 在 版更改 除了字符串值也接受 对象作为 参数 在 版更改 增加了 形参 关闭文件 将记录输出到文件 新版功能 类位于核心 包它不执行任何格式化或输出 它实际上是一个供库开发者使用的 无操作 处理程序 返回一个 类的新实例 此方法不执行任何操作 此方法不执行任何操作 此方法会对锁返回 因为没有下层 的访问需要被序列化 请参阅 配置库的日志记录 了解有关如何使用 的更多信息 类位于 模块这个 用于监视它所写入日志记录的文件 如果文件发生变化它会被关闭并使用文件名重新打开 发生文件更改可能是由于使用了执行文件轮换的程序例如 和 这个处理程序在 下使用它会监视文件来查看自上次发出数据后是否有更改 如果文件的设备或 发生变化就认为已被更改 如果文件被更改则会关闭旧文件流并再打开文件以获得新文件流 这个处理程序不适合在 下使用因为在 下打开的日志文件无法被移动或改名 日志记录会使用排他的锁来打开文件 因此这样的处理程序是没有必要的 此外 在 下不受支持 将总是为该值返回零 返回一个 类的新实例 将打开指定的文件并将其用 作日志记录流 如果未指定 则会使用 如果 不为 则会将其用作打开文件的编码格式 如果 为真值 则文件打开会被推迟至第一次调用 时 默认情况下文件会无限 增长 如果提供了 它会被用于确定编码格式错误的处理方式 在 版更改 除了字符串值也接受 对象作为 参数 在 版更改 增加了 形参 检查文件是否已更改 如果已更改则会刷新并关闭现有流然后重新打 开文件这通常是将记录输出到文件的先导操作 新版功能 将记录输出到文件但如果文件已更改则会先调用 来重新打开它 类位于 模块它会将日志记录输出发送到网络套接字 基类所使用的是 套接字 返回一个 类的新实例该实例旨在与使用 与 给定地址的远程主机进行通信 在 版更改 如果 指定为 会使用 中的值来创 建一个 域套接字 在其他情况下则会创建一个 套接字 关闭套接字 对记录的属性字典执行封存并以二进制格式将其写入套接字 如果套接 字存在错误则静默地丢弃数据包 如果连接在此之前丢失则重新建 立连接 要在接收端将记录解封并输出到 请使用 函数 处理在 期间发生的错误 最可能的原因是连接丢失 关闭套 接字以便我们能在下次事件时重新尝试 这是一个工厂方法它允许子类定义它们想要的套接字的准确类型 默 认实现会创建一个 套接字 将记录的属性字典封存为带有长度前缀的二进制格式并将其返回以准备 通过套接字进行传输 此操作在细节上相当于 请注意封存操作不是绝对安全的 如果你关心安全问题你可能会想要 重载此方法以实现更安全的机制 例如你可以使用 对封存对象 进行签名然后在接收端验证它们或者你也可以在接收端禁用全局对象的 解封操作 将封存后的字节串 发送到套接字 所发送字节串的格式与 文档中的描述一致 此函数允许部分发送这可能会在网络繁忙时发生 尝试创建一个套接字失败时将使用指数化回退算法处理 在失败初次 发生时处理程序将丢弃它正尝试发送的消息 当后续消息交由同一实 例处理时它将不会尝试连接直到经过一段时间以后 默认形参设置为 初始延迟一秒如果在延迟之后连接仍然无法建立处理程序将每次把延 迟翻倍直至达到 秒的最大值 此行为由下列处理程序属性控制 初始延迟默认为 秒 倍数默认为 最大延迟默认为 秒 这意味着如果远程监听器在处理程序被使用 之后 启动你可能会丢失 消息因为处理程序在延迟结束之前甚至不会尝试连接而在延迟期间静 默地丢弃消息 类位于 模块它继承自 支持通过 套接字发送日志记录消息 返回一个 类的新实例该实例旨在与使用 与 给定地址的远程主机进行通信 在 版更改 如果 指定为 会使用 中的值来创 建一个 域套接字 在其他情况下则会创建一个 套接字 对记录的属性字典执行封存并以二进制格式将其写入套接字 如果套接 字存在错误则静默地丢弃数据包 要在接收端将记录解封并输出到 请使用 函数 的工厂方法会在此被重载以创建一个 套接字 将封存后的字节串发送到套接字 所发送字节串的格式与 文档中的描述一致 类位于 模块它支持将日志记录消息发送到远程或本地 返回一个 类的新实例用来与通过 以 元组形式给出地址的远程 机器进行通讯 如果未指定 则使用 该地址会被用于打开套接字 提供 元组的一种替代方式是提供字符串形式的地址例如 在这种情况下会使用 域套接字将消息发送到 如果未指定 则使用 打开的套接字类型取决 于 参数该参数的默认值为 即打开一个 套接字 要打开一个 套接字用来配合较新的 守护程序 例如 使用请指定值为 请注意如果你的服务器不是在 端口 上进行侦听则 可能无法正常工作 在这种情况下请检查你应当为域套 接字所使用的地址 它依赖于具体的系统 例如在 上通常为 而在 上则为 你需要检查你的系统 平台并使用适当的地址如果你的应用程序需要在多个平台上运行则可能需 要在运行时进行这样的检查 在 上你大概必须要使用 选 项 在 版更改 添加了 关闭连接远程主机的套接字 记录会被格式化然后发送到 服务器 如果存在异常信息则 它 不会 被发送到服务器 在 版更改 参见 在较早的版本中发送至 守护程序的消息总是以一个 字节结束因为守护程序的早期 版本期望接收一个以 结束的消息 即使它不包含于对应的规范说 明 这些守护程序的较新版本不再期望接收 字节 如果其存在则会将其去除而最新的守护程序更紧密地遵循 会将 字节作为消息的一部分传递出去 为了在面对所有这些 不同守护程序行为时能够更方便地处理 消息通过使用类层级属 性 添加 字节的操作已被作为可配置项 该属性默 认为 保留现有行为 但可在 实例上设为 以便让实例 不会 添加 结束符 在 版更改 参见 在较早的版本中没有 或 前缀工具可以用来标识消息的来源 现在则可以使用一个类层 级属性来设置它该属性默认为 表示保留现有行为但可在 实例上重载以便让实例不会为所处理的每条消息添加标 识 请注意所提供的标识必须为文本而非字节串并且它会被原封不动 地添加到消息中 将功能和优先级编码为一个整数 你可以传入字符串或者整数 如果 传入的是字符串则会使用内部的映射字典将其转换为整数 符号 的值在 中定义并且是 头文件中所定义值的镜像 优先级 名称字符串 符号值 或 或 或 或 设备 名称字符串 符号值 将日志记录级别名称映射到 优先级名称 如果你使用自定义级 别或者如果默认算法不适合你的需要你可能需要重载此方法 默认 算法将 和 映射到 等价的 名称并将所有其他级别名称映射到 类位于 模块它支持将日志记录消息发送到本地 或 事件日志 在你使用它之前你需要安装 的 扩展 返回一个 类的新实例 用来定义出现在 事件日志中的应用名称 将使用此名称创建适当的注册表条目 应当给出要包含在日志中的消息定义的 或 的完整限定路径名称 如未指定则会使用 此文件随 扩展安装 且包含一些基本的消息定义占位符 请注意使用这些占位符将使你的事件日 志变得很大因为整个消息源都会被放入日志 如果你希望有较小的日志 你必须自行传入包含你想要在事件日志中使用的消息定义的 或 名称 为 或 之一且默认值为 这时你就可以从注册表中移除作为事件日志条目来源的应用名称 但 是如果你这样做你将无法如你所预期的那样在事件日志查看器中看到 这些事件 它必须能访问注册表来获取 名称 当前版本并不会 这样做 确定消息 事件类别和事件类型然后将消息记录到 事件日志中 返回记录的事件类别 如果你希望指定你自己的类别就要重载此方法 此版本将返回 返回记录的事件类型 如果你希望指定你自己的类型就要重载此方法 此版本将使用处理程序的 属性来执行映射该属性在 被设置为一个字典其中包含 和 的映射 如果你使用你自己的级别 你将需要重载此方法或者在处理程序的 属性中放置一个合 适的字典 返回记录的消息 如果你使用你自己的消息你可以通过将 传给日志记录器作为 而非格式字符串实现此功能 然后你可以在 这里使用字典查找来获取消息 此版本将返回 是 中的基本消息 类位于 模块它支持将日志记录消息通过 发送到一个电子邮件地址 返回一个 类的新实例 该实例使用电子邮件的发件人 收 件人地址和主题行进行初始化 应当为字符串列表 要指定一 个非标准 端口请使用 元组格式作为 参 数 如果你使用一个字符串则会使用标准 端口 如果你的 服务器要求验证你可以指定一个 元组作为 参数 要指定使用安全协议 请传入一个元组作为 参数 这将仅 在提供了验证凭据时才能被使用 元组应当或是一个空元组或是一个包含 密钥文件名的单值元组或是一个包含密钥文件和证书文件的 值元组 此元组会被传给 方法 可以使用 参数为与 服务器的通信指定超时限制 新版功能 增加了 参数 对记录执行格式化并将其发送到指定的地址 如果你想要指定一个基于记录的主题行请重载此方法 类位于 模块它支持在内存中缓冲日志记录并定期将其刷新到 处理程序中 刷新会在缓冲区满的时候或是在遇到特定或更高严重程度事件的时候发生 是更通用的 的子类后者属于抽象类 它会在内存中缓冲日志记录 当每条记录被添加到缓冲区时会通过调用 来检查缓冲区是否应当刷新 如果应当刷新则要使用 来执行刷新 使用指定容量的缓冲区初始化处理程序 这里 是指缓冲的日 志记录数量 将记录添加到缓冲区 如果 返回真值则会调用 来处理缓冲区 你可以重载此方法来实现自定义的刷新行为 此版本只是将缓冲区清空 如果缓冲区容量已满则返回 可以重载此方法以实现自定义的刷 新策略 返回一个 类的新实例 该实例使用 指定的 缓冲区大小要缓冲的记录数量来初始化 如果 未指定 则使用 如果未指定 则需要在此处理程序执行任何实 际操作之前使用 来设置目标 如果 指定 为 则当处理程序被关闭时 不会 刷新缓冲区 如果未指定或指 定为 则当处理程序被关闭时将会发生之前的缓冲区刷新行为 在 版更改 增加了 形参 调用 设置目标为 并清空缓冲区 对于 刷新是指将缓冲的记录发送到目标如果存在目 标的话 当此行为发生时缓冲区也将被清空 如果你想要不同的行为请 重载此方法 设置此处理程序的目标处理程序 检测缓冲区是否已满或是有记录为 或更高级别 新版功能 类位于 模块它支持从一个队列接收日志记录消息例如在 或 模块中实现的队列 消息是在内部线程中从队列接收并在同一线程上传递到一个或多个处理程序进行处理的 尽管 本身并不是一个处理程序但由于它要与 配合工作因此也在此处介绍 配合 类使用 可用来使处理程序在与执行日志记录的线程不同的线程上完成工作 这对 应用程序以及其他服务与客户端的线程需要尽可能快地响应的服务应用程序来说很重要任何潜在的慢速动作例如通过 发送邮件都要在单独的线程上完成 返回一个 类的新实例 该实例初始化时要传入一个队列 以向其发送消息还要传入一个处理程序列表用来处理放置在队列中的条目 队列可以是任何队列类对象它会被原样传给 方法该方 法需要知道如何从其获取消息 队列 不要求 具有任务跟踪 但如提 供则会使用它这意味着你可以为 使用 实例 如果 为 则在决定是否将消息传递给处 理程序之前会遵循处理程序的级别与消息的级别进行比较在其他情况 下其行为与之前的 版本一致 总是将每条消息传递给每个处理 程序 在 版更改 增加了 参数 从队列移出一条记录并将其返回可以选择阻塞 基本实现使用 如果你想要使用超时设置或自定义的队列实现 则你可能会想要重载此方法 准备一条要处理的记录 该实现只是返回传入的记录 如果你想要对记录执行任何自定义的 操作或在将其传给处理程序之前进行调整则你可能会想要重载 此方法 处理一条记录 此方法简单地循环遍历处理程序向它们提供要处理的记录 实际传给 处理程序的对象就是从 返回的对象 启动监听器 此方法启动一个后台线程来监视 队列以进行处理 停止监听器 此方法要求线程终止然后等待它完成终止操作 请注意在你的应用程 序退出之前如果你没有调用此方法则可能会有一些记录在留在队列中 它们将不会被处理 将一个标记写入队列以通知监听器退出 此实现会使用 如果你想要使得超时设置或自定义的队列实现则你可能会想要重载 此方法 新版功能 参见 模块 日志记录模块的 参考 模块 日志记录模块的配置 多媒体服务 本章描述的模块实现了主要用于多媒体应用的各种算法或接口 它们可在安装时自行决定 这是一个概述 处理原始音频数据 读写 和 文件 读写 文件 对象 对象 读写 格式文件 对象 对象 读取 分块数据 颜色系统间的转换 推测图像类型 推测声音文件的类型 对枚举的支持 新版功能 源代码 枚举是一组符号名称枚举成员的集合枚举成员应该是唯一的 不可变的 在枚举中可以对成员进行恒等比较并且枚举本身是可迭代的 注解 枚举成员名称的大小写因为枚举是被用来代表常量的所以我们建议枚举成员名 称应使用大写形式并将在我们的示例中使用此种风格 模块内容 此模块定义了四个枚举类它们可被用来定义名称和值的不重复集合 和 此外还定义了一个装饰器 和一个辅助类 此基类用于创建枚举常量 请参阅 小节了解另一种替代性 的构建语法 此基类用于创建属于 的子类的枚举常量 此基类用于创建可使用按位运算符进行组合而不会丢失其 成员资 格的枚举常量 成员同样也是 的子类 此基类用于创建枚举常量 可使用按位运算符进行组合而不会丢失其 成员资格的枚举常量 此 类装饰器可确保只将一个名称绑定到任意一个值 实例会被替换为一个可作为 成员的适当的值 默认情况下初始值从 开始 新版功能 创建一个 对枚举成员及其属性的程序化访问 复制枚举成员和值 确保唯一的枚举值 默认情况下枚举允许有多个名称作为某个相同值的别名 如果不想要这样的行为可以使用以下装饰器来确保每个值在枚举中只被使用一次 专用于枚举的 装饰器 它会搜索一个枚举的 并收集所找到的任何别名只要找到任何别名就会引发 并附带相关细节信息 使用自动设定的值 如果确切的值不重要你可以使用 值将由 来选择该函数可以被重载 注解 默认 方法的目标是提供所给出的最后一个 所在序列的下一个 但这种行为方式属于实现细节并且可能发生 改变 注解 方法定义必须在任何其他成员之前 迭代 对枚举成员的迭代不会给出别名 特殊属性 是一个从名称到成员的只读有序映射 它包含枚举中定义的所有名称包括别名 属性可被用于对枚举成员进行详细的程序化访问 例如找出所有别名 比较 枚举成员是按标识号进行比较的 枚举值之间的排序比较 不被 支持 成员不属于整数 另请参阅下文的 相等比较的定义如下 与非枚举值的比较将总是不相等同样地 被显式设计成不同的行为参见下文 允许的枚举成员和属性 受限的 子类化 一个新的 类必须基于一个 类至多一个实体数据类型以及出于实际需要的任意多个基于 的 类 这些基类的顺序为 另外仅当一个枚举未定义任何成员时才允许子类化该枚举 因此禁止这样的写法 但是允许这样的写法 允许子类化定义了成员的枚举将会导致违反类型与实例的某些重要的不可变规则 在另一方面允许在一组枚举之间共享某些通用行为也是有意义的 请参阅示例 封存 枚举可以被封存与解封 封存的常规限制同样适用可封存枚举必须在模块的最高层级中定义因为解封操作要求它们可以从该模块导入 注解 使用 协议版本 可以方便地封存嵌套在其他类中的枚举 通过在枚举类中定义 可以对 成员的封存解封方式进行修改 功能性 派生的枚举 所提供的第一个变种 同时也是 的一个子类 的成员可与整数进行比较通过扩展不同类型的整数枚举也可以相互进行比较 不过它们仍然不可与标准 枚举进行比较 值在其他方面的行为都如你预期的一样类似于整数 其他事项 何时使用 与 当你想要定制 成员的实际值时必须使用 任何其他修改可以用 也可以用 应优先使用 举例来说如果你要向构造器传入多个条目但只希望将其中一个作为值 有趣的示例 虽然 和 预期可覆盖大多数应用场景但它们无法覆盖全部 这里有一些不同类型枚举的方案它们可以被直接使用或是作为自行创建的参考示例 省略值 在许多应用场景中人们都不关心枚举的实际值是什么 有几个方式可以定义此种类型的简单枚举 使用 的实例作为值 使用 的实例作为值 使用描述性的字符串作为值 使用元组作为值并用自定义的 以一个 值来替代该元组使用以上任何一种方法均可向用户指明值并不重要并且使人能够添加 移除或重排序成员而不必改变其余成员的数值 无论你选择何种方法你都应当提供一个 并且它也需要隐藏不重要的值 使用 使用 的形式如下 使用 使用 的形式如下 使用描述性字符串使用字符串作为值的形式如下 使用自定义的 使用自动编号 的形式如下 要实现更通用的 请添加 到签名中 这样当你从 继承时你将可以编写你自己的 来处理任何附加参数 注解 如果定义了 则它会在创建 成员期间被使用随后它将被 的 所替换该方法会在类创建后被用来查找现有成员 一个有序枚举它不是基于 因此保持了正常的 不变特性例如不可与其他枚举进行比较 如果发现重复的成员名称则将引发错误而不是创建别名 注解 这个例子适用于子类化 来添加或改变禁用别名以及其他行为 如果需 要的改变只是禁用别名也可以选择使用 装饰器 如果定义了 或 则枚举成员的值将被传给这些方法 一个演示如何使用 属性的例子 各种枚举有何区别 枚举具有自定义的元类它会影响所派生枚举类及其实例成员的各个方面 枚举类 元类负责提供 及其他方法以允许用户通过 类来完成一般类做不到的事情例如 或 会负责确保最终 类中的各种其他方法是正确的 例如 和 枚举成员即实例 有关枚举成员最有趣的特点是它们都是单例对象 会在创建 类本身时将它们全部创建完成然后准备好一个自定义的 通过只返回现有的成员实例来确保不会再实例化新的对象 细节要点 一致性 参见 模块内容 的权威文档是来自 的 规范 请注意 属性也可以作为节点而不是简单的字符串进行操作 然而必须这样做的情况相当少见所以这种用法还没有记录下来 接口 部件 目的 底层实现的接口 节点对象 文档中大多数对象的基本接口 节点列表对象 节点序列的接口 文档类型对象 有关处理文档所需声明的信息 文档对象 表示整个文档的对象 元素对象 文档层次结构中的元素节点 对象 元素节点上的属性值节点 注释对象 源文档中注释的表示形式 和 对象 包含文档中文本内容的节点 对象 另一节描述了在 中使用 定义的异常 节点对象 注解 节点列表对象 文档类型对象 文档对象 元素对象 对象 对象 注释对象 和 对象 注解 对象 异常 常数 异常 一致性 类型映射 将根据下表将 规范中使用的 类型映射为 类型 类型 类型 或 或 常见的字符串操作 源代码 参见 文本序列类型 字符串的方法 字符串常量 此模块中定义的常量为 下文所述 和 常量的拼连 该值不 依赖于语言区域 小写字母 该值不依赖于语言区域不 会发生改变 大写字母 该值不依赖于语言区域不 会发生改变 字符串 字符串 字符串 由在 区域设置中被视为标点符号的 字符所组成的字符串 由被视为可打印符号的 字符组成的字符串 这是 和 的总和 由被视为空白符号的 字符组成的字符串 其中包括空格 制表 换 行 回车 进纸和纵向制表符 自定义字符串格式化 内置的字符串类提供了通过使用 所描述的 方法进行复杂变量替换和值格式化的能力 模块中的 类允许你使用与内置 方法相同的实现来创建并定制你自己的字符串格式化行为 类包含下列公有方法 首要的 方法 它接受一个格式字符串和任意一组位置和关键字参数 它只是一个调用 的包装器 在 版更改 格式字符串参数现在是 仅限位置参数 此函数执行实际的格式化操作 它被公开为一个单独的函数用于需要 传入一个预定义字母作为参数而不是使用 和 语 法将字典解包为多个单独参数并重打包的情况 完成将格 式字符串分解为字符数据和替换字段的工作 它会调用下文所述的几种 不同方法 此外 还定义了一些旨在被子类替换的方法 循环遍历 并返回一个由可迭代对象组成的元组 它 会被 用来将字符串分解为文本字面值或替换字段 元组中的值在概念上表示一段字面文本加上一个替换字段 如果没有字 面文本如果连续出现两个替换字段就会发生这种情况则 将是一个长度为零的字符串 如果没有替换字段则 和 的值将为 给定 作为 见上文 的返回值将其转换为要 格式化的对象 返回一个元组 默认版本接受在 所定义形式的字符串例如 或 和 与传给 的一样 返回值 与 的 形参具有相同的含义 提取给定的字段值 参数将为整数或字符串 如果是整数它表 示 中位置参数的索引如果是字符串它表示 中的关 键字参数名 形参会被设为 的位置参数列表而 形参 会被设为由关键字参数组成的字典 对于复合字段名称仅会为字段名称的第一个组件调用这些函数后续组 件会通过普通属性和索引操作来进行处理 因此举例来说字段表达式 将导致调用 时附 带 参数值 在 通过调用内置的 函数返回后将会查找 属性 如果索引或关键字引用了一个不存在的项则将引发 或 在必要时实现对未使用参数进行检测 此函数的参数是是格式字符串中 实际引用的所有参数键的集合整数表示位置参数字符串表示名称参数 以及被传给 的 和 的引用 未使用参数 的集合可以根据这些形参计算出来 如果检测失败则 应会引发一个异常 会简单地调用内置全局函数 提供该方 法是为了让子类能够重载它 使用给定的转换类型来自 方法所返回的元组来转换由 所返回的值 默认版本支持 和 等转换类型 格式字符串语法 格式规格迷你语言 格式规格在格式字符串所包含的替换字段内部使用用于定义单个值应如何呈现 参见 格式字符串语法 和 格式化字符串字面值 它们也可以被直接传给内置的 函数 每种可格式化的类型都可以自行定义如何对格式规格进行解读 大多数内置类型都为格式规格实现了下列选项不过某些格式化选项只被数值类型所支持 一般约定空的格式描述将产生与在值上调用 相同的结果 非空格式描述通常会修改此结果 标准格式说明符 的一般形式如下 如果指定了一个有效的 值则可以在该值前面加一个 字符它可以为任意字符如果省略则默认为空格符 在 格式化字符串字面值 或在使用 方法时是无法使用花括号字面值 作为 字符的 但是通过嵌套替换字段插入花括号则是可以的 这个限制不会影响 函数 各种对齐选项的含义如下 选项 意义 强制字段在可用空间内左对齐这是大多数对象的默认值 强制字段在可用空间内右对齐这是数字的默认值 强制将填充放置在符号如果有之后但在数字之前 这用于以 形式打印字段 此对齐选项仅对数字类型有效 当 紧接在字 段宽度之前时它成为默认值 强制字段在可用空间内居中 请注意除非定义了最小字段宽度否则字段宽度将始终与填充它的数据大小相同因此在这种情况下对齐选项没有意义 选项仅对数字类型有效可以是以下之一 选项 意义 表示标志应该用于正数和负数 表示标志应仅用于负数这是默认行为 表示应在正数上使用前导空格在负数上使用减号 选项可以让替代形式被用于转换 替代形式可针对不同类型分别定义 此选项仅对整数 浮点 复数和 类型有效 对于整数类型当使用二进制 八进制或十六进制输出时此选项会为输出值添加相应的 或 前缀 对于浮点数 复数和 类型替代形式会使得转换结果总是包含小数点符号即使其不带小数 通常只有在带有小数的情况下此类转换的结果中才会出现小数点符号 此外对于 和 转换末尾的零不会从结果中被移除 选项表示使用逗号作为千位分隔符 对于感应区域设置的分隔符请改用 整数表示类型 在 版更改 添加了 选项 另请参阅 选项表示对浮点表示类型和整数表示类型 使用下划线作为千位分隔符 对于整数表示类型 和 将为每 个数位插入一个下划线 对于其他表示类型指定此选项则将导致错误 在 版更改 添加了 选项 另请参阅 是一个定义最小总字段宽度的十进制整数包括任何前缀 分隔符和其他格式化字符 如果未指定则字段宽度将由内容确定 当未显式给出对齐方式时在 字段前加一个零 字段将为数字类型启用感知正负号的零填充 这相当于设置 字符为 且 类型为 是一个十进制数字表示对于以 格式化的浮点数值要在小数点后显示多少个数位或者对于以 或 格式化的浮点数值要在小数点前后共显示多少个数位 对于非数字类型该字段表示最大字段大小 换句话说就是要使用多少个来自字段内容的字符 对于整数值则不允许使用 最后 确定了数据应如何呈现 可用的字符串表示类型是 类型 意义 字符串格式 这是字符串的默认类型可以省略 和 一样 可用的整数表示类型是 类型 意义 二进制格式 输出以 为基数的数字 字符 在打印之前将整数转换为相应的 字符 十进制整数 输出以 为基数的数字 八进制格式 输出以 为基数的数字 十六进制格式 输出以 为基数的数字使用小写字母表示 以上的数 码 十六进制格式 输出以 为基数的数字使用大写字母表示 以上的数 码 数字 这与 相似不同之处在于它会使用当前区域设置来 插入适当 的数字分隔字符 和 相同 在上述的表示类型之外整数还可以通过下列的浮点表示类型来格式化 除了 和 当这样做时会在格式化之前使用 将整数转换为浮点数 浮点数和小数值可用的表示类型有 类型 意义 指数表示 以使用字母 来标示指数的科学计数法打印数字 默认的精 度为 指数表示 与 相似不同之处在于它使用大写字母 作为分隔字 符 定点表示 将数字显示为一个定点数 默认的精确度为 定点表示 与 相似但会将 转为 并将 转为 常规格式 对于给定的精度 这会将数值舍入到 位有效数字 再将结果以定点格式或科学计数法进行格式化具 体取决于其值的大小 准确的规则如下假设使用表示类型 和精度 进行格式化的结 果具有指数值 那 么如果 其中 以 表示浮 点值而以 表示 值该数字将使用类型 和精度 进行格式化 否则的话该数字将使用表示类型 和精度 进行格式化 在两种情况下都会从有效数字中移除无意 义的末尾零 如果小数点之后没有余下数字则小数点也会被移除 除非使用了 选 项 正负无穷正负零和 会分别 被格式化为 和 无论精度如何 设定 精度 会被视为等同于精度 默认精度为 常规格式 类似于 不同之处在于当数值非常大时会切换 为 无穷与 也会表示为大写形式 数字 这与 相似不同之处在于它会使用当前区域设置来 插入适当 的数字分隔字符 百分比 将数字乘以 并显示为定点 格式后面带 一个百分号 类似于 不同之处在于当使用定点表示法时小数点后将至 少显示一 位 默认精度与表示给定值所需的精度一样 整体效 果为与其他格式修饰 符所调整的 输出保持一致 格式示例 本节包含 语法的示例以及与旧式 格式化的比较 该语法在大多数情况下与旧式的 格式化类似只是增加了 和 来取代 例如 可以被改写为 新的格式语法还支持新增的不同选项将在以下示例中说明 按位置访问参数 按名称访问参数 访问参数的属性 访问参数的项 替代 和 对齐文本以及指定宽度 替代 和 以及指定正负号 替代 和 以及转换基于不同进位制的值 使用逗号作为千位分隔符 表示为百分数 使用特定类型的专属格式化 嵌套参数以及更复杂的示例 模板字符串 辅助函数 使用 将参数拆分为单词使用 将单词 转为大写形式使用 将大写的单词进行拼接 如果可选的第 二个参数 被省略或为 则连续的空白字符会被替换为单个空 格符并且开头和末尾的空白字符会被移除否则 会被用来拆分和拼接 单词 源代码 参见 模块 对象 警告 在 版更改 注解 新版功能 在 版更改 注解 注解 注解 警告 参见 参见 注解 参见 注解 参见 参见 标记 意义 解释 草稿 已标记 标记为重要 已读 转发重新发送或退回 已回复 回复给 查看 读取 已删除 标记为以后删除 实例提供以下方法 注解 结果状态 或 状态 子目录 标记 标记 标记 标记 标记 标记 标记 标记 标记 结果状态 状态 子目录 序列 非 序列 标记 序列 标记 序列 结果状态 状态 子目录 标签 非 标签 标记 或 标签 标记 标签 标记 标签 标记 意义 解释 读取 读取 以前由 检测 已删除 标记为以后删除 已标记 标记为重要 已回复 回复给 结果状态 状态 标记 标记 标记 子目录 标记 标记 标记 标记 标记 标记 结果状态 状态 标记 和 标记 非 序列 标记 序列 标记 序列 标记 序列 结果状态 状态 标记 和 标记 非 标签 标记 标签 标记 标签 标记 标签 结果状态 状态 标记 标记 标记 标记 标记 标记 标记 标记 标记 标记 序列 解释 未读 未读取但先前被 检测到 已回复 回复给 已标记 标记为重要 结果状态 状态 序列 非 标记 序列 标记 序列 标记 结果状态 或 状态 序列 非 标记 序列 标记 序列 标记 结果状态 状态 序列 标签 序列 标签 标签 解释 未读 未读取但先前被 检测到 标记为以后删除 复制到另一个文件或邮箱 回复给 已转发 由用户修改 已重发 返回邮件上的标签列表 将消息上的标签列表设置为 将 添加到消息上的标签列表中 从消息上的标签列表中删除 结果状态 状态 标签 非 标记 标签 标记 标签 标记 标签 标记 结果状态 或 状态 标签 非 标记 标签 标记 标签 标记 结果状态 状态 标签 序列 标签 序列 标记 意义 解释 读取 读取 以前由 检测 已删除 标记为以后删除 已标记 标记为重要 已回复 回复给 结果状态 状态 标记 标记 标记 子目录 标记 标记 标记 标记 标记 标记 结果状态 状态 标记 和 标记 非 序列 标记 序列 标记 序列 标记 序列 结果状态 状态 标记 和 标记 非 标签 标记 标签 标记 标签 标记 标签 结果状态 状态 标记 标记 标记 标记 标记 标记 标记 标记 标记 标记 异常 示例 互联网协议和支持 引发的异常类 源代码 模块为 所引发的异常定义了异常类 基础异常类是 下列异常会被 按需引发 处理程序在遇到问题时会引发此异常或其派生的异常 它是 的一个子类 此错误的原因 它可以是一个消息字符串或另一个异常实例 在 版更改 已被设为 而不是 的子 类 虽然是一个异常 的一个子类 也可以作为一个 非异常的文件类返回值与 返所回的对象相同 这适用于 处理特殊 错误例如作为认证请求的时候 一个 状态码具体定义见 这个数字的值对应于存 放在 代码字典中的 某个值 这通常是一个解释本次错误原因的字符串 导致 的特定 请求的 响应头 新版功能 此异常会在 函数检测到已下载的数据量小于期待的数据量 由 头给定时被引发 属性中将存放已下 载可能被截断的数据 队列集 源代码 队列被设计成与 模块类似 尽管 队列不是线程安全的但是他们是被设计专用于 代码 注意 的队列没有 形参请使用 函数为队列添加超时操作 参见下面的 部分 队列 优先级队列 的变体按优先级顺序取出条目 最小的先取出 条目通常是 形式的元组 后进先出队列 的变体先取出最近添加的条目后进先出 异常 当队列为空的时候调用 方法而引发这个异常 当队列中条目数量已经达到它的 的时候调用 方法而引发的异常 示例 队列能被用于多个的并发任务的工作量分配 终端字符单元显示的处理 模块提供了 库的接口这是可移植高级终端处理的事实标准 虽然 在 环境中使用最为广泛但也有适用于 以及其他可能的系统的版本 此扩展模块旨在匹配 的 这是一个部署在 和 的 变体上的开源 库 注解 每当文档提到 字符 时它可以被指定为一个整数一个单字符 字符串或者一个单字节的字节字符串 每当此文档提到 字符串 时它可 以被指定为一个 字符串或者一个字节字符串 注解 从 版本开始 库使用 函数来决定如何解释非 数据 这意味着你需要在程序中调用 函数并 使用一种系统中可用的编码方法来编码 字符串 这个例子使用了系 统默认的编码 然后使用 作为 调用的编码 参见 模块 在 字符上工作的工具无论你的区域设置是什么 模块 为 窗口添加深度的面板栈扩展 模块 用于使 支持 式绑定的可编辑文本部件 用 进行 编程 关于配合 使用 的教学材料由 和 撰写 源码发布包的 目录包含了一些使用此模块所提供的 绑定的示例程序 函数 对象 常量 终端管道接口 源代码 定义了一个类用来抽象 的概念 将数据从一个文件转到另一文件的转换器序列 由于模块使用了 命令行因此要求有 或兼容 和 的终端程序 模块定义了以下的类 对管道的抽象 示例 模板对象 模板对象有以下方法 将一个管道模板恢复为初始状态 返回一个新的等价的管道模板 如果 为真值则启用调试 否则禁用调试 当启用调试时要执 行的命令会被打印出来并且会给予终端 命令以输出更详细的信 息 在末尾添加一个新的动作 变量必须为一个有效的 终端命令 变量由两个字母组成 第一个字母可以为 这表示命令将读取其标准输入 这表示 命令将读取在命令行中给定的文件 或 这表示命令将不读取输入 因而必须放在前面 类似地第二个字母可以为 这表示命令将写入到标准输出 这表示命令将写入在命令行中给定的文件 或 这表示命令将不执行 写入因而必须放在末尾 在开头添加一个新的动作 请参阅 获取相应参数的说明 返回一个文件类对象打开到 但是将从管道读取或写入 请注意 只能给出 中的一个 通过管道将 拷贝到 颜色系统间的转换 源代码 模块定义了计算机显示器所用的 色彩空间与三种其他色彩坐标系统 和 表示的颜色值之间的双向转换 所有这些色彩空间的坐标都使用浮点数值来表示 在 空间中 坐标取值为 和 之间而 和 坐标均可以为正数或负数 在所有其他空间中坐标取值均为 和 之间 参见 有关色彩空间的更多信息可访问 和 模块定义了如下函数 把颜色从 值转为 值 把颜色从 值转为 值 把颜色从 值转为 值 把颜色从 值转为 值 把颜色从 值转为 值 把颜色从 值转为 值 示例 时间的访问和转换 函数 常量 时区常量 本地 时区的偏移量以 为单位的秒数如果已定义 如果当地 时区 在 以东如在西欧包括英国则是负数 只有当 非零 时才使用它 见下面的注释 如果定义了 时区则为非零 见下面的注释 本地非 时区的偏移量 以西的秒数西欧大部分地区为负美国 为正英国为零 见下面的注释 两个字符串的元组第一个是本地非 时区的名称第二个是本地 时区 的名称 如果未定义 时区则不应使用第二个字符串 见下面的注释 注解 对于上述时区常量 和 该值由模块加载时有效的时区规则确定或者最后一次 被调 用时并且在过去的时间可能不正确 建议使用来自 结果的 和 来获取时区信息 参见 模块 更多面向对象的日期和时间接口 模块 国际化服务 区域设置会影响 和 中许多 格式说明符的解析 模块 一般日历相关功能 这个模块的 是函数 的反函 数 脚注 现在不推荐使用 但是所有 库都不支持扩展为首选小时分 钟偏移量的 转义符 此外严格的 年原始 标准 要求两位数的年份 而不是 但是实际在 年之前很久就转移到了 位数年 之后 已经废弃了 位数的年份首先被推荐 然后被 强制执行 在 版更改 对象 在 版更改 新版功能 在 版更改 在 版更改 在 版更改 示例 传输和协议 传输 源码 传输属于 模块中的类用来抽象各种通信通道 传输对象总是由 异步 事件循环 实例化 异步 实现 和子进程管道的传输 传输上可用的方法由传输的类型决定 传输类属于 线程不安全 传输层级 所有传输的基类 包含所有异步 传输共用的方法 只写链接的基础传输 类的实例由 事件循环方 法返回也被子进程相关的方法如 使用 只读链接的基础传输 类的实例由 事件循环方法 返回也被子进程相关的方法如 使用 接口代表一个双向传输如 链接 用户不用直接实例化传输调用一个功能函数给它传递协议工厂和其它需 要的信息就可以创建传输和协议 传输 类实例由如 等这类事件循环方法使用或返回 数据报 传输链接 类实例由事件循环方法 返回 表示父进程和子进程之间连接的抽象 类的实例由事件循环方法 和 返回 基础传输 只读传输 只写传输 数据报传输 将 字节串发送到 基于传输的目标地址 所给定的远端对等 方 如果 为 则将数据发送到传输创建时给定的目标地址 此方法不会阻塞它会缓冲数据并安排其被异步地发出 立即关闭传输不会等待已提交的操作执行完毕 已缓存的数据将会丢失 不会接收更多的数据 协议的 方法最终将 附带 作为参数被调用 子进程传输 将子进程的进程 以整数形式返回 返回对应于整数文件描述符 的通信管道的传输 标准输入 的可读流式传输如果子进程创建时未设置 则为 标准输出 的可写流式传输如果子进程创建时未设置 则为 标准错误 的可写流式传输如果子进程创建时未设置 则为 其他 返回整数形式的进程返回码或者如果还未返回则为 这类似于 属性 杀死子进程 在 系统中函数会发送 到子进程 在 中此方 法是 的别名 另请参见 发送 编号到子进程与 一 样 停止子进程 在 系统中此方法会发送 到子进程 在 中则 会调用 函数 来停止子进程 另请参见 通过调用 方法来杀死子进程 如果子进程尚未返回并关闭 和 管道的传输 协议 源码 提供了一组抽象基类它们应当被用于实现网络协议 这些类被设计为与 传输 配合使用 抽象基础协议类的子类可以实现其中的部分或全部方法 所有这些方法都是回调它们由传输或特定事件调用例如当数据被接收的时候 基础协议方法应当由相应的传输来调用 基础协议 带有所有协议的共享方法的基础协议 用于实现流式协议 套接字等等的基类 用于实现可对接收缓冲区进行手动控制的流式协议的基类 用于实现数据报 协议的基类 用于实现与子进程通信单向管道的协议的基类 基础协议 所有 协议均可实现基础协议回调 连接回调 连接回调会在所有协议上被调用每个成功的连接将恰好调用一次 所有其他协议回调只能在以下两个方法之间被调用 连接建立时被调用 参数是代表连接的传输 此协议负责将引用保存至对应的传输 连接丢失或关闭时将被调用 方法的参数是一个异常对象或为 后者意味着收到了常规的 或者连接被连接的一端取消或关闭 流程控制回调 流程控制回调可由传输来调用以暂停或恢复协议所执行的写入操作 请查看 方法的文档了解详情 当传输的缓冲区升至高水位以上时将被调用 当传输的缓冲区降到低水位以下时将被调用 如果缓冲区大小等于高水位值则 不会被调用缓冲区大小必须要高于该值 相反地 会在缓冲区大小等于或小于低水位值时被调用 这些结束条件对于当两个水位取零值时也能确保符合预期的行为是很重要的 流式协议 事件方法例如 和 都接受返回流式协议的工厂 当收到数据时被调用 为包含入站数据的非空字节串对象 数据是否会被缓冲 分块或重组取决于具体传输 通常你不应依赖于特定 的语义而应使你的解析具有通用性和灵活性 但是数据总是要以正确的顺 序被接收 此方法在连接打开期间可以被调用任意次数 但是 最多只会被调用一次 一旦 被调用 就不会再被调用 当发出信号的另一端不再继续发送数据时例如通过调用 如果另一端也使用 的话被调用 此方法可能返回假值 包括 在此情况下传输将会自行关闭 相反 地如果此方法返回真值将以所用的协议来确定是否要关闭传输 由于默 认实现是返回 因此它会隐式地关闭连接 某些传输包括 在内并不支持半关闭的连接在此情况下从该方法返 回真值将导致连接被关闭 状态机 缓冲流协议 新版功能 带缓冲的协议可与任何支持 流式协议 的事件循环方法配合使用 实现允许显式手动分配和控制接收缓冲区 随后事件循环可以使用协议提供的缓冲区来避免不必要的数据复制 这对于接收大量数据的协议来说会有明显的性能提升 复杂的协议实现能显著地减少缓冲区分配的数量 以下回调是在 实例上被调用的 调用后会分配新的接收缓冲区 是推荐的返回缓冲区最小尺寸 返回小于或大于 推荐尺寸的缓冲区也是可接受的 当设为 时缓冲区尺寸可以是任意的 返回尺寸为零的缓冲区则是错误的 必须返回一个实现了 缓冲区协议 的对象 用接收的数据更新缓冲区时被调用 是被写入到缓冲区的字节总数 请查看 方法的文档 在连接期间 可以被调用任意次数 但是 最多只能被调用一次如果被调用则在此之后 和 不能再被调用 状态机 数据报协议 子进程协议 数据报协议实例应当由传递给 和 方法的协议工厂来构造 当子进程向其 或 管道写入数据时被调用 是以整数表示的管道文件描述符 是包含已接收数据的非空字节串对象 与子进程通信的其中一个管道关闭时被调用 以整数表示的已关闭文件描述符 子进程退出时被调用 示例 回显服务器 使用 方法创建 回显服务器发回已接收的数据并关闭连接 参见 使用流的 回显服务器 示例使用了高层级的 函数 回显客户端 使用 方法的 回显客户端发送数据并等待直到连接被关闭 参见 使用流的 回显客户端 示例使用了高层级的 函数 回显服务器 使用 方法的 回显服务器发回已接收的数据 回显客户端 使用 方法的 回显客户端发送数据并在收到回应时关闭传输 链接已存在的套接字 附带一个协议使用 方法等待直到套接字接收数据 参见 使用低层级的 方法来注册一个 的 监视文件描述符 以读取事件 示例 使用在协程中通过 函数创建的高层级流的 注册一个打 开的套接字以等待使用流的数据 示例 与 一个使用子进程协议来获取子进程的输出并等待子进程退出的示例 这个子进程是由 方法创建的 另请参阅使用高层级 编写的 相同示例 与 解析树一起使用的常量 源代码 此模块提供用于表示解析树内部节点数值的常量 与大多数 不同这些常量使用小写字符名称 请参阅 发行版中的 文件来获取该语言语法上下文中对这些名称的定义 这些名称所映射的特定数字值可能会在 版本之间更改 警告 模块已弃用并将在未来的 版本中被移除 此模块还提供了一个额外的数据对象 将此模块中定义的常量的数值映射回名称字符串的字典允许生成更加人类 可读的解析树表示 的 接口 模块 在大多数时候你只需要 就足够了但也有一些额外的模块可供使用 接口位于一个名字 的二进制模块当中 此模块包含了低层级的 接口它不应该被应用程序员所直接使用 它通常是一个共享库或 但在某些情况下也可能被静态链接到 解释器 除了 接口 也包含了若干 模块 是其中最重要的 导入 会自动导入 所以要使用 通常你只需要一条简单的 语句 或者更常用的 类被初始化时无参数 此时会创建一个 顶级控件通常是应用程序 的主窗口 每个实例都有自己关联的 解释器 函数是一个工厂函数它创建的对象与 类创建的对象非常相 似只是它不初始化 子系统 在不想创建或无法创建如没有 的 系统额外的顶层窗口的环境中驱动 解释器时 这一点非常有用 由 对象创建的对象可以通过调用其 方法来创建顶层窗口并初始化 子系统 提供 支持的其他模块包括 让用户选择颜色的对话框 在此处列出的其他模块中定义的对话框的基类 注释 例如 索引 意义 示例 选项名称 数据库查找的选项名称 数据库查找的选项类 默认值 当前值 示例 和 和 例如 位图 回调 序列 例如 焦点 状况 类型 宽度 参见 新版功能 命令行接口 命令行接口 命令行接口 新版功能 新版功能 示例 文件名模式匹配 源代码 此模块提供了 风格的通配符它们 并不 等同于正则表达式关于后者的文档参见 模块 风格通配符所使用的特殊字符如下 模式 意义 匹配所有 匹配任何单个字符 匹配 中的任何字符 匹配任何不在 中的字符 对于字面值匹配请将原字符用方括号括起来 例如 将匹配字符 注意文件名分隔符 上为 不是 此模块所特有的 请参见 模块了解文件名扩展 使用 来匹配文件名的各个部分 类似地以一个句点打头的文件名也不是此模块所特有的可以通过 和 模式来匹配 检测 字符串是否匹配 字符串返回 或 两个形参都会使用 进行大小写正规化 可被用于执行大小写敏感的比较无论这是否为所在操作 系统的标准 这个例子将打印当前目录下带有扩展名 的所有文件名 检测 是否匹配 返回 或 此比较 是大小写敏感的并且不会应用 返回 列表中匹配 的子集 它等价于 但其实现更为高效 返回 风格 转换成的正则表达式以便用于 示例 参见 模块 风格路径扩展 在 版更改 参见 关闭连接对象 在 版更改 测试交互性的 示例 源代码 模块寻找像 交互式代码的文本然后执行这些代码来确保它们的确就像展示的那样正确运行有许多方法来使用 通过验证所有交互式示例仍然按照记录的方式工作以此来检查模块的文档字 符串是否是最新的 下面是一个小却完整的示例模块 如果你直接在命令行里运行 将发挥他的作用 简单用法检查 中的示例 开始使用 的最简单方法但不一定是你将继续这样做的方式是结束每个模块 使用 新版功能 在 版更改 新版功能 警告 注解 简单用法检查 中的示例 在 版更改 对象 对象 对象 对象 对象 调试 脚注 对 格式的支持 用法示例 读取压缩文件示例 创建 文件示例 使用 压缩已有的文件示例 使用 压缩二进制字符串示例 参见 模块 支持 格式所需要的基本压缩模块 命令行界面 模块提供了简单的命令行界面用于压缩和解压缩文件 在执行后 模块会保留输入文件 在 版更改 添加一个带有用法说明的新命令行界面命令 默认情况下当你要执行 时默认压缩等级为 命令行选项 如果 未指定则从 读取 指明最快速的压缩方法较低压缩率 指明最慢速的压缩方法最高压缩率 解压缩给定的文件 显示帮助消息 退出处理器 模块定义了清理函数的注册和反注册函数 被注册的函数会在解释器正常终止时执行 会按照注册顺序的逆序执行 如果你注册了 和 那么在解释器终止时会依序执行 注意 通过该模块注册的函数 在程序被未被 捕获的信号杀死时并不会执行 在检测到 内部致命错误以及调用了 时也不会执行 在 版更改 当配合 子解释器使用时已注册函数是它们所注册解释器中的局部对象 将 注册为终止时执行的函数 任何传给 的可选的参数都应 当作为参数传给 可以多次注册同样的函数及参数 在正常的程序终止时 举例来说 当调用了 或是主模块的执 行完成时 所有注册过的函数都会以后进先出的顺序执行 这样做是假定更 底层的模块通常会比高层模块更早引入 因此需要更晚清理 如果在 处理程序执行期间引发了异常将会打印回溯信息 除非引发 的是 并且异常信息会被保存 在所有 处理程序获得 运行机会之后所引发的最后一个异常会被重新引发 这个函数返回 对象可以把它当作装饰器使用 从解释器关闭前要运行的函数列表中移除 在调用 之后当解释器关闭时会确保 不会被调用即使它被多次注册 如 果 之前没有被注册 会静默地不做任何操作 参见 模块 使用 读写 历史文件的有用的例子 示例 以下简单例子演示了一个模块在被导入时如何从文件初始化一个计数器并在程序终结时自动保存计数器的更新值此操作不依赖于应用在终结时对此模块进行显式调用 位置和关键字参数也可传入 以便传递给被调用的已注册函数 作为 使用 只有在函数不需要任何参数调用时才能工作 例如 注解 注解 注解 对 文件进行编码与解码 最常见的 系统调用 此模块提供了对基于 标准和 标准一种稍加修改的 接口进行标准化的系统功能的访问 请勿直接导入此模块 而应导入 模块它提供了此接口的 可移植版本 在 上 模块提供了 接口的一个超集 在非 操作系统上 模块将不可用但会通过 接口提供它的一个可用子集 一旦导入了 用它替代 时就 没有 性能惩罚 此外 还提供了一些附加功能例如在 中的某个条目被修改时会自动调用 错误将作为异常被报告对于类型错误会给出普通异常而系统调用所报告的异常则会引发 大文件支持 某些操作系统包括 和 可对 和 为 位值的 编程模型提供大于 的文件的支持 这在通常情况下是以将相关数据长度和偏移类型定义为 位值的方式来实现的 这样的文件有时被称为 大文件 中的大文件支持会在 的大小超过 且 至少与 一样大时被启用 要启用此模式可能必须在启用特定编译旗标的情况下执行 配置和编译 例如在最近几个版本的 中默认启用了大文件支持但在 和 中你还需要执行这样的操作 在支持大文件的 系统中可以这样做 重要的模块内容 除了 模块文档已说明的许多函数 还定义了下列数据项 一个表示解释器启动时间点的字符串环境的字典 键和值的类型在 上 为 而在 上为 例如 上的 是你的家目录的路径名等价于 中的 修改此字典不会影响由 或 所传入的字 符串环境如果你需要修改环境请将 传给 或者为 或 的命令字符串添加变量赋值和 语句 在 版更改 在 上键和值为 类型 注解 模块提供了对 的替代实现它会在被修改时更新环境 还要注意更新 将导致此字典失效 推荐使用这个 模 块版本而不是直接访问 模块 网络和进程间通信 包 目前此包中只有一个模块 启动并行任务 使用 存档 源代码 文件格式是一个常用的归档与压缩标准 这个模块提供了创建 读取 写入 添加及列出 文件的工具 任何对此模块的进阶使用都将需要理解此格式其定义参见 应用程序笔记 此模块目前不能处理分卷 文件 它可以处理使用 扩展超过 的 文件的 文件 它支持解密 归档中的加密文件但是目前不能创建一个加密的文件 解密非常慢因为它是使用原生 而不是 实现的 这个模块定义了以下内容 为损坏的 文件抛出的错误 新版功能 的别名与旧版本 保持兼容性 版后已移除 当 文件需要 功能但是未启用时会抛出此错误 用于读写 文件的类 欲了解构造函数的描述参阅段落 对象 用于 文件的兼容 的包装器 详情参见 对象 新版功能 用于创建包含 库的 归档的类 用于表示档案内一个成员信息的类 此类的实例会由 对象的 和 方法返回 大多数 模块的用户 都不必创建它们只需使用此模块所创建的实例 应当是档案 成员的全名 应当是包含六个字段的描述最近修改时间的元组 这些字段的描述请参阅 对象 根据文件的 如果 是一个有效的 文件则返 回 否则返回 也可能是一个文件或类文件对 象 在 版更改 支持文件或类文件对象 未被压缩的归档成员的数字常数 常用的 压缩方法的数字常数 需要 模块 压缩方法的数字常数 需要 模块 新版功能 压缩方法的数字常数 需要 模块 新版功能 注解 文件格式规范包括自 年以来对 压缩的支持以及自 年以来对 压缩的支持 但是一些工具包括较旧的 版本不支持这些压缩方法并且可能拒绝完全处理 文件或者无法 提取单个文件 参见 应用程序笔记 编写的 文件格式文档此格式和使用的算法的创建者 主页 有关 项目的 存档程序和开发库的信息 对象 对象 对象 构造器接受与 构造器相同的形参以及一个额外的形参 新版功能 形参 在 版更改 默认启用 扩展 实例在 对象所具有的方法以外还附加了一个方法 查找 文件并将相应的文件添加到归档 如果 的 形参未给定或为 则相应的文件 为 文件并在必要时进行编译 如果 的 形参为 或 则限具有 相应优化级别 参见 的文件会被添加到归档并在必要时 进行编译 如果 是文件则文件名必须以 为后缀并且只有 相应的 文件会被添加到最高层级不带路径信息 如果 不是以 为后缀的文件则将引发 如果它是目录并且该目录不是一个包目录则所有的 文件会 被添加到最高层级 如果目录是一个包目录则所有的 会被添 加到包名所表示的文件路径下并且如果有任何子目录为包目录则会以 排好的顺序递归地添加这些目录 仅限在内部使用 如果给定 则它必须是一个接受单个字符串参数的函数 在将其添加到归档之前它将被传入每个路径包括每个单独的完整路径 如果 返回假值则路径将不会被添加而如果它是一 个目录则其内容将被忽略 例如如果我们的测试文件全都位于 目录或以字符串 打头则我们可以使用一个 来 排除它们 方法会产生带有这样一些文件名的归档 新版功能 形参 在 版更改 形参接受一个 在 版更改 递归排序目录条目 对象 类的实例会通过 和 对象的 方法返回 每个对象将存储关于 归档的一个成员的信息 有一个类方法可以为文件系统文件创建 实例 为文件系统中的文件构造一个 实例并准备将其添加到一个 文件 应为文件系统中某个文件或目录的路径 如果指定了 它会被用作归档中的名称 如果未指定 则所用名称与 相同但将去除任何驱动器盘符和打头的路径 分隔符 参数在设为 时允许压缩早于 的 文件代价时会将时间戳设为 类似的行为也会对晚于 的文件发生时间戳也会被设为该上限值 新版功能 在 版更改 形参接受一个 新版功能 仅限关键字参数实例具有下列方法和属性 如果此归档成员是一个目录则返回 这会使用条目的名称目录应当总是以 结尾 新版功能 归档中的文件名称 上次修改存档成员的时间和日期 这是六个值的元组 索引 值 月 为基数 月份中的日期 为基数 小时 为基数 分钟 为基数 秒 为基数 注解 文件格式不支持 年以前的时间戳 归档成员的压缩类型 对象形式的单个归档成员的注释 扩展字段数据 包含一些保存于该 对象 中的内部结构的注释 创建 归档所用的系统 创建 归档所用的 版本 需要用来提取归档的 版本 必须为零 标志位 文件头的分卷号 内部属性 外部文件属性 文件头的字节偏移量 未压缩文件的 已压缩数据的大小 未压缩文件的大小 命令行界面 模块提供了简单的命令行接口用于与 归档的交互 如果你想要创建一个新的 归档请在 选项后指定其名称然后列出应当被包含的文件名 传入一个字典也是可接受的 如果你想要将一个 归档提取到指定的目录请使用 选项 要获取一个 归档中的文件列表请使用 选项 命令行选项 列出一个 中的文件名 基于源文件创建 将 提取到目标目录中 检测 是否有效 解压缩的障碍 模块的提取操作可能会由于下面列出的障碍而失败 由于文件本身 解压缩可能由于不正确的密码 校验和 格式或不受支持的压缩 解密方法而失败 文件系统限制 超出特定文件系统上的限制可能会导致解压缩失败 例如目录条目所允许的字符 文件名的长度 路径名的长度 单个文件的大小以及文件的数量等等 资源限制 缺乏内存或磁盘空间将会导致解压缩失败 例如作用于 库的解压缩炸弹 即 就可能造成磁盘空间耗尽 中断 在解压缩期间中断执行例如按下 或杀死解压缩进程可能会导致归档文件的解压缩不完整 提取的默认行为 不了解提取的默认行为可能导致不符合期望的解压缩结果 例如当提取相同归档两次时它会不经询问地覆盖文件 数据类 源码 这个模块提供了一个装饰器和一些函数用于自动添加生成的 例如 和 到用户定义的类 它最初描述于 在这些生成的方法中使用的成员变量使用 类型注释定义 例如这段代码 除其他事情外将添加 其看起来像 请注意此方法会自动添加到类中它不会在上面显示的 定义中直接指定 新版功能 模块级装饰器 类和函数 初始化后处理 生成的 代码将调用一个名为 的方法如果在类上已经定义了 它通常被称为 但是如果定义了任何 字段它们也将按照它们在类中定义的顺序传递给 如果没有 方法生成那么 将不会被自动调用 在其他用途中这允许初始化依赖于一个或多个其他字段的字段值 例如 有关将参数传递给 的方法请参阅下面有关仅初始化变量的段落 另请参阅关于 处理 字段的警告 类变量 两个地方 实际检查字段类型的之一是确定字段是否是如 所定义的类变量 它通过检查字段的类型是否为 来完成此操作 如果一个字段是一个 它将被排除在考虑范围之外并被数据类机制忽略 这样的 伪字段不会由模块级的 函数返回 仅初始化变量 另一个 检查类型注解地方是为了确定一个字段是否是一个仅初始化变量 它通过查看字段的类型是否为 类型来实现 如果一个字段是一个 它被认为是一个称为仅初始化字段的伪字段 因为它不是一个真正的字段所以它不会被模块级的 函数返回 仅初始化字段作为参数添加到生成的 方法中并传递给可选的 方法 数据类不会使用它们 例如假设一个字段将从数据库初始化如果在创建类时未提供其值 在这种情况下 将返回 和 的 对象但不包括 冻结的实例 无法创建真正不可变的 对象 但是通过将 传递给 装饰器你可以模拟不变性 在这种情况下数据类将向类添加 和 方法 些方法在调用时会引发 使用 时会有很小的性能损失 不能使用简单的赋值来初始化字段并必须使用 继承 当数组由 装饰器创建时它会查看反向 中的所有类的基类即从 开始 并且对于它找到的每个数据类 将该基类中的字段添加到字段的有序映射中 添加完所有基类字段后它会将自己的字段添加到有序映射中 所有生成的方法都将使用这种组合的计算的有序字段映射 由于字段是按插入顺序排列的因此派生类会重载基类 一个例子 最后的字段列表依次是 的最终类型是 如类 中所指定的那样 为 生成的 方法看起来像 默认工厂函数 如果一个 指定了一个 当需要该字段的默 认值时将使用零参数调用它 例如要创建列表的新实例请使用 如果一个字段被排除在 之外使用 并且字 段也指定 则默认的工厂函数将始终从生成的 函数调用 发生这种情况是因为没有其他方法可以为字段提供初 始值 可变的默认值 在类属性中存储默认成员变量值 思考这个例子不使用数据类 请注意类 的两个实例共享相同的类变量 如预期的那样 使用数据类 如果 此代码有效 它生成的代码类似于 这与使用类 的原始示例具有相同的问题 也就是说在创建类实例时没 有为 指定值的类 的两个实例将共享相同的 副本 由于数据类 只使用普通的 类创建因此它们也会共享此行为 数据类没有通用 的方法来检测这种情况 相反如果数据类检测到类型为 或 的默认参数则会引发 这是一个部分解决方案 但它可以防止许多常见错误 使用默认工厂函数是一种创建可变类型新实例的方法并将其作为字段的默 认值 异常 在使用 定义的数据类上调用隐式定义的 或 时引发 编译 代码 源代码 模块提供了可以模拟 读取执行打印循环的实用程序就像在 模块中一样 因此您可能不希望直接使用该模块如果你想在程序中包含这样一个循环你可能需要使用 模块 这个任务有两个部分 能够判断一行输入是否完成了一个 语句简而言之告诉我们是否要 打印或 记住用户已输入了哪些 语句这样后续的输入可以在这些语句被启 用的状态下被编译 模块提供了分别以及同时执行这两个部分的方式 只执行前一部分 尝试编译 这应当是一个 代码字符串并且在 是有效的 代码时返回一个代码对象 在此情况下代码对象的 属性将为 其默认值为 如果 不是 有效的 代码而是有效的 代码的一个前缀 时将返回 如果 存在问题将引发异常 如果存在无效的 语法将引 发 而如果存在无效的字面值则将引发 或 参数确定 是作为一条语句 对应默认值 作为一系列语句 还是作为一个 进行 编译 任何其他值都将导致引发 注解 解析器有可能但很不常见会在到达源码结尾之前停止解析并成功输出 结果在这种情况下末尾的符号可能会被忽略而不是引发错误 例如 一个反斜杠加两个换行符之后可以跟随任何无意义的符号 一旦解析器 得到改进将修正这个问题 这个类的实例具有 方法其签名与内置函数 相 似区别在于如果该实例编译了包含 语句的程序文本则实 例会 记住 并使用已生效的语句编译所有后续程序文本 这个类的实例具有 方法其签名与 相 似区别在于如果该实例编译了包含 语句的程序文本则实 例会 记住 并使用已生效的语句编译编译所有后续程序文本 源代码 警告 漏洞 在 版更改 在 版更改 在 版更改 类型 数据类型 的范围从 到 值将获得 或者 标志 或 值将获得 标志 或 包含整合元素 数组以 形式返回 或 返回的类型取决于 和 标志的值 或 返回的类型取决于 标志的值 常量 仅当 为 时才允许传递 仅返回类型 在 版更改 在 版更改 参见 对象 在 版更改 对象 对象 对象 对象 对象 在 版更改 脚注 协议客户端 在 版更改 支持了 语句 在 版更改 新版功能 在 版更改 在 版更改 增加了 在 版更改 在 版更改 版后已移除 在 版更改 在 版更改 在 版更改 新版功能 参见 在 版更改 注解 在 版更改 新版功能 版后已移除 在 版更改 增加了 在 版更改 在 版更改 注解 在 版更改 在 版更改 新版功能 新版功能 注解 示例 多种操作系统接口 文件名命令行参数以及环境变量 在 中使用字符串类型表示文件名 命令行参数和环境变量 在某些系统上在将这些字符串传递给操作系统之前必须将这些字符串解码为字节 使用文件系统编码来执行此转换请参阅 在 版更改 在某些系统上使用文件系统编码进行转换可能会失败 在这种情况下 会使用 代理转义编码错误处理器这意味着在解码时不可解码的字节被 字符 替换并且这些字节在编码时再次转换为原始字节 文件系统编码必须保证成功解码小于 的所有字节 如果文件系统编码无法提供此保证 函数可能会引发 进程参数 创建文件对象 这些函数创建新的 参见 以获取打开文件描述符的相关信息 返回打开文件描述符 对应文件的对象 类似内建 函数二 者接受同样的参数 不同之处在于 第一个参数应该为整数 文件描述符操作 查询终端的尺寸 新版功能 返回终端窗口的尺寸格式为 它是类型为 的元组 可选参数 默认为 或标准输出指定应查询的文件 描述符 如果文件描述符未连接到终端则抛出 异常 是供常规使用的高阶函数 是其底层的实现 可用性 元组的子类存储终端窗口尺寸 终端窗口的宽度单位为字符 终端窗口的高度单位为字符 文件描述符的继承 新版功能 每个文件描述符都有一个 可继承标志位该标志位控制了文件描述符是否可以由子进程继承 从 开始由 创建的文件描述符默认是不可继承的 在 上执行新程序时不可继承的文件描述符在子进程中是关闭的其他文件描述符将被继承 在 上不可继承的句柄和文件描述符在子进程中是关闭的但标准流文件描述符 和 即标准输入 标准输出和标准错误是始终继承的 如果使用 函数所有可继承的句柄和文件描述符都将被继承 如果使用 模块将关闭除标准流以外的所有文件描述符并且仅当 参数为 时才继承可继承的句柄 获取指定文件描述符的可继承标志位为布尔值 设置指定文件描述符的可继承标志位 获取指定句柄的可继承标志位为布尔值 可用性 设置指定句柄的可继承标志位 可用性 文件和目录 扩展属性 进程管理 调度器接口 这些函数控制操作系统如何为进程分配 时间 它们仅在某些 平台上可用 更多细节信息请查阅你所用 的指南页面 新版功能 以下调度策略如果被操作系统支持就会对外公开 默认调度策略 用于 密集型进程的调度策略它会尽量为计算机中的其余任务保留交互 性 用于极低优先级的后台任务的调度策略 用于偶发型服务程序的调度策略 先进先出的调度策略 循环式的调度策略 此旗标可与任何其他调度策略进行 运算 当带有此旗标的进程设置分叉 时其子进程的调度策略和优先级会被重置为默认值 这个类表示在 和 中使用的可修改调度形参 它属于不可变对象 目前它只有一个可能的形参 一个调度策略的调度优先级 获取 的最小优先级数值 是以上调度策略常量之一 获取 的最高优先级数值 是以上调度策略常量之一 设置 为 的进程的调度策略 为 指的是调用本方法的进 程 是以上调度策略常量之一 是一个 实例 返回 为 的进程的调度策略 为 指的是调用本方法的进 程 返回的结果是以上调度策略常量之一 设置 为 的进程的某个调度参数 为 指的是调用本方法 的进程 是一个 实例 返回 为 的进程的调度参数为一个 实例 为 指的是调用本方法的进程 返回 为 的进程在时间片轮转调度下的时间片长度单位为秒 为 指的是调用本方法的进程 自愿放弃 将 为 的进程为零则为当前进程限制到一组 上 是整数的可迭代对象表示应将进程限制在其中的一组 返回 为 的进程为零则为当前进程被限制到的那一组 其他系统信息 随机数 获得最多为 的随机字节 本函数返回的字节数可能少于请求的字节 数 这些字节可用于为用户空间的随机数生成器提供种子或用于加密目的 依赖于从设备驱动程序和其他环境噪声源收集的熵 不必要 地读取大量数据将对使用 和 设备的其他用 户产生负面影响 参数是一个位掩码可以是零个或多个下列值以或运算组合 和 另请参阅 手册页 可用性 或更高版本 新版功能 返回大小为 的字符串它是适合加密使用的随机字节 本函数从系统指定的随机源获取随机字节 对于加密应用程序返回的数据 应有足够的不可预测性尽管其确切的品质取决于操作系统的实现 在 上如果 系统调用可用它将以阻塞模式使用 阻塞直到系统的 熵池初始化完毕内核收集了 位熵 原理 请参阅 在 上 可以以非阻塞模式使 用 标志获取随机字节或者轮询直到系统的 熵池初始化完毕 在类 系统上随机字节是从 设备读取的 如果 设备不可用或不可读则抛出 异 常 在 上将使用 参见 模块提供了更高级的功能 所在平台会提供随机数生成器有 关其易于使用的接口请参阅 在 版更改 在 上 现在以阻塞模式使用以 提高安全性 在 版更改 在 上如果 系统调用阻塞 熵池尚未初始化完毕则退回一步读取 在 版更改 在 和更高版本上现在使用 系统调用如果可用 在 和更高版本上现在使用 函数 这些函数避免了使用内部文件描述符 默认情况下从 读取时如果没有可用的随机字节则 会阻塞从 读取时如果熵池尚未初始化 则会阻塞 如果设置了 标志则这些情况下 不会阻 塞而是立即抛出 异常 新版功能 如果设置了此标志位那么将从 池而不是 池中提取随机字节 新版功能 异常和缺陷类 新版功能 在 版更改 添加了 关键字 在 版更改 在 版更改 添加了 关键字 在 版更改 在 版更改 脚注 海龟绘图 源码 概述 可用的 和 方法概览 方法 海龟动作 移动和绘制 前进 后退 右转 左转 前往定位 设置 坐标 设置 坐标 设置朝向 返回原点 画圆 画点 印章 清除印章 清除多个印章 撤消 速度 获取海龟的状态 位置 目标方向 坐标 坐标 朝向 距离 设置与度量单位 角度 弧度画笔控制 绘图状态 画笔落下 画笔抬起 画笔粗细 画笔 画笔是否落下 颜色控制 颜色 画笔颜色 填充颜色 填充 是否填充 开始填充 结束填充 更多绘图控制 重置 清空 书写海龟状态 可见性 显示海龟 隐藏海龟 是否可见 外观 形状 大小调整模式 形状大小 剪切因子 设置倾角 倾角 倾斜 变形 获取形状多边形使用事件 当鼠标点击 当鼠标释放 当鼠标拖动特殊海龟方法 开始记录多边形 结束记录多边形 获取多边形 克隆 获取海龟画笔 获取屏幕 设置撤消缓冲区 撤消缓冲区条目数 方法 窗口控制 背景颜色 背景图片 清屏 重置 屏幕大小 设置世界坐标系动画控制 延迟 追踪 更新使用屏幕事件 监听 当键盘按下并释放 当键盘按下 当点击屏幕 当达到定时 主循环设置与特殊方法 模式 颜色模式 获取画布 获取形状 添加形状 所有海龟 窗口高度 窗口宽度输入方法 文本输入 数字输入 专有方法 退出 当点击时退出 设置 标题 方法和对应函数 本节中的大部分示例都使用 类的一个实例命名为 海龟动作 获取海龟的状态 返回海龟当前的坐标 为 矢量类对象 参数 一个数值或数值对矢量或一个海龟实例 一个数值 如果 是一个数值否则为 从海龟位置到由 矢量或另一海龟对应位置的连线的夹角 此数值依 赖于海龟初始朝向 由 或 模式设置所决定 返回海龟的 坐标 返回海龟的 坐标 返回海龟当前的朝向 数值依赖于海龟模式参见 参数 一个数值或数值对矢量或一个海龟实例 一个数值 如果 是一个数值否则为 返回从海龟位置到由 适量或另一海龟对应位置的单位距离 度量单位设置 画笔控制 绘图状态 画笔落下 移动时将画线 画笔抬起 移动时不画线 参数 一个正数值 设置线条的粗细为 或返回该值 如果 设为 并 且 为多边形该多边形也以同样组细的线条绘制 如未指定参 数则返回当前的 参数 一个包含部分或全部下列键的字典 一个或多个以下列键为关键字的关键字参数 返回或设置画笔的属性以一个包含以下键值对的 画笔字典 表示 颜色字符串或颜色元组 颜色字符串或颜色元组 正数值 范围内的数值 或 或 正数值 正数值 正数值 数值 此字典可作为后续调用 时的参数以恢复之前的画笔状态 另外还 可将这些属性作为关键词参数提交 使用此方式可以用一条语句设置画笔的 多个属性 如果画笔落下返回 如果画笔抬起返回 颜色控制 返回或设置画笔颜色 允许以下四种输入格式 返回以颜色描述字符串或元组 见示例 表示的当前画笔颜色 可用作其 他 调用的输入 设置画笔颜色为 指定的 颜色描述字符串例如 或 设置画笔颜色为以 元组表示的 颜色 的取值范围应为 的值为 或 参 见 设置画笔颜色为以 表示的 颜色 的取值范围应为 如果 为多边形该多边形轮廓也以新设置的画笔颜色绘制 返回或设置填充颜色 允许以下四种输入格式 返回以颜色描述字符串或元组 见示例 表示的当前填充颜色 可用作其 他 调用的输入 设置填充颜色为 指定的 颜色描述字符串例如 或 设置填充颜色为以 元组表示的 颜色 的取值范围应为 的值为 或 参 见 设置填充颜色为 表示的 颜色 的取值范围应为 如果 为多边形该多边形内部也以新设置的填充颜色填充 返回或设置画笔颜色和填充颜色 允许多种输入格式 使用如下 至 个参数 返回以一对颜色描述字符串或元组表示的当前画笔颜色和填充颜色两者 可分别由 和 返回 输入格式与 相同同时设置填充颜色和画笔颜色为指定的 值 相当于 加 使用其他输入格式的方法也与之类似 如果 为多边形该多边形轮廓与填充也使用新设置的颜色 另参见 方法 填充 返回填充状态 填充为 否则为 在绘制要填充的形状之前调用 填充上次调用 之后绘制的形状 自相交多边形或多个形状间的重叠区域是否填充取决于操作系统的图形引擎 重叠的类型以及重叠的层数 例如上面的 多芒星可能会全部填充 为黄色也可能会有一些白色区域 更多绘图控制 从屏幕中删除海龟的绘图海龟回到原点并设置所有变量为默认值 从屏幕中删除指定海龟的绘图 不移动海龟 海龟的状态和位置以及其他海 龟的绘图不受影响 参数 要书写到 的对象 字符串 或 一个三元组 书写文本 指定的字符串 到当前海龟位置 指定对齐方 式 或 指定字体 如果 为 画笔会移动到文本的右下角 默认 为 海龟状态 使用事件 特殊海龟方法 开始记录多边形的顶点 当前海龟位置为多边形的第一个顶点 停止记录多边形的顶点 当前海龟位置为多边形的最后一个顶点 它将连线 到第一个顶点 返回最新记录的多边形 创建并返回海龟的克隆体具有相同的位置 朝向和海龟属性 返回海龟对象自身 唯一合理的用法 作为一个函数来返回 匿名海龟 返回作为海龟绘图场所的 类对象 该对象将可调用 方法 参数 一个整型数值或 设置或禁用撤消缓冲区 如果 为一个整型数则将开辟一个指定大小 的空缓冲区 表示可使用 方法函数撤消的海龟命令的次 数上限 如果 为 则禁用撤消缓冲区 返回撤销缓冲区里的条目数 复合形状 要使用由多个不同颜色多边形构成的复合海龟形状你必须明确地使用辅助类 具体步骤如下 创建一个空 对象类型为 按照需要使用 方法向此对象添加多个部件 例如 接下来将 对象添加到 对象的形状列表并使用它 注解 类在 方法的内部以多种方式使用 应用程序编 写者 只有 在使用上述的复合形状时才需要处理 类 方法及对应函数 本节中的大部分示例都使用 类的一个实例命名为 窗口控制 动画控制 参数 正整型数 设置或返回以毫秒数表示的延迟值 这约等于连续两次画布刷新的 间隔时间 绘图延迟越长动画速度越慢 可选参数 参数 非负整型数 非负整型数 启用禁用海龟动画并设置刷新图形的延迟时间 如果指定 值则只有 每第 次屏幕刷新会实际执行 可被用来加速复杂图形的绘制 如果调 用时不带参数则返回当前保存的 值 第二个参数设置延迟值 参见 执行一次 刷新 在禁用追踪时使用 另参见 方法 使用屏幕事件 输入方法 参数 字符串 字符串 弹出一个对话框窗口用来输入一个字符串 形参 为对话框窗口的标题 为一条文本通常用来提示要输入什么信息 返回输入的字符串 如果对话框被取消则返回 参数 字符串 字符串 数值 可选 数值 可选 数值 可选 弹出一个对话框窗口用来输入一个数值 为对话框窗口的标题 为一条文本通常用来描述要输入的数值信息 默认值 可输入的最小值 可输入的最大值 输入数值的必须在指 定的 范围之内否则将给出一条提示对话框保持打开 等待修改 返回输入的数值 如果对话框被取消则返回 设置与特殊方法 参数 字符串 或 其中之一 设置海龟模式 或 并执行重置 如未指定模 式则返回当前的模式 模式与旧的 兼容 模式与大部分 海龟 绘图兼容 模式使用用户自定义的 世界坐标系 注意 在此 模式下如果 单位比率不等于 则角度会显得扭曲 模式 初始海龟朝向 正数角度 朝右 东 逆时针 朝上 北 顺时针 参数 数值 或 其中之一 返回颜色模式或将其设为 或 构成颜色三元组的 数值必须在 范围之内 返回此 的 对象 供了解 的 对象内 部机理的人士使用 返回所有当前可用海龟形状的列表 调用此函数有三种不同方式 为一个 文件的文件名 为 安装相应的图 像形状 注解 当海龟转向时图像形状 不会 转动因此无法显示海龟的朝向 为指定的字符串 为由坐标值对构成的元组 安装相应 的多边形形状 为指定的字符串 为一个 复合 类对象 安装相应的 复合形状 将一个海龟形状加入 的形状列表 只有这样注册过的形状才 能通过执行 命令来使用 返回屏幕上的海龟列表 返回海龟窗口的高度 返回海龟窗口的宽度 专有方法 而非继承自 关闭海龟绘图窗口 将 方法绑定到 上的鼠标点击事件 如果配置字典中 的值为 默认值 则同时进入主事 件循环 注 如果启动 时使用了 开关 无子进程 中此数值应设为 在此情况下 本身的主事件循 环同样会作用于客户脚本 设置主窗口的大小和位置 默认参数值保存在配置字典中可通过 文件进行修改 参数 如为一个整型数值表示大小为多少像素如为一个浮 点数值则表示屏幕的占比默认为屏幕的 如为一个整型数值表示高度为多少像素如为一个浮 点数值则表示屏幕的占比默认为屏幕的 如为正值表示初始位置距离屏幕左边缘多少像素负 值表示距离右边缘 表示窗口水平居中 如为正值表示初始位置距离屏幕上边缘多少像素负 值表示距离下边缘 表示窗口垂直居中 参数 一个字符串显示为海龟绘图窗口的标题栏文本 设置海龟窗口标题为 指定的文本 公共类 帮助与配置 如何使用帮助 和 类的公用方法以文档字符串提供了详细的文档 因此可以利用 帮助工具获取这些在线帮助信息 当使用 时输入函数方法调用将弹出工具提示显示其签名和文档字符 串的头几行 对文法或函数调用 将显示其文档字符串 方法对应函数的文档字符串的形式会有一些修改 这些修改版文档字符串是在导入时与方法对应函数的定义一起自动生成的 文档字符串翻译为不同的语言 如何配置 和 演示脚本集 包汇集了一组演示脚本 这些脚本可以通过以下命令打开所提供的演示查看器运行和查看 此外你也可以单独运行其中的演示脚本 例如 包目录中的内容 一个演示查看器 可用来查看脚本的源码并即时运行 多个脚本文件演示 模块的不同特性 所有示例可通过 菜单打开 也可以单独运行每个脚本 一个 文件作为说明如何编写并使用模块配置文件的示例模板 演示脚本清单如下 名称 描述 相关特性 复杂的传统海龟绘图模式 绘制 动态模型演示通 世界坐标系 过计算机的运算可能会生成令人惊 叹的结果 绘制模拟时钟显示本机的当前时间 海龟作为表针 试验 颜色模式 当鼠标拖动 绘制 棵广度优先树 随机化 绘制 曲线 递归 文化数学 印度装饰艺术 系统 汉诺塔 矩形海龟作为汉诺盘 玩经典的尼姆游戏开始时有三 海龟作为小棒事件驱动 堆小棒与电脑对战 鼠标 键盘 超极简主义绘画程序 当鼠标点击 初级技巧 海龟 外观与动画 非周期性地使用风筝和飞镖形状铺 印章 满平面 模拟引力系统 复合开关 类 两两相对并不断旋转舞蹈的海龟 复合形状 动态演示不同的排序方法 简单对齐 随机化 一棵 图形化的 广度优先树 使 克隆 用生成器 简单设计 两块画布上的海龟 一个来自介绍海龟绘图的维基百科 文章的图案 另一个初级示例 画圆 祝你玩得开心 之后的变化 和 方法已被去除 具有这些名称和功能的方法现在 只限于 类的方法 但其对应的函数仍然可用 实际上在 中这些方法就已经只是从对应的 类的方法复 制而来 方法已被去除 和 的行为 则有细微改变 现在每个填充过程必须以一个 调用来结束 新增了一个 方法 该方法返回一个布尔值 如果填充过 程正在进行为 否则为 此行为相当于 中不带 参数的 调用 之后的变化 新增了 和 方法 这样就可以使用所有标准线性变换来调整 海龟形状 的功能已被加强 现在可被用来获取或设 置倾角 已弃用 新增了 方法作为对 的补充实 际就是将行为绑定到 事件 后者相应增加了一个别名 新增了 方法 这样当仅需使用 和 对 象时不需要再额外导入 新增了两个方法 和 用来弹出 对话框接受输入并分别返回字符串和数值 两个新的示例脚本 和 被加入到 目录中 用于打开 的可扩展库 对象 传给构造函数的原始 在 版更改 请求的原始主机不含端口 路径 若 使用代理选择器将会是传给代理的完整 在 版更改 布尔表明请求是否为 中定义的无法证实的 新版功能 在 版更改 在 版更改 添加一个不会被加入重定向请求的头部 新版功能 返回构造器中给定的 在 版更改 返回 在 版更改 对象 实例有以下方法 句柄知道如何打开 的信号 查看 以获取更多信息 查看 以获取更多信息 句柄知道如何处理来自非 的错误的信号 句柄知道如何预处理 请求的信号 查看 以获取更多信息 句柄知道如何后处理 响应的信 号 查看 以获取更多信息 对象 注解 对象 注解 注解 对象 对象 对象 对象 对象 对象 对象 对象 对象 对象 对象 对象 对象 在 版更改 对象 对象 对象 对象 对象 示例 使用 包获取网络资源 版后已移除 版后已移除 注解 注解 在 版更改 基于密钥的消息验证 读取 分块数据 源代码 本模块提供了一个读取使用 分块的数据的接口 这种格式使用的场合有 和 等 与它们密切相关的 音频文件也可使用此模块来读取 一个分块具有以下结构 偏移 长度 内容 区块 大端字节顺序的块大小不包括头 数据字节其中 是前一字段中 给出的大小 或 如果 为奇数且使用块对齐则 需要填充字节 是一个 字节的字符串用于标识块的类型 大小字段 位的值使用大端字节序编码给出分块数据的大小不包括 字节的标头 使用由一个或更多分块组成的 类型文件 此处定义的 类的建议使用方式是在每个分块开始时实例化一个实例并从实例读取直到其末尾在那之后可以再实例化新的实例 到达文件末尾时创建新实例将会失败并引发 异常 代表一个分块的类 参数预期为一个文件类对象 特别地也允许该 类的实例 唯一必需的方法是 如果存在 和 方法并且没有引发异常它们也会被使用 如果存在这些方法并 且引发了异常则它们不应改变目标对象 如果可选参数 为真值 则分块应当以 字节边界对齐 如果 为假值则不使用对齐 此参数默认为真值 如果可选参数 为假值分块大小应当为 小端序 这对于 音频文件是必须的 此参数默认为真值 如果可选 参数 为真值则分块标头中给出的大小将包括标头的大小 此参数默认为假值 对象支持下列方法 返回分块的名称 这是分块的头 个字节 返回分块的大小 关闭并跳转到分块的末尾 这不会关闭下层的文件 在 方法已被调用后其余方法将会引发 在 之前它们曾会引发 现在这是 的一个别名 返回 设置分块的当前位置 参数为可选项并且默认为 绝对文 件定位其他值还有 相对当前位置查找 和 相对文件末尾 查找 没有返回值 如果下层文件不支持查找则只允许向前查找 将当前位置返回到分块 从分块读取至多 个字节如果在获得 个字节之前已到达 分块末尾则读取的字节会少于此数量 如果 参数为负值或被 省略则读取所有字节直到分块末尾 当立即遇到分块末尾则返回空字 节串对象 跳到分块末尾 此后对分块再次调用 将返回 如果你 对分块的内容不感兴趣则应当调用此方法以使文件指向下一分块的开头 脚注 交换格式文件标准 年 月 模块浏览器支持 源代码 模块提供了对于以 编写的模块中定义的函数 类和方法的受限信息 这种信息足够用来实现一个模块浏览器 这种信息是从 源代码中直接提取而非通过导入模块因此该模块可以安全地用于不受信任的代码 此限制使得非 实现的模块无法使用此模块包括所有标准和可选的扩展模块 返回一个将模块层级的类名映射到类描述器的字典 如果可能将会包括已 导入基类的描述器 形参 为要读取模块名称的字符串它可能是 某个包内部的模块名称 如果给出则为添加到 开头的 目录路径序列它会被用于定位模块的源代码 此函数为原始接口仅保留用于向下兼容 它会返回以下内容的过滤版本 返回一个基于字典的树其中包含与模块中每个用 或 语句 定义的函数和类相对应的函数和类描述器 被返回的字典会将模块层级的函 数和类名映射到它们的描述器 嵌套的对象会被输入到它们的上级子目录中 与 一样 指明要读取的模块而 会被添加 到 如果被读取的模块是一个包则返回的字典将具有 键其值是一个包含包搜索路径的列表 新版功能 嵌套定义的描述器 它们通过新的子属性来访问 每个定义都会有一个新的上级属性 这些函数所返回的描述器是 和 类的实例 用户不应自行创建这些类的实例 对象 类的实例描述了由 语句所定义的函数 它们具有下列属性 函数定义所在的文件名称 定义了所描述函数的模块名称 函数名称 定义在文件中起始位置的行号 对于最高层级函数为 对于嵌套函数则为上级函数 新版功能 将名称映射到嵌套函数和类描述器的字典 新版功能 对象 类的实例描述了由 语句所定义的类 它们具有与 对象相同的属性以及两个额外属性 类定义所在的文件名称 定义了所描述类的模块名称 类名称 定义在文件中起始位置的行号 对于最高层级类为 对于嵌套类则为上级类 新版功能 将名称映射到嵌套函数和类描述器的字典 新版功能 一个 对象的列表它们描述了所描述类的直接基类 被命名为超 类但无法被 发现的类会作为类名字符串而非 对象列出 一个将方法名映射到行号的字典 此属性可从更新的子目录中获取仅保留 用于向下兼容 文档生成器和在线帮助系统 新版功能 注解 参见 安装 模块 注解 注解 警告 漏洞 在 版更改 示例 版后已移除 动态类型创建和内置类型名称 源代码 此模块定义了一些工具函数用于协助动态创建新的类型 它还为某些对象类型定义了名称这些名称由标准 解释器所使用但并不像内置的 或 那样对外公开 最后它还额外提供了一些类型相关但重要程度不足以作为内置对象的工具类和函数 动态类型创建 使用适当的元类动态地创建一个类对象 前三个参数是组成类定义头的部件类名称基类 有序排列关键字参数 例如 参数是一个回调函数用于填充新创建类的命名空间 它应当 接受类命名空间作为其唯一的参数并使用类内容直接更新命名空间 如果未 提供回调函数则它就等效于传入 新版功能 计算适当的元类并创建类命名空间 参数是组成类定义头的部件类名称基类 有序排列 以及关键字参数 例如 返回值是一个 元组 是适当的元类 是预备好的类命名空间而 是所传入 参数移除每个 条目后的已更新副本 如 果未传入 参数这将为一个空字典 新版功能 在 版更改 所返回元组中 元素的默认值已被改变 现在 当元类没有 方法时将会使用一个保留插入顺序的映射 参见 元类 这些函数所支持的类创建过程的完整细节 中的元类 引入 命名空间钩子 动态地解析 条目具体描述见 此函数会在 中查找不是 的实例的项并返回一个元组其 中每个具有 方法的此种对象对象将被替换为调用该方法 解包后的结果 如果一个 项是 的实例或它不具有 方法则它将不加改变地被包含在返回的元组中 新版功能 参见 对类型模块和泛型类型的核心支持 标准解释器类型 附加工具类和函数 一个简单的 子类提供了访问其命名空间的属性以及一个有意 义的 不同于 对于 你可以添加和移除属性 如果 一个 对象使用关键字参数进行初始化这些参数会被直 接加入下层命名空间 此类型大致等价于以下代码 可被用于替代 但是对于结构化 记录类型则应改用 新版功能 在 版更改 中的属性顺序由字母顺序改为插入顺序 类似 在类上访问 的路由属性 这是一个描述器用于定义通过实例与通过类访问时具有不同行为的属性 当实例访问时保持正常行为但当类访问属性时将被路由至类的 方法这是通过引发 来完成的 这允许有在实例上激活的特性属性同时又有在类上的同名虚拟属性 一个 例子请参见 新版功能 协程工具函数 此函数可将 函数转换为返回基于生成器的协程的 基于生成器的协程仍然属于 但同时又 可被视为 对象兼 不过它没有必要实现 方法 如果 是一个生成器函数它将被原地修改 如果 不是一个生成器函数则它会被包装 如果它返回一个 的实例该实例将被包装在一个 代理对象中 所有其他对象类型将被原样返回 新版功能 服务端与客户端模块 是一种远程过程调用方法它使用通过 传递的 作为载体 有了它客户端可以在远程服务器上调用带参数的方法服务器以 命名并获取结构化的数据 是一个集合了 服务端与客户端实现模块的包 这些模块是 注册表访问 这些函数将 注册表 暴露给 为了确保即便程序员忽略了显式关闭句柄该句柄依然能够正确关闭它使用了一个 对象 而不是整数来作为注册表句柄 在 版更改 该模块中的几个函数被用于引发 该异常现在是 的别名 函数 常数 新版功能 新版功能 引发一个 审计事件 附带参数 加密服务 本章中描述的模块实现了加密性质的各种算法 它们可以在安装时自行选择 在 系统上 模块也可以使用 以下是为内容概要 安全哈希与消息摘要 哈希算法 可变长度摘要 密钥派生 创建哈希对象 常数 示例 简单哈希 使用不同的摘要大小 密钥哈希 随机哈希 个性化 树形模式 开发人员 基于密钥的消息验证 生成安全随机数字用于管理密码 随机数 生成凭据 凭据应当使用多少个字节 其他功能 应用技巧与最佳实践 测量小代码片段的执行时间 源码 该模块提供了一种简单的方法来计算一小段 代码的耗时 它有 命令行界面 以及一个 可调用 方法 它避免了许多用于测量执行时间的常见陷阱 另见 对 出版的 中算法章节的介绍 基本示例 以下示例显示了如何使用 命令行界面 来比较三个不同的表达式 这可以通过 接口 实现 从 接口 还可以传出一个可调用对象 但请注意 仅在使用命令行界面时会自动确定重复次数 在 示例一节你可以找到更多的进阶示例 接口 该模块定义了三个便利函数和一个公共类 使用给定语句 代码和 函数创建一个 实例并 执行 次其 方法 可选的 参数指定用于执 行代码的命名空间 在 版更改 添加可选参数 使用给定语句 代码和 函数创建一个 实例并 使用给定的 计数和 执行运行其 方法 可 选的 参数指定用于执行代码的命名空间 在 版更改 添加可选参数 在 版更改 的默认值由 更改为 默认的计时器总是 在 版更改 现在是默认计时器 用于小代码片段的计数执行速度的类 构造函数接受一个将计时的语句 一个用于设置的附加语句和一个定时器函 数 两个语句都默认为 计时器函数与平台有关请参阅模块文 档字符串 和 也可能包含多个以 或换行符分隔的 语句只要它们不包含多行字符串文字即可 该语句默认在 的命名 空间内执行可以通过将命名空间传递给 来控制此行为 要测量第一个语句的执行时间请使用 方法 和 方法是方便的方法来调用 多次 的执行时间从总体计时执行中排除 和 参数也可以使用不带参数的可调用对象 这将在一个计 时器函数中嵌入对它们的调用然后由 执行 请注意由于额 外的函数调用在这种情况下计时开销会略大一些 在 版更改 添加可选参数 执行 次主要语句 这将执行一次 语句然后返回执行 主语句多次所需的时间以秒为单位测量为浮点数 参数是通过循环的次 数默认为一百万 要使用的主语句 语句和 函数将传递 给构造函数 注解 默认情况下 暂时关闭 这种方 法的优点在于它使独立时序更具可比性 缺点是 可能是所测量功能性 能的重要组成部分 如果是这样可以在 字符串中的第一个 语句重新启用 例如 自动决定调用多少次 这是一个便利函数它反复调用 以便总时间 秒 返回最终循环次数循环所用的时间 它调用 的次数以 序列 递增直到所用的时间至少为 秒 如果给出 并且不是 则在每次试验后将使用两个参 数调用它 新版功能 调用 几次 这是一个方便的函数它反复调用 返回结果列表 第一个 参数指定调用 的次数 第二个参数指定 的 参数 注解 从结果向量计算并报告平均值和标准差这些是很诱人的 但是这不是 很有用 在典型情况下最低值给出了机器运行给定代码段的速度的下 限结果向量中较高的值通常不是由 的速度变化引起的而是由 于其他过程干扰你的计时准确性 所以结果的 可能是你应该 感兴趣的唯一数字 之后你应该看看整个向量并应用常识而不是统计 在 版更改 的默认值由 更改为 帮助程序从计时代码中打印回溯 典型使用 与标准回溯相比优势在于将显示已编译模板中的源行 可选的 参数指向发送回溯的位置它默认为 命令行界面 从命令行调用程序时使用以下表单 如果了解以下选项 执行 语句 多少次 重复计时器的次数默认为 最初要执行一次的语句默认为 测量进程时间而不是 时间使用 而 不是 这是默认值 新版功能 指定定时器输出的时间单位可以选择 或 新版功能 打印原始计时结果重复更多位数精度 打印一条简短的使用信息并退出可以通过将每一行指定为单独的语句参数来给出多行语句通过在引号中包含参数并使用前导空格可以缩进行 多个 选项的处理方式相似 如果未给出 则会通过尝试按序列 递增的数值来计算合适的循环次数直到总计时间至少为 秒 测量可能受到在同一台机器上运行的其他程序的影响因此在需要精确计时时最好的做法是重复几次计时并使用最佳时间 选项对此有利在大多数情况下默认的 次重复可能就足够了 你可以使用 来测量 时间 注解 执行 语句会产生一定的基线开销 这里的代码不会试图隐藏它但你应 该知道它 可以通过不带参数调用程序来测量基线开销并且 版本之间 可能会有所不同 示例 专有服务 本章描述的模块提供了 操作系统独有特性的接口在某些情况下也适用于它的某些或许多衍生版 以下为模块概览 最常见的 系统调用 大文件支持 重要的模块内容 用户密码数据库 组数据库 模块函数 示例 风格的 控制 示例 终端控制功能 伪终端工具 示例 终端管道接口 模板对象 的 黄页 接口 库例程 示例 简单示例 套接字对象的 包装器 方法 常量和异常处理 套接字创建 从 和 开始建议使用 实例的 来将套接字包装为 对象 辅助函数 会返回一个新的带有安全默认设置的上下文 旧的 函数已被弃用因为它效率较差并且不支持服务器名称提示 和主机匹配 客户端套接字实例采用默认上下文和 双栈 客户端套接字示例带有自定义上下文和 服务器套接字实例在 上监听 上下文创建 便捷函数可以帮助创建 对象用于常见的目的 返回一个新的 对象使用给定 的默认设置 该 设置由 模块选择并且通常是代表一个比直接调用 构 造器时更高的安全等级 代表用于进行证书核验的可选受信任 证 书与 的一致 如果三个参数均 为 此函数可以转而选择信任系统的默认 证书 设置包括 以及 具有不 带 和不带无身份验证密码套件的高度加密密码套件 传入 作为 会把 设为 并且加载指定 证书当给出 和 中的至少一个或者使用 来加载默认 证书 当 受支持并且设置了环境变量 时 会启用密钥日志记录 注解 协议 选项 密码和其他设置可随时更改为更具约束性的值而无须事先弃 用 这些值代表了兼容性和安全性之间的合理平衡 如果你的应用需要特 定的设置你应当创建一个 并自行应用设置 注解 如果你发现当某些较旧的客户端或服务器尝试与用此函数创建的 进行连接时收到了报错提示 这可能是因为它们只支持 而它被此函数用 排除掉了 被广泛认为 完全不可用 如果你仍 希望继续使用此函数但仍允许 连接你可以使用以下代码重新启 用它们 新版功能 在 版更改 被从默认密码字符串中丢弃 在 版更改 被添加到默认密码字符串中 被 从默认密码字符串中丢弃 在 版更改 增加了对密钥日志记录至 的支持 异常 引发此异常以提示来自下层 实现目前由 库提供的错误 它表示在下层网络连接之上叠加的高层级加密和验证层存在某种问题 此错 误是 的一个子类型 实例的错误和消息是由 库提供的 在 版更改 曾经是 的一个子类型 一个字符串形式的助记符用来指明发生错误的 子模块例如 或 可能的取值范围依赖于 的版本 新版功能 一个字符串形式的助记符用来指明发生错误的原因例如 可能的取值范围依赖于 的版 本 新版功能 的子类当尝试读取或写入且 连接已被完全关闭时会被引 发 请注意这并不意味着下层的传输读取 已被关闭 新版功能 的子类当尝试读取或写入数据但在请求被满足之前还需要在 下层的 传输上接收更多数据时会被 非阻塞型 套接字 引发 新版功能 的子类当尝试读取或写入数据但在请求被满足之前还需要在 下层的 传输上发送更多数据时会被 非阻塞型 套接字 引发 新版功能 的子类当尝试在 套接字上执行操作时遇到系统错误时会 被引发 不幸的是没有简单的方式能检查原始 编号 新版功能 的子类当 连接被突然终止时会被引发 通常当遇到此 错误时你不应再尝试重用下层的传输 新版功能 的子类当证书验证失败时会被引发 新版功能 一个数字形式的错误编号用于表示验证错误 用于表示验证错误的人类可读的字符串 的别名 在 版更改 此异常现在是 的别名 随机生成 返回 个高加密强度伪随机字节数据 如果 未使用足够的数据 作为随机种子或者如果当前 方法不支持该操作则会引发 可被用来检查 的状态而 可被用来为 设置随机种子 对于几乎所有应用程序都更推荐使用 请阅读维基百科文章 以了解对于高加密强度生成器的具体要求 新版功能 返回 是 个伪随机字节数据如 果所生成的字节数据为高加密强度则 为 如果 当前 方法不支持此操作则会引发 所生成的伪随机字节序列如果具有足够的长度则将会具有唯一性并是并非 不可预测 它们可被用于非加密目的以及加密协议中的特定目的但通常不 可被用于密钥生成等目的 对于几乎所有应用程序都更推荐使用 新版功能 版后已移除 已弃用了 请改用 如果 伪随机数生成器已使用 足够的 随机性作为种子则返回 否则返回 你可以使用 和 来增加伪随机数生成器的随机性 如果你在某处运行了一个熵收集守护程序 且 是向其打开的 套接字连接路径名此函数将从该套接字读取 个字节的随机性数据并 将其添加到 伪随机数生成器以增加所生成密钥的安全性 此操作通常 只在没有更好随机性源的系统上才是必要的 请查看 或 来了解有关熵收集守护程序源的信息 可用性 对于 和 不可用 将给定的 混合到 伪随机数生成器中 形参 类型 是数据所包含的熵的下界 因此你可以总是使用 请 查看 了解有关熵源的更多信息 在 版更改 现在接受可写的 字节类对象 证书处理 常数 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 版后已移除 警告 版后已移除 警告 版后已移除 版后已移除 新版功能 版后已移除 新版功能 版后已移除 新版功能 新版功能 版后已移除 新版功能 版后已移除 新版功能 版后已移除 新版功能 版后已移除 新版功能 版后已移除 新版功能 版后已移除 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 套接字对象 在 版更改 在 版更改 版后已移除 在 版更改 在 版更改 版后已移除 在 版更改 版后已移除 注解 在 版更改 在 版更改 在 版更改 注解 在 版更改 在 版更改 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 注解 新版功能 新版功能 新版功能 新版功能 新版功能 在 版更改 新版功能 新版功能 新版功能 客户端 服务器 是 否 否 否 否 否 否 是 否 否 否 否 否 否 是 是 是 是 否 否 是 是 否 否 否 否 是 否 是 否 否 否 是 否 否 是 脚注 参见 在 版更改 新版功能 在 版更改 新版功能 在 版更改 注解 新版功能 示例 新版功能 注解 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 参见 在 版更改 在 版更改 在 版更改 新版功能 在 版更改 在 版更改 新版功能 示例 新版功能 在 版更改 注解 新版功能 注解 注解 新版功能 注解 新版功能 注解 新版功能 注解 在 版更改 注解 新版功能 注解 新版功能 新版功能 在 版更改 在 版更改 示例 在 版更改 参见 新版功能 可以使用以下方法 在 版更改 新版功能 在 版更改 新版功能 参见 文档介绍 其他工具 语法分析程序 源代码 此模块提供了一个单独的类 它可以回答关于某个特定用户代理是否能在 站点获取发布 文件的 的问题 有关 文件结构的更多细节请参阅 这个类提供了一些可以读取 解析和回答关于 上的 文 件的问题的方法 设置指向 文件的 读取 并将其输入解析器 解析行参数 如果允许 按照被解析 文件中的规则来获取 则返回 返回最近一次获取 文件的时间 这适用于需要定期检查 文件更新情况的长时间运行的网页爬虫 将最近一次获取 文件的时间设置为当前时间 为指定的 从 返回 形参 如果此形参不存在或不适用于指定的 或者此形参的 条目存在语法错误则返回 新版功能 以 的形式从 返回 形参的内容 如果此形参不存在或 不适用于指定的 或者此形参的 条目存在语 法错误则返回 新版功能 以 的形式从 返回 形参的内容 如 果此形参不存在或者此形参的 条目存在语法错误则返回 新版功能 下面的例子演示了 类的基本用法 互联网数据处理 本章介绍了支持处理互联网上常用数据格式的模块 电子邮件与 处理包 表示一封电子邮件信息 解析电子邮件信息 附加说明 异常和缺陷类 示例 编码器 其他工具 迭代器 编码和解码器 基本使用 编码器和解码器 异常 标准符合性和互操作性 字符编码 和 数值 对象中的重复名称 顶级非对象非数组值 实现限制 命令行界面 命令行选项 文件处理 对象 异常 示例 数据编码 对 文件进行编码和解码 注释 二进制和 码互转 编码与解码经过 转码的可打印数据 对 文件进行编码与解码 对 代码使用的标记解析器 源码 为了简化标记流的处理所有的 运算符 和 定界符 以及 返回时都会打上通用的 标记 可以通过 返回的 对象的 属性来获得确切的标记类型 对输入进行解析标记 主要的入口是一个生成器 生成器 需要一个 参数这个参数必须是一个可 调用对象且能提供与文件对象的 方法相同的接 口 每次调用这个函数都要 返回字节类型输入的一行数据 在 版更改 在 版更改 新版功能 或者 新版功能 示例 或者通过 直接读取字节数据 新版功能 到 从 或者 脚注 风格路径名模式扩展 配置文件解析器 源代码 此模块提供了它实现一种基本配置语言 类这种语言所提供的结构与 文件的类似 你可以使用这种语言来编写能够由最终用户来自定义的 程序 注解 这个库 并不 能够解析或写入在 扩展版本 语法中 所使用的值类型前缀 参见 模块 支持创建可被用作应用配置文件的替代的 终端式微语言 模块 模块实现了一个 语法的子集它也可被用于这种目的 快速起步 让我们准备一个非常基本的配置文件它看起来是这样的 文件的结构描述见 以下章节 总的来说这种文件由多个节组成每个节包含多个带有值的键 类可以读取和写入这种文件 让我们先通过程序方式来创建上述的配置文件 如你所见我们可以把配置解析器当作一个字典来处理 两者确实存在差异将在后文说明但是其行为非常接近于字典所具有一般行为 现在我们已经创建并保存了一个配置文件让我们再将它读取出来并探究其中包含的数据 正如我们在上面所看到的相关的 相当直观 唯一有些神奇的地方是 小节它为所有其他小节提供了默认值 还要注意小节中的键大小写不敏感并且会存储为小写形式 支持的数据类型 配置解析器并不会猜测配置文件中值的类型而总是将它们在内部存储为字符串 这意味着如果你需要其他数据类型你应当自己来转换 由于这种任务十分常用配置解析器提供了一系列便捷的获取方法来处理整数 浮点数和布尔值 最后一个类型的处理最为有趣因为简单地将值传给 是没有用的 仍然会是 为解决这个问题配置解析器还提供了 这个方法对大小写不敏感并可识别 和 等布尔值 例如 除了 配置解析器还提供了同类的 和 方法 你可以注册你自己的转换器并或是定制已提供的转换器 回退值 与字典类似你可以使用某个小节的 方法来提供回退值 请注意默认值会优先于回退值 例如在我们的示例中 键仅在 小节被指定 如果你尝试在 小节获取它我们将总是获取到默认值即使我们指定了一个回退值 还需要注意的一点是解析器层级的 方法提供了自定义的更复杂接口它被维护用于向下兼容 当使用此方法时回退值可以通过 仅限关键字参数来提供 同样的 参数也可在 和 方法中使用例如 受支持的 文件结构 配置文件是由小节组成的每个小节都有一个 标头加上多个由特定字符串 默认为 或 分隔的键值条目 默认情况下小节名对大小写敏感而键对大小写不敏感 键和值开头和末尾的空格会被移除 值可以被省略在此情况下键值分隔符也可以被省略 值还可以跨越多行只要其他行带有比值的第一行更深的缩进 依据解析器的具体模式空白行可能被视为多行值的组成部分也可能被忽略 配置文件可以包含注释要带有指定字符前缀 默认为 和 注释可以单独出现于原本的空白行并可使用缩进 例如 值的插值 在核心功能之上 还支持插值 这意味着值可以在被 调用返回之前进行预处理 默认实现由 来使用 它允许值包含引用了相同小节中其他 值或者特殊的默认小节中的值的格式字符串 额外的默认值可以在初始 化时提供 例如 在上面的例子里 的 设为 这会将 求解为 的 值 在这里是 的将被实际求解为 所有插值都是按需进行的这样引用链中使用的键 不必以任何特定顺序在配置文件中指明 当 设为 时解析器会简单地返回 作为 的值并返回 作为 的值 一个用于插值的替代处理程序实现了更高级的语法它被用于 中的实例 扩展插值使用 来表示来 自外部小节的值 插值可以跨越多个层级 为了方便使用 部 分可被省略插值会默认作用于当前小节可能会从特殊小节获取默认值 例如上面使用基本插值描述的配置使用扩展插值将是这个样子 来自其他小节的值也可以被获取 映射协议访问 定制解析器行为 旧式 示例 主要出于向下兼容性的考虑 还提供了一种采用显式 方法的旧式 虽然以下介绍的方法存在有效的用例但对于新项目仍建议采用映射协议访问 旧式 在多数时候都更复杂 更底层并且完全违反直觉 一个写入配置文件的示例 一个再次读取配置文件的示例 要获取插值请使用 默认值在两种类型的 中均可用 它们将在当某个选项未在别处定义时被用于插值 对象 主配置解析器 当给定 时它会被初始化为包含固有默认值的 字典 当给定 时它将被用来创建包含节 节中的选项以及 默认值的字典 当给定 时它会被用作分隔键与值的子字符串的集合 当给 定 时它将被用作在否则为空行的注释的前缀子字符 串的集合 注释可以被缩进 当给定 时它 将被用作非空行的注释的前缀子字符串的集合 当 为 默认值 时解析器在从单个源文件 字符串或 字典读取时将不允许任何节或选项出现重复否则会引发 或 当 为 默认值 时每个空行均 表示一个选项的结束 在其他情况下一个多行选项内部的空行会被保留为 值的一部分 当 为 默认值 时将 接受没有值的选项此种选项的值将为 并且它们会以不带末尾分隔 符的形式被序列化 当给定 时它将指定存放其他节的默认值和用于插值的 特殊节的名称 通常命名为 该值可通过使用 实例属性在运行时被读取或修改 插值行为可通过给出 参数提供自定义处理程序的方式来定 制 可用来完全禁用插值 提供了一 种更高级的变体形式它的设计受到了 的启发 有关该主 题的更多信息请参见 专门的文档章节 插值中使用的所有选项名称将像任何其他选项名称引用一样通过 方法来传递 例如使用 的默认实现 它会将选项名称转换为小写形式时值 和 是等价的 当给定 时它应当为一个字典其中每个键代表一个类型转 换器的名称而每个值则为实现从字符串到目标数据类型的转换的可调用对象 每个转换器会获得其在解析器对象和节代理上对应的 方法 在 版更改 默认的 为 在 版更改 添加了 以及 在 版更改 添加了 参数 在 版更改 参数会通过 来读取提供全解 析器范围内一致的行为非字符串类型的键和值会被隐式地转换为字符串 在 版更改 默认的 为 因为它现在会保留插入顺 序 返回包含实例范围内默认值的字典 返回可用节的列表 不包括在该列表中 向实例添加一个名为 的节 如果给定名称的节已存在将会 引发 如果传入了 名称 则会引发 节名称必须为字符串如果不是则会引发 在 版更改 非字符串的节名称将引发 指明相应名称的 是否存在于配置中 不 包含在内 返回指定 中可用选项的列表 如果给定的 存在并且包含给定的 则返回 否则返回 如果指定的 为 或空字符串则 会使用 尝试读取并解析一个包含文件名的可迭代对象返回一个被成功解析的文 件名列表 如果 为字符串 对象或 它 会被当作单个文件来处理 如果 中名称对应的某个文件无 法被打开该文件将被忽略 这样的设计使得你可以指定包含多个潜在 配置文件位置的可迭代对象例如当前目录 用户家目录以及某个系统级 目录存在于该可迭代对象中的所有配置文件都将被读取 如果名称对应的文件全都不存在则 实例将包含一个空 数据集 一个要求从文件加载初始值的应用应当在调用 来获 取任何可选文件之前使用 来加载所要求的一个或多个文 件 新版功能 形参 在之前的版本中所有文件都将使用 的默认编码格式来读取 新版功能 形参接受一个 新版功能 形参接受一个 对象 从 读取并解析配置数据它必须是一个产生 字符串的可迭 代对象例如以文本模式打开的文件 可选参数 指定要读取的文件名称 如果未给出并且 具有 属性则该属性会被用作 默认值为 新版功能 替代 从字符串中解析配置数据 可选参数 指定一个所传入字符串的上下文专属名称 如果未 给出则会使用 这通常应为一个文件系统路径或 新版功能 从任意一个提供了类似于字典的 方法的对象加载配置 键为 节名称值为包含节中所出现的键和值的字典 如果所用的字典类型会 保留顺序则节和其中的键将按顺序加入 值会被自动转换为字符串 可选参数 指定一个所传入字曲的上下文专属名称 如果未给 出则会使用 此方法可被用于在解析器之间拷贝状态 新版功能 获取指定名称的 的一个 的值 如果提供了 则它必须为一个字典 的查找顺序为 如果 有提供 以及 如果未找到该键并且提供 了 则它会被用作回退值 可以提供 作为 值 所有 插值会在返回值中被展开除非 参数为真值 插值 键所使用的值会按与选项相同的方式来查找 在 版更改 和 都是仅限关键字参数 以防止用户试图使用第三个参数作业为 回退值特别是在使 用映射 协议的时候 将在指定 中的 强制转换为整数的便捷方法 参见 获取对于 和 的解释 将在指定 中的 强制转换为浮点数的便捷方法 参 见 获取对于 和 的解释 将在指定 中的 强制转换为布尔值的便捷方法 请 注意选项所接受的值为 和 它们会 使得此方法返回 以及 和 它们会使得此方法返回 这些字符串值会以对大小写不敏感 的方式被检测 任何其他值都将导致引发 参见 获取对于 和 的解释 当未给出 时将返回由 对组成的列表包括 在其他情况下将返回给定的 中的 的 对组成的列表 可选参数具有与 方法的参数相同的含 义 在 版更改 中的条目将不在结果中出现 之前的行为混淆 了实际的解析器选项和为插值提供的变量 如果给定的节存在则将所给出的选项设为指定的值在其他情况下将引 发 和 必须为字符串如果不是 则将引发 将配置的表示形式写入指定的 该对象必须以文本模式打 开接受字符串 此表示形式可由将来的 调用进行解析 如果 为真值键和值之前的分隔符两边将 加上空格 将指定的 从指定的 中移除 如果指定的节不存在 则会引发 如果要移除的选项存在则返回 在其他情况下将返回 从配置中移除指定的 如果指定的节确实存在则返回 在其他情况下将返回 将选项名 转换为输入文件中的形式或客户端代码所传入的应当 在内部结构中使用的形式 默认实现将返回 的小写形式版本 子类可以重载此行为或者客户端代码也可以在实例上设置一个具有此 名称的属性来影响此行为 你不需要子类化解析器来使用此方法你也可以在一个实例上设置它或 使用一个接受字符串参数并返回字符串的函数 例如将它设为 将 使得选项名称变得大小写敏感 请注意当读取配置文件时选项名称两边的空格将在调用 之前被去除 版后已移除 使用 来代替 在 版更改 现在将在 上执行迭代而不是调用 对于调用 时传入不支持迭代的参数的现有代码可以在文件 类对象外使用以下生成器作为包装器 不再使用 而是改用 当 形参为假值时 所采用的递归插值的最大深度 这只在使 用默认的 时会起作用 对象 旧式 它默认禁用插值并且允许通过不安全的 和 方法以及旧式 关键字参数处理来设 置非字符串的节名 选项名和值 在 版更改 默认的 为 因为它现在会保留插入顺 序 注解 考虑改用 它会检查内部保存的值的类型 如果你不想 要插值你可以使用 向实例添加一个名为 的节 如果给定名称的节已存在将会 引发 如果传入了 名称 则会引发 不检查 以允许用户创建以非字符串命名的节 此行为已不受 支持并可能导致内部错误 如果给定的节存在则将给定的选项设为指定的值在其他情况下将引发 虽然可能使用 或使用 并将 形参设为真值 以便实现非字符串值的 存储但是完整功能包括插值和输出到文件只能使用字 符串值来实现 此方法允许用户在内部将非字符串值赋给键 此行为已不受支持并会在 尝试写入到文件或在非原始模式下获取数据时导致错误 请使用映射 协议 它不允许出现这样的赋值 异常 用 算法压缩 新版功能 源代码 此模块提供了可以压缩和解压缩使用 压缩算法的数据的类和便携函数 其中还包含支持 工具所使用的 和旧式 文件格式的文件接口以及相应的原始压缩数据流 此模块所提供的接口与 模块的非常类似 但是请注意 不是 线程安全的这与 不同因此如果你需要在多个线程中使用单个 实例则需要通过锁来保护它 当在压缩或解压缩期间或是在初始化压缩器解压缩器的状态期间发生错误时 此异常会被引发 读写压缩文件 在内存中压缩和解压缩数据 创建一个压缩器对象此对象可被用来执行增量压缩 压缩单个数据块的更便捷方式请参阅 参数指定应当使用哪种容器格式 可能的值有 容器格式 这是默认格式 传统的 容器格式 这种格式相比 更为受限 它不支持一致性检查或多重过滤器 原始数据流不使用任何容器格式 这个格式描述器不支持一致性检查并且要求你必须指定一个自定义的 过滤器链用于压缩和解压缩 此外以这种方式压缩的数据不可 使用 来解压缩 参见 参数指定要包含在压缩数据中的一致性检查类型 这种检查在解压 缩时使用以确保数据没有被破坏 可能的值是 没有一致性检查 这是 和 的默认值也是唯一可接受的值 位循环冗余检查 位循环冗余检查 这是 的默认值 位安全哈希算法 如果指定的检查不受支持则会引发 压缩设置可被指定为一个预设的压缩等级通过 参数或以自定 义过滤器链来详细设置通过 参数 参数如果提供应当为一个 到 包括边界 之间的整 数可以选择与常数 进行 运算 如果 和 均未给出则默认行为是使用 预设等级 更高的预设等级会产生更小的输出但会使得压缩过程更缓慢 注解 除了更加 密集使用更高的预设等级来压缩还需要更多的内存并产 生需要更多内存来解压缩的输出 例如使用预设等级 时一个 对象的开销可以高达 出于这样的原因通 常最好是保持使用默认预设等级 参数如果提供应当指定一个过滤器链 详情参见 指定自定 义的过滤器链 压缩 一个 返回包含针对输入的至少一部分 已压缩数据的 对象 一部 可能会被放入内部缓冲区 以便用于后续的 和 调用 返回的数据应当与 之前任何 调用的输出进行拼接 结束压缩进程返回包含保存在压缩器的内部缓冲区中的任意数据的 对象 调用此方法之后压缩器将不可再被使用 创建一个压缩器对象此对象可被用来执行增量解压缩 一次性解压缩整个压缩数据流的更便捷方式请参阅 参数指定应当被使用的容器格式 默认值为 它 可以解压缩 和 文件 其他可能的值为 和 参数指定解压缩器可以使用的内存上限字节数 当使用此 参数时如果不可能在给定内存上限之内解压缩输入数据则解压缩将失败并 引发 参数指定用于创建被解压缩数据流的过滤器链 此参数在 为 时要求提供但对于其他格式不应使用 有关 过滤器链的更多信息请参阅 指定自定义的过滤器链 注解 这个类不会透明地处理包含多个已压缩数据流的输入这不同于 和 要通过 来解压缩 多个数据流输入你必须为每个数据流都创建一个新的解压缩器 解压缩 一个 返回字节串形式的解压缩 数据 某些 可以在内部被缓冲以便用于后续的 调用 返回的数据应当与之前任何 调 用的输出进行拼接 如果 为非负数将返回至多 个字节的解压 缩数据 如果达到此限制并且可以产生后续输出则 属 性将被设为 在这种情况下下一次 调用提 供的 可以为 以获取更多的输出 如果所有输入数据都已被解压缩并返回或是因为它少于 个字节或是因为 为负数则 属性将 被设为 在到达数据流末尾之后再尝试解压缩数据会引发 在数据流 末尾之后获取的任何数据都会被忽略并存储至 属性 在 版更改 添加了 形参 输入流使用的一致性检查的 这可能为 直到已解 压了足够的输入数据来确定它所使用的一致性检查 若达到了数据流末尾标识符则为 压缩数据流的末尾还有数据 在达到数据流末尾之前这个值将为 如果在要求新的未解压缩输入之前 方法可以提供更多的 解压缩数据则为 新版功能 压缩 一个 对象返回包含压缩数据的 对象 参见上文的 了解有关 和 参数的说明 解压缩 一个 对象返回包含解压缩数据的 对 象 如果 是多个单独压缩数据流的拼接则解压缩所有相应数据流并 返回结果的拼接 参见上文的 了解有关 和 参数的说明 杂项 如果本系统支持给定的一致性检查则返回 和 总是受支持 和 或许不可用如果你正在使用基于受限制特性集编译的 版本的话 指定自定义的过滤器链 示例 在已压缩的数据中读取 创建一个压缩文件 在内存中压缩文件 增量压缩 写入已压缩数据到已打开的文件 使用自定义过滤器链创建一个已压缩文件 分数 源代码 模块支持分数运算 分数实例可以由一对整数一个分数或者一个字符串构建而成 第一个版本要求 和 是 的实例并返回一个新的 实例其值为 如果 为 将会引发 第二个版本要求 是 的实例并返回一个 实例且与传入值相等 下两个版本接受 或 的实例并返回一个 实例且与传入值完全相等 请注意由于二进制浮点数通常存在 的问题 参见 浮点算术争议和限制 的参数并不会精 确等于 因此 也 不会 返回用户所期望的 请参阅下文中 方法的文 档 构造器的最后一个版本接受一个字符串或 实例 此实例的 通常形式为 其中的可选项 可以为 或 并且 和 如果存在 是十进制数码的字符串 此外 构造 器所接受的任何表示一个有限值的字符串也都为 构造器所接受 不论哪种形式的输入字符串也都可以带有前缀和或后缀的空格符 这里 是一些示例 类继承自抽象基类 并实现了该类的所有 方法和操作 实例是可哈希的并应当被视为不可变对象 此 外 还具有以下属性和方法 在 版更改 构造器现在接受 和 实例 在 版更改 现在会使用 函数来正规化 和 总是返回 类型 在之前版本中 的类型取决于 和 的类型 最简分数形式的分子 最简分数形式的分母 返回由两个整数组成的元组两数之比等于该分数的值且其分母为正数 新版功能 此类方法可构造一个 来表示 的精确值该参数必须 是一个 请注意 的值并不等于 注解 从 开始在构造 实例时可以直接使用 此类方法可构造一个 来表示 的精确值该参数必须 是一个 实例 注解 从 开始在构造 实例时可以直接使用 实例 找到并返回一个 使得其值最接近 并且分母不大于 此方法适用于找出给定浮点数的有理数近似值 或是用来恢复被表示为一个浮点数的有理数 返回最大的 此方法也可通过 函数 来使用 返回最小的 此方法也可通过 函数来 使用 第一个版本返回一个 使得其值最接近 位值为二分之一时 只对偶数舍入 第二个版本会将 舍入到最接近 的倍数如果 为负值则为逻辑运算位值 为二分之一时同样只对偶数舍入 此方法也可通过 函数来使 用 参见 模块 构成数字塔的所有抽象基类 为高效循环而创建迭代器的函数 函数 配方 本节将展示如何使用现有的 作为基础构件来创建扩展的工具集 基本上所有这些西方和许许多多其他的配方都可以通过 上的 项目 来安装 扩展的工具提供了与底层工具集相同的高性能 保持了超棒的内存利用率因为一次只处理一个元素而不是将整个可迭代对象加载到内存 代码量保持得很小以函数式风格将这些工具连接在一起有助于消除临时变量 速度依然很快因为倾向于使用矢量化构件来取代解释器开销大的 循环和 消息提示 源代码 模块提供了一个模板基类以及多个常用配置的便捷方法 消息框为模式窗口并将基于用户的选择返回 的一个子集 常用消息框风格和布局包括但不限于 图片 创建一个默认信息消息框 信息消息框 警告消息框 疑问消息框 在 版更改 支持了 语句 在 版更改 在 版更改 在 版更改 版后已移除 在 版更改 参见 在 版更改 新版功能 在 版更改 在 版更改 示例 新版功能 在 版更改 注解 新版功能 新版功能 子进程 源代码 本节介绍了用于创建和管理子进程的高层级 下面的例子演示了如何用 运行一个 命令并获取其结果 将打印 由于所有 子进程函数都是异步的并且 提供了许多工具用来配合这些函数使用因此并行地执行和监视多个子进程十分容易 要修改上面的例子来同时运行多个命令确实是非常简单的 另请参阅 小节 创建子进程 创建一个子进程 参数为 和 设置 包装器的缓冲区上限如果将 传给了 和 参数 返回一个 实例 有关其他形参的说明请查阅 的文档 形参 运行 命令 参数为 和 设置 包装器的缓冲区上限如果将 传给了 和 参数 返回一个 实例 有关其他形参的说明请查阅 的文档 重要 应用程序要负责确保正确地转义所有空白字符和特殊字符以防止 注 入 漏洞 函数可以被用来正确地转义字符串中可以被 用来构造 命令的空白字符和特殊 字符 形参 注解 如果使用了 则子进程将在 中可用 详情参 见 上的子进程支持 参见 还有下列 低层级 可配合子进程使用 以及 子进程 传输 和 子进程协议 常数 可以被传递给 或 形参 如果 被传递给 参数则 属性将会指向 一个 实例 如果 被传递给 或 参数则 和 属性将会指向 实例 可以用作 参数的特殊值表示标准错误应当被重定向到标准输出 可以用作 或 参数来处理创建函数的特殊值 它表示将为相应的子进程流使用特殊文件 与子进程交互 和 函数都返回 类的实例 是一个高层级包装器它允许与子进程通信并监视其完成情况 一个用于包装 函数创建的 进程的对象 这个类被设计为具有与 类相似的 但两者有一些 重要的差异 不同于 实例没有与 方法等价的方法 和 方法没有 形参要使用 函数 方法是异步的而 方法 则被实现为阻塞型忙循环 形参不被支持 这个类 不是线程安全的 请参阅 子进程和线程 部分 等待子进程终结 设置并返回 属性 注解 当使用 或 并且子进程产生了足以阻塞 管道缓冲区等待接收更多的数据的输出时此方法会发生死锁 当 使用管道时请使用 方法来避免这种情况 与进程交互 发送数据到 如果 不为 从 和 读取数据直至到达 等待进程终结 可选的 参数为将被发送到子进程的数据 对象 返回一个元组 如果在将 写入到 时引发了 或 异常异常会被忽略 此条件会在进程先于所 有数据被写入到 之前退出时发生 如果想要将数据发送到进程的 则创建进程时必须使用 类似地要在结果元组中获得任何不为 的值 则创建进程时必须使用 和或 参数 注意数据读取在内存中是带缓冲的因此如果数据量过大或不受则不要 使用此方法 将信号 发送给子进程 注解 在 上 是 的别名 和 可被发送给创建时设置了 形参且其中包括 的进 程 停止子进程 在 系统中此方法会发送 给子进程 在 上会调用 函数 以停止子 进程 杀掉子进程 在 系统中此方法会发送 给子进程 在 上此方法是 的别名 标准输入流 或者如果进程创建时设置了 则为 标准输出流 或者如果进程创建时设置了 则为 标准错误流 或者如果进程创建时设置了 则为 警告 使用 方法而非 或 这可以避 免由于流暂停读取或写入并阻塞子进程而导致的死锁 进程标识号 注意对于由 函数所创建的进程这个属性将是所生成 的 的 当进程退出时返回其代号 值表示进程尚未终止 一个负值 表示子进程被信号 中断 仅 子进程和线程 标准 事件循环默认支持从不同线程中运行子进程 在 上子进程默认只由 提供 没有子进程支持 在 上会使用 来让子进程结束等待详情请参阅 进程监视器 在 版更改 对于从不同线程中无限制地生成子进程会切换为使用 使用 不活动的 当前子监视器生成子进程将引发 请注意其他的事件循环实现可能有其本身的限制请查看它们各自的文档 参见 中的并发和多线程 章节 示例 一个使用 类来控制子进程并用 类来从其标准输出读取信息的示例 这个子进程是由 函数创建的 另请参阅使用低层级 编写的 相同示例 编译 源文件 数据类型 源代码 模块实现了一个简单高效的 用于解析和创建 数据 在 版更改 版后已移除 警告 模块对于恶意构建的数据是不安全的 如果需要解 析不可信或未经身份验证的数据请参见 漏洞 教程 这是一个使用 简称 的简短教程 目标是演示模块的一些构建块和基本概念 树和元素 是一种固有的分层数据格式最自然的表示方法是使用树 为此 有两个类 将整个 文档表示为一个树 表示该树中的单个节点 与整个文档的交互读写文件通常在 级别完成 与单个 元素及其子元素的交互是在 级别完成的 解析 我们将使用以下 文档作为本节的示例数据 可以通过从文件中读取来导入此数据 或直接从字符串中解析 将 从字符串直接解析为 该元素是已解析树的根元素 其他解析函数可能会创建一个 确切信息请查阅文档 作为 具有标签和属性字典 还有可以迭代的子节点 子级是可以嵌套的我们可以通过索引访问特定的子级节点 注解 并非 输入的所有元素都将作为解析树的元素结束 目前此模块跳过输入 中的任何 注释 处理指令和文档类型声明 然而使用这个模块的 而不 是从 文本解析构建的树可以包含注释和处理指令生成 输出时同样包含 这些注释和处理指令 可以通过将自定义 实例传递给 构造函数来访问文档类型声明 进行非阻塞解析 查找感兴趣的元素 有一些很有效的方法可帮助递归遍历其下的所有子树包括子级子级的子级等等 例如 仅查找当前元素的直接子元素中带有指定标签的元素 找带有特定标签的 第一个 子级然后可以用 访问元素的文本内容 访问元素的属性 通过使用 可以更精确地指定要查找的元素 修改 文件 构建 文档 函数还提供了一种便捷方法来为给定元素创建新的子元素 使用命名空间解析 其他资源 支持 示例 支持的 语法 语法 含义 在 版更改 选择所有子元素包括注释和处理说明 例如 选择 所有名为 的 孙元素 选择当前节点 这在路径的开头非常有用用于指示它是相对 路径 选择具有给定属性的所有元素 选择给定属性具有给定值的所有元素 该值不能包含引号 选择所有包含 子元素的元素 只支持直系子元素 选择完整文本内容等于 的所有元素包括后代 新版功能 选择所有包含名为 的子元素的元素这些子元素包 括后代的完整文 本内容等于给定的 谓词方括号内的表达式之前必须带有标签名称星号或其他谓词 谓词前必须有标签名称 参考引用 函数 转换功能 典型使用 默认值否 默认值否 新版功能 在 版更改 新版功能 新版功能 注解 版后已移除 参数 在 版更改 新版功能 新版功能 形参 新版功能 在 版更改 新版功能 新版功能 形参 新版功能 在 版更改 支持 示例 结果可能如下所示 参考引用 函数 新版功能 元素对象 一个标识此元素意味着何种数据的字符串换句话说元素类型 新版功能 新版功能 新版功能 新版功能 对象 新版功能 新版功能 形参 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 对象 在 版更改 对象 注解 新版功能 在 版更改 异常 脚注 低层级 索引 本页列出所有低层级的 获取事件循环 获取当前运行的事件循环 首选 函数 获得一个事件循环实例当前或通过策略 通过当前策略将事件循环设置当前事件循环 创建一个新的事件循环 示例 使用 事件循环方法集 查阅 事件循环方法 相关的主要文档段落 生命周期 运行一个期程任务可等待对象直到完成 一直运行事件循环 停止事件循环 关闭事件循环 返回 如果事件循环正在运行 返回 如果事件循环已经被关闭 关闭异步生成器 调试 开启或禁用调试模式 获取当前测试模式 调度回调函数 尽快调用回调 方法线程安全的变体 在给定时间 之后 调用回调函数 在 指定 时间调用回调函数 线程进程池 在 执行器中运行一个独占 或 其它阻塞函数 设置 默认执行器 任务与期程 创建一个 对象 将协程当作 一样调度 设置 使用的工厂它将用来创建 获取 使用的工厂它用来创建 异步版的 异步版的 网络和 打开一个 链接 创建一个 服务 打开一个 连接 创建一个 服务 将 包装成 对 打开一个数据报 连接 通过传输通道发送一个文件 将一个已建立的链接升级到 将管道读取端包装成 对 将管道写入端包装成 对 套接字 从 接收数据 从 接收数据到一个缓冲区中 发送数据到 链接 接受一个 链接 利用 发送一个文件 开始对一个文件描述符的可读性的监视 停止对一个文件描述符的可读性的监视 开始对一个文件描述符的可写性的监视 停止对一个文件描述符的可写性的监视 信号 给 添加一个处理回调函数 删除 的处理回调函数 子进程 衍生一个子进程 从终端命令衍生一个子进程 错误处理 调用异常处理器 设置一个新的异常处理器 获取当前异常处理器 默认异常处理器实现 示例 使用 和 使用 使用 实现 客户端 使用 去 链接 使用 监听 文件描述符的读取事件 使用 使用 传输 协议 协议类可以由下面 回调方法 实现 链接建立时被调用 链接丢失或关闭时被调用 传输的缓冲区超过高位标记位时被调用 传输的缓冲区传送到低位标记位时被调用 流协议 套接字 管道 接收到数据时被调用 接收到 时被调用 缓冲流协议 调用后会分配新的接收缓冲区 用接收的数据更新缓冲区时被调用 接收到 时被调用 数据报协议 接收到数据报时被调用 前一个发送或接收操作引发 时被调用 子进程协议 子进程向 或 管道写入数据时被调用 与子进程通信的其中一个管道关闭时被调用 子进程退出时被调用 事件循环策略 策略是改变 这类函数行为的一个底层机制 更多细节可以查阅 策略部分 访问策略 返回当前进程域的策略 设置一个新的进程域策略 策略对象的基类 编解码器注册和相关基类 编解码器基类 模块定义了一系列基类用来定义配合编解码器对象进行工作的接口并且也可用作定制编解码器实现的基础 每种编解码器必须定义四个接口以便用作 中的编解码器无状态编码器 无状态解码器 流读取器和流写入器 流读取器和写入器通常会重用无状态编码器解码器来实现文件协议 编解码器作者还需要定义编解码器将如何处理编码和解码错误 错误处理方案 无状态的编码和解码 增量式的编码和解码 流式的编码和解码 编码格式与 标准编码 专属的编码格式 有一些预定义编解码器是 专属的因此它们在 之外没有意义 这些编解码器按其所预期的输入和输出类型在下表中列出请注意虽然文本编码是编解码器最常见的使用场景但下层的编解码器架构支持任意数据转换而不仅是文本编码 对于非对称编解码器该列描述的含义是编码方向 文字编码 二进制转换 文字转换 应用程序中的国际化域名 此模块实现了 应用程序中的国际化域名 和 用于国际化域名 的 配置文件 它是在 编码格式和 的基础上构建的 这些 共同定义了一个在域名中支持非 字符的协议 一个包含非 字符的域名 例如 会被转换为兼容 的编码格式 简称 例如 随后此域名的 形式可以用于所有由于特定协议而不允许使用任意字符的场合例如 查询 字段等等 此转换是在应用中进行的如有可能将对用户可见应用应当透明地将 域名标签转换为线上的 并在 标签被呈现给用户之前将其转换回 以多种方式支持这种转换 编解码器执行 和 之间的转换基于在 中定义的分隔字符将输入字符串拆分为标签再根据需要将每个标签转换为 相反地又会基于 分隔符将输入字节串拆分为标签再将找到的任何 标签转换为 此外 模块可透明地将 主机名转换为 以便应用在将它们传给 模块时无须自行转换主机名 除此之外许多包含以主机名作为函数参数的模块例如 和 都接受 主机名并且 也会在 字段中透明地发送 主机名如果它需要发送该字段的话 当从线路接收主机名时例如反向名称查找到 的转换不会自动被执行希望向用户提供此种主机名的应用应当将它们解码为 模块还实现了 过程该过程会对主机名执行特定的规范化操作以实现国际域名的大小写不敏感特性与合并相似的字符 如果有需要可以直接使用 函数 返回 经过名称处理操作的版本 该实现目前基于查询字符串因 此 为真值 将标签转换为 规则定义见 预设为假值 将标签转换为 规则定义见 代码页 带 签名的 编解码器 编码器 注册配合 模块使用的函数 源代码 模块提供了可在封存特定对象时使用的一种定义函数方式 和 模块会在封存拷贝特定对象时使用这些函数 此模块提供了非类对象构造器的相关配置信息 这样的构造器可以是工厂函数或类实例 将 声明为一个有效的构造器 如果 是不可调用的因 而不是一个有效的构造器则会引发 声明该 应当被用作 类型对象的归约函数 应当返回字符串或包含两到三个元素的元组 如果提供了可选的 形参它应当是一个可用来重建相应对象 的可调用对象在调用该对象时应传入由 所返回的参数元组 如果 是一个类或 是不可调用的则将引发 请查看 模块了解 和 所要求的接口的 详情 请注意一个 对象或 的子类的 属性也可以被用来声明归约函数 示例 以下示例将会显示如何注册一个封存函数以及如何来使用它 的 黄页 接口 模块提供了对 库的轻量级包装适用于多个主机的集中管理 因为 仅存在于 系统此模块仅在 上可用 模块定义了以下函数 返回 在映射 中的匹配结果如无结果则会引发错误 两个参数都应为字符串 定长 个比特 返回值 为任意字节数组可包含 和其他特殊值 请注意如果 是另一名称的别名则会先检查别名 参数可允许重载用于查找的 域 如果未指定则会在默认 域中查找 返回一个字典其元素为 到 的映射使得 请注意字典的键和值均为任意字节数组 请注意如果 是另一名称的别名则会先检查别名 参数可允许重载用于查找的 域 如果未指定则会在默认 域中查找 返回全部可用映射的列表 参数可允许重载用于查找的 域 如果未指定则会在默认 域中查找 返回系统默认的 域 模块定义了以下异常 当 函数返回一个错误码时引发的异常 自定义 解释器 本章中描述的模块允许编写类似于 的交互式解释器的接口 如果你想要一个支持附加一些特殊功能到 语言的 解释器你应该看看 模块 模块是低层级的用于支持编译可能不完整的 代码块 本章描述的完整模块列表如下 解释器基类 交互解释器对象 交互式控制台对象 编译 代码 导入模块 本章中介绍的模块提供了导入其他 模块和挂钩以自定义导入过程的新方法 本章描述的完整模块列表如下 从 存档中导入模块 对象 示例 包扩展工具 查找脚本使用的模块 的示例用法 的实现 概述 函数 关于导入的抽象基类 资源 示例 概述 可用 来自 运行时的有用例程 这些函数提供了对 平台上一些有用功能的访问 一些更高级别的模块使用这些函数来构建其服务的 实现 例如 模块在实现 函数时使用了这些函数 关于这些函数的更多信息可以在平台 文档中找到 该模块实现了控制台 的普通和宽字符变体 普通的 只处理 字符国际化应用受限 应该尽可能地使用宽字符 在 版更改 此模块中过去会引发 的操作现在将引发 文件操作 基于文件描述符 从 运行时锁定文件的某一部分 失败时引发 锁定的文件区域从当前文件位置开始扩展 个字节 并可能持续到超出文件末尾 必须为下面列出的 之一 一 个文件中的多个区域可以被同时锁定但是不能重叠 相邻区域不会被合并 它们必须单独被解锁 引发一个 审计事件 附带参数 锁定指定的字节数据 如果字节数据无法被锁定程序会在 秒之后立即 重试 如果在 次尝试后字节数据仍无法被锁定则会引发 锁定指定的字节数据 如果字节数据无法被锁定则会引发 解锁指定的字节数据该对象必须在之前被锁定 设置文件描述符 的行结束符转写模式 要将其设为文本模式则 应当为 设为二进制模式则应当为 基于文件句柄 创建一个 运行时文件描述符 形参应 当 和 按位 的结果 返 回的文件描述符可以被用作 的形参以创建一个文件对象 引发一个 审计事件 附带参数 返回文件描述符 的文件句柄 如果 不能被识别则会引发 引发一个 审计事件 附带参数 控制台 如果有某个按键正在等待被读取则返回 读取一个按键并将结果字符返回为一个字节串 不会有内容回显到缝制台 如果还没有任何键被按下此调用将会阻塞但它将不会等待 被按下 如果按下的键是一个特殊功能键此函数将返回 或 下一次调用将返回键代码 按钮无法使用此函数来读取 的宽字符版本返回一个 值 类似于 但按键如果表示一个可打印字符则它将被回显 的宽字符版本返回一个 值 将字符串 打印到终端不使用缓冲区 的宽字符版本接受一个 值 使得字节串 被推回终端缓冲区它将是被 或 读取的下一个字符 的宽字符版本接受一个 值 其他函数 强制 堆清空自身并将未使用的块返回给操作系统 失败时这 将引发 操作库 源代码 提供了创建 处理和操作 和 地址和网络的功能 该模块中的函数和类可以直接处理与 地址相关的各种任务包括检查两个主机是否在同一个子网中遍历某个子网中的所有主机检查一个字符串是否是一个有效的 地址或网络定义等等 这是完整的模块 参考 若要查看概述请见 模块介绍 新版功能 方便的工厂函数 模块提供来工厂函数来方便地创建 地址网络和接口 返回一个 或 对象取决于作为参数传递的 地址 可以提供 或 地址小于 的整数默认被认为是 如果 不是有效的 或 地址则会抛出 返回一个 或 对象具体取决于作为参数传 入的 地址 是表示 网址的字符串或整数 可以提供 或 网址小于 的整数默认被视为 会被 传给 或 构造器 如果 不表示 有效的 或 网址或者网络设置了 比特位则会引发 返回一个 或 对象取决于作为参数传 递的 地址 是代表 地址的字符串或整数 可以提供 或 地址小于 的整数默认认为是 如果 不是有效的 或 地址则会抛出一个 这些方便的函数的一个缺点是需要同时处理 和 格式这意味着提供的错误信息并不精准因为函数不知道是打算采用 还是 格式 更详细的错误报告可以通过直接调用相应版本的类构造函数来获得 地址 地址对象 运算符 在 版更改 新版功能 新版功能 版后已移除 在 版更改 运算符 迭代 运算符 异步 指令响应 处理器 版后已移除 请使用 替代 注解 该模块仅为提供向后兼容 我们推荐在新代码中使用 描述 构建和安装 模块 包为将待构建和安装的额外的模块打包成 安装包提供支持 新模块既可以是百分百的纯 也可以是用 写的扩展模块或者可以是一组包含了同时用 和 编码的 包 大多数 用户 不会 想要直接使用这个包而是使用 包官方维护的跨版本工具 特别地 是一个对于 的增强选项它能提供 对声明项目依赖的支持 额外的用于配置哪些文件包含在源代码发布中的机制包括与版本控制系统集 成需要的插件 生成项目进入点的能力进入点可用作应用插件系统的基础 自动在安装时间生成 命令行可执行文件的能力而不是需要预编译 它们 跨所有受支持的 版本上的一致的表现推荐的 安装器用 运行所有的 脚本即使脚本本身只引了 包 参考 获得更多信息 为了打包工具的作者和用户能更好理解当前的打包和分发系统遗留的基于 的用户文档和 参考保持可用 安装 模块旧版 分发 模块遗留版本 在 版更改 此模块中过去会引发 的操作现在将引发 参见 在 版更改 现在支持可写的 字节类对象 在 版更改 现在支持可写的 字节类对象 在 版更改 文件格式 描述 采样率 描述 的默认采样率 语音录音 品质的音频 位采样和 通道 品质的音频 位采样 在 版更改 基于进程的并行 源代码 概述 是一个支持使用与 模块类似的 来产生进程的包 包同时提供了本地和远程并发操作通过使用子进程而非线程有效地绕过了 全局解释器锁 因此 模块允许程序员充分利用给定机器上的多个处理器 它在 和 上均可运行 模块还引入了在 模块中没有的 一个主要的例子就是 对象它提供了一种快捷的方法赋予函数并行化处理一系列输入值的能力可以将输入数据分配给不同进程处理数据并行 下面的例子演示了在模块中定义此类函数的常见做法以便子进程可以成功导入该模块 这个数据并行的基本例子使用了 将在标准输出中打印 类 在 中通过创建一个 对象然后调用它的 方法来生成进程 和 相同 一个简单的多进程程序示例是 要显示所涉及的各个进程 这是一个扩展示例 关于为什么 部分是必需的解释请参见 编程指导 上下文和启动方法 在进程之间交换对象 支持进程之间的两种通信通道队列 类是一个近似 的克隆 例如 队列是线程和进程安全的 管道 函数返回一个由管道连接的连接对象默认情况下是双工双向 例如 返回的两个连接对象 表示管道的两端 每个连接对象都有 和 方法相互之间的 请注意如果两个进程或线 程同时尝试读取或写入管道的 同一 端则管道中的数据可能会损坏 当然在不同进程中同时使用管道的不同端的情况下不存在损坏的风险 进程间同步 对于所有在 存在的同步原语 中都有类似的等价物 例如可以使用锁来确保一次只有一个进程打印到标准输出 不使用锁的情况下来自于多进程的输出很容易产生混淆 进程间共享状态 如上所述在进行并发编程时通常最好尽量避免使用共享状态 使用多个进程时尤其如此 但是如果你真的需要使用一些共享数据那么 提供了两种方法 共享内存 可以使用 或 将数据存储在共享内存映射中 例如以下 代码 将打印 创建 和 时使用的 和 参数是 模块使用 的类型的 表示双精度浮点数 表示有符号整数 这些共享对象将是进程和线程安全的 为了更灵活地使用共享内存可以使用 模块该模块支持创建从共享内存分配的任意 对象 服务进程 由 返回的管理器对象控制一个服务进程该进程保存 对 象并允许其他进程使用代理操作它们 返回的管理器支持类型 和 例如 将打印 使用服务进程的管理器比使用共享内存对象更灵活因为它们可以支持任意 对象类型 此外单个管理器可以通过网络由不同计算机上的进程共享 但 是它们比使用共享内存慢 使用工作进程 类表示一个工作进程池 它具有允许以几种不同方式将任务分配到工作进程的方法 例如 请注意进程池的方法只能由创建它的进程使用 注解 这个包中的功能要求子进程可以导入 模块 虽然这在 编程指导 中有描述但还是需要提前说明一下 这意味着一些示例在交互式解释器中不 起作用比如 示例 例如 如果尝试执行上面的代码它会以一种半随机的方式将三个完整的堆栈内容 交替输出然后你只能以某种方式停止父进程 参考 包主要复制了 模块的 和异常 管道和队列 杂项 返回当前进程存活的子进程的列表 调用该方法有等待已经结束的进程的副作用 返回系统的 数量 该数量不同于当前进程可以使用的 数量 可用的 数量可以由 方法获得 可能引发 参见 返回与当前进程相对应的 对象 和 相同 返回父进程 对象和父进程调用 返回 的对象一样 如果一个进程已经是主进程 会返回 新版功能 为使用了 的程序提供冻结以产生 可执行文 件的支持 在 和 上测试通 过 需要在 模块的 该行之后马上调用该函 数 例如 如果没有调用 在尝试运行被冻结的可执行文件时会抛 出 异常 对 的调用在非 平台上是无效的 如果该模 块在 平台的 解释器中正常运行 该程序没有被冻结 调 用 也是无效的 返回支持的启动方法的列表该列表的首项即为默认选项 可能的启动方法 有 和 在 中只有 是可用的 平台总是支持 和 且 是默认值 新版功能 返回一个 对象 该对象具有和 模块相同的 如果 设置成 那么将返回默认上下文对象 否则 应该是 如果指定的 启动方法不存在将抛出 异常 新版功能 返回启动进程时使用的启动方法名 如果启动方法已经固定并且 被设置成 那么启动 方法将被固定为默认的启动方法并且返回其方法名 如果启动方法没有设 定并且 被设置成 那么将返回 返回值将为 或者 是 的默认值 是 的 默认值 新版功能 设置在启动子进程时使用的 解释器路径 默认使用 嵌入式编程人员可能需要这样做 以使他们可以创建子进程 在 版更改 现在在 平台上使用 启动方法时支持调 用该方法 设置启动子进程的方法 可以是 或 者 注意这最多只能调用一次并且需要藏在 模块中由 进行保护 新版功能 注解 并没有包含类似 或者 的方法和类 连接 对象 同步原语 共享 对象 管理器 代理对象 代理是一个 指向 其他共享对象的对象这个对象很可能在另外一个进程中 共享对象也可以说是代理 指涉 的对象 多个代理对象可能指向同一个指涉对象 代理对象代理了指涉对象的一系列方法调用虽然并不是指涉对象的每个方法都有必要被代理 通过这种方式代理的使用方法可以和它的指涉对象一样 注意对代理使用 函数会返回指涉对象的字符串表示但是 却会返回代理本身的内部字符串表示 被代理的对象很重要的一点是必须可以被序列化这样才能允许他们在进程间传递 因此指涉对象可以包含 代理对象 这允许管理器中列表 字典或者其他代理对象 对象之间的嵌套 类似地字典和列表代理也可以相互嵌套 如果指涉对象包含了普通 或 对象对这些内部可变对象的修改不会通过管理器传播因为代理无法得知被包含的值什么时候被修改了 但是把存放在容器代理中的值本身是会通过管理器传播的会触发代理对象中的 从而有效修改这些对象所以可以把修改过的值重新赋值给容器代理 在大多是使用情形下这种实现方式并不比嵌套 代理对象 方便但是依然演示了对于同步的一种控制级别 注解 中的代理类并没有提供任何对于代理值比较的支持 所以 我们会得到如下结果 当需要比较值的时候应该替换为使用指涉对象的拷贝 代理对象是 派生类的实例 调用指涉对象的方法并返回结果 如果 是一个代理且其指涉的是 那么下面的表达式 相当于求取以下表达式的值 于管理器进程 返回结果会是一个值拷贝或者一个新的共享对象的代理 见函数 中关于参数 的文档 如果这个调用熬出了异常则这个异常会被 透传出来 如果是管理器进程本身抛出的一些其他异常则会被 转换为 异常重新抛出 特别注意如果 没有 暴露 出来将会引发一个异常 的一个使用示例 返回指涉对象的一份拷贝 如果指涉对象无法序列化则会抛出一个异常 返回代理对象的内部字符串表示 返回指涉对象的内部字符串表示 清理代理对象使用了一个弱引用回调函数当它被垃圾回收时会将自己从拥有此指涉对象的管理器上反注册当共享对象没有被任何代理器引用时会被管理器进程删除 进程池 监听器及客户端 认证密码 日志 模块 复制了 的 不过是在 模块之上包装了一层 编程指导 使用 时应遵循一些指导原则和习惯用法 所有 方法 和 启动方式 示例 创建和使用自定义管理器 代理的示例 使用 一个演示如何使用队列来向一组工作进程提供任务并收集结果的例子 高级 复用库 新版功能 源码 概述 注解 参见 类 常数 意义 可读 可写 注解 在 版更改 新版功能 示例 滚动文字控件 源代码 模块提供了一个同名的类实现了带有垂直滚动条并被配置为可以正常运作的文本控件 使用 类会比直接配置一个文本控件附加滚动条要简单得多 文本控件与滚动条打包在一个 中 方法和 方法的布局管理器从 对象中获得 这允许 控件可以直接用于实现大多数正常的布局管理行为 如果需要更具体的控制可以使用以下属性 围绕文本和滚动条控件的框架 滚动条控件 分析器 源代码 和 分析器简介 和 提供了 程序的 确定性性能分析 是一组统计数据描述程序的各个部分执行的频率和时间 这些统计数据可以通过 模块格式化为报表 标准库提供了同一分析接口的两种不同实现 对于大多数用户建议使用 这是一个 扩展插件因为其合 理的运行开销所以适合于分析长时间运行的程序 该插件基于 由 和 贡献 是一个纯 模块 就是模拟其接口的 语言 实现但它会显著增加配置程序的开销 如果你正在尝试以某种方式扩展 分析器则使用此模块可能会更容易完成任务 该模块最初由 设计和编写 注解 分析器模块被设计为给指定的程序提供执行概要文件而不是用于 基准测试目的 才是用于此目标的它能获得合理准确的结果 这特别适用于将 代码与 代码进行基准测试分析器为 代码 引入开销但不会为 级别的函数引入开销因此 代码似乎比任何 代码都更快 实时用户手册 和 模块参考 和 模块都提供下列函数 上下文管理器类型 在 版更改 添加了上下文管理器支持 开始收集分析数据 仅在 可用 停止收集分析数据 仅在 可用 停止收集分析数据并在内部将结果记录为当前 将当前 的结果写入 类 对象有以下方法 有效字符串参数 有效枚举参数 含义 调用次数 累积时间 累积时间 文件名 文件名 文件名 调用次数 原始调用计数 行号 函数名称 名称文件行 标准名称 内部时间 内部时间 新版功能 新版功能 什么是确定性性能分析 确定性性能分析 旨在反映这样一个事实即所有 函数调用 函数返回和 异常 事件都被监控并且对这些事件之间的间隔在此期间用户的代码正在执行进行精确计时 相反统计分析不是由该模块完成随机采样有效指令指针并推断时间花费在哪里 后一种技术传统上涉及较少的开销因为代码不需要检测但只提供了时间花在哪里的相对指示 在 中由于在执行过程中总有一个活动的解释器因此执行确定性评测不需要插入指令的代码 自动为每个事件提供一个 钩子 可选回调 此外 的解释特性往往会给执行增加太多开销以至于在典型的应用程序中确定性分析往往只会增加很小的处理开销 结果是确定性分析并没有那么代价高昂但是它提供了有关 程序执行的大量运行时统计信息 调用计数统计信息可用于识别代码中的错误意外计数并识别可能的内联扩展点高频调用 内部时间统计可用于识别应仔细优化的 热循环 累积时间统计可用于识别算法选择上的高级别错误 请注意该分析器中对累积时间的异常处理允许直接比较算法的递归实现与迭代实现的统计信息 局限性 一个限制是关于时间信息的准确性 确定性性能分析存在一个涉及精度的基本问题 最明显的限制是底层的 时钟 周期大约为 秒通常 因此没有什么测量会比底层时钟更精确 如果进行了足够的测量那么 误差 将趋于平均 不幸的是删除第一个错误会导致第二个错误来源 第二个问题是从调度事件到分析器调用获取时间函数实际 获取 时钟状态这需要 一段时间 类似地从获取时钟值然后保存开始直到再次执行用户代码为止退出分析器事件句柄时也存在一定的延迟 因此多次调用单个函数或调用多个函数通常会累积此错误 尽管这种方式的误差通常小于时钟的精度小于一个时钟周期但它 可以 累积并变得非常可观 与开销较低的 相比 的问题更为严重 出于这个原因 提供了一种针对指定平台的自我校准方法以便可以在很大程度上平均地消除此误差 校准后结果将更准确在最小二乘意义上但它有时会产生负数当调用计数异常低且概率之神对您不利时 因此 不要 对产生的负数感到惊慌 它们应该只在你手工校准分析器的情况下才会出现实际上结果比没有校准的情况要好 准确估量 模块的 会从每个事件处理时间中减去一个常量以补偿调用 函数和存储结果的开销 默认情况下常数为 对于特定的平台可用以下程序获得更好修正常数 局限性 当你有一个一致的答案时有三种方法可以使用 使用自定义计时器 准确估量 事件调度器 源码 模块定义了一个实现通用事件调度程序的类 类定义了一个调度事件的通用接口 它需要两个函数来实际处 理外部世界 应当不带参数地调用并返回一个数字时 间可以为任意单位 函数应当带一个参数调用与 的输出相兼容并且应当延迟其所指定的时间单位 每个事件 运行后还将调用 并传入参数 以允许其他线程有机会在多 线程应用中运行 在 版更改 和 参数是可选的 在 版更改 类可以安全的在多线程环境中使用 示例 调度器对象 实例拥有以下方法和属性 安排一个新事件 参数应该有一个数字类型兼容的返回值与传递 给构造函数的 函数的返回值兼容 计划在相同 的事件 将按其 的顺序执行 数字越小表示优先级越高 执行事件意为执行 是包含 有 的位置参数的序列 是包含 的关键字参 数的字典 返回值是一个事件可用于以后取消事件 参见 在 版更改 参数是可选的 在 版更改 添加了 形参 安排延后 时间单位的事件 除了相对时间其他参数 效果和返 回值与 的相同 在 版更改 参数是可选的 在 版更改 添加了 形参 从队列中删除事件 如果 不是当前队列中的事件则此方法将引 发 如果事件队列为空则返回 运行所有预定事件 此方法将等待使用传递给构造函数的 函数进行下一个事件然后执行它依此类推直到没有更多的计划事件 如果 为 则执行由于最快到期如果有的预定事件然 后在调度程序中返回下一个预定调用的截止时间如果有 或 都可以引发异常 在任何一种情况下调度程序 都将保持一致状态并传播异常 如果 引发异常则在将来调用 时不会尝试该事件 如果一系列事件的运行时间比下一个事件之前的可用时间长那么调度程序 将完全落后 不会发生任何事件调用代码负责取消不再相关的事件 在 版更改 添加了 形参 只读属性按照将要运行的顺序返回即将发生的事件列表 每个事件都显示为 包含以下字段 新版功能 新版功能 新版功能 模块函数 在 版更改 新版功能 在 版更改 示例 结构化标记处理工具 支持各种模块以处理各种形式的结构化数据标记 这包括使用标准通用标记语言 和超文本标记语言 的模块以及使用可扩展标记语言 的几个接口 超文本标记语言支持 简单的 和 解析器 解析器的示例程序 方法 示例 一般实体的定义 处理模块 漏洞 包 教程 树和元素 解析 进行非阻塞解析 查找感兴趣的元素 修改 文件 构建 文档 使用命名空间解析 其他资源 支持 示例 支持的 语法 参考引用 函数 支持 示例 参考引用 函数 元素对象 对象 对象 对象 异常 模块内容 节点对象 节点列表对象 文档类型对象 文档对象 元素对象 对象 对象 注释对象 和 对象 对象 异常 一致性 类型映射 对象 对象 对象 对象 工具集 对象 对象 对象 对象 对象 示例 新版功能 以元组形式存放的 的 个整数域有六个单独的属性和两个派生属性 域 意义 的前 位 接前一域的 位 接前一域的 位 接前一域的 位 接前一域的 位 的最后 位 的总长 位的时间戳 位的序列号 新版功能 在 版更改 参见 示例 简单的 和 解析器 源代码 这个模块定义了一个 类为 超文本标记语言和 文本文件解析提供基础 创建一个能解析无效标记的解析器实例 如果 为 默认值则所有字符引用 元素中的除外都会自动转换为相应的 字符 一个 类的实例用来接受 数据并在标记开始 标记结 束 文本 注释和其他元素标记出现的时候调用对应的方法 要实现具体的 行为请使用 的子类并重载其方法 这个解析器不检查结束标记是否与开始标记匹配也不会因外层元素完毕而 隐式关闭了的元素引发结束标记处理 在 版更改 关键字参数被添加 在 版更改 参数的默认值现在为 解析器的示例程序 方法 示例 用于 脚本的回溯管理器 源代码 模块提供了用于 脚本的特殊异常处理程序 这个名称有一点误导性 它最初是设计用来显示 格式的 脚本详细回溯信息 但后来被一般化为也可显示纯文本格式的回溯信息 激活这个模块之后如果发生了未被捕获的异常将会显示详细的已格式化的报告 报告显示内容包括每个层级的源代码摘录还有当前正在运行的函数的参数和局部变量值以帮助你调试问题 你也可以选择将此信息保存至文件而不是将其发送至浏览器 要启用此特性只需简单地将此代码添加到你的 脚本的最顶端 函数的选项可以控制是将报告显示在浏览器中还是将报告记录到文件供以后进行分析 此函数可通过设置 的值以使 模块接管解释器默 认的异常处理机制 可选参数 默认为 并可被设为 来停止将回溯发送至浏览 器 如果给出了参数 则回溯会被写入文件 的值应 当是一个用于存放所写入文件的目录 可选参数 是要在回溯中 的当前源代码行前后显示的上下文行数默认为 如果可选参数 为 输出将为 格式 任何其它值都会强制启用纯 文本输出 默认取值为 此函数用于处理 一个包含 返回结果的 元组 所描述的异常将其回溯格式化为文本并将结果作为字符串返回 可选参数 是要在回溯中的当前源码行前后显示的上下文行数默认为 此函数用于处理 一个包含 返回结果的 元组 所描述的异常将其回溯格式化为 并将结果作为字符串返回 可选参 数 是要在回溯中的当前源码行前后显示的上下文行数默认为 此函数使用默认设置处理异常即在浏览器中显示报告但不记录到文件 当你捕获了一个异常并希望使用 来报告它时可以使用此函数 可选的 参数应为一个包含异常类型异常值和回溯对象的 元组 与 所返回的元组完全一致 如果未提供 参数 则会从 获取当前异常 数据库 内建对象 该模块提供对 的所有内置标识符的直接访问例如 是内置函数的全名 请参阅 内置函数 和 内置常量 的文档 大多数应用程序通常不会显式访问此模块但在提供与内置值同名的对象的模块中可能很有用但其中还需要内置该名称 例如在一个想要实现 函数的模块中它包装了内置的 这个模块可以直接使用 作为一个实现细节大多数模块都将名称 作为其全局变量的一部分提供 的值通常是这个模块或者这个模块的值 属性 由于这是一个实现细节因此 的替代实现可能不会使用它 字节码反汇编器 模块通过反汇编支持 的 分析 该模块作为输入的 字节码在文件 中定义并由编译器和解释器使用 字节码是 解释器的实现细节 不保证不会在 版本之间添加 删除或更改字节码 不应考虑将此模块的跨 或 版本的使用 在 版更改 每条指令使用 个字节 以前字节数因指令而异 示例给出函数 可以使用以下命令显示 的反汇编 是行号 字节码分析 新版功能 字节码分析 允许将 代码片段包装在 对象中以便轻松访问已编译代码的详细信息 分析的字节码对应于函数 生成器 异步生成器 协程 方法 源代码字符 串或代码对象由 返回 这是下面列出的许多函数的便利包装最值得注意的是 迭代于 的实例产生字节码操作 的实例 如果 不是 则表示应该为反汇编代码中的第一个源 代码行报告的行号 否则源行信息如果有的话直接来自反汇编的代码 对象 如果 不是 则它指的是反汇编代码中的指令偏 移量 设置它意味着 将针对指定的操作码显示当前指令标记 从给定回溯构造一个 实例将设置 为异 常负责的指令 已编译的代码对象 代码对象的第一个源代码行如果可用 返回字节码操作的格式化视图与 打印相同但作为多行 字符串返回 返回带有关于代码对象的详细信息的格式化多行字符串如 在 版更改 现在可以处理协程和异步生成器对象 示例 分析函数 字节码说明 操作码集合 警告 漏洞 在 版更改 在 版更改 在 版更改 参见 新版功能 的外部函数库 是 的外部函数库 它提供了与 兼容的数据类型并允许调用 或共享库中的函数 可使用该模块以纯 形式对这些库进行封装 教程 注意在本教程中的示例代码使用 进行过测试保证其正确运行 由于有些代码在 或 下的表现不同这些代码会在 中包含相关的指令注解 注意部分示例代码引用了 类型 在 的平台上此类型是 的一个别名 所以在程序输出 而不是你期望的 时不必感到迷惑 它们实际上是同一种类型 载入动态连接库 操作导入的动态链接库中的函数 调用函数 基础数据类型 定义了一些和 兼容的基本数据类型 类型 类型 数据类型 单字符字节串对象 单字符字符串 或 或 或 字节串对象或 字符串或 或 构造函数接受任何具有真值的对象 所有这些类型都可以通过使用正确类型和值的可选初始值调用它们来创建 由于这些类型是可变的它们的值也可以在以后更改 当给指针类型的对象 和 等赋值时将改变它们所指向的 内存地址而 不是 它们所指向的内存区域的 内容 这是理所当然的因为 的 对象是不可变的 但你要注意不能将它们传递给会改变指针所指内存的函数 如果你需要可改变的内存块 提供了 函数它提供多种方式创建这种内存块 当前的内存块内容可以通过 属性存取如果你希望将它作为 结束的字符串请使用 属性 函数替代以前的 版本中的 函数 仍然可当作别名使用和 函数 函数创建包含 字符的可变内存块与之对应的 语言类型是 调用函数继续 使用自定义的数据类型调用函数 指定必选参数的类型函数原型 可以通过设置 属性的方法指定从 中导出函数的必选参数类型 必须是一个 数据类型的序列 这里的 可能不是个好例子因为它是变长参数而且每个参数的类型依赖于格式化字符串不过尝试这个功能也很方便 指定数据类型可以防止不合理的参数传递就像 函数的原型并且会自动尝试将参数转换为需要的类型 如果你想通过自定义类型传递参数给函数必须实现 类方法才能够将此自定义类型用于 序列 类方法接受一个 对象作为函数输入它应该进行类型检查或者其他必要的操作以保证接收到的对象是合法的然后返回这个对象或者它的 属性或者其他你想要传递给 函数的参数 这里也一样返回的结果必须是整型 字符串 二进制字符串 类型或者一个具有 属性的对象 返回类型 传递指针或以引用方式传递形参 结构体和联合 结构体联合字段对齐及字节顺序 默认情况下结构体和联合的字段与 的字节对齐是一样的 也可以在定义子类的时候指定类的 属性来覆盖这种行为 它必须设置为一个正整数表示字段的最大对齐字节 这和 中的 功能一样 中的结构体和联合使用的是本地字节序 要使用非本地字节序可以使用 作为基类 这些类不能包含指针字段 结构体和联合中的位域 结构体和联合中是可以包含位域字段的 位域只能用于整型字段位长度通过 中的第三个参数指定 数组 指针 可以将 类型数据传入 函数创建指针 指针实例拥有 属性它返回指针指向的真实对象如上面的 对象 注意 并没有 返回原始对象 每次访问这个属性时都会构造返回一个新的相同对象 将这个指针的 属性赋值为另一个 实例将会导致该指针指向该实例的内存地址 指针对象也可以通过整数下标进行访问 通过整数下标赋值可以改变指针所指向的真实内容 使用 以外的索引也是合法的但是你必须确保知道自己为什么这么做就像 语言中 你可以访问或者修改任意内存内容 通常只会在函数接收指针是才会使用这种特性而且你 知道 这个指针指向的是一个数组而不是单个值 内部细节 函数不只是创建了一个指针实例它首先创建了一个指针 类型 这是通过调用 函数实现的它接收 类型为参数返回一个新的类型 无参调用指针类型可以创建一个 指针 指针的布尔值是 解引用指针的时候 会帮你检测是否指针为 但是解引用无效的 非 指针仍会导致 崩溃 类型转换 通常情况下 具有严格的类型检查 这代表着 如果在函数 中或者结构体定义成员中有 类型只有相同类型的实例才会被接受 也有一些例外 比如你可以传递兼容的数组实例给指针类型 所以对于 也可以接受 类型的数组 另外如果一个函数 列表中的参数显式的定义为指针类型如 指针所指向的 类型 这个例子中是 也可以传递给函数 会自动调用对应的 转换 可以给指针内容赋值为 将其设置为 有时候你拥有一个不兼容的类型 在 中你可以将一个类型强制转换为另一个 中的 函数提供了相同的功能 上面的结构体 的 字段接收 指针或者 数组但是不能接受其他类型的实例 这种情况下 需要手动使用 函数 函数可以将一个指针实例强制转换为另一种 类型 接收两个参数一个 指针对象或者可以被转换为指针的其他类型对象和一个 指针类型 返回第二个类型的一个实例该返回实例和第一个参数指向同一片内存空间 所以 可以用来给结构体 的 字段赋值 不完整类型 不完整类型 即还没有定义成员的结构体 联合或者数组 在 中它们通常用于前置声明然后在后面定义 直接翻译成 的代码如下但是这行不通 因为新的 类 在 语句结束之前还没有完成定义 在 中我们可以先定义 类在 语句结束之后再设置 属性 让我们试试 我们定义两个 实例让它们互相指向对方然后通过指针链式访问几次 回调函数 访问 的导出变量 一些动态链接库不仅仅导出函数也会导出变量 一个例子就是 库本身的 根据启动选项 的不同它是值可能为 的整型 可以通过 类方法访问这类变量 是用于访问 接口的预定义符号 如果解释器使用 选项启动这个例子会打印 如果使用 启动则会打印 一个扩展例子 同时也展示了使用指针访问 导出的 指针对象 对文档中这个值的解释说明 该指针被初始化为指向 数组以 或者 作为结 束标记 当一个冻结模块被导入首先要在这个表中搜索 第三方库可以以 此来提供动态创建的冻结模块集合 这足以证明修改这个指针是很有用的 为了让实例大小不至于太长这里只展示如何使用 读取这个表 我们定义了 数据类型接着就可以获取这张表的指针了 由于 是指向 数组的 指针 我们可以遍历它只不过需要自己判断循环是否结束因为指针本身并不包含长度 它早晚会因为访问到野指针或者什么的把自己搞崩溃所以我们最好在遇到 后就让它退出循环 的冻结模块和冻结包由负 成员表示并不是广为人知的事情它们仅仅用于实验 例如可以使用 尝试一下这个功能 意外 也有自己的边界有时候会发生一些意想不到的事情 比如下面的例子 嗯 我们预想应该打印 但是为什么呢 这是 这行代码展开后的步骤 注意 和 对象始终引用了对象 的内容 然后执行 会把 的内容拷贝到 的空间 这也改变了 的内容 最终导致赋值语句 没有产生预想的效果 记住访问被包含在结构体 联合 数组中的对象并不会将其 复制 出来而是得到了一个代理对象它是对根对象的内部内容的一层包装 下面是另一个可能和预期有偏差的例子 注解 使用 实例化的对象只能将其值设置为 或者整数 为什么这里打印了 实例是一些内存块加上一些用于访问这些内存块的 组成 将 对象存储在内存块并不会存储对象本身而是存储了对象的 内容 每次访问对象的内容都会构造一个新的 对象 变长数据类型 对变长数组和结构体提供了一些支持 这非常好但是要怎么访问数组中额外的元素呢 因为数组类型已经定义包含 个元素导致我们访问新增元素时会产生以下错误 使用 访问变长数据类型的一个可行方法是利用 的动态特性根据具体情况在知道这个数据的大小后重新指定这个数据的类型 参考手册 寻找动态链接库 加载动态链接库 有很多方式可以将动态链接库加载到 进程 其中之一是实例化以下类的其中一个 此类的实例即已加载的动态链接库 库中的函数使用标准 调用约定并假 定返回 在 上创建 实例可能会失败即使 名称确实存在 当 某个被加载 所依赖的 未找到时将引发 错误并附带消 息 此错 误消息不包含缺失 的名称因为 并不会返回此类信息 这使得此错误难以诊断 要解决此错误并确定是哪一个 未找到你需 要找出所依赖的 列表并使用 调试与跟踪工具确定是哪一个未 找到 参见 工具 一个用于查找 依赖的工具 仅 此类的实例即加载好的动态链接库其中的函数使用 调用约定并且假定返回 指定的 返回码 的值包含的信息说明函数调用成功还是失败以及额外错误码 如果返回值表示失败会自动抛出 异常 在 版更改 以前是引发 仅 此类的实例即加载好的动态链接库其中的函数使用 调用约定并假定默认返回 在 上只能使用 调用约定为了方便 和 在这个平台上都使用标准调用约定 调用动态库导出的函数之前 会释放 并在调用后重新获取 这个类实例的行为与 类似只不过 不会 在调用函数的时候释放 锁且调用结束后会检查 错误码 如果错误码被设置会抛出 一个 异常 所以它只在直接调用 接口函数的时候有用 通过使用至少一个参数共享库的路径名调用它们可以实例化所有这些类 也可以传入一个已加载的动态链接库作为 参数其他情况会调用系统底层的 或 函数将库加载到进程并获取其句柄 可以指定库加载方式 详情请参见 手册页 在 上 会忽略 在 系统上 总是会加上 且无法配置 参数如果设置为 可以启用 的机制通过一种安全的方法获取系统的 错误码 维护了一个线程局部变量它是系统 的一份拷贝如果调用了使用 创建的外部函数 的值会与 自己拷贝的那一份进行交换函数执行完后立即再交换一次 参数如果设置为 可以在 上启用相同的策略它是通过 函数 和 管理的 和 可用于获取和设置 自己维护的 错误码拷贝 参数用于在 平台上指定库的加载方式 因为 会被忽略 他接受任何与 的 的标志兼容的值作为参数 省略时默认设置使用最安全的 加载的标志以避免 劫持等问题 传入 的全路径是保证正确加载库及其依赖最安全的方法 在 版更改 增加了 参数 用于 参数的标识值 在此标识不可用的系统上它被定义为整数 加载动态链接库的默认模式 在 上它是 其余 系统上是 这些类的实例没有共用方法 动态链接库的导出函数可以通过属性或者索引的方式访问 注意通过属性的方式访问会缓存这个函数因而每次访问它时返回的都是同一个对象 另一方面通过索引访问每次都会返回一个新的对象 还有下面这些属性可用他们的名称以下划线开头以避免和导出函数重名 用于访问库的系统句柄 传入构造函数的库名称 共享库也可以通用使用一个预制对象来加载这种对象是 类的实例具体做法或是通过调用 方法或是通过将库作为加载器实例的属性来提取 加载共享库的类 应当为 或 类型之一 具有特殊的行为它允许通过将一个共享库作为库加载器 实例的属性进行访问来加载它 加载结果将被缓存因此重复的属性访问每 次都会返回相同的库 加载一个共享库到进程中并将其返回 此方法总是返回一个新的库实例 可用的预制库加载器有如下这些 创建 实例 仅限 创建 实例 仅限 创建 实例 创建 实例 要直接访问 可以使用一个现成的 共享库对象 一个 的实例它将 函数作为属性公开 请注意所 有这些函数都应返回 当然这也不是绝对的因此你必须分配正确 的 属性以使用这些函数 引发一个 审计事件 附带参数 引发一个审计事件 附带参数 引发一个审计事件 附带参数 外部函数 正如之前小节的说明外部函数可作为被加载共享库的属性来访问 用此方式创建的函数对象默认接受任意数量的参数接受任意 数据实例作为参数并且返回库加载器所指定的默认结果类型 它们是一个私有类的实例 可调用外部函数的基类 外部函数的实例也是兼容 的数据类型它们代表 函数指针 此行为可通过对外部函数对象的特殊属性赋值来自定义 赋值为一个 类型来指定外部函数的结果类型 使用 表 示 即不返回任何结果的函数 赋值为一个不为 类型的可调用 对象也是可以的在此情 况下函数应返回 该可调用对象将附带此整数被调用以允许进 一步的处理或错误检测 这种用法已被弃用为了更灵活的后续处理或 错误检测请使用一个 数据类型作为 并将 属性赋值为一个可调用对象 赋值为一个 类型的元组来指定函数所接受的参数类型 使用 调用规范的函数只能附带与此元组长度相同数量的参数进行调 用使用 调用规范的函数还可接受额外的未指明参数 当外部函数被调用时每个实际参数都会被传给 元组中条目 的 类方法此方法允许将实际参数适配为此外部函数所 接受的对象 例如 元组中的 条目将使用 约定规则把作为参数传入的字符串转换为字节串对象 新增现在可以将不是 类型的条目放入 但每个条目 都必须具有 方法用于返回可作为参数的值整数 字符 串 实例 这样就允许定义可将自定义对象适配为函数形参的 适配器 将一个 函数或其他可调用对象赋值给此属性 该可调用对象将 附带三个及以上的参数被调用 是外部函数返回的结果由 属性指明 是外部函数对象本身这样就允许重新使用相同的可调用对象 来对多个函数进行检查或后续处理 是一个包含最初传递给函数调用的形参的元组这样就 允许对所用参数的行为进行特别处理 此函数所返回的对象将会由外部函数调用返回但它还可以在外部函数调 用失败时检查结果并引发异常 此异常会在外部函数无法对某个传入参数执行转换时被引发 引发一个审计事件 并附带参数 引发一个审计事件 附带参数 函数原型 工具函数 以整数形式返回内存缓冲区地址 必须为一个 类型的实例 引发一个 审计事件 附带参数 返回一个 类型的对齐要求 必须为一个 类 型或实例 返回指向 的轻量指针该对象必须为一个 类型的实例 默认值为零且必须为一个将被添加到内部指针值的整数 对应于这段 代码 返回的对象只能被用作外部函数调用形参 它的行为类似于 但构造起来要快很多 此函数类似于 的强制转换运算符 它返回一个 的新实例该实 例指向与 相同的内存块 必须为指针类型而 必须 为可以被作为指针来解读的对象 此函数会创建一个可变的字符缓冲区 返回的对象是一个 的 数组 必须是一个指明数组大小的整数或者是一个将被用来初始 化数组条目的字节串对象 如果将一个字节串对象指定为第一个参数则将使缓冲区大小比其长度多一 项以便数组的最后一项为一个 终结符 可以传入一个整数作为第二个 参数以允许在不使用字节串长度的情况下指定数组大小 引发一个 审计事件 附带参数 此函数会创建一个可变的 字符缓冲区 返回的对象是一个 的 数组 必须是一个指明数组大小的整数或者是一个将被用来初始 化数组条目的字符串 如果将一个字符串指定为第一个参数则将使缓冲区大小比其长度多一项以 便数组的最后一项为一个 终结符 可以传入一个整数作为第二个参数 以允许在不使用字符串长度的情况下指定数组大小 引发一个 审计事件 附带参数 仅限 此函数是一个允许使用 实现进程内 服务的钩子 它将由 扩展 所导出的 函数来调用 仅限 此函数是一个允许使用 实现进程内 服务的钩子 它将由 扩展 所导出的 函数来调用 尝试寻找一个库并返回路径名称 是库名称并且不带任何前缀如 以及后缀如 或版本号形式与 链接器选项 所用的一致 如果找不到库则返回 确切的功能取决于系统 仅限 返回 以及扩展模块所使用的 运行时库的文件名 如果无法确定库名称则返回 如果你需要通过调用 来释放内存例如某个扩展模块所分 配的内存重要的一点是你应当使用分配内存的库中的函数 仅限 返回错误码 的文本描述 如果未指定错误码则会 通过调用 函数 来获得最新的错误码 仅限 返回 在调用线程中设置的最新错误码 此函数会 直接调用 函数它并不返回错误码的 私有副本 返回调用线程中系统 变量的 私有副本的当前值 引发一个 审计事件 不附带任何参数 仅限 返回调用线程中系统 变量的 私有副本 的当前值 引发一个 审计事件 不附带任何参数 与标准 库函数相同将 个字节从 拷贝到 和 必须为整数或可被转换为指针的 实例 与标准 库函数相同将位于地址 的内存块用 个 字节的 值填充 必须为指定地址的整数或 实例 这个工厂函数创建并返回一个新的 指针类型 指针类型会被缓存并 在内部重用因此重复调用此函数耗费不大 必须为 类型 此函数会创建一个新的指向 的指针实例 返回的对象类型为 注意如果你只是想向外部函数调用传递一个对象指针你应当使用更为快 速的 此函数可改变 的内部内存缓冲区大小其参数必须为 类型的 实例 没有可能将缓冲区设为小于对象类型的本机大小值该值由 给出但将缓冲区加大则是可能的 设置调用线程中系统 变量的 私有副本的当前值为 并返回原来的值 引发一个 审计事件 附带参数 仅限 设置调用线程中系统 变量的 私有副本 的当前值为 并返回原来的值 引发一个 审计事件 附带参数 返回 类型或实例的内存缓冲区以字节表示的大小 其功能与 运算符相同 此函数返回从内存地址 开始的以字节串表示的 字符串 如果 指定了 则将其用作长度否则将假定字符串以零值结尾 引发一个 审计事件 附带参数 仅限 此函数可能是 中名字起得最差的函数 它会创建一 个 的实例 如果未指定 则会调用 来确 定错误码 如果未指定 则会调用 来获取错误 的文本描述 在 版更改 以前是会创建一个 的实例 此函数返回从内存地址 开始的以字符串表示的宽字节字符串 如果指定了 则将其用作字符串中的字符数量否则将假定字符串以 零值结尾 引发一个 审计事件 附带参数 数据类型 这个非公有类是所有 数据类型的共同基类 另外所有 类 型的实例都包含一个存放 兼容数据的内存块该内存块的地址可由 辅助函数返回 还有一个实例变量被公开为 此变量包含其他在内存块包含指针的情况下需要保持存活的 对象 数据类型的通用方法它们都是类方法严谨地说它们是 的方法 此方法返回一个共享 对象缓冲区的 实例 对象必须支持可写缓冲区接口 可选的 形参指定以字节表示 的源缓冲区内偏移量默认值为零 如果源缓冲区不够大则会引发 引发一个 审计事件 附带参数 此方法创建一个 实例从 对象缓冲区拷贝缓冲区该 对象必须是可读的 可选的 形参指定以字节表示的源缓冲区 内偏移量默认值为零 如果源缓冲区不够大则会引发 引发一个 审计事件 附带参数 此方法会使用 所指定的内存返回一个 类型的实例 该参数必须为一个整数 引发一个 审计事件 附带参数 此方法会将 适配为一个 类型 它调用时会在当该类型存 在于外部函数的 元组时传入外部函数调用所使用的实际对象 它必须返回一个可被用作函数调用参数的对象 所有 数据类型都带有这个类方法的默认实现它通常会返回 如果该对象是此类型的实例的话 某些类型也能接受其他对象 此方法返回一个由共享库导出的 类型 为导出数据的符 号名称 为所加载的共享库 数据类型的通用实例变量 有时 数据实例并不拥有它们所包含的内存块它们只是共享了某 个基对象的部分内存块 只读成员是拥有内存块的根 对象 这个只读变量在 数据实例自身已分配了内存块时为真值否则为 假值 这个成员或者为 或者为一个包含需要保持存活以使内存块的内 存保持有效的 对象的字典 这个对象只是出于调试目的而对外 公开绝对不要修改此字典的内容 基础数据类型 这个非公有类是所有基本 数据类型的基类 它在这里被提及是因为 它包含基本 数据类型共有的属性 是 的子类因此继承了其方法和属性 非指针及不包含指针的 数据类 型现在将可以被封存 实例拥有一个属性 这个属性包含实例的实际值 对于整数和指针类型它是一个整数对 于字符类型它是一个单字符字符串对象或字符串对于字符指针类型 它是一个 字节串对象或字符串 当从 实例提取 属性时通常每次会返回一个新的对象 并 没有 实现原始对象返回它总是会构造一个新的对象 所有其他 对象实例也同样如此 基本数据类型当作为外部函数调用结果被返回或者作为结构字段成员或数组项被提取时会透明地转换为原生 类型 换句话说如果某个外部函数具有 的 你将总是得到一个 字节串对象而 不是 一个 实例 基本数据类型的子类并 没有 继续此行为 因此如果一个外部函数的 是 的一个子类你将从函数调用得到一个该子类的实例 当然你可以通过访问 属性来获取指针的值 这些是基本 数据类型 代表 数据类型并将值解读为一个小整数 该构造器接 受一个可选的整数初始化器不会执行溢出检查 代表 数据类型并将值解读为单个字符 该构造器接受一个可选 的字符串初始化器字符串的长度必须恰好为一个字符 当指向一个以零为结束符的字符串时代表 数据类型 对于通用 字符指针来说也可能指向二进制数据必须要使用 该 构造器接受一个整数地址或者一个字节串对象 代表 数据类型 该构造器接受一个可选的浮点数初始化器 代表 数据类型 该构造器接受一个可选的浮点数初始化 器 在 的平台上它是 的一个别名 代表 数据类型 该构造器接受一个可选的浮点数初始化器 代表 数据类型 该构造器接受一个可选的整数初始化器 不会执行溢出检查 在 的平台上它是 的一个别名 代表 位 数据类型 通常是 的一个别名 代表 位 数据类型 通常是 的一个别名 代表 位 数据类型 通常是 的一个别名 代表 位 数据类型 通常是 的一个别名 代表 数据类型 该构造器接受一个可选的整数初始化器 不会执行溢出检查 代表 数据类型 该构造器接受一个可选的整数初始 化器不会执行溢出检查 代表 数据类型 该构造器接受一个可选的整数初始化器 不会执行溢出检查 代表 数据类型 代表 数据类型 新版功能 代表 数据类型它将值解读为一个小整数 该构造器 接受一个可选的整数初始化器不会执行溢出检查 代表 数据类型 该构造器接受一个可选的整数初始化器 不会执行溢出检查 在 的平台上它是 的一个别名 代表 位 数据类型 通常是 的一个别名 代表 位 数据类型 通常是 的一个别名 代表 位 数据类型 通常是 的一个别名 代表 位 数据类型 通常是 的一个 别名 代表 数据类型 该构造器接受一个可选的整数初始化 器不会执行溢出检查 代表 数据类型 该构造器接受一个可选的整数初 始化器不会执行溢出检查 代表 数据类型 该构造器接受一个可选的整数初始化 器不会执行溢出检查 代表 类型 该值被表示为整数形式 该构造器接受一个可选 的整数初始化器 代表 数据类型并将值解读为一单个字符的 字符串 该构造器接受一个可选的字符串初始化器字符串的长度必须恰好为一个 字符 代表 数据类型它必须为指向以零为结束符的宽字符串的指 针 该构造器接受一个整数地址或者一个字符串 代表 数据类型 更准确地说是 它的值可以为 或 并且该构造器接受任何具有逻辑值的对象 专属代表一个 值它包含某个函数或方法调用的成功 或错误信息 代表 数据类型 不带参数地调用此构造器将创建一个 指针 模块提供了其他许多 专属的数据类型例如 或 还定义了一些有用的结构体例如 或 结构化数据类型 本机字节序的联合所对应的抽象基类 大端 字节序的结构体所对应的抽象基类 小端 字节序的结构体所对应的抽象基类 非本机字节序的结构体不能包含指针类型字段或任何其他包含指针类型字段的数据类型 本机 字节序的结构体所对应的抽象基类 实际的结构体和联合类型必须通过子类化这些类型之一来创建并且至少要 定义一个 类变量 将创建 它允许通 过直接属性访问来读取和写入字段 这些是 一个定义结构体字段的序列 其中的条目必须为 元组或 元组 元 组的第一项是字段名称第二项指明字段类型它可以是任何 数 据类型 对于整数类型字段例如 可以给定第三个可选项 它必须是一 个定义字段比特位宽度的小正整数 字段名称在一个结构体或联合中必须唯一 不会检查这个唯一性但当 名称出现重复时将只有一个字段可被访问 可以在定义 子类的类语句 之后 再定义 类变 量这将允许创建直接或间接引用其自身的数据类型 但是 类变量必须在类型第一次被使用创建实例调用 等等之前进行定义 在此之后对 类变量赋值 将会引发 可以定义结构体类型的子类它们会继承基类的字段再加上在子类中定义 的任何 一个可选的小整数它允许覆盖实体中结构体字段的对齐方式 当 被赋值时必须已经定义了 否则它将没有效果 一个可选的序列它会列出未命名匿名字段的名称 当 被赋值时必须已经定义了 否则它将没有效果 在此变量中列出的字段必须为结构体或联合类型字段 将在结 构体类型中创建描述器以允许直接访问嵌套字段而无需创建对应的结构 体或联合字段 以下是一个示例类型 结构体描述了一个 数据类型 字段指明哪个联合 字段是有效的 由于 字段被定义为匿名字段现在可以直接从 实例访问成员 和 是等价的 但前者速度更快因为它不需要创建临时的联合实例 可以定义结构体的子类它们会继承基类的字段 如果子类定义具有单独的 变量在其中指定的字段会被添加到基类的字段中 结构体和联合的构造器均可接受位置和关键字参数 位置参数用于按照 中的出现顺序来初始化成员字段 构造器中的关键字参数会被 解读为属性赋值因此它们将以相应的名称来初始化 或为不存 在于 中的名称创建新的属性 数组与指针 数组的抽象基类 创建实际数组类型的推荐方式是通过将任意 类型与一个正整数相 乘 作为替代方式你也可以子类化这个类型并定义 和 类变量 数组元素可使用标准的抽取和切片方式来读写对于切 片读取结果对象本身 并非 一个 一个指明数组中元素数量的正整数 超出范围的抽取会导致 该值将由 返回 指明数组中每个元素的类型 子类构造器可接受位置参数用来按顺序初始化元素 私有对象指针的抽象基类 实际的指针类型是通过调用 并附带其将指向的类型来创建的 这会由 自动完成 如果一个指针指向的是数组则其元素可使用标准的抽取和切片方式来读写 指针对象没有长度因此 将引发 抽取负值将会 从指针 之前 的内存中读取与 一样并且超出范围的抽取将可能因 非法访问而导致崩溃视你的运气而定 指明所指向的类型 返回指针所指向的对象 对此属性赋值会使指针改为指向所赋值的对象 数组二分查找算法 搜索有序列表 上面的 函数对于找到插入点是有用的但在一般的搜索任务中可能会有点尴尬 下面 个函数展示了如何将其转变成有序列表中的标准查找函数 其他示例 主题部件 源代码 参见 一份文档介绍 支持的主题 使用 开始使用 导入模块 重写基础 控件导入应跟随 导入 参见 控件 中有 种部件 其中十二种已存在于 中 以及 另外六种是新增的 以及 它们全都是 的子类 代码 代码 有关 的更多信息请参阅 类文档 控件 定义了由 带主题部件所支持的标准选项和方法它们不应该被直接实例化 标准选项 所有 小部件接受以下选项 选项 描述 类 指定窗口类 在查询选项数据库中窗口的其他选项时使用该类确定 窗口 的默认绑定标签以及选择控件的默认布局和样式 此选项仅为 只读并且 只能在创建窗口时指定 光标 指定要用于控件的鼠标光标 如果设置为空字符串默认值则为父 控件 继承光标 确定窗口是否在键盘遍历期间接受焦点 返回 或 返回空字符串 如 果返 回 则表示在键盘遍历期间应该跳过该窗口 如果为 则表示 只要可以查 看窗口就应该接收输入焦点 并且空字符串意味着遍历脚 本决定是否关注窗 口 风格 可用于指定自定义控件样式 可滚动控件选项 控件支持以下选项使用滚动条控制 选项 描述 命令 用于与水平滚动条通讯 当视图在控件的窗口改变控件将会基 于 命令生成 命令 命令 用于与垂直滚动条通讯 更多信息请参考上面的信息 标签选项 以下选项支持标签按钮已及其他类按钮的控件 选项 描述 文本 文本变量 下划线 图片 只显示文本 只显示图片 分别显示图片的上下左右的文本 默认 如果设置显示图片 否则文本 宽度 兼容性选项 选项 描述 状况 控件状态 控件状态是无关状态标志的位图 标志 描述 活动 禁用 在程序控制下控件是禁用的 焦点 控件有键盘焦点 按压 选择 背景 只读 无效的 控件的值是无效的 组合框 选项 选项 描述 状况 文本变量 值 宽度 虚拟事件 选项 选项 描述 从 到 增加 值 格式 命令 虚拟事件 笔记本 选项 选项 描述 宽度 选项 选项 描述 状况 文本 图片 下划线 选项 选项 描述 模式 值 选项 选项 描述 选项 选项 描述 选项 描述 文本 图片 值 选项 描述 背景 图片 注释 描述 指明列宽度是否应该在部件大小被改变时进行相应的调整 以像素表示的列宽度 要配置树的列则调用此方法并附带参数 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 参见 图形用户界面 文本自动换行与填充 源代码 模块提供了一些快捷函数以及可以完成所有工作的类 如果你只是要对一两个文本字符串进行自动换行或填充快捷函数应该就够用了否则的话你应该使用 的实例来提高效率 对 字符串 中的单独段落自动换行以使每行长度最多为 个字符 返回由输出行组成的列表行尾不带换行符 可选的关键字参数对应于 的实例属性具体文档见下 默认为 请参阅 方法了解有关 行为的详细信息 对 中的单独段落自动换行并返回一个包含被自动换行段落的单独 字符串 是以下语句的快捷方式 特别要说明的是 接受与 完全相同的关键字参数 折叠并截短给定的 以符合给定的 首先将折叠 中的空格所有连续空格替换为单个空格 如果结果 能适合 则将其返回 否则将丢弃足够数量的末尾单词以使得剩余 单词加 能适合 可选的关键字参数对应于 的实际属性具体见下文 请注 意文本在被传入 的 函数之前会被折叠因此改变 和 的值将没有任何效果 新版功能 移除 中每一行的任何相同前缀空白符 这可以用来清除三重引号字符串行左侧空格而仍然在源码中显示为缩进格 式 请注意制表符和空格符都被视为是空白符但它们并不相等以下两行 和 不会被视为具有相同的前缀空白符 只包含空白符的行会在输入时被忽略并在输出时被标准化为单个换行符 例如 将 添加到 中选定行的开头 通过调用 来对行进行拆分 默认情况下 会被添加到所有不是只由空白符包括任何行结束符 组成的行 例如 可选的 参数可用来控制哪些行要缩进 例如可以很容易地 为空行或只有空白符的行添加 新版功能 和 的作用方式为创建一个 实例并在其上调用单个方法 该实例不会被重用因此对于要使用 和或 来处理许多文本字符串的应用来说创建你自己的 对象可能会更有效率 文本最好在空白符位置自动换行包括带连字符单词的连字符之后长单词仅在必要时会被拆分除非 被设为假值 构造器接受多个可选的关键字参数 每个关键字参数对应一 个实例属性比如说 就相当于 你可以多次重用相同的 对象并且你也可以在使用期间通过 直接向实例属性赋值来修改它的任何选项 的实例属性以及构造器的关键字参数如下所示 默认 自动换行的最大行长度 只要输入文本中没有长于 的单个单词 就能保证没有长于 个字 符的输出行 默认 如果为真值则 中所有的制表符将使用 的 方法扩展为空格符 默认 如果 为真值则 中所有的制表符 将扩展为零个或多个空格具体取决于当前列位置和给定的制表宽度 新版功能 如果为真值在制表符扩展之后 自动换行之前 方法将把每个空白字符都替换为单个空格 会被替换的空白字 符如下制表换行垂直制表进纸和回车 注解 如果 为假值且 为真值每个 制表符将被替换为单个空格这与制表符扩展是 不 一样的 注解 如果 为假值在一行的中间有可能出现换行符 并导致怪异的输出 因此文本应当使用 或 类似方法拆分为段落并分别进行自动换行 默认 如果为真值每一行开头和末尾的空白字符在包装之 后 缩进之前会被丢弃 但是段落开头的空白字符如果后面不带任何 非空白字符则不会被丢弃 如果被丢弃的空白字符占据了一个整行则 该整行将被丢弃 默认 将被添加到被自动换行输出内容的第一行的字符串 其长 度会被计入第一行的长度 空字符串不会被缩进 将被添加到被自动换行输出内容除第一行外的所有行的 字符串 其长度会被计入除行一行外的所有行的长度 默认 如果为真值 将尝试检测句子结尾并确 保句子间总是以恰好两个空格符分隔 对于使用等宽字体的文本来说通 常都需要这样 但是句子检测算法并不完美它假定句子结尾是一个 小写字母加字符 或 中的一个并可能带有字符 或 最后以一个空格结束 此算法的问题之一是它无法区 分以下文本中的 和以下文本中的 默认为假值 由于句子检测算法依赖于 来确定小写字母以及 约定在句点后使用两个空格来分隔处于同一行的句子因此只适用于英语 文本 默认 如果为真值则长度超过 的单词将被分开以保 证行的长度不会超过 如果为假值超长单词不会被分开因 而某些行的长度可能会超过 超长单词将被单独作为一行 以尽量减少超出 的情况 默认 如果为真值将根据英语的惯例首选在空白符和复合词 的连字符之后自动换行 如果为假值则只有空白符会被视为合适的潜 在断行位置但如果你确实不希望出现分开的单词则你必须将 设为假值 之前版本的默认行为总是允许分开带有 连字符的单词 默认 如果不为 则输出内容将最多包含 行并使 出现在输出内容的末尾 新版功能 默认 该文本将在输出文本被截短时出现在文本末尾 新版功能 还提供了一些公有方法类似于模块层级的便捷函数 对 字符串 中的单独段落自动换行以使每行长度最多为 个字符 所有自动换行选项均获取自 实例的实 例属性 返回由输出行组成的列表行尾不带换行符 如果自动换行输 出结果没有任何内容则返回空列表 对 中的单独段落自动换行并返回包含被自动换行段落的单独字符 串 包扩展工具 源代码 该模块为导入系统提供了工具尤其是在包支持方面 一个包含模块信息的简短摘要的命名元组 新版功能 版后已移除 版后已移除 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 在 版更改 注解 在 版更改 例如 注解 在 版更改 从包中获取一个资源 新版功能 分发 模块 电子邮箱 作为一个流行的开源开发项目 拥有一个活跃的贡献者和用户支持社区这些社区也可以让他们的软件可供其他 开发人员在开源许可条款下使用 这允许 用户有效地共享和协作从其他人已经创建的解决方案中受益于常见有时甚至是罕见的问题以及可以提供他们自己的解决方案 本指南涵盖了分发部分的流程 有关安装其他 项目的指南请参阅 安装指南 注解 对于企业和其他机构用户请注意许多组织都有自己的政策来使用和贡献开源 软件 在使用 提供的分发和安装工具时请考虑这些政策 关键术语 开源许可与协作 在世界上大多数地方软件自动受版权保护 这意味着其他开发人员需要明确的权限来复制使用修改和重新分发软件 开源许可是一种以相对一致的方式明确授予此类权限的方式允许开发人员通过为各种问题免费提供通用解决方案来有效地共享和协作 这使得许多开发人员可以将更多时间用于关注他们特定情况相对独特的问题 提供的分发工具旨在使开发人员选择开源时可以合理地直接将其自己的贡献回馈到该公共软件池 无论该软件是否作为开源软件发布相同的分发工具也可用于在组织内分发软件 安装工具 标准库不包括支持现代 打包标准的构建工具因为核心开发团队已经发现即使在旧版本的 上使用一致工作的标准工具也很重要 可以通过在命令行调用 模块来安装当前推荐的构建和分发工具 注解 对于 用户包括 和 用户这些说明假定使用 对于 用户这些说明假定在安装 时选择了调整 系统 环境变量的选项 打包用户指南包含有关 的更多详细信息 阅读 包用户指南 包装用户指南介绍了创建和发布项目所涉及的各个关键步骤和元素 项目的结构 项目的构建与打包 上传项目到 我该如何 这是一些常见任务的快速解答或相关链接 为我的项目选择一个名字 这不是一个简单的主题但这里有一些提示 检查 以查看该名称是否已被使用 检查流行的托管网站如 等等看是否已有一个该名称的 项目 检查您正在考虑的名称在网络搜索中出现的内容 避免使用特别常见的单词尤其是具有多重含义的单词因为它们会使用户在 搜索时难以找到您的软件 创建和分发二进制扩展 这实际上是一个非常复杂的主题根据您的目标可以提供各种替代方案 有关更多信息和建议请参阅 打包指南 参见 封装使用指南二进制扩展 安装 模块 电子邮箱 作为一个流行的开源开发项目 拥有一个活跃的贡献者和用户支持社区这些社区也可以让他们的软件可供其他 开发人员在开源许可条款下使用 这允许 用户有效地共享和协作从其他人已经创建的解决方案中受益于常见有时甚至是罕见的问题以及可以提供他们自己的解决方案 本指南涵盖了分发部分的流程 有关安装其他 项目的指南请参阅 安装指南 注解 对于企业和其他机构用户请注意许多组织都有自己的政策来使用和贡献开源 软件 在使用 提供的分发和安装工具时请考虑这些政策 关键术语 是首选的安装程序 从 开始它默认包含在 二进制安 装程序中 是一种半隔离的 环境允许为特定的应用安 装各自的包而不是安装到整个系统 是创建虚拟环境的标准工具从 开始成为 的组 成部分 从 开始它会默认安装 到所创建的全部虚拟环 境 是 的第三方替代及其前身 它允许在 之前的版本中使用虚拟环境那些版本或是完全不提供 或是不 会自动安装 到所创建的虚拟环境 是一个由 用户向其他用户发布开源许可软 件包的公共仓库 是负责标准打包工具以及相关元数据和文件格 式标准维护与改进的开发人员和文档作者团队 他们基于 和 这两个平台维护着各种工具 文档和问题追踪系统 是最初的构建和分发系统于 年首次加入 标准库 虽然直接使用 的方式已被淘汰它仍然是当前打包和分发架 构的基础而且它不仅仍然是标准库的一部分这个名称还以其他方式存在 例如用于协调 打包标准开发流程的邮件列表就以此命名 在 版更改 现在推荐使用 来创建虚拟环境 参见 软件包用户指南创建和使用虚拟环境 基本使用 标准打包工具完全是针对命令行使用方式来设计的 以下命令将从 安装一个模块的最新版本及其依赖项 注解 对于 用户包括 和 用户本指南中的示例假定使用 了 对于 用户本指南中的示例假定在安 装 时选择了修改系统 环境变量 在命令行中指定一个准确或最小版本也是可以的 当使用比较运算符例如 或其他某些可以被终端所解析的特殊字符时包名称与版本号应当用双引号括起来 通常如果一个匹配的模块已安装尝试再次安装将不会有任何效果 要升级现有模块必须显式地发出请求 更多有关 及其功能的信息和资源可以在 软件包用户指南 中找到 虚拟环境的创建可使用 模块来完成 向已激活虚拟环境安装软件包可使用上文所介绍的命令 参见 软件包用户指南安装 分发包 我应如何 这是一些常见任务的快速解答或相关链接 在 之前的 版本中安装 捆绑 是从 才开始的 对于更早的版本 需要引导安装 具体说明参见 软件包用户指南 参见 软件包用户指南安装软件包的前提要求 只为当前用户安装软件包 将 选项传入 将只为当前用户而非为系统中的所有用户安装软件包 安装科学计算类 软件包 许多科学计算类 软件包都有复杂的二进制编译文件依赖直接使用 安装目前并不太容易 在当前情况下通过 其他方式 而非尝试用 安装这些软件包对用户来说通常会更容易 参见 软件包用户指南安装科学计算类软件包 使用并行安装的多个 版本 在 以及其他 系统中使用带版本号的 命令配合 开关选项来运行特定版本的 也可以使用带特定版本号的 命令 在 中使用 启动器命令配合 开关选项 常见的安装问题 在 的系统 版本上安装 系统通常会将某个 版本作为发行版的一部分包含在内 将软件包安装到这个 版本上需要系统 权限并可能会干扰到系统包管理器和其他系统组件的运作如果这些组件在使用 时被意外升级的话 在这样的系统上通过 安装软件包通常最好是使用虚拟环境或分用户安装 未安装 安装二进制编译扩展 通常非常依赖基于源代码的发布方式也就是期望最终用户在安装过程中使用源码来编译生成扩展模块 随着对二进制码 格式支持的引入以及通过 至少发布 和 版的 文件预计此问题将逐步得到解决因为用户将能够更频繁地安装预编译扩展而不再需要自己编译它们 某些用来安装 科学计算类软件包 的解决方案对于尚未提供预编译 文件的那些扩展模块来说也有助于用户在无需进行本机编译的情况下获取二进制码扩展模块 参见 软件包用户指南二进制码扩展 命令行与环境 解析器会扫描命令行与环境用于获取各种设置信息 其他实现的命令行方案可能有所不同 更多相关资源请参阅 其他实现 命令行 对 发起调用时你可以指定以下的任意选项 当然最常见的用例就是简单地启动执行一个脚本 接口选项 通用选项 打印全部命令行选项的简短描述 打印 版本号并退出 示例输出信息如下 如果重复给出则打印有关构建的更多信息例如 新版功能 选项 其他选项 不应当使用的选项 保留给 使用 环境变量 调试模式变量 设置这些变量只会在 的调试版本中产生影响 如果设置 将打印线程调试信息 需要使用 构建选项配置 如果设置 在关闭解释器及转储对象和引用计数后仍将保持活动 需要使用 构建选项配置 在 上使用 本文档旨在概述在 上使用 时应了解的特定于 的行为 与大多数 系统和服务不同 系统没有预安装 多年来 团队已经编译了每一个 发行版 的 安装程序 包已便 用户下载和安装 这些安装程序主要用于每个用户单独安装 时添加核心解释器和库 安装程序还可以为一台机器的所有用户安装并且可以为应用程序本地分发提供单独的 文件 如 中所述 仅支持微软产品支持生命周期内的 版本 这意味着 支持 和更新版本 如果需要 支持请安装 提供了许多不同的安装程序每个安装程序都有一定的优点和缺点 完整安装程序 内含所有组件对于使用 进行任何类型项目的开发人员而言它是最佳选择 包 是一个简单的 安装适用于运行脚本和包以及使用 或其他开发环境 它需要 但可以安全地安装而不会破坏其他程序 它还提供了许多方便的命令来启动 及其工具 安装包 是用于持续集成系统的轻量级安装 它可用于构建 包或运行脚本但不可更新且没有用户界面工具 可嵌入的包 是 的最小安装包适合嵌入到更大的应用程序中 完整安装程序 安装步骤 四个 安装程序可供下载 位和 位版本的各有两个 网络安装包是一个小的初始化工具它将在安装过程中根据需要自动下载所需的组件 离线安装包内含默认安装所需的组件可选择功能仍需要 连接下载 请参阅 免下载安装 以了解在安装过程中避免下载的其他方法 启动安装程序后可以选择以下两个选项之一图片如果选择 立即安装 您 不 需要成为管理员除非需要对 运行库进行系统更新或者为所有用 户安装 适用于 的 启动器 将安装到您的用户目录中 适用于 的 启动器 将根据第一页底部的选项安装 将安装标准库测试套件启动器和 如果选择将安装目录将添加到 快捷方式仅对当前用户可见选择自定义安装将允许您选择要安装的功能 安装位置 其他选项或安装后的操作 如果要安装调试符号或二进制文件您需要使用此选项 如要为全部用户安装应选择自定义安装 在这种情况下 您可能需要提供管理凭据或批准 将安装到 目录中 适用于 的 启动器 将安装到 目录中 安装期间可以选择可选功能 标准库可以预编译为字节码 如果选中安装目录将添加到系统 快捷方式所有用户可用 删除 限制 历史上 的路径长度限制为 个字符 这意味着长于此的路径将无法解决并导致错误 在最新版本的 中此限制可被扩展到大约 个字符 但需要让管理员激活启用 长路径组策略或在注册表键 中设置 为 这允许 函数 模块和大多数其他路径功能接受并返回长度超过 个字符的路径 更改上述选项后无需进一步配置 在 版更改 中启用了对长路径的支持 无 安装 免下载安装 由于下载的初始安装包中未包含 的某些可选功能如果选择安装这些功能可能需要 连接 为了避免这种需要可以按需下载所有可能的组件以创建一个完整的布局该布局将不再需要 连接而不管所选择的特性是什么 请注意此下载可能比要求的要大但是如果要执行大量安装则拥有本地缓存 的副本非常有用 从命令提示符执行以下命令以下载所有可能的必需文件 请记得要将 替换为安装程序的实际名称并在单独的目录中创建子目录以避免同名文件间的冲突 您也可以指定 选项来隐藏进度显示 修改安装 包 新版功能 包是一个易于安装的 解释器主要用于交互式使用例如学生 要安装软件包请确保您拥有最新的 更新并在 应用程序中搜索 确保您选择的应用程序由 发布并安装 警告 将始终在 上免费提供 如果要求您付款则表示您没 有选择正确的包 安装完成后可以在开始菜单中找到它来启动 或者可以在命令提示符或 会话中输入 来启动 此外可以输入 或 来使用 和 也在开始菜单中 所有这三个命令也可以使用版本号后缀例如 和 以及 其中 是您要启动的特定版本例如 在 设置主页应用和功能 页面中点选 管理可选功能选择与每个命令关联的 版本 建议确保 和 与选择的 版本一致 可以使用 创建虚拟环境并激活并正常使用 如果你已经安装了另一个版本的 并将它添加到你的 变量中那么它将作为 而不是来自 的那个 要访问新安装请使用 或 启动器将检测此 安装版但会优先使用来自传统安装器的安装版 要删除 请打开设置并使用应用程序和功能或者在开始中找到 然后右键单击以选择卸载 卸载将删除该已安装 程序中的所有软件包但不会删除任何虚拟环境 已知的问题 由于 应用程序的限制 脚本可能无法对共享位置如 和注册表进行完全写入访问 相反它将写入私人副本 如果脚本必须修改共享位置则需要安装完整安装程序 安装包 新版功能 是一个精简的 环境用于在没有全局安装 的系统的持续集成和构建 虽然 是 的包管理器但是对于包含构建时工具的包来说它也可以很好地工作 访问 获取有关使用 的最新信息 下面的摘要对 开发人员来说已经足够了 命令行工具可以直接从 下载例如使用 或 使用该工具安装 位或 位最新版本的 要选择特定版本请添加 输出目录可以从 更改包将安装到子目录中 默认情况下子目录的名称与包的名称相同如果没有 选项则此名称将包含已安装的特定版本 子目录里面是一个包含 安装的 目录 通常 包不可升级应该平行安装较新版本并使用完整路径引用 或者手动删除程序包目录并再次安装 如果在构建之间不保留文件许多 系统将自动执行此操作 除了 目录外还有一个 目录 它包含一个 属性文件 可以在 项目中使用该文件来引用 安装 包含这些设置将自动在生成中使用标头和导入库 上的包信息页是 对于 位版本和 表示 位版本 可嵌入的包 应用程序 嵌入 用本地代码编写的应用程序通常需要某种形式的脚本语言嵌入式 发行版可以用于此目的 通常应用程序的大部分都是本机代码某些部分将调用 或直接使用 无论是哪种情况将嵌入的发行版解压缩到应用程序安装的子目录中就足以提供可加载的 解释器 与应用程序使用一样包可以安装到任何位置因为在初始化解释器之前有机会指定搜索路径 否则使用嵌入式发行版和常规安装之间没有根本区别 替代捆绑包 除了标准的 发行版之外还有一些包含附加功能的修改包 以下是热门版本及其主要功能的列表 具有多平台兼容性的安装程序文档 流行的科学模块如 和 和 包管理器 具有编辑器和其他开发工具的全面的 分析环境 特定于 的发行版包含用于构建包的预构建科学包和工具 请注意这些软件包可能不包含最新版本的 或其他库并且不由核心 团队维护或支持 配置 要从命令提示符方便地运行 您可以考虑在 中更改一些默认环境变量 虽然安装程序提供了为您配置 和 变量的选项但这仅适用于单版本 全局安装 如果您经常使用多个版本的 请考虑使用 适用于 的 启动器 附录设置环境变量 查找 可执行文件 在 版更改 除了使用自动创建的 解释器的开始菜单项之外您可能还想在命令提示符下启动 安装程序有一个选项可以为您设置 在安装程序的第一页上可以选择标记为将 添加到环境变量的选项以使安装程序将安装位置添加到 还添加了 文件夹的位置 这允许你输入 来运行解释器并且 用于包安装程序 因此您还可以使用命令行选项执行脚本请参阅 命令行 文档 如果在安装时未启用此选项则始终可以重新运行安装程序选择修改并启用它 或者您可以使用 附录设置环境变量 的方法手动修改 您需要将 安装目录添加到 环境变量中该内容与其他条目用分号分隔 示例变量可能如下所示假设前两个条目已经存在 模式 适用于 的 启动器 新版功能 用于 的 启动器是一个实用程序可帮助定位和执行不同的 版本 它允许脚本或命令行指示特定 版本的首选项并将定位并执行该版本 与 变量不同启动器将正确选择最合适的 版本 它更倾向于按用户安装而不是系统安装并按语言版本排序而不是使用最新安装的版本 启动器最初是在 中指定的 入门 的参数 还可以指定要传递给 解释器的其他选项 例如如果你有一个 然后 将以 选项启动 自定义 诊断 查找模块 附加模块 尽管 的目标是在所有平台中都可移植但是 有一些独特的特性 在标准库和外部都有一些模块和代码片段在使用这些特性 特定于 的标准模块记录在 系统相关模块 中 的 模块是一组用于高级 特定支持的模块 这包括以下实用程序 组件对象模型 调用 注册 事件日志 用户界面 是 附带的一个示例 应用程序 它是一个内置调试器的可嵌入 参见 著 和 著 是一个 的扩展参见 扩展 它将 脚本包装成可执行的 程序 文件 完成此操作后您可以分发应用程序而无需用户安装 由于 的高级终端处理层 仅限于类 系统因此 还有一个独立的库用于 的 控制台 是 的 装饰器用于创建文本用户界面 在 上编译 其他平台 随着 的不断发展不再支持以前曾经支持的一些平台由于缺少用户或开发人员 检查 了解所有不支持的平台的详细信息 仍然受支持 安装包也提供安装 解释器 有关具有预编译安装程序平台的详细信息请参阅 编辑器和集成开发环境 有很多支持 编程语言的集成开发环境 大多数编辑器和集成开发环境支持语法高亮调试工具和 检查 请访问 和 以获取完整列表 安装和使用 这一部分文档专门介绍在不同平台上配置 环境的一般方法解释器的调用以及方便使用 的技巧 命令行与环境 命令行 接口选项 通用选项 其他选项 不应当使用的选项 环境变量 调试模式变量 在 平台中使用 获取最新版本的 在 中 在 和 上 在 系统上 构建 与 相关的路径和文件 杂项 在 上使用 完整安装程序 安装步骤 删除 限制 无 安装 免下载安装 修改安装 包 已知的问题 安装包 可嵌入的包 应用程序 嵌入 替代捆绑包 配置 附录设置环境变量 查找 可执行文件 模式 适用于 的 启动器 入门 从命令行 从虚拟环境 从脚本 从文件关联 的参数 自定义 通过 文件自定义 自定义默认的 版本 诊断 查找模块 附加模块 在 上编译 其他平台 在苹果系统上使用 获取和安装 如何运行 脚本 运行有图形界面的脚本 配置 安装额外的 包 上的图形界面编程 在 上分发 应用程序 其他资源 编辑器和集成开发环境 在 平台中使用 获取最新版本的 在 中 预装在大多数 发行版上并作为一个包提供给所有其他用户 但是您可能想要使用的某些功能在发行版提供的软件包中不可用 这时您可以从源代码轻松编译最新版本的 如果 没有预先安装并且不在发行版提供的库中您可以轻松地为自己使用的发行版创建包 参阅以下链接参见 对于 用户 对于 用户 对于 用户 对于 用户 在 和 上 用户使用以下命令添加包 用户使用以下命令添加包 例如 用户获取 的可用版本 在 系统上 构建 如果你想自己编译 首先要做的是获取 您可以下载最新版本的源代码也可以直接提取最新的 如果你想要制作补丁则需要克隆代码 构建过程由常用命令组成 特定 平台的配置选项和注意事项通常记录在 源代码的根目录下的 文件中 警告 可以覆盖或伪装 二进制文件 因此建议使用 而不是 因为后者只安装了 与 相关的路径和文件 杂项 在苹果系统上使用 作者 运行 的 上 的 原则上与任何其他 平台上的 非常相似但是还有一些额外的功能例如 和包管理器值得一提 获取和安装 附带 预安装的 如果你愿意可以从 网站 安装最新版本的 的当前通用二进制版本可以在 的新 和传统 上本地运行 你安装后得到的东西有 会有一个 文件夹在你的 文件夹中 在这里 你可以找到 它是作为官方 发行版标准组成部分的开发环境 以及 它负责处理在 中双击 脚本的操作 框架 包括 可执行文件 和库 安装程序将此位置添加到 路径 要卸载 你可以 简单地移除这三个项目 可执行文件的符号链接放在 中 提供的 版本分别安装在 和 中 你永远不应修改或删除这些内容因为它们由 控制并由 或第三方软件使用 请记住如果你选择从 安装较新的 版本那么你的计算机上将安装两个不同但都有用的 因此你的路径和用法与你想要执行的操作一致非常重要 包含一个帮助菜单允许你访问 文档 如果您是 的新手你应该开始阅读该文档中的教程介绍 如果你熟悉其他 平台上的 那么你应该阅读有关从 运行 脚本的部分 如何运行 脚本 在 上开始使用 的最佳方法是通过 集成开发环境参见 部分并在 运行时使用帮助菜单 如果要从终端窗口命令行或 运行 脚本首先需要一个编辑器来创建脚本 附带了许多标准的 命令行编辑器如 和 如果你想要一个更 化的编辑器那么 或来自 的 参见 是不错的选择 就如 参见 其他编辑器包括 和 要从终端窗口运行脚本必须确保 位于 搜索路径中 要从 运行你的脚本你有两个选择 把脚本拖拽到 选择 作为通过 窗口打开脚本或任何 脚本的默认应用程序然后双击脚本 有各种首 选项来控制脚本的启动方式 拖拽方式允许你为一次调用更改这些选项或 使用其首选项菜单全局更改内容 运行有图形界面的脚本 对于旧版本的 你需要注意一个 的怪异之处与 窗口管理器通信的程序换而言之任何具有图形界面的程序需要以特殊方式运行 使用 而不是 来启动这样的脚本 对于 你可以使用 或者 配置 上的 遵循所有标准的 环境变量例如 但是为 启动的程序设置这些变量是非标准的因为 在启动时不读取你的 或 你需要创建一个文件 有关详细信息请参阅 的技术文档 更多关于在 中安装 包的信息参阅 安装额外的 包部分 附带标准的 开发环境 有关使用 的详细介绍请访问 安装额外的 包 有几个方法可以安装额外的 包 可以通过标准的 模式 安装软件包 许多包也可以通过 扩展或 包装器安装请参阅 上的图形界面编程 使用 在 上构建 应用程序有多种选择 是一个 到 的 框架的绑定这是大多数现代 开发的基础 有关 的信息请访问 标准的 工具包是 基于跨平台的 工具包 的 捆绑了 原生版本的 最新版本可以从 下载和安装它也可以从源代码构建 是另一种流行的跨平台 工具包可在 上本机运行 软件包和文档可从 获得 是另一种流行的跨平台 工具包可在 上本机运行 更多信息可在 上找到 在 上分发 应用程序 在 上部署独立 应用程序的标准工具是 有关安装和使用 的更多信息请访问 其他资源 邮件列表是 上 用户和开发人员的优秀支持资源 另一个有用的资源是 安装 模块旧版 作者 参见 安装 模块 最新的模块安装文档 对于常规 使用你几乎肯定像使用该文档而 非这个 注解 这篇文档只有在 上的 文档独立涵盖此处包含的所有相关信息之前才会单独保留 注解 本指南仅介绍构建和分发扩展的基本工具这些扩展是作为此 版本的一 部分提供的 第三方工具提供更易于使用和更安全的替代方案 有关详细信 息请参阅 打包用户指南中的 快速推荐部分 概述 在 中 首次被添加到标准库中 这向 发行版维护者提供了一个将 项目转换为发行版软件包的标准方法以及向系统管理员们提供了直接将这些软件包安装到目标系统的标准方法 安装 模块 分发 模块 平台 标准安装位置 默认值 注释 单一 类 注释 自定义安装 文件类型 安装目录 模块 脚本 数据 头文件 以下是 上使用的值 文件类型 安装目录 模块 脚本 数据 头文件 文件类型 安装目录 模块 脚本 数据 头文件 文件类型 安装目录 模块 扩展模块 脚本 数据 头文件 文件类型 安装目录 模块 脚本 数据 头文件 自定义安装 文件类型 覆盖选项 模块 扩展模块 所有模块 脚本 数据 头文件 或者等价于 或者等价于 注解 文件类型 位置和文件名 注释 文件类型 位置和文件名 注释 注释 参见 参见 脚注 欲了解更多信息请查阅 和 描述符对象 描述符是描述对象的某些属性的对象 它们存在于类型对象的字典中 内建描述符类型的类型对象 如果描述符对象 描述数据属性则返回 如果描述方法则返 回 必须是描述符对象没有错误检查 呼叫协议 支持两种不同的调用协议 和矢量调用 协议 设置 的类的实例都是可调用的 槽位的签名为 新版功能 警告 注解 递归控制 新版功能 新版功能 新版功能 函数 个对象 元组 对象 可变参数 对象 名称 可变参数 对象 名称 对象 名称 个对象 参数 名称 成功时返回结果在失败时抛出一个异常并返回 成功时返回结果在失败时抛出一个异常并返回 新版功能 成功时返回结果在失败时抛出一个异常并返回 新版功能 成功时返回结果在失败时抛出一个异常并返回 这等价于 表达式 成功时返回结果在失败时抛出一个异常并返回 这等价于 表达式 在 版更改 成功时返回结果在失败时抛出一个异常并返回 在 版更改 成功时返回结果在失败时抛出一个异常并返回 这和 表达式 是一样的 成功时返回结果在失败时抛出一个异常并返回 成功时返回结果在失败时抛出一个异常并返回 新版功能 成功时返回结果在失败时抛出一个异常并返回 新版功能 成功时返回结果在失败时抛出一个异常并返回 新版功能 新版功能 成功时返回结果在失败时抛出一个异常并返回 新版功能 集合对象 这一章节详细介绍了 和 对象的公共 任何未在下面列出的功能最好是使用抽象对象协议 包括 以及 或者抽象数字协议 包括 以及 来访问 这个 的子类型被用来保存 和 对象的内部 数据 它类似于 因为对于小尺寸集合来说它是固定大小 的很像元组的存储方式并且对于中等和大尺寸集合来说它将指向单独 的可变大小的内存块很像列表的存储方式 此结构体的字段不应被视为 公有并且可能发生改变 所有访问应当通过已写入文档的 来进行而 不可通过操纵结构体中的值 这是一个 实例表示 类型 这是一个 实例表示 类型 下列类型检查宏适用于指向任意 对象的指针 类似地这些构造函数也适用于任意可迭代的 对象 如果 是一个 对象或者是其子类型的实例则返回真值 如果 是一个 对象或者是其子类型的实例则返回真值 如果 是一个 对象 对象或者是其子类型的实例则 返回真值 如果 是一个 对象或 对象但不是其子类型的实例则 返回真值 如果 是一个 对象但不是其子类型的实例则返回真值 返回一个新的 其中包含 所返回的对象 可以为 表示创建一个新的空集合 成功时返回新的集合失败时返 回 如果 实际上不是可迭代对象则引发 该构造器也适用于拷贝集合 返回一个新的 其中包含 所返回的对象 可以为 表示创建一个新的空冻结集合 成功时返回新 的冻结集合失败时返回 如果 实际上不是可迭代对 象则引发 下列函数和宏适用于 或 的实例或是其子类型的实例 返回 或 对象的长度 等价于 如果 不是 或其子类型的实例则会引发 宏版本的 不带错误检测 如果找到返回 如果未找到返回 如果遇到错误则返回 不 同于 方法此函数不会自动将不可哈希的集合转 换为临时的冻结集合 如果 为不可哈希对象则会引发 如果 不是 或其子类型的实例则会引发 添加 到一个 实例 也可用于 实例类似于 它可被用来为全新冻结集合在公开给其他代码之前填 充全新的值 成功时返回 失败时返回 如果 为不可 哈希对象则会引发 如果没有增长空间则会引发 如果 不是 或其子类型的实例则会引发 下列函数适用于 或其子类型的实例但不可用于 或其子类型的实例 如果找到并移除返回 如果未找到无操作返回 如果遇到错误 则返回 对于不存在的键不会引发 如果 为不可 哈希对象则会引发 不同于 方法此函 数不会自动将不可哈希的集合转换为临时的冻结集合 如果 不是 或其子类型的实例则会引发 返回 中任意对象的新引用并从 中移除该对象 失败时返回 如果集合为空则会引发 如果 不是 或 其子类型的实例则会引发 清空现有字典的所有键值对 弱引用对象 支持 弱引用 作为一类对象 具体来说有两种直接实现弱引用的对象 第一种就是简单的引用对象第二种尽可能地作用为一个原对象的代理 如果 是一个引用或者一个代理对象则返回一个 如果 是一个引用则返回 如果 是一个代理对象则返回 返回对象 的一个弱引用对象 该函数总是会返回一个新的引用但不 保证创建一个新的对象它有可能返回一个现有的引用对象 第二个形参 为一个可调用对象它会在 被作为垃圾回收时接收通知 它应该接受一个单独形参即弱引用对象本身 也可以为 或 如果 不是一个弱引用对象或者如果 不是可调用对象 或 该函数将返回 并 且引发 返回对象 的一个弱引用代理对象 该函数将总是返回一个新的引用 但不保证创建一个新的对象它有可能返回一个现有的代理对象 第二个形 参 为一个可调用对象它会在 被作为垃圾回收时接收通 知它应该接受一个单独形参即弱引用对象本身 也可以为 或 如果 不是一个弱引用对象或者如果 不是可调用对象 或 该函数将返回 并 且引发 返回弱引用对象 的被引用对象 如果被引用对象不再存在则返回 注解 该函数返回被引用对象的一个借来的引用 这意味着除非你很清楚在 你使用期间这个对象不可能被销毁否则你应该始终对该对象调用 类似 但实现为一个不做类型检查的宏 旧缓冲协议 版后已移除 这些函数是 中旧缓冲协议 的组成部分 在 中此协议已不复存在但这些函数仍然被公开以便移植 的代码 它们被用作新缓冲协议 的兼容性包装器但它们并不会在缓冲被导出时向你提供对所获资源的生命周期控制 因此推荐你调用 或者配合 函数族使用 或 格式码 来获取一个对象的缓冲视图并在缓冲视图可被释放时调用 返回一个指向可用作基于字符的输入的只读内存地址的指针 参数必 须支持单段字符缓冲接口 成功时返回 将 设为内存地址并 将 设为缓冲区长度 出错时返回 并设置一个 返回一个指向包含任意数据的只读内存地址的指针 参数必须支持单 段可读缓冲接口 成功时返回 将 设为内存地址并将 设为缓冲区长度 出错时返回 并设置一个 如果 支持单段可读缓冲接口则返回 否则返回 此函数总是 会成功执行 请注意此函数会尝试获取并释放一个缓冲区并且在调用对应函数期间发生 的异常会被屏蔽 要获取错误报告则应改用 返回一个指向可写内存地址的指针 必须支持单段字符缓冲接口 成功时返回 将 设为内存地址并将 设为缓冲 区长度 出错时返回 并设置一个 模块对象 新版功能 在 版更改 新版功能 新版功能 版后已移除 构建 扩展 在 版更改 在 版更改 在 版更改 在 版更改 注解 新版功能 新版功能 新版功能 注解 新版功能 新版功能 新版功能 新版功能 注解 新版功能 新版功能 新版功能 浮点数对象 这个 类型 的子类型代表一个 浮点数对象 这是个属于 类型 的代表 浮点类型的实例 在 层面的类型 是同一个对象 当他的参数是一个 类型 或者是 类型 的子类型时返回真 当他的参数是一个 类型 但不是 类型 的子类型时返回真 根据字符串 的值创建一个 失败时返回 根据 创建一个 对象失败时返回 返回一个 代表 的内容 如果 不是一个 浮点数对象但是具有 方法此方法将首先被调用 将 转换成一个数点数 如果 未定义则将回退至 如果失败此方法将返回 因此开发者应当调用 来检查错误 在 版更改 如果可用将使用 返回一个 内容的 表示但没有错误检查 返回一个 实例其中包含有关 的精度 最小值和最大值 的信息 它是头文件 的一个简单包装 返回最大可表示的有限浮点数 为 返回最小可表示归一化正浮点数 为 映射协议 参见 与 如果对象提供映射协议或支持切片则返回 否则返回 请注意它将 为具有 方法的 类返回 因为在一般情况下无 法确定它所支持的键类型 此函数总是会成功执行 成功时返回对象 中键的数量失败时返回 这相当于 表 达式 返回 中对应于字符串 的元素或者失败时返回 这相 当于 表达式 另请参见 在对象 中将字符串 映射到值 失败时返回 这相当 于 语句 另请参见 此函 数 不会 增加对 的引用 从对象 中移除对象 的映射 失败时返回 这相当于 语句 这是 的一个别名 从对象 中移除字符串 的映射 失败时返回 这相当于 语句 如果映射对象具有键 则返回 否则返回 这相当于 表达式 此函数总是会成功执行 请注意在调用 方法期间发生的异常将会被屏蔽 要获取 错误报告请改用 如果映射对象具有键 则返回 否则返回 这相当于 表达式 此函数总是会成功执行 请注意在调用 方法期间发生的异常将会被屏蔽 要获取 错误报告请改用 成功时返回对象 中的键的列表 失败时返回 在 版更改 在之前版本中此函数返回一个列表或元组 成功时返回对象 中的值的列表 失败时返回 在 版更改 在之前版本中此函数返回一个列表或元组 成功时返回对象 中条目的列表其中每个条目是一个包含键值对的元 组 失败时返回 在 版更改 在之前版本中此函数返回一个列表或元组 元组对象 操作系统实用程序 新版功能 警告 新版功能 警告 新版功能 警告 新版功能 参见 版后已移除 参见 新版功能 在 版更改 在 版更改 参见 新版功能 在 版更改 在 版更改 编解码器注册与支持功能 注册一个新的编解码器搜索函数 作为副作用其尝试加载 包如果尚未完成请确保它始终位 于搜索函数列表的第一位 根据注册的给定 的编解码器是否已存在而返回 或 此 函数总能成功 泛型编解码器基本编码 使用由 所定义的错误处理方法传递给定 的 编码器函数 可以为 表示使用为编码器所定义的默认方 法 如果找不到编码器则会引发 泛型编解码器基本解码 使用由 所定义的错误处理方法传递给定 的 解码器函数 可以为 表示使用为编解码器所定义的默认 方法 如果找不到编解码器则会引发 查找 在下列函数中 字符串会被查找并转换为小写字母形式这使得通过此机制查找编码格式实际上对大小写不敏感 如果未找到任何编解码器则将设置 并返回 为给定的 获取一个编码器函数 为给定的 获取一个解码器函数 为给定的 获取一个 对象 为给定的 获取一个 对象 为给定的 获取一个 工厂函数 为给定的 获取一个 工厂函数 用于 编码错误处理程序的注册表 对象和编码解码器 对象 自从 中实现了 以来 对象在内部使用各种表示形式以便在保持内存效率的同时处理完整范围的 字符 对于所有代码点都低于 或 的字符串有一些特殊情况否则代码点必须低于 这是完整的 范围 注解 类型 新版功能 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 在 版更改 标识符和关键字 在 版更改 字符属性 版后已移除 版后已移除 版后已移除 新版功能 新版功能 格式字符 类型 注释 不适用 文字字符 整型 单个字符表示为 语言的整型 整型 相当于 无符号整型 相当于 长整型 相当于 长整型 相当于 无符号长整型 相当于 相当于 相当于 无符号 相当于 相当于 相当于 相当于 整型 相当于 整型 相当于 以 为终止符的 字符数组 一个 指针的十六进制表示形式 基 本等价于 但它会确 保以字面值 开头不论系统平台 上 的输出是什么 调用的结果 注解 在 版更改 在 版更改 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 参见 新版功能 在 版更改 新版功能 参见 新版功能 在 版更改 新版功能 在 版更改 接受一个 类路径对象 新版功能 在 版更改 接受一个 类路径对象 参见 在 版更改 在 版更改 参见 新版功能 在 版更改 新版功能 在 版更改 新版功能 在 版更改 新版功能 在 版更改 新版功能 新版功能 在 版更改 代码对象 代码对象是 实现的低级细节 每个代表一块尚未绑定到函数中的可执行代码 用于描述代码对象的对象的 结构 此类型字段可随时更改 这是一个 实例其表示 的 类型 如果 是一个 对象则返回 返回 中的自由变量数 返回一个新的代码对象 如果你需要一个虚拟代码对象来创建一个代码帧 请使用 调用 直接可以绑定到准确 的 版本因为字节码的定义经常变化 类似于 但带有一个额外的 用于仅限 位置参数 新版功能 返回具有指定文件名 函数名和第一行号的新空代码对象 对于 或 生成的代码对象是非法的 异常处理 注解 抛出异常 新版功能 新版功能 可用性 可用性 可用性 可用性 可用性 新版功能 可用性 新版功能 新版功能 新版功能 标准警告类别 新版功能 新版功能 新版功能 新版功能 注解 注解 注解 注解 注解 新版功能 注解 新版功能 在 版更改 新版功能 版后已移除 版后已移除 递归控制 在 版更改 在 版更改 标准异常 名称 名称 注释 新版功能 介绍如下 新版功能 和 新版功能 这些是兼容性别名 名称 注释 在 版更改 这些别名曾经是单独的异常类型 注释 这是其他标准异常的基类 标准警告类别 名称 名称 注释 新版功能 注释 这是其他标准警告类别的基类 稳定的应用程序二进制接口 在堆中分配对象 为新分配的对象 初始化它的类型和引用 返回初始化后的对象 如果 声明这个对象参与循环垃圾检测那么这个对象会被添加进垃圾检测 的对象集中 这个对象的其他字段不会被影响 它的功能和 一样并且初始化变量大小的对象的长度 使用 结构类型 和 类型对象 分配一个新的 对象 未在该 对象头中定义的字段不会被初始化对象的 引用计数将为一 内存分配大小由 对象的 字段来确 定 使用 的数据结构类型 和 的类型对象 分配一个新的 对象 对象头文件中没有定义的字段不会被初始化 被分配的 内存空间预留了 结构加 对象中 字段提供的 字段的值 这对于实现类似元组这种能够在构造期决定自己大小的对 象是很实用的 将字段的数组嵌入到相同的内存分配中可以减少内存分配的 次数这提高了内存分配的效率 释放由 或者 分配内存的对象 这 通常由对象的 字段定义的 处理函数来调用 调用这个函 数以后 对象中的字段都不可以被访问因为原分配的内存空间已不再是一 个有效的 对象 像 一样的 对象 这个对象仅可以使用 宏访问这 个宏取得指向这个对象的指针 参见 分配内存和创建扩展模块 概述 的应用编程接口 使得 和 程序员可以在多个层级上访问 解释器 该 在 中同样可用但为简化描述通常将其称为 使用 有两个基本的理由 第一个理由是为了特定目的而编写 扩展模块它们是扩展 解释器功能的 模块 这可能是最常见的使用场景 第二个理由是将 用作更大规模应用的组件这种技巧通常被称为在一个应用中 编写扩展模块的过程相对来说更易于理解可以通过菜谱的形式分步骤介绍 使用某些工具可在一定程度上自动化这一过程 虽然人们在其他应用中嵌入 的做法早已有之但嵌入 的过程没有编写扩展模块那样方便直观 许多 函数在你嵌入或是扩展 这两种场景下都能发挥作用此外大多数嵌入 的应用程序也需要提供自定义扩展因此在尝试在实际应用中嵌入 之前先熟悉编写扩展应该会是个好主意 代码标准 如果你想要编写可包含于 的 代码你 必须 遵循在 中定义的指导原则和标准 这些指导原则适用于任何你所要扩展的 版本 在编写你自己的第三方扩展模块时可以不必遵循这些规范除非你准备在日后向 贡献这些模块 包含文件 使用 所需要的全部函数 类型和宏定义可通过下面这行语句包含到你的代码之中 这意味着包含以下标准头文件 和 如果可用 注解 由于 可能会定义一些能在某些系统上影响标准头文件的预处理器定义 因此在包含任何标准头文件之前你 必须 先包含 语句解释及变量编译 所定义的全部用户可见名称由包含的标准头文件所定义的除外都带有前缀 或者 以 打头的名称是供 实现内部使用的不应被扩展编写者使用 结构成员名称没有保留前缀 注解 头文件通常会与 一起安装 在 上它们位于以下目录 和 其中 和 是由向 的 脚本传入的对应形参所定义而 则为 在 上头文件安装于 其中 是向安装程序指定的安装目录 要包含头文件请将两个目录如果不同都放到你所用编译器的包含搜索路径中 请 不要 将父目录放入搜索路径然后使用 这将使得多平台编译不可用因为 下平台无关的头文件需要包含来自 下特定平台的头文件 有用的宏 对象 类型和引用计数 引用计数 类型 异常 程序员只需要处理特定需要处理的错误异常未处理的异常会自动传递给调用者然后传递给调用者的调用者依此类推直到他们到达顶级解释器在那里将它们报告给用户并伴随堆栈回溯 嵌入 调试构建 除了前面描述的引用计数调试之外还执行以下额外检查 额外检查将添加到对象分配器 额外的检查将添加到解析器和编译器中 许多断言被添加到字典和集合实现中 另外集合对象需要 方法 输入参数的完整性检查被添加到框架创建中 使用已知的无效模式初始化整型的存储以捕获对未初始化数字的引用 添加底层跟踪和额外的异常检查到虚拟机的运行时中 添加额外调试到线程模块 这里可能没有提到的额外的检查 有关更多详细信息请参阅 源代码中的 序列协议 如果对象提供序列协议函数返回 否则返回 请注意它将为具有 方法的 类返回 除非它们是 的子类 因为在一般情况下无法确定它所支持键类型 此函数总是会成功执行 到哪里积分返回序列 中对象的数量失败时返回 这相当于 表达式 成功时返回 和 的拼接失败时返回 这等价于 表达式 返回序列对象 重复 次的结果失败时返回 这等价 于 表达式 成功时返回 和 的拼接失败时返回 在 支持的 情况下操作将 原地 完成 这等价于 表达式 返回序列对象 重复 次的结果失败时返回 在 支持的情况下该操作会 原地 完成 这等价于 表达式 返回 中的第 号元素失败时返回 这等价于 表 达式 返回序列对象 的 到 的切片失败时返回 这等价 于 表达式 将对象 赋值给 的第 号元素 失败时会引发异常并返回 成功时返回 这相当于 语句 此函数 不会 改变对 的引用 如果 为 元素将被删除但是此特性已被弃用应当改用 删除对象 的第 号元素 失败时返回 这相当于 语 句 将序列对象 赋值给序列对象 的从 到 切片 这相当于 语句 删除序列对象 的从 到 的切片 失败时返回 这相 当于 语句 返回 在 中出现的次数即返回使得 的键 的数量 失败时返回 这相当于 表达式 确定 是否包含 如果 中的某一项等于 则返回 否则返回 出错时返回 这相当于 表达式 返回第一个索引 其中 出错时返回 相当于 的 表达式 返回一个列表对象其内容与序列或可迭代对象 相同失败时返回 返回的列表保证是一个新对象 这等价于 表达式 返回一个元组对象其内容与序列或可迭代对象 相同失败时返回 如果 为元组则将返回一个新的引用在其他情况下将使用 适当的内容构造一个元组 这等价于 表达式 将序列或可迭代对象 作为其他 函数族可用的对象 返回 如果该对象不是序列或可迭代对象则会引发 并将 作为消息文本 失败时返回 函数之所以这样命名是因为它们会假定 是一个 或 并直接访问 的数据字段 作为 的实现细节如果 已经是一个序列或列表它将被直接 返回 在 由 返回且 不为 的情况下返回 的长度 也可以通过在 上调用 来获取大小 但是 速度更快因为它可以假定 为 列表或元组 在 由 返回且 不 并且 在索 引范围内的情况下返回 的第 号元素 返回 指针的底层数组 假设 由 返回 且 不为 请注意如果列表调整大小重新分配可能会重新定位 数组 因此仅在序 列无法更改的上下文中使用基础数组指针 返回 的第 个元素或在失败时返回 此形式比 理馔但不会检查 上的 是否为真值也不会对负序号进行调整 数字协议 如果对象 提供数字的协议返回真 否则返回假 这个函数不会调 用失败 在 版更改 如果 是一个索引整数则返回 返回 相加的结果如果失败返回 等价于 表达式 返回 减去 的结果如果失败返回 等价于 表 达式 返回 相乘的结果如果失败返回 等价于 表达式 返回 做矩阵乘法的结果如果失败返回 等价于 表达式 新版功能 返回 除以 的向下取整后的结果如果失败返回 等 价于传统的整数除法 返回 除以 的一个合理的近似值如果失败返回 结果 是近似的因为二进制浮点数是一个近似值不可能以 为基数来表示出所有 实数 这个函数返回两个整数相除得到的浮点数 返回 除以 得到的余数如果失败返回 等价于 表达式 参考内置函数 如果失败返回 等价于 表达 式 请参阅内置函数 如果失败返回 等价于 中的 表达式 其中 是可选的 如果要忽略 则需 传入 作为代替如果传入 会导致非法内存访问 返回 的负值如果失败返回 等价于 表达式 返回 如果失败返回 等价于 表达式 返回 的绝对值如果失败返回 等价于 表达式 返回 的按位取反后的结果如果失败返回 等价于 表达式 返回 左移 个比特后的结果如果失败返回 等价于 表达式 返回 右移 个比特后的结果如果失败返回 等价于 表达式 返回 和 按位与的结果如果失败返回 等价于 表达式 返回 和 按位异或的结果如果失败返回 等价于 表达式 返回 和 按位或的结果如果失败返回 等价于 表达式 返回 相加的结果如果失败返回 当 支持时 这个运算直接使用它储存结果 等价于 语句 返回 相减的结果如果失败返回 当 支持时 这个运算直接使用它储存结果 等价于 语句 返回 相乘的结果如果失败返回 当 支持 时这个运算直接使用它储存结果 等价于 语句 返回 做矩阵乘法后的结果如果失败返回 当 支持时这个运算直接使用它储存结果 等价于 语句 新版功能 返回 除以 后向下取整的结果如果失败返回 当 支持时这个运算直接使用它储存结果 等价于 语句 返回 除以 的一个合理的近似值如果失败返回 结果 是近似的因为二进制浮点数是一个近似值不可能以 为基数来表示出所有 实数 这个函数返回两个整数相除得到的浮点数 当 支持时这个运 算直接使用它储存结果 返回 除以 得到的余数如果失败返回 当 支持 时这个运算直接使用它储存结果 等价于 语句 请参阅内置函数 如果失败返回 当 支持时这 个运算直接使用它储存结果 当 是 时等价于 语 句 否则等价于在原来位置储存结果的 如果要忽略 则需传入 传入 会导致非法内存 访问 返回 左移 个比特后的结果如果失败返回 当 支持时这个运算直接使用它储存结果 等价于 语句 返回 右移 个比特后的结果如果失败返回 当 支持时这个运算直接使用它储存结果 等价于 语句 成功时返回 和 按位与 的结果失败时返回 在 支持的前提下该操作将 原地 执行 等价与 语句 成功时返回 和 按位异或的结果失败时返回 在 支持的前提下该操作将 原地 执行 等价与 语句 成功时返回 和 按位或 的结果失败时返回 在 支持的前提下该操作将 原地 执行 等价于 语句 成功时返回 转换为整数对象后的结果失败时返回 等价于 表达式 成功时返回 转换为浮点对象后的结果失败时返回 等价于 表达式 成功时返回 转换为 类型后的结果失败时返回 并 引发 异常 返回整数 转换成以 为基数的字符串后的结果 这个 参 数必须是 或者 对于基数 或 返回的字符串将分 别加上基数标识 如果 不是 中的 整数 类型就先通过 将它转换成整数类型 如果 是一个整数类型的解释型返回 转换成一个 值 项后的结果 如果调用失败返回 并引发异常 如果 可以被转换为 类型但尝试转换为 值则会 引发 这时 参数为将被引发的异常类型 通常是 或 如果 为 则异常会被 清除并且值会被裁剪为负整数 或正整数 如果 是一个索引整数存有 位置并有 填入其 中则返回 否则返回 这个函数不会调用失败 复数对象 从 看 的复数对象由两个不同的部分实现一个是在 程序使用的 对象另外的是一个代表真正复数值的 结构体 提供了函数共同操作两者 表示复数的 结构体 表示复数的 对象 函数对象 对象协议 实现描述器 新版功能 新版功能 注解 在 版更改 在 版更改 在 版更改 新版功能 初始化配置 新版功能 结构 函数 参见 初始化配置 方法 长度 列表项目 参见 参见 参见 路径配置 路径配置输入 仅 仅 等等 生成器对象 生成器对象是 用来实现生成器迭代器的对象 它们通常通过迭代产生值的函数来创建而不是显式调用 或 用于生成器对象的 结构体 与生成器对象对应的类型对 象 如果 是一个生成器对象则返回真值 必须不为 如果 的类型为 则返回真值 必须不为 基于 对象创建并返回一个新的生成器对象 此函数会取走一个对 的引用 参数必须不为 基于 对象创建并返回一个新的生成器对象其中 和 设为 和 此函数会取走一个对 的引用 参数必须不为 对象 字符串转换与格式化 对象 例子 快速参考 槽 槽 特殊方法属性 信息 无符号长整型 无符号整型 列 槽 特殊方法 参数类型 返回类型 整型 整型 整型 整型 整型 整 型 整 整型 型 整型 整型 整型 整型 请参阅 里有更多详细信息 警告 注解 在 版更改 新版功能 使对象类型支持循环垃圾回收 新版功能 新版功能 版后已移除 新版功能 使对象类型支持循环垃圾回收 警告 在 版更改 使对象类型支持循环垃圾回收 常数 对照 定义以下宏是为了简化编写丰富的比较函数 新版功能 注解 警告 新版功能 参见 新版功能 使对象类型支持循环垃圾回收 新版功能 注解 在 版更改 新版功能 新版功能 在 版更改 在 版更改 语句解释及变量编译 这些函数在创建你自己的函数时帮助很大 更多说明以及实例可参考说明文档中的 扩展和嵌入 解释器 小节 这些函数描述的前三个 以及 它们都使用 格式化字符串 来将函数期待的参数告知函数 这些函数都使用相同语法规则的格式化字符串 解析参数 一个格式化字符串包含 或者更多的格式单元 一个格式单元用来描述一个 对象它通常是一个字符或者由括号括起来的格式单元序列 除了少数例外一个非括号序列的格式单元通常对应这些函数的具有单一地址的参数 在接下来的描述中双引号内的表达式是格式单元圆括号 内的是对应这个格式单元的 对象类型方括号 内的是传递的 变量变量集类型 字符串和缓存区 数字 将一个非负的 整型转化成一个无符号的微整型存储在一个 类型中 将一个 整型转化成一个微整型并不检查溢出问题存储在一个 类型中 将一个 整型转化成一个 短整型 将一个 整型转化成一个 无符号短整型 并不检查溢出问题 将一个 整型转化成一个 整型 将一个 整型转化成一个 无符号整型并不检查 溢出问题 将一个 整型转化成一个 长整型 将一个 整型转化成一个 无符号长整型并不 检查溢出问题 将一个 整型转化成一个 长长整型 将一个 整型转化成一个 无符号长长整型 并不检查溢出问题 将一个 整型转化成一个 元大小类型 或者 长度为 将一个 字节类型如一个长度为 的 或者 对象转化成一个 字符类型 在 版更改 允许 类型的对象 长度为 将一个 字符如一个长度为 的 字符串对象转化成一个 整型类型 将一个 浮点数转化成一个 浮点数 将一个 浮点数转化成一个 双精度浮点数 将一个 复数类型转化成一个 复数类型 其他对象 将 对象不进行任何转换存储在 对象指针中 因此 程序 接收已传递的实际对象 对象的引用计数不会增加 存储的指针不是 将一个 对象存入一个 对象指针 这类似于 但是接受两个 参数第一个是 类型对象的地址第二个是存储对象指针的 变 量 类型为 的地址 如果 对象不具有所要求的类型 则会引发 通过一个 函数将一个 对象转换为一个 变量 此函 数接受两个参数第一个是函数第二个是 变量 类型任意 的地址转 换为 类型 函数将以如下方式被调用 其中 是待转换的 对象而 为传给 函数的 参数 返回的 应当以 代表转换成功而以 代表转换失败 当转换失败时 函数 应当引发异常并且会让 的内容保持未修改状态 如果 返回 则如果参数解析最终失 败它可能会再次调用该函数从而使转换器有机会释放已分配的任何内存 在第二个调用中 参数将为 因此该参数将为 因此该参数将为 因此该参数将为 如果值为 的值与原始呼叫中的值相同 在 版更改 被添加 测试传入的值是否为真一个布尔判断并且将结果转化为相对应的 整型值 如果表达式为真置 假则置 它接受任何合法 的 值 参见 逻辑值检测 获取更多关于 如何测试值为真的 信息 新版功能 对象必须是 序列它的长度是 中格式单元的数量 参数 必须对应 中每一个独立的格式单元 序列中的格式单元可能有嵌套 传递 整型整型的值超过了平台的 限制是可能的然而没有进行适当的范围检测 当接收字段太小而接收不到值时最重要的位被静默地截断实际上 语言会在语义继承的基础上强制类型转换 期望的值可能会发生变化 格式化字符串中还有一些其他的字符具有特殊的涵义 这些可能并不嵌套在圆括号中 它们是 表明在 参数列表中剩下的参数都是可选的 变量对应的可选参数 需要初始化为默认值 当一个可选参数没有指定时 不能访问相应的 变量变量集的内容 表明在 参数列表中剩下 的参数都是强制关键字参数 当前所有强制关键字参数都必须也是可选参 数所以格式化字符串中 必须一直在 前面 新版功能 格式单元的列表结束标志冒号后的字符串被用来作为错误消息中的函数名 函数引发的关联值异常 格式单元的列表结束标志分号后的字符串被用来作为错误消息取代默认的 错误消息 和 相互排斥 注意任何由调用者提供的 对象引用是 借来的 引用不要递减它们的引用计数传递给这些函数的附加参数必须是由格式化字符串确定的变量的地址这些都是用来存储输入元组的值 有一些情况如上面的格式单元列表中所描述的这些参数作为输入值使用在这种情况下它们应该匹配指定的相应的格式单元 为了转换成功 对象必须匹配格式并且格式必须用尽 成功的话 函数返回 反之它们返回 并且引发一个合适的异常 当 函数因为某一个格式单元转化失败而失败时对应的以及后续的格式单元地址内的变量都不会被使用 函数 解析一个函数的参数表达式中的参数按参数位置顺序存入局部变量中 成 功返回 失败返回 并且引发相应的异常 和 相同然而它接受一个 类型的参数而不 是可变数量的参数集 分析将位置参数和关键字参数同时转换为局部变量的函数的参数 参数是关键字参数名称的 终止数组 空名称表示 成功时返回 发生故障时它将返回 并引发相应的异常 在 版更改 添加了 的支持 和 相同然而它接受一个 类型 的参数而不是可变数量的参数集 确保字典中的关键字参数都是字符串 这个函数只被使用于 不被使用的情况下后者已经不再做这 样的检查 新版功能 函数被用来析构旧类型函数的参数列表 这些函数使用的 参数解析方法已从 中移除 这不被推荐用于新代码的参数解析 并且在标准解释器中的大多数代码已被修改已不再用于该目的 它仍然方 便于分解其他元组然而可能因为这个目的被继续使用 一个更简单的参数提取方式它不使用格式字符串来指定参数类型 使用这 种方法来提取参数的函数应当在函数或方法表中被声明为 包含实际参数的元组应当作为 传入它必须确实是一个元组 元组 的长度必须至少为 并且不超过 和 可能相等 额外的参数必须被传入函数每个参数必须是一个指向 变量的 指针它们将以来自 的值填充它们将包含暂借的引用 对应于可 选参数的变量不会由 给出的值填充它们将由调用者来初始化 此 函数执行成功时返回真值如果 不是元组或者包含错误数量的元素 则返回假值如果执行失败则将设置一个异常 这是一个使用此函数的示例取自 帮助模块用来弱化引用的源 代码 这个例子中调用 完全等价于调用 创建变量 基于类似于 函数系列和一系列值的格式字符串创建新值 在出现错误时返回值或 如果返回 将引发异常 并不一直创建一个元组 只有当它的格式化字符串包含 两个或更多的格式单元才会创建一个元组 如果格式化字符串是空它返回 如果它包含一个格式单元它返回由格式单元描述的的任一对象 用圆括号包裹格式化字符串可以强制它返回一个大小为 或者 的元组 当内存缓存区的数据以参数形式传递用来构建对象时如 和 格式 单元会拷贝需要的数据 调用者提供的缓冲区从来都不会被由 创建的对象来引用 换句话说如果你的代码调用 并且将分配的内存空间传递给 你的代码就 有责任在 返回时调用 在下面的描述中双引号的表达式使格式单元圆括号 内的是格式单元 将要返回的 对象类型方括号 内的是传递的 变量变量集的 类型 字符例如空格制表符冒号和逗号在格式化字符串中会被忽略但是不包括 格式单元如 这可以使很长的格式化字符串具有更好的可读性 或 使用 编码将空终止的 字符串转换为 对象 如果 字符串指针为 则使用 或 或 使用 编码将 字符串及其长度转换为 对象 如果 字符串指针为 则长度将被忽略并返回 这将 字符串转换为 对象 如果 字符串指针为 则返回 或 这会将 字符串及其长度转换为一个 对象 如果该 字符串 指针为 则返回 和 一样 或 或 和 一样 将空终止的 的 或 数据缓冲区转 换为 对象 如果 缓冲区指针为 则 返回 或 将 或 数据缓冲区及其长度转换为 对象 如果 缓冲区指针为 则长度将被忽略 并返回 或 和 一样 或 或 和 一样 将一个 整型转化成 整型对象 将一个 字符型转化成 整型对象 将一个 短整型转化成 整型对象 将一个 长整型转化成 整型对象 将一个 无符号字符型转化成 整型对象 将一个 无符号短整型转化成 整型对象 将一个 无符号整型转化成 整型对象 将一个 无符号长整型转化成 整型对象 将一个 长长整形转化成 整形对象 将一个 无符号长长整型转化成 整型对 象 将一个 类型转化为 整型 长度为 将一个 整型代表的字符转化为 长度为 的字 节对象 长度为 将一个 整型代表的字符转化为 长度为 的字符 串对象 将一个 双精度浮点数转化为 浮点数类型数字 将一个 单精度浮点数转化为 浮点数类型数字 将一个 类型的结构转化为 复数类型 将 对象传递不变其引用计数除外该计数由 递增 如果 传入的对象是 指针则假定这是由于生成参数的调用发现错误并 设置异常而引起的 因此 将返回 但不会 引发异常 如果尚未引发异常则设置 和 相同 和 相同然而它并不增加对象的引用计数 当通过调用参数列表中 的对象构造器创建对象时很实用 通过 函数将 转换为 对象 该函数调 用时会传入 应与 兼容 作为参数并且应当返回一 个新的 对象或者当发生错误时返回 将一个 变量序列转换成 元组并保持相同的元素数量 相关的元素 将一个 变量序列转换成 列表并保持相同的元素数量 相关的元素 将一个 变量序列转换成 字典 每一对连续的 变量对作为一个 元素插入字典中分别作为关键字和值 如果格式字符串中出现错误则设置 异常并返回 和 相同然而它接受一个 类型的参数而不是 可变数量的参数集 列表对象 这个 类型 的子类型代表一个 列表对象 这是个属于 的代表 列表类型的实例 在 层面 和类型 是同一个对象 如果 是一个列表对象或者是一个列表类型的子类型实例时返回真 当 是一个列表对象但是不是列表类型的子类型实例时返回真 成功时返回一个长度为 的新列表失败时返回 注解 当 大于零时被返回的列表对象项目被设成 因此你不能 用类似 函数 的抽象 或者用 函数 将所有项目设置成真实对象前对 代码公开这个 对象 返回 中列表对象的长度这等于在列表对象调用 宏版本的 函数 没有错误检测 返回 所指向列表中 位置上的对象 位置值必须为非负数 不支持从列表末尾进行索引 如果 超出边界 则返回 并设置 异常 宏版本的 函数 没有错误检测 将列表中索引为 的项设为 成功时返回 如果 超出范围则返回 并设定 异常 注解 此函数会偷走一个对 的引用并丢弃一个对列表中受影响位置上 的已有条目的引用 不带错误检测的宏版本 这通常只被用于新列表中之 前没有内容的位置进行填充 注解 该宏会偷走一个对 的引用但与 不同的 是它 不会 丢弃对任何被替换条目的引用在 的 位置上的 任何引用都将被泄露 将条目 插入到列表 索引号 之前的位置 如果成 功将返回 如果不成功则返回 并设置一个异常 相当于 将对象 添加到列表 的末尾 如果成功将返回 如果不 成功则返回 并设置一个异常 相当于 返回一个对象列表包含 当中位于 和 之间 的对 象 如果不成功则返回 并设置异常 相当于 不支持从列表末尾进行索引 将 当中 与 之间的切片设为 的内容 相当于 可以为 表示 赋值为一个空列表删除切片 成功时返回 失败时返回 这 里不支持从列表末尾进行索引 对 中的条目进行原地排序 成功时返回 失败时返回 这等价于 对 中的条目进行原地反转 成功时返回 失败时返回 这等价于 返回一个新的元组对象其中包含 的内容等价于 引用计数 对象 请注意 的 不会直接在 中公开 由于 是单例测试对象标识在 中使用 就足够了 由于同样的原因没有 函数 对象表示缺乏值 这个对象没有方法 它需要像引用计 数一样处理任何其他对象 正确处理来自 函数内的 返回也就是说增加 的引用 计数并返回它 字节数组对象 这个 的子类型表示一个 字节数组对象 类型表示为 的实例这与 层面的 是相同的对象 类型检查宏 当对象 是一个字节数组对象而且是一个字节数组类型的子类型实例时 返回真 当对象 是一个字节数组对象但不是一个字节数组类型的子类型实例时 返回真 直接 函数 根据任何实现了 缓冲区协议 的对象 返回一个新的字节数组对象 根据 及其长度 创建一个新的 对象 当失败时 返回 连接字节数组 和 并返回一个带有结果的新的字节数组 在检查 指针后返回 的大小 在检查 指针后返回将 返回为一个字符数组 返回的 数组总是会附加一个额外的空字节 将 的内部缓冲区的大小调整为 宏 这些宏减低安全性以换取性能它们不检查指针 函数 的宏版本 函数 的宏版本 内存管理 概述 在 中内存管理涉及到一个包含所有 对象和数据结构的私有堆 这个私有堆的管理由内部的 内存管理器 保证 内存管理器有不同的组件来处理各种动态存储管理方面的问题如共享 分割 预分配或缓存 在最底层一个原始内存分配器通过与操作系统的内存管理器交互确保私有堆中有足够的空间来存储所有与 相关的数据 在原始内存分配器的基础上几个对象特定的分配器在同一堆上运行并根据每种对象类型的特点实现不同的内存管理策略 例如整数对象在堆内的管理方式不同于字符串 元组或字典因为整数需要不同的存储需求和速度与空间的权衡 因此 内存管理器将一些工作分配给对象特定分配器但确保后者在私有堆的范围内运行 堆内存的管理是由解释器来执行用户对它没有控制权即使他们经常操作指向堆内内存块的对象指针理解这一点十分重要 对象和其他内部缓冲区的堆空间分配是由 内存管理器按需通过本文档中列出的 函数进行的 为了避免内存破坏扩展的作者永远不应该试图用 库函数导出的函数来对 对象进行操作这些函数包括 和 这将导致 分配器和 内存管理器之间的混用引发严重后果这是由于它们实现了不同的算法并在不同的堆上操作 但是我们可以安全地使用 库分配器为单独的目的分配和释放内存块如下例所示 在这个例子中 缓冲区的内存请求是由 库分配器处理的 内存管理器只参与了分配作为结果返回的字节对象 然而在大多数情况下建议专门从 堆中分配内存因为后者由 内存管理器控制 例如当解释器扩展了用 写的新对象类型时就必须这样做 使用 堆的另一个原因是希望通知 内存管理器关于扩展模块的内存需求 即使所请求的内存全部只用于内部的 高度特定的目的将所有的内存请求交给 内存管理器能让解释器对其内存占用的整体情况有更准确的了解 因此在某些情况下 内存管理器可能会触发或不触发适当的操作如垃圾回收 内存压缩或其他预防性操作 请注意通过使用前面例子中所示的 库分配器为 缓冲区分配的内存会完全不受 内存管理器管理 参见 环境变量 可被用来配置 所使用的内存分配器 环境变量 可以用来在每次创建和关闭新的 对象区域时打印 内存分配器 的统计数据 原始内存接口 内存接口 对象分配器 以下函数集仿照 标准并指定了请求零字节时的行为可用于从 堆分配和释放内存 默认对象分配器 使用 内存分配器 警告 在使用这些函数时必须持有 全局解释器锁 分配 个字节并返回一个指向分配的内存的 类型指针如果请 求失败则返回 请求零字节可能返回一个独特的非 指针就像调用了 一样 但是内存不会以任何方式被初始化 分配 个元素每个元素的大小为 字节并返回指向分配 的内存的 类型指针如果请求失败则返回 内存会被初始 化为零 请求零字节可能返回一个独特的非 指针就像调用了 一样 新版功能 将 指向的内存块大小调整为 字节 以新旧内存块大小中的最小值 为准其中内容保持不变 如果 是 则相当于调用 如果 等 于 则内存块大小会被调整但不会被释放返回非 指针 除非 是 否则它必须是之前调用 或 所返回的 如果请求失败 返回 仍然是指向先 前内存区域的有效指针 释放 指向的内存块 必须是之前调用 或 所返回的指针 否则或 在 之前已经调用过的情况下未定义行为会发生 如果 是 那么什么操作也不会进行 默认内存分配器 默认内存分配器 配置 名称 发布版本 调试构建 没有 的发布版本 没有 的调试构建 说明 名称 环境变量 的值 来自 标准库的系统分配 函数 内存分配器 带有 安装的调试钩子 自定义内存分配器 分配器 有为具有短生命周期的小对象小于或等于 字节优化的 分配器 它使用固定大小为 的称为 的内存映射 对于大于 字节的分配它回到使用 和 是 例如 和 例如 域的 默认分配器 分配器使用以下函数 上的 和 和 如果可用 否则 和 自定义 分配器 新版功能 在 模块中跟踪一个已分配的内存块 成功时返回 出错时返回 无法分配内存来保存跟踪信息 如果 禁用了 则返回 如果内存块已被跟踪则更新现有跟踪信息 在 模块中取消跟踪一个已分配的内存块 如果内存块未被 跟踪则不执行任何操作 如果 被禁用则返回 否则返回 示例 以下是来自 概述 小节的示例经过重写以使 缓冲区是通过使用第一个函数集从 堆中分配的 使用面向类型函数集的相同代码 请注意在以上两个示例中缓冲区总是通过归属于相同集的函数来操纵的 事实上对于一个给定的内存块必须使用相同的内存 族以便使得混合不同分配器的风险减至最低 以下代码序列包含两处错误其中一个被标记为 因为它混合了两种在不同堆上操作的不同分配器 除了旨在处理来自 堆的原始内存块的函数之外 中的对象是通过 和 来分配和释放的 这些将在有关如何在 中定义和实现新对象类型的下一章中讲解 新版功能 新版功能 新版功能 新版功能 新版功能 域 类型 意义 新版功能 新版功能 新版功能 域 类型 意义 数据类型 长整型 无符号整型 无符号长整型 无符号 域 类型 意义 整数型对象 上下文变量对象 对象 模块提供了各种日期和时间对象 在使用任何这些函数之前必须在你的源码中包含头文件 请注意此文件并未包含在 中并且宏 必须被发起调用通常是作为模块初始化函数的一部分 这个宏会将指向特定 结构的指针放入一个静态变量 中它会由下面的宏来使用 宏访问 单例 返回表示 的时区单例与 为同一对象 新版功能 类型检查宏 如果 为 类型或 的 某个子类型则返回真值 不能为 如果 为 类型则返回真值 不能为 如果 为 类型或 的某个子类型则返回真值 不能为 如果 为 类型则返回真值 不能为 如果 的类型是 或是 的子类型则返回真值 必须不为 如果 的类型是 则返回真值 必须不为 如果 为 类型或 的某个子类型则返回真值 不能为 如果 为 类型则返回真值 不能为 如果 为 类型或 的某个子类型则返回真值 不能为 如果 的类型是 则返回真值 不能为 用于创建对象的宏 返回指定年 月 日的 对象 返回具有指定 和 属性的 对象 返回具有指定 和 属性的 对象 新版功能 返回具有指定 属性的 对象 返回具有指定 和 属性的 对象 新版功能 返回代表给定天 秒和微秒数的 对象 将执行正规 化操作以使最终的微秒和秒数处在 对象的文档指明 的区间之内 返回一个 对象该对象具有以 参数表示 的未命名固定时差 新版功能 返回一个 对象该对象具有以 参数表示的 固定时差和时区名称 新版功能 一些用来从 对象中提取字段的宏 参数必须是 包括其子类 例如 的实例 参数必须不为 并且类型不被会检查 以正整数的形式返回年份值 返回月从 到 的整数 返回日期从 到 的整数 一些用来从 对象中提取字段的宏 参数必须是 包括其子类的实例 参数必须不为 并且类型不会被检查 返回小时从 到 的整数 返回分钟从 到 的整数 返回秒从 到 的整数 返回微秒从 到 的整数 一些用来从 对象中提取字段的宏 参数必须是 包括其子类的实例 参数必须不为 并且类型不会被检查 返回小时从 到 的整数 返回分钟从 到 的整数 返回秒从 到 的整数 返回微秒从 到 的整数 一些用来从 对象中提取字段的宏 参数必须是 包括其子类的实例 参数必须不为 并且类型不会被检查 返回天数从 到 的整数 新版功能 返回秒数从 到 的整数 新版功能 返回微秒数从 到 的整数 新版功能 一些便于模块实现 的宏 创建并返回一个给定元组参数的新 对象适合传给 创建并返回一个给定元组参数的新 对象适合传给 工具 本章中的函数执行各种实用工具任务包括帮助 代码提升跨平台可移植性在 中使用 模块以及解析函数参数并根据 中的值构建 中的值等等 操作系统实用程序 系统功能 过程控制 导入模块 数据 操作支持 语句解释及变量编译 解析参数 字符串和缓存区 数字 其他对象 函数 创建变量 字符串转换与格式化 反射 编解码器注册与支持功能 查找 用于 编码错误处理程序的注册表 对象 一个 对象 级别的 缓冲区接口 暴露为一个可以像任何其他对象一样传递的 对象 从提供缓冲区接口的对象创建 对象 如果 支持可写缓 冲区导出则 对象将可以被读写否则它可能是只读的也可 以是导出器自行决定的读写 使用 作为底层缓冲区创建一个 对象 可以是 或者 之一 新版功能 创建一个包含给定缓冲区结构 的 对象 对于简单的字 节缓冲区 是首选函数 从定义缓冲区接口的对象创建一个 对象 内存块 在 或 中 如果内存是连续的则 对象指向原始内存 否则复制并且 指向新的 对象 如果对象 是 对象则返回 目前不允许创建 的子类 返回指向 的导出缓冲区私有副本的指针 必须 是一个 实例这个宏不检查它的类型你必须自己检查否则 你将面临崩溃风险 返回 所基于的导出对象的指针或者如果 已由函 数 或 创建 则返回 必须 是一个 实例 数据 操作支持 这些例程允许 代码处理与 模块所用相同数据格式的序列化对象 其中有些函数可用来将数据写入这种序列化格式另一些函数则可用来读取并恢复数据 用于存储 数据的文件必须以二进制模式打开 数字值在存储时会将最低位字节放在开头 此模块支持两种数据格式版本第 版为历史版本第 版本会在文件和 反序列化中共享固化的字符串 第 版本会对浮点数使用二进制格式 指明了当前文件的格式当前取值为 将一个 整数 以 格式写入 这将只写入 最低的 位无论本机 类型的长度如何 指 明文件格式的版本 将一个 对象 以 格式写入 指明文件格式的版本 返回一个包含 的 表示形式的字节串对象 指 明文件格式的版本 以下函数允许读取并恢复存储为 格式的值 从打开用于读取的 的对应数据流返回一个 使用只函数 只能读取 位的值无论本机 类型的长度为何 发生错误时将设置适当的异常 并返回 从打开用于读取的 的对应数据流返回一个 使用此函 数只能读取 位的值无论本机 类型的长度为何 发生错误时将设置适当的异常 并返回 从打开用于读取的 的对应数据流返回一个 对象 发生错误时将设置适当的异常 或 并返回 从打开用于读取的 的对应数据流返回一个 对象 不同于 此函数假定将不再从该文件读取更多 的对象允许其将文件数据积极地载入内存以便反序列化过程可以在内存 中的数据上操作而不是每次从文件读取一个字节 只有当你确定不会再从文 件读取任何内容时方可使用此形式 发生错误时将设置适当的异常 或 并返回 从包含指向 的 个字节的字节缓冲区对应的数据流返回一个 对象 发生错误时将设置适当的异常 或 并返回 对象 对象的 结构用于描述 类型 这是属于 对象的 它在 层面和 是相同 的对象 如果对象 是一个类型对象包括继承于标准类型对象的类型实例返回 非零 在其它所有情况下返回 新版功能 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 在 版更改 对象实现支持 本章描述了定义新对象类型时所使用的函数 类型和宏 在堆中分配对象 对象 快速参考 槽 例子 使对象类型支持循环垃圾回收 抽象对象层 参考手册 本手册描述了希望编写扩展模块并将 解释器嵌入其应用程序中的 和 程序员可用的 同时可以参阅 扩展和嵌入 解释器 其中描述了扩展编写的一般原则但没有详细描述 函数 概述 代码标准 包含文件 有用的宏 对象 类型和引用计数 异常 嵌入 调试构建 稳定的应用程序二进制接口 引用计数 异常处理 抛出异常 递归控制 标准异常 标准警告类别 工具 操作系统实用程序 系统功能 过程控制 导入模块 数据 操作支持 语句解释及变量编译 字符串转换与格式化 反射 编解码器注册与支持功能 抽象对象层 对象协议 呼叫协议 数字协议 序列协议 映射协议 迭代器协议 缓冲协议 旧缓冲协议 具体的对象层 基本对象 数值对象 序列对象 容器对象 函数对象 其他对象 在 初始化之前 全局配置变量 异步通知 分析和跟踪 高级调试器支持 初始化配置 路径配置 内存管理 概述 原始内存接口 内存接口 对象分配器 默认内存分配器 自定义内存分配器 分配器 示例 对象实现支持 在堆中分配对象 对象 例子 使对象类型支持循环垃圾回收 和 版本管理 字典对象 迭代器对象 提供了两个通用迭代器对象 第一个是序列迭代器它使用支持 方法的任意序列 第二个使用可调用对象和一个 值为序列中的每个项调用可调用对象并在返回 值时结束迭代 返回迭代器对象的类型对象和内置序列类型内置函数 的单参数形式 如果 的类型为 则返回 返回一个与常规序列对象一起使用的迭代器 当序列订阅操作引发 时迭代结束 由函数 和 内置函数的双参数形式返回的迭 代器对象类型对象 如果 的类型为 则返回 返回一个新的迭代器 第一个参数 可以是任何可以在没有参数 的情况下调用的 可调用对象每次调用都应该返回迭代中的下一个 项目 当 返回等于 的值时迭代将终止 实例方法对象 实例方法是 的包装器也是将 绑定到类对象的一种新方式 它替代了原先的调用 这个 实例代表 实例方法类型 它并不对 程序公开 如果 是实例方法对象 类型为 则返回真值 形参必须不为 返回一个新的实例方法对象 应为任意可调用对象 将在实 例方法被调用时作为函数被调用 返回关联到实例方法 的函数对象 宏版本的 略去了错误检测 具体的对象层 本章中的函数特定于某些 对象类型 将错误类型的对象传递给它们并不是一个好主意如果您从 程序接收到一个对象但不确定它是否具有正确的类型则必须首先执行类型检查例如要检查对象是否为字典请使用 本章的结构类似于 对象类型的家族树 警告 虽然本章所描述的函数会仔细检查传入对象的类型但是其中许多函数不会检 查传入的对象是否为 允许传入 可能导致内存访问冲突和解 释器的立即终止 基本对象 本节描述 类型对象和单一实例对象 象 对象 对象 数值对象 整数型对象 布尔对象 浮点数对象 复数对象 表示复数的 结构体 表示复数的 对象 序列对象 序列对象的一般操作在前一章中讨论过本节介绍 语言固有的特定类型的序列对象 字节对象 字节数组对象 类型检查宏 直接 函数 宏 对象和编码解码器 对象 类型 字符属性 元组对象 结构序列对象 列表对象 容器对象 字典对象 集合对象 函数对象 函数对象 实例方法对象 方法对象 对象 代码对象 其他对象 文件对象 模块对象 迭代器对象 描述符对象 切片对象 对象 对象 弱引用对象 对象 生成器对象 协程对象 上下文变量对象 对象 和 版本管理 是 的版本号的整数形式 例如如果 被置为 其包含的版本信息可以通过以下方式将其作为一个 位数字来处理 字节 位数大端字节序 意义 中的 中的 中的 是 版本 是 版本 发 布的候选版本并且 是最终 版本在这个例子中这个版本是 版本 中的 最终 版本用 因此 的 进制版本号是 所有提到的宏都定义在 反射 返回当前执行帧中内置函数的字典如果当前没有帧正在执行则返回线程 状态的解释器 返回当前执行帧中局部变量的字典如果没有当前执行的帧则返回 返回当前执行帧中全局变量的字典如果没有当前执行的帧则返回 返回当前线程状态的帧如果没有当前执行的帧则返回 另请参阅 获取 为下一个外部帧 返回一个强引用如果 没有外部帧则返回 必须不为 新版功能 获取 的代码 返回一个强引用 必须不为 结果帧的代码不能为 新版功能 返回 当前正在执行的行号 必须不为 如果 是函数 类或实例对象则返回它的名称否则返回 的类型的名称 根据 的类型返回描述字符串 返回值包括函数和方法的 和 与 的结果连接结果将是 的描述 字节对象 导入模块 该函数总是使用绝对路径导入 该函数是 的一个被弃用的别名 在 版更改 新版功能 在 版更改 该函数总是使用绝对路径导入 注解 新版功能 参见 新版功能 新版功能 在 版更改 在 版更改 失败时返回值 新版功能 新版功能 新版功能 在 版更改 该指针被初始化为指向 数组以 或者 作为结 束标记 当一个冻结模块被导入首先要在这个表中搜索 第三方库可以以 此来提供动态创建的冻结模块集合 对象 对象用于实现由多个作用域引用的变量 对于每个这样的变量一个 对象为了存储该值而被创建引用该值的每个堆栈框架的局部变量包含同样使用该变量的对外部作用域的 引用 访问该值时将使用 中包含的值而不是单元格对象本身 这种对 对象的非关联化的引用需要支持生成的字节码访问时不会自动非关联化这些内容 对象在其他地方可能不太有用 用于 对象的 结构体 与 对象对应的类型对 象 如果 是一个 对象则返回真值 必须不为 创建并返回一个包含值 的新 对象 形参可以为 返回 对象 的内容 返回 对象 的内容但是不检测 是否非 并且 为一个 对象 将 对象 的内容设为 这将释放任何对 对象当 前内容的引用 可以为 必须为非 如果 它不是一个 对象则将返回 如果设置成功则将返回 将 对象 的值设为 不会调整引用计数并且不会进 行检测以保证安全 必须为非 并且为一个 对象 布尔对象 协程对象 新版功能 协程对象是使用 关键字声明的函数返回的 用于协程对象的 结构体 与协程对象对应的类型对 象 如果 的类型是 则返回真值 必须不为 基于 对象创建并返回一个新的协程对象其中 和 设为 和 此函数会取得一个对 的引用 参数必须不为 切片对象 缓冲协议 在 中可使用一些对象来包装对底层内存数组或称 缓冲 的访问 此类对象包括内置的 和 以及一些如 这样的扩展类型 第三方库也可能会为了特殊的目的而定义它们自己的类型例如用于图像处理和数值分析等 虽然这些类型中的每一种都有自己的语义但它们具有由可能较大的内存缓冲区支持的共同特征 在某些情况下希望直接访问该缓冲区而无需中间复制 以 缓冲协议 的形式在 层级上提供这样的功能 此协议包括两个方面 在生产者这一方面该类型的协议可以导出一个缓冲区接口允许公开它的 底层缓冲区信息 该接口的描述信息在 一节中 在消费者一侧有几种方法可用于获得指向对象的原始底层数据的指针例如 一个方法的形参 一些简单的对象例如 和 会以面向字节的形式公开它们的底层缓冲区 也可能会用其他形式例如 所公开的元素可以是多字节值 缓冲区接口的消费者的一个例子是文件对象的 方法任何可以输出为一系列字节流的对象可以被写入文件 然而 方法只需要对于传入对象的只读权限其他的方法如 需要参数内容的写入权限 缓冲区接口使得对象可以选择性地允许或拒绝读写或只读缓冲区的导出 对于缓冲接口的消费者而言有两种方式来获取一个目的对象的缓冲 使用正确的参数来调用 函数 调用 或其同级对象之一 并传入 格式代码 中的一个 在这两种情况下当不再需要缓冲区时必须调用 如果此操作失败可能会导致各种问题例如资源泄漏 缓冲区结构 缓冲区结构或者简单地称为 对于将二进制数据从另一个对象公开给 程序员非常有用 它们还可以用作零拷贝切片机制 使用它们引用内存块的能力可以很容易地将任何数据公开给 程序员 内存可以是 扩展中的一个大的常量数组也可以是在传递到操作系统库之前用于操作的原始内存块或者可以用来传递本机内存格式的结构化数据 与 解释器公开的大多部数据类型不同缓冲区不是 指针而是简单的 结构 这使得它们可以非常简单地创建和复制 当需要为缓冲区加上泛型包装器时可以创建一个 内存视图 对象 有关如何编写并导出对象的简短说明请参阅 缓冲区对象结构 要获取缓冲区对象请参阅 指向由缓冲区字段描述的逻辑结构开始的指针 这可以是导出程序底层 物理内存块中的任何位置 例如使用负的 值可能指向内存 块的末尾 对于 邻接 数组值指向内存块的开头 对导出对象的新引用 该引用归使用者所有并由 自动递减并设置为 该字段等于任何标 准 函数的返回值 作为一种特殊情况对于由 或 包装的 缓冲区此字段为 通常导出对象不得使用此方案 对于连续数组这是基础内存块的长度 对于非连续数组如果逻辑结构复制到连续表示形式则该长度将具有 该长度 仅当缓冲区是通过保证连续性的请求获取时才访问 时才有效 在大多数情况下此类请求将 为 或 缓冲区是否为只读的指示器 此字段由 标志控制 单个元素的项大小以字节为单位 与 调用非 的值相同 重要例外如果使用者请求的缓冲区没有 标志 将设置为 但 仍具有原始格式的值 如果 存在则相等的 仍然存在使用者可以使用 来导航缓冲区 如果 是 因为结果为 或 请求则使用者必须忽略 并假设 在 模块样式语法中 字符串描述单个项的内容 如果 这是 则假定为 无符号字节 此字段由 标志控制 形状数组中的值被限定在 这一情形需要特别注意 更多信息请参阅 数组对于使用者来说是只读的 步幅数组中的值可以为任何整数 对于常规数组步幅通常为正 数但是使用者必须能够处理 的情况 更多信息请 参阅 数组对用户来说是只读的 中使用了这种类型的数组表达方式 请 参阅 来了解如何从这样一个数组中访问元素 数组对于使用者来说是只读的 形状步幅子偏移量 请求 形状 步幅 子偏移量 是 是 如果需要的话 是 是 是 连续性的请求 请求 形状 步幅 子偏移量 邻接 是 是 是 是 是 是 或 是 复合请求 所有可能的请求都由上一节中某些标志的组合完全定义 为方便起见缓冲区协议提供常用的组合作为单个标志 请求 形状 步幅 子偏移量 邻接 只读 格式 是 是 如果需要的话 是 是 是 如果需要的话 或 是 是 是 是 是 是 或 是 是 是 是 是 或 是 是 或 复杂数组 风格形状和步幅 风格形状步幅和子偏移量 缓冲区相关函数 新版功能 如果此函数用作 的一部分则 必须设置为导出 对象并且必须在未修改的情况下传递 否则 必须是 文件对象 这此 是对内置文件对象的 的最小仿真它过去依赖于 标准库的缓冲 支持 在 中文件和流使用新的 模块该模块在操作系统的低层级无缓冲 之上定义了几个层 下面所描述的函数是针对这些新 的便捷 包装器主要用于解释器的内部错误报告建议第三方代码改为访问 根据已打开文件 的文件描述符创建一个 文件对象 参数 和 可以为 表示使用默 认值 可以为 表示使用默认值 会被忽略仅保 留用于向下兼容 失败时返回 有关参数的更全面描述请参阅 函数的文档 警告 由于 流具有自己的缓冲层因此将它们与 级文件描述符混合会 产生各种问题例如数据的意外排序 在 版更改 忽略 属性 将与 关联的文件描述器返回为 如果对象是整数则返回其值 如果没有则调用对象的 方法如果存在 该方法必须返 回一个整数该整数作为文件描述器值返回 设置异常并在失败时返回 等价于 这个函数从对象 中读取一行 可以 是文件对象或具有 方法的任何对象 如果 是 则 无论该行的长度如何都会读取一行 如果 大于 则从文件中读 取不超过 个字节可以返回行的一部分 在这两种情况下如果立即 到达文件末尾则返回空字符串 但是如果 小于 则无论长度 如何都会读取一行但是如果立即到达文件末尾则引发 重载 的正常行为将其形参通过所提供的处理程序来传 递 处理程序是一个类型为 的函数其中 确保为 指针会被传入钩子函数 因于钩子函数可能由不同的运行时调 用该指针不应直接指向 状态 鉴于这个钩子专门在导入期间使用的请避免在新模块执行期间进行导入操 作除非已知它们为冻结状态或者是在 中可用 一旦钩子被设定它就不能被移除或替换之后对 的调用也将失败如果解释器已经被初始化 函数将返回 并设置一个异常 此函数可以安全地在 之前调用 引发一个 审计事件 不附带任何参数 新版功能 将对象 写入文件对象 唯一支持的标志是 如果给定则写入对象的 而不是 成 功时返回 失败时返回 将设置适当的例外 将字符串 写入文件对象 成功返回 失败返回 将设定 相应的异常 请参阅 初始化配置 在 初始化之前 在初始化 之前可以安全地调用以下函数 配置函数 信息函数 工具 内存分配器 注解 以下函数 不应该 在 和 前调用 全局配置变量 注解 新版功能 新版功能 在 版更改 注解 新版功能 在 版更改 注解 非 创建的线程 锁对象 高阶 在 版更改 在 版更改 在 版更改 在 版更改 注解 注解 新版功能 在 版更改 在 版更改 新版功能 新版功能 新版功能 新版功能 新版功能 新版功能 在 版更改 新版功能 新版功能 在 版更改 注解 在 版更改 版后已移除 注解 在 版更改 版后已移除 错误和警告 异步通知 警告 在 版更改 新版功能 分析和跟踪 的值 的含义 总是 返回的异常信息 总是 正在调用函数对象 正在调用函数对象 正在调用函数对象 总是 高级调试器支持 注解 新版功能 参见 注解 方法 版后已移除 注解 由于上面提到的兼容性问题不应在新代码中使用此版本的 迭代器协议 迭代器有两个函数 返回 如果对象 支持迭代器协议的话 返回迭代 的下一个值 对象必须是一个迭代器这应由调用者来判断 如果没有余下的值则返回 并且不设置异常 如果在获取条 目时发生了错误则返回 并且传递异常 要为迭代器编写一个一个循环 代码应该看起来像这样 版权 与这份文档版权所有 软件基金会 保留所有权利 版权所有 保留所有权利 版权所有 保留所有权利 版权所有 保留所有权利 有关完整的许可证和许可信息参见 历史和许可证 有什么新变化 发布版本 日期 十一月 编者 本文介绍了 相比 的新特性 发布于 年 月 日 完整的详情可参阅 更新日志 参见 发布计划 摘要 发布重点 你应该在你的代码中检查 在 仍受支持的时候有许多旧功能在 中被保留以维持对 的向下兼容 随着对 支持的结束这些向下兼容层已经被移除或即将被移除 它们中的大部分都持续多年引发 警告 例如使用 而不是 自 年发布的 开始即会引发 请使用 命令行选项测试你的应用程序来查看 和 甚至可以使用 将它们视为错误 可以使用 警告过滤器 来忽略来自第三方代码的警告 是最后一个提供这些 向下兼容层的版本以给予 项目维护者更多时间来组织移除 支持并添加 支持 模块中 抽象基类 的别名例如 的别名 会为向下兼容最后保留一个发行版 它们将在 中被移除 更一般地说请尝试在 开发模式 下运行你的测试这可以帮助你的代码兼容以后的 版本 注有许多之前存在的弃用也在此 版本中被移除 具体请参阅 移除一节 新的特性 字典合并与更新运算符 合并 与更新 运算符已被加入内置的 类 它们为现有的 和 字典合并方法提供了补充 示例 请参阅 了解详情 由 在 中贡献 新增用于移除前缀和后缀的字符串方法 增加了 和 用于方便地从字符串移除不需要的前缀或后缀 也增加了 以及 的对应方法 请参阅 了解详情 由 在 中贡献 标准多项集中的类型标注泛型 新的解析器 使用于基于 的新解析器替代 新解析器的性能与旧解析器大致相当但 在设计新语言特性时的形式化比 更灵活 我们将在 及之后版本中开始使用这种灵活性 模块会使用新解析器并会生成与旧解析器一致的 在 中旧解析器将被移除依赖于它的所有功能也将被移除主要是 模块它早已被弃用 只有 在 中你可以使用命令行开关 或环境变量 切换回 解析器 请参阅 了解详情 由 和 在 中贡献 其他语言特性修改 现在会引发 而不是 后者曾 经会在相对导入超出其最高层级包时发生 由 在 中贡献 现在会获取命令行中指定的脚本文件名 例如 的绝对路径 模块的 属性将是一个绝 对路径而不是相对路径 现在此路径在当前目录通过 被改 变后仍将保持有效 作为附带效果回溯信息也将在此情况下为 模块帧显示绝对路径 由 在 中贡献 在 开发模式 以及调试编译版本中现在会针对字符串编码和解码操 作检查 和 参数 例如 和 默认设置下为保证性能 参数只会在第一次发生编码解码错误时 被检查并且对于空字符串 参数有时会被忽略 由 在 中贡献 对于所有非零的 都将返回 而不是空字符 串 现在此方法会与 保持一致 对于 和 对象也有类似的修改 由 在 中贡献 任何有效的表达式现在都可被用作 在之前版本中相关语法 则更为严格 请参阅 了解详情 由 在 中贡献 改进了 模块的帮助信息 现在将为所有特殊形式和特殊通用别名 例如 和 显示文档字符串 使用 时传入通用别 名例如 将显示对应实体类型 这里对应的是 的帮助信 息 由 在 中贡献 的并行运行现在已被禁止且 现在会反映异步生成器的实际运行状态 由 在 中贡献 调用 方法时发生的非预期错误不会再被 运算符以及 的 和 中的 所掩盖 由 在 中贡献 新增模块 模块为标准库引入了 时区数据库 它添加了 这是一个基于系统时区数据的实体 实现 示例 作为不包含 数据库的平台的一个回退数据源还以第一方软件包的形式发布了 模块 通过 发行并由 核心团队维护 参见 在标准库中支持 时区数据库 由 撰写并实现 添加了新的 模块其中包含 类来提供图的拓扑排序功能 由 和 在 中贡献 改进的模块 将 选项添加到 这允许它产生多行缩进的输出 由 在 中贡献 添加了 作为 模块中的一个函数它可被用来反解析 对象并产生相应的代码字符串当它被解析时将会产生一个等价的 对象 由 和 在 中贡献 为 节点添加了文档字符串其中包含 签名可被用来构造对应的节点 由 在 中贡献 为重复的 文件添加了使用硬软件的可能性 形参以及 命令行选项 由 在 中贡献 新增了一些用于在结果 文件中操纵路径的选项 形参以及 命令行选项 并使得为优化等级多次指定选项成为可能 由 在 中贡献 将新的 形参添加到 可以取消尚未开始运行的所有挂起的 而不必等待它们完成运行再关闭执行器 由 在 中贡献 从 和 中移除了守护线程 这改善与与子解释器的兼容性及它们在关闭进程时的可预测性 由 在 中贡献 现在 中的工作进程仅会在没有可重用的空闲工作进程时按需产生 这优化了启动开销并减少了由空闲工作进程导致的 时间损失 由 在 中贡献 增加了 以及 函数 由 在 中贡献 的 以及 的 等方法现在将返回 而不是 由 在 中贡献 命令现在会创建 和 哈希摘要 它会在禁用 摘要的平台上跳过 由 在 中贡献 增加了 和 等常量 由 在 中贡献 现在 和 当它们的构造器所给定的超时参数为零以防止创建非阻塞套接字时会引发 由 在 中贡献 当垃圾回收器进行某些复活对象的收集时在终结器被执行之后这些对象可以在隔离周期之外被访问不会阻止对所有仍然无法访问的对象的收集 由 和 在 中贡献 增加了一个新的函数 用来检测一个对象是否已被垃圾回收器所终结 由 在 中贡献 添加 状态码 和 到 由 在 以及 在 中贡献 与 添加了切换光标闪烁停止的选项 由 在 中贡献 键现在会关闭 补全提示窗口 由 在 中贡献 添加关键字到模块名称补全列表 由 在 中贡献 上述修改已被反向移植到 维护发行版中 现在 和 的构造器具有可选的 形参 并且现在 方法也具有可选的 形参提供同样的修改 和 中被重载的方法也应用了这个修改 由 在 中贡献 增加了 会释放关联到选定邮箱的服务器资源并将服务器返回到已认证状态 此命令会执行与 相同的动作区别在于它不会从当前选定邮箱中永久性地移除消息 由 在 中贡献 为提升与 语句的一致性现在 对于无效的相对导入尝试会引发 而不是 由 在 中贡献 发布不可变模块对象的导入加载器除了发布单独模块以外现在也可以发布不可变包 由 在 中贡献 添加了带有对包数据中子目录支持的 函数与 版的反向端口相匹配 由 在 中贡献 来自 版的已更新 已从 改为常规字典 由 在 和 中贡献 现在支持 作用域地址即带有 前缀的 地址 作用域地址可使用 来解析 作用域的区 如果存在可通过 属性来获取 由 在 中贡献 对 函数进行了扩展以处理多个参数 在之前版本中它只支持两个参数 由 在 中贡献 增加了 返回指定参数的最小公倍数 由 和 在 和 中贡献 增加了 返回从 往 方向的下一个浮点数值 由 在 中贡献 增加了 返回一个浮点数的最小有效比特位 由 在 中贡献 类新增了 方法用来显式地关闭队列 由 在 中贡献 现在 和 当它们的构造器所给定的超时参数为零以防止创建非阻塞套接字时会引发 由 在 中贡献 增加了 和 作为 由 在 中贡献 对外公开了 专属的 和 用于文件描述符的进程管理 现在 函数在 上也已可用 由 在 中贡献 现在 和 函数将总是可用 由 在 中贡献 增加了 函数将等待状态转换为退出码 由 在 中贡献 在 上 现在支持 由 和 在 中贡献 现在 和 当它们的构造器所给定的超时参数为零以防止创建非阻塞套接字时会引发 由 在 中贡献 现在 能美化打印 由 在 中贡献 文档字符串的显示现在不仅针对类 函数 方法等也针对任何具有自己的 属性的对象 由 在 中贡献 增加了新的 方法生成随机字节串 由 在 中贡献 对外公开了 专属的 用于向使用文件描述符而非 的进程发送信号 现在 和 当它们的构造器所给定的超时参数为零以防止创建非阻塞套接字时会引发 由 在 中贡献 现在 构造器具有可选的 形参 由 在 中贡献 模块现在会在 或更高版本上导出 常量 由 和 在 中贡献 现在 模块会在支持的平台上支持 协议 由 在 上贡献 现在 模块具有 和 方法 由 和 在 中贡献 增加了新的 属性平台专属库目录的名称 它被用于构建标准库的路径以及已安装扩展模块的路径 它在大多数平台上等于 在 和 上它等于 位平台上的 由 和 在 中贡献 之前的版本中 在非交互模式时是带块缓冲的 现在 默认总是为行缓冲的 由 在 中贡献 增加了 用于将跟踪的内存块峰值大小设为当前大小以测量特定代码段的峰值 由 在 中贡献 引入了一种 类型以使用上下文专属的元数据来装饰现有类型并将新的 形参添加到 以在运行时访问元数据 由 和 贡献 数据库已更新到 版 由 所提供的激活脚本现在总是会使用 设置的值来一致地指明它们的自定义提示符 在之前版本中某些脚本会无条件地使用 而另一些脚本只在其恰好被设置时这是默认情况才会使用还有的脚本会改用 由 在 中贡献 当把 序列化为 文件时属性内部的空白字符现在将被保留 不同的行结束符不会再被正规化为 这是对于如何解读 规范 节的相关讨论的最终结果 由 在 中贡献 性能优化 优化了在推导式中为临时变量赋值的惯用方式 现在推导式中的 会与简单赋值语句 一样快速 例如 不同于 运算符这个惯用方式不会使变量泄露到外部作用域中 由 在 中贡献 优化了多线程应用中的信号处理 如果一个线程不是获得信号的主线程字 节码求值循环不会在每条字节码指令上被打断以检查无法被处理的挂起信号 只有主解释器的主线程能够处理信号 在之前版本中字节码求值循环会在每条指令上被打断直到主线程处理了信号 由 在 上贡献 在 上使用 优化了 模块 由 和 在 中贡献 对于匹配 的值执行速度现在加快了 倍 由 中贡献 多个 内置类型 现在通过使用 向量调用协议得到加速 由 和 在 中贡献 当另一集合远大于基础集合的情况下优化了 的性能 由 提议由 在 中贡献代码 的小对象分配器 现在允许至多一个空位可用于 立即重用而不必将其返回给 这可以防止简单循环中的多余消耗在每 次迭代中可以创建和销毁全新的空位 由 在 中贡 献 浮点数运算中的 现在会有更好的性能 并且此运算的 的消息也已更新 由 在 中贡献 使用 和 编解码器解码短 字符串现在会加快大约 由 在 中贡献 以下是对从 到 的提升提升情况的总结 以上结果是由以下变量访问基准测试脚本所生成的 该基准测试脚本以纳秒为单位显示时间 基准测试数据是在一块 处理器 运行从 获取的 位编译版本所得到的 弃用 移除 移植到 本节列出了先前描述的更改以及可能需要更改代码的其他错误修正 的变化 的变化 堆分配类型的实例例如使用 和类似 创建的实例 自 起会带有一个对其类型对象的引用 正如 的 中的改变 部分所述对于大部分情况来说这应当不会有任何副作 用但对于具有自定义 函数的类型来说则要确保所有堆分 配类型的自定义 函数可访问对象的类型 示例 如果你的遍历函数委托给了基类或其他类的 则要确保 只被访问一次 请注意应当只有堆类型可访问 中的类型 举例来说如果你的 函数包括以下内容 则要添加 参阅 和 了解更多信息 和 函数已被弃用 请改用 及其变化形式 详情参见 字节码的改变 添加了 操作码用于处理 语句 在之前 的版本中如果 异常被屏蔽则 语句将不能正常运 作 由 在 中贡献 操作码已被拆分为四个单独指令 用于富比较 用于 和 检测 用于 和 检测 用于检查 语句中的异常 由 在 中贡献 构建的改变 将 选项添加到 脚本平台专属库目录的 名称保存在新的 属性中 请参阅 属性了解详情 由 和 在 中贡献 特殊构建宏已被移除 由 在 中贡献 在非 平台上现在需要用 和 函数来构 建 由 在 中贡献 在非 平台上创建 安装器现在已不受官方支持 详情参见 当在 上用源代码编译 时 现在会链接到非系统的 和 框架如果它们被安装到 的话就如在 较旧的 发行版上的情况一样 如果通过使用 或 明确地配置了 则只会搜索 本身 默认行为仍然可以通过 和 来覆盖 由 在 中贡献 现在可以针对 进行编译 由 在 中贡献 现在当使用 时一些单独的测试会被跳过 这些测试显著增加了 任务的时间并且可能无助于提升最终可执行文件的优化程度 这样能使任务 加速大约 倍 运行完整的单元测试是很慢的 这个改变可能导致优化程 序稍差的构建因为将被执行的代码分支不够多 如果你愿意等待更缓慢的 构建则可以使用 来恢复旧版本的行为 我们不保证哪个 任务集能产生更快 的构建 关心此问题的用户应当自行运行相关基准测试因为结果可能取决 于具体环境 工作负载以及编译工具链 请参阅 和 了解详情 的改变 新的特性 添加了 用于通过类来关联一 个模块 和 用于获取模 块及其状态以及 和 用于允许一个方法访问其 定义所在的类 由 和 在 中贡献 增加了 函数获取帧代码 增加了 函数获取帧的下一个外部帧 由 在 中贡献 将 添加到受限的 由 在 中贡献 增加了 和 函数用于获取解释器 增加了 函数用于获取 线程状态的当前帧 增 加了 函数获取 线程状态的唯一标识符 由 在 中贡献 将新的公有 函数添加到 该函数可不带任 何参数调用一个 可调用对象 它是不带参数调用 可调用对 象最有效率的方式 由 在 中贡献 受限 中的改变如果定义了 宏 提供 和 作为常 规函数用于受限 在之前版本中是使用宏定义但这些宏不能与无法 访问 字段的受限 一同编译该 结构体在受限 中是不透明的 和 已成为常规不透明函数 以隐藏实现细节 由 在 和 中贡献 增加了 函数以协助将类型加入到模块中 由 在 中贡献 将 和 函数添加 到公有 以允许分别查询 对象当前是正在被追踪还是已经被垃圾 回收器所终结 由 在 中贡献 增加了 以获取函数类对象的用户友好的表示形 式 由 在 中修正 增加了 用于调用具有一个位置参数的对象由 在 中修正 移植到 现在需要有新的强制性形 参 由 在 中 贡献 扩展模块 的 和 等函 数在模块状态被请求但尚未被分配时将不会再被调用 这种情况出现在模块 被创建之后且模块被执行 函数 之前的时刻 更准确地说 这些函数在 大于 并且模块状态即 的返回值为 时将不会被调用 没有模块状态的扩展模块 不会受到影响 现在如果 是在子解释器内部被调用该函数会被排 入子解释器的调用日程而不是由主解释器调用 每个子解释器现在都拥有 它们自己的调用日程列表 由 在 中贡献 当 选项被使用 如果 设为 时将不 再使用 注册表来初始化 这会影响在 上嵌入 的操作 由 在 中贡献 全局变量 现在为常量并且指向一个字符 串常量 由 在 中贡献 现在 结构是不透明的 它只在内部 中定义 由 在 中贡献 以及 在 中被 标记为已弃用 它们自 起就已被 弃用 由 在 中贡献 函数会被一个自动记录当前函数名称的宏所替代除非已 定义了 宏 由 在 中贡献 协议现在要求调用者只传入字符串作为键名 请参阅 了解详情 多个宏和函数的实现细节现在已被隐藏 宏已被转换为函数 宏已成为 宏的别名而 宏已成为 宏的别名 它们 将不再直接访问 成员 现在总是会调用 在之前 版本中当受限的 未被使用时它会直接访问 成员 宏已被转换为函数该宏会直接访问 成员 宏已被转换为函数该宏会直接访问 成员 现在 总是被声明为不透明函数以隐藏实现细节 宏已被移除 该宏会直接访问 成员 详情请参阅 移除 的 和 宏已从 受限的 中被排除 由 在 中贡献 的 空位已被移除 它在 及之前的版 本中被用来将对象打印到文件 自 起它已被忽略并且不再使 用 由 在 中贡献 受限 中的改变如果定义了 宏 以下函数已从受限 中排除 由 在 中贡献 在受限 中从未使用的垃圾箱机制 已将下列函数和定义移至内部 构建专属 由 在 和 中贡献 移除了 钩子并移除了 宏该宏是 的一个别名 它们仅由内部 对 外公开 同样地移除了 类型 由 在 中贡献 从 移除了下列函数 请显式地调用 来清空所有自 由列表 由 和 在 和 中贡献 和 绑定 方法对象的自由列表已被移除 集合自由列表已在 中被移除 自由列表已在 中被 移除 移除了 函数 由 在 中贡献 移除了 它已被 所弃用并自 起不再可用 可以改用 函数 由 在 中贡献 清除了已定义但未实现的接口的头文件 被移除了公共 符号有 由 在 中贡献 有什么新变化 作者 和 概述 新开发流程 列表推导式 字符串的方法 其他核心变化 移植 扩展嵌入更改 使模块易于安装 模块 模块更改 新增模块 改进 删除和弃用的模块 致谢 作者感谢以下人士对本文的各种草稿提出建议 有什么新变化 作者 参见 简单生成器 参见 由 和 撰写 由 和 实现 从 压缩包导入模块 参见 从 压缩包导入模块 参见 由 撰写 由 和 实现 通用换行支持 参见 通用换行支持 由 撰写并实现 可以使用 重写为 参见 内置函数 由 撰写并实现 包 参见 系统 由 和 撰写 由 实现 布尔类型 参见 添加布尔类型 由 撰写并实现 参见 由 撰写并实现 的软件包索引和元数据 参见 的软件包索引和元数据 由 撰写并实现 逗号分隔文件 参见 文件 由 撰写并实现 参见 由 和 撰写和实现 扩展切片 其他语言特性修改 布尔类型 扩展切片 由 贡献 由 贡献 性能优化 新增改进和弃用的模块 由 贡献 由 贡献 由 贡献 类型 模块 有关更多详细信息请参见模块的文档 参见 构建和 的改变 移植到 致谢 作者感谢以下人员为本文的各种草案提供建议更正和帮助 有什么新变化 编者 参见 发布计划 摘要 发布重点 新的语法特性 使用 和 语法实现协程 新的矩阵乘法运算符 新的库模块 类型提示 改进 应用程序支持 新的内置特性 实现的改进 标准库中的重大改进 安全改进 改进 在 上使用 新的特性 使用 和 语法实现协程 将输出 注解 在 版更改 异步迭代器 参见 使用 和 语法实现协程 由 撰写并实现 用于矩阵乘法的专用中缀运算符 矩阵乘法在数学科学工程学的许多领域中是一种常见的操作使用 运算符可以编写更简洁的代码 代替 支持新的运算符 参见 用于矩阵乘法的专用中缀运算符 由 撰写由 实现 表达式列表 字典显示 参见 由 撰写 由 和 实现 例如 参见 由 撰写 由 和 实 现 类型提示 参见 模块文档 类型提示 由 和 撰写 由 实现 类型提示理论 由 撰写 参见 由 在 的帮助下撰写并实现 和 和 模块的功能 函数 特例 和 现在会忽略 错误 不重试系 统调用请参阅 了解基本原理 函数 类的方法 除了非阻塞套接字 和 参见 参见 用于测试近似相等的函数 由 撰写由 和 实现 参见 由 撰写并实现 参见 由 撰写并实现 参见 由 和 撰写由 实现 其他语言特性修改 对 语言核心进行的小改动 新增模块 参见 改进的模块 中的更新 中的更新 由 在 中贡献 示例 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 与 由 在 中贡献 由 和 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 和 在 中贡献 由 和 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 例如 其他模块级更改 性能优化 构建和 的改变 增加了 函数 贡献于 新的 帮助函数 替代 替代 由 在 中贡献 弃用 新关键字 已弃用的 行为 不支持的操作系统 已弃用的 模块 函数和方法 移除 与特性的移除 移植到 本节列出了先前描述的更改以及可能需要更改代码的其他错误修正 行为的改变 由于一个疏忽之前的 版本会错误地接受以下语法 改变了的 中的改变 协 程对象 的显著变化 由 在 中贡献 新版功能 由 在 中贡献 在 版更改 有什么新变化 编者 本文解释了 相比 的新增特性 于 年 月 日发布 完整的详情可参阅 更新日志 摘要 发布重点 新的语法特性 类型标注延迟求值 向后不兼容的语法更改 和 现在是保留的关键字 新的库模块 上下文变量 数据类 新的内置特性 新的 函数 对 数据模型的改进 自定义可访问的模块属性 模块和泛型类型的核心支持 对象会保持插入时的顺序这个特性 正式宣布 成为 语言官方规 范的一部分 标准库中的重大改进 模块添加了新的功能重大改进请参阅 可用性与性能提升 模块现在提供 纳秒级精度函数 的支持 实现的改进 避免使用 作为默认的文本编码 传统 区域强制转换 强制 运行时模式 确定性的 文件 新的 开发模式 改进的 处理 的改进 用于线程本地存储的新 文档的改进 文档翻译 新的文档翻译 和 此版本在诸多方面有显著的性能改进 性能优化 章节详细列出了它们 和之前的 版本存在兼容性的更改列表请参阅 移植到 章节 新的特性 延迟的标注求值 随着 加入标注功能并在 进一步细化 中类型提示的出现揭示了两个明显的可用性问题 标注只能使用在当前作用域中已经存在的名称也就是说它们不支持任何形 式的前向引用而且 标注源码对 程序的启动时间有不利的影响 这两个问题都可以通过延迟标注求值来解决 在定义标注的时候编译器并不会编译执行相应表达式的代码而是保存与相应表达式的 等价的字符串形式 如果有需要标注可以在运行时使用 进行解析 在不需要这种解析的通常情况下标注的存储成本更低因为解析器只需处理较短的字符串且启动时间更短 在可用性方面标注现在支持向前引用以使以下句法有效 由于此修改会破坏兼容性在 中此种新的行为需要在每个模块层级上使用 导入来启用 它将在 中成为默认行为 参见 延迟的标注求值 由 撰写并实现 传统 区域强制转换 系列有一个持续的挑战就是为处理 比特位 文本的假定编码确定合理的默认策略目前的设定是在非 平台上使用默认的 或 区域设置 更新了默认的解释器命令行接口以自动将上述区域强制转换为可用的基于 的区域具体描述可参见有关新增环境变量 的文档 以这种方式自动设置 意味着核心解释器和能感知区域的 扩展 例如 都将会假定 已被用作默认的文本编码而不再是 中的平台支持定义也已被更新以限制完整文本处理支持适当配置的基于非 的语言区域 作为此更改的一部分当使用任何已定义的强制转换目标区域时 目前为 和 和 默认的处理器现在将为 而不是 而无论是什么区域 默认的处理器仍为 默认情况下区域强制转换会静默进行但为了辅助调试潜在的区域相关集成问题可以通过设置 来请求显式地启用警告信息直接在 上发出 此设置还会使得 运行时在核心解释器初始化时如果传统 区域仍然处于激活状态时发出警告 虽然 的区域强制转换的好处在于它还会同时影响扩展模块 例如 以及子进程 包括运行非 应用和旧版本 的子进程但它也存在需要所运行系统必须存在适合的目标区域的缺点 为了更好地处理没有可用适合的目标区域的情况 例如在 上就会出现此情况 还实现了 强制 运行时模式 参见 强制转换传统 区域到基于 的区域 由 撰写并实现 强制 运行时模式 新的 命令行选项和 环境变量可被用来启用 的 模式 当处于 模式时 会忽略区域设置并默认使用 编码 用于 和 流的错误处理器将设置为 强制 模式可被用来在嵌入的 解释器中改变文本处理行为而不会改变嵌入方应用的区域设置 的 模式的好处是不必关心运行所在系统中有哪些可用区域即可工作但它也存在对扩展模块 例如 运行非 应用的子进程以及运行旧版本 的子进程不起作用的缺点 为了减小与这些组件通信时破坏文本数据的风险 还实现了 强制 运行时模式 模式在语言区域为 或 并且 区域强制转换特性无法将其修改为某种基于 的替代项时会被默认启用无论修改失败是由于设置了 还是由于缺少适合的目标区域 参见 增加了新的 模式 由 撰写并实现 内置的 包含了新的内置 函数作为一种简单方便地进入 调试器的方式 内置 会调用 在默认情况下后者会导入 然后再调用 但是通过将 绑定到你选定的函数 可以进入任何调试器 此外环境变量 可被设置为你选定的调试器的可调用对象 设置 会完全禁用内置 参见 内置的 由 撰写并实现 用于线程局部存储的新 虽然 已提供了用于线程局部存储支持的 但原有的 线程局部存储 使用 来表示所有平台上的 密钥 对于官方支持的平台而言这通常不是问题但这既不符合 标准也不具备任何实际意义上的可移植性 通过向 提供了一个新的 线程特定存储 来改变这一点它取代了原有的 内部 的使用并且原有 已弃用 使用一种新类型 而非 来表示 密钥 这是一种不透明类型其定义可能依赖于下层的 实现 因此这将允许在以无法安全地转换为 的方式定义原生 密钥的平台上构建 请注意在原生 密钥定义方式无法被安全地转换为 的平台上原有 中的全部函数将无法执行并会立即返回失败信息 这样能清楚地表明原有 在无法可靠使用的平台上不受支持并且不会再尝试添加此类支持 参见 在 中用于线程局部存储的新 由 撰写由 实现 定制对模块属性的访问 允许在模块上定义 并且当以其他方式找不到某个模块属性时将会调用它 在模块上定义 现在也是允许的 一个典型的可能有用的例子是已弃用模块属性和惰性加载 参见 模块的 和 由 撰写并实现 具有纳秒级精度的新时间函数 现代系统的时钟精度可以超过由 函数及其变化形式所返回的浮点数的有限精度 为了避免精度损失 在 模块中增加了原有计时器函数的六个新纳秒版变化形式 这些新函数会以整数值的形式返回纳秒数 测量 表明在 和 上 的精度大约比 要高 倍 参见 增加具有纳秒级精度的新时间函数 由 撰写并实现 在 中显示 对 模块和泛型类型的核心支持 最初的设计方式使其不会向核心 解释器引入 任何 更改 现在类型提示和 模块已被社区广泛使用因此这个限制已被取消 这个 引入了两个特殊方法 和 这些方法现在被 中的大多数类和特殊构造所使用 结果就是与类型相关的各类操作的速度提升了 倍泛型类型可以在没有元类冲突的情况下被使用而 模块中几个长期存在的错误也已被修正 参见 对 模块和泛型类型的核心支持 由 撰写并实现 基于哈希值的 文件 文档翻译 描述了创建和维护 文档翻译的整个过程 新增了三个新的翻译版本 日语 法语 韩语 参见 文档翻译 由 和 撰写并实现 开发模式 新的 命令行选项或新的 环境变量可被用来启用 开发模式 在开发模式下 将执行额外的如果默认启用会导致开销过大的运行时检查 请参阅 开发模式 文档查看完整说明 其他语言特性修改 表达式和包含 子句的推导式不允许在 格式化字符串字 面值 的表达式中使用 在 中此限制已被取消 现在可以将超过 个参数传递给一个函数而现在一个函数也可以拥有超 过 个形参 由 在 和 中贡 献 现在 和 会忽略所有 空 白符而非仅是空格符 由 在 中贡献 和 获得了对新 方法的支持该 方法可被用来测试是个字符串或字节串是否仅包含 字符 由 在 中贡献 现在当 失败时 会显示模块名称和模 块 路径 由 在 中贡献 现在已支持涉及将子模块绑定到一个名称的绝对导入的循环导入 由 在 中贡献 现在 等价于 而非 由 中贡献 为更好地支持栈跟踪的动态创建现在 可以从 代码中被实例化并且 回溯对象 的 属性现在是可写的 由 在 中贡献 当使用 开关时现在 会主动扩展为完整的起始目录路 径而不是保持为空目录这将允许在发生导入时从 当前 工作目录导入 由 在 中贡献 新的 选项或 环境变量可被 用来显示每次模块导入的时间 由 在 中贡献 新增模块 新的 模块和一组 新的 引入了对 上下文变量 的支持 上下文变量在概念上类似于线程局部变量 与 不同上下文变量能正确地支持异步代码 和 已得到更新以使用和支持开箱即用的上下文变量 特别是激活的 上下文现在将存储在上下文变量中它允许十进制运算在异步代码中使用正确的上下文 参见 上下文变量 由 撰写并实现 新的 装饰器提供了一种声明 数据类 的方式 数据类使用变量标注来描述其属性 它的构造器和其他魔术方法例如 以及 会自动地生成 示例 参见 数据类 由 撰写并实现 新的 模块提供了一些新的 和一个新的 用于访问 打开和读取包内的 资源 资源基本上类似于包内的文件但它们不一定是物理文件系统中实际的文件 模块加载器可以提供 函数它会返回一个 实例来支持这个新 内置的文件路径加载器和 文件加载器都支持此特性 由 和 在 中贡献 参见 用于先前 版本的 下层接口 改进的模块 新的 方法允许混合选项与位置参数 由 在 中提供 模块获得了许多新的特性 可用性和 性能提升 重要的改变包括 新的 暂定 函数可被用于通过自动创建和销毁事件循环来 基于同步代码运行协程 由 在 中贡献 增加支持 并且 具有新的可选仅关键字参数 现在 会自动跟踪其上下文 详情参见 由 在 中贡献 增加了新的 函数作为 的快捷方式 由 在 中贡献 新的 方法可用于升级现有的 连接 由 在 中贡献 新的 方法允许直接从套接字读取数据放入所提供 的缓冲区从而可以减少数据复制 由 在 中 贡献 新的 函数可返回当前运行的 实例以及 新的 函数可返回给定循环中所有现存 实例 的集合 和 方法已弃用 由 在 中贡献 新的 暂定 类允许通过手动控制接收缓冲区来实现流 式协议 由 在 中贡献 新的 函数可返回当前运行的循环如果没有 循环在运行则引发 这与 不 同后者在没有循环在运行时将 创建 一个新的事件循环 由 在 中提供 新的 协程方法允许执行等待直到流写入器被 关闭 新的 方法可用于确定写入器是否被关 闭 由 在 中贡献 新的 协程方法允许在可能的情况下使用 发送文件 由 在 中贡献 新的 和 方法会返回创建 或 对象的事件循环的实例 允许为 对象执行同样操作 由 在 中以及由 在 中贡献 现在可以控制 的实例如何开启服务 之前服务在创建 后将立即开启服务 新的 关键字参数已添加到 和 并且 和 可被用来分离服 务的实例化和服务的开启 新的 方法会在服务开启 时返回 现在 对象已是异步上下文管理器 由 在 中贡献 由 所返回的回调对象已获得新的 方法该 方法会返回一个排入计划日程的绝对时间戳 由 在 中贡献 方法已获得对 套接字的支持 由 在 中贡献 方法及其对应的 套接字变体现在接 受 关键字参数 由 在 中贡献 新的 方法会在回调被取消时返回 由 在 中贡献 源已被转换为使用 语法 由 在 中贡献 新的 方法可用于确定传输的读取状态 此 外对 和 的调用现在是幂等的 由 在 中贡献 接受套接字路径的循环方法现在支持传入 路径类对象 由 在 中贡献 在 中 上的 套接字现在创建时默认带有 旗标设置 由 和 在 中贡献 在被取消任务中发生的异常不会再被记录 由 在 中贡献 新的 和 类 由 在 中贡献 部分 改为 已弃用 函数现在接受可选的 关键字参数 当其为真值时零会以 而非空格来表示 由 在 中贡献 类具有新的类属性可以简化所生成 日历中 类的自定义 由 在 中贡献 现在支持默认值 由 在 中贡献 增加了新的 形参可用于启用 基于哈希值的 有效性检测 失效模式也可以在命令行中使用新的 参数来指定 由 在 中贡献 和 现在支持新的 初始化器以及 构造器参数 由 在 中贡献 现在能通过新的 参数来接受多进程上下文 由 在 中贡献 新的 是一个比 更简单和快速的无操作上下文管理器 由 在 中贡献 增加了新的 和 以补充它们所对应的同步项 由 在 和 中以及由 和 在 中贡献 命令行现在接受 作为脚本路径的替代 由 在 中贡献 模块现在支持 哈希方法 由 在 中贡献 函数现在允许指定哈希操作的轮数 由 在 中贡献 新的 方法会基于由 所输出的某一特定格式字符串构建 对象 由 在 中贡献 类现在支持小于一分钟的偏移量 由 在 中贡献 现在支持读取只读文件并且在其未改变时不再写入索引文件 模块现在使用 上下文变量 来储存十进制值上下文 由 在 中贡献 函数现在能够反汇编嵌套的代码对象推导式 生成器表达式和嵌套函数的代码以及用于构建嵌套类的代码 反汇编递归的最大深度由新的 形参来控制 由 在 中贡献 现在包含在 的标准 列表之中因而也包含在源码发布之中 由 在 中贡献 现在支持使用类型标注来注册实现 由 在 中贡献 新的 函数允许冻结由垃圾回收器所跟踪的所有对象并将它们从未来的集合中排除 这可以在 调用之前使用以令 友好地进行写入时复制或加速收集 新的 函数会反转此操作 此外 可被用于获取冻结对象的数量 由 在 中贡献 现在具有经优化的一次性 函数其速度比 要快三倍 由 在 中贡献 和 现在支持新的 参数以提升上传吞吐量 由 在 中贡献 现在支持 标头 如果目标文件在该标点指定的时间之后未被修改则服务器会返回 响应状态 由 在 中贡献 接受新的 参数并增加了新的 命令行参数 通过此形参服务器可以对服务指定目录默认情况下它使用当前工作目录 由 和 在 中贡献 新的 类使用线程来处理使用 的请求 它会在 附带 运行时被使用 由 在 中贡献 与 多个对自动补全的修正 由 在 中贡献 在 菜单中之前称为 现在会在最高层级函数和类之外显示嵌套的函数和类 由 和 在 中贡献 对话框 中的 已经被部分重写以改进外观和功能 由 和 在多个问题项中贡献 字体样本现在包括一组非拉丁字符以便用户能更好地查看所选特定字体的效果 由 在 中贡献 样本可以被修改以包括其他字符 由 在 中贡献 之前以扩展形式实现的 特性已作为正常特性重新实现 它们的设置已从 选项卡移至其他对话框选项卡 由 和 在 中实现 编辑器代码上下文选项已经过修改 会显示所有上下文行直到最大行数 点击一个上下文行会使编辑器跳转到该行 自定义主题的上下文颜色已添加到 对话框的 选项卡 由 和 在 和 中贡献 在 上会有新的 调用将 对 的调整告知 在 或 上如果 二进制码的 兼容属性未改变并且监视器分辨率大于 这应该会令文本和线条更清晰 否则的话它应该不造成影响 由 在 中贡献 在 中新增超过 行默认值为 的输出将被折叠为一个按钮 可以在 对话框的 页的 部分中进行修改 数量较少但是超长的行可以通过在输出上右击来折叠 被折叠的输出可通过双击按钮来展开或是通过右击按钮来放入剪贴板或是单独的窗口 由 在 中贡献 上述修改已被反向移植到 维护发行版中 在 中新增在 菜单中增加了 以使用自定义设置来运行模块 输入的任何命令行参数都会被加入 它们在下次自定义运行时会再次显示在窗体中 用户也可以禁用通常的 主模块重启 由 等人在 和 中贡献 在 中新增在 编辑器窗口中增加了可选的行序号 窗口打开时默认不带行序号除非在配置对话框的 选项卡中进行设置 已打开窗口中的行序号可以在 菜单中显示和隐藏 由 和 在 中贡献 新的 方法可用于根据新的设置重新配置文本流 由 在 以及 在 中贡献 和 中新的 以及 方法可用于网络包含测试 由 和 在 中贡献 现在接受 类整数对象 作为 和 参数 由 在 中贡献 中新的 参数可用于转换所使用的千位分隔符和分组字符串 由 在 中贡献 现在 函数在 上或是在 强制 模式 下总是返回 实例现在可以被 由 在 中贡献 新的 方法可用于在句柄创建之后替换日志流 由 在 中创建 现在可以在传递给 的配置信息中对句柄构造器指定关键字参数 由 在 中贡献 新的 函数实现了 风格的余数运算 由 在 中贡献 新的 方法可用于关闭 数据库 由 在 中贡献 新的 方法会显式地关闭进程对象并释放与其关联的所有资源 如果底层进程仍在运行则将引发 由 在 中贡献 新的 方法可用于在 上使用 信号来终止进程 由 在 中贡献 由 所创建的非守护线程现在会在进程退出时被合并 由 在 中贡献 现在接受 类型的 参数 由 在 中贡献 已获得对 文件描述器 的支持 由 在 中贡献 新的 函数允许注册 回调以便在进程分叉中执行 由 在 中贡献 增加了 结合了 与 的功能 以及 函数 结合了 和 的功能 由 在 中贡献 的 参数不再影响新创建的中间层级目录的文件权限 由 在 中贡献 现在会返回新的文件描述器 之前返回的总是 由 在 中贡献 在 及其派生系统上 所返回的结构现在会包含 属性 由 在 中贡献 在 类系统上新的 方法现在可用于确定一个路径是否为挂载点 由 在 中贡献 现在接受一个可选的限关键字参数 如果给出它会在调试开始之前被打印到控制台 由 在 中贡献 命令行现在接受 作为对脚本文件的替代 由 在 中贡献 及其扩展形式 现在会通过无条件地为基于哈希值的有效性验证创建 文件来支持 环境变量 这样可以确保当 文件被主动创建时 可重现的生成 由 在 中贡献 服务器现在可以绑定到由新的 命令行参数所指定的任意主机名 由 在 中贡献 新的 类是一个无界的 队列 由 在 中贡献 旗标 和 可以在组的范围内设置 由 在 中贡献 现在支持基于匹配一个空字符串的模式例如 或 进行拆分 由 在 中贡献 使用 旗标编译的正则表达式不再依赖于编译时的区域设置 区域设置仅在已编译正则表达式被使用时才被应用 由 在 中贡献 现在如果一个正则表达式包含语义将在未来发生改变的字符集构造则会引发 例如嵌套集与集合操作等 由 在 中贡献 已编译正则表达式和匹配对象现在可以使用 和 进行拷贝 由 在 中贡献 函数新增的 参数可以指定当唤醒缓冲区溢出时 是否要在 上打印警告信息 由 在 中贡献 新增的 方法会在套接字处于阻塞模式时返回 否则返回 由 在 中贡献 新的 函数可关闭所传入的套接字文件描述符 应该用此函数来代替 以获得更好的跨平台兼容性 由 在 中贡献 模块现在会公开 以及 常量 由 在 以及 在 中贡献 已加入对 套接字的支持以允许在虚拟机及其宿主机之间进行通讯 由 在 中贡献 套接字现在默认会根据文件描述符自动检测所属族 类型和协议 由 在 中贡献 现在会等待所有非守护线程完成 现在会等待所有子进程完成 为 和 类增加了新的 类属性 该类属性值设为 以保持 之前的行为 现在当下层的 库版本为 及以上时 会开放 方法 由 在 中贡献 的 参数现在接受任何 而不是只接受字符串 由 在 中贡献 现在允许你有选择地分别修改带大括号的占位符和不带大括号的占位符所对应的正则表达式模式 由 在 中贡献 函数接受新的 关键字参数 当其为真值时将会捕获 和 这相当于将 作为 和 参数传入 由 在 中贡献 函数和 构造器现在接受 关键字参数作为 的别名 由 在 中贡献 在 中当重定向标准句柄时 的默认值由 改为 现在可以在重定向标准句柄时将 设为真值 参阅 这意味着现在 在所有受支持的平台上默认值均为 由 在 中贡献 在 期间或在 上下文管理器中 模块现在能更优雅地处理 它现在会等待一小段时间以便子进程退出然后再继续处理 异常 由 在 中贡献 新增 钩子函数供内置的 进行调用 由 在 中贡献 在 中新增的 会返回构建时的 版本 由 在 中贡献 新的 函数会返回当前协程的由新的 所设定的原始跟踪深度 已转换为使用这个新 代替已弃用的 由 在 中贡献 向 模块增加六个具有纳秒级精度的新函数 增加了新的时钟标识符 与 相似不同 点在于它还包括任何系统挂起的时间 和 高精度的分进程 计时器 该时间的绝对值是系统运行且未 挂起的时间提供准确的正常运行时间度量 新的 和 函数可用于获取每线程的 时间度量 由 在 中贡献 新的 函数会返回特定线程中 时钟的时钟 新的 类现已可用 由 在 中贡献 的行为更接近正规的回溯会对所有帧按从最旧到最新来排序 现在接受负的 并会将结果截短至排在第 位的旧帧 如果要获得旧的行为请在 中使用新的 参数 由 在 中贡献 新的 和 类现已可用 由 和 在 以及 在 中贡献 新的 函数会以 所规定的方式动态解析 条目 由 在 中贡献 内部的 数据库已升级为使用 由 贡献 新的 命令行选项允许通过名称子字符串或类似于 的模式来筛选测试项 例如 将运行 但不会运行 由 在 中贡献 现在 属性会在它们被 复制 或 封存 时保存其标识 由 在 中贡献 新的 函数允许 对实例进行密封这将禁止进一步创建属性模拟 密封会以递归方式应用于自身模拟的所有属性 由 在 中贡献 已经从 更新为 将 添加到默认情况下从未引用的字符集 由 和 在 中贡献 函数现在接受可选的 关键字参数 当其为真时零会以 而非空格来表示 由 在 中贡献 新的 属性会从平台中继有关是否使用多进程安全模式来生成所需 的信息 由 在 中贡献 现在更倾向于统一管理的 地址而不是本地管理的 地址 这样可以更好地保证从 返回的 的全局唯一性 如果只有本地管理的 地址可用则返回首个找到的此类地址 由 在 中贡献 方法中的 描述词现在可以将当前节点文本与 进行比较而不仅是子节点中的文本 描述词还允许添加空格以提高可读性 由 在 中贡献 现在可以被用作装饰器 由 在 中贡献 函数 现在接受可选的 参数以允许用户选择哪些文件应被加入归档包 由 在 中贡献 函数 现在接受可选的 参数以生成压缩归档包 另外也加入了命令行选项 以支持压缩 由 在 中贡献 现在接受新的 形参以控制压缩级别 由 在 中贡献 所创建的归档包中的子目录现在会按字母表顺序保存 由 在 中贡献 的改变 已实现了用于线程本地存储的新 相关概述请参阅 用于线程局部存储的新 完整参考文档请查看 由 在 中贡献 新的 上下文变量 功能开放了许多 新的 新的 函数会返回之前所导入的具有给定名称的模块 由 在 中贡献 新的 宏可以简化丰富比较函数的编写 由 在 中贡献 新的 宏可用于标记不可到达的代码路径 由 在 中贡献 现在通过新的 和 函数公开了一个 由 在 中贡献 新的 和 静态标记可用于跟踪模块导入 由 在 中贡献 结构体 和 的字段 和 现在的类型为 而不是 由 在 中贡献 和 的结果类型现在是 而非 由 在 中贡献 和 的结果现在肯定是列表而非可能是列表也可能是元组 由 在 中贡献 添加了函数 和 由 在 中贡献 已弃用建议改用新的 和 由 在 中贡献 曾经作为公共 一部分的 单例已被移除因为它的成员永远不会被清理可能在解释器的最终化过程中导致段错误 由 在 和 中贡献 添加 对使用 的构造器 和 的时区的支持以及通常 使用 单例 由 在 中贡献 和 的结果类型以及 的 参数类型由 改为 由 在 中贡献 现在 如果第二个参数为 并且 字符串包含空字符则会引发 由 在 中贡献 对启动顺序以及动态内存分配器管理的更改意味着早已记录在案的对在调用大多数 函数之前调用 的要求的依赖现在变得更加强烈未遵循此要求可能导致嵌入式应用程序中的段错误 请参阅此文档的 移植到 一节以及 文档的 在 初始化之前 一节了解更多细节 新的 会返回给定解释器的唯一 由 在 中贡献 现在当启用 模式 时 会使用 编码 由 在 中贡献 和 现在会为 错误句柄使用当前区域编码 由 在 中贡献 的 和 形参的行为现在调整为与字符串切片类似 由 在 中贡献 构建的改变 性能优化 其他 实现的改变 跟踪钩子现在可以选择不接收 而是选择从解释器接收 事件 具体做法是在被跟踪的帧上相应地设置新的 和 属性 由 在 中贡献 修复了一些命名空间包模块属性的一致性问题 命名空间模块对象的 被设置为 原先未设置对象的 也被设置为 之前为字符串 参见 而 且命名空间模块对象的 被设置的值与 相同 原先前者被设置为 参见 字典现在以变量定义的词法顺序显示 原先未定义顺序 由 在 中贡献 命令不会再试图将行结束字符 改为 这修 复了 的一个以与 等价的字节结束的数据损坏问题 由 在 中贡献 已弃用的 行为 在推导式和生成器表达式中的 语句包括 和 子句现在已弃用最左端的 子句中的可迭代对象表达式除外 这确保了推导式总是立即返回适当类型的容器而不是有可能返回 对象这样生成器表达式不会试图将它们的隐式输出与任何来自显式 表达式的输出交错起来 在 中这样的表达式会在编译时引发 在 中则将引发 由 在 中贡献 从 返回一个 的子类的行为已弃用并将在未来的 版本中引发错误 这使得 的行为与 和 保持一致 由 在 中贡献 已弃用的 模块 函数和方法 已弃用并将在 中被移除 请改用 由 在 中贡献 对 和其他 同步原语的 实例的直接支持已弃用 想要获取并释放同步资源必须使用异步上下文管理器 由 在 中贡献 和 方法已弃用 由 在 中贡献 在 中 内的抽象基类将不会再通过常规的 模块公开 这有助于更清晰地区别具体类与抽象基类 由 在 中贡献 现在支持读取只读文件且当其未被更改时不会再写入索引文件 现在如果索引文件丢失并在 与 模式下被重新创建则会发出已弃用警告在未来的 发布版中将改为错误 由 在 中贡献 使用非整数值在 中选择复数形式现在已弃用 它从未正确地发挥作用 由 在 中贡献 下列方法 被 替代 和 被 替代 都在 中已弃用现在会引发 由 在 中贡献 已弃用推荐改用 已弃用请改用 由 在 中贡献 现在已弃用将在 中被移除 由 在 中贡献 和 已弃用 构建禁用线程的 已不再可能 请改用 由 在 中贡献 和 中的静默参数截断已弃用 在未来的 版本中如果传入的参数长度大于 比特位将会引发异常 由 在 中贡献 已弃用 请改用 由 在 中贡献 已弃用并将在 中被移除 请改用 由 在 中贡献 已弃用 和 未写入文档的 函数已弃用并将在未来的 版本中被移除 由 在 中贡献 已弃用并将在 中被移除 请改用 由 在 中贡献 已弃用的 函数和类型 如果 未设定或设定为范围在 和 不含 之间或为 或更高的值函数 已弃用并被一个宏所替代 由 在 中贡献 已弃用 请改用 或 由 在 中贡献 平台支持的移除 与特性的移除 下列特性与 已从 中移除 函数已被移除 它在 中被引入用于 向下兼容 并自 起就已弃用 在 的替换模块中由 与一个 字母构成的未知转义在 中已弃用现在将会引发错误 在 中移除了对 参数的支持 它在 和 中已弃用 请改用 参数 模块中的 函数在 中已弃用现在已被 移除 请改用 函数 不再支持 形参或 属性 该属性会显示为具名元组类所生成的源代码 这是加速类创建的设计优化 的一部分 由 在 中贡献进一步的改进由 和 贡献 函数 和 不再接受关键字参数 的第一个参数现在只能作为位置参数传入 移除了之前在 中已弃用的 模块的类 和 作为函数 和 返回结果的 值现在为普通 你不能再 使用属性访问来获取这些字典的项 函数已被移除 请改用 函数它自 起就在所有平台上可用 在 及更新版本上只是 的别名 不再将 和 模块导出为 和 请将 替换为 现在已禁止直接实例化 和 对象 相应 构造器从未写入文档 也从未作为公有构造器进行测试或设计 用户应当使 用 或 由 在 中贡献 未被使用的 命令已被移除 由 在 中贡献 移除的模块 模块已被移除 它从未被默认启用从未在 上正确发挥效果并且它对 的改变会导致 扩展的意外损坏 由 在 中贡献 专属的改变 启动器 可以接受 位或 位标记而 不必 同时指定一个小版本 因此 和 与 均为有效并且现在还接受 和 来强制使用 位 命令即使是本应使用 位的时候 如果指定版本不可用则 将报错退出 由 在 中贡献 启动器可以运行 来列出已安装的所有 默认版本会以星号标出 运行 将同时列出相应的路径 如果运行 时指定了无法匹配的版本它将显示 简短形式 的可用版本列表 由 在 中贡献 移植到 本节列出了先前描述的更改以及可能需要更改代码的其他错误修正 行为的更改 更改的 中的改变 函数 被认为对于大小可变的序列来说并不安全 如果切片索引不是 的实例而是实现了 方法的对象则序列可以在其长度被传给 之后调整大小 这可能导致返回超出序列长度的索引号 为了避免可能的问题请使用新增的函数 和 由 在 中贡献 字节码的改变 新增了两个操作码 和 由 和 在 中贡献 操作码已被移除 由 在 中贡献 专属的改变 用于重载 的文件现在命名为 而不是 请参阅 查找模块 了解更多信息 由 在 中贡献 其他 实现的改变 为了准备在未来对公开的 运行时初始化 进行潜在更改请参阅 获取最初但略为过时的文稿 内部的启动和配置管理逻辑已经过大幅重构 虽然这些更新旨在对嵌入式应用程序和常规的 用户都完全透明但它们在这里被提及是因为重构会改变解释器启动期间许多操作的内部顺序因此可能提示出原先隐藏的缺陷这可能存在于嵌入式应用程序中或是在 自身内部 最初由 和 作为 的一部分贡献并由 和 在一系列其他问题报告中进一步更新 已知会受到影响的一些细节 目前对嵌入式应用程序不可用因为在调 用 之前需要创建 对象 请改用 嵌入式应用程序通过 所添加的警告过滤器现在应 该以更高的一致性优先于由解释器所设置的默认过滤器由于默认警告过滤器的配置方式发生了变化将 设置为大于一的值不再足以在发出 消息的同时将其转换为异常 而是改为必须设置旗标以便首先发出警告以及添加显式的 警告过滤器来将其转换为异常 由于编译器处理文档字符串的方式发生了变化一个仅由文档字符串构成的函数体中隐式的 现在被标记为在与文档字符串相同的行而不是在函数的标题行 当前异常状态已从帧对象移到协程对象 这会简化解释器并修正由于在进入或退出生成器时具有交换异常状态而导致的一些模糊错误 由 在 中贡献 中的重要变化 从 开始 现在始终会读取并遵循与 相同的环境设置在更早的 版本中它会遵循一个错误定义的环境变量子集而在 中则会由于 而完全不读取它们 如果不想要此行为请在调用 之前将 设为 在 中上下文变量的 已 获得更新 以使用 指针 另请参阅 在 中当提供不带末尾新行的输入时 模块现在会隐式地添加 形符 此行为现在已与 词法分析器的内部行为相匹配 由 在 中贡献 中的重要变化 在 中 下的 不再复制原来的二进制文件而是改为创建名为 和 的重定向脚本 这解决了一个长期存在的问题即所有虚拟环境在每次 升级后都必须进行升级或是重新创建 然而要注意此发布版仍然要求重新创建虚拟环境以获得新的脚本 中的重要变化 出于重要的安全性考量 的 形参不再被支持 这是由 中的套接字选项 的行为导致的 更多细节请参阅 的文档 由 和 在 中贡献 有什么新变化 本文介绍了 相比 的新增特性 于 年 月 日发布 有关完整详细信息请参见 参见 发布计划 摘要 发布重点 虚拟环境 参见 虚拟环境 由 撰写 由 和 实现 隐式命名空间包 参见 隐式命名空间包 由 撰写由 和 实现 新的内存视图实现和缓冲协议文档 相关特性 由 在 中贡献 参见 修改缓冲区协议 灵活的字符串表示 参见 灵活的字符串表示 由 撰写 由 和 实现 适用于 的 启动器 参见 适用于 的 启动器 由 和 撰写 由 实现 适用于 的 启动器 查找 可执行文件 重写 和 异常的层次结构 参见 重写 和 异常的层次结构 由 撰写并实现 委托给子生成器的语法 清除异常上下文 参见 清除异常上下文 由 撰写 由 和 实现 显式的 文本 参见 显式的 文本 由 撰写 类和函数的限定名称 参见 类和函数的限定名称 由 撰写并实现 参见 由 撰写并实现 函数签名对象 参见 函数签名对象 由 撰 写由 实现 添加 参见 添加 由 撰写并实现 其他语言特性修改 对 语言核心进行的小改动 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 贡献 由 在 中贡献 新增模块 由 和 在 中贡献 由 和 在 中贡献 改进的模块 由 在 中贡献 由 和 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 加速 秒 秒 倍 秒 秒 倍 秒 秒 倍 相关特性 模块上下文限制如下表具体取决于计算机体系结构 位 位 由 在 中贡献 由 和 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 新的函数 由 在 中贡献 由 在 中贡献 性能优化 构建和 的改变 新的 相关功能 添加了新的 类型宏和函数 高阶 低阶 类型 和 结构 使用 枚举 现在接受 格式的 弃用 不支持的操作系统 由于缺少维护人员不再支持 和 系统 由于维护负担将 设置为 的 平台含 不再受支持 支持在 中被弃用现在已经被完全删除 已弃用的 模块 函数和方法 使用 模块替换旧函数 已弃用的 函数和类型 已经在 弃用并将于 中移除 所有使用此类型的函数都已弃用 使用 或 使用 使用 以及 和 使用 或 使用 仅适用于现成的字符串 使用 或 使用 或 使用 或 使用 或 使用 使用 使用 使用 编码器 使用 使用 或 使用 使用 使用 或 和 弃用的功能 移植到 本节列出了先前描述的更改以及可能需要更改代码的其他错误修正 由 贡献 有什么新变化 作者 有序字典 千位分隔符的格式说明符 参见 千位分隔符的格式说明符 由 撰写并由 和 实现 其他语言特性修改 新增改进和弃用的模块 性能优化 由 和 贡献 由 在 中贡献 由 以及其他一些参与者在 中贡献 由 和 在 中贡献 由 在 中贡献 并由 和 转换为 由 和 在 中贡献 由 在 中贡献 构建和 的改变 移植到 有什么新变化 作者 参见 开发过程的变化 新的文档格式使用 的 参见 描述如何编写 文档 工具链的文档和代码 的基础解析器和工具集 语句 注解 模块 参见 语句 模块的文档 从主模块显式相对导入 分用户的 目录 参见 分用户的 目录 由 撰写并实现 多任务处理包 参见 模块的文档 添加多任务处理包 由 和 撰写由 和 实现 高级字符串格式 改为函数 参见 改为函数 由 撰写 异常处理的变更 参见 在 中捕获异常 由 撰写并实现 字节字面值 参见 中的字节字面值 由 撰写 补丁 由 撰写 新 库 参见 新 修改缓冲区协议 参见 修改缓冲区协议 由 和 撰写由 实 现 抽象基类 参见 引入抽象基类 整型文字支持和语法 参见 整型文字支持和语法 类装饰器 这相当于 参见 类装饰器 由 撰写 模块 其他语言特性修改 对 语言核心进行的小改动 由 在 中贡献 由 贡献 由 贡献 性能优化 新增和改进的模块 由 贡献 由 贡献 由 和 贡献 由 提供建议之后由 贡献 由 提供建议之后由 贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 贡献 由 在 中贡献 由 在 中贡献 模块 模块 模块属性列表解析器 参见 模块的文档 模块已被移除 模块已被移除 构建和 的改变 特定于 的更改 特定于 的更改 现在在编译 的框架版本时可以为 脚本添加 选项来指定要使用的框架名称 模块已被删除 这反过来要求删除 函数 因为它依赖于 模块 许多其他 模块已弃用并将在 中被删除 和 特定于 的更改 许多旧的 专用模块已被弃用并将在 中删除 和 和 和 和 和 和 移植到 致谢 作者感谢以下人员对本文各种草稿给予的建议更正和协助 有什么新变化 编者 本文解释了 相比 的新增特性 完整的详情可参阅 更新日志 摘要 发布重点 新的特性 赋值表达式 新增的语法 可在表达式内部为变量赋值 它被昵称为海象运算符因为它很像是 海象的眼睛和长牙 在这个示例中赋值表达式可以避免调用 两次 类似的益处还可出现在正则表达式匹配中需要使用两次匹配对象的情况中一次检测用于匹配是否发生另一次用于提取子分组 此运算符也适用于配合 循环计算一个值来检测循环是否终止而同一个值又在循环体中再次被使用的情况 另一个值得介绍的用例出现于列表推导式中在筛选条件中计算一个值而同一个值又在表达式中需要被使用 请尽量将海象运算符的使用限制在清晰的场合中以降低复杂性并提升可读性 请参阅 了解详情 由 在 中贡献 仅限位置形参 新增了一个函数形参语法 用来指明某些函数形参必须使用仅限位置而非关键字参数的形式 这种标记语法与通过 所显示的使用 的 工具标记的 函数相同 在下面的例子中形参 和 为仅限位置形参 或 可以是位置形参或关键字形参而 或 要求为关键字形参 以下均为合法的调用 但是以下均为不合法的调用 这种标记形式的一个用例是它允许纯 函数完整模拟现有的用 代码编写的函数的行为 例如内置的 函数不接受关键字参数 另一个用例是在不需要形参名称时排除关键字参数 例如内置的 函数的签名为 这可以排除如下这种笨拙的调用形式 另一个益处是将形参标记为仅限位置形参将允许在未来修改形参名而不会破坏客户的代码 例如在 模块中形参名 在未来可能被修改 这使得以下函数描述成为可能 由于在 左侧的形参不会被公开为可用关键字其他形参名仍可在 中使用 这极大地简化了需要接受任意关键字参数的函数和方法的实现 例如以下是一段摘自 模块的代码 请参阅 了解详情 由 在 中贡献 用于已编译字节码文件的并行文件系统缓存 新增的 设置 也可使用 可将隐式的字节码缓存配置为使用单独的并行文件系统树而不是默认的每个源代码目录下的 子目录 缓存的位置会在 中报告 表示默认位置即 子目录 由 在 中贡献 调试构建使用与发布构建相同的 现在不论是以发布模式还是调试模式进行构建都将使用相同的 在 上当 以调试模式构建时现在将可以加载以发布模式构建的 扩展和使用稳定版 构建的 扩展 发布构建和调试构建现在都是 兼容的定义 宏不会再启用 宏它引入了唯一的 不兼容性 宏添加了 函数和 环境变量它可以使用新的 构建选项来设置 由 在 中贡献 在 上 扩展不会再被链接到 但 和 例外 现在静态链接的 将可以加载使用共享库 构建的 扩展 由 在 中贡献 在 上当 以调试模式构建时导入操作现在也会查找在发布模式下编译的 扩展以及使用稳定版 编译的 扩展 由 在 中贡献 要将 嵌入到一个应用中必须将新增的 选项传给 以获得 将应用链接到 要同时支持 和旧版本请先尝试 并在此命令失败时回退到 即不带 增加一个 模块用来将 嵌入到一个应用中 包含 要同时支持 和旧版本请先尝试 并在此命令失败时回退到 即不带 请将 替换为 版本号 另一方面 不再包含 扩展不可被链接到 但 和 例外这两者的情况由脚本处理此改变是故意被设为向下不兼容的 由 在 中贡献 字符串支持 用于自动记录表达式和调试文档 增加 说明符用于 形式为 的 字符串将扩展表示为表达式文本加一个等于号再加表达式的求值结果 例如 通常的 字符串格式说明符 允许更细致地控制所要显示的表达式结果 说明符将输出整个表达式以便详细演示计算过程 由 和 在 中贡献 运行时审核钩子 初始化配置 增加了一个新的 用来配置 初始化提供对整个配置过程的更细致控制以及更好的错误报告 新的结构 新的函数 此 还为这些内部结构添加了 类型 和 类型字段 成为新的引用配置替代全局配置变量和其他私有变量 请参阅 初始化配置 获取详细文档 请参阅 了解详情 由 在 中贡献 用于 的快速调用协议 具有外部数据缓冲区的 协议 当使用 在 进程间传输大量数据以充分发挥多核或多机处理的优势时非常重要一点是通过减少内存拷贝来优化传输效率并可能应用一些定制技巧例如针对特定数据的压缩 协议 引入了对于外部缓冲区的支持这样 兼容的数据可以与主 流分开进行传输这是由通信层来确定的 请参阅 了解详情 由 在 中贡献 其他语言特性修改 在之前版本中 语句不允许在 子句中使用这是因为 具体实现存在一个问题 在 中此限制已被取消 由 在 中贡献 和 类型现在都有一个 方法与 和 中的已有 方法类似 这个微小的 扩展使得 这样的写法在多种数字类型上通用成为可能 由 在 和 在 中贡献 和 的构造器现在会使用 特殊方 法如果该方法可用而对应的方法 或 方法不可用的话 由 在 中贡献 添加 转义符在 正则表达式 中的支持 由 和 在 中贡献 现在 和 可以使用 按插入顺序反向迭代 由 在 中贡献 在函数调用中允许使用的关键字名称语法受到进一步的限制 特别地 不再被允许 关键字参数赋值形式的左侧绝不允许一般 标识符以外的其他内容 由 在 中贡献 在 和 语句中的一般可迭代对象解包不再要求加圆括号 这使得 和 的语法与正常的赋值语法更为一致 由 和 在 中贡献 当类似 这样在代码中少了一个逗号时编译器将显 示 并附带更有帮助的提示 这相比原来用 来提示第一个元组是不可调用的更容易被理解 由 在 中贡献 或 和 对象 之间的算术运算现在将返回相应子类的实例而不是基类的实例 这也会影响 到在具体实现中直接或间接地使用了 算术运算的 返回类型例如 由 在 中贡 献 当 解释器通过 被中断并且所产生的 异常未被捕获 进程现在会通过一个 信号或是使得发起调用的进程能检测到它是由 操作杀死的正确退出代 码来退出 和 上的终端会相应地使用此代码在交互式会话中 终止脚本 由 的 在 中贡献 某些高级编程风格要求为现有的函数更新 对象 由于代 码对象是不可变的需要基于现有代码对象模型创建一个新的代码对象 使 用 个形参将会相当繁琐 现在新的 方法使得通过少量修 改的形参创建克隆对象成为可能 下面是一个修改 函数来防止 形参被用作关键 字参数的例子 由 在 中贡献 对于整数现在 函数的三参数形式在底数与模数不可约的情况下允 许指数为负值 随后它会在指数为 时计算底数的模乘逆元并对其他 负指数计算反模的适当幂次 例如要计算 模 的 模乘逆元 则可写 为 模乘逆元在求解 线性丢番图方程 会被用到 例如想要求出 的整数解首先应重写为 然后求解 由 在 中贡献 字典推导式已与字典字面值实现同步会先计算键再计算值 对执行顺序的保证对赋值表达式来说很有用因为在键表达式中赋值的变量将 可在值表达式中被使用 由 在 中贡献 方法现在可返回长度为二至六个元素的元组 之前 的上限为五个 新增的第六个可选元素是签名为 的可调用 对象 这样就允许直接控制特定对象的状态更新 如果元素值不为 该可调用对象将优先于对象的 方法 由 和 在 中贡献 新增模块 改进的模块 节点现在具有 和 属性它们给出节点结束的精确位置 这只适用于具有 和 属性的节点 新增函数 返回指定 节点的源代码 由 在 中贡献 函数具有一些新的旗标 导致其返回与特定 节点相关联的 和 类型注释文本 可被用于解析 签名类型注释 为函数定 义 节点而返回 允许指定一个更早的 版本 例如 将把 和 视为非保留字 由 在 中贡献 已经从暂定状态晋级为稳定 此函数可被用于执行一个 并返回结果同时自动管理事件循环 例如 这 大致 等价于 实际的实现要更复杂许多 因此 应该作为运行 程序的首选方式 由 在 中贡献 运行 将启动一个原生异步 这允许快速体验具有最高层级 的代码 这时不再需要直接调用 因为此操作会在每次发起调用时产生一个新事件循环 由 在 中贡献 异常 现在继承自 而不是 并且不再继承自 由 在 中贡献 在 上现在默认的事件循环为 由 在 中贡献 现在也支持 由 和 在 中贡献 现在可通过 来中断 由 在 中贡献 添加了 用来获取 中的已包装协程 由 在 中贡献 任务现在可以被命名或者是通过将 关键字参数传给 或 事件循环方法或者是通过在任务对象上调用 方法 任务名称在 的 输出中可见并且还可以使用 方法来获取 由 在 中贡献 将对 的支持添加到 要指定此行为已增加了两个新的形参 和 算法可提升支持 和 的应用的响应速度具体做法是尝试同时使用两者进行连接 由 在 中贡献 的 方法现在将返回 而不是 此项更改是由于普通字典自 起已保证具有确定的元素顺序 如果还需要 的额外特性建议的解决方案是将结果转换为需要的类型 由 在 中贡献 类现在可被用作上下文管理器 在运行时对一个代码块实现性能分析 由 在 中贡献 现在将返回 而不是 此工具现在会更快速且消耗更少内存同时仍然保留字段顺序 由 在 中贡献 添加了一个新变量用于保存下层 库的结构版信息 由 在 中贡献 在 上 及其子类现在接受 形参来指定用于底层 调用的旗标 默认旗标被设为仅加载来自可信任位置的 依赖项包括 的存放路径如果加载初始 时使用了完整或部分路径以及通过 添加的路径 由 在 中贡献 添加了新的替代构造器 和 它们分别基于 年份 周序号和周内日序号来构造 和 对象这两者分别是其所对应类中 方法的逆操作 由 在 中贡献 现在可直接作为装饰器而不是作为返回装饰器的函数 因此这两种写法现在都被支持 由 在 中贡献 添加了新的 装饰器用于在实例生命周期内缓存的已计算特征属性 由 在 中贡献添加了新的 装饰器可使用 将方法转换为 泛型函数 由 在 中贡献 现在能接受一个可选的 形参来指定一个用于获取对象的生成器 由 在 中贡献 添加了 及其变化形式 由 和 在 中贡献 添加 形参到 用于可重现的输出 由 在 中贡献 对于特定类型的无效或已损坏 文件现在将引发 而不是 由 和 在 中贡献 与 超过 行默认值为 的输出将被折叠为一个按钮 可以在 对话框的 页的 部分中进行修改 数量较少但是超长的行可以通过在输出上右击来折叠 被折叠的输出可通过双击按钮来展开或是通过右击按钮来放入剪贴板或是单独的窗口 由 在 中贡献 在 菜单中增加了 以使用自定义设置来运行模块 输入的任何命令行参数都会被加入 它们在下次自定义运行时会再次显示在窗体中 用户也可以禁用通常的 主模块重启 由 等人在 和 中贡献 在 编辑器窗口中增加了可选的行号 窗口打开时默认不显示行号除非在配置对话框的 选项卡中特别设置 已打开窗口中的行号可以在 菜单中显示和隐藏 由 和 在 中贡献 现在会使用 本机编码格式在 字符串和 对象间进行转换 这允许在 中处理 和其他非 字符 这些字符将可被显示或是从剪贴板复制和粘贴 字符串从 到 的来回转换现在不会再发生失败 过去八年有许多人都为此付出过努力问题最终由 在 中解决 在 中新增添加切换光标闪烁停止的选项 由 在 中贡献 键现在会关闭 补全提示窗口 由 在 中贡献 上述修改已被反向移植到 维护发行版中 添加关键字到模块名称补全列表 由 在 中贡献 函数现在可以找到 的文档字符串如果该属性是一个元素值为文档字符串的 的话 这提供了类似于目前已有的 和 等函数的文档选项 由 在 中贡献 在开发模式 和调试构建中 终结器现在会在 方法失败时将异常写入日志 发生的异常在发布构建中默认会被静默忽略 由 在 中贡献 函数增加了可选的 关键字参数用来指定一个初始值 由 在 中贡献 添加选项 用于将每个输入行解析为单独的 对象 由 在 中贡献 为 添加了 关键字参数当设为真值时关联到根日志记录器的任何现有处理程序都将在执行由其他参数所指定的配置之前被移除并关闭 这解决了一个长期存在的问题 当一个日志处理器或 被调用时对 的后续调用会被静默地忽略 这导致使用交互提示符或 笔记本更新 试验或讲解各种日志配置选项变得相当困难 由 提议由 实现并由 在 中完成审核 添加了新的函数 用于计算两点之间的欧几里得距离 由 在 中贡献 扩展了 函数以便处理更多的维度 之前它仅支持 的情况 由 在 中贡献 添加了新的函数 作为的 同类该函数返回 值 默认值 乘以一个数字可迭代对象的积 由 在 中贡献 添加了两个新的组合函数 和 由 和 在 和 中贡献 添加了一个新函数 用于计算精确整数平方根而无需转换为浮点数 该新函数支持任意大整数 它的执行速度比 快但是比 慢 由 在 中贡献 函数 不再接受非整数类参数 由 在 中贡献 类现在具有一个 方法用于访问 系统调用 由 在 中贡献 添加了新的 模块 由 在 中贡献 在 上现在默认使用的启动方式是 启动方式 由 在 中贡献 在 上添加了新函数 用于在导入扩展模块或使用 加载 时为本机依赖提供额外搜索路径 由 在 中贡献 添加了新的 函数用于包装 系统调用 由 和 在 中贡献 在 上大部分用于处理重解析点包括符号链接和目录连接的手动逻辑已被委托给操作系统 特别地 现在将会遍历操作系统所支持的任何内容而 将只打开被标识为名称代理的重解析点而其要由 打开其他的重解析点 在所有情况下 将只为符号链接而非其他种类的重解析点设置 要标识其他种类的重解析点请检查新的 属性 在 上 现在能够读取目录连接 请注意 会对目录连接返回 因此首先检查 的代码将连续把连接视为目录而会处理 所引发错误的代码现在会把连接视为链接 由 在 中贡献 返回布尔值结果的 函数例如 以及 现在对于包含在 层级无法表示的字符或字节的路径将会返回 而不是引发 或其子类 和 由 在 中贡献 在 上现在改用 环境变量而不再使用 后者通常不会为一般用户账户设置 由 在 中贡献 在 上将不再为不存在的目录的链接返回 在 上现在会识别重解析点包括符号链接和目录连接 由 在 中贡献 扩展子类化针对 优化的 现在可通过定义特殊的 方法来重载函数和类的封存逻辑 由 和 在 中贡献 添加了新的 并启动了对读取和写入经过 编码的二进制 的支持 由 在 中贡献 模块为一些函数添加了 形参 默认情况下这些函数会继续在渲染或打印之前对字典进行排序 但是如果 设为假值则字典将保持键插入时的顺序 这在调试期间与 输入进行比较时会很有用 除此之外还增加了一个方便的新函数 它类似于 但它的 默认为 由 在 中贡献 现在支持静默模式 由 在 中贡献 新增了 函数作为 的逆操作 由 在 中贡献 现在接受新的 关键字参数 由 在 中贡献 现在对新的归档默认使用 格式以提升可移植性和标准一致性此特性继承自对 模块的相应更改 由 在 中贡献 在 上现在会移除目录连接而不会递归地先移除其中的内容 由 在 中贡献 添加了便捷的 和 函数以自动化在创建服务器套接字时通常情况下所必须的任务包括在同一套接字中同时接受 和 连接 由 在 中贡献 和 函数已经在 上实现 由 在 中贡献 增加了 和 分别启用和初始化 握手后验证 由 在 中贡献 添加了新的 函数可被重载以便控制如何处理不可引发的异常 它会在发生了一个异常但 没有办法处理时被调用 例如当一个析构器在垃圾回收时 所引发的异常 由 在 中贡献 模块现在对新的归档默认使用 格式而不再是之前的 专属格式 这通过标准化和可扩展格式的统一编码 提升了跨平台可移植性还提供了其他一些益处 由 在 中贡献 添加了新的 函数用来处理未捕获的 异常 它可被重载以便控制如何处理未捕获的 异常 由 在 中贡献 添加了新的 函数以及 类的 属性 它们会返回内核所分配给当前线程的原生整数线程 此特性仅在特定平台上可用参见 了解详情 由 在 中贡献 当提供不带末尾新行的输入时 模块现在会隐式地添加 形符 此行为现在已与 词法分析器的内部行为相匹配 由 在 中贡献 在 中添加了方法 和 由 在 中贡献 在 类中添加了方法 由 在 中贡献 类现在具有 和 方法 由 在 中贡献 为 添加了新的时钟 由 在 中贡献 模块加入了一些新特性 一个带有键专属类型的字典类型 参见 和 只使用字符串作为键 默认情况下每个键 都要求提供 指定 以允许键作为可选项 类型 参见 和 类型指 明一个形参或返回值被限定为一个或多个特定的字面值 变量 函数 方法和类 参见 和 限定符会指示静态类型检查器限制进行子类化 重载或重新赋值 协议定义 参见 和 简单的 例如 现在是 的子类 新的协议类 新的函数 和 添加了 以支持异步版本的 同时也添加了相应的断言函数用于测试 由 在 中贡献 添加了 和 以支持对 和 进行清理 由 在 中贡献 一些模拟断言函数现在也会在失败时打印一个实际调用列表 由 在 中贡献 模块已支持通过 来使用协程作为测试用例 由 在 中贡献 示例 现在 在所有平台上都会包含 脚本用于在 下激活虚拟环境 由 在 中贡献 由 返回的代理对象现在除其他算术运算符外也支持矩阵乘法运算符 和 由 在 中贡献 作为对 和外部实体检索的缓解在默认情况下 和 模块不再处理外部实体 由 在 中贡献 模块中的 方法支持通配符搜索例如 此搜索会忽略命名空间以及返回给定命名空间中所有标签的 由 在 中贡献 模块提供了实现 的新函数 由 在 中贡献 的目标对象可通过新的回调方法 和 来接受命名空间声明事件 此外 目标可被配置为处理有关注释和处理指令事件以将它们包含在所生成的树当中 由 在 和 中贡献 现在支持可选的 关键字参数作为随同每次请求发送的 标头序列 此特征的作用之一是使得从默认的基础认证升级到更快速的会话认证成为可能 由 在 中贡献 性能优化 构建和 的改变 默认的 成为一个空字符串 的 旗标不再有意 义无论是否启用 构建都是兼容 的因此已被移除 由 在 中贡献 改变的例子 只会安装 程序不再有 程序 只会安装 脚本不再有 脚本 旗标已经从动态库文件名后缀中移除包括标准库中的扩展模块以及第 三方包所产生和安装的模块例如从 下载的模块 以 为例 的后缀 在 中改为 重新组织了所有头文件以更好地区分不同种类的 应为可移植的公有稳定版 应为 专属的不稳定版 公有 部分私有 附加 前缀 应为 特别专属的私有内部 此 不具备向下兼容保证并且不应在 以外被使用 它们的公开仅 适用于特别限定的需求例如调试器和性能分析等必须直接访问 内 部数据而不通过调用函数的应用 此 现在是通过 安 装的 由 在 和 中贡献相关工作由 在 中发起 某些宏已被转换为静态内联函数形参类型和返回类型定义良好它们不再会 有与宏相关的问题变量具有局部作用域 例如 私有函数 由 在 中贡献 和 函数已被移除 它们自 和 起就没有任何用处被排除在受限 稳 定版 之外并且未被写入文档 由 在 中贡献 的结果类型现在是 而非 由 在 中贡献 与 两者的共存已被移除 之前在 更新 源码树时开发者必须手动拷贝 在源 码树内 到 在构建树内 以反映上游的任何改变 旧特 性对打包者来说有一点益处但代价是对追踪 开发进程的开发者造 成经常性的麻烦因为忘记拷贝该文件可能导致构建失败 现在构建系统总是会从源码树内的 读取数据 建议希望定 制该文件的开发者在 的一个 分叉或补丁文件中维护他们的更改 就如他们对源码树做任何其他改变时一样 由 在 中贡献 将 数字转换为 整型的函数例如 以及带有 之类整型转换格式单元的参数解析函数例如 现 在如果可能将会使用 特殊方法而不是 对于带 有 方法但没有 方法的对象 例如 和 将会发出弃用警告 对于实现了 的对象 现在将返回 和 现在如果可能也将会使用 方法 由 在 和 中贡献 堆分配类型对象现在将增加它们在 及其对应的宏 中的引用计数而不是在 中 修改实例分配或中止分配的类型可能需要进行调整 由 在 中贡献 新增函数 允许创建代码对象例如 但带有一个额外的 形参以指明仅限位 置参数的数量 由 在 中贡献 现在会将 设为程序完整路径 而不是程序名称 由 在 中贡献 弃用 与特性的移除 移植到 本节列出了先前描述的更改以及可能需要更改代码的其他错误修正 行为的改变 更改的 在 上 函数现在会使用 编码格式而不是 代码页请参看 了解具体原因 该函数在 上不 再被弃用 由 在 中贡献 现在 在某些情况下会使用 以获得 更好的性能 在适用于 的 子系统和 用户模拟器上 使用 的 构造器不会再因为找不到程序这样 的错误引发异常 而是让子进程失败并返回一个非零的 由 和 在 中贡献 方法不会再静默地忽略任意异常 由 在 中贡献 函数 已被移除它自 起就已被弃用请改 用 由 在 中贡献 当传入多模数据时 函数不会再引发异常 它将改为返 回在输入数据中遇到的第一个模式 由 在 中贡献 类的 方法不再接受参数 带参数 调用该方法来改变选择在 中已弃用 请使用专门方法例如 来改变选择 由 在 中 贡献 的 和 方法 以及 的 方法现在会保留用户指定的属性顺序 由 和 在 中贡献 附带 旗标打开的 数据库现在将是只读的 如果数据库不 存在附带 和 旗标的 不会再创建数据库 由 在 中贡献 在 的子类中定义的 方法将不会再被调用并将导 致发出 而不是 请在目标上定义 方法来处理 声明 由 在 中贡献 现在当自定义元类未在传给 的命名空间中提供 入口时将引发 在 中 是则是引发 由 在 中贡献 类现在可被用作上下文管理器 由 在 中贡献 和 会使用平台专属的 系统调用参见 依赖于具体平台的高效拷贝操作 一节 在 上的默认缓冲区大小从 改为 结构已被完全改变 所有接触到该结构的代码都应当被重写 参见 结构已被移入 头文件特别是 不透明的 作为仅有 以及稳定版 的一部分仍然可用 文档指明该结构的任 何字段都不是公有的因此我们希望没人在使用它们 但是如果你确实依 赖其中某一个或更多个私有字段并且没有其他替代选项则请开一个 问 题 我们将尽力帮助你进行调整可能包括向公有 添加访问器函数 参见 现在所有平台下的 方法都会在成功时返回 并在错误 时引发异常 之前它的行为取决于具体平台 下会在成功时返回非 零值在失败时返回零 下会在成功时返回零在失败时引发错误 由 在 中贡献 和 模块默认将不再处理外部实体 由 在 中贡献 从只读的 数据库 或 删除键将 会引发 或 而不是 由 在 中贡献 简化了字面值的 所有常量将被表示为 的实例 实例 化旧类 和 都将返回 的实例 由 在 中贡献 在 上现在改用 环境变量而不再使 用 后者通常不会为一般用户账户设置 由 在 中贡献 异常 现在继承自 而不是 并且不再继承自 由 在 中贡献 当使用 的实例时函数 现在会正确 地等待撤销 在此之前当达到 时它会被撤销并立即返回 由 在 中贡献 当将 作为 形参传入时函数 现在会返回一个可安全使用的 套接字对象 由 在 中贡献 已经晋级为稳定 在 上对扩展模块的 依赖以及通过 加载的 的解 析现在将更为安全 只有系统路径 包含相信 或 文件的路径以及 通过 添加的目录才会被作为加载时依赖的搜索位置 特别地 和当前工作目录将不再被使用对它们的修改将不再对正 常的 解析产生影响 如果你的应用依赖于这些机制你应当先检查 如果它存在就用它在加载你的库时添加你的 目 录 请注意 用户还需要确保 更新包 已安装 这一点也会由安装器进行验证 由 在 中贡 献 关联到 的头文件和函数在其被纯 实现取代后已被移除 由 在 中贡献 在构造器的第二个位置新增了一个形参 以支持在 中定义的仅限位置参数 第一 个参数 现在表示位置参数的总数量 包括仅限位置参数 中新增的 方法可用于让代码支持 特 性 中的改变 字节码的改变 解释器循环已通过将块堆栈展开逻辑移入编译器获得了简化 编译器现在会 发出显式指令来调整值堆栈并为 和 调用清 除代码 移除了操作码 和 添加了新的操作码 和 修改了 和 的行为 由 和 在 中贡献 添加了新的操作码 用于处理当等待 循环的下 一项时引发的异常 由 在 中贡献 现在会预期值为栈的第一个元素而键为第二个元素 作出此改变 以使得字典推导式能如 所提议的那样键总是会在值之前被求 值 由 在 中贡献 演示和工具 添加了一个检测脚本用于对访问变量的不同方式进行计时 由 在 中贡献 以下是自 以来性能提升情况的总结 基准测试是在 处理器 上运行从 获取的 位版得到的数据 基准测试脚本显示时间以纳秒为单位 中的重要变化 出于重要的安全性考量 的 形参不再被支持 这是由 中的套接字选项 的行为导致的 更多细节请参阅 的文档 由 和 在 中贡献 有什么新变化 作者 参见 发布计划 摘要 发布重点 新的语法特性 其他的新特性 能够随时可用 新的库模块 安全改进 实现的改进 新的特性 注解 文档更改 安装 模块 分发 模块 安装 模块旧版 分发 模块遗留版本 参见 安装中 的显式引导 由 和 撰写由 和 实现 参见 由 撰写并实现 二进制转换 文字转换 弃用 其他语言特性修改 对 语言核心进行的小改动 新增模块 参见 由 领导编写和实现 参见 由 和 撰写 由 实现 参见 由 撰写并实现 参见 由 撰写并实现 参见 由 撰写并实现 改进的模块 示例 参见 由 撰写并实现 与 参见 由 撰写并由 实现 命令行界面 进行非阻塞解析 参见 由 撰写并实现 参见 由 撰写并实现 注解 参见 由 撰写并实现 其他改进 弃用 移除 不再支持的操作系统 从源代码和构建工具中删除了对以下操作系统的支持 变更集 系统中 指向 的版本 与特性的移除 移植到 本节列出了先前描述的更改以及可能需要更改代码的其他错误修正 命令行为的变化 其他改进 的变化 的变化 的变化 有什么新变化 作者 本文介绍了 年 月 日发布的 的新功能 内置集合对象 参见 添加内置 对象类型 最初由 提出由 最终实现 统一长整数和整数 生成器表达式 代替 参见 生成器表达式 参见 由 撰写并实现 参见 该 页面包含几个装饰器示例 反向迭代 参见 反向迭代 由 撰写并实现 新的子进程模块 参见 子进程 新的进程模块 由 在 等人的协助下撰写并实现 十进制数据类型 为什么需要十进制 因此创建了 类型 类型 类型 参见 十进数据类型 由 撰写由 和 实现 多行导入 参见 由 撰写由 实现 其他语言特性修改 由 贡献 由 贡献 性能优化 新增改进和弃用的模块 该模块由 贡献 构建和 的改变 移植到 致谢 作者感谢以下人员对本文各种草稿给予的建议更正和协助 有什么新变化 作者 常见的绊脚石 注意 整数 指南 新语法 修改的语法 移除的语法 有什么新变化 语句 模块 从主模块显式相对导入 分用户的 目录 多任务处理包 高级字符串格式 改为函数 异常处理的变更 字节字面值 新 库 修改缓冲区协议 抽象基类 整型文字支持和语法 类装饰器 旧名称 新名称 构建和 的改变 性能 移植到 自动将 代码转为 代码 将扩展模块移植到 有什么新变化 作者 本文介绍了 的新功能 于 年 月 日发布 的未来 就像 集成了 的特性一样 版也集成了 中的一些新特性 系列继续提供迁移到 系列的工具 功能的部分列表这些功能已反向移植到 千位分隔符的格 式说明符 参见 将有序词典添加到集合中 由 和 撰写由 实现 千位分隔符的格式说明符 参见 千位分隔符的格式说明符 由 撰写由 实现 参见 模块的文档页面 升级 代码 新的命令行解析模块 由 撰写并实现 配置函数 参见 基于字典的日志配置 由 撰写并实现 参见 改造 和 参见 不变字节和可变缓冲区 其他语言特性修改 对 语言核心进行的小改动 相当于 性能优化 新增和改进的模块 新模块 这是一些例子 新模块 更新的模块 参见 更新的模块 构建和 的改变 胶囊 给扩展模块提供 特定于 的更改 特定于 的更改 在 版更改 特定于 的更改 移植到 对于 扩展模块 对于嵌入 的应用程序 新版功能 中添加的相关功能 中添加的相关功能 中添加的相关功能 文档更改 安装 模块 分发 模块 安装 模块旧版 分发 模块遗留版本 参见 安装中 的显式引导 由 和 撰写由 和 实现 适用于 的 验证迁移工具 由 在 中贡献 新版功能 由 在 中贡献 在 版更改 致谢 作者要感谢以下人员为本文的各种草案提供建议更正和帮助 有什么新变化 作者 概述 参见 由 和 撰写由 小组主要由 和 实现 参见 简单生成器 统一长整数和整数 参见 参见 由 撰写并实现 新增和改进的模块 致谢 作者感谢以下人员为本文的各种草案提供建议更正和帮助 有什么新变化 有什么新变化 作者 参见 发布计划 定义稳定的 参见 定义稳定的 由 撰写 命令行解析模块 基于字典的日志配置 参见 基于字典的日志配置 由 撰写 模块 仓库目录 参见 仓库目录 由 撰写 参见 由 撰写 服务器网关接口 参见 服务器网关接口 由 撰写 其他语言特性修改 新增改进和弃用的模块 两个方法被弃用 被 替代 被 替代 由 和 在 中贡献 由 贡献 由 贡献 由 贡献 由 贡献 由 贡献 和 由 在 中贡献 由 在 和 中贡献 由 在 中贡献 由 和 贡献 由 和 在 贡献由 在 和 贡献 由 在 中贡献 由 和 在 和 中贡献 和 由 在 中贡献由 和 在 和 中贡献 由 在 中建议 由 和 实现 由 贡献 由 贡献 由 贡献 由 和 在 中贡献 由 在 和 中贡献 由 在 中贡献由 在 中贡献 由 和 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中贡献 由 和 在 中贡献 由 在 中贡献 由 在 中贡献 由 在 中建议 由 在 中贡献 还有一个方便的命令行界面 由 移出 由 和 贡献 解析 编码字节 多线程 由 贡献 性能优化 由 和 团队在 和 中贡献 由 在 中贡献由 和 在 中贡献 由 在 中贡献 编解码器 文档 由 在 中贡献 由 和 在 中贡献 代码库 构建和 的改变 由 在 中贡献 由 在 中贡献 移植到 有什么新变化 编者 本文解释了与 相比 中的新功能 于 年 月 日发布 请参阅 以获取完整的更改列表 参见 发布计划 摘要 发布重点 新的特性 格式化的字符串文字 变量注释的语法 数字文字中的下划线 异步生成器 参见 异步生成器 由 撰写并实现 异步推导 参见 异步推导 由 撰写并实现 自定义类创建 创建类对象 参见 自定义类创建 由 撰写并实现 参见 自定义类创建 由 撰写并实现 添加文件系统路径协议 参见 添加文件系统路径协议 由 和 撰写 消除本地时间的歧义 参见 消除本地时间的歧义 由 和 撰写由 实现 将 文件系统编码更改为 有关详细信息和可能需要的代码修改的讨论请参见 将 控制台编码更改为 参见 将 控制台编码更改为 由 撰写并实现 保留类属性定义顺序 参见 保留类属性定义顺序 由 撰写并实现 保留关键字参数顺序 参见 保留关键字参数顺序 由 撰写并实现 新的 实现 向 添加框架评估 参见 向 添加框架评估 由 和 撰写 环境变量 新分配的内存中填充字节 释放的内存中填充了字节 在缓冲区开始之前检测写操作缓冲区下溢 在缓冲区结束后检测写操作缓冲区溢出 检查是否保留了 也是 的新特性 由 在 和 中贡献 和 探测支持 函数调用返回 垃圾收集开始完成 执行的代码行 更多信息请参见 使用 和 检测 当前的实现已在 和 上进行了测试 将来可能会添加其他标记 其他语言特性修改 对 语言核心进行的小改动 新增模块 警告 参见 模块被加入 标准库 由 撰写并实现 改进的模块 由 在 中贡献 由 在 中贡献 由 和 在 中贡献 与 在 中新增多个对自动补全的修正 由 在 中贡献 在 中新增 在 菜单中之前称为 现在会在最高层级函数和类之外显示嵌套的函数和类 由 和 在 中贡献 之前以扩展形式实现的 特性已作为正常特性重新实现 它们的设置已从 选项卡移至其他对话框选项卡 由 和 在 中实现 对话框 中的 已经被部分重写以改进外观和功能 由 和 在多个问题项中贡献 在 中新增字体样本现在包括一组非拉丁字符以便用户能更好地查看所选特定字体的效果 由 在 中贡献 样本可以被修改以包括其他字符 由 在 中贡献 在 中新增编辑器代码上下文选项已经过修改 会显示所有上下文行直到最大行数 点击一个上下文行会使编辑器跳转到该行 自定义主题的上下文颜色已添加到 对话框的 选项卡 由 和 在 和 中贡献 在 上会有新的 调用将 对 的调整告知 在 或 上如果 二进制码的 兼容属性未改变并且监视器分辨率大于 这应该会令文本和线条更清晰 否则的话它应该不造成影响 由 在 中贡献 在 中新增超过 行默认值为 的输出将被折叠为一个按钮 可以在 对话框的 页的 部分中进行修改 数量较少但是超长的行可以通过在输出上右击来折叠 被折叠的输出可通过双击按钮来展开或是通过右击按钮来放入剪贴板或是单独的窗口 由 在 中贡献 由 在 中贡献 由 在 中贡献 性能优化 构建和 的改变 其他改进 弃用 新关键字 已弃用的 行为 已弃用的 模块 函数和方法 已弃用的 函数和类型 弃用的构建选项 移除 与特性的移除 移植到 本节列出了先前描述的更改以及可能需要更改代码的其他错误修正 命令行为的变化 的更改 的子类如果未重载 将不再能使用一个参数的形式来 获取对象的类型 中的改变 字节码的改变 中的重要变化 由 在 中贡献 新版功能 由 在 中贡献 在 版更改 中的重要变化 中的重要变化 中的重要变化 中的重要变化 出于重要的安全性考量 的 形参不再被支持 这是由 中的套接字选项 的行为导致的 更多细节请参阅 的文档 由 和 在 中贡献 五月 注解 更新日志 下一版 发布日期 安全 模块 不再接受 属性列表文件中的实体声明避 免引发 脆弱性 此更改不应该影响用户使用因为实体声明在常规属 性列表文件中不被使用 核心与内置 修正了 解析器中导致调试模式崩溃的错误 现在在左递归规 则中检查错误以避免此类错误没有得到及时处理并在其他地方出现长距离 崩溃的情况 修正了 解析器在检查 规则中的 标记 时可能的崩溃 由 修正 记录 的默认实现 修复窥孔优化程序对条件跳转 对的 错误优化 垃圾回收器现在会跟踪所有用户定义类 由 修 复 库 文档 测试 构建 库 测试 构建 核心与内置 库 文档 重构 将超过 个类 函数和装饰器组织至新的子 小节 测试 构建 发布候选版 发布日期 核心与内置 正确地处理 中 之后的中断 库 在 模块中修复潜在的 更新 以安装 和 在 上修复 当套接字管道被 关闭时的返回值 返回 而不是空字节串 让 文档示例可运行 当传给 的选项未知时引发 而不 是 修复了 模块命令行界面下的 在 中使用 以在撤销时及早退订读取器 减少 的导入开销 在 中对 递归求值 选择器使用基于 的实现 处理在 上 为 的情况 文档 添加了 关于 调试功能的文档 将 的默认值由 变更到 参考 的变更 修复了 提示的描述 更新 版本以支持 改进 运行错误信息 也许用户永远都看不到 安全 核心与内置 库 文档 安全 核心与内置 库 测试 构建 库 构建 核心与内置 库 测试 构建 安全 核心与内置 库 文档 测试 构建 工具示例 安全 核心与内置 库 文档 数据模型 测试 构建 工具示例 安全 核心与内置 库 文档 测试 构建 工具示例 没有模块状态的扩展模块 不会受到影响 安全 核心与内置 库 文档 测试 构建 核心与内置 库 文档 构建 发布日期 安全 核心与内置 库 文档 测试 构建 安全 修复 的审计事件被命名为 在将文档页渲染为 时会对 的服务器标题进行转义 由 在 中贡献 将厂商化的 库版本更新至 这解决了 修复了 在邮件 头不包含末尾空格以及在其包含无效的已编码字等特定情况下进入无限循环 的问题 由 贡献补丁 命令行与环境 在 安装程序中将 更新为 核心与内置 库 文档 测试 使用 进行测试 构建 删除 依赖的 执行库 将绑定的 更新到 正式取消对在非 系统上创建 安装程序的 支持 更新 构建以使用 在 安装程序中将 更新为 更新 安装程序以使用 在 安装程序中将 更新为 工具示例 发布日期 安全 核心与内置 库 文档 测试 使用 进行测试 构建 增加一个 模块用来将 嵌入到一个 应用中 包含 要 同时支持 和旧版本请先尝试 并在此命令失败时回退到 即不带 请将 替换为 版本号 工具示例 发布日期 安全 于函数 中修复了对于预规格化字符的不当处理过程 核心与内置 库 为包含 指令的文件修复 文档 新增的文档翻译 简体中文 测试 构建 工具示例 发布日期 安全 核心与内置 在 初始化时如果当前目录被移除则它将不再会被添 加到 中 修复了在 等所用的函数 中进行从字符串到浮点 数的转换时偶有发生的一个内存泄漏问题 库 文档 测试 构建 修复 自动补全和 悬浮窗的颜色 避免与 暗色主题冲突 略微加深了 的背景颜色 将文档字符串添加到 的搜索模块 工具示例 发布日期 核心与内置 库 文档 测试 文档设置对话框字体选项卡示例 发布日期 安全 核心与内置 库 文档 更新 默认报告 并将在 移除 修复错误的 链接 为 添加缺失的文档 测试 添加了对一个实例方法进行双重修补的测试演示 补丁作者为 忽略运行在 平台的 上时 的失败 构建 更新 构建以使用 和 将 内部版本更新到 在 安装程序中将 更新为 在 安装程序中将 更新为 在 安装程序中将 更新为 在 安装程序中将 更新为 将 的新文件名从 更改为 当函数没有文档字符串时正确地格式化 工具示例 基于 有条件地声明 中新增 补丁作者 正式版 发布日期 库 发布日期 核心与内置 库 文档 构建 发布日期 核心与内置 库 文档 更新 默认报告 并将在 移除 修复错误的 链接 为 添加缺失的文档 测试 忽略运行在 平台的 上时 的失败 删除 模块用于测试和相关的帮助程序 该模块最初最初是在 中添加的 构建 发布日期 核心与内置 在异步函数外使用 和 时抛出 异常 修复导致 在 上出现两次的错误 由 提供补丁 修复 中潜在的内存泄漏 库 文档 测试 构建 在 安装程序中将 更新为 在 安装程序中将 更新为 工具示例 发布日期 安全 核心与内置 库 文档 测试 构建 工具示例 发布日期 安全 核心与内置 库 文档 测试 构建 工具示例 发布日期 核心与内置 库 文档 测试 构建 放弃对 及更早版本的支持 发布日期 核心与内置 库 文档 测试 工具示例 发布日期 核心与内置 库 文档 测试 构建 更新 构建以使用 更新 安装程序以使用 更新 安装程序以使用 工具示例 发布日期 核心与内置 取消对异步 的支持 库 文档 构建 删除对 的支持 发布日期 安全 核心与内置 库 文档 测试 构建 更新 构建和 安装程序以使用 更新 构建和 安装程序以使用 更新 构建和 安装程序以使用 更新 构建以使用 工具示例 正式版 发布日期 在 版本中没有新的更改 发布日期 核心与内置 修复 中潜在的内存泄漏 库 模块现在使用 编译 文档 修复错误的 链接 为 添加缺失的文档 测试 忽略运行在 平台的 上时 的失败 构建 更新 构建以使用 更新 安装程序以使用 工具示例 正式版 发布日期 测试 构建 发布日期 安全 核心与内置 库 文档 测试 构建 工具示例 正式版 发布日期 从 到 正式版中没有新的代码更改 发布日期 核心与内置 库 文档 测试 构建 更新 构建以使用 更新 安装程序以使用 更新 安装程序以使用 工具示例 正式版 发布日期 库 构建 发布日期 安全 核心与内置 库 文档 测试 构建 工具示例 正式版 发布日期 自 起没有更改 发布日期 安全 发布日期 核心与内置 库 安全 库 构建 文档 工具示例 测试 正式版 发布日期 核心与内置 构建 发布日期 核心与内置 库 文档 测试 构建 更新 构建和 安装程序以使用 正式版 发布日期 自 起没有更改 发布日期 核心与内置 工具示例 构建 发布日期 核心与内置 库 文档 工具示例 发布日期 核心与内置 库 文档 测试 构建 发布日期 核心与内置 库 构建 更新 构建和 安装程序以使用 更新 构建和 安装程序以使用 测试 发布日期 核心与内置 库 构建 测试 发布日期 核心与内置 库 测试 构建 更新 安装包使用 和 版本 工具示例 在 上将 更新到 发布日期 核心与内置 库 测试 构建 发布日期 核心与内置 库 安全 库 安全 库 构建 更新 构建以使用 在 系统中不使用大文件支持 工具示例 文档 测试 发布日期 核心与内置 库 安全 库 安全 库 文档 测试 构建 更新 仅 位安装程序以构建并链接 工具示例 发布日期 核心与内置 库 安全 库 安全 库 安全 库 文档 测试 构建 更新 构建 更新 仅 位安装程序以构建并链接 更新 构建 工具示例 正式版 发布日期 在 版本中没有新的更改 发布日期 安全 核心与内置 库 正式版 发布日期 库 发布日期 安全 核心与内置 库 文档 测试 构建 正式版 发布日期 发布日期 核心与内置 库 安全 库 安全 库 文档 测试 工具示例 构建 更新 构建和 安装程序以使用 正式版 发布日期 核心与内置 更新 构建以使用 测试 发布日期 核心与内置 安全 库 安全 库 安全 库 安全 库 安全 库 文档 测试 构建 更新 构建 更新 仅 位安装程序以构建并链接 更新 构建 工具示例 正式版 发布日期 核心与内置 发布日期 核心与内置 库 文档 测试 构建 工具示例 正式版 发布日期 构建 发布日期 库 构建 发布日期 核心与内置 库 发布日期 核心与内置 库 发布日期 核心与内置 库 文档 测试 发布日期 核心与内置 库 构建 更新 构建和 安装程序以使用 发布日期 核心与内置 库 测试 文档 构建 更新 构建和 安装程序以使用 发布日期 核心与内置 库 发布日期 核心与内置 库 测试 文档 工具示例 发布日期 核心与内置 库 构建 测试 工具示例 发布日期 核心与内置 库 构建 测试 工具示例 发布日期 核心与内置 库 构建 更新 安装程序以使用 发布日期 核心与内置 升级 数据库到 版本 库 从最新的 更新 错误代码 在 包中增加 变量 在 中删除了对 的支持 构建 放弃对 编译器构建 的支持 模块仍 然支持它来构建扩展 放弃对 的支持尤其是 编译器 的 端 口 文档 测试 修复 上的套接字测试 添加了针对 几何管理器的测试 增加 包的测试用例 修复 中的引用泄漏 将 移至 工具示例 让 可以工作在 由 提供补丁 为 添加 的支持 更新 安装器 的捆绑版本已更新到 有关旧版本的信息请参阅 文件 有什么新变化 作者 条件表达式 语句 生成器的新特性 绝对导入和相对导入 统一 条件表达式 部分功能应用 这里有一个很小但很现实的例子 参见 由 提出并撰写由 和 实现并由 适配 软件包的元数据 参见 软件包的元数据 由 和 提出并撰写由 和 实现 绝对导入和相对导入 参见 导入多行和绝对相对导入 由 撰写由 实现 将模块作为脚本执行 参见 将模块作为脚本执行 由 撰写并实现 统一 参见 统一 和 由 撰写由 实现 生成器的新特性 这些改变的累积效应是让生成器从单向的信息生产者变成了既是生产者又是消费者 参见 通过增强型生成器实现协程 由 和 撰写由 实现 包括一些更高级的使用生成器作为协程的示例 这些功能的早期版本在 由 撰写 和 由 撰写中提出 协程的 条目 语句 该语句在 中始终启用 注解 模块 参见 语句 模块的文档 异常作为新型的类 参见 异常所需的超类 由 和 撰写由 实 现 使用 作为索引类型 参见 使用 作为索引类型 由 撰写并实现 方法 参见 允许将任何对象用于切片 由 撰写并实现 其他语言特性修改 几个例子 由 和 贡献 由 实现 由 实现 交互解释器变更 性能优化 新增改进和删除的模块 包 参见 的主页含教程 参考和常见问题解答 模块的文档 包 包 参见 模块的文档 包 包 参见 相关资源的核心网站 服务器网关接口 由 撰写 构建和 的改变 使用 作为 索引类型 移植到 生成器的新特性 使用 作为索引类型 致谢 作者感谢以下人员对本文各种草稿给予的建议更正和协助 有什么新变化 作者 概述 的最终版本于 年 月 日发布 参见 由 撰写并实现 参见 由 撰写主要由 实现 运算 方法名称 参见 参见 由 撰写并实现 参见 由 撰写并实现 参见 弱引用 由 撰写并实现 参见 由 撰写并实现 参见 由 撰写并实现 参见 参见 由 撰写并实现 新增和改进的模块 致谢 作者感谢以下人员对本文的各种草案提出建议 文档内容 描述器使用指南 作者 联系方式 目录 描述器使用指南 摘要 属性 摘要 学习描述器不仅能提供接触到更多工具集的方法还能更深地理解 工作的原理并更加体会到其设计的优雅性 以上就是全部 定义这些方法中的任何一个的对象被视为描述器并在被作为属性时覆盖其默认行为 如果一个对象定义了 或 则它会被视为数据描述器 仅定义了 的描述器称为非数据描述器它们通常被用于方法但也可以有其他用途 数据和非数据描述器的不同之处在于如何计算实例字典中条目的替代值 如果实例的字典具有与数据描述器同名的条目则数据描述器优先 如果实例的字典具有与非数据描述器同名的条目则该字典条目优先 为了使数据描述器成为只读的应该同时定义 和 并在 中引发 用引发异常的占位符定义 方法使其成为数据描述器 要记住的重要点是 属性 该文档显示了定义托管属性 的典型用法 要了解 如何根据描述器协议实现这里是一个纯 的等价实现如下 这个内置的 每当用户访问属性时生效随后的变化需要一个方法的参与 例如一个电子表格类可以通过 授予对单元格值的访问权限 对程序的后续改进要求每次访问都要重新计算单元格但是程序员不希望影响直接访问该属性的现有客户端代码 解决方案是将对 属性的访问包装在属性数据描述器中 的面向对象功能是在基于函数的环境构建的 通过使用非数据描述器这两方面完成了无缝融合 非数据描述器为把函数绑定为方法的通常模式提供了一种简单的机制 下表总结了绑定及其两个最有用的变体 转换形式 函数 静态方法 类方法 静态方法返回底层函数不做任何更改 调用 或 等效于通过 或 查找 这样该函数就可以从对象或类中进行相同的访问 适合于作为静态方法的是那些不引用 变量的方法 例如一个统计用的包可能包含一个实验数据的容器类 该容器类提供了用于计算数据的平均值均值中位数和其他描述性统计信息的常规方法 但是可能有在概念上相关但不依赖于数据的函数 例如 是在统计中的便捷转换但并不直接依赖于特定的数据集 可以从对象或类中调用它 或 使用非数据描述器纯 版本的 如下所示 与静态方法不同类方法在调用函数之前将类引用放在参数列表的最前 无论调用方是对象还是类此格式相同 现在可以这样构造一个新的唯一键字典 使用非数据描述符协议纯 版本的 如下 作者 摘要 语句解释及变量编译 字符串常量 注解 注释 下表显示了传统转换器映射到实参转换器的情况 左边是传统转换器右边是要替换它的文本 日志操作手册 作者 本页包含了许多日志记录相关的概念这些概念在过去一直被认为很有用 在多个模块中使用日志 多次调用 时会返回对同一个 对象的引用 这不仅是在同一个模块中在其他模块调用也是如此只要是在同一个 解释器进程中 是应该引用同一个对象此外应用程序也可以在一个模块中定义和配置父 而在单独的模块中创建但不配置子 对子 的所有调用都将传给父 这里是主模块 这里是辅助模块 输出结果会像这样 在多线程中使用日志 使用多个日志处理器和多种格式化 在多个地方记录日志 日志服务器配置示例 以下是在一个模块中使用日志服务器配置的示例 然后如下的脚本它接收文件名做为命令行参数并将该文件以二进制编码的方式传给服务器做为新的日志服务器配置 处理日志处理器的阻塞 有时候需要让日志处理程序在不阻塞当前正在记录线程的情况下完成工作 这在 应用程序中很常见当然也会在其他场景中出现 一个常见的缓慢行为是 由于开发者无法控制的多种原因例如性能不佳的邮件或网络基础架构发送电子邮件可能需要很长时间 其实几乎所有基于网络的处理程序都可能造成阻塞即便是 也可能在底层进行 查询这太慢了这个查询会深入至套接字代码位于 层之下这是不受开发者控制的 一种解决方案是分成两部分去处理 第一部分针对那些对性能有要求的关键线程的日志记录附加一个 日志记录器只需简单写入队列该队列可以设置一个足够大的容量甚至不设置容量上限 通常写入队列是一个快速的操作即使可能需要在代码中去捕获例如 等异常 如果你是一名处理关键线程的开发者请务必记录这些信息 包括建议只为日志处理器附加 以便于其他开发者使用你的代码 解决方案的另一部分是 它被设计用来作为 的对应 非常简单向其传入一个队列和一些处理句柄它会启动一个内部线程来监听从 或任何其他可用的 源 发送过来的 队列 会从队列中被移除并被传递给句柄进行处理 使用一个单独的类 优点是可以使用同一个实例去服务于多个 这样会更节省资源否则每个处理程序都占用一个线程没有任何益处 以下是使用了这样两个类的示例省略了导入语句 在运行后会产生 在 版更改 在 之前 总是把从队列中接收的每个消息都传给它初始化的日志处理程序 这是因为它会假设过滤级别总是在队列的另一侧去设置的 从 开始可以通过在监听器构造函数中添加一个参数 改变这种情况 当这样设置时监听器会比较每条消息的等级和日志处理器中设置的等级只把需要传递的消息传给对应的日志处理器 通过网络发送和接收日志 如果你想在网络上发送日志并在接收端处理它们 一个简单的方式是通过附加一个 的实例在发送端的根日志处理器中 在接收端你可以使用 模块设置一个接收器 这里是一个基础示例 首先运行服务端然后是客户端 在客户端没有什么内容会打印在控制台中在服务端你应该会看到如下内容 请注意在某些情况下序列化会存在一些安全 如果这影响到你那么你可以通过覆盖 方法使用自己的实现来解决并调整上述脚本也使用覆盖后的序列化方法 在日志记录中添加上下文信息 使用日志适配器传递上下文信息 使用过滤器传递上下文信息 从多个进程记录至单个文件 轮换日志文件 使用其他日志格式化方式 当日志模块被添加至 标准库时只有一种格式化消息内容的方法即 在那之后 又增加了两种格式化方法 在 中新增 和 在 中新增 日志从 开始为这两种格式化方式提供了更多支持 类可以添加一个额外的可选关键字参数 它的默认值是 其他的值 和 也支持对应了其他两种格式化样式 其保持了向后兼容如您所愿但通过显示指定样式参数你可以指定格式化字符串的方式是使用 或 这里是一个控制台会话的示例展示了这些方式 请注意最终输出到日志的消息格式完全独立于单条日志消息的构造方式 它仍然可以使用 如下所示 参见 模块 日志记录模块的 参考 模块 日志记录模块的配置 模块 日志记录模块附带的有用处理程序 使用任意对象作为消息 访问外部对象 用户定义对象 缓冲日志消息并有条件地输出它们 在某些情况下你可能希望在临时区域中记录日志消息并且只在发生某种特定的情况下才输出它们 例如你可能希望起始在函数中记录调试事件如果函数执行完成且没有错误你不希望输出收集的调试信息以避免造成日志混乱但如果出现错误那么你希望所有调试以及错误消息被输出 下面是一个示例展示如何在你的日志记录函数上使用装饰器以实现这一功能 该示例使用 它允许缓冲已记录的事件直到某些条件发生缓冲的事件才会被刷新 传递给另一个处理程序 进行处理 默认情况下 在其缓冲区被填满时被刷新或者看到一个级别大于或等于指定阈值的事件 如果想要自定义刷新行为你可以通过更专业的 子类来使用这个秘诀 这个示例脚本有一个简单的函数 它只是在所有的日志级别中循环运行写到 说明它要记录在哪个级别上然后在这个级别上实际记录一个消息 你可以给 传递一个参数如果为 它将在 和 级别记录否则它只在 和 级别记录 脚本只是使用了一个装饰器来装饰 这个装饰器将记录执行所需的条件 装饰器使用一个记录器作为参数并在调用被装饰的函数期间附加一个内存处理程序 装饰器可以使用目标处理程序 记录级别和缓冲区的容量缓冲记录的数量来附加参数 这些参数分别默认为写入 的 和 以下是脚本 运行此脚本时应看到以下输出 如你所见实际日志记录输出仅在消息等级为 或更高的事件时发生但在这种情况下任何之前较低消息等级的事件还会被记录 你当然可以使用传统的装饰方法 通过配置使用 格式化时间 有时候你希望使用 来格式化时间这可以使用一个类来完成例如 如下所示 然后你可以在你的代码中使用 而不是 如果你想通过配置来实现这一功能你可以使用 来完成该方法在以下完整示例中展示 脚本会运行输出类似下面的内容 展示了如何将时间格式化为本地时间和 两种形式其中每种形式对应一个日志处理器 使用上下文管理器进行选择性记录 有时候我们需要暂时更改日志配置并在执行某些操作后将其还原 为此上下文管理器是实现保存和恢复日志上下文的最明显的方式 这是一个关于上下文管理器的简单例子它允许你在上下文管理器的作用域内更改日志等级以及增加日志句柄 如果指定上下文管理器的日志记录等级属性则在上下文管理器的 语句所涵盖的代码中日志记录器的记录等级将临时设置为上下文管理器所配置的日志记录等级 如果指定上下文管理的句柄属性则该句柄在进入上下文管理器的上下文时添加到记录器中并在退出时被删除 如果你再也不需要该句柄时你可以让上下文管理器在退出上下文管理器的上下文时关闭它 为了说明它是如何工作的我们可以在上面添加以下代码块 我们最初设置日志记录器的消息等级为 因此消息 出现消息 没有出现 在接下来的 代码块中我们暂时将消息等级变更为 从而消息 出现 在这一代码块退出后日志记录器的消息等级恢复为 从而消息 没有出现 在下一个 代码块中我们再一次将设置消息等级设置为 同时添加一个将消息写入 的日志处理器 因此消息 在控制台出现两次 分别通过 和 在 语句完成后状态与之前一样因此消息 出现类似消息 而消息 没有出现类似消息 如果我们运行生成的脚本结果如下 我们将 标准错误传输到 我再次运行生成的脚步唯一被写入 标准输出的消息即我们所能看见的消息如下 再一次将 标准输出重定向到 我获得如下结果 在这种情况下与预期一致打印到 标准输出的消息 不会出现 当然这里描述的方法可以概括例如临时附加日志记录过滤器 请注意上面的代码适用于 以及 指南 发布版本 本指南讨论了 对于表达文本数据的 规范的支持并且解释了人们试图使用 时经常遇到的问题 概述 定义 编码 上一段可以归结为一个 字符串是一系列码位从 到 或者说十进制的 的数字组成的序列 这一序列在内存中需要被表示为一组码元然后码元 会对应到包含八个二进制位的字节 将 字符串翻译成字节序列的规则被称为字符编码或者编码 你可能会想到的第一种编码是使用一个 位的整数来代表一个代码位然后使用 对 位整数的表达方式 在这一表达方式中字符串 可能看起来像是这样 这个表达方式非常直接但同时也存在 一些问题 不够方便不同的处理器对字节的排序不同 非常浪费空间 多数编码都小于 或者 所以很多空间都是 上面的字符串 引用文献 标准编码 引用文献 文本序列类型 引用文献 致谢 日志 作者 日志基础教程 什么时候使用日志 一个简单的例子 记录日志到文件 从多个模块记录日志 如果你的程序包含多个模块这里有一个如何组织日志记录的示例 如果你运行 你应该在 中看到 这是你期待看到的 你可以使用 中的模式将此概括为多个模块 请注意对于这种简单的使用模式除了查看事件描述之外你不能通过查看日志文件来了解应用程序中消息的 来源 如果要跟踪消息的位置则需要参考教程级别以外的文档 请参阅 进阶日志教程 记录变量数据 要记录变量数据请使用格式字符串作为事件描述消息并将变量数据作为参数附加 例如 将显示 如你所见将可变数据合并到事件描述消息中使用旧的 形式的字符串格式化 这是为了向后兼容 包的出现时间早于较新的格式化选项例如 和 这些较新格式化选项 是 受支持的但探索它们超出了本教程的范围有关详细信息请参阅 更改显示消息的格式 要更改用于显示消息的格式你需要指定要使用的格式 这将输出 请注意前面示例中出现的 已消失 对于可以出现在格式字符串中的全部内容你可以参考以下文档 属性 但为了简单使用你只需要 严重性 事件描述包括可变数据也许在事件发生时显示 这将在下一节中介绍 在消息中显示日期时间 要显示事件的日期和时间你可以在格式字符串中放置 应该打印这样的东西 日期时间显示的默认格式如上所示类似于 或 如果你需要更多地控制日期时间的格式请为 提供 参数如下例所示 这会显示如下内容 参数的格式与 支持的格式相同 后续步骤 基本教程到此结束 它应该足以让你启动并运行日志记录 日志包提供了更多功能但为了充分利用它你需要花更多的时间来阅读以下部分 如果你准备好了可以拿一些你最喜欢的饮料然后继续 如果你的日志记录需求很简单那么使用上面的示例将日志记录合并到你自己的脚本中如果你遇到问题或者不理解某些内容请在 组上发布一个问题在 你应该在短时间内得到帮助 还不够 你可以继续阅读接下来的几个部分这些部分提供了比上面基本部分更高级或深入的教程 之后你可以看一下 日志操作手册 进阶日志教程 日志库采用模块化方法并提供几类组件记录器 处理程序 过滤器和格式化程序 记录器暴露了应用程序代码直接使用的接口 处理程序将日志记录由记录器创建发送到适当的目标 过滤器提供了更精细的附加功能用于确定要输出的日志记录 格式化程序指定最终输出中日志记录的样式 日志事件信息在 实例中的记录器 处理程序 过滤器和格式化程序之间传递 通过调用 类以下称为 记录器的实例来执行日志记录 每个实例都有一个名称它们在概念上以点句点作为分隔符排列在命名空间的层次结构中 例如名为 的记录器是记录器 和 的父级 记录器名称可以是你想要的任何名称并指示记录消息源自的应用程序区域 在命名记录器时使用的一个好习惯是在每个使用日志记录的模块中使用模块级记录器命名如下 这意味着记录器名称跟踪包或模块的层次结构并且直观地从记录器名称显示记录事件的位置 记录器层次结构的根称为根记录器 这是函数 和 使用的记录器它们只调用根记录器的同名方法 功能和方法具有相同的签名 根记录器的名称在记录的输出中打印为 当然可以将消息记录到不同的地方 软件包中的支持包含用于将日志消息写入文件 位置 通过 发送电子邮件 通用套接字 队列或特定于操作系统的日志记录机制如 或 事件日志 目标由 类提供 如果你有任何内置处理程序类未满足的特殊要求则可以创建自己的日志目标类 默认情况下没有为任何日志记录消息设置目标 你可以使用 指定目标例如控制台或文件如教程示例中所示 如果你调用函数 和 他们将检查是否有设置目的地如果没有设置它们将在委托给根记录器进行实际的消息输出之前设置目标为控制台 和默认格式的显示消息 由 设置的消息默认格式为 你可以通过使用 参数将格式字符串传递给 来更改此设置 有关如何构造格式字符串的所有选项请参阅 格式器对象 记录流程 记录器和处理程序中的日志事件信息流程如下图所示 图片 记录器 处理程序 对象负责将适当的日志消息基于日志消息的严重性分派给处理程序的指定目标 对象可以使用 方法向自己添加零个或多个处理程序对象 作为示例场景应用程序可能希望将所有日志消息发送到日志文件将错误或更高的所有日志消息发送到标准输出以及将所有关键消息发送至一个邮件地址 此方案需要三个单独的处理程序其中每个处理程序负责将特定严重性的消息发送到特定位置 标准库包含很多处理程序类型参见 有用的处理程序 教程主要使用 和 处理程序中很少有方法可供应用程序开发人员使用 与使用内置处理程序对象即不创建自定义处理程序的应用程序开发人员相关的唯一处理程序方法是以下配置方法 方法就像在记录器对象中一样指定将被分派到适当目标的 最低严重性 为什么有两个 方法 记录器中设置的级别确定将 传递给其处理程序的消息的严重性 每个处理程序中设置的级别确定处理程序 将发送哪些消息 选择一个该处理程序使用的 对象 和 分别在处理程序上配置和取消配置过滤 器对象 应用程序代码不应直接实例化并使用 的实例 相反 类是一个基类它定义了所有处理程序应该具有的接口并建立了子类可以使用或覆盖的一些默认行为 格式化程序 格式化程序对象配置日志消息的最终顺序 结构和内容 与 类不同应用程序代码可以实例化格式化程序类但如果应用程序需要特殊行为则可能会对格式化程序进行子类化 构造函数有三个可选参数 消息格式字符串 日期格式字符串和样式指示符 如果没有消息格式字符串则默认使用原始消息 如果没有日期格式字符串则默认日期格式为 最后加上毫秒数 是 或 之一 如果未指定其中一个则将使用 如果 是 则消息格式字符串使用 样式字符串替换可能的键值在 属性 中 如果样式为 则假定消息格式字符串与 使用关键字参数兼容而如果样式为 则消息格式字符串应符合 在 版更改 添加 形参 以下消息格式字符串将以人类可读的格式记录时间 消息的严重性以及消息的内容按此顺序 格式化程序使用用户可配置的函数将记录的创建时间转换为元组 默认情况下使用 要为特定格式化程序实例更改此项请将实例的 属性设置为具有相同签名的函数 或 要为所有格式化程序更改它例如如果你希望所有记录时间都以 显示请在格式化程序类中设置 属性对于 显示设置为 配置日志记录 开发者可以通过三种方式配置日志记录 使用调用上面列出的配置方法的 代码显式创建记录器 处理程序和 格式化程序 创建日志配置文件并使用 函数读取它 创建配置信息字典并将其传递给 函数 有关最后两个选项的参考文档请参阅 配置函数 以下示例使用 代码配置一个非常简单的记录器一个控制台处理程序和一个简单的格式化程序 从命令行运行此模块将生成以下输出 以下 模块创建的记录器 处理程序和格式化程序几乎与上面列出的示例中的相同唯一的区别是对象的名称 这是 文件 输出几乎与不基于配置文件的示例相同 你可以看到配置文件方法比 代码方法有一些优势主要是配置和代码的分离以及非开发者轻松修改日志记录属性的能力 警告 函数接受一个默认参数 出 于向后兼容的原因默认为 这可能是你想要的也可能不是你想要 的因为除非在配置中明确命名它们或一个上级节点中否则它将导致在 调用之前存在的任何非 记录器被禁用 有关更多信息 请参阅参考文档如果需要请为此参数指定 传递给 的字典也可以用键 指定一个 布尔值如果没有在字典中明确指定也默认被解释为 这会导致上 面描述的记录器禁用行为这可能不是你想要的 在这种情况下明确地为键 提供 值 请注意配置文件中引用的类名称需要相对于日志记录模块或者可以使用常规导入机制解析的绝对值 因此你可以使用 相对于日志记录模块或 对于在 包中定义的类和模块 其中 在 导入路径上可用 在 中引入了一种新的配置日志记录的方法使用字典来保存配置信息 这提供了上述基于配置文件方法的功能的超集并且是新应用程序和部署的推荐配置方法 因为 字典用于保存配置信息并且由于你可以使用不同的方式填充该字典因此你有更多的配置选项 例如你可以使用 格式的配置文件或者如果你有权访问 处理功能则可以使用 格式的文件来填充配置字典 当然你可以在 代码中构造字典通过套接字以 形式接收它或者使用对你的应用程序合理的任何方法 以下是与上述相同配置的示例采用 格式用于新的基于字典的方法 有关使用字典进行日志记录的更多信息请参阅 配置函数 如果没有提供配置会发生什么 如果未提供日志记录配置则可能出现需要输出日志记录事件但无法找到输出事件的处理程序的情况 在这些情况下日志包的行为取决于 版本 对于 之前的 版本行为如下 如果 为 生产模式则会以静默方 式丢弃该事件 如果 为 开发模式则会打印一条 消息无法找到记录器 的处理程序 在 及更高版本中行为如下 事件使用最后的处理程序输出存储在 中 这个 内部处理程序与任何记录器都没有关联它的作用类似于 它将事件描述消息写入 的当前值因此服从任何可能的重定 向影响 没有对消息进行格式化 只打印裸事件描述消息 处理程序的级 别设置为警告因此将输出此级别和更高级别的所有事件 要获得 之前的行为 可以设置为 配置库的日志记录 日志级别 日志记录级别的数值在下表中给出 如果你想要定义自己的级别并且需要它们具有相对于预定义级别的特定值那么这些内容可能是你感兴趣的 如果你定义具有相同数值的级别它将覆盖预定义的值 预定义的名称丢失 级别 数值 级别也可以与记录器相关联由开发人员设置或通过加载已保存的日志记录配置 在记录器上调用日志记录方法时记录器会将其自己的级别与与方法调用关联的级别进行比较 如果记录器的级别高于方法调用的级别则实际上不会生成任何记录消息 这是控制日志记录输出详细程度的基本机制 记录消息被编码为 类的实例 当记录器决定实际记录事件时从记录消息创建 实例 记录消息通过使用 进行调度机制它们是 类的子类的实例 处理程序负责确保记录的消息以 的形式最终位于特定位置或一组位置这对该消息的目标受众例如最终用户 支持服务台员工 系统管理员 开发人员 传递处理程序用于特定目标的 实例 每个记录器可以有零个 一个或多个与之关联的处理程序通过 的 方法 除了与记录器直接关联的任何处理程序之外还调用与记录器的 所有祖先相关联的所有处理程序来分派消息除非记录器的 标志设置为 值这将停止传递到上级处理程序 就像记录器一样处理程序可以具有与它们相关联的级别 处理程序的级别作为过滤器其方式与记录器级别相同 如果处理程序决定调度一个事件则使用 方法将消息发送到其目标 大多数用户定义的 子类都需要重载 自定义级别 定义你自己的级别是可能的但不一定是必要的因为现有级别是根据实践经验选择的 但是如果你确信需要自定义级别那么在执行此操作时应特别小心如果你正在开发库则 定义自定义级别可能是一个非常糟糕的主意 这是因为如果多个库作者都定义了他们自己的自定义级别那么使用开发人员很难控制和解释这些多个库的日志记录输出因为给定的数值可能意味着不同的东西对于不同的库 有用的处理程序 记录日志中引发的异常 日志包设计为忽略记录日志生产时发生的异常 这样处理日志记录事件时发生的错误例如日志记录错误配置 网络或其他类似错误不会导致使用日志记录的应用程序过早终止 和 异常永远不会被忽略 在 子类的 方法中发生的其他异常被传递给它的 方法 中默认实现的 检查是否设置了模块级变量 如果有设置则会将跟踪打印到 如果未设置则忽略异常 注解 默认值是 这是因为在开发期间你通常希望收 到任何发生异常的通知 建议你将 设置为 以供 生产环境使用 使用任意对象作为消息 优化 教程 作者 这篇教程旨在作为 的入门介绍此模块是 标准库中推荐的命令行解析模块 注解 还有另外两个模块可以完成同样的任务称为 对应于 语言中的 函数 和被弃用的 还要注意 是基于 的因此用法与其非常相似 概念 让我们利用 命令来展示我们将要在这篇入门教程中探索的功能 我们可以从这四个命令中学到几个概念 是一个即使在运行的时候没有提供任何选项也非常有用的命令 在 默认情况下他会输出当前文件夹包含的文件和文件夹 如果我们想要使用比它默认提供的更多功能我们需要告诉该命令更多信息 在这个例子里我们想要查看一个不同的目录 我们所做的是指定所 谓的位置参数 之所以这样命名是因为程序应该如何处理该参数值完全取 决于它在命令行出现的位置 更能体现这个概念的命令如 它最基本 的用法是 第一个位置参数指的是你想要复制的第二个位 置参数指的是你想要复制到的位置 现在假设我们想要改变这个程序的行为 在我们的例子中我们不仅仅只是输 出每个文件的文件名还输出了更多信息 在这个例子中 被称为可选 参数 这是一段帮助文档的文字 它是非常有用的因为当你遇到一个你从未使用过 的程序时你可以通过阅读它的帮助文档来弄清楚它是如何运行的 基础 位置参数介绍 可选参数介绍 到目前为止我们一直在研究位置参数 让我们看看如何添加可选的 和输出 程序运行情况如下 这一程序被设计为当指定 选项时显示某些东西否则不显示 不添加这一选项时程序没有提示任何错误而退出表明这一选项确实是可选的 注意如果一个可选参数没有被使用时相关变量被赋值为 在此 例中是 这也就是为什么它在 语句中被当作逻辑假 帮助信息有点不同 使用 选项时必须指定一个值但可以是任何值 上述例子接受任何整数值作为 的参数但对于我们的简单程序而言只有两个值有实际意义 或者 让我们据此修改代码 和输出 程序运行情况如下 现在这一选项更多地是一个标志而非需要接受一个值的什么东西 我们甚 至改变了选项的名字来符合这一思路 注意我们现在指定了一个新的关键词 并赋值为 这意味着当这一选项存在时为 赋值为 没有指定时则隐含地赋值为 当你为其指定一个值时它会报错符合作为标志的真正的精神 留意不同的帮助文字 短选项 如果你熟悉命令行的用法你会发现我还没讲到这一选项的短版本 这也很简单 效果就像这样 可以注意到这一新的能力也反映在帮助文本里 结合位置参数和可选参数 进行一些小小的改进 如果我们想扩展我们的简短程序来执行其他幂次的运算而不仅是乘方 输出 请注意到目前为止我们一直在使用详细级别来 更改 所显示的文本 以下示例则使用详细级别来显示 更多的 文本 输出 矛盾的选项 后记 除了这里显示的内容 模块还提供了更多功能 它的文档相当详细和完整包含大量示例 完成这个教程之后你应该能毫不困难地阅读该文档 函数式编程指引 概述 形式证明 一个理论上的优点是构造数学证明来说明函数式程序是正确的相对更容易些 很长时间研究者们对寻找证明程序正确的数学方法都很感兴趣 这和通过大量输入来测试并得出程序的输出基本正确或者阅读一个程序的源代码然后得出代码看起来没问题不同相反这里的目标是一个严格的证明证明程序对所有可能的输入都能给出正确的结果 证明程序正确性所用到的技术是写出 不变量也就是对于输入数据和程序中的变量永远为真的特性 然后对每行代码你说明这行代码执行前的不变量 和 以及执行后稍有不同的不变量 和 为真 如此一直到程序结束这时候在程序的输出上不变量应该会与期望的状态一致 函数式编程之所以要消除赋值是因为赋值在这个技术中难以处理赋值可能会破坏赋值前为真的不变量却并不产生任何可以传递下去的新的不变量 不幸的是证明程序的正确性很大程度上是经验性质的而且和 软件无关 即使是微不足道的程序都需要几页长的证明一个中等复杂的程序的正确性证明会非常庞大而且极少甚至没有你日常所使用的程序 解释器 解析器浏览器的正确性能够被证明 即使你写出或者生成一个证明验证证明也会是一个问题里面可能出了差错而你错误地相信你证明了程序的正确性 模块化 易于调试和测试 测试和调试函数式程序相对来说更容易 调试很简单是因为函数通常都很小而且清晰明确 当程序无法工作的时候每个函数都是一个可以检查数据是否正确的接入点 你可以通过查看中间输入和输出迅速找到出错的函数 测试更容易是因为每个函数都是单元测试的潜在目标 在执行测试前函数并不依赖于需要重现的系统状态相反你只需要给出正确的输入然后检查输出是否和期望的结果一致 组合性 当你编写函数式风格的程序时你会写出很多带有不同输入和输出的函数 其中一些不可避免地会局限于特定的应用但其他的却可以广泛的用在程序中 举例来说一个接受文件夹目录返回所有文件夹中的 文件的函数 或是一个接受文件名然后返回文件内容的函数都可以应用在很多不同的场合 久而久之你会形成一个个人工具库 通常你可以重新组织已有的函数来组成新的程序然后为当前的工作写一些特殊的函数 迭代器 支持迭代器的数据类型 我们已经知道列表和元组支持迭代器 实际上 中的任何序列类型比如字符串都自动支持创建迭代器 对字典调用 会返回一个遍历字典的键的迭代器 注意从 开始字典的遍历顺序一定和输入顺序一样 先前的版本并没有明确这一点所以不同的实现可能不一致 对字典使用 总是会遍历键但字典也有返回其他迭代器的方法 如果你只遍历值或者键值对你可以明确地调用 或 方法得到合适的迭代器 构造函数可以接受一个迭代器然后返回一个有限的 元组的数据流 文件也可以通过调用 来遍历直到穷尽文件中所有的行 这意味着你可以像这样读取文件中的每一行 集合可以从可遍历的对象获取内容也可以让你遍历集合的元素 生成器表达式和列表推导式 迭代器的输出有两个很常见的使用方式 对每一个元素执行操作 选择一个符合条件的元素子集 比如给定一个字符串列表你可能想去掉每个字符串尾部的空白字符或是选出所有包含给定子串的字符串 列表推导式和生成器表达时简写 和 让这些操作更加简明这个形式借鉴自函数式程序语言 你可以用以下代码去掉一个字符串流中的所有空白字符 你可以加上条件语句 来选取特定的元素 通过列表推导式你会获得一个 列表 就是一个包含所有结果行的列表并不是迭代器 生成器表达式会返回一个迭代器它在必要的时候计算结果避免一次性生成所有的值 这意味着如果迭代器返回一个无限数据流或者大量的数据列表推导式就不太好用了 这种情况下生成器表达式会更受青睐 生成器表达式两边使用圆括号 而列表推导式则使用方括号 生成器表达式的形式为 再次说明列表推导式只有两边的括号不一样方括号而不是圆括号 这些生成用于输出的元素会成为 的后继值 其中 语句是可选的如果给定的话 只会在符合条件时计算并加入到结果中 生成器表达式总是写在圆括号里面不过也可以算上调用函数时用的括号 如果你想即时创建一个传递给函数的迭代器可以这么写 其中 语句包含了将要遍历的序列 这些序列并不必须同样长因为它们会从左往右开始遍历而 不是 同时执行 对每个 中的元素 会从头开始遍历 会对每个 和 的元素对开始遍历 换句话说列表推导式器是和下面的 代码等价 这说明如果有多个 语句而没有 语句输出结果的长度就是所有序列长度的乘积 如果你的两个列表长度为 那么输出的列表长度就是 为了不让 语法变得含糊如果 会生成元组那这个元组必须要用括号括起来 下面第一个列表推导式语法错误第二个则是正确的 生成器 向生成器传递值 内置函数 模块 模块包含很多常用的迭代器以及用来组合迭代器的函数 本节会用些小的例子来介绍这个模块的内容 这个模块里的函数大致可以分为几类 从已有的迭代器创建新的迭代器的函数 接受迭代器元素作为参数的函数 选取部分迭代器输出的函数 给迭代器输出分组的函数 创建新的迭代器 返回一个等分的无限数据流 初始值默认为 间隔默认为 你也选择可以指定初始值和间隔 保存一份所提供的可迭代对象的副本并返回一个能产生整个可迭代对象序列的新迭代器 新迭代器会无限重复这些元素 返回 次所提供的元素当 不存在时返回无数次所提供的元素 接受任意数量的可迭代对象作为输入首先返回第一个迭代器的所有元素然后是第二个的所有元素如此一直进行下去直到消耗掉所有输入的可迭代对象 返回一个所输入的迭代器切片的数据流 如果只单独给定 参数的话它会返回从起始算起 个数量的元素 如果你提供了起始下标 你会得到 个元素如果你给定了 参数数据流会跳过相应的元素 和 里的字符串和列表切片不同你不能在 或者 这些参数中使用负数 可以复制一个迭代器它返回 个能够返回源迭代器内容的独立迭代器 如果你不提供参数 默认值为 复制迭代器需要保存源迭代器的一部分内容因此在源迭代器比较大的时候会显著地占用内存同时在所有新迭代器中有一个迭代器会比其他迭代器占用更多的内存 对元素使用函数 模块包含一组对应于 操作符的函数 比如 把两个数加起来 和 相同以及 返回获取 属性的可调用对象 假定可迭代对象能够返回一个元组的流并且利用这些元组作为参数来调用 选择元素 另外一系列函数根据谓词选取一个迭代器中元素的子集 和 相反返回所有让 返回 的元素 返回一直让 返回 的元素 一旦 返回 迭代器就会发出终止结果的信号 在 返回 的时候丢弃元素并且返回可迭代对象的剩余结果 接受两个迭代器然后返回 中使相应地 中的元素为真的元素它会在任一个迭代器耗尽的时候停止 组合函数 返回一个迭代器它能给出输入迭代器中所包含的元素的所有可能的 元元组的组合 每个元组中的元素保持着 可迭代对象 返回他们的顺序 例如在上面的例子中数字 总是会在 或 前面 一个类似的函数 取消了保持顺序的限制返回所有可能的长度为 的排列 如果你不提供 参数的值它会使用可迭代对象的长度也就是说会排列所有的元素 注意这些函数会输出所有可能的位置组合并不要求 可迭代对象 的内容不重复 同一个元组 出现了两次但是两个 字符来自不同的位置 函数放松了一个不同的限制元组中的元素可以重复 从概念讲为每个元组第一个位置选取一个元素然后在选择第二个元素前替换掉它 为元素分组 我要讨论的最后一个函数 是最复杂的函数 是一个可以对迭代器返回的每个元素计算键值的函数 如果你不提供这个键值函数它就会简化成每个元素自身 从所依据的可迭代对象中连续地收集具有相同值的元素然后返回一个长度为 的元组的数据流 每个元组包含键值以及对应这个键值的元素所组成的迭代器 假定了所依据的可迭代对象的内容已经根据键值排序 注意返回的迭代器也会使用所依据的可迭代对象所以在请求迭代器 和相应的键之前你必须先消耗迭代器 的结果 模块 中的 模块包含了一些高阶函数 高阶函数 接受一个或多个函数作为输入返回新的函数 这个模块中最有用的工具是 函数 对于用函数式风格编写的程序有时你会希望通过给定部分参数将已有的函数构变形称新的函数 考虑一个 函数 你希望创建一个和 等价的新函数 也就是说你给定了 的一个参数的值 这就是所谓的部分函数应用 接受参数 它会返回一个可调用的对象所以你能够直接调用这个结果以使用给定参数的 这里有一个很小但很现实的例子 持续地在可迭代对象的所有元素上执行操作因此它不能够用在无限的可迭代对象上 必须是一个接受两个元素并返回一个值的函数 接受迭代器返回的前两个元素 和 并计算 然后它会请求第三个元素 计算 然后把这个结果再和第四个元素组合并返回如此继续下去直到消耗整个可迭代对象 如果输入的可迭代对象完全不返回任何值 异常就会抛出 如果提供了初值 它会被用作起始值也就是先计算 如果你在 中使用 你就会把可迭代对象中的所有元素加起来 这种情况非常常见 所以 有一个特殊的内置函数 不过 对于很多使用 的情形 使用明显的 循环会更清晰 一个相关的函数是 它执行同样的计算 不过相对于只返回最终结果 会返回一个迭代器来输出所有中间结果 模块 前面已经提到了 模块 它包含一系列对应于 操作符的函数 在函数式风格的代码中这些函数通常很有用可以帮你省下不少时间避免写一些琐碎的仅仅执行一个简单操作的函数 这个模块里的一些函数 数学运算 逻辑运算 位运算 比较 和 确认对象 全部函数列表可以参考 模块的文档 小函数和 表达式 编写函数式风格程序时你会经常需要很小的函数作为谓词函数或者以某种方式来组合元素 如果合适的 内置的或者其他模块中的函数你就一点也不需要定义新的函数 如果不存在你需要的函数你就必须自己编写 一个编写小函数的方式是使用 表达式 接受一组参数以及组合这些参数的表达式它会创建一个返回表达式值的匿名函数 另一种替代方案就是通常的使用 语句来定义函数 哪一种更受青睐呢 这是一个风格问题我通常的做法是避免使用 我这么偏好的一个原因是 能够定义的函数非常受限 函数的结果必须能够作为单独的表达式来计算这意味着你不能使用多路 比较或者 语句 如果你尝试在 语句中做太多事情你最终会把表达式过于复杂以至于难以阅读 你能快速的说出下面的代码做了什么事情吗 你可以弄明白不过要花上时间来理清表达式来搞清楚发生了什么 使用一个简短的嵌套的 语句可以让情况变得更好 如果我仅仅使用一个 循环会更好 或者使用内置的 和一个生成器表达式 许多使用 的情形可以更清晰地写成 循环的形式 曾经建议以下一组规则来重构 的使用 写一个 函数 写一句注释来说明这个 究竟干了什么 研究一会这个注释然后想出一个抓住注释本质的名字 用这个名字把这个 改写成 语句 把注释去掉 我非常喜欢这些规则不过你完全有权利争辩这种消除 的风格是不是更好 修订记录和致谢 作者要感谢以下人员对本文各种草稿给予的建议更正和协助 版 年 月 日发布 版 年 月 日发布 修正拼写错误 版 年 月 日发布 将 与 两节合二为一 修正拼写错误 版 加入了 邮件列表中建议的更多参考文件 版 添加了有关 模块的小节由 撰写添加了有关 模块的简短小节其他少量修改 引用文献 通用文献 和 著 全文可见 在这部计算机科学的经典教科书中第二和第三章讨论了使用序列和流来组织程序内部的数据传递 书中的示例采用 语言但其中这些章节中描述的很多设计方法同样适用于函数式风格的 代码 一个使用 示例的函数式编程的总体介绍有很长的历史说明 一般性的函数式编程的 条目 协程条目 函数柯里化条目 相关 书中的第一章 标题部分讨论了文本处理的函数式编程 还在 的 站点上针对函数式编程撰写了一系列共 篇文章参见 和 文档 模块文档 模块文档 模块文档 描述了 中新的生成器特性 使用 和 检测 作者 作者 和 是监控工具它们都提供了一种检查计算机系统上的进程的方法 它们都使用特定领域的语言允许用户编写脚本其中 进程监视的过滤器 从感兴趣的进程中收集数据 生成有关数据的报告从 开始 可以使用嵌入式标记构建也称为探测器可以通过 或 脚本观察从而更容易监视系统上的 进程正在做什么 标记是 解释器的实现细节 不保证 版本之间的探针兼容性 更改 版本时 脚本可能会停止工作或无法正常工作而不会发出警告 启用静态标记 内置了对 的支持 在 上为了使用 的嵌入式标记构建 必须安装 开发工具 在 机器上这可以通过 或者 然后必须将 配置为 在 上您可以通过在后台运行 进程列出可用的 探测器并列出 程序提供的所有探测器 在 上您可以通过查看是否包含 部分来验证构建的二进制文件中是否存在 静态标记 如果您已将 构建为共享库使用 则需要在共享库中查找 例如 足够现代的 命令可以打印元数据 上述元数据包含 的信息描述如何修补策略性放置的机器代码指令以启用 脚本使用的跟踪钩子 静态 探针 静态 标记 使用 集成的底层方法是直接使用静态标记 这需要你显式地说明包含它们的二进制文件 例如这个 脚本可以用来显示 脚本的调用返回层次结构 它可以这样调用 输出结果会像这样 其中的列是 脚本开始后经过的微秒数 可执行文件的名字 进程的 其余部分则表示脚本执行时的调用返回层次结构 对于 构建的 来说这些标记是包含在 共享库中的探针的点状路径需要反映这一点 比如上面例子中的这一行 应改为 假设是 的调试构建 可用的静态标记 示例 常用指引 常用指引的形式来源于 文档项目的常用指引章节是一系列独立 指定主题并尝试完全覆盖该主题的文章集合 致力于提供比 库参考帮助更详尽的文档 目前提供了如下指引 将 代码迁移到 将扩展模块移植到 用 进行 编程 描述器使用指南 函数式编程指引 日志 日志操作手册 正则表达式 套接字编程指南 排序指南 指南 使用 包获取网络资源 教程 模块介绍 使用 和 检测 正则表达式 作者 摘要本文档是在 中使用 模块使用正则表达式的入门教程 它提供了比标准库参考中相应部分更平和的介绍 概述 正则表达式称为 或正则或正则表达式模式本质上是嵌入在 中的一种微小的 高度专业化的编程语言可通过 模块获得 使用这种小语言你可以为要匹配的可能字符串集指定规则此集可能包含英语句子电子邮件地址 命令或你喜欢的任何内容 然后您可以询问诸如此字符串是否与模式匹配 或此字符串中的模式是否匹配 等问题 你还可以使用正则修改字符串或以各种方式将其拆分 正则表达式模式被编译成一系列字节码然后由用 编写的匹配引擎执行 对于高级用途可能需要特别注意引擎如何执行给定的正则并将正则写入以某种方式生成运行速度更快的字节码 本文档未涉及优化因为它要求你充分了解匹配引擎的内部结构 正则表达式语言相对较小且受限制因此并非所有可能的字符串处理任务都可以使用正则表达式完成 还有一些任务 可以 用正则表达式完成但表达式变得非常复杂 在这些情况下你最好编写 代码来进行处理虽然 代码比精心设计的正则表达式慢但它也可能更容易理解 简单模式 我们首先要了解最简单的正则表达式 由于正则表达式用于对字符串进行操作因此我们将从最常见的任务开始匹配字符 有关正则表达式确定性和非确定性有限自动机的计算机科学的详细解释你可以参考几乎所有有关编写编译器的教科书 匹配字符 大多数字母和字符只会匹配自己 例如正则表达式 将完全匹配字符串 你可以启用一个不区分大小写的模式让这个正则匹配 或 稍后会详细介绍 这条规则有例外一些字符是特殊的 并且不匹配自己 相反它们表示应该匹配一些与众不同的东西或者通过重复它们或改变它们的含义来影响正则的其他部分 本文档的大部分内容都致力于讨论各种元字符及其功能 这是元字符的完整列表它们的意思将在本 的其余部分讨论 我们将看到的第一个元字符是 和 它们用于指定字符类它是你希望匹配的一组字符 可以单独列出字符也可以通过给出两个字符并用 标记将它们分开来表示一系列字符 例如 将匹配任何字符 或 这与 相同它使用一个范围来表示同一组字符 如果你只想匹配小写字母你的正则是 字符类中的元字符不生效 例如 将匹配 或 中的任意字符 通常是一个元字符但在一个字符类中它被剥夺了特殊性 你可以通过以下方式匹配 设置的字符类中未列出的字符 这通过包含一个 作为该类的第一个字符来表示 例如 将匹配除 之外的任何字符 如果插入符出现在字符类的其他位置则它没有特殊含义 例如 将匹配 或 也许最重要的元字符是反斜杠 与 字符串文字一样反斜杠后面可以跟各种字符以指示各种特殊序列 它也用于转义所有元字符因此您仍然可以在模式中匹配它们例如如果你需要匹配 或 你可以在它们前面加一个反斜杠来移除它们的特殊含义 或 一些以 开头的特殊序列表示通常有用的预定义字符集例如数字集 字母集或任何非空格的集合 让我们举一个例子 匹配任何字母数字字符 如果正则表达式模式以字节类表示这相当于类 如果正则表达式是一个字符串 将匹配由 模块提供的 数据库中标记为字母的所有字符 通过在编译正则表达式时提供 标志可以在字符串模式中使用更为受限制的 定义 以下特殊序列列表不完整 有关 字符串模式的序列和扩展类定义的完整列表请参阅标准库参考中的最后一部分 正则表达式语法 通常 版本匹配 数据库中相应类别中的任何字符 匹配任何十进制数字这等价于类 匹配任何非数字字符这等价于类 匹配任何空白字符这等价于类 匹配任何非空白字符这相当于类 匹配任何字母与数字字符这相当于类 匹配任何非字母与数字字符这相当于类 这些序列可以包含在字符类中 例如 是一个匹配任何空格字符的字符类或者 或 本节的最后一个元字符是 它匹配除换行符之外的任何内容并且有一个可选模式 甚至可以匹配换行符 常用于你想匹配任何字符的地方 重复 能够匹配不同的字符集合是正则表达式可以做的第一件事这对于字符串可用方法来说是不可能的 但是如果这是正则表达式的唯一额外功能那么它们就不会有太大的优势 另一个功能是你可以指定正则的某些部分必须重复一定次数 重复中我们要了解的第一个元字符是 与字面字符 不匹配相反它指定前一个字符可以匹配零次或多次而不是恰好一次 例如 将匹配 个 字符 个 个 字符等等 类似 这样的重复是 贪婪的当重复正则时匹配引擎将尝试尽可能多地重复它 如果模式的后续部分不匹配则匹配引擎将回退并以较少的重复次数再次尝试 一个逐步的例子将使这更加明显 让我们考虑表达式 这个正则匹配字母 类 中的零或多个字母最后以 结尾 现在想象一下这个正则与字符串 匹配 步骤 匹配 解释 正则中的 匹配 引擎尽可能多地匹配 直 到字符串结束 失败 引擎尝试匹配 但是当前位置位 于字符串结束所以匹配失败 回退一次 少匹配一个字符 失败 再次尝试匹配 但是当前位置 是最后一个字符 再次回退所以 只匹配 再试一次 这次当前位置的字 符是 所以它成功了 正则现在已经结束了它已经匹配了 这演示了匹配引擎最初如何进行如果没有找到匹配它将逐步回退并一次又一次地重试正则的其余部分 它将回退直到它为 尝试零匹配如果随后失败引擎将断定该字符串与正则完全不匹配 另一个重复的元字符是 它匹配一次或多次 要特别注意 和 之间的区别 匹配 零次 或更多次因此重复的任何东西都可能根本不存在而 至少需要 一次 使用类似的例子 将匹配 个 个 但不会匹配 还有两个重复限定符 问号字符 匹配一次或零次你可以把它想象成是可选的 例如 匹配 或 最复杂的重复限定符是 其中 和 是十进制整数 这个限定符意味着必须至少重复 次最多重复 次 例如 将匹配 和 它不匹配没有斜线的 或者有四个的 你可以省略 或 在这种情况下将假定缺失值的合理值 省略 被解释为 下限而省略 则为无穷大的上限 还原论者的读者可能会注意到其他三个限定符都可以用这种表示法表达 与 相同 相当于 和 相同 最好使用 或 只要因为它们更短更容易阅读 使用正则表达式 现在我们已经看了一些简单的正则表达式我们如何在 中实际使用它们 模块提供了正则表达式引擎的接口允许你将正则编译为对象然后用它们进行匹配 编译正则表达式 正则表达式被编译成模式对象模式对象具有各种操作的方法例如搜索模式匹配或执行字符串替换 也接受一个可选的 参数用于启用各种特殊功能和语法变体 我们稍后将介绍可用的设置但现在只需一个例子 正则作为字符串传递给 正则被处理为字符串因为正则表达式不是核心 语言的一部分并且没有创建用于表达它们的特殊语法 有些应用程序根本不需要正则因此不需要通过包含它们来扩展语言规范 相反 模块只是 附带的 扩展模块就类似于 或 模块 将正则放在字符串中可以使 语言更简单但有一个缺点是下一节的主题 反斜杠灾难 应用匹配 一旦你有一个表示编译正则表达式的对象你用它做什么 模式对象有几种方法和属性 这里只介绍最重要的内容请参阅 文档获取完整列表 方法 属性 目的 确定正则是否从字符串的开头匹配 扫描字符串查找此正则匹配的任何位置 找到正则匹配的所有子字符串并将它们作为列表返 回 找到正则匹配的所有子字符串并将它们返回为一个 如果没有找到匹配 和 返回 如果它们成功 一个 匹配对象 实例将被返回包含匹配相关的信息起始和终结位置 匹配的子串以及其它 你可以通过交互式实验 模块来了解这一点 如果你有 你可能还想查看 这是 发行附带的演示程序 它允许你输入正则和字符串并显示 是匹配还是失败 在尝试调试复杂的正则时非常有用 本 使用标准 解释器作为示例 首先运行 解释器导入 模块然后编译一个正则 现在你可以尝试匹配正则 的各种字符串 空字符串根本不匹配因为 表示一次或多次重复 在这种情况下应返回 这将导致解释器不打印输出 你可以显式打印 的结果使其清晰 现在让我们尝试一下它应该匹配的字符串例如 在这个例子中 将返回一个 匹配对象因此你应该将结果储存到一个变量中以供稍后使用 现在你可以检查 匹配对象 以获取有关匹配字符串的信息 匹配对象实例也有几个方法和属性最重要的是 方法 属性 目的 返回正则匹配的字符串 返回匹配的开始位置 返回匹配的结束位置 返回包含匹配 位置的元组 尝试这些方法很快就会清楚它们的含义 返回正则匹配的子字符串 和 返回匹配的起始和结束索引 在单个元组中返回开始和结束索引 由于 方法只检查正则是否在字符串的开头匹配所以 将始终为零 但是模式的 方法会扫描字符串因此在这种情况下匹配可能不会从零开始 在实际程序中最常见的样式是在变量中存储 匹配对象然后检查它是否为 这通常看起来像 两种模式方法返回模式的所有匹配项 返回匹配字符串的列表 在这个例子中需要 前缀使字面为原始字符串字面因为普通的加工字符串字面中的转义序列不能被 识别为正则表达式导致 并最终产生 请参阅 反斜杠灾难 必须先创建整个列表才能返回结果 方法将一个匹配对象 的序列返回为一个 模块级别函数 你不必创建模式对象并调用其方法 模块还提供了顶级函数 等等 这些函数采用与相应模式方法相同的参数并将正则字符串作为第一个参数添加并仍然返回 或 匹配对象 实例 本质上这些函数只是为你创建一个模式对象并在其上调用适当的方法 它们还将编译对象存储在缓存中因此使用相同的未来调用将不需要一次又一次地解析该模式 你是否应该使用这些模块级函数还是应该自己获取模式并调用其方法 如果你正在循环中访问正则表达式预编译它将节省一些函数调用 在循环之外由于有内部缓存没有太大区别 编译标志 编译标志允许你修改正则表达式的工作方式 标志在 模块中有两个名称长名称如 和一个简短的单字母形式例如 如果你熟悉 的模式修饰符则单字母形式使用和其相同的字母例如 的缩写形式为 多个标志可以 通过按位或运算来指定它们例如 设置 和 标志 这是一个可用标志表以及每个标志的更详细说明 标志 意义 使几个转义如 和 匹配仅 与具有相应特征属性的 字符匹配 使 匹配任何字符包括换行符 进行大小写不敏感匹配 进行区域设置感知匹配 多行匹配影响 和 为 扩展 启用详细的正则可以更清晰更容易理解 执行不区分大小写的匹配字符类和字面字符串将通过忽略大小写来匹配字 母 例如 也匹配小写字母 除非使用 标志来禁用非 匹配否则完全 匹配也有效 当 模式 或 与 标志结合使用时它们将匹配 个 字母 和 个额外的非 字母 拉丁大写字母 带上面的点 拉丁文小写字母无点 拉丁文小写字母 长 和 开尔文符号 将匹配 或 后者仅在 模式下匹配 此小写不考虑 当前区域设置如果你还设置了 标志则将考虑 使 和大小写敏感匹配依赖于当前区域而不是 数据库 区域设置是 库的一个功能旨在帮助编写考虑到语言差异的程序 例如 如果你正在处理编码的法语文本那么你希望能够编写 来匹配单词 但 只匹配字符类 字节模式它不会匹配对应于 或 的字节 如果你的系统配置正确并且选择了法语区域设置某些 函数将 告诉程序对应于 的字节也应该被视为字母 在编译正则表达式时设置 标志将导致生成的编译对象将这些 函数用于 这比较慢但 也可以使 匹配你所期望的法语单词 在 中不鼓励使用此标 志因为语言环境机制非常不可靠它一次只处理一个文化它只适用于 位语言环境 默认情况下 中已经为 模式启用 了 匹配并且它能够处理不同的区域语言 和 还没有解释它们将在以下部分介绍 更多元字符 通常 只匹配字符串的开头而 只匹配字符串的结尾紧接在字符 串末尾的换行符如果有的话之前 当指定了这个标志时 匹配字符 串的开头和字符串中每一行的开头紧跟在每个换行符之后 类似地 元字符匹配字符串的结尾和每行的结尾紧接在每个换行符之前 使 特殊字符匹配任何字符包括换行符没有这个标志 将匹 配任何字符 除了 换行符 使 和 执行仅 匹配而不是完整 匹配 匹配 这仅对 模式有意义并且对于字节模式将被 忽略 此标志允许你编写更易读的正则表达式方法是为您提供更灵活的格式化方 式 指定此标志后将忽略正则字符串中的空格除非空格位于字符类中或 前面带有未转义的反斜杠这使你可以更清楚地组织和缩进正则 此标志还 允许你将注释放在正则中引擎将忽略该注释注释标记为 既不是在 字符类中也不是在未转义的反斜杠之前 例如这里的正则使用 看看阅读有多容易 如果没有详细设置正则将如下所示 在上面的例子中 的字符串文字的自动连接已被用于将正则分解为更 小的部分但它仍然比以下使用 版本更难理解 更多模式能力 到目前为止我们只介绍了正则表达式的一部分功能 在本节中我们将介绍一些新的元字符以及如何使用组来检索匹配的文本部分 更多元字符 我们还没有涉及到一些元字符 其中大部分内容将在本节中介绍 要讨论的其余一些元字符是 零宽度断言 它们不会使解析引擎在字符串中前进一个字符相反它们根本不占用任何字符只是成功或失败 例如 是一个断言指明当前位置位于字边界这个位置根本不会被 改变 这意味着永远不应重复零宽度断言因为如果它们在给定位置匹配一次它们显然可以无限次匹配 或者 运算符 如果 和 是正则表达式 将匹配任何与 或 匹配的字符串 具有非常低的优先级以便在交替使用多 字符字符串时使其合理地工作 将匹配 或 而不是 或 和 要匹配字面 请使用 或将其括在字符类中如 在行的开头匹配 除非设置了 标志否则只会在字符串的开 头匹配 在 模式下这也在字符串中的每个换行符后立即匹 配 例如如果你希望仅在行的开头匹配单词 则要使用的正则 要匹配字面 使用 匹配行的末尾定义为字符串的结尾或者后跟换行符的任何位置 以匹配字面 使用 或者将其包裹在一个字符类中例如 仅匹配字符串的开头 当不在 模式时 和 实际上 是相同的 在 模式中它们是不同的 仍然只在字符串 的开头匹配但 可以匹配在换行符之后的字符串内的任何位置 只匹配字符串尾 字边界 这是一个零宽度断言仅在单词的开头或结尾处匹配 单词被定 义为一个字母数字字符序列因此单词的结尾由空格或非字母数字字符表示 以下示例仅当它是一个完整的单词时匹配 当它包含在另一个单词 中时将不会匹配 使用这个特殊序列时你应该记住两个细微之处 首先这是 的字 符串文字和正则表达式序列之间最严重的冲突 在 的字符串文字中 是退格字符 值为 如果你没有使用原始字符串那么 会将 转换为退格你的正则不会按照你的预期匹配 以下示 例与我们之前的正则看起来相同但省略了正则字符串前面的 其次在一个字符类中这个断言没有用处 表示退格字符以便与 的字符串文字兼容 另一个零宽度断言这与 相反仅在当前位置不在字边界时才匹配 分组 通常你需要获取更多信息而不仅仅是正则是否匹配 正则表达式通常用于通过将正则分成几个子组来解析字符串这些子组匹配不同的感兴趣组件 例如 标题行分为标题名称和值用 分隔如下所示 这可以通过编写与整个标题行匹配的正则表达式来处理并且具有与标题名称匹配的一个组以及与标题的值匹配的另一个组 组由 元字符标记 和 与数学表达式的含义大致相同它们将包含在其中的表达式组合在一起你可以使用重复限定符重复组的内容例如 或 例如 将匹配 的零次或多次重复 用 表示的组也捕获它们匹配的文本的起始和结束索引这可以通过将参数传递给 以及 组从 开始编号 组 始终存在它表示整个正则所以 匹配对象 方法都将组 作为默认参数 稍后我们将看到如何表达不捕获它们匹配的文本范围的组 子组从左到右编号从 向上编号 组可以嵌套要确定编号只需计算从左到右的左括号字符 可以一次传递多个组号在这种情况下它将返回一个包含这些组的相应值的元组 方法返回一个元组其中包含所有子组的字符串从 到最后一个子组 模式中的后向引用允许你指定还必须在字符串中的当前位置找到先前捕获组的内容 例如如果可以在当前位置找到组 的确切内容则 将成功否则将失败 请记住 的字符串文字也使用反斜杠后跟数字以允许在字符串中包含任意字符因此正则中引入反向引用时务必使用原始字符串 例如以下正则检测字符串中的双字 像这样的后向引用通常不仅仅用于搜索字符串 很少有文本格式以这种方式重复数据 但是你很快就会发现它们在执行字符串替换时 非常 有用 非捕获和命名组 精心设计的正则可以使用许多组既可以捕获感兴趣的子串也可以对正则本身进行分组和构建 在复杂的正则中很难跟踪组号 有两个功能可以帮助解决这个问题 它们都使用常用语法进行正则表达式扩展因此我们首先看一下 以其对标准正则表达式的强大补充而闻名 对于这些新功能 开发人员无法选择新的单键击元字符或以 开头的新特殊序列否则 的正则表达式与标准正则容易混淆 例如如果他们选择 作为一个新的元字符旧的表达式将假设 是一个普通字符并且不会编写 或 开发人员选择的解决方案是使用 作为扩展语法 括号后面的 是一个语法错误因为 没有什么可重复的所以这并没有引入任何兼容性问题 紧跟在 之后的字符表示正在使用什么扩展名所以 是一个东西一个正向的先行断言和 是其它东西 包含子表达式 的非捕获组 支持一些 的扩展并增加了新的扩展语法用于 的扩展语法 如果在问号之后的第一个字符为 即表明其为 专属的扩展 现在我们已经了解了一般的扩展语法我们可以回到简化复杂正则中组处理的功能 有时你会想要使用组来表示正则表达式的一部分但是对检索组的内容不感兴趣 你可以通过使用非捕获组来显式表达这个事实 你可以用任何其他正则表达式替换 除了你无法检索组匹配内容的事实外非捕获组的行为与捕获组完全相同你可以在里面放任何东西用重复元字符重复它比如 然后把它嵌入其他组捕获或不捕获 在修改现有模式时特别有用因为你可以添加新组而不更改所有其他组的编号方式 值得一提的是捕获和非捕获组之间的搜索没有性能差异两种形式没有一种更快 更重要的功能是命名组不是通过数字引用它们而是可以通过名称引用组 命名组的语法是 特定的扩展之一 显然是该组的名称 命名组的行为与捕获组完全相同并且还将名称与组关联 处理捕获组的 匹配对象 方法都接受按编号引用组的整数或包含所需组名的字符串 命名组仍然是给定的数字因此你可以通过两种方式检索有关组的信息 此外你可以通过 将命名分组提取为一个字典 命名组很有用因为它们允许你使用容易记住的名称而不必记住数字 这是来自 模块的示例正则 检索 显然要容易得多而不必记住检索第 组 表达式中的后向引用语法例如 指的是组的编号 当然有一种变体使用组名而不是数字 这是另一个 扩展 表示在当前点再次匹配名为 的组的内容 用于查找双字的正则表达式 也可以写为 前向断言 修改字符串 到目前为止我们只是针对静态字符串执行搜索 正则表达式通常也用于以各种方式修改字符串使用以下模式方法 方法 属性 目的 将字符串拆分为一个列表在正则匹配的任何地方将 其拆分 找到正则匹配的所有子字符串并用不同的字符串替 换它们 与 相同但返回新字符串和替换次数 分割字符串 模式的 方法在正则匹配的任何地方拆分字符串返回一个片段列表 它类似于 字符串方法但在分隔符的分隔符中提供了更多的通用性字符串的 仅支持按空格或固定字符串进行拆分 正如你所期望的那样还有一个模块级 函数 通过正则表达式的匹配拆分 字符串 如果在正则中使用捕获括号则它 们的内容也将作为结果列表的一部分返回 如果 非零则最多 执行 次拆分 你可以通过传递 的值来限制分割的数量 当 非零时将最多进行 次拆分并且字符串的其余部分将作为列表的最后一个元素返回 在以下示例中分隔符是任何非字母数字字符序列 有时你不仅对分隔符之间的文本感兴趣而且还需要知道分隔符是什么 如果在正则中使用捕获括号则它们的值也将作为列表的一部分返回 比较以下调用 模块级函数 添加要正则作为第一个参数但在其他方面是相同的 搜索和替换 常见问题 正则表达式对于某些应用程序来说是一个强大的工具但在某些方面它们的行为并不直观有时它们的行为方式与你的预期不同 本节将指出一些最常见的陷阱 使用字符串方法 有时使用 模块是一个错误 如果你匹配固定字符串或单个字符类并且你没有使用任何 功能例如 标志那么正则表达式的全部功能可能不是必需的 字符串有几种方法可以使用固定字符串执行操作它们通常要快得多因为实现是一个针对此目的而优化的单个小 循环而不是大型 更通用的正则表达式引擎 一个例子可能是用另一个固定字符串替换一个固定字符串例如你可以用 替换 看起来像是用于此的函数但请考虑 方法 注意 也会替换单词里面的 把 变成 但简单的正则 也会这样做 为了避免对单词的部分进行替换模式必须是 以便要求 在任何一方都有一个单词边界 这使得工作超出了 的能力 另一个常见任务是从字符串中删除单个字符的每个匹配项或将其替换为另一个字符 你可以用 之类的东西来做这件事但是 能够完成这两项任务并且比任何正则表达式都快 简而言之在转向 模块之前请考虑是否可以使用更快更简单的字符串方法解决问题 和 另一方面 将向前扫描字符串报告它找到的第一个匹配项 有时你会被诱惑继续使用 只需在你的正则前面添加 抵制这种诱惑并使用 代替 正则表达式编译器对正则进行一些分析以加快寻找匹配的过程 其中一个分析可以确定匹配的第一个特征必须是什么例如以 开头的模式必须与 匹配 分析让引擎快速扫描字符串寻找起始字符只在找到 时尝试完全匹配 添加 会使这个优化失效需要扫描到字符串的末尾然后回溯以找到正则的其余部分的匹配 使用 代替 贪婪与非贪婪 当重复一个正则表达式时就像在 中一样最终的动作就是消耗尽可能多的模式 当你尝试匹配一对对称分隔符例如 标记周围的尖括号时这个事实经常会让你感到困惑 因为 的贪婪性质 用于匹配单个 标记的简单模式不起作用 正则匹配 中的 和 消耗字符串的其余部分 正则中还有更多的剩余东西并且 在字符串的末尾不能匹配所以正则表达式引擎必须逐个字符地回溯直到它找到匹配 最终匹配从 中的 扩展到 中的 而这并不是你想要的结果 在这种情况下解决方案是使用非贪婪的限定符 或 匹配为尽可能 少 的文字 在上面的例子中在第一次 匹配后立即尝试 当它失败时引擎一次前进一个字符每一步都重试 这产生了正确的结果 请注意使用正则表达式解析 或 很痛苦 快而脏的模式将处理常见情况但 和 有特殊情况会破坏明显的正则表达式当你编写正则表达式处理所有可能的情况时模式将非常复杂 使用 或 解析器模块来执行此类任务 使用 到目前为止你可能已经注意到正则表达式是一种非常紧凑的表示法但它们并不是非常易读 具有中等复杂度的正则可能会成为反斜杠 括号和元字符的冗长集合使其难以阅读和理解 对于这样的正则在编译正则表达式时指定 标志可能会有所帮助因为它允许你更清楚地格式化正则表达式 标志有几种效果 正则表达式中的 不是 在字符类中的空格将被忽略 这意味着表达式如 等同于不太可读的 但 仍将匹配字符 或空格 此外你还可以在正则中放置注释注释从 字符扩展到下一个换行符 当与三引号字符串一起使用时这使正则的格式更加整齐 这更具有可读性 反馈 正则表达式是一个复杂的主题 这份文档是否有助于你理解它们 是否存在不清楚的部分或者你遇到的问题未在此处涉及 如果是请向作者发送改进建议 关于正则表达式的最完整的书几乎肯定是由 出版的 的 不幸的是它专注于 和 的正则表达式并且根本不包含任何 材料因此它不能用作 编程的参考 第一版涵盖了 现在删除的 模块这对你没有多大帮助 考虑从你的图书馆中查找它 排序指南 作者 和 发布版本 列表有一个内置的 方法可以直接修改列表 还有一个 内置函数它会从一个可迭代对象构建一个新的排序列表 在本文档中我们将探索使用 对数据进行排序的各种技术 基本排序 关键函数 和 都有一个 形参用来指定在进行比较前要在每个列表元素上调用的函数或其他可调用对象 例如下面是一个不区分大小写的字符串比较 形参的值应该是个函数或其他可调用对象它接受一个参数并返回一个用于排序的键 这种机制速度很快因为对于每个输入记录只会调用一次键函数 一种常见的模式是使用对象的一些索引作为键对复杂对象进行排序 例如 同样的技术也适用于具有命名属性的对象 例如 模块函数 上面显示的键函数模式非常常见因此 提供了便利功能使访问器功能更容易更快捷 模块有 和 函数 使用这些函数上述示例变得更简单更快捷 模块功能允许多级排序 例如按 排序然后按 排序 升序和降序 和 接受布尔值的 参数 这用于标记降序排序 例如要以反向 顺序获取学生数据 排序稳定性和排序复杂度 排序保证是 稳定 的 这意味着当多个记录具有相同的键值时将保留其原始顺序 注意 的两个记录如何保留它们的原始顺序以便 保证在 之前 这个美妙的属性允许你在一系列排序步骤中构建复杂的排序 例如要按 降序然后 升序对学生数据进行排序请先 排序然后再使用 排序 这可以被抽象为一个包装函数该函数能接受一个列表以及字段和顺序的元组以对它们进行多重排序 中使用的 算法可以有效地进行多种排序因为它可以利用数据集中已存在的任何排序 使用装饰排序去装饰的旧方法 这个三个步骤被称为 首先初始列表使用控制排序顺序的新值进行修饰 然后装饰列表已排序 最后删除装饰创建一个仅包含新排序中初始值的列表 例如要使用 方法按 对学生数据进行排序 这方法语有效是因为元组按字典顺序进行比较先比较第一项如果它们相同则比较第二个项目依此类推 不一定在所有情况下都要在装饰列表中包含索引 但包含它有两个好处 排序是稳定的 如果两个项具有相同的键它们的顺序将保留在排序列表中 原始项目不必具有可比性因为装饰元组的排序最多由前两项决定 因此 例如原始列表可能包含无法直接排序的复数 这个方法的另一个名字是 在 程序员中推广的 既然 排序提供了键函数那么通常不需要这种技术 使用 参数的旧方法 本 中给出的许多结构都假定为 或更高版本 在此之前没有内置 也没有关键字参数 相反所有 版本都支持 参数来处理用户指定的比较函数 在 中 参数被完全删除作为简化和统一语言努力的一部分消除了丰富的比较与 魔术方法之间的冲突 在 中 允许一个可选函数可以调用它来进行比较 该函数应该采用两个参数进行比较然后返回负值为小于如果它们相等则返回零或者返回大于大于的正值 例如我们可以这样做 或者你可反转比较的顺序 将代码从 移植到 时如果用户提供比较功能并且需要将其转换为键函数则会出现这种情况 以下包装器使这很容易 要转换为键函数只需包装旧的比较函数 在 中 函数被添加到标准库中的 模块中 其它 对于区域相关的排序请使用 作为键函数或者 作为比较函数 参数仍然保持排序稳定性因此具有相等键的记录保留原始顺序 有趣的是通过使用内置的 函数两次可以在没有参数的 情况下模拟该效果 在两个对象之间进行比较时保证排序例程使用 因此通过 定义 方法可以很容易地为类添加标准排序顺序 键函数不需要直接依赖于被排序的对象 键函数还可以访问外部资源 例如 如果学生成绩存储在字典中则可以使用它们对单独的学生姓名列表进行排序 用 进行 编程 作者 发布版本 摘要本文档介绍了如何使用 扩展模块控制文本模式的显示 是什么 的 模块 此 模块相当简单地封装了 提供的 函数如果你已经熟悉在 语言中使用 编程把这些知识转移的 是非常容易的 最大的差异在于 中的接口通过把不同的 函数合并来让事情变得更简单比如 和 三个 函数被并入 这一个方法 下文中会描述更多的细节 本 是关于使用 和 编写文本模式程序的概述 它并不被设计为一个 的完整指南如需完整指南请参见 的 库指南章节和 的 手册页 相对地本 将会给你一些基本思路 开始和结束 应用程序 窗口和面板 显示文字 属性和颜色 用户输入 库提供了非常简单的输入机制 的 模块添加了一个基本的文本输入控件 其他的库例如 拥有更丰富的控件集 有两个方法可以从窗口获取输入 会刷新屏幕然后等待用户按键如果之前调用过 还会显 示所按的键 你还可以选择指定一个坐标以便在暂停之前让光标移动到那里 将做同样的事但是会把整数转换为字符串 每个字符将返回为长 度为 个字符的字符串特殊键例如函数键将返回包含键名的较长字符串例 如 或 使用 窗口方法可以做到不等待用户 在 之后窗口的 和 将成为非阻塞的 为表明输入未就绪 会返回 值为 而 会引发异常 此外还有 函数它可被用来实际地在每个 上设置一个计时器如果在指定的延迟内没有输入可用以十分之一秒为单位 将引发异常 方法返回一个整数如果数值在 到 之间它代表所按下键的 码 大于 的值为特殊键例如 或方向键等 你可以将返回的值与 或 等常量做比较 你的程序主循环看起来可能是这样 模块提供了一些 类成员函数它们接受整数或长度为 个字符的字符串参数这些函数在为这样的循环编写更具可读性的测试时可能会很有用 它还提供了一些转换函数它们接受整数或长度为 个字符的字符串参数并返回同样的类型 例如 返回与其参数相对应的控制字符 还有一个可以提取整个字符串的方法 它并不经常被使用因为它的功能相当受限可用的编辑键只有 和 键它们会结束字符串 也可以选择限制为固定数量的字符 模块提供了一个文本框它支持类似 的键绑定集 类的各种方法支持带输入验证的编辑及包含或不包含末尾空格地收集编辑结果 下面是一个例子 请查看 的库文档了解更多细节 更多的信息 将 代码迁移到 作者 摘要 是 的未来但 仍处于活跃使用阶段最好让您的项目在两个主要版本的 上都可用 本指南旨在帮助您了解如何最好地同时支持 和 如果您希望迁移扩展模块而不是纯 代码请参阅 将扩展模块移植到 如果你想了解核心 开发者对于 的出现有何看法你可以阅读 的 或 的 为什么要有 有关迁移的帮助您可以通过电子邮件向 邮件列表发送问题 简要说明 了解 和 之间的区别 注解 详情 删除对 及更早版本的支持 良好的测试覆盖率 了解 和 之间的区别 更新代码 除法 文本与二进制数据 文本数据 二进制数据 考虑使用可选的静态类型检查 套接字编程指南 作者 摘要套接字几乎无处不在但是它却是被误解最严重的技术之一 这是一篇简单的套接字概述 并不是一篇真正的教程 你需要做更多的事情才能让它工作起来 其中也并没有涵盖细节细节会有很多但是我希望它能提供足够的背景知识让你像模像样的开始使用套接字 套接字 历史 创建套接字 进程间通信 使用一个套接字 二进制数据 通过套接字传送二进制数据是可行的 主要问题在于并非所有机器都用同样的二进制数据格式 比如 芯片用两个十六进制字节 来表示一个 位整数值 而 和 则会做字节反转 即用 来表示 套接字库要求转换 位和 位整数 其中的 表示 表示 表示 表示 在网络序列就是主机序列时它们什么都不做但是如果机器是字节反转的则会适当地交换字节序 在现今的 位机器中二进制数据的 表示往往比二进制表示要小 这是因为在非常多的时候所有 的值均为 或者 字符串形式的 为两个字节而二进制形式则为四个 当然这不适用于固定长度的信息 自行决定请自行决定 断开连接 严格地讲你应该在 它之前将套接字 是发送给套接字另一端的一种建议 调用时参数不同意义也不一样它可能意味着 我不会再发送了但我仍然会监听 或者 我没有监听了真棒 然而大多数套接字库或者程序员都习惯了忽略使用这种礼节因为通常情况下 与 是一样的 所以在大多数情况下不需要显式的 高效使用 的一种方法是在类似 的交换中 客户端发送请求然后执行 这告诉服务器此客户端已完成发送但仍可以接收 服务器可以通过接收 字节来检测 它可以假设它有完整的请求 服务器发送回复 如果 成功完成那么客户端仍在接收 进一步自动关闭并说当一个套接字被垃圾收集时如果需要它会自动执行 但依靠这个机制是一个非常坏的习惯 如果你的套接字在没有 的情况下就消失了那么另一端的套接字可能会无限期地挂起以为你只是慢了一步 完成后 请 你的套接字 套接字何时销毁 使用阻塞套接字最糟糕的事情可能就是当另一边下线时没有 会发生什么 你的套接字可能会挂起 是一种可靠的协议它会在放弃连接之前等待很长时间 如果你正在使用线程那么整个线程基本上已经死了 你无能为力 只要你没有做一些愚蠢的事情比如在进行阻塞读取时持有一个锁那么线程并没有真正消耗掉资源 不要 尝试杀死线程 线程比进程更有效的部分原因是它们避免了与自动回收资源相关的开销 换句话说如果你设法杀死线程你的整个进程很可能被搞坏 非阻塞的套接字 模块介绍 作者 作者 概述本文档旨在简要介绍 模块 它主要针对那些不熟悉 网络术语的用户但也可能对想要速览 如何代表 网络寻址概念的网络工程师有用 创建 对象 因为 是一个用于检查和操作 地址的模块你要做的第一件事就是创建一些对象 您可以使用 从字符串和整数创建对象 关于 版本的说明 对于不太熟悉 寻址的读者重要的是要知道 协议当前正在从协议的版本 转移到版本 转换很大程度上是因为协议的版本 没有提供足够的地址来满足整个世界的需求特别是考虑到越来越多的设备直接连接到互联网 解释协议的两个版本之间的差异的细节超出了本介绍的范围但读者需要至少知道存在这两个版本并且有时需要强制使用一个版本或其他版本 主机地址 定义网络 主机地址通常组合在一起形成 网络因此 提供了一种创建 检查和操作网络定义的方法 网络对象由字符串构成这些字符串定义作为该网络一部分的主机地址范围 该信息的最简单形式是网络地址网络前缀对其中前缀定义了比较的前导比特数以确定地址是否是网络的一部分并且网络地址定义了那些位的预期值 对于地址提供了一个自动确定正确 版本的工厂函数 网络对象不能设置任何主机位 这样做的实际效果是 没有描述网络 这种定义被称为接口对象因为网络上 表示法通常用于描述给定网络上的计算机的网络接口并在下一节中进一步描述 默认情况下尝试创建一个设置了主机位的网络对象将导致 被引发 要请求将附加位强制为零可以将标志 传递给构造函数 虽然字符串形式提供了更大的灵活性但网络也可以用整数定义就像主机地址一样 在这种情况下网络被认为只包含由整数标识的单个地址因此网络前缀包括整个网络地址 与地址一样可以通过直接调用类构造函数而不是使用工厂函数来强制创建特定类型的网络 主机接口 审查 对象 作为 列表 将网络视为列表有时很有用 这意味着它可以像这样索引它们 它还意味着网络对象可以使用像这样的列表成员测试语法 根据网络前缀有效地完成包含性测试 比较 有意义地提供了一些简单 希望直观的比较对象的方法 如果你尝试比较不同版本或不同类型的对象则会引发 异常 将 地址与其他模块一起使用 其他使用 地址的模块例如 通常不会直接接受来自该模块的对象 相反它们必须被强制转换为另一个模块可接受的整数或字符串 实例创建失败时获取更多详细信息 使用与版本无关的工厂函数创建 对象时任何错误都将报告为 带有一般错误消息只是说传入的值未被识别为该类型的对象 缺少特定错误是因为有必要知道该值是假设是 还是 以便提供有关其被拒绝原因的更多详细信息 为了支持访问这些额外细节的用例各个类构造函数实际上引发了 子类 和 以准确指示定义的哪一部分无法正确解析 直接使用类构造函数时错误消息更加详细 例如 但是两个模块特定的异常都有 作为它们的父类所以如果你不关心特定类型的错误你仍然可以编写如下代码 使用 包获取网络资源 作者 注解 这份 文档的早期版本有一份法语的译文可在 处查阅 概述 提取 数据 有时候你想要给一个 发送数据通常这个 指向一个 通用网关接口脚本或者其他 应用 对于 这通常使用一个 请求来完成 比如在浏览器上提交一个 表单 但并不是所有的 都来自表单你能使用一个 来传输任何数据到你自己的应用上 在使用常见的 表单的情况下数据需要以标准的方式编码然后再作为 参数传给 对象 编码需要使用一个来自 库的函数 具体操作如下 处理异常 异常类从 模块中导出 包装起来 数字 注解 由 或者 实例所返回的响应包含两个有用的方法 和 该响应由模块 定义 返回所获取页面的真实 该方法很有用因为 或者所使用的 对象可能回包括一次重定向 所获取页面的 未必就是所请求的 该方法返回一个类似字典的对象描述了所获取的页面特别是由服务器送出的头部信息 目前它是一个 实例 基本认证 代理 注解 注解 脚注 这篇文档由 审订 例如 将扩展模块移植到 对于将扩展模块移植到 我们推荐下列资源 中的 这一章这本书介绍了如何从 迁移到 包括指导读者如 何移植扩展模块 项目中的 提供了有关支持代码的指导性建议 和 库提供了对于 的 的抽象 扩展大都需要进 行重写以使用两者中的一个然后就可以通过库来处理各种 版本和实 现之间的差异 历史和许可证 该软件的历史 由荷兰数学和计算机科学研究学会 见 的 于 年代初设计作为一门叫做 的语言的替代品 尽管 包含了许多来自其他人的贡献 仍是其主要作者 年 在弗吉尼亚州的国家创新研究公司 见 继续他在 上的工作并在那里发布了该软件的多个版本 年五月 和 核心开发团队转到 并组建了 团队 同年十月 团队转到 现为 见 年 软件基金会 见 成立这是一个专为拥有 相关知识产权而创建的非营利组织 现在是 的赞助成员 所有的 版本都是开源的有关开源的定义参阅 历史上绝大多数 版本是 兼容的下表总结了各个版本情况 发布版本 源自 年份 所有者 兼容 至 是 至 是 否 否 否 否 是 是 是 是 及更高 至今 是 注解 兼容并不意味着 在 下发布 与 不同所有 许 可证都允许您分发修改后的版本而无需开源所做的更改 兼容的许可证 使得 可以与其它在 下发布的软件结合使用但其它的许可证则 不行 感谢众多在 指导下工作的外部志愿者使得这些发布成为可能 获取或以其他方式使用 的条款和条件 软件和文档的使用许可均基于 许可协议 从 开始文档中的示例 操作指导和其他代码采用的是 许可协议和 零条款 许可 的双重使用许可 某些包含在 中的软件是基于不同的许可 这些许可会与相应许可之下的代码一同列出 有关这些许可的不完整列表请参阅 被收录软件的许可证与鸣谢 用于 的 许可协议 用于 的 许可协议 开源许可协议第 版 用于 的 许可协议 用于 至 的 许可协议 被收录软件的许可证与鸣谢 本节是 发行版中收录的第三方软件的许可和致谢清单该清单是不完整且不断增长的 模块包含基于 下载的代码 以下是原始代码的完整注释声明 套接字 模块使用 和 函数这些函数源代码在 项目 的单独源文件中 异步套接字服务 和 模块包含以下声明 管理 模块包含以下声明 执行追踪 模块包含以下声明 与 函数 模块包含以下声明 远程过程调用 模块包含以下声明 模块包含以下声明 模块关于 的接口包含以下声明 文件包含 对 的 算法的实现 它包含以下声明 和 文件提供了 语言的 和 函数用于将 语言的双精度型和字符串进行转换由 的同名文件派生而来该文件当前可从 下载 年 月 日检索到的原始文件包含以下版权和许可声明 如果操作系统可用则 模块使用 库来提高性能 此外适用于 的 和 安装程序可能包括 库的拷贝所以在此处也列出了 许可证的拷贝 除非使用 配置了构建否则 扩展都是用包含 源的拷贝构建的 除非使用 配置了构建否则 扩展都是包含 源的拷贝构建的 如果系统上找到的 版本太旧而无法用于构建则使用包含 源代码的拷贝来构建 扩展 使用的哈希表的实现基于 项目 测试套件 包 中的 测试套件来源于 网站 并根据 许可证三条款版发行 在 版更改 在 版更改 在 版更改 在 版更改 创建源码发行包 命令 编写安装脚本 编写安装脚本 注解 这篇文档只有在 上的 文档独立涵盖此处包含的所有相关信息之前才会单独保留 一个简单的例子 一个简单的例子 一个简单的例子 扩展名和软件包 例如 其他选项 解释 解释 在 版更改 在 版更改 在 版更改 元数据 描述 值 注释 包名称 短字符串 此发布的版本 短字符串 软件包作者的姓名 短字符串 软件包的作者的电子邮件地址 电子邮件地址 软件包维护者的名字 短字符串 软件包维护者的电子邮件地址 电子邮件地址 软件包的网址 网址 软件包的简短摘要说明 短字符串 软件包的详细说明 长字符串 可以下载软件包的网址 网址 分类列表 字符串列表 平台清单 字符串列表 关键字列表 字符串列表 软件包许可证 短字符串 注释 在 版更改 命令参考 注解 这篇文档只有在 上的 文档独立涵盖此处包含的所有相关信息之前才会单独保留 安装模块 命令族 命令会确保 命令已经运行然后运行子命令 和 此命令会安装随发行包一同提供的所有数据文件 此命令会安装发行包中的所有 脚本 创建源码发行包 命令 上传包到包索引 供参考的最新 文档可以在 阅读 包用户指南 找到 创建 软件包 文件配置或选项 安装脚本选项 名称 摘要在序言中 版本 供应商 和 或 和 版权 描述部分 文件配置或选项 选项 默认值 发布版本 组织 供应商 同上 打包 提供 需求 冲突 淘汰 构建要求 编写设置脚本的配置文件 示例 注解 这篇文档只有在 上的 文档独立涵盖此处包含的所有相关信息之前才会单独保留 本章节提供几个基础示例来帮助用户入门 关于使用 的额外信息可以参考 参见 一套展示如何更好地控制和使用 的方法 纯 分发通过 纯 分发通过 包 单个扩展模块 扩展模块用 选项指定 对在哪寻找扩展源文件无效它只对纯 模块的源文件有效 最简单的一个用单个 源文件写的单扩展模块是 如果 扩展属于根包则配置脚本可以是 如果扩展在包中比如 那么使用完全相同的源文件树排布通过改变扩展的名字这个扩展很容易放入 包中 检查一个包 命令允许你校验你的包的元数据是否满足生成分发的最低要求 直接使用你的 脚本来运行它 如果缺了一些东西 会显示警告 我们来用单个脚本举例 运行 命令会显示一些警告 如果你在 域中使用 语法并且安装了 你可以用 命令和 选项检查语法是否正确 比如如果 脚本改成 长描述中有问题的地方通过使用 解析器 能进行删除 读取元数据 函数提供一个通过项目的 脚本来查询项目的元数据的域的命令行接口 这个调用通过运行 函数读取 元数据 然而当源文件或者二进制分发用 创建时元数据域写入一个名为 的静态文件 当一个基于 的项目安装在 中时 文件随着分发的模块和包一起复制到 中其中 是项目的名字 是元数据中定义的版本 则是 的大版本和小版本如 或者 你可以读回静态文件使用 类和它的 方法 注意类也可以用元数据文件载入值来实例化 编写设置脚本的配置文件 分发 模块遗留版本 参考引用 参见 注解 这篇文档只有在 上的 文档独立涵盖此处包含的所有相关信息之前才会单独保留 分发包功能的核心 是为了使用 工具唯一要安装的模块 它提供函数 该函数被 脚本调用 间接提供了类 和 参数名称 值 类型 包的名字 字符串 包的版本号参见 字符串 单行的包的描述 字符串 更长的包描述 字符串 包的作者 字符串 包的作者的电子邮件 字符串 字符串 当前维护者的电子邮件地址如果不 字符串 同与作者 包的 主页 字符串 包的下载地址 字符串 字符串列表 会操作的 模块列 字符串列表 表 要构建和安装的独立脚本文件的列表 字符串列表 要构建的 扩展的列表 类 的实例的列表 包的类别列表 要使用的类 类 的子类 脚本名称 默认为 字符串 提供给安装脚本的参数 字符串列表 安装脚本的默认选项 字典 包的许可证 字符串 字符串列表或逗号分隔的字符串 字符串列表或逗号分隔的字符串 字典 要安装的数据文件列表 列表 字典 值 描述 参数名称 值 类型 字符串 字符串列表 字符串列表 元组列表 要明确取消定义的宏列表 字符串列表 字符串列表 要链接的库名列表不是文件名或路 字符串列表 径 字符串列表 字符串列表 字符串列表 字符串列表 字符串列表 扩展名依赖的文件列表 字符串列表 字符串 指定扩展中的构建失败不应中止构建 布尔 过程而只是跳过扩展 在 版更改 在 版更改 基类 属性 描述 编译器 用于创建共享对象和库的链接器 用于创建二进制可执行文件的链接器 静态库创建者 在 版更改 警告 返回值的示例 在 版更改 在 版更改 在 版更改 本模块提供 标识 选项名称 描述 默认值 版后已移除 版后已移除 扩展 注解 这篇文档只有在 上的 文档独立涵盖此处包含的所有相关信息之前才会单独保留 可以通过各种方式扩展 大多数扩展都采用新命令或现有命令的替换形式 例如可以编写新命令以支持新的特定于平台的包格式但是可以修改现有命令的替换以修改命令在包上的操作细节 的大多数扩展都在想要修改现有命令的 脚本中编写其中许多只是简单地在 文件以外添加了一些应当被拷贝到包中的文件后缀以便使用 大多部 命令的实现都是 类的子类 新增命令可直接继承自 而替换命令往往间接派生自 直接子类化它们所替换的命令 所有命令都要求自 派生 集成新的命令 有多种方法可将新的命令实现集成到 中 最困难的一种是鼓动在 自身内部包含新特性并等待以及要求某个 版本提供该支持 出于多种原因这确实是相当难的 对于大多数需求来说最为常见并且可能最为合理的一种则是通过你自己的 脚本来包含新的实现然后让 函数使用它们 如果新的实现必须通过特定的包来使用则此方式最为适宜因为每个对这个包感兴趣的人都将会需要有新的命令实现 从 开始还有第三个选项可用其目标是允许添加支持现有 脚本的新命令而不需要修改 安装包 这预计可允许第三方扩展提供对附加打包系统的支持而相应命令又可用于任何 命令可被使用的地方 新的配置选项 命令行选项为 可用来指定附加包以在其中查找实现新增命令的模块 像所有 选项一样这可以通过命令行或配置文件来指定 此选项只能在配置文件的 小节之中或在命令行的任何命令之前设置 如果是设置在配置文件中则它可被命令行设置重载如果在命令行中将其设为空字符串则将会使用默认值 此选项绝不应当在随特定包提供的配置文件中设置 这个新选项可被用来添加任意数量的包到查找命令实现的包列表多个包名应当以逗号分隔 当未指明时查找将只在 包中进行 但是当 附带 选项运行时 和 包将按此顺序被查找 新的命令应当在与命名同名的模块中由同名的类来实现 给定上述示例命令行选项则命令 可由类 或 来实现 添加新的发布类型 创建发布在 目录中的文件的命令需要将 二元组添加到 以便 可以将其上传到 二元组中的 不包含路径信息而只有文件名本身 在 模式下二元组仍然应当被添加以表示必须创建的内容 包索引 包索引 存储描述与 和其他发布工具一起打包的发行版的元数据以及分发存档本身 供参考的最新 文档可以在 阅读 包用户指南 找到 注解 这篇文档只有在 上的 文档独立涵盖此处包含的所有相关信息之前才会单独保留 安装 模块旧版 概念和术语 编写一个设置脚本 可选编写设置脚本的配置文件 每个这些任务均已在此文档覆盖 一个简单的例子 模块 扩展模块 包 在 上的常见问题 我怎样在 下运行一个 程序 我怎么让 脚本可执行 在 上标准 安装程序已将 扩展名与文件类型 相关联并为该文件类型提供运行解释器的打开命令 这足以使脚本在命令提示符下作为 命令被执行 如果希望通过简单地键入 而无需输入文件扩展名来执行脚本则需要将 添加到 环境变量中 为什么有时候 程序会启动缓慢 通常 在 上启动得很快但偶尔会有错误报告说 突然需要很长时间才能启动 更令人费解的是在其他配置相同的 系统上 却可以工作得很好 该问题可能是由于计算机上的杀毒软件配置错误造成的 当将病毒扫描配置为监视文件系统中所有读取行为时一些杀毒扫描程序会导致两个数量级的启动开销 请检查你系统安装的杀毒扫描程序的配置确保两台机它们是同样的配置 已知的 杀毒软件在将它设置为扫描所有文件系统访问时会产生这个问题 我怎样使用 脚本制作可执行文件 请参阅 来了解 扩展它允许你基于 代码创建控制台和 可执行文件 是最流行的用来构建基于 的可执行文件的扩展它暂时还不支持 但新的版本已在开发中 文件和 文件相同吗 我怎样将 嵌入一个 程序 在 应用程序中嵌入 解释器可以总结如下 请 不要 直接在你的 文件中内置 在 上 必须是一个 这样才可以处理导入的本身就是 的模块 这是第一个未记录的关键事实 相反链接到 它通 常安装在 中 是 版本如数字 代 表 你可以通过两种不同的方式链接到 加载时链接意味着链接到 而运行时链接意味着链接 一般 说明 是所谓的 对应于 它只定义了链接器的符号 运行时链接极大地简化了链接选项一切都在运行时发生 你的代码必须使 用 的 程序加载 代码还 必须使用使用 的 例程获得的指针访问 中程序和数据即 的 宏可以使这些 指针对任何调用 中的例程的 代码都是透明的 提示首先使用 将 转换为 格式 如果你使用 很容易创建一个 扩展模块它将使应用程序 的数据和方法可供 使用 将为你处理所有蹩脚的细节 结果是 你将链接到 文件 中 的 代码 你不必创建 文件这也简化 了链接 将创建一个 函数一个 函数其名称取决于扩展模块的名 称 例如如果模块的名称是 则 函数将被称为 如果您使用 阴影类则 函数将被称为 这初始化 了一个由阴影类使用的隐藏辅助类 你可以将步骤 中的 代码链接到 文件的原因是调用初始化函数等 同于将模块导入 这是第二个关键的未记载事实 简而言之你可以用以下代码使用扩展模块初始化 解释器 存在两个问题如果你使用除 之外的编译器用于构建 这将会变得明显 问题 采用 参数的所谓极高级函数在多编译器环境中不起作用 因为每个编译器的 结构体概念都不同 从实现的角度来看这些是非常 低 级的功能 问题 在为 函数生成包装器时 会生成以下代码 是一个宏它扩展为对 中名为 的 复杂数据结构的引用 同样此代码将在多编译器环境中失败 将此类代码 替换为 有可能使用 的 命令自动进行更改但我无法使其工作 我是一个完全的 新手 使用 脚本从 应用程序内部建立 解释器窗口 并不是一个好主意生成的窗口将独立于应用程序的窗口系统 相反你 或 类应该创建一个本机解释器窗口 将该窗口连接到 解释器很容易 你可以将 的 重定向到支持读写的 任意 对象因此你只需要一个包含 和 方法的 对象在 扩展模块中定义 如何让编辑器不要在我的 源代码中插入 本 不建议使用制表符 样式指南 为发行的 代码推荐 个空格这也是 默认值 在任何编辑器下混合制表符和空格都是一个坏主意 在这方面没有什么不同并且很容易配置为使用空格 点击 对于文件类型 设置 和 为 并选择插入空格单选按钮 如果混合制表符和空格导致前导空格出现问题 会引发 或 你还可以运行 模块以批处理模式检查目录树 如何在不阻塞的情况下检查按键 使用 模块 这是一个标准的 专属扩展模块 它定义了一个函数 用于检查是否有键盘中的某个键被按下以及 用于获取一个字符而不将其回显 编程常见问题 一般问题 有没有提供断点与单步调试等功能的源码层次的调试器 有的 以下介绍了一些 的调试器内置函数 允许你使用其中的任何一种 模块是一个简单但是够用的控制台模式 调试器 它是标准 库的一部分并且 已收录于库参考手册 你也可以通过使用 代码作为样例来编写你自己的调试器 作为标准 发行版附带组件的 交互式环境通常位于 中包含一个图形化的调试器 是一个包含有基于 的 调试器的 调试器会为断点加上颜色并具有许多很棒的特性例如也可以非 程序 是 项目的一部分也是 发行版的一部分参见 是一个基于 和 编辑组件构建的 是标准 调试器 的一个版本经过修改后可与 数据显示调试器一起使用 是一种流行的图形化调试器前端 可以在 找到 可以在 找到 有许多商业 包括图形调试器 他们包括 是否有能帮助寻找漏洞或执行静态分析的工具 有的 和 可进行基本检查来帮助你尽早捕捉漏洞 静态类型检查器例如 和 可以检查 源代码中的类型提示 我如何能够通过一个 脚本创建一个独立运行的二进制文件 如果你想要的只是一个独立的程序用户可以下载和运行而不必先安装 发行版你就不需要将 编译成 代码 有许多工具可以确定程序所需的模块集并将这些模块与 二进制文件绑定在一起以生成单个可执行文件 一种是使用冻结工具它包含在 源代码树 中 它将 字节代码转换为 数组一个 编译器你可以将所有模块嵌入到一个新程序中然后将其与标准 模块链接 它的工作原理是递归扫描源代码以获取 语句两种形式并在标准 路径和源目录用于内置模块中查找模块 然后它将用 编写的模块的字节码转换为 代码可以使用编组模块转换为代码对象的数组初始化器并创建一个定制的配置文件该文件仅包含程序中实际使用的内置模块 然后它编译生成的 代码并将其与 解释器的其余部分链接以形成一个独立的二进制文件其行为与你的脚本完全相同 显然 需要一个 编译器 有几个其他实用工具不需要 一个是 的 仅限 另一个工具是 的 是否有 程序规范代码标准或风格指南 有的 请参阅标准库模块所要求的代码风格描述文档 核心语言 当变量有值时为什么会出现 通过在函数体中的某处添加赋值语句导致以前正常工作的代码被修改而得到 会令人感到意外 以下代码 正常工作但是以下代码 会得到一个 这是因为当你对作用域中的变量进行赋值时该变量将成为该作用域的局部变量并在外部作用域中隐藏任何类似命名的变量 由于 中的最后一个语句为 分配了一个新值编译器会将其识别为局部变量 因此当先前的 尝试打印未初始化的局部变量时会导致错误 在上面的示例中你可以通过将其声明为全局来访问外部作用域变量 这个显式声明是必需的以便提醒你与类和实例变量的表面类似情况不同你实际上是在外部作用域中修改变量的值 你可以使用 关键字在嵌套作用域中执行类似的操作 中的局部变量和全局变量有哪些规则 在 中仅在函数内引用的变量是隐式全局变量 如果在函数体内的任何位置为变量赋值则除非明确声明为全局否则将其视为局部值 虽然起初有点令人惊讶但片刻考虑就可以解释 一方面要求 表示已分配的变量可以防止意外的副作用 另一方面如果所有全局引用都需要 那么你一直都在使用 你必须将对内置函数或导入模块的组件的每个引用声明为全局 这种杂乱会破坏 声明用于识别副作用的有用性 为什么在具有不同值的循环中定义的 都返回相同的结果 如何跨模块共享全局变量 在单个程序中跨模块共享信息的规范方法是创建一个特殊模块通常称为 或 只需在应用程序的所有模块中导入配置模块然后该模块可用作全局名称 因为每个模块只有一个实例所以对模块对象所做的任何更改都会在任何地方反映出来 例如 请注意出于同样的原因使用模块也是实现 设计模式的基础 导入模块的最佳实践是什么 为什么对象之间会共享默认值 这种类型的缺陷通常会惹恼新手程序员 考虑这个函数 第一次调用此函数时 包含一项 第二次 包含两项因为当 开始执行时 中已经有一项了 函数调用经常被期望为默认值创建新的对象 但实际情况并非如此 默认值会在函数定义时一次性地创建 如果对象发生改变就如本示例中的字典那样则对函数的后续调用将会引用这个被改变的对象 按照定义不可变对象例如数字 字符串 元组和 因为不可变所以是安全的 对可变对象例如字典 列表和类实例的改变则可能造成迷惑 由于这一特性在编程中应遵循的一项好习惯是不使用可变对象作为默认值 而应使用 作为默认值和函数中的值检查值为 的形参并创建相应的列表 字典或其他可变对象 例如不要这样写 而要这样写 这一特性有时会很有用处 当你有一个需要进行大量耗时计算的函数时一个常见技巧是将每次调用函数的参数和结果值缓存起来并在同样的值被再次请求时返回缓存的值 这称为记忆具体实现方式可以是这样的 你也可以使用包含一个字典的全局变量而不使用参数默认值这完全取决于个人偏好 如何将可选参数或关键字参数从一个函数传递到另一个函数 使用函数参数列表中的 和 说明符收集参数这会将位置参数作为元组将关键字参数作为字典 然后您可以使用 和 调用另一个函数时传递这些参数 形参和实参之间有什么区别 形参 是指出现在函数定义中的名称而 实参 则是在调用函数时实际传入的值 形参定义了一个函数能接受何种类型的实参 例如对于以下函数定义 和 是 的形参 但是在调用 时例如 实际的值 和 则是实参 为什么更改列表 也会更改列表 如何编写带输出参数的函数通过引用调用 请记住在 中参数是通过赋值来传递的 由于赋值只是创建了对象的引用因此在调用者和被调用者的参数名称之间没有别名所以本身是没有按引用调用的 你可以通过多种方式实现所需的效果 通过返回一个结果元组 这几乎总是最清晰明了的解决方案 通过使用全局变量 这种方式不是线程安全的而且也不受推荐 通过传递一个可变 即可原地修改的 对象 通过传递一个会被改变的字典 或者在一个类实例中捆绑值 几乎没有任何适当理由将问题如此复杂化 你的最佳选择是返回一个包含多个结果的元组 如何在 中创建高阶函数 你有两种选择使用嵌套作用域或者使用可调用对象 例如假设你想要定义 使其返回一个函数 来设计 的值 可以使用以下嵌套作用域 或使用一个可调用对象 在两种情况下 都会给出一个可调用对象使得 可调用对象方式的缺点是速度略慢且生成的代码略长 但是请注意一组可调用对象能够通过继承来共享签名 对象可以封装多个方法的状态 这里 和 将表现为共享同一计数变量的多个函数 如何在 中复制对象 一般来说通常情况下请尝试 或 不是所有对象都可以复制但多数都是可以的 某些对象可以方便地复制 例如字典具有 方法 序列可以通过切片来复制 如何找到对象的方法或属性 对于一个用户自定义类的实例 将返回一个按字母顺序排序的包含实例属性和方法及其类所定义的属性名称的列表 我的代码如何才能发现对象的名称 逗号运算符的优先级是什么 逗号在 中不是运算符 考虑这个例子 由于逗号不是运算符而是表达式之间的分隔符以上代码的含义就相当于 而不是 对于各种赋值运算符 等 来说同样如此 它们并不是真正的运算符而是赋值语句中的语法分隔符 是否有与 的 三目运算符等价的东西 有的 相应语法如下 在 引入此语法之前常见的做法是使用逻辑运算符 然而这种做法并不保险因为当 具有布尔假值时将会给出错误的结果 所以使用 形式总是会更好 是否可以用 编写混淆的单行程序 可以 通常是在 中嵌套 来实现的 请参阅以下三个来自 的示例代码 请不要在家里尝试骚年 函数参数列表中的斜杠是什么意思 函数参数列表中的斜杠表示在它之前的形参是仅限位置形参 仅限位置形参没有外部可用的名称 在调用接受仅限位置形参的函数时参数只会基于它们的位置被映射到形参 例如 是一个接受仅限位置形参的函数 它的文档是这样的 在形参列表末尾的斜杠意味着两个形参都是仅限位置形参 因此附带关键字参数调用 将会导致报错 数字和字符串 如何指定十六进制和八进制整数 要指定一个八进制数码则在八进制值之前加一个零和一个小写或大写字母 作为前缀 例如要将变量 设为八进制的 十进制的 就输入 十六进制数也同样简单 只要在十六进制数之前加一个零和一个小写或大写字母 十六进制数码中的字母可以为大写或小写 例如在 解释器中输入 为什么 返回 如何将字符串转换为数字 如何将数字转换为字符串 如何修改字符串 无法修改因为字符串是不可变对象 在大多数情况下你应该使用你想要的各种部分来构造一个新字符串 但是如果你想要一个可以原地修改 数据的对象可尝试使用 对象或 模块 如何使用字符串调用函数方法 有多种技巧可供选择 最好的做法是使用一个将字符串映射到函数的字典 这一技巧的主要优势在 于字符串不必与函数名称一致 这也是用于模拟其他语言中 结构的主 要技巧 使用内置函数 请注意 可用于任何对象包括类 类实例 模块等等 在标准库中多次使用了这个技巧例如 使用 来解析出函数名 是否有与 的 等效的方法用于从字符串中删除尾随换行符 可以使用 从字符串 的末尾删除所有的换行符而不删除其他尾随空格 如果字符串 表示多行且末尾有几个空行则将删除所有空行的换行符 由于通常只在一次读取一行文本时才需要这样做所以使用 这种方式工作得很好 是否有 或 的对应物 没有这样的对应物 对于简单的输入解析最方便的做法通常是使用字符串对象的 方法将一行内容拆解为以空格分隔的单词然后使用 或 将表示十进制数的字符串转换为数值 支持可选的 形参适用于内容行使用空格符以外的分隔符的情况 以于更复杂的输入解析正则表达式会比 的 更强大也更适合此类任务 或 错误是什么意思 见 指南 性能 我的程序太慢了 该如何加快速度 总的来说这是个棘手的问题 首先下面列出了深入了解前需要记住的事情 不同的 实现具有不同的性能特点 本 着重解答的是 行为可能因操作系统而异尤其是在谈论 或多线程时 在尝试优化任何代码 前 应始终找到程序中的热点请参阅 模块 编写基准脚本将允许您在搜索改进时快速迭代请参阅 模块 强烈建议在可能引入隐藏在复杂优化中的回归之前要有良好的代码覆盖率 通过单元测试或任何其他技术 话虽如此加速 代码有很多技巧 以下是一些可以达到可接受的性能水平的一般原则 使您的算法更快或更改为更快的算法可以产生比尝试在代码中使用微优化 技巧更大的好处 使用正确的数据结构 参考文档 内置类型 和 模块 当标准库提供用于执行某些操作的原语时可能尽管不能保证比您可能提 出的任何替代方案更快 对于用 编写的原语例如内置函数和一些扩展类型 这是真的 例如请确保使用 内置方法或相关的 函数进行排序有关适度高级用法的示例请参阅 排序指南 抽象倾向于创造间接性并迫使翻译更多地工作 如果间接级别超过完成的有用 工作量则程序将变慢 你应该避免过度抽象特别是在微小的功能或方法的 形式下这通常也会对可读性产生不利影响 如果你已经达到纯 允许的限制那么有一些工具可以让你走得更远 例如 可以将稍微修改的 代码版本编译为 扩展并且可以在许多不同的平台上使用 可以利用编译和可选的类型注释来使代码明显快于解释运行时的速度 如果您对 编程技能有信心也可以自己 编写 扩展模块 参见 专门介绍 性能提示 的 页面 将多个字符串连接在一起的最有效方法是什么 和 对象是不可变的因此将多个字符串连接在一起效率很低因为每个连接都会创建一个新对象 在一般情况下总运行时间是总字符串长度的二次方 要连接多个 对象通常推荐的用法是将它们放入一个列表中并在结尾处调用 另一个合理有效的惯用方法是 要连接多个 对象建议使用本地连接 运算符扩展 对象 序列元组列表 如何在元组和列表之间进行转换 类型构造器 可将任意序列实际上是任意可迭代对象转换为具有相同排列顺序的相同条目的元组 例如 产生 而 产生 如果参数为一个元组它不会创建副本而是返回同一对象因此如果你不确定某个对象是否为元组时也可简单地调用 类型构造器 可将任意序列或可迭代对象转换为具有相同排列顺序的相同条目的列表 例如 产生 而 产生 如果参数为一个列表它会像 那样创建一个副本 什么是负数序号 序列使用正数或负数作为序号或称索引号 对于正数序号第一个序号为 而 为第二个序号依此类推 对于负数序号倒数第一个序号为 而倒数第二个序号为 依此类推 可以认为 就相当于 使用负数序号有时会很方便 例如 就是原字符串去掉最后一个字符这可以用来移除某个字符串末尾的换行符 如何以相反的顺序迭代序列 使用 内置函数 这不会修改您的原始序列而是构建一个反向顺序的新副本以进行迭代 如何从列表中删除重复项 如何从列表中删除多个项 对于删除重复项一种可能的做法是设置删除条件显式地进行反向迭代 但是更容易也更快速的做法是进行隐式或显式的正向迭代并使用切片替代 以下列出了三种方式 列表推导式可能是最快的 如何在 中创建数组 使用列表 列表在时间复杂度方面相当于 或 数组主要区别在于 列表可以包含许多不同类型的对象 模块还提供了创建具有紧凑表示的固定类型的数组的方法但它的索引速度比列表慢 还要注意数字扩展和其他扩展还定义了具有各种特性的类似数组的结构 要获取 样式的列表可以使用元组模拟 单元 如果需要可变性可以使用列表而不是元组 这里模拟 的是 模拟 的是 只有在你确定真的需要的时候才这样做因为它通常比使用 列表慢得多 如何创建多维列表 你可能试图制作一个像这样的多维数组 如果你打印它看起来是正确的 但是当你给某一项赋值时会同时在多个位置显示变化 其中的原因在于使用 对列表执行重复操作并不是创建副本它只是创建现有对象的引用 创建了对长度为二的同一列表的 个引用 对某一行的改变会作用于所有行通常这一定不是你所希望的 建议的做法是先创建一个所需长度的列表然后其中的元素再以一个新创建的列表来填充 这样就生成了一个包含 个长度为二的不同列表的列表 你也可以使用列表推导式 或者你还可以使用提供矩阵类型的扩展包其中最著名的是 如何将方法应用于一系列对象 可以使用列表推导式 为什么 会在执行加法时引发异常 这是由两个事实共同导致的结果一是增强赋值运算符属于 赋值 运算符二是在 中存在可变和不可变两种不同的对象 此处的讨论在任何对元组中指向可变对象的元素使用增强赋值运算符的情况都是普遍成立的但在此我们只以 和 来举例 如果你写成这样 发生异常的原因是显而易见的 会与对象 相加而该对象为 得到结果对象 但当我们试图将运算结果 赋值给元组的 号元素时就将报错因为我们不能改变元组的元素所指向的对象 在表层之处以上增强赋值语句所做的大致是这样 由于元组是不可变的因此操作的赋值部分会引发错误 当你这样写的时候 发生异常会令人略感吃惊还有一个更为令人吃惊的事实虽然有报错但是添加操作却生效了 要明白为何会这样你需要知道 如果一个对象实现了 魔术方法它会在执行 增强赋值时被调用并且其返回值将用于该赋值语句 对于列表来说 等价于在列表上调用 并返回该列表 因此对于列表我们可以说 就是 的快捷方式 这相当于 所引用的对象已被修改而引用被修改对象的指针又重新被赋值给 赋值的最终结果没有变化因为它是引用 之前所引用的同一对象的指针但仍然发生了赋值操作 因此在我们的元组示例中发生的事情等同于 成功执行因此列表得到了扩充但是虽然 指向了 已经指向的同一对象最后的赋值仍然导致了报错因为元组是不可变的 我想做一个复杂的排序你能用 做一个 变换吗 该技术归功于 社区的 它通过将每个元素映射到其 排序值 的度量对列表中的元素进行排序 在 中使用 方法的 参数 如何按其他列表中的值对一个列表进行排序 将它们合并到元组的迭代器中对结果列表进行排序然后选择所需的元素 对象 什么是类 什么是方法 什么是 只是 方法 的第一个参数的常规名称 例如对于某个类的某个实例 其方法 实际上应该被称为 对于被调用的方法会被称为 另请参阅 为什么必须在方法定义和调用中显式使用 如何检查对象是否为给定类或其子类的一个实例 什么是委托 委托是一种面向对象的技巧也称为设计模式 假设您有一个对象 并且想要改变其中一个方法的行为 您可以创建一个新类它提供您感兴趣的方法的新实现并将所有其他方法委托给 的相应方法 程序员可以轻松实现委托 例如以下类实现了一个类该类的行为类似于文件但将所有写入的数据转换为大写 在这里 类重新定义了 方法在调用下层的 方法之前将参数字符串转换为大写形式 所有其他方法都被委托给下层的 对象 委托是通过 方法来完成的请参阅 语言参考 了解有关控制属性访问的更多信息 请注意对于更一般的情况来说委托可能包含更多细节问题 当某些属性既需要读取又需要设置时类还必须定义 方法并且这样做必须小心谨慎 的基本实现大致相当于以下代码 大多数 实现必须修改 来为自身保存局部状态而又不至于造成无限递归 如何从覆盖基类的派生类调用基类中定义的方法 使用内置的 函数 对于 之前的版本您可能正在使用经典类对于诸如 之类的类定义可以将在 或 中的一个的基类中定义的方法 调用为 这里 是一个未绑定的方法因此您需要提供 参数 如何组织代码以便更改基类 如何创建静态类数据和静态类方法 支持静态数据和静态方法在 或 的意义上 对于静态数据只需定义一个类属性 要为属性分配新值就必须在赋值中显式使用类名 对于任意 来说只要 为真则 同样也指向 除非被 自身或者从 回到 的基类搜索路径上的某个类所重载 注意在 的某个方法内部像 这样的赋值将在 自身的字典中新建一个名为 的不相关实例 想要重新绑定类静态数据名称就必须总是指明类名无论是在方法内部还是外部 静态方法是可行的 然而获得静态方法效果的更直接的方法是通过一个简单的模块级函数 如果您的代码是结构化的以便为每个模块定义一个类或紧密相关的类层次结构那么这就提供了所需的封装 如何在 中重载构造函数或方法 我尝试使用 但是得到一个关于 的错误信息 以双下划线打头的变量会被更名以提供一种定义类私有变量的简单而有效的方式 任何形式为 的标识符至少前缀两个下划线至多后缀一个下划线文本会被替换为 其中 为去除了全部前缀下划线的当前类名称 这并不能保证私密性外部用户仍然可以访问 属性私有变量值也在对象的 中可见 许多 程序员从来都不使用这种私有变量名称 类定义了 方法但是删除对象时没有调用它 如何获取给定类的所有实例的列表 不跟踪类或内置类型的所有实例 您可以对类的构造函数进行编程以通过保留每个实例的弱引用列表来跟踪所有实例 为什么 的结果看起来不是唯一的 返回一个整数该整数在对象的生命周期内保证是唯一的 因为在 中这是对象的内存地址所以经常发生在从内存中删除对象之后下一个新创建的对象被分配在内存中的相同位置 这个例子说明了这一点 这两个 属于之前创建的不同整数对象并在执行 调用后立即删除 要确保要检查其 的对象仍处于活动状态请创建对该对象的另一个引用 模块 如何创建 文件 如何找到当前模块名称 模块可以通过查看预定义的全局变量 找到自己的模块名称 如果它的值为 程序将作为脚本运行 通常通过导入使用的许多模块也提供命令行界面或自检并且只在检查 之后才执行之后的代码 如何让模块相互导入 假设您有以下模块 问题是解释器将执行以下步骤 首先导入 创建用于 的空全局变量 被编译并开始执行 导入 创建了用于 的空全局变量 被编译并开始执行 导入 这是一个空操作 因为已经有一个名为 的模块 最后一步失败了因为 还没有解释 而 的全局符号字典仍然是空的 当你使用 然后尝试在全局代码中访问 时会发生同样的事情 这个问题有至少三种可能的解决方法 建议避免使用 并将所有代码放在函数中 全局变量和类变量的初始化只能使用常量或内置函数 这意味着导入模块中的所有内容都被引用为 建议在每个模块中按以下顺序执行步骤 导出全局变量函数和不需要导入基类的类 导入 声明 活动代码包括从导入值初始化的全局变量 不喜欢这种方法因为导入出现在一个陌生的地方但这种方法确实有效 建议重构代码以便首先不需要递归导入 这些解决方案并不相互排斥 返回 如何获取 考虑使用 中的函数 当我编辑了导入过的模块并重新导入它时这些变化没有显示出来 为什么会这样 出于效率和一致性的原因 仅在第一次导入模块时读取模块文件 如果不这么做在一个由许多模块组成的程序中每个模块都会导入相同的基本模块那么基本模块将被解析和重新解析多次 要强制重新读取已更改的模块请执行以下操作 警告这种技术不是 万无一失 特别是包含如下语句的模块 将继续使用旧版本的导入对象 如果模块包含类定义则不会更新现有的类实例以使用新的类定义 这可能导致以下矛盾行为 如果打印出类对象的标识问题的本质就会明确 代码库和插件 通用的代码库问题 如何找到可以用来做 的模块或应用 等的源文件在哪 如果找不到模块的源文件可能它是一个内建的模块或是使用 或其他编译型语言实现的动态加载模块 这种情况下可能是没有源码文件的类似 这样的文件会存放在 代码目录中但不在 目录中 中至少有三类模块 使用 编写的模块 使用 编写的动态加载模块 等 使用 编写并链接到解释器的模块要获取此列表输入 在 中怎样让 脚本可执行 中有 包吗 对于类 系统标准 源码发行版会在 子目录中附带 模块但默认并不会编译 注意在 平台下不可用 中没有 模块 模块支持基本的 特性同时也支持 和 中的很多额外功能比如颜色 不同的字符集支持 填充和鼠标支持 这意味着这个模块不兼容只有 模块的操作系统但是目前仍在维护的系统应该都不会存在这种情况 对于 平台使用 模块 中存在类似 的 函数的东西吗 模块提供了一个与 的 函数类似的注册函数 为什么我的信号处理函数不能工作 最常见的问题是信号处理函数没有正确定义参数列表 它会被这样调用 因此它应当声明为带有两个形参 通用任务 怎样测试 程序或组件 带有两个测试框架 模块从模块的 中寻找示例并执行对比输出是否与 中给出的是否一致 模块是一个模仿 和 测试框架的更棒的测试框架 为了使测试更容易你应该在程序中使用良好的模块化设计 程序中的绝大多数功能都应该用函数或类方法封装 有时这样做会有额外惊喜程序会运行得更快因为局部变量比全局变量访问要快 除此之外程序应该避免依赖可变的局部变量这会使得测试困难许多 程序的全局主逻辑应该尽量简单 并放置在程序主模块的最后面 一旦你的程序已经组织为一个函数和类行为的有完整集合你就应该编写测试函数来检测这些行为 可以将自动执行一系列测试的测试集关联到每个模块 这听起来似乎需要大量的工作但是由于 是如此简洁灵活因此它会极其容易 你可以通过与生产代码同步编写测试函数使编程更为愉快和有趣因为这将更容易并更早发现代码问题甚至设计缺陷 程序主模块之外的其他辅助模块中可以增加自测试的入口 通过使用 实现的假接口即使是需要与复杂的外部接口交互的程序也可以在外部接口不可用时进行测试 怎样用 创建文档 模块可以用 源码中的 创建 文件 也可以使用 来只通过 创建 文档 也可以引入 的内容 怎样一次只获取一个按键 在类 系统中有多种方案 最直接的方法是使用 但是 模块太大了难以学习 线程相关 程序中怎样使用线程 一定要使用 模块不要使用 模块 模块对 模块提供的底层线程原语做了更易用的抽象 的非常实用的 教程中有一些幻灯片可以参阅 我的线程都没有运行为什么 如何将任务分配给多个工作线程 最简单的方式是使用 模块特别是其中的 类 或者如果你想更好地控制分发算法你也可以自己写逻辑实现 使用 模块来创建任务列表队列 类维护一个了一个存有对象的列表提供了 方法添加元素并且可以用 方法获取元素 这个类会使用必要的加锁操作以此确保每个任务只会执行一次 这是一个简单的例子 运行时会产生如下输出 查看模块的文档以获取更多信息 类提供了多种接口 怎样修改全局变量是线程安全的 内部会使用 来确保同一时间只有一个线程运行 通常 只会在字节码指令之间切换线程切换的频率可以通过设置 指定 从 程序的角度来看每一条字节码指令以及每一条指令对应的 代码实现都是原子的 理论上说具体的结果要看具体的 字节码实现对指令的解释 而实际上对内建类型 等的共享变量的类原子操作都是原子的 举例来说下面的操作是原子的 是列表 是字典 是对象 是 变量 这些不是原子的 覆盖其他对象的操作会在其他对象的引用计数变成 时触发其 方法这可能会产生一些影响 对字典和列表进行大量操作时尤其如此 如果有疑问的话使用互斥锁 不能删除全局解释器锁吗 通常被视为 在高端多核服务器上开发时的阻力因为几乎所有 代码只有在获取到 时才能运行所以多线程的 程序只能有效地使用一个 在 时代 开发了一个完整的补丁包 补丁移除了 并用粒度更合适的锁来代替 最近也在他的 项目里做了类似的实验 不幸的是由于为了移除 而使用了大量细粒度的锁这两个实验在单线程测试中的性能都有明显的下降至少慢 但这并意味着你不能在多核机器上很好地使用 你只需将任务划分为多进程而不是多线程 新的 模块中的 类提供了一个简单的方法如果你想对任务分发做更多控制可以使用 模块提供的底层 恰当地使用 拓展也很有用使用 拓展处理耗时较久的任务时拓展可以在线程执行 代码时释放 让其他线程执行 和 等标准库模块已经这样做了 也有建议说 应该是解释器状态锁而不是完全的全局锁解释器不应该共享对象 不幸的是这也不可能发生 由于目前许多对象的实现都有全局的状态因此这是一个艰巨的工作 举例来说小整型数和短字符串会缓存起来这些缓存将不得不移动到解释器状态中 其他对象类型都有自己的自由变量列表这些自由变量列表也必须移动到解释器状态中 等等 我甚至怀疑这些工作是否可能在优先的时间内完成因为同样的问题在第三方拓展中也会存在 第三方拓展编写的速度可比你将它们转换为把全局状态存入解释器状态中的速度快得多 最后假设多个解释器不共享任何状态那么这样做比每个进程一个解释器好在哪里呢 输入输出 怎样删除文件 以及其他文件相关的问题 怎样复制文件 模块有一个 函数 注意在 中不会复制 和 怎样读取或写入二进制数据 似乎 创建的管道不能使用 这是为什么 是一个底层函数它接收的是文件描述符 用小整型数表示的打开的文件 创建的是一个高级文件对象和内建的 方法返回的类型一样 因此如果要从 创建的管道 中读取 个字节的话你应该使用 怎样访问 串口 为什么关闭 并不会真正关掉它 网络 编程 中的 工具是什么 参阅代码库参考手册中 互联网协议和支持 和 互联网数据处理 这两章的内容 有大量模块来帮助你构建服务端和客户端 系统 维护了一份可用框架的概览见 维护了一份关于 技术的实用网页的集合见 怎样模拟发送 表单 生成 需要使用什么模块 你可以在 编程 页面 找到许多有用的链接 怎样使用 脚本发送邮件 使用 标准库模块 下面是一个很简单的交互式发送邮件的代码 这个方法适用于任何支持 协议的主机 在 系统中还可以使用 程序的位置在不同系统中不一样有时是在 有时是在 手册页面会对你有所帮助 以下是示例代码 的 方法怎样避免阻塞 通常会用 模块处理 异步 要防止 连接发生阻塞你可以将 设为非阻塞模式 这样当你执行 时你将或是立即完成连接不大可能或是收到一个包含 错误码的异常 表示连接正在进行但还没有完成 不同的操作系统将返回不同的值因此你需要确认你的系统会返回什么值 你可以使用 方法来避免生成异常 它将只返回 值 要进行轮询你可以稍后再次调用 或 表示连接已完成 或者你也可以将此 传给 来检查它是否可写 注解 模块提供了通用的单线程并发异步库它可被用来编写非阻塞的网 络代码 第三方的 库是一个热门且功能丰富的替代选择 数据库 中有数据库包的接口吗 当然 标准 还包含了基于磁盘的哈希接口例如 和 除此之外还有 模块该模块提供了一个轻量级的基于磁盘的关系型数据库 大多数关系型数据库都已经支持 查看 数据库编程 页面 获取更多信息 在 中如何实现持久化对象 库模块以一种非常通用的方式解决了这个问题虽然你依然不能用它保存打开的文件 套接字或窗口之类的东西此外 库模块可使用 和 来创建包含任意 对象的持久化映射 数学和数字 中怎样生成随机数 设计和历史常见问题 为什么 使用缩进来分组语句 认为使用缩进进行分组非常优雅并且大大提高了普通 程序的清晰度 大多数人在一段时间后就学会并喜欢上这个功能 由于没有开始结束括号因此解析器感知的分组与人类读者之间不会存在分歧 偶尔 程序员会遇到像这样的代码片段 如果条件为真则只执行 语句但缩进会使你认为情况并非如此 即使是经验丰富的 程序员有时也会长久地盯着它发呆不明白为什么在 时 也会减少 因为没有开始结束花括号所以 更不容易发生编码风格冲突 在 中有许多不同的放置花括号的方式 在习惯了阅读和编写某种特定风格的代码之后当阅读或被要求编写另一种风格的代码时通常都会令人感觉有点不舒服 许多编码风格将开始结束括号单独放在一行上 这使得程序相当长浪费了宝贵的屏幕空间使得更难以对程序进行全面的了解 理想情况下函数应该适合一个屏幕例如 行 行 可以完成比 行 更多的工作 这不仅仅是由于缺少开始结束括号 缺少声明和高级数据类型也是其中的原因 但缩进基于语法肯定有帮助 为什么简单的算术运算得到奇怪的结果 请看下一个问题 为什么浮点计算不准确 用户经常对这样的结果感到惊讶 并且认为这是 中的一个 其实不是这样 这与 关系不大而与底层平台如何处理浮点数字关系更大 中的 类型使用 语言的 类型进行存储 对象的值是以固定的精度通常为 位存储的二进制浮点数由于 使用 操作而后者依赖于处理器中的硬件实现来执行浮点运算 这意味着就浮点运算而言 的行为类似于许多流行的语言包括 和 许多可以轻松地用十进制表示的数字不能用二进制浮点表示 例如在输入以下语句后 为 存储的值是与十进制的值 非常接近 的近似值但不完全等于它 在典型的机器上实际存储的值是 它对应于十进制数值 典型的 位精度为 浮点数提供了 位小数的精度 要获得更完整的解释请参阅 教程中的 浮点算术 一章 为什么 字符串是不可变的 有几个优点 一个是性能知道字符串是不可变的意味着我们可以在创建时为它分配空间并且存储需求是固定不变的 这也是元组和列表之间区别的原因之一 另一个优点是 中的字符串被视为与数字一样基本 任何动作都不会将值 更改为其他值在 中任何动作都不会将字符串 更改为其他值 为什么必须在方法定义和调用中显式使用 这个想法借鉴了 语言 出于多种原因它被证明是非常有用的 首先更明显的显示出使用的是方法或实例属性而不是局部变量 阅读 或 可以清楚地表明即使您不知道类的定义也会使用实例变量或方法 在 中可以通过缺少局部变量声明来判断假设全局变量很少见或容易识别 但是在 中没有局部变量声明所以必须查找类定义才能确定 一些 和 编码标准要求实例属性具有 前缀因此这种显式性在这些语言中仍然有用 其次这意味着如果要显式引用或从特定类调用该方法不需要特殊语法 在 中如果你想使用在派生类中重写基类中的方法你必须使用 运算符 在 中你可以编写 这对于 方法非常有用特别是在派生类方法想要扩展同名的基类方法而必须以某种方式调用基类方法时 最后它解决了变量赋值的语法问题为了 中的局部变量根据定义在函数体中赋值的那些变量并且没有明确声明为全局赋值就必须以某种方式告诉解释器一个赋值是为了分配一个实例变量而不是一个局部变量它最好是通过语法实现的出于效率原因 通过声明来做到这一点但是 没有声明仅仅为了这个目的而引入它们会很可惜 使用显式的 很好地解决了这个问题 类似地对于使用实例变量必须编写 意味着对方法内部的非限定名称的引用不必搜索实例的目录 换句话说局部变量和实例变量存在于两个不同的命名空间中您需要告诉 使用哪个命名空间 为什么不能在表达式中赋值 自 开始你能做到的赋值表达式使用海象运算符 在表达式中为变量赋值 请参阅 了解详情 为什么 对某些功能例如 使用方法来实现而其他功能例如 使用函数实现 正如 所说 对于某些操作前缀表示法比后缀更容易阅读 前缀和中缀运 算在数学中有着悠久的传统就像在视觉上帮助数学家思考问题的记法 比 较一下我们将 这样的公式改写为 的容易程度以及使用 原始 符号做相同事情的笨拙程度 当读到写有 的代码时就知道它要求的是某件东西的长度 这告 诉我们两件事结果是一个整数参数是某种容器 相反当阅读 时 必须已经知道 是某种实现接口的容器或者是从具有标准 的类继承 的容器 当没有实现映射的类有 或 方法或者不是文件的类有 方法时我们偶尔会感到困惑 为什么 是一个字符串方法而不是列表或元组方法 从 开始字符串变得更像其他标准类型当添加方法时这些方法提供的功能与始终使用 模块的函数时提供的功能相同 这些新方法中的大多数已被广泛接受但似乎让一些程序员感到不舒服的一种方法是 结果如下 反对这种用法有两个常见的论点 第一条是这样的使用字符串文本 的方法看起来真的很难看答案是也许吧但是字符串文本只是一个固定值 如果在绑定到字符串的名称上允许使用这些方法则没有逻辑上的理由使其在文字上不可用 第二个异议通常是这样的我实际上是在告诉序列使用字符串常量将其成员连接在一起 遗憾的是并非如此 出于某种原因把 作为一个字符串方法似乎要容易得多因为在这种情况下很容易看到 是对字符串文本的指令用于返回由给定分隔符分隔的子字符串或在默认情况下返回任意空格 是字符串方法因为在使用该方法时您告诉分隔符字符串去迭代一个字符串序列并在相邻元素之间插入自身 此方法的参数可以是任何遵循序列规则的对象包括您自己定义的任何新的类 对于字节和字节数组对象也有类似的方法 异常有多快 如果没有引发异常则 块的效率极高 实际上捕获异常是昂贵的 在 之前的 版本中通常使用这个习惯用法 只有当你期望 在任何时候都有 时这才有意义 如果不是这样的话你就是应该这样编码 对于这种特定的情况您还可以使用 但前提是调用 足够便宜因为在所有情况下都会对其进行评估 为什么 中没有 或 语句 难道不能在解释器中模拟线程而非得依赖特定于操作系统的线程实现吗 答案 不幸的是解释器为每个 堆栈帧推送至少一个 堆栈帧 此外扩展可以随时回调 因此一个完整的线程实现需要对 的线程支持 答案 幸运的是 有一个完全重新设计的解释器循环可以避免 堆栈 为什么 表达式不能包含语句 的 表达式不能包含语句因为 的语法框架不能处理嵌套在表达式内部的语句 然而在 中这并不是一个严重的问题 与其他语言中添加功能的 表单不同 的 只是一种速记符号如果您懒得定义函数的话 函数已经是 中的第一类对象可以在本地范围内声明 因此使用 而不是本地定义的函数的唯一优点是你不需要为函数创建一个名称 这只是一个分配了函数对象与 表达式生成的对象类型完全相同的局部变量 可以将 编译为机器代码 或其他语言吗 将带有可选注释的 修改版本编译到 扩展中 是一个将 编译成 代码的新兴编译器旨在支持完整的 语言 要编译成 可以考虑 如何管理内存 内存管理的细节取决于实现 的标准实现 使用引用计数来检测不可访问的对象并使用另一种机制来收集引用循环定期执行循环检测算法来查找不可访问的循环并删除所涉及的对象 模块提供了执行垃圾回收 获取调试统计信息和优化收集器参数的函数 但是其他实现如 或 可以依赖不同的机制如完全的垃圾回收器 如果你的 代码依赖于引用计数实现的行为则这种差异可能会导致一些微妙的移植问题 在一些 实现中以下代码在 中工作的很好可能会耗尽文件描述符 实际上使用 的引用计数和析构函数方案 每个新赋值的 都会关闭前一个文件 然而对于传统的 这些文件对象只能以不同的时间间隔可能很长的时间间隔被收集和关闭 如果要编写可用于任何 实现的代码则应显式关闭该文件或使用 语句无论内存管理方案如何这都有效 为什么 不使用更传统的垃圾回收方案 首先这不是 标准特性因此不能移植 是的我们知道 库 它包含了 大多数 常见平台但不是所有平台的汇编代码尽管它基本上是透明的但也不是完全透明的 要让 使用它需要使用补丁 当 嵌入到其他应用程序中时传统的 也成为一个问题 在独立的 中可以用 库提供的版本替换标准的 和 嵌入 的应用程序可能希望用 它自己 替代 和 而可能不需要 的 现在 可以正确地实现 和 退出时为什么不释放所有内存 为什么有单独的元组和列表数据类型 虽然列表和元组在许多方面是相似的但它们的使用方式通常是完全不同的 可以认为元组类似于 记录或 结构它们是相关数据的小集合可以是不同类型的数据可以作为一个组进行操作 例如笛卡尔坐标适当地表示为两个或三个数字的元组 另一方面列表更像其他语言中的数组 它们倾向于持有不同数量的对象所有对象都具有相同的类型并且逐个操作 例如 返回表示当前目录中的文件的字符串列表 如果向目录中添加了一两个文件对此输出进行操作的函数通常不会中断 元组是不可变的这意味着一旦创建了元组就不能用新值替换它的任何元素 列表是可变的这意味着您始终可以更改列表的元素 只有不变元素可以用作字典的 因此只能将元组和非列表用作 列表是如何在 中实现的 的列表实际上是可变长度的数组而不是 风格的链表 该实现使用对其他对象的引用的连续数组并在列表头结构中保留指向该数组和数组长度的指针 这使得索引列表 的操作成本与列表的大小或索引的值无关 当添加或插入项时将调整引用数组的大小 并采用了一些巧妙的方法来提高重复添加项的性能 当数组必须增长时会分配一些额外的空间以便在接下来的几次中不需要实际调整大小 字典是如何在 中实现的 的字典实现为可调整大小的哈希表 与 树相比这在大多数情况下为查找目前最常见的操作提供了更好的性能并且实现更简单 字典的工作方式是使用 内置函数计算字典中存储的每个键的 代码 代码根据键和每个进程的种子而变化很大例如 的 值为 而 一个按位不同的字符串的 值为 然后 代码用于计算内部数组中将存储该值的位置 假设您存储的键都具有不同的 值这意味着字典需要恒定的时间 用 表示法 来检索一个键 为什么字典 必须是不可变的 为什么 没有返回排序列表 在性能很重要的情况下仅仅为了排序而复制一份列表将是一种浪费 因此 对列表进行了适当的排序 为了提醒您这一事实它不会返回已排序的列表 这样当您需要排序的副本但也需要保留未排序的版本时就不会意外地覆盖列表 如果要返回新列表请使用内置 函数 此函数从提供的可迭代列表中创建新列表对其进行排序并返回 例如下面是如何迭代遍历字典并按 排序 如何在 中指定和实施接口规范 为什么没有 可以使用异常捕获来提供 结构 甚至可以跨函数调用工作的 许多人认为异常捕获可以方便地模拟 和其他语言的 或 结构的所有合理用法 例如 但是不允许你跳到循环的中间这通常被认为是滥用 谨慎使用 为什么原始字符串 不能以反斜杠结尾 为什么 没有属性赋值的 语句 具有 语句它能将一个代码块的执行包装起来在进入和退出代码块时调用特定的代码 有些语言具有这样的结构 在 中这样的结构是不明确的 其他语言如 和 使用静态类型因此可以毫不含糊地知道分配给什么成员 这是静态类型的要点 编译器 总是 在编译时知道每个变量的作用域 使用动态类型 事先不可能知道在运行时引用哪个属性 可以动态地在对象中添加或删除成员属性 这使得无法通过简单的阅读就知道引用的是什么属性局部属性 全局属性还是成员属性 例如采用以下不完整的代码段 该代码段假设 必须有一个名为 的成员属性 然而 中并没有告诉解释器这一点 假设 是整数会发生什么 如果有一个名为 的全局变量它是否会在 块中使用 如您所见 的动态特性使得这样的选择更加困难 然而 可以通过赋值轻松实现 和类似语言特性减少代码量的主要好处 代替 写成这样 这也具有提高执行速度的副作用因为 在运行时解析名称绑定而第二个版本只需要执行一次解析 为什么 语句需要冒号 冒号主要用于增强可读性 语言实验的结果之一 考虑一下这个 与 注意第二种方法稍微容易一些 请进一步注意在这个 解答的示例中冒号是如何设置的这是英语中的标准用法 另一个次要原因是冒号使带有语法突出显示的编辑器更容易工作他们可以寻找冒号来决定何时需要增加缩进而不必对程序文本进行更精细的解析 为什么 在列表和元组的末尾允许使用逗号 允许您在列表元组和字典的末尾添加一个尾随逗号 有几个理由允许这样做 如果列表元组或字典的字面值分布在多行中则更容易添加更多元素因为不必记住在上一行中添加逗号 这些行也可以重新排序而不会产生语法错误 不小心省略逗号会导致难以诊断的错误 例如 这个列表看起来有四个元素但实际上包含三个 和 总是加上逗号可以避免这个错误的来源 允许尾随逗号也可以使编程代码更容易生成 常见问题 常见问题 编程常见问题 设计和历史常见问题 代码库和插件 扩展嵌入常见问题 在 上的常见问题 图形用户界面 常见问题 为什么我的电脑上安装了 扩展嵌入常见问题 可以使用 语言创建自己的函数吗 是的您可以在 中创建包含函数 变量 异常甚至新类型的内置模块 在文档扩展和嵌入 解释器 中有说明 大多数中级或高级的 书籍也涵盖这个主题 可以使用 语言创建自己的函数吗 是的可以使用 中兼容 的功能 在 文件周围放置 并在 解释器调用的每个函数之前放置 具有构造函数的全局或静态 对象可能不是一个好主意 很难写有没有其他选择 编写自己的 扩展有很多选择具体取决于您要做的事情 及其相关的 是接受稍微修改过的 形式并生成相应 代码的编译器 和 可以编写扩展而无需学习 的 如果需要连接到某些当前不存在 扩展的 或 库可以尝试使用 等工具包装库的数据类型和函数 或 也是包装 库的替代方案 如何在 中执行任意 语句 执行此操作的最高层级函数为 它接受单个字符串参数用于在模块 的上下文中执行并在成功时返回 而在发生异常包括 时返回 如果你想要更多可控性可以使用 请在 中查看 的源码 如何在 中对任意 表达式求值 可以调用前一问题中介绍的函数 并附带起始标记符 它会解析表达式对其求值并返回结果值 如何从 对象中提取 的值 如何使用 创建任意长度的元组 不可以 应该使用 如何从 调用对象的方法 如何捕获 或打印到 的任何内容的输出 在 代码中定义一个支持 方法的对象 将此对象赋值给 和 调用 或者只是允许标准回溯机制生效 在此之后输出将转往你的 方法所指向的任何地方 做到这一点的最简单方式是使用 类 实现同样效果的自定义对象看起来是这样的 如何从 访问用 编写的模块 如何在 中对接 对象 根据你的需求可以选择许多方式 手动的实现方式请查阅 扩展与嵌入 文档 来入门 需要知道的是对于 运行时系统来说 和 并不没有太大的区别 因此围绕一个 结构指针类型构建新 对象的策略同样适用于 对象 有关 库请参阅 很难写有没有其他选择 我使用 文件添加了一个模块为什么 失败了 安装程序必须以换行符结束如果没有换行符则构建过程将失败 修复这个需要一些丑陋的 脚本编程而且这个 很小看起来不值得花这么大力气 如何调试扩展 将 与动态加载的扩展名一起使用时在加载扩展名之前不能在扩展名中设置断点 在您的 文件中或交互式添加命令 然后运行 我想在 系统上编译一个 模块但是缺少一些文件 为什么 大多数打包的 版本不包含 目录该目录中包含编译 扩展所需的各种文件 对于 安装 以获取必要的文件 对于 运行 如何区分输入不完整和输入无效 如何找到未定义的 符号 或 能否创建一个对象类其中部分方法在 中实现而其他方法在 中实现例如通过继承 常见问题 一般信息 什么是 是一种解释型 交互式 面向对象的编程语言 它包含了模块 异常 动态类型 高层级动态数据类型以及类等特性 在面向对象编程以外它还支持多种编程范式例如过程式和函数式编程等 结合了超强的功能和极清晰的语法 它带有许多系统调用和库以及多种窗口系统的接口并且能用 或 来进行扩展 它还可用作需要可编程接口的应用程序的扩展语言 最后 非常易于移植它可以在包括 和 在内的许多 变种以及 上运行 要了解更多详情请先查看 教程 新手指南 提供了学习 的其他入门教程及资源的链接 什么是 软件基金会 软件基金会 简称 是一个独立的非盈利组织它拥有 及以上各版本的版权 的使命是推进与 编程语言相关的开源技术并推广 的使用 的主页是 向 提供捐助在美国是免税的 如果你在使用 并且感觉它对你很有帮助可以通过 捐助页 进行捐助 使用 是否存在版权限制 你可以任意使用源码只要你保留版权信息并在你基于 的产品文档中显示该版权信息 如果你遵守此版权规则就可以将 用于商业领域以源码或二进制码的形式不论是否经过修改销售 的副本或是以某种形式包含了 的产品 当然我们仍然希望获知所有对 的商业使用 请参阅 许可页 以查看进一步的说明以及许可的完整文本内容的链接 的徽标是注册商标在某些情况下需要获得允许方可使用 请参阅 商标使用政策 了解详情 创造 的最初理由是什么 以下是有关最初缘起的一份 非常 简短的摘要由 本人撰写 我在 的 部门时在实现解释型语言方面积累了丰富经验通过与这 个部门成员的协同工作我学到了大量有关语言设计的知识 这是许多 特性的最初来源包括使用缩进来组织语句以及包含非常高层级的数 据结构虽然在 中具体的实现细节完全不同 我对 语言有过许多抱怨但同时也很喜欢它的许多特性 没有可能通 过扩展 语言或它的实现来弥补我的不满 实际上缺乏可扩展性就 是它最大的问题之一 我也有一些使用 的经验并曾与 的设计者进行交流还阅读了 的报告 是 中异常机制所用语法和语义以及其他一些语言特性的最初来源 我还曾在 的 分布式操作系统部门工作 当时我们需要有一种 比编写 程序或 脚本更好的方式来进行系统管理因为 有它 自己的系统调用接口并且无法方便地通过 来访问 我在 中 处理错误的经验令我深刻地意识到异常处理在编程语言特性当中的重要地位 我发现某种具有 式的语法而又能访问 系统调用的脚本语言将 可满足需求 我意识到编写一种 专属的语言是愚蠢的所以我决定 编写一种具有全面可扩展性的语言 在 年的圣诞假期中我手头的时间非常充裕因此我决定开始尝试一 下 在接下来的一年里虽然我仍然主要用我的业余时间来做这件事但 在 项目中的使用获得了很大的成功来自同事的反馈让我得 以增加了许多早期的改进 到 年 月经过一年多的开发我决定将其发布到 之后的 事情就都可以在 文件里面看了 适合做什么 是一种高层级的多用途编程语言可用于解决许多不同门类的问题 该语言附带一个庞大的标准库涵盖了字符串处理正则表达式 比较文件间的差异等因特网协议 编程等软件工程单元测试日志记录性能分析 代码解析等以及操作系统接口系统调用文件系统 套接字等 请查看 标准库 的目录以了解所有可用的内容 此外还可以获取到各种各样的第三方扩展 请访问 包索引 来查找你感兴趣的软件包 版本的编号形式是怎样的 我应如何获取一份 源代码的副本 最新的 发布版源代码总能从 获取下载页链接为 最新的开发版源代码可以在 获取 发布版源代码是一个以 压缩的 文件其中包含完整的 源代码 格式的文档 库模块 示例程序以及一些有用的自由分发软件 该源代码将可在大多数 类平台上直接编译并运行 请参阅 开发者指南的初步上手部分 了解有关获取源代码并进行编译的更多信息 我应如何获取 的文档 当前的 稳定版本的标准文档可在 查看 也可在 获取 纯文本以及可下载的 版本 文档以 格式撰写并使用 文档工具 生成 文档的 源文件是 源代码发布版的一部分 我之前从未接触过编程 哪里有 的教程 有许多可选择的教程和书籍 标准文档中也包含有 教程 请参阅 新手指南 以获取针对 编程初学者的信息包括教程的清单 是否有专门针对 的新闻组或邮件列表 有一个新闻组 和一个邮件列表 新闻组和邮件列表是彼此互通的 如果你可以阅读新闻就不必再订阅邮件列表 的流量很大每天会收到数以百计的发帖 使用者通常更擅长处理这样大的流量 有关新软件发布和活动的公告可以在 中找到这是个严格管理的低流量列表每天会收到五个左右的发帖 可以在 公告邮件列表 页面进行订阅 有关其他邮件列表和新闻组的更多信息可以在 找到 我应如何获取 的公开测试版本 可以从 下载 和 发布版 所有发布版都会在 和 新闻组以及 主页 上进行公告并会推送到 新闻源 你还可以通过 访问 的开发版 请参阅 开发者指南 了解详情 我应如何为 提交错误报告和补丁 要报告错误或提交补丁请使用安装于 上的 你必须拥有一个 账号才能报告错误这样我们就可以在有后续问题时与你联系 这也使得 能在我们处理所报告的错误时向你发送更新消息 如果你之前使用过 向 报告错误你可以通过 的 密码重置操作 来获取你的 密码 有关 开发流程的更多信息请参阅 开发者指南 是否有任何公开发表的 相关文章可以供我参考引用 可能作为参考文献的最好方式还是引用你喜欢的 相关书籍 第一篇有关 的文章写于 年现在其内容已经相当过时了 与 使用 编程语言交互式地测 试远程服务器 季刊 第 卷 第 期 年 月 阿姆斯特 丹 第 页 是否有任何 相关的书籍 是的相关的书籍很多还有更多即将发行 请访问 的 页面 获取一份清单 你也可以到各大在线书店搜索 并过滤掉对 的引用或者也可以搜索 加 具体位于世界上的哪个地点 项目的基础架构分布于世界各地并由 基础架构团队负责管理 详情请访问 这里 为何命名为 在着手编写 实现的时候 同时还阅读了刚出版的 的飞行马戏团 剧本这是一部自 年代开始播出的 系列喜剧 觉得他需要选择一个简短 独特而又略显神秘的名字于是他决定将这个新语言命名为 我必须喜欢 的飞行马戏团 吗 不必但这对学习会有帮助 现实世界中的 有多稳定 有多少人在使用 使用者应该数以百万计但很难获得一个精确的数字 可以免费下载因此并不存在销量数据此外它也可以从许多不同网站获取并且包含于许多 发行版之中因此下载量统计同样无法完全说明问题 新闻组非常活跃但不是所有 用户都会在新闻组发帖许多人甚至不会阅读新闻组 有哪些重要的项目是用 开发的 请访问 查看使用了 的项目列表 阅览 历次 会议 的日程纪要可以看到许多不同公司和组织所做的贡献 高水准的 项目包括 邮件列表管理器 和 应用服务器 多个 发行版其中最著名的有 均已使用 来编写部分或全部的安装程序和系统管理软件 在内部使用 的大公司包括了 以及 等 在未来可以期待 将有什么新进展 请访问 查看 增强提议 是为 加入某种新特性的提议进行描述的设计文档其中会提供简明的技术规格说明与基本原理 可以查找标题为 的 其中 是某个尚未公开发布的版本 新版本的开发会在 邮件列表 中进行讨论 提议对 加入不兼容的更改是否合理 通常来说是不合理的 世界上已存在的 代码数以亿计因此任何对该语言的更改即便仅会使得现有程序中极少的一部分失效也是难以令人接受的 就算你可以提供一个转换程序也仍然存在需要更新全部文档的问题另外还有大量已出版的 书籍我们不希望让它们在一瞬间全部变成废纸 如果必须更改某个特性则应该提供渐进式的升级路径 描述了引入向后不兼容的更改所需遵循的流程以尽可能减少对用户的干扰 是一种对编程初学者友好的语言吗 当然 从过程式 静态类型的编程语言例如 或者 以及 的某一子集开始引导学生入门仍然是常见的做法 但以 作为第一种编程语言进行学习对学生可能更有利 具有非常简单和一致的语法和庞大的标准库而且最重要的是在编程入门教学中使用 可以让学生专注于更重要的编程技能例如问题分解与数据类型设计 使用 可以快速向学生介绍基本概念例如循环与过程等 他们甚至有可能在第一次课里就开始接触用户自定义对象 对于之前从未接触过编程的学生来说使用静态类型语言会感觉不够自然 这会给学生带来必须掌握的额外复杂性并减慢教学的进度 学生需要尝试像计算机一样思考分解问题设计一致的接口并封装数据 虽然从长远来看学习和使用一种静态类型语言是很重要的但这并不是最适宜在学生的第一次编程课上就进行探讨的主题 还有许多其他方面的特点使得 成为很好的入门语言 像 一样 拥有一个庞大的标准库因此可以在课程非常早期的阶段就给学生布置一些 实用 的编程项目 编程作业不必仅限于标准四则运算和账目检查程序 通过使用标准库学生可以在学习编程基础知识的同时开发真正的应用从而获得更大的满足感 使用标准库还能使学生了解代码重用的概念 而像 这样的第三方模块同样有助于扩大学生的接触领域 的解释器使学生能够在编程时测试语言特性 他们可以在一个窗口中输入程序源代码的同时开启一个解释器运行窗口 如果他们不记得列表有哪些方法他们这以这样做 通过使用解释器学生编写程序时参考文档总是能伴随在他们身边 还拥有很好的 是一个跨平台的 它基于 库使用 语言编写 是一个 专属的 用户将高兴地了解到 具有非常好的 模式 所有这些编程环境都提供语法高亮自动缩进以及在编写代码时使用交互式解释器等功能 请访问 查看 编程环境的完整列表 如果你想要讨论 在教育中的使用你可能会有兴趣加入 邮件列表 为什么我的电脑上安装了 什么是 为什么我的电脑上安装了 如果你不记得你曾主动安装过 但它却出现在了你的电脑上这里有一些可能的原因 可能是这台电脑的其他用户因想学习编程而安装了它你得琢磨一下谁用过这 台电脑并安装了 电脑上安装的第三方应用程序可能由 写成并附带了一份 这 样的应用程序有很多例如 程序 网络服务器 管理脚本等 一些 可能预装了 在撰写本文时我们了解到 和 的计算机包含 显然 的一些管理工具 是用 编写的 许多 兼容的操作系统例如 和一些 发行版默认安 装了 它被包含在基本安装套件中 我能删除 吗 图形用户界面 常见问题 图形界面常见问题 是否有平台无关的图形界面工具包 工具包 可使用 或 及 有多个绑定适配可供选择 当前相较 更成熟但如果你想编写专有软件就必须要从 购买 许可证 则可以自由使用于各类软件 以上版本使用 进行许可此外商业许可证可从 公司 那里获得 是一种跨平台图形用户界面库同时支持桌面操作系统 和 以及移动设备 该库使用 和 编写可以使用一系列窗口后端 是自由的开源软件使用 许可证分发 的 绑定是简单却功能强大且成熟的跨平台窗口系统可以在 里获得相关信息 对于 绑定请参阅 有哪些 的 工具是某个平台专用的 通过安装 程序可以使用 的 库 的 包括一个微软基础类 的接口和一个绝大多数由使用 类的 写成的 编程环境 有关 的问题 我怎样冻结 程序 在等待 操作时能够处理 事件吗 在 以外的其他平台上可以你甚至不需要使用线程 但是你必须稍微修改一下你的 代码 有与 的 对应的调用它允许你注册一个回调函数当一个文件描述符可以进行 操作的时候 主循环将会调用这个回调函数 参见 在 中键绑定不工作为什么 经常听到的抱怨是已经通过 方法绑定了事件的处理程序但是当按下相关的按键后这个处理程序却没有执行 最常见的原因是那个绑定的控件没有键盘焦点 请在 文档中查找 指令 通常一个控件要获得键盘焦点需要点击那个控件而不是标签请查看 选项 解决 是一门以稳定著称的编程语言 为了保持它的稳定性开发者们想了解您在 中发现的任何缺陷 有时候自己修复漏洞并将补丁提交给 能更快地解决问题因为它简化了流程并且减少了参与的人力 请参阅如何 提交补丁 文档错误 使用 的问题追踪系统 对于 本身的错误报告应当通过 错误追踪系统 进行提交 该错误追踪系统提供了一个可以输入并提交相关信息给开发者的网页表单 第一步是确认是否有重复的报告 这样做除了可以节省开发者的时间也能让您从中了解到我们做出了怎样的努力我们有可能已经在下个版本中修复了这个问题也有可能需要更详细的信息在这种情况下非常欢迎您提供 要查找重复的报告请使用顶部的搜索栏进行搜索 如果您没有搜索到您想报告的问题请返回并登录 错误追踪系统 如果您没有账号请点击注册 链接或者在侧边栏中选择任何一个 登录方式 您不能匿名提交一份错误报告 如果已经登录 那您就可以提交错误报告了 请点击侧边栏中的新建 链接打开报告表单 表单中有几个空栏译者注请用英语填写 请在 标题 栏填入对问题 非常 简短的描述一个好的描述应当少于十个单词 在 类型 栏选择您的问题的类型同样地选择 相对应的组件 和版本 在说明 栏请详细描述问题包括您预期的情况和实际的情况 请确保包含任何涉及的拓展模块以及您当时所使用的硬件和软件平台如果可能请附上版本信息 每一份错误报告将被分派给一名开发者并由这名开发者决定如何修正这个问题 每当有相关的进展时您都会收到通知 参见 如何有效地报告错误 该文章详细介绍了如何创建一份有用的错误报告 它描述了什么样的信息 是有用的以及为什么是有用的 错误报告编写指南 关于写一份好的错误报告 部分仅针对 项目不过其描述了通用 的恰当做法 开始为 贡献您的知识 除了仅仅报告您所发现的错误之外同样欢迎您提交修复它们的补丁 您可以在 开发者指引 中找到更多为 打补丁的信息 如果您有任何问题核心导师邮件列表 是一个友好的去处在那里 你可以寻求修复 相关问题的答案 定义扩展类型已分类主题 终结和内存释放 当您的类型实例的引用计数减少为零并且 解释器想要回收它时将调用此函数 如果你的类型有内存可供释放或执行其他清理你可以把它放在这里 对象本身也需要在这里释放 以下是此函数的示例 一个重要的释放器函数实现要求是把所有未决异常放着不动 这很重要是因为释放器会被解释器频繁的调用当栈异常退出时而非正常返回不会有任何办法保护释放器看到一个异常尚未被设置 此事释放器的任何行为都会导致额外增加的 代码来检查异常是否被设置 这可能导致解释器的误导性错误 正确的保护方法是在任何不安全的操作前保存未决异常然后在其完成后恢复 者可以通过 和 函数来实现 注解 从 开始推荐不 要在 放复杂的终结代码而是使用新的 类型 方法 参见 解释了新的终结方案 对象展示 在 中有两种方式可以生成对象的文本表示 函数和 函数 函数会直接调用 这些处理程序都是可选的 处理程序应该返回一个字符串对象其中包含调用它的实例的表示形式 下面是一个简单的例子 如果没有指定 处理程序解释器将提供一个使用 的表示形式以及对象的惟一标识值 下面是一个简单的例子 属性管理 泛型属性管理 例如 抽象对象层 参见 更多建议 参见 下载 源代码版本 上开发 源代码的 项目 在 上构建 和 扩展 这一章简要介绍了如何使用 创建 的 扩展模块然后再提供有关其工作机理的详细背景信息 这些说明材料同时适用于 程序员学习构建 扩展以及 程序员学习如何生成在 和 上均能成功构建的软件 鼓励模块作者使用 方式来构建扩展模块而不使用本节所描述的方式 你仍将需要使用 编译器来构建 通常为 注解 这一章提及了多个包括已编码 版本号的文件名 这些文件名以显示 为 的版本号来代表在实践中 将为你所使用的 发布版 的主版本号而 将为次版本号 例如如果你所使用的是 将为 菜谱式说明 在 和 上构建扩展模块都有两种方式使用 包来控制构建过程或者全手动操作 方式适用于大多数扩展使用 构建和打包扩展模块的文档见 分发 模块遗留版本 如果你发现你确实需要手动操作那么研究一下 标准库模块的项目文件可能会很有帮助 和 之间的差异 和 对于代码的运行时加载使用了完全不同的范式 在你尝试构建可动态加载的模块之前要先了解你所用系统是如何工作的 在 中一个共享对象 文件中包含将由程序来使用的代码也包含在程序中可被找到的函数名称和数据 当文件被合并到程序中时对在文件代码中这些函数和数据的全部引用都会被改为指向程序中函数和数据在内存中所放置的实际位置 这基本上是一个链接操作 在 中一个动态链接库 文件中没有悬挂的引用 而是通过一个查找表执行对函数或数据的访问 因此在运行时 代码不必在运行时进行修改相反地代码已经使用了 的查找表并且在运行时查找表会被修改以指向特定的函数和数据 在 中只存在一种库文件 它包含来自多个对象文件 的代码 在创建共享对象文件 的链接阶段链接器可能会发现它不知道某个标识符是在哪里定义的 链接器将在各个库的对象文件中查找它如果找到了它链接器将会包括来自该对象文件的所有代码 在 中存在两种库类型静态库和导入库 扩展名都是 静态库类似于 的 文件它包含在必要时可被包括的代码 导入库基本上仅用于让链接器能确保特定标识符是合法的并且将在 被加载时出现于程序中 这样链接器可使用来自导入库的信息构建查找表以便使用未包括在 中的标识符 当一个应用程序或 被链接时可能会生成一个导入库它将需要被用于应用程序或 中未来所有依赖于这些符号的 假设你正在编译两个动态加载模块 和 它们应当共享另一个代码块 在 上你 不应 将 传给链接器作为 和 那会导致它被包括两次这样 和 将分别拥有它们自己的副本 在 上编译 将同时编译 你 应当 将 传给链接器用于 和 并不包含代码它只包含将在运行时被用于访问 的代码的信息 在 上使用导入库有点像是使用 它让你可以访问 中的名称但并不会创建一个单独副本 在 上链接到一个库更像是 它会创建一个单独副本 的实际使用 版 是用 编译的使用其他编译器可能行也可能不行但 看来是可以的 这一节的剩余部分只适用于 当在 中创建 时你必须将 传给链接器 要编译两个 和 会使用 中找到的 函数你应当使用以下命令 第一条命令创建了三个文件 和 不包含任何 函数 例如 但它通过 可以知道如何找到所需的 代码 第二条命令创建了 以及 和 它知道如何从 以及 可执行文件中找到所需的函数 不是每个标识符都会被导出到查找表 如果你想要任何其他模块包括 都能看到你的标识符你必须写上 就如在 或 中一样 将加入大量你并不真正需要的导入库使你的可执行文件大小增加 要摆脱它们请使用项目设置对话框的链接选项卡指定 忽略默认库 将正确的 添加到库列表中 在其它应用程序嵌入 参见 参考手册 转换 的数据值到 转换 的数据值到 纯嵌入 然后结果应该是 在 中嵌入 在类 系统中编译和链接 注解 自定义扩展类型教程 允许编写 扩展模块定义可以从 代码中操纵的新类型这很像内置的 和 类型 所有扩展类型的代码都遵循一个模式但是在您开始之前您需要了解一些细节 这份文件是对这个主题介绍 基础 注解 注解 注解 注解 泛型属性管理 注解 注解 脚注 扩展和嵌入 解释器 本文档描述了如何使用 或 编写模块以使用新模块来扩展 解释器的功能 这些模块不仅可以定义新的函数还可以定义新的对象类型及其方法 该文档还描述了如何将 解释器嵌入到另一个应用程序中以用作扩展语言 最后它展示了如何编译和链接扩展模块以便它们可以动态地在运行时加载到解释器中如果底层操作系统支持此特性的话 本文档假设你具备有关 的基本知识 有关该语言的非正式介绍请参阅 教程 语言参考 给出了更正式的语言定义 标准库包含现有的对象类型 函数和模块内置和用 编写的文档使语言具有广泛的应用范围 关于整个 的详细介绍请参阅独立的 参考手册 推荐的第三方工具 本指南仅介绍了作为此 版本的一部分提供的创建扩展的基本工具 第三方工具如 和 提供了更简单和更复杂的方法来为 创建 和 扩展 参见 不仅涵盖了几个简化二进制扩展创建的 可用工具还讨论了为什么首先创建扩展模块的各种原因 不使用第三方工具创建扩展 本指南的这一部分包括在没有第三方工具帮助的情况下创建 和 扩展 它主要用于这些工具的创建者而不是建议你创建自己的 扩展的方法 使用 或 扩展 一个简单的例子 关于错误和异常 回到例子 模块方法表和初始化函数 编译和链接 在 中调用 函数 提取扩展函数的参数 给扩展函数的关键字参数 构造任意值 引用计数 在 中编写扩展 给扩展模块提供 自定义扩展类型教程 基础 定义扩展类型已分类主题 终结和内存释放 对象展示 属性管理 更多建议 构建 扩展 使用 构建 和 扩展 发布你的扩展模块 在 上构建 和 扩展 菜谱式说明 和 之间的差异 的实际使用 在更大的应用程序中嵌入 运行时 有时不是要创建在 解释器中作为主应用程序运行的扩展而是希望将 运行时嵌入到更大的应用程序中 本节介绍了成功完成此操作所涉及的一些细节 在其它应用程序嵌入 纯嵌入 在 中嵌入 在类 系统中编译和链接 构建 扩展 使用 构建 和 扩展 扩展模块可以用 来构建这是 自带的 也支持创建二进制包用户无需编译器而 就能安装扩展 一个 包包含了一个驱动脚本 这是个纯 文件大多数时候也很简单看起来如下 通过文件 和文件 运行如下 这会编译 然后产生一个扩展模块叫做 在目录 里 依赖于系统模块文件会放在某个子目录形如 名字可能是 或 在文件 里所有动作的入口通过 函数 该函数可以接受可变数量个关键字参数上面的例子只使用了一个子集 特别需要注意的例子指定了构建包的元信息以及指定了包内容 通常一个包会包括多个模块就像 的源码模块 文档 子包等 请参数 的文档在 分发 模块遗留版本 来了解更多 的特性本章节只解释构建扩展模块的部分 通常预计算参数给 想要更好的结构化驱动脚本 有如如上例子函数 的 参数是一列扩展模块每个是一个 类的实例 例子中的实例定义了扩展命名为 从单一源码文件构建 更多时候构建一个扩展会复杂的多需要额外的预处理器定义和库 如下例子展示了这些 例子中函数 在调用时额外传递了元信息是推荐发布包构建时的内容 对于这个扩展其指定了预处理器定义 目录库目录库 依赖于编译器 还会用其他方式传递信息给编译器 例如在 上结果是如下编译命令 这些行代码仅用于展示目的 用户应该相信 能正确调用 发布你的扩展模块 使用 或 扩展 一个简单的例子 让我们创建一个扩展模块 粉丝最喜欢的食物 并且想要创建对应 库函数 的 接口 这个函数接受一个以 结尾的字符串参数并返回一个整数 我们希望可以在 中以如下方式调用此函数 首先创建一个 文件 传统上如果一个模块叫 则对应实现它的 文件叫 如果这个模块名字非常长比如 则这个模块的文件可以直接叫 文件中开始的两行是 这会导入 如果你喜欢你可以在这里添加描述模块目标和版权信息的注释 注解 由于 可能会定义一些影响某些系统上标准头文件的预处理器定义因此 在包含任何标准头文件之前您必须 这个文件 推 荐总是在 前定义 查看 提取扩展函数的 参数 来了解这个宏的更多内容 所有在 中定义的用户可见的符号都具有 或 前缀已在标准头文件中定义的那些除外 考虑到便利性也由于其在 解释器中被广泛使用 还包含了一些标准头文件 和 如果后面的头文件在你的系统上不存在它还会直接声明函数 和 下面要做的事是将 函数添加到我们的扩展模块当 表达式 被求值时函数将被调用我们很快就会看到它最终是如何被调用的 有个直接翻译参数列表的方法例如单独的 到要传递给 函数的参数 函数总是有两个参数通常名字是 和 对模块级函数 参数指向模块对象对于对象实例则指向方法 参数是指向一个 的 对象的指针其中包含参数 每个 项对应一个调用参数 这些参数也全都是 对象 要在我们的 函数中使用它们就需要先将其转换为 值 中的函数 会检查参数类型并将其转换为 值 它使用模板字符串确定需要的参数类型以及存储被转换的值的 变量类型 细节将稍后说明 在所有参数都有正确类型且组成部分按顺序放在传递进来的地址里时返回真非零 其在传入无效参数时返回假零 在后续例子里还会抛出特定异常使得调用的函数可以理解返回 也就是例子里所见 关于错误和异常 回到例子 回到前面的例子你应该明白下面的代码 如果在参数列表中检测到错误它将返回 该值是返回对象指针的函数所使用的错误提示这取决于 设置的异常 在其他情况下参数的字符串值会被拷贝到局部变量 这是一个指针赋值并且你不应该修改它所指向的字符串 因此在标准 中变量 应当被正确地声明为 下一个语句使用 系统函数 传递给他的参数是刚才从 取出的 我们的 函数必须返回 的值作为 对象 这通过使用函数 来实现 在这种情况下会返回一个整数对象这个对象会在 堆里面管理 如果你的 函数没有有用的返回值返回 的函数则必须返回 你可以用 宏来完成 是特殊 对象 所对应的 名称 它是一个真正的 对象而不是 指针如我们所见后者在大多数上下文中都意味着错误 模块方法表和初始化函数 编译和链接 在你能使用你的新写的扩展之前你还需要做两件事情使用 系统来编译和链接 如果你使用动态加载这取决于你使用的操作系统的动态加载机制更多信息请参考编译扩展模块的章节 构建 扩展 章节以及在 上编译需要的额外信息 在 上构建 和 扩展 章节 如果你不使用动态加载或者想要让模块永久性的作为 解释器的一部分就必须修改配置设置并重新构建解释器 幸运的是在 上很简单只需要把你的文件 为例 放在解压缩源码发行包的 目录下添加一行到 来描述你的文件 然后在顶层目录运行 来重新构建解释器 你也可以在 子目录使用 但是你必须先重建 文件然后运行 命令 你每次修改 文件都需要这样操作 如果你的模块需要额外的链接这些内容可以列出在配置文件里举个实例 在 中调用 函数 提取扩展函数的参数 函数 的声明如下 参数 必须是一个元组对象包含从 传递给 函数的参数列表 参数必须是一个格式字符串语法请参考 手册中的 语句解释及变量编译 剩余参数是各个变量的地址类型要与格式字符串对应 注意 会检测他需要的 参数类型却无法检测传递给他的 变量地址如果这里出错了可能会在内存中随机写入东西小心 注意任何由调用者提供的 对象引用是 借来的 引用不要递减它们的引用计数一些调用的例子 给扩展函数的关键字参数 函数 声明如下 与 形参与 函数所定义的一致 形参是作为第三个参数从 运行时接收的关键字字典 形参是以 结尾的字符串列表它被用来标识形参名称从左至右与来自 的类型信息相匹配 如果执行成功 会返回真值否则返回假值并引发一个适当的异常 注解 嵌套的元组在使用关键字参数时无法生效不在 中的关键字参数会 导致 异常 如下是使用关键字参数的例子模块作者是 构造任意值 引用计数 中的引用计数 拥有规则 危险的薄冰 指针 通常接受对象引用作为参数的函数不希望你传给它们 指针并且当你这样做时将会转储核心或在以后导致核心转储 返回对象引用的函数通常只在要指明发生了异常时才返回 不检测 参数的原因在于这些函数经常要将它们所接收的对象传给其他函数 如果每个函数都检测 将会导致大量的冗余检测而使代码运行得更缓慢 更好的做法是仅在源头上检测 即在接收到一个可能为 的指针例如来自 或是一个可能引发异常的函数的时候 和 等宏不会检测 指针 但是它们的变种 和 则会检测 用于检测特定对象类型的宏 不会检测 指针 同样地有大量代码会连续调用这些宏来测试一个对象是否为几种不同预期类型之一这将会生成冗余的测试 不存在带有 检测的变体 函数调用机制会保证传给 函数的参数列表 本示例中为 绝不会为 实际上它会保证其总是为一个元组 任何时候将 指针泄露给 用户都会是个严重的错误 在 中编写扩展 给扩展模块提供 数据结构 本章将详细介绍一些您已经了解的内容并添加了一些新内容 列表的更多特性 列表数据类型还有很多的方法 这里是列表对象方法的清单 在列表的末尾添加一个元素 相当于 使用可迭代对象中的所有元素来扩展列表 相当于 在给定的位置插入一个元素 第一个参数是要插入的元素的索引所以 插入列表头部 等同于 移除列表中第一个值为 的元素 如果没有这样的元素则抛出 异常 删除列表中给定位置的元素并返回它 如果没有给定位置 将会 删除并返回列表中的最后一个元素 方法签名中 两边的方括号表示 这个参数是可选的而不是要你输入方括号 你会在 参考库中经常 看到这种表示方法 删除列表中所有的元素 相当于 返回列表中第一个值为 的元素的从零开始的索引 如果没有这样的元素 将会抛出 异常 可选参数 和 是切片符号用于将搜索限制为列表的特定子 序列 返回的索引是相对于整个序列的开始计算的而不是 参数 返回元素 在列表中出现的次数 对列表中的元素进行排序参数可用于自定义排序解释请参见 反转列表中的元素 返回列表的一个浅拷贝 相当于 列表方法示例 你可能已经注意到像 或者 方法只修改列表没有打印出返回值 它们返回默认值 这是 中所有可变数据结构的设计原则 你可能会注意到的另一件事是并非所有数据或可以排序或比较 例如 就不可排序因为整数不能与字符串比较而 不能与其他类型比较 并且还存在一些没有定义顺序关系的类型 例如 就不是一个合法的比较 列表作为栈使用 列表方法使得列表作为堆栈非常容易最后一个插入最先取出后进先出 要添加一个元素到堆栈的顶端使用 要从堆栈顶部取出一个元素使用 不用指定索引 例如 列表作为队列使用 列表也可以用作队列其中先添加的元素被最先取出 先进先出然而列表用作这个目的相当低效 因为在列表的末尾添加和弹出元素非常快但是在列表的开头插入或弹出元素却很慢 因为所有的其他元素都必须移动一位 若要实现一个队列 被设计用于快速地从两端操作 例如 列表推导式 嵌套的列表推导式 列表推导式中的初始表达式可以是任何表达式包括另一个列表推导式 考虑下面这个 的矩阵它由 个长度为 的列表组成 下面的列表推导式将交换其行和列 如上节所示嵌套的列表推导式是基于跟随其后的 进行求值的所以这个例子等价于 反过来说也等价于 实际应用中你应该会更喜欢使用内置函数去组成复杂的流程语句 函数将会很好地处理这种情况 关于本行中星号的详细说明参见 解包参数列表 语句 有一种方式可以从列表按照给定的索引而不是值来移除一个元素 那就是 语句 它不同于会返回一个值的 方法 语句也可以用来从列表中移除切片或者清空整个列表我们之前用过的方式是将一个空列表赋值给指定的切片 例如 也可以被用来删除整个变量 此后再引用 时会报错直到另一个值被赋给它 我们会在后面了解到 的其他用法 元组和序列 集合 也包含有 集合 类型 集合是由不重复元素组成的无序的集 它的基本用法包括成员检测和消除重复元素 集合对象也支持像 联合交集差集对称差分等数学运算 花括号或 函数可以用来创建集合 注意要创建一个空集合你只能用 而不能用 因为后者是创建一个空字典这种数据结构我们会在下一节进行讨论 以下是一些简单的示例 类似于 列表推导式集合也支持推导式形式 字典 循环的技巧 深入条件控制 序列和其它类型的比较 序列对象通常可以与相同序列类型的其他对象比较 这种比较使用 字典式顺序首先比较开头的两个对应元素如果两者不相等则比较结果就由此确定如果两者相等则比较之后的两个元素以此类推直到有一个序列被耗尽 如果要比较的两个元素本身又是相同类型的序列则会递归地执行字典式顺序比较 如果两个序列中所有的对应元素都相等则两个序列也将被视为相等 如果一个序列是另一个的初始子序列则较短的序列就被视为较小较少 对于字符串来说字典式顺序是使用 码位序号对单个字符排序 下面是一些相同类型序列之间比较的例子 注意对不同类型对象来说只要待比较对象提供了合适的比较方法就可以使用 和 来比较 例如混合数值类型是通过他们的数值进行比较的所以 等于 等等 否则解释器将抛出一个 异常而不是随便给出一个结果 脚注 别的语言可能会返回一个可变对象他们允许方法连续执行例如 课前甜点 如果你经常在电脑上工作总会有些任务会想让它自动化 比如对一大堆文本文件进行查找替换对很多照片文件按照比较复杂的规则重命名并放入不同的文件夹 也可能你想写一个小型的数据库应用一个特定的界面应用或者一个简单的游戏 如果你是专业的软件开发人员你可能需要编写一些 库但总觉得通常的开发的流程编写 编译 测试 再次编译等太慢了 可能给这样的库写一组测试就是很麻烦的工作了 或许你写了个软件可以支持插件扩展语言但你不想为了自己这一个应用专门设计和实现一种新语言了 那么 正好能满足你的需要 对于这些任务你也可以写 脚本或者 批处理完成但是 脚本最擅长移动文件和替换文本并不适合 界面或者游戏开发 你可以写一个 程序但是可能第一版本的草稿都要很长的开发时间 的使用则更加简单可以在 以及 操作系统上使用而且可以帮你更快地完成工作 很容易使用但它是一种真正的编程语言提供了很多数据结构也支持大型程序远超 脚本或批处理文件的功能 还提供比 语言更多的错误检查而且作为一种超高级语言它有高级的内置数据类型比如灵活的数组和字典 正因为这些更加通用的数据类型 能够应付更多的问题超过 甚至 而且很多东西在 中至少和那些语言同样简单 允许你划分程序模块在其他的 程序中重用 它内置了很多的标准模块你可以在此基础上开发程序 也可以作为例子开始学习 编程 例如文件输入输出系统调用套接字甚至图形界面接口工作包比如 是一种解释型语言在程序开发阶段可以为你节省大量时间因为不需要编译和链接 解释器可以交互式使用这样就可以方便地尝试语言特性写一些一次性的程序或者在自底向上的程序开发中测试功能 它也是一个顺手的桌面计算器 程序的书写是紧凑而易读的 代码通常比同样功能的 代码要短很多原因列举如下 高级数据类型允许在一个表达式中表示复杂的操作 代码块的划分是按照缩进而不是成对的花括号 不需要预先定义变量或参数 是可扩展的如果你知道怎么写 语言程序就能很容易地给解释器添加新的内置函数或模块不论是让关键的程序以最高速度运行还是把 程序链接到只提供预编译程序的库比如硬件相关的图形库 一旦你真正链接上了就能在 解释器中扩展或者控制 语言编写的应用了 顺便提一下这种语言的名字 意为蟒蛇来自于 节目 的飞行马戏团而与爬行动物没有关系 在文档中用 来开玩笑不只是可以的还是推荐的现在你已经对 跃跃欲试了想要深入了解一些细节了 因为学习语言的最佳方式是使用它本教程邀请你一边阅读一边在 解释器中玩耍 在下一章节会讲解使用解释器的方法 看起来相当枯燥但是对于尝试后续的例子来说是非常关键的 教程的其他部分将通过示例介绍 语言和系统中的不同功能开始是比较简单的表达式 语句和数据类型然后是函数和模块最终接触一些高级概念比如异常 用户定义的类 其他流程控制工具 除了刚刚介绍过的 语句 中也会使用其他语言中常见的流程控制语句只是稍有变化 语句 可能最为人所熟知的编程语句就是 语句了 例如 可以有零个或多个 部分以及一个可选的 部分 关键字 是 的缩写适合用于避免过多的缩进 一个 序列可以看作是其他语言中的 或 语句的替代 语句 中的 语句与你在 或 中所用到的有所不同 中的 语句并不总是对算术递增的数值进行迭代如同 或是给予用户定义迭代步骤和暂停条件的能力如同 而是对任意序列进行迭代例如列表或字符串条目的迭代顺序与它们在序列中出现的顺序一致 例如此处英文为双关语 在遍历同一个集合时修改该集合的代码可能很难获得正确的结果 通常更直接的做法是循环遍历该集合的副本或创建新集合 函数 如果你确实需要遍历一个数字序列内置函数 会派上用场 它生成算术级数 给定的终止数值并不在要生成的序列里 会生成 个值并且是以合法的索引生成一个长度为 的序列 也可以以另一个数字开头或者以指定的幅度增加甚至是负数有时这也被叫做 步进 要以序列的索引来迭代您可以将 和 组合如下 然而在大多数这类情况下使用 函数比较方便请参见 循环的技巧 如果你只打印 会出现奇怪的结果 所返回的对象在许多方面表现得像一个列表但实际上却并不是 此对象会在你迭代它时基于所希望的序列返回连续的项但它没有真正生成列表这样就能节省空间 我们称这样对象为 也就是说适合作为这样的目标对象函数和结构期望从中获取连续的项直到所提供的项全部耗尽 我们已经看到 语句就是这样一种结构而接受可迭代对象的函数的一个例子是 稍后我们将看到更多返回可迭代对象以及将可迭代对象作为参数的函数 最后也许你会很好奇如何从一个指定范围内获取一个列表 以下是解决方案 在 数据结构 章节中我们将讨论 的更多细节 和 语句以及循环中的 子句 语句和 中的类似用于跳出最近的 或 循环 循环语句可能带有 子句它会在循环耗尽了可迭代对象 使用 或循环条件变为假值 使用 时被执行但不会在循环被 语句终止时被执行 以下搜索素数的循环就是这样的一个例子 是的这是正确的代码 仔细看 子句属于 循环 不属于 语句 当和循环一起使用时 子句与 语句中的 子句的共同点多于 语句中的同类子句 语句中的 子句会在未发生异常时执行而循环中的 子句则会在未发生 时执行 有关 语句和异常的更多信息请参阅 处理异常 语句也是借鉴自 语言表示继续循环中的下一次迭代 语句 语句什么也不做 当语法上需要一个语句但程序需要什么动作也不做时可以使用它 例如 这通常用于创建最小的类 的另一个可以使用的场合是在你编写新的代码时作为一个函数或条件子句体的占位符允许你保持在更抽象的层次上进行思考 会被静默地忽略 定义函数 函数定义的更多形式 给函数定义有可变数目的参数也是可行的 这里有三种形式可以组合使用 参数默认值 关键字参数 特殊参数 任意的参数列表 最后最不常用的选项是可以使用任意数量的参数调用函数 这些参数会被包含在一个元组里参见 元组和序列 在可变数量的参数之前可能会出现零个或多个普通参数 一般来说这些 可变参数 将在形式参数列表的末尾因为它们收集传递给函数的所有剩余输入参数 出现在 参数之后的任何形式参数都是 仅关键字参数 也就是说它们只能作为关键字参数而不能是位置参数 解包参数列表 当参数已经在列表或元组中但要为需要单独位置参数的函数调用解包时会发生相反的情况 例如内置的 函数需要单独的 和 参数 如果它们不能单独使用可以使用 操作符 来编写函数调用以便从列表或元组中解包参数 同样的方式字典可使用 操作符 来提供关键字参数 表达式 可以用 关键字来创建一个小的匿名函数 这个函数返回两个参数的和 函数可以在需要函数对象的任何地方使用 它们在语法上限于单个表达式 从语义上来说它们只是正常函数定义的语法糖 与嵌套函数定义一样 函数可以引用所包含域的变量 上面的例子使用一个 表达式来返回一个函数 另一个用法是传递一个小函数作为参数 文档字符串 以下是有关文档字符串的内容和格式的一些约定 第一行应该是对象目的的简要概述 为简洁起见它不应显式声明对象的名称或类型因为这些可通过其他方式获得除非名称恰好是描述函数操作的动词 这一行应以大写字母开头以句点结尾 如果文档字符串中有更多行则第二行应为空白从而在视觉上将摘要与其余描述分开 后面几行应该是一个或多个段落描述对象的调用约定它的副作用等 解析器不会从 中删除多行字符串文字的缩进因此处理文档的工具必须在需要时删除缩进 这是使用以下约定完成的 文档字符串第一行 之后 的第一个非空行确定整个文档字符串的缩进量 我们不能使用第一行因为它通常与字符串的开头引号相邻因此它的缩进在字符串文字中不明显 然后从字符串的所有行的开头剥离与该缩进 等效 的空格 缩进更少的行不应该出现但是如果它们出现则应该剥离它们的所有前导空格 应在转化制表符为空格后测试空格的等效性通常转化为 个空格 下面是一个多行文档字符串的例子 函数标注 函数标注 是关于用户自定义函数中使用的类型的完全可选元数据信息有关详情请参阅 和 函数标注 以字典的形式存放在函数的 属性中并且不会影响函数的任何其他部分 形参标注的定义方式是在形参名称后加上冒号后面跟一个表达式该表达式会被求值为标注的值 返回值标注的定义方式是加上一个组合符号 后面跟一个表达式该标注位于形参列表和表示 语句结束的冒号之间 下面的示例有一个位置参数一个关键字参数以及返回值带有相应标注 小插曲编码风格 现在你将要写更长更复杂的 代码是时候讨论一下 代码风格 了 大多数语言都能以不同的风格被编写或更准确地说被格式化有些比其他的更具有可读性 能让其他人轻松阅读你的代码总是一个好主意采用一种好的编码风格对此有很大帮助 对于 已经成为大多数项目所遵循的风格指南它促进了一种非常易读且令人赏心悦目的编码风格 每个 开发人员都应该在某个时候阅读它以下是为你提取的最重要的几个要点 使用 个空格缩进不要使用制表符 个空格是一个在小缩进允许更大的嵌套深度和大缩进更容易阅读的 一种很好的折中方案 制表符会引入混乱最好不要使用它 换行使一行不超过 个字符 这有助于使用小型显示器的用户并且可以在较大的显示器上并排放置多个代 码文件 使用空行分隔函数和类以及函数内的较大的代码块 如果可能把注释放到单独的一行 使用文档字符串 在运算符前后和逗号后使用空格但不能直接在括号内使用 以一致的规则为你的类和函数命名按照惯例应使用 来命 名类而以 来命名函数和方法 始终应使 用 来命名第一个方法参数 有关类和方法的更多信息请参阅 初探类 如果你的代码旨在用于国际环境请不要使用花哨的编码 默认的 或者纯 在任何情况下都能有最好的表现 同样哪怕只有很小的可能遇到说不同语言的人阅读或维护代码也不要在 标识符中使用非 字符 脚注 实际上通过对象引用调用 会是一个更好的表述因为如果传递的是可 变对象则调用者将看到被调用者对其做出的任何更改插入到列表中的元 素 使用 解释器 调用解释器 传入参数 如果可能的话解释器会读取命令行参数转化为字符串列表存入 模块中的 变量中 执行命令 你可以导入这个模块并访问这个列表 这个列表最少也会有一个元素如果没有给定输入参数 就是个空字符串 如果给定的脚本名是 表示标准输入 就是 使用 时 就会是 如果使用选项 就是包含目录的模块全名 在 或 之后的选项不会被解释器处理而会直接留在 中给命令或模块来处理 交互模式 在终端 输入并执行指令时我们说解释器是运行在 交互模式 在这种模式中它会显示 主提示符 提示输入下一条指令通常用三个大于号表示连续输入行的时候它会显示 次要提示符默认是三个点 进入解释器时它会先显示欢迎信息 版本信息 版权声明然后就会出现提示符 多行指令需要在连续的多行中输入 比如以 为例 有关交互模式的更多内容请参考 交互模式 解释器的运行环境 源文件的字符编码 默认情况下 源码文件以 编码方式处理 在这种编码方式中世界上大多数语言的字符都可以同时用于字符串字面值 变量或函数名称以及注释中 尽管标准库中只用常规的 字符作为变量或函数名而且任何可移植的代码都应该遵守此约定 要正确显示这些字符你的编辑器必须能识别 编码而且必须使用能支持打开的文件中所有字符的字体 如果不使用默认编码要声明文件所使用的编码文件的 第一 行要写成特殊的注释 语法如下所示 其中 可以是 支持的任意一种 比如要声明使用 编码你的源码文件要写成 关于 第一行 规则的一种例外情况是源码以 行 开头 这种情况下编码声明就要写在文件的第二行 例如 脚注 在 系统中 解释器默认安装后的执行文件并不叫作 这样才不会与同时安装的 冲突 浮点算术争议和限制 表示性错误 本小节将详细解释 的例子并说明你可以怎样亲自对此类情况进行精确分析 假定前提是已基本熟悉二进制浮点表示法 表示性错误 是指某些其实是大多数十进制小数无法以二进制以 为基数的计数制精确表示这一事实造成的错误 这就是为什么 或者 以及许多其他语言经常不会显示你所期待的精确十进制数值的主要原因 为什么会这样 是无法用二进制小数精确表示的 目前 年 月几乎所有使用 浮点运算标准的机器以及几乎所有系统平台都会将 浮点数映射为 双精度类型 双精度类型包含 位精度因此在输入时计算会尽量将 转换为以 形式所能表示的最接近分数其中 为恰好包含 个二进制位的整数 重新将 写为 并且由于 恰好有 位 即 但 的最佳值为 也就是说 是唯一的 值能令 恰好有 位 这样 的最佳可能值就是经过舍入的商 由于余数超过 的一半最佳近似值可通过四舍五入获得 这样在 双精度下 的最佳近似值为 分子和分母都除以二则结果小数为 请注意由于我们做了向上舍入这个结果实际上略大于 如果我们没有向上舍入则商将会略小于 但无论如何它都不会是 精确的 因此计算永远不会看到 它实际看到的就是上面所给出的小数它所能达到的最佳 双精度近似值 如果我们将该小数乘以 我们可以看到该值输出为 位的十进制数 这意味着存储在计算机中的确切数值等于十进制数值 许多语言包括较旧版本的 都不会显示这个完整的十进制数值而是将结果舍入为 位有效数字 和 模块可令进行此类计算更加容易 错误和异常 到目前为止我们还没有提到错误消息但是如果你已经尝试过那些例子你可能已经看过了一些错误消息 目前至少有两种可区分的错误语法错误和 异常 语法错误 语法错误又称解析错误可能是你在学习 时最容易遇到的错误 解析器会输出出现语法错误的那一行并显示一个箭头指向这行里面检测到的第一个错误 错误是由箭头指示的位置 上面 的 引起的或者至少是在这里被检测出的在示例中在 这个函数中检测到了错误因为在它前面少了个冒号 文件名和行号也会被输出以便输入来自脚本文件时你能知道去哪检查 异常 即使语句或表达式在语法上是正确的但在尝试执行时它仍可能会引发错误 在执行时检测到的错误被称为异常异常不一定会导致严重后果你将很快学会如何在 程序中处理它们 但是大多数异常并不会被程序处理此时会显示如下所示的错误信息 错误信息的最后一行告诉我们程序遇到了什么类型的错误 异常有不同的类型而其类型名称将会作为错误信息的一部分中打印出来上述示例中的异常类型依次是 和 作为异常类型打印的字符串是发生的内置异常的名称 对于所有内置异常都是如此但对于用户定义的异常则不一定如此虽然这是一个有用的规范 标准的异常类型是内置的标识符而不是保留关键字 这一行的剩下的部分根据异常类型及其原因提供详细信息 错误消息的开头部分以堆栈回溯的形式显示发生异常的上下文 通常它会包含列出源代码行的堆栈回溯但是它将不会显示从标准输入读取的行 内置异常 列出了内置异常和它们的含义 处理异常 抛出异常 语句允许程序员强制发生指定的异常 例如 唯一的参数就是要抛出的异常 这个参数必须是一个异常实例或者是一个异常类派生自 的类 如果传递的是一个异常类它将通过调用没有参数的构造函数来隐式实例化 如果你需要确定是否引发了异常但不打算处理它则可以使用更简单的 语句形式重新引发异常 异常链 这在你要转换异常时很有用 例如 内置异常 用户自定义异常 程序可以通过创建新的异常类来命名它们自己的异常有关 类的更多信息请参阅 类 异常通常应该直接或间接地从 类派生 可以定义异常类它可以执行任何其他类可以执行的任何操作但通常保持简单只提供一些属性这些属性允许处理程序为异常提取有关错误的信息 在创建可能引发多个不同错误的模块时通常的做法是为该模块定义的异常创建基类并为不同错误条件创建特定异常类的子类 大多数异常都定义为名称以 结尾类似于标准异常的命名 许多标准模块定义了它们自己的异常以报告它们定义的函数中可能出现的错误 有关类的更多信息请参见 类 章节 定义清理操作 语句有另一个可选子句用于定义必须在所有情况下执行的清理操作 例如 如果存在 子句则 子句将作为 语句结束前的最后一项任务被执行 子句不论 语句是否产生了异常都会被执行 以下几点讨论了当异常发生时一些更复杂的情况 如果在执行 子句期间发生了异常该异常可由一个 子句进 行处理 如果异常没有被某个 子句所处理则该异常会在 子句执行之后被重新引发 异常也可能在 或 子句执行期间发生 同样地该异常会 在 子句执行之后被重新引发 如果在执行 语句时遇到一个 或 语句 则 子句将在执行 或 语句之前 被执行 如果 子句中包含一个 语句则返回值将来自 子句的某个 语句的返回值而非来自 子句的 语句的返回值 例如 一个更为复杂的例子 正如你所看到的 子句在任何情况下都会被执行 两个字符串相除所引发的 不会由 子句处理因此会在 子句执行后被重新引发 在实际应用程序中 子句对于释放外部资源例如文件或者网络连接非常有用无论是否成功使用资源 预定义的清理操作 某些对象定义了在不再需要该对象时要执行的标准清理操作无论使用该对象的操作是成功还是失败清理操作都会被执行 请查看下面的示例它尝试打开一个文件并把其内容打印到屏幕上 这个代码的问题在于它在这部分代码执行完后会使文件在一段不确定的时间内处于打开状态 这在简单脚本中不是问题但对于较大的应用程序来说可能是个问题 语句允许像文件这样的对象能够以一种确保它们得到及时和正确的清理的方式使用 执行完语句后即使在处理行时遇到问题文件 也始终会被关闭 和文件一样提供预定义清理操作的对象将在其文档中指出这一点 标准库简介 第二部分 第二部分涵盖了专业编程所需要的更高级的模块 这些模块很少用在小脚本中 格式化输出 模块提供了一个定制化版本的 函数用于缩略显示大型或深层嵌套的容器对象 模块提供了更加复杂的打印控制其输出的内置对象和用户自定义对象能够被解释器直接读取 当输出结果过长而需要折行时美化输出机制会添加换行符和缩进以更清楚地展示数据结构 模块能够格式化文本段落以适应给定的屏幕宽度 模块处理与特定地域文化相关的数据格式 模块的 函数包含一个 属性可直接将数字格式化为带有组分隔符的样式 模板 使用二进制数据记录格式 模块提供了 和 函数用于处理不定长度的二进制记录格式 下面的例子展示了在不使用 模块的情况下如何循环遍历一个 文件的所有头信息 代码 和 分别代表两字节和四字节无符号整数 代表它们是标准尺寸的小端字节序 多线程 线程是一种对于非顺序依赖的多个任务进行解耦的技术 多线程可以提高应用的响应效率当接收用户输入的同时保持其他任务在后台运行 一个有关的应用场景是将 和计算运行在两个并行的线程中 以下代码展示了高阶的 模块如何在后台运行任务且不影响主程序的继续运行 多线程应用面临的主要挑战是相互协调的多个线程之间需要共享数据或其他资源 为此 模块提供了多个同步操作原语包括线程锁 事件 条件变量和信号量 尽管这些工具非常强大但微小的设计错误却可以导致一些难以复现的问题 因此实现多任务协作的首选方法是将所有对资源的请求集中到一个线程中然后使用 模块向该线程供应来自其他线程的请求 应用程序使用 对象进行线程间通信和协调更易于设计更易读更可靠 日志 模块提供功能齐全且灵活的日志记录系统 在最简单的情况下日志消息被发送到文件或 这会产生以下输出 默认情况下 和 消息被压制输出会发送到标准错误流 其他输出选项包括将消息转发到电子邮件数据报套接字或 服务器 新的过滤器可以根据消息优先级选择不同的路由方式 和 日志系统可以直接从 配置也可以从用户配置文件加载以便自定义日志记录而无需更改应用程序 弱引用 会自动进行内存管理对大多数对象进行引用计数并使用 来清除循环引用 当某个对象的最后一个引用被移除后不久就会释放其所占用的内存 此方式对大多数应用来说都适用但偶尔也必须在对象持续被其他对象所使用时跟踪它们 不幸的是跟踪它们将创建一个会令其永久化的引用 模块提供的工具可以不必创建引用就能跟踪对象 当对象不再需要时它将自动从一个弱引用表中被移除并为弱引用对象触发一个回调 典型应用包括对创建开销较大的对象进行缓存 用于操作列表的工具 许多对于数据结构的需求可以通过内置列表类型来满足 但是有时也会需要具有不同效费比的替代实现 模块提供了一种 对象它类似于列表但只能存储类型一致的数据且存储密集更高 下面的例子演示了一个以两个字节为存储单元的无符号二进制数值的数组 类型码为 而对于普通列表来说每个条目存储为标准 的 对象通常要占用 个字节 模块提供了一种 对象它类似于列表但从左端添加和弹出的速度较快而在中间查找的速度较慢 此种对象适用于实现队列和广度优先树搜索 在替代的列表实现以外标准库也提供了其他工具例如 模块具有用于操作有序列表的函数 模块提供了基于常规列表来实现堆的函数 最小值的条目总是保持在位置零 这对于需要重复访问最小元素而不希望运行完整列表排序的应用来说非常有用 十进制浮点运算 模块提供了一种 数据类型用于十进制浮点运算 相比内置的 二进制浮点实现该类特别适用于 财务应用和其他需要精确十进制表示的用途 控制精度 控制四舍五入以满足法律或监管要求 跟踪有效小数位或 用户期望结果与手工完成的计算相匹配的应用程序 例如使用十进制浮点和二进制浮点数计算 美分手机和 税的总费用会产生的不同结果 如果结果四舍五入到最接近的分数差异会更大 表示的结果会保留尾部的零并根据具有两个有效位的被乘数自动推出四个有效位 可以模拟手工运算来避免当二进制浮点数无法精确表示十进制数时会导致的问题 精确表示特性使得 类能够执行对于二进制浮点数来说不适用的模运算和相等性检测 模块提供了运算所需要的足够精度 虚拟环境和包 概述 应用程序通常会使用不在标准库内的软件包和模块 应用程序有时需要特定版本的库因为应用程序可能需要修复特定的错误或者可以使用库的过时版本的接口编写应用程序 这意味着一个 安装可能无法满足每个应用程序的要求 如果应用程序 需要特定模块的 版本但应用程序 需要 版本则需求存在冲突安装版本 或 将导致某一个应用程序无法运行 这个问题的解决方案是创建一个 一个目录树其中安装有特定 版本以及许多其他包 然后不同的应用将可以使用不同的虚拟环境 要解决先前需求相冲突的例子应用程序 可以拥有自己的 安装了 版本的虚拟环境而应用程序 则拥有安装了 版本的另一个虚拟环境 如果应用程序 要求将某个库升级到 版本也不会影响应用程序 的环境 创建虚拟环境 用于创建和管理虚拟环境的模块称为 通常会安装你可用的最新版本的 如果您的系统上有多个版本的 您可以通过运行 或您想要的任何版本来选择特定的 版本 要创建虚拟环境请确定要放置它的目录并将 模块作为脚本运行目录路径 如果 目录不存在它将为你创建一个并在其中创建包含 解释器标准库和各种支持文件的副本的目录 虚拟环境的常用目录位置是 这个名称通常会令该目录在你的终端中保持隐藏从而避免需要对所在目录进行额外解释的一般名称 它还能防止与某些工具所支持的 环境变量定义文件发生冲突 创建虚拟环境后您可以激活它 在 上运行 在 或 上运行 这个脚本是为 编写的 如果你使用 或 你应该改用 或 脚本 激活虚拟环境将改变你所用终端的提示符以显示你正在使用的虚拟环境并修改环境以使 命令所运行的将是已安装的特定 版本 例如 使用 管理包 你可以使用一个名为 的程序来安装 升级和移除软件包 默认情况下 将从 安装软件包 你可以在浏览器中访问 或是使用 受限的搜索功能 有许多子命令 等等 请参阅 安装 模块 指南以了解 的完整文档 您可以通过指定包的名称来安装最新版本的包 您还可以通过提供包名称后跟 和版本号来安装特定版本的包 如果你重新运行这个命令 会注意到已经安装了所请求的版本并且什么都不做 您可以提供不同的版本号来获取该版本或者您可以运行 将软件包升级到最新版本 后跟一个或多个包名称将从虚拟环境中删除包 将显示有关特定包的信息 将显示虚拟环境中安装的所有软件包 将生成一个类似的已安装包列表但输出使用 期望的格式 一个常见的约定是将此列表放在 文件中 然后可以将 提交给版本控制并作为应用程序的一部分提供 然后用户可以使用 安装所有必需的包 有更多选择 有关 的完整文档请参阅 安装 模块 指南 当您编写一个包并希望在 包索引中使它可用时请参考 分发 模块 指南 附录 交互模式 错误处理 当发生错误时解释器会打印错误信息和错误堆栈 在交互模式下将返回到主命令提示符如果输入内容来自文件在打印错误堆栈之后程序会以非零状态退出 这里所说的错误不包括 语句中由 所捕获的异常 有些错误是无条件致命的会导致程序以非零状态退出比如内部逻辑矛盾或内存耗尽 所有错误信息都会被写入标准错误流而命令的正常输出则被写入标准输出流 将中断字符通常为 或 键入主要或辅助提示会取消输入并返回主提示符 在执行命令时键入中断引发的 异常可以由 语句处理 可执行的 脚本 在 等类 系统上 脚本可以直接执行就像 脚本一样第一行添加 假设解释器位于用户的 脚本的开头并将文件设置为可执行 必须是文件的前两个字符 在某些平台上第一行必须以 样式的行结尾 结束而不是以 行结尾 请注意散列或磅字符 在 中代表注释开始 可以使用 命令为脚本提供可执行模式或权限 在 系统上没有可执行模式的概念 安装程序自动将 文件与 相关联这样双击 文件就会将其作为脚本运行 扩展也可以是 在这种情况下会隐藏通常出现的控制台窗口 交互式启动文件 当您以交互方式使用 时每次启动解释器时都会执行一些标准命令这通常很方便 您可以通过将名为 的环境变量设置为包含启动命令的文件名来实现 这类似于 的 功能 此文件只会在交互式会话时读取而非在 从脚本读取指令或是在给定 为指令的明确来源时后者反而表现得像是一个交互式会话 该文件执行时所在的命名空间与交互式指令相同所以它定义或导入的对象可以在交互式会话中直接使用 你也可以在该文件中更改提示符 和 如果你想从当前目录中读取一个额外的启动文件你可以使用像 这样的代码在全局启动文件中对它进行编程 如果要在脚本中使用启动文件则必须在脚本中显式执行此操作 定制模块 提供了两个钩子来让你自定义它 和 要查看其工作原理首先需要找到用户 目录的位置 启动 并运行此代码 现在您可以在该目录中创建一个名为 的文件并将所需内容放入其中 它会影响 的每次启动除非它以 选项启动以禁用自动导入 以相同的方式工作但通常由计算机管理员在全局 目录中创建并在 之前被导入 有关详情请参阅 模块的文档 脚注 包的问题可能会阻止这种情况 教程 接下来 阅读本教程可能会增强您对使用 的兴趣 您应该热衷于应用 来解决您的实际问题 你应该去哪里了解更多 本教程是 文档集的一部分 其他文档 标准库 您应该浏览本手册该手册提供了有关标准库中的类型功能和模块的完整 尽管简洁参考资料 标准的 发行版包含 很多 的附加代码 有些模 块可以读取 邮箱通过 检索文档生成随机数解析命令行选项编 写 程序压缩数据以及许多其他任务 浏览标准库参考可以了解更多可用 的内容 安装 模块 解释了怎么安装由其他 开发者编写的模块 语言参考 的语法和语义的详细解释 尽管阅读完非常繁重 但作为语言本身的完整指南是有用的 更多 资源 主要的 网站 它包含代码文档以及指向 上与 相关的页面的链接 该网站世界很多地区都有镜像如欧洲 日本和澳大利亚镜像可能比主站点更快具体取决于您的地理位置 快速访问 的文档 以前也被昵称为 是可下载用户自制 模块的索引 当你要开始发布代码时 你可以在此处进行注册以便其他人能找到它 是一个相当大的代码示例集更多的模块和有用的脚本 特别值得注意的贡献 收集在一本名为 的书中 从会议和用户组会议中收集与 相关的视频的 链接 项目包括用于快速阵列计算和操作 的模块以及用于诸如线性代数傅里叶变换非线性求解器随机数分布 统计分析等的一系列包 对于与 相关的问题和问题报告您可以发布到新闻组 或者将它们发送到邮件列表 新闻组和邮件列表是互通的因此发布到一个地方将自动转发给另一个 每天有数百个帖子询问和回答问题建议新功能以及宣布新模块 邮件列表档案可在 上找到 在发问之前请务必查看以下列表 常见问题 或简写为 常见问题包含了很多一次又一次问到的问题及答案并且可能已经包含了您的问题的解决方案 备注 是 的一个短剧一位顾客来到一家奶酪商店 但无论他要哪种奶酪店员都说没有货 标准库简介 操作系统接口 模块提供了许多与操作系统交互的函数 一定要使用 而不是 这将避免内建的 函数被 隐式替换掉因为它们的使用方式大不相同 内置的 和 函数可用作交互式辅助工具用于处理大型模块如 对于日常文件和目录管理任务 模块提供了更易于使用的更高级别的接口 文件通配符 模块提供了一个在目录中使用通配符搜索创建文件列表的函数 命令行参数 通用实用程序脚本通常需要处理命令行参数 这些参数作为列表存储在 模块的 属性中 例如以下输出来自在命令行运行 模块提供了一种更复杂的机制来处理命令行参数 以下脚本可提取一个或多个文件名并可选择要显示的行数 当在通过 在命令行运行时该脚本会将 设为 并将 设为 错误输出重定向和程序终止 模块还具有 和 的属性 后者对于发出警告和错误消息非常有用即使在 被重定向后也可以看到它们 终止脚本的最直接方法是使用 字符串模式匹配 模块为高级字符串处理提供正则表达式工具 对于复杂的匹配和操作正则表达式提供简洁优化的解决方案 当只需要简单的功能时首选字符串方法因为它们更容易阅读和调试 数学 互联网访问 有许多模块可用于访问互联网和处理互联网协议 其中两个最简单的 用于从 检索数据以及 用于发送邮件 请注意第二个示例需要在 上运行的邮件服务器 日期和时间 模块提供了以简单和复杂的方式操作日期和时间的类 虽然支持日期和时间算法但实现的重点是有效的成员提取以进行输出格式化和操作 该模块还支持可感知时区的对象 数据压缩 常见的数据存档和压缩格式由模块直接支持包括 和 性能测量 一些 用户对了解同一问题的不同方法的相对性能产生了浓厚的兴趣 提供了一种可以立即回答这些问题的测量工具 例如元组封包和拆包功能相比传统的交换参数可能更具吸引力 模块可以快速演示在运行效率方面一定的优势 与 的精细粒度级别相反 和 模块提供了用于在较大的代码块中识别时间关键部分的工具 质量控制 开发高质量软件的一种方法是在开发过程中为每个函数编写测试并在开发过程中经常运行这些测试 模块提供了一个工具用于扫描模块并验证程序文档字符串中嵌入的测试 测试构造就像将典型调用及其结果剪切并粘贴到文档字符串一样简单 这通过向用户提供示例来改进文档并且它允许 模块确保代码保持对文档的真实 模块不像 模块那样易于使用但它允许在一个单独的文件中维护更全面的测试集 自带电池 有自带电池的理念 通过其包的复杂和强大功能可以最好地看到这一点 例如 和 模块使远程过程调用的实现几近轻松 尽管模块名称中有 字样但用户不需要直接了解或处理 包是一个用于管理电子邮件的库包括 和其他基于 的邮件文档 与 和 实际上发送和接收消息不同 电子邮件包具有完整的工具集用于构建或解码复杂的消息结构包括附件 以及实现互联网编码和标头协议 包为解析这种流行的数据交换格式提供了强大的支持 模块 支持以逗号分隔值格式直接读取和写入文件这些格式通常由数据库和电子表 格支持 处理由 和 包支持 这些模块和软件包共同大大简化了 应用程序和其他工具之间的 数据交换 模块是 数据库库的包装器提供了一个可以使用稍微非标准 的 语法更新和访问的持久数据库 国际化由许多模块支持包括 以及 包 交互式编辑和编辑历史 某些版本的 解释器支持编辑当前输入行和编辑历史记录类似 和 的功能 这个功能使用了 来实现一个支持多种编辑方式的库 这个库有它自己的文档在这里我们就不重复说明了 补全和编辑历史 默认交互式解释器的替代品 类 名称和对象 对象具有个性多个名称在多个作用域内可以绑定到同一个对象 这在其他语言中称为别名 乍一看 时通常不会理解这一点在处理不可变的基本类型数字字符串元组时可以安全地忽略它 但是别名对涉及可变对象如列表字典和大多数其他类型的 代码的语义可能会产生惊人的影响 通常这样做是为了使程序受益因为别名在某些方面表现得像指针 例如传递一个对象的代价很小因为实现只传递一个指针如果函数修改了作为参数传递的对象调用者将看到更改 这就不需要像 中那样使用两个不同的参数传递机制 作用域和命名空间 作用域和命名空间示例 这个例子演示了如何引用不同作用域和名称空间以及 和 会如何影响变量绑定 示例代码的输出是 请注意 局部 赋值这是默认状态不会改变 对 的绑定 赋值会改变 对 的绑定而 赋值会改变模块层级的绑定 您还可以在 赋值之前看到之前没有 的绑定 初探类 类引入了一些新语法三种新对象类型和一些新语义 类定义语法 最简单的类定义看起来像这样 类定义与函数定义 语句 一样必须被执行才会起作用 你可以尝试将类定义放在 语句的一个分支或是函数的内部 在实践中类定义内的语句通常都是函数定义但也允许有其他语句有时还很有用 我们会稍后再回来说明这个问题 在类内部的函数定义通常具有一种特别形式的参数列表这是方法调用的约定规范所指明的 这个问题也将在稍后再说明 当进入类定义时将创建一个新的命名空间并将其用作局部作用域 因此所有对局部变量的赋值都是在这个新命名空间之内 特别的函数定义会绑定到这里的新函数名称 当从结尾处正常离开类定义时将创建一个 类对象 这基本上是一个包围在类定义所创建命名空间内容周围的包装器我们将在下一节了解有关类对象的更多信息 原始的在进入类定义之前起作用的局部作用域将重新生效类对象将在这里被绑定到类定义头所给出的类名称 在这个示例中为 类对象 类对象支持两种操作属性引用和实例化 属性引用 使用 中所有属性引用所使用的标准语法 有效的属性名称是类对象被创建时存在于类命名空间中的所有名称 因此如果类定义是这样的 那么 和 就是有效的属性引用将分别返回一个整数和一个函数对象 类属性也可以被赋值因此可以通过赋值来更改 的值 也是一个有效的属性将返回所属类的文档字符串 类的 实例化 使用函数表示法 可以把类对象视为是返回该类的一个新实例的不带参数的函数 举例来说假设使用上述的类 创建类的新 实例 并将此对象分配给局部变量 实例化操作调用类对象会创建一个空对象 许多类喜欢创建带有特定初始状态的自定义实例 为此类定义可能包含一个名为 的特殊方法就像这样 当一个类定义了 方法时类的实例化操作会自动为新创建的类实例发起调用 因此在这个示例中可以通过以下语句获得一个经初始化的新实例 当然 方法还可以有额外参数以实现更高灵活性 在这种情况下提供给类实例化运算符的参数将被传递给 例如 实例对象 现在我们能用实例对象做什么 实例对象理解的唯一操作是属性引用 有两种有效的属性名称数据属性和方法 数据属性 对应于 中的实例变量以及 中的数据成员 数据属性不需要声明像局部变量一样它们将在第一次被赋值时产生 例如如果 是上面创建的 的实例则以下代码段将打印数值 且不保留任何追踪信息 另一类实例属性引用称为 方法 方法是从属于对象的函数 在 中方法这个术语并不是类实例所特有的其他对象也可以有方法 例如列表对象具有 等方法 然而在以下讨论中我们使用方法一词将专指类实例对象的方法除非另外显式地说明 实例对象的有效方法名称依赖于其所属的类 根据定义一个类中所有是函数对象的属性都是定义了其实例的相应方法 因此在我们的示例中 是有效的方法引用因为 是一个函数而 不是方法因为 不是一个函数 但是 与 并不是一回事 它是一个 方法对象不是函数对象 方法对象 通常方法在绑定后立即被调用 在 示例中这将返回字符串 但是立即调用一个方法并不是必须的 是一个方法对象它可以被保存起来以后再调用 例如 将继续打印 直到结束 当一个方法被调用时到底发生了什么 你可能已经注意到上面调用 时并没有带参数虽然 的函数定义指定了一个参数 这个参数发生了什么事 当不带参数地调用一个需要参数的函数时 肯定会引发异常 即使参数实际未被使用 实际上你可能已经猜到了答案方法的特殊之处就在于实例对象会作为函数的第一个参数被传入 在我们的示例中调用 其实就相当于 总之调用一个具有 个参数的方法就相当于调用再多一个参数的对应函数这个参数值为方法所属实例对象位置在其他参数之前 如果你仍然无法理解方法的运作原理那么查看实现细节可能会澄清问题 当一个实例的非数据属性被引用时将搜索实例所属的类 如果被引用的属性名称表示一个有效的类属性中的函数对象会通过打包指向查找到的实例对象和函数对象到一个抽象对象的方式来创建方法对象这个抽象对象就是方法对象 当附带参数列表调用方法对象时将基于实例对象和参数列表构建一个新的参数列表并使用这个新参数列表调用相应的函数对象 类和实例变量 一般来说实例变量用于每个实例的唯一数据而类变量用于类的所有实例共享的属性和方法 正如 名称和对象 中已讨论过的共享数据可能在涉及 对象例如列表和字典的时候导致令人惊讶的结果 例如以下代码中的 列表不应该被用作类变量因为所有的 实例将只共享一个单独的列表 正确的类设计应该使用实例变量 补充说明 继承 当然如果不支持继承语言特性就不值得称为类 派生类定义的语法如下所示 名称 必须定义于包含派生类定义的作用域中 也允许用其他任意表达式代替基类名称所在的位置 这有时也可能会用得上例如当基类定义在另一个模块中的时候 派生类定义的执行过程与基类相同 当构造类对象时基类会被记住 此信息将被用来解析属性引用如果请求的属性在类中找不到搜索将转往基类中进行查找 如果基类本身也派生自其他某个类则此规则将被递归地应用 派生类的实例化没有任何特殊之处 会创建该类的一个新实例 方法引用将按以下方式解析搜索相应的类属性如有必要将按基类继承链逐步向下查找如果产生了一个函数对象则方法引用就生效 派生类可能会重写其基类的方法 因为方法在调用同一对象的其他方法时没有特殊权限所以调用同一基类中定义的另一方法的基类方法最终可能会调用覆盖它的派生类的方法 对 程序员的提示 中所有的方法实际上都是 方法 在派生类中的重载方法实际上可能想要扩展而非简单地替换同名的基类方法 有一种方式可以简单地直接调用基类方法即调用 有时这对客户端来说也是有用的 请注意仅当此基类可在全局作用域中以 的名称被访问时方可使用此方式 有两个内置函数可被用于继承机制 使用 来检查一个实例的类型 仅 会在 为 或某个派生自 的类时为 使用 来检查类的继承关系 为 因为 是 的子类 但是 为 因为 不是 的子类 多重继承 也支持一种多重继承 带有多个基类的类定义语句如下所示 对于多数应用来说在最简单的情况下你可以认为搜索从父类所继承属性的操作是深度优先 从左至右的当层次结构中存在重叠时不会在同一个类中搜索两次 因此如果某一属性在 中未找到则会到 中搜索它然后递归地到 的基类中搜索如果在那里未找到再到 中搜索依此类推 真实情况比这个更复杂一些方法解析顺序会动态改变以支持对 的协同调用 这种方式在某些其他多重继承型语言中被称为后续方法调用它比单继承型语言中的 调用更强大 动态改变顺序是有必要的因为所有多重继承的情况都会显示出一个或更多的菱形关联即至少有一个父类可通过多条路径被最底层类所访问 例如所有类都是继承自 因此任何多重继承的情况都提供了一条以上的路径可以通向 为了确保基类不会被访问一次以上动态算法会用一种特殊方式将搜索顺序线性化 保留每个类所指定的从左至右的顺序只调用每个父类一次并且保持单调即一个类可以被子类化而不影响其父类的优先顺序 总而言之这些特性使得设计具有多重继承的可靠且可扩展的类成为可能 要了解更多细节请参阅 私有变量 杂项说明 有时会需要使用类似于 的 或 的 这样的数据类型将一些命名数据项捆绑在一起 这种情况适合定义一个空类 一段需要特定抽象数据类型的 代码往往可以被传入一个模拟了该数据类型的方法的类作为替代 例如如果你有一个基于文件对象来格式化某些数据的函数你可以定义一个带有 和 方法从字符串缓存获取数据的类并将其作为参数传入 实例方法对象也具有属性 就是带有 方法的实例对象而 则是该方法所对应的函数对象 迭代器 到目前为止您可能已经注意到大多数容器对象都可以使用 语句 这种访问风格清晰 简洁又方便 迭代器的使用非常普遍并使得 成为一个统一的整体 在幕后 语句会在容器对象上调用 该函数返回一个定义了 方法的迭代器对象此方法将逐一访问容器中的元素 当元素用尽时 将引发 异常来通知终止 循环 你可以使用 内置函数来调用 方法这个例子显示了它的运作方式 看过迭代器协议的幕后机制给你的类添加迭代器行为就很容易了 定义一个 方法来返回一个带有 方法的对象 如果类已定义了 则 可以简单地返回 生成器 生成器 是一个用于创建迭代器的简单而强大的工具 它们的写法类似于标准的函数但当它们要返回数据时会使用 语句 每次在生成器上调用 时它会从上次离开的位置恢复执行它会记住上次执行语句时的所有数据值 一个显示如何非常容易地创建生成器的示例如下 可以用生成器来完成的操作同样可以用前一节所描述的基于类的迭代器来完成 但生成器的写法更为紧凑因为它会自动创建 和 方法 另一个关键特性在于局部变量和执行状态会在每次调用之间自动保存 这使得该函数相比使用 和 这种实例变量的方式更易编写且更为清晰 除了会自动创建方法和保存程序状态当生成器终结时它们还会自动引发 这些特性结合在一起使得创建迭代器能与编写常规函数一样容易 生成器表达式 某些简单的生成器可以写成简洁的表达式代码所用语法类似列表推导式但外层为圆括号而非方括号 这种表达式被设计用于生成器将立即被外层函数所使用的情况 生成器表达式相比完整的生成器更紧凑但较不灵活相比等效的列表推导式则更为节省内存 例如 脚注 存在一个例外 模块对象有一个秘密的只读属性 它返回用于 实现模块命名空间的字典 是属性但不是全局名称 显然使 用这个将违反命名空间实现的抽象应当仅被用于事后调试器之类的场合 模块 如果你从 解释器退出并再次进入之前的定义函数和变量都会丢失 因此如果你想编写一个稍长些的程序最好使用文本编辑器为解释器准备输入并将该文件作为输入运行 这被称作编写 脚本 随着程序变得越来越长你或许会想把它拆分成几个文件以方便维护 你亦或想在不同的程序中使用一个便捷的函数 而不必把这个函数复制到每一个程序中去 为支持这些 有一种方法可以把定义放在一个文件里并在脚本或解释器的交互式实例中使用它们 这样的文件被称作 模块 模块中的定义可以 导入 到其它模块或者 主 模块你在顶级和计算器模式下执行的脚本中可以访问的变量集合 模块是一个包含 定义和语句的文件 文件名就是模块名后跟文件后缀 在一个模块内部模块名作为一个字符串可以通过全局变量 的值获得 例如使用你最喜爱的文本编辑器在当前目录下创建一个名为 的文件 文件中含有以下内容 现在进入 解释器并用以下命令导入该模块 在当前的符号表中这并不会直接进入到定义在 函数内的名称它只是进入到模块名 中 你可以用模块名访问这些函数 如果你想经常使用某个函数你可以把它赋值给一个局部变量 有关模块的更多信息 以脚本的方式执行模块 当你用下面方式运行一个 模块 模块里的代码会被执行就好像你导入了模块一样但是 被赋值为 这意味着通过在你的模块末尾添加这些代码 你既可以把这个文件当作脚本又可当作一个可调入的模块来使用 因为那段解析命令行的代码只有在当模块是以 文件的方式执行的时候才会运行 如果模块是被导入的那些代码是不运行的 这经常用于为模块提供一个方便的用户接口或用于测试以脚本的方式运行模块从而执行一些测试套件 模块搜索路径 编译过的 文件 标准模块 附带了一个标准模块库在单独的文档 库参考以下称为库参考中进行了描述 一些模块内置于解释器中它们提供对不属于语言核心但仍然内置的操作的访问以提高效率或提供对系统调用等操作系统原语的访问 这些模块的集合是一个配置选项它也取决于底层平台 例如 模块只在 操作系统上提供 一个特别值得注意的模块 它被内嵌到每一个 解释器中 变量 和 定义用作主要和辅助提示的字符串 这两个变量只有在编译器是交互模式下才被定义 变量是一个字符串列表用于确定解释器的模块搜索路径 该变量被初始化为从环境变量 获取的默认路径或者如果 未设置则从内置默认路径初始化 你可以使用标准列表操作对其进行修改 函数 内置函数 用于查找模块定义的名称 它返回一个排序过的字符串列表 如果没有参数 会列出你当前定义的名称 注意它列出所有类型的名称变量模块函数等等 不会列出内置函数和变量的名称 如果你想要这些它们的定义是在标准模块 中 包 包是一种通过用带点号的模块名来构造 模块命名空间的方法 例如模块名 表示 包中名为 的子模块 正如模块的使用使得不同模块的作者不必担心彼此的全局变量名称一样使用加点的模块名可以使得 或 等多模块软件包的作者不必担心彼此的模块名称一样 假设你想为声音文件和声音数据的统一处理设计一个模块集合一个包 由于存在很多不同的声音文件格式通常由它们的扩展名来识别例如 因此为了不同文件格式间的转换你可能需要创建和维护一个不断增长的模块集合 你可能还想对声音数据还做很多不同的处理例如混声添加回声使用均衡器功能创造人工立体声效果 因此为了实现这些处理你将另外写一个无穷尽的模块流 这是你的包的可能结构以分层文件系统的形式表示 当导入这个包时 搜索 里的目录查找包的子目录 必须要有 文件才能让 将包含该文件的目录当作包 这样可以防止具有通常名称例如 的目录在无意中隐藏稍后在模块搜索路径上出现的有效模块 在最简单的情况下 可以只是一个空文件但它也可以执行包的初始化代码或设置 变量具体将在后文介绍 包的用户可以从包中导入单个模块例如 这会加载子模块 但引用它时必须使用它的全名 导入子模块的另一种方法是 这也会加载子模块 并使其在没有包前缀的情况下可用因此可以按如下方式使用 另一种形式是直接导入所需的函数或变量 同样这也会加载子模块 但这会使其函数 直接可用 请注意当使用 时 可以是包的子模块或子包也可以是包中定义的其他名称如函数类或变量 语句首先测试是否在包中定义了 如果没有它假定它是一个模块并尝试加载它 如果找不到它则引发 异常 相反当使用 这样的语法时除了最后一项之外的每一项都必须是一个包最后一项可以是模块或包但不能是前一项中定义的类或函数或变量 从包中导入 当用户写 会发生什么 理想情况下人们希望这会以某种方式传递给文件系统找到包中存在哪些子模块并将它们全部导入 这可能需要很长时间导入子模块可能会产生不必要的副作用这种副作用只有在显式导入子模块时才会发生 唯一的解决方案是让包作者提供一个包的显式索引 语句使用下面的规范如果一个包的 代码定义了一个名为 的列表它会被视为在遇到 时应该导入的模块名列表 在发布该包的新版本时包作者可以决定是否让此列表保持更新 包作者如果认为从他们的包中导入 的操作没有必要被使用也可以决定不支持此列表 例如文件 可以包含以下代码 这意味着 将导入 包的三个命名子模块 如果没有定义 语句 不会 从包 中导入所有子模块到当前命名空间它只确保导入了包 可能运行任何在 中的初始化代码然后导入包中定义的任何名称 这包括 定义的任何名称以及显式加载的子模块 它还包括由之前的 语句显式加载的包的任何子模块 思考下面的代码 在这个例子中 和 模块是在执行 语句时导入到当前命名空间中的因为它们定义在 包中 这在定义了 时也有效 虽然某些模块被设计为在使用 时只导出遵循某些模式的名称但在生产代码中它仍然被认为是不好的做法 请记住使用 没有任何问题实际上除非导入的模块需要使用来自不同包的同名子模块否则这是推荐的表示法 子包参考 当包被构造成子包时与示例中的 包一样你可以使用绝对导入来引用兄弟包的子模块 例如如果模块 需要在 包中使用 模块它可以使用 你还可以使用 语句的 形式编写相对导入 这些导入使用前导点来指示相对导入中涉及的当前包和父包 例如从 模块你可以使用 请注意相对导入是基于当前模块的名称进行导入的 由于主模块的名称总是 因此用作 应用程序主模块的模块必须始终使用绝对导入 多个目录中的包 包支持另一个特殊属性 它被初始化为一个列表其中包含在执行该文件中的代码之前保存包的文件 的目录的名称 这个变量可以修改这样做会影响将来对包中包含的模块和子包的搜索 虽然通常不需要此功能但它可用于扩展程序包中的模块集 脚注 实际上函数定义也是被执行的语句模块级函数定义的执行在模块的 全局符号表中输入该函数名 的非正式介绍 在下面的例子中通过提示符 与 的出现与否来区分输入和输出如果你想复现这些例子当提示符出现后你必须在提示符后键入例子中的每一个词不以提示符开头的那些行是解释器的输出 注意例子中某行中出现第二个提示符意味着你必须键入一个空白行这是用来结束多行命令的 这个手册中的许多例子都包含注释甚至交互性命令中也有 中的注释以井号 开头并且一直延伸到该文本行结束为止 注释可以出现在一行的开头或者是空白和代码的后边但是不能出现在字符串中间 字符串中的井号就是井号 因为注释是用来阐明代码的不会被 解释所以在键入这些例子时注释是可以被忽略的 几个例子 作为计算器使用 数字 字符串 列表 走向编程的第一步 当然我们可以将 用于更复杂的任务而不是仅仅两个和两个一起添加 例如我们可以编写 斐波那契数列 的初始子序列如下所示 这个例子引入了几个新的特点 第一行含有一个 多重赋值 变量 和 同时得到了新值 和 最后一行又用了一次多重赋值 这体现出了右手边的表达式在任何赋值发生 之前就被求值了 右手边的表达式是从左到右被求值的 循环只要它的条件这里指 保持为真就会一直执行 和 一样任何非零整数都为真零为假 这个条件也可以是字符串 或是列表的值事实上任何序列都可以长度非零就为真空序列就为假 在 这个例子里判断条件是一个简单的比较 标准的比较操作符的写法和 语 言里是一样 小于 大于 等于 小 于或等于 大于或等于以及 不等于 循环体 是 缩进的 缩进是 组织语句的方式 在交互式命令行 里你得给每个缩进的行敲下 键或者多个空格键 实际上用文本编 辑器的话你要准备更复杂的输入方式所有像样的文本编辑器都有自动缩进 的设置 交互式命令行里当一个组合的语句输入时 需要在最后敲一个空白 行表示完成因为语法分析器猜不出来你什么时候打的是最后一行 注意 在同一块语句中的每一行都要缩进相同的长度 函数将所有传进来的参数值打印出来 它和直接输入你要显示的表 达式比如我们之前在计算器的例子里做的不一样 能处理多个参 数包括浮点数字符串 字符串会打印不带引号的内容 并且在参数项之 间会插入一个空格 这样你就可以很好的把东西格式化 像这样 关键字参数 可以用来取消输出后面的换行 或是用另外一个字符串来 结尾 脚注 因为 比 有更高的优先级 所以 会被解释成 因此结果是 为了避免这个并且得到结果 你可以用这个式子 和其他语言不一样的是 特殊字符比如说 在单引号 和双 引号 里有一样的意义 这两种引号唯一的区别是你不需要在 单引号里转义双引号 但是你必须把单引号转义成 反之亦然 输入输出 有几种方法可以显示程序的输出数据可以以人类可读的形式打印出来或者写入文件以供将来使用 本章将讨论一些可能性 更漂亮的输出格式 格式化字符串文字 格式化字符串字面值 常简称为 字符串能让你在字符串前加上 和 并将表达式写成 来在字符串中包含 表达式的值 可选的格式说明符可以跟在表达式后面 这样可以更好地控制值的格式化方式 以下示例将 舍入到小数点后三位 在 后传递一个整数可以让该字段成为最小字符宽度 这在使列对齐时很有用 其他的修饰符可用于在格式化之前转化值 应用 应用 还有 应用 有关这些格式规范的参考请参阅参考指南 格式规格迷你语言 字符串的 方法 方法的基本用法如下所示 花括号和其中的字符称为格式字段将替换为传递给 方法的对象 花括号中的数字可用来表示传递给 方法的对象的位置 如果在 方法中使用关键字参数则使用参数的名称引用它们的值 位置和关键字参数可以任意组合 如果你有一个非常长的格式字符串你不想把它拆开那么你最好是按名称而不是按位置引用变量来进行格式化 这可以通过简单地传递字典并使用方括号 访问键来完成 这也可以通过使用 符号将 作为关键字参数传递 这在与内置函数 结合使用时非常有用它会返回包含所有局部变量的字典 例如下面几行代码生成一组整齐的列其中包含给定的整数和它的平方以及立方 关于使用 进行字符串格式化的完整概述请参阅 格式字符串语法 手动格式化字符串 旧的字符串格式化方法 运算符求余也可用于字符串格式化 给定 则 中的 实例会以零个或多个 元素替换 此操作通常被称为字符串插值 例如 可在 风格的字符串格式化 部分找到更多信息 读写文件 返回一个 最常用的有两个参数 第一个参数是包含文件名的字符串 第二个参数是另一个字符串其中包含一些描述文件使用方式的字符 可以是 表示文件只能读取 表示只能写入已存在的同名文件会被删除还有 表示打开文件以追加内容任何写入的数据会自动添加到文件的末尾 表示打开文件进行读写 参数是可选的省略时默认为 通常文件是以 打开的这意味着从文件中读取或写入字符串时都会以指定的编码方式进行编码 如果未指定编码格式默认值与平台相关 参见 在 中追加的 则以 打开文件现在数据是以字节对象的形式进行读写的 这个模式应该用于所有不包含文本的文件 在文本模式下读取时默认会把平台特定的行结束符 上的 上的 转换为 在文本模式下写入时默认会把出现的 转换回平台特定的结束符 这样在幕后修改文件数据对文本文件来说没有问题但是会破坏二进制数据例如 或 文件中的数据 请一定要注意在读写此类文件时应使用二进制模式 在处理文件对象时最好使用 关键字 优点是当子句体结束后文件会正确关闭即使在某个时刻引发了异常 而且使用 相比等效的 代码块要简短得多 如果你没有使用 关键字那么你应该调用 来关闭文件并立即释放它使用的所有系统资源 如果你没有显式地关闭文件 的垃圾回收器最终将销毁该对象并为你关闭打开的文件但这个文件可能会保持打开状态一段时间 另外一个风险是不同的 实现会在不同的时间进行清理 通过 语句或者调用 关闭文件对象后尝试使用该文件对象将自动失败 文件对象的方法 本节中剩下的例子将假定你已创建名为 的文件对象 要读取文件内容请调用 它会读取一些数据并将其作为字符串在文本模式下或字节串对象在二进制模式下返回 是一个可选的数值参数 当 被省略或者为负数时将读取并返回整个文件的内容如果文件的大小是你的机器内存的两倍就会出现问题 当取其他值时将读取并返回至多 个字符在文本模式下或 个字节在二进制模式下 如果已到达文件末尾 将返回一个空字符串 从文件中读取一行换行符 留在字符串的末尾如果文件不以换行符结尾则在文件的最后一行省略 这使得返回值明确无误如果 返回一个空的字符串则表示已经到达了文件末尾而空行使用 表示该字符串只包含一个换行符 要从文件中读取行你可以循环遍历文件对象 这是内存高效快速的并简化代码 如果你想以列表的形式读取文件中的所有行你也可以使用 或 会把 的内容写入到文件中并返回写入的字符数 在写入其他类型的对象之前需要先把它们转化为字符串在文本模式下或者字节对象在二进制模式下 返回一个整数给出文件对象在文件中的当前位置表示为二进制模式下时从文件开始的字节数以及文本模式下的意义不明的数字 要改变文件对象的位置请使用 通过向一个参考点添加 来计算位置参考点由 参数指定 的 值表示从文件开头起算 表示使用当前文件位置 表示使用文件末尾作为参考点 如果省略则默认值为 即使用文件开头作为参考点 在文本文件那些在模式字符串中没有 的打开的文件中只允许相对于文件开头搜索使用 搜索到文件末尾是个例外并且唯一有效的 值是那些能从 中返回的或者是零 其他 值都会产生未定义的行为 文件对象有一些额外的方法例如 和 它们使用频率较低有关文件对象的完整指南请参阅库参考 使用 保存结构化数据 字符串可以很轻松地写入文件并从文件中读取出来 数字可能会费点劲因为 方法只能返回字符串这些字符串必须传递给类似 的函数它会接受类似 这样的字符串并返回其数字值 当你想保存诸如嵌套列表和字典这样更复杂的数据类型时手动解析和序列化会变得复杂 允许你使用称为 的流行数据交换格式而不是让用户不断的编写和调试代码以将复杂的数据类型保存到文件中 名为 的标准模块可以采用 数据层次结构并将它们转化为字符串表示形式这个过程称为 从字符串表示中重建数据称为 在序列化和反序列化之间表示对象的字符串可能已存储在文件或数据中或通过网络连接发送到某个远程机器 注解 格式通常被现代应用程序用于允许数据交换 许多程序员已经熟悉它这 使其成为互操作性的良好选择 如果你有一个对象 你可以用一行简单的代码来查看它的 字符串表示 函数的另一个变体叫做 它只是将对象序列化为 因此如果 是一个 对象我们可以这样做 要再次解码对象如果 是一个打开的以供阅读的 对象 这种简单的序列化技术可以处理列表和字典但是在 中序列化任意类的实例需要额外的努力 模块的参考包含对此的解释 参见 封存模块 与 不同 是一种允许对任意复杂 对象进行序列化的 协议 因此它为 所特有不能用于与其他语言编写的应用程序通信 默认情况下它也是不安全的如果数据是由熟练的攻击者精心设计的则反 序列化来自不受信任来源的 数据可以执行任意代码 最高层级组件 解释器可以从多种源获得输入作为标准输入或程序参数传入的脚本以交互方式键入的语句导入的模块源文件等等 这一章将给出在这些情况下所用的语法 完整的 程序 虽然语言规范描述不必规定如何发起调用语言解释器但对完整的 程序加以说明还是很有用的 一个完整的 程序会在最小初始化环境中被执行所有内置和标准模块均为可用但均处于未初始化状态只有 各种系统服务 内置函数 异常以及 和 除外 最后一个模块用于为完整程序的执行提供局部和全局命名空间 适用于一个完整 程序的语法即下节所描述的文件输入 解释器也可以通过交互模式被发起调用在此情况下它并不读取和执行一个完整程序而是每次读取和执行一条语句可能为复合语句 此时的初始环境与一个完整程序的相同每条语句会在 的命名空间中被执行 一个完整程序可通过三种形式被传递给解释器使用 字符串 命令行选项使用一个文件作为第一个命令行参数或者使用标准输入 如果文件或标准输入是一个 设置解释器会进入交互模式否则的话它会将文件当作一个完整程序来执行 文件输入 所有从非交互式文件读取的输入都具有相同的形式 此语法用于下列几种情况 解析一个完整 程序时从文件或字符串 解析一个模块时 解析一个传递给 函数的字符串时 交互式输入 交互模式下的输入使用以下语法进行解析 请注意在交互模式下一条最高层级复合语句必须带有一个空行这对于帮助解析器确定输入的结束是必须的 表达式输入 被用于表达式输入 它会忽略开头的空白 传递给 的字符串参数必须具有以下形式 复合语句 复合语句是包含其它语句语句组的语句它们会以某种方式影响或控制所包含其它语句的执行 通常复合语句会跨越多行虽然在某些简单形式下整个复合语句也可能包含于一行之内 和 语句用来实现传统的控制流程构造 语句为一组语句指定异常处理和和清理代码而 语句允许在一个代码块周围执行初始化和终结化代码 函数和类定义在语法上也属于复合语句 一条复合语句由一个或多个 子句 组成 一个子句则包含一个句头和一个 句体 特定复合语句的子句头都处于相同的缩进层级 每个子句头以一个作为唯一标识的关键字开始并以一个冒号结束 子句体是由一个子句控制的一组语句 子句体可以是在子句头的冒号之后与其同处一行的一条或由分号分隔的多条简单语句或者也可以是在其之后缩进的一行或多行语句 只有后一种形式的子句体才能包含嵌套的复合语句以下形式是不合法的这主要是因为无法分清某个后续的 子句应该属于哪个 子句 还要注意的是在这种情形下分号的绑定比冒号更紧密因此在以下示例中所有 调用或者都不执行或者都执行 总结 请注意语句总是以 结束之后可能跟随一个 还要注意可选的后续子句总是以一个不能作为语句开头的关键字作为开头因此不会产生歧义 悬空的 问题在 中是通过要求嵌套的 语句必须缩进来解决的 为了保证清晰以下各节中语法规则采用将每个子句都放在单独行中的格式 语句 语句用于有条件的执行 它通过对表达式逐个求值直至找到一个真值请参阅 布尔运算 了解真值与假值的定义在子句体中选择唯一匹配的一个然后执行该子句体而且 语句的其他部分不会被执行或求值 如果所有表达式均为假值则如果 子句体如果存在就会被执行 语句 语句用于在表达式保持为真的情况下重复地执行 这将重复地检验表达式并且如果其值为真就执行第一个子句体如果表达式值为假这可能在第一次检验时就发生则如果 子句体存在就会被执行并终止循环 第一个子句体中的 语句在执行时将终止循环且不执行 子句体 第一个子句体中的 语句在执行时将跳过子句体中的剩余部分并返回检验表达式 语句 语句 语句可为一组语句指定异常处理器和或清理代码 子句指定一个或多个异常处理器 当 子句中没有发生异常时没有异常处理器会被执行 当 子句中发生异常时将启动对异常处理器的搜索 此搜索会依次检查 子句直至找到与该异常相匹配的子句 如果存在无表达式的 子句它必须是最后一个它将匹配任何异常 对于带有表达式的 子句该表达式会被求值如果结果对象与发生的异常兼容则该子句将匹配该异常 一个对象如果是异常对象所属的类或基类或者是包含有兼容该异常的项的元组则两者就是兼容的 如果没有 子句与异常相匹配则会在周边代码和发起调用栈上继续搜索异常处理器 如果在对 子句头中的表达式求值时引发了异常则原来对处理器的搜索会被取消并在周边代码和调用栈上启动对新异常的搜索它会被视作是整个 语句所引发的异常 当找到一个匹配的 子句时该异常将被赋值给该 子句在 关键字之后指定的目标如果存在此关键字的话并且该 子句体将被执行 所有 子句都必须有可执行的子句体 当到达子句体的末尾时通常会转向整个 语句之后继续执行 这意味着如果对于同一异常存在有嵌套的两个处理器而异常发生于内层处理器的 子句中则外层处理器将不会处理该异常 当使用 将目标赋值为一个异常时它将在 子句结束时被清除 这就相当于 被转写为 这意味着异常必须赋值给一个不同的名称才能在 子句之后引用它 异常会被清除是因为在附加了回溯信息的情况下它们会形成堆栈帧的循环引用使得所有局部变量保持存活直到发生下一次垃圾回收 在一个 子句体被执行之前有关异常的详细信息存放在 模块中可通过 来访问 返回一个 元组由异常类 异常实例和回溯对象组成参见 标准类型层级结构 一节用于在程序中标识异常发生点 当从处理异常的函数返回时 的值会恢复为调用前的原值 如果控制流离开 子句体时没有引发异常并且没有执行 或 语句可选的 子句将被执行 语句中的异常不会由之前的 子句处理 如果存在 它将指定一个 清理 处理程序 子句会被执行包括任何 和 子句 如果在这些子句中发生任何未处理的异常该异常会被临时保存 子句将被执行 如果存在被保存的异常它会在 子句的末尾被重新引发 如果 子句引发了另一个异常被保存的异常会被设为新异常的上下文 如果 子句执行了 或 语句则被保存的异常会被丢弃 在 子句执行期间程序不能获取异常信息 当 或 语句在一个 语句的 子语句体中被执行时 子语句也会 在离开时 被执行 函数的返回值是由最后被执行的 语句所决定的 由于 子句总是被执行因此在 子句中被执行的 语句总是最后被执行的 有关异常的更多信息可以在 异常 一节找到有关使用 语句生成异常的信息可以在 语句 一节找到 在 版更改 在 之前 语句不允许在 子句中使用这是因为具体实现存在一个问题 语句 语句用于包装带有使用上下文管理器 参见 语句上下文管理器 一节 定义的方法的代码块的执行 这允许对普通的 使用模式进行封装以方便地重用 带有一个项目的 语句的执行过程如下 对上下文表达式 在 中给出的表达式 求值以获得一个上下文 管理器 载入上下文管理器的 以便后续使用 载入上下文管理器的 以便后续使用 发起调用上下文管理器的 方法 如果 语句中包含一个目标来自 的返回值将被赋值 给它 注解 语句会保证如果 方法返回时未发生错误则 将总是被调用 因此如果在对目标列表赋值期间发生错 误则会将其视为在语句体内部发生的错误 参见下面的第 步 执行语句体 发起调用上下文管理器的 方法 如果语句体的退出是由异常 导致的则其类型 值和回溯信息将被作为参数传递给 否 则的话将提供三个 参数 如果语句体的退出是由异常导致的并且来自 方法的返回值 为假则该异常会被重新引发 如果返回值为真则该异常会被抑制并会 继续执行 语句之后的语句 如果语句体由于异常以外的任何原因退出则来自 的返回值 会被忽略并会在该类退出正常的发生位置继续执行 以下代码 在语义上等价于 如果有多个项目则会视作存在多个 语句嵌套来处理多个上下文管理器 在语义上等价于 在 版更改 支持多个上下文表达式 参见 语句 语句的规范描述 背景和示例 函数定义 类定义 类定义就是对类对象的定义 参见 标准类型层级结构 一节 类定义是一条可执行语句 其中继承列表通常给出基类的列表 进阶用法请参见 元类列表中的每一项都应当被求值为一个允许子类的类对象 没有继承列表的类默认继承自基类 因此 等价于 随后类体将在一个新的执行帧 参见 命名与绑定 中被执行使用新创建的局部命名空间和原有的全局命名空间 通常类体主要包含函数定义 当类体结束执行时其执行帧将被丢弃而其局部命名空间会被保存 一个类对象随后会被创建其基类使用给定的继承列表属性字典使用保存的局部命名空间 类名称将在原有的全局命名空间中绑定到该类对象 在类体内定义的属性的顺序保存在新类的 中 请注意此顺序的可靠性只限于类刚被创建时并且只适用于使用定义语法所定义的类 类的创建可使用 元类 进行重度定制 类也可以被装饰就像装饰函数一样 大致等价于 装饰器表达式的求值规则与函数装饰器相同 结果随后会被绑定到类名称 在 版更改 类可使用任何有效的 来装饰 在之前版本中此语法则更为受限详情参见 程序员注意事项 在类定义内定义的变量是类属性它们将被类实例所共享 实例属性可通过 在方法中设定 类和实例属性均可通过 表示法来访问当通过此方式访问时实例属性会隐藏同名的类属性 类属性可被用作实例属性的默认值但在此场景下使用可变值可能导致未预期的结果 可以使用 描述器 来创建具有不同实现细节的实例变量 参见 中的元类 将元类声明修改为当前语法的提议以及关于如何构建带有元类的类的语 义描述 类装饰器 增加类装饰器的提议 函数和方法装饰器是在 中被引入的 协程 新版功能 协程函数定义 协程可以在多个位置上挂起和恢复执行 参见 在协程函数体内部 和 标识符已成为保留关键字 表达式 以及 只能在协程函数体中使用 使用 语法定义的函数总是为协程函数即使它们不包含 或 关键字 在协程函数体中使用 表达式将引发 协程函数的例子 语句 能够在其 实现中调用异步代码而 可以在其 方法中调用异步代码 语句允许方便地对异步迭代器进行迭代 以下代码 在语义上等价于 另请参阅 和 了解详情 在协程函数体之外使用 语句将引发 语句 是一种 能够在其 和 方法中暂停执行 以下代码 在语义上等价于 另请参阅 和 了解详情 在协程函数体之外使用 语句将引发 参见 使用 和 语法实现协程 将协程作为 中的一个正式的单独概念并增加相应的支持语法 脚注 异常会被传播给发起调用栈除非存在一个 子句正好引发了另 一个异常 新引发的异常将导致旧异常的丢失 作为函数体的第一条语句出现的字符串字面值会被转换为函数的 属性也就是该函数的 作为类体的第一条语句出现的字符串字面值会被转换为命名空间的 条目也就是该类的 词法分析 行结构 一个 程序可分为许多 逻辑行 逻辑行 物理行 物理行是以一个行终止序列结束的字符序列 在源文件和字符串中可以使用任何标准平台上的行终止序列 所用的 字符 换行 所用的 字符序列 回车加换行 或者旧 所用的 字符 回车 所有这些形式均可使用无论具体平台 输入的结束也会被作为最后一个物理行的隐含终止标志 当嵌入 时源码字符串传入 应使用标准 的传统换行符即 表示 字符 作为行终止标志 注释 一条注释以不包含在字符串字面值内的井号 开头并在物理行的末尾结束 一条注释标志着逻辑行的结束除非存在隐含的行拼接规则 注释在语法分析中会被忽略 编码声明 如果一条注释位于 脚本的第一或第二行并且匹配正则表达式 这条注释会被作为编码声明来处理上述表达式的第一组指定了源码文件的编码 编码声明必须独占一行 如果它是在第二行则第一行也必须是注释 推荐的编码声明形式如下 这也是 认可的形式以及 这是 的 认可的形式 如果没有编码声明则默认编码为 此外如果文件的首字节为 字节顺序标志 文件编码也声明为 这是 的 等软件支持的形式 编码声明指定的编码名称必须是 所认可的编码 所有词法分析将使用此编码包括语义字符串 注释和标识符 显式的行拼接 隐式的行拼接 圆括号 方括号或花括号以内的表达式允许分成多个物理行无需使用反斜杠 例如 隐式的行拼接可以带有注释 后续行的缩进不影响程序结构 后续行也允许为空白行 隐式拼接的行之间不会有 形符 隐式拼接的行也可以出现于三引号字符串中 见下此情况下这些行不允许带有注释 空白行 缩进 一个逻辑行开头处的空白 空格符和制表符 被用来计算该行的缩进等级以决定语句段落的组织结构 制表符会被 从左至右 替换为一至八个空格这样缩进的空格总数为八的倍数这是为了与 所用的规则一致 首个非空白字符之前的空格总数将确定该行的缩进层次 一个缩进不可使用反斜杠进行多行拼接首个反斜杠之前的空格将确定缩进层次 在一个源文件中如果混合使用制表符和空格符缩进并使得确定缩进层次需要依赖于制表符对应的空格数量设置则被视为不合规则此情况将会引发 跨平台兼容性注释 由于非 平台上文本编辑器本身的特性在一个源文件中混合使用制表符和空格符是不明智的 另外也要注意不同平台还可能会显式地限制最大缩进层级 行首有时可能会有一个进纸符它在上述缩进层级计算中会被忽略 处于行首空格内其他位置的进纸符的效果未定义 例如它可能导致空格计数重置为零 多个连续行各自的缩进层级将会被放入一个堆栈用来生成 和 形符具体说明如下 在读取文件的第一行之前先向堆栈推入一个零值它将不再被弹出 被推入栈的层级数值从底至顶持续增加 每个逻辑行开头的行缩进层级将与栈顶行比较 如果相同则不做处理 如果新行层级较高则会被推入栈顶并生成一个 形符 如果新行层级较低则 应当 是栈中的层级数值之一栈中高于该层级的所有数值都将被弹出每弹出一级数值生成一个 形符 在文件末尾栈中剩余的每个大于零的数值生成一个 形符 这是一个正确 但令人迷惑 的 代码缩进示例 以下示例显示了各种缩进错误 实际上前三个错误会被解析器发现只有最后一个错误是由词法分析器发现的 的缩进无法匹配弹出栈的缩进层级 形符之间的空白 其他形符 除了 和 还存在以下类别的形符 标识符 关键字 字面值 运算符 以及 分隔符 空白字符 之前讨论过的行终止符除外 不属于形符而是用来分隔形符 如果存在二义性将从左至右读取尽可能长的合法字符串组成一个形符 标识符和关键字 标识符 或者叫做 名称 由以下词法定义进行描述 中的标识符语法是基于 标准附件 并加入了下文所定义的细化与修改更多细节还可参见 在 范围内 可用于标识符的字符与 一致 大写和小写字母 至 下划线 以及数字 至 但不可以数字打头 引入了 范围以外的额外字符 见 这些字符的分类使用包含于 模块中的 字符数据库版本 标识符的长度没有限制 对大小写敏感 上文所用 类别码的含义 大写字母 小写字母 词首大写字母 修饰字母 其他字母 字母数字 非空白标识 含空白标识 十进制数字 连接标点 由 定义的显式字符列表用于支持向后 兼容 同上所有标识符在解析时会被转换为规范形式 标识符的比较都是基于 中所有可用的标识符字符列表可参见以下非正式 文件 关键字 保留的标识符类 某些标识符类 除了关键字 具有特殊的含义 这些标识符类的命名模式是以下划线字符打头和结尾 不会被 导入 特殊标识符 在交互式解释器中 被用来存放最近一次求值结果它保存在 模块中 当不处于交 互模式时 无特殊含义也没有预定义 参见 语句 注解 作为名称常用于连接国际化文本请参看 模块文档了解有 关此约定的详情 系统定义的名称在非正式场合下被叫做 名称 这些名称是由解 释器及其实现包括标准库定义的 现有系统定义名称相关的讨论请参见 特殊方法名称 等章节 未来的 版本中还将定义更多此类名称 任 何情况下 任何 不遵循文档所显式指明的 名称使用方式都可能导 致无警告的错误 类的私有名称 这种名称在类定义中使用时会以一种混合形式重写以避免 在基类及派生类的 私有 属性之间出现名称冲突 参见 标识符名称 字面值 字面值用于表示一些内置类型的常量 字符串和字节串字面值 字符串字面值拼接 多个相邻的字符串或字节串字面值 以空白符分隔所用的引号可以彼此不同其含义等同于全部拼接为一体 因此 等同于 此特性可以减少反斜杠的使用以方便地将很长的字符串分成多个物理行甚至每部分字符串还可分别加注释例如 注意此特性是在句法层面定义的但是在编译时实现 在运行时拼接字符串表达式必须使用 运算符 还要注意字面值拼接时每个部分可以使用不同的引号风格 甚至混合使用原始字符串和三引号字符串格式化字符串字面值也可与普通字符串字面值拼接 格式化字符串字面值 数字字面值 数字字面值有三种类型 整型数 浮点数和虚数 没有专门的复数字面值 复数可由一个实数加一个虚数合成 注意数字字面值并不包含正负号 这样的负数实际上是由单目运算符 和字面值 合成的 整型数字面值 整型数字面值由以下词法定义进行描述 整型数字面值的长度没有限制能一直大到占满可用内存 在确定数字大小时字面值中的下划线会被忽略 它们可用来将数码分组以提高可读性 一个下划线可放在数码之间也可放在基数说明符例如 之后 注意非零的十进制数开头不允许有额外的零 这是为了避免与 在版本 之前所使用的 风格八进制字面值相混淆 一些整型数字面值的示例如下 在 版更改 允许在字面值中使用下划线进行分组 浮点数字面值 浮点数字面值由以下词法定义进行描述 注意整型数部分和指数部分在解析时总是以 为基数 例如 是合法的且表示的数值与 相同 浮点数字面值允许的范围依赖于具体实现 对于整型数字面值支持以下划线进行分组 一些浮点数字面值的示例如下 在 版更改 允许在字面值中使用下划线进行分组 虚数字面值 运算符 以下形符属于运算符 分隔符 以下形符在语法中归类为分隔符 句点也可出现于浮点数和虚数字面值中 连续三个句点有表示一个省略符的特殊含义 以上列表的后半部分为增强赋值操作符在词法中作为分隔符但也起到运算作用 以下可打印 字符作为其他形符的组成部分时具有特殊含义或是对词法分析器有重要意义 以下可打印 字符不在 词法中使用 如果出现于字符串字面值和注释之外将无条件地引发错误 脚注 语言参考 本参考手册描述了 的语法和核心语义 本参考是简洁的但试图做到准确和完整 非必要的内建对象类型和内建函数 模块的语义描述在 标准库 中 有关该语言的非正式介绍请参阅 教程 对 或 程序员还有两个额外的手册 扩展和嵌入 解释器 概述了如何编写一个 扩展模块 参考手册 详细介绍了 中可用的接口 概述 其他实现 标注 词法分析 行结构 其他形符 标识符和关键字 字面值 运算符 分隔符 数据模型 对象 值与类型 标准类型层级结构 特殊方法名称 协程 执行模型 程序的结构 命名与绑定 异常 导入系统 包 搜索 加载 基于路径的查找器 替换标准导入系统 包相对导入 有关 的特殊事项 开放问题项 参考文献 表达式 算术转换 原子 原型 表达式 幂运算符 一元算术和位运算 二元算术运算符 移位运算 二元位运算 比较运算 布尔运算 赋值表达式 条件表达式 表达式 表达式列表 求值顺序 运算符优先级 简单语句 表达式语句 赋值语句 语句 语句 语句 语句 语句 语句 语句 语句 语句 语句 语句 复合语句 语句 语句 语句 语句 语句 函数定义 类定义 协程 最高层级组件 完整的 程序 文件输入 交互式输入 表达式输入 完整的语法规范 数据模型 对象 值与类型 标准类型层级结构 特殊方法名称 一个类可以通过定义具有特殊名称的方法来实现由特殊语法所引发的特定操作 例如算术运算或下标与切片 这是 实现 操作符重载 的方式允许每个类自行定义基于操作符的特定行为 例如如果一个类定义了名为 的方法并且 为该类的一个实例则 基本就等同于 除非有说明例外情况在没有定义适当方法的情况下尝试执行一种操作将引发一个异常 通常为 或 将一个特殊方法设为 表示对应的操作不可用 例如如果一个类将 设为 则该类就是不可迭代的因此对其实例调用 将引发一个 而不会回退至 在实现模拟任何内置类型的类时很重要的一点是模拟的实现程度对于被模拟对象来说应当是有意义的 例如提取单个元素的操作对于某些序列来说是适宜的但提取切片可能就没有意义 这种情况的一个实例是 的文档对象模型中的 接口 基本定制 自定义属性访问 自定义类创建 自定义实例及子类检查 以下方法被用来重载 和 内置函数的默认行为 特别地元类 实现了这些方法以便允许将抽象基类 作为虚拟基类添加到任何类或类型包括内置类型包括其他 之中 如果 应被视为 的一个直接或间接实例则返回真值 如果定义了此方法则会被调用以实现 如果 应被视为 的一个直接或间接子 类则返回真值 如果定义了此方法则会被调用以实现 请注意这些方法的查找是基于类的类型元类 它们不能作为类方法在实际的类中被定义 这与基于实例被调用的特殊方法的查找是一致的只有在此情况下实例本身被当作是类 参见 引入抽象基类 新增功能描述通过 和 来定制 和 行为加入此功能的动机是 出于向该语言添加抽象基类的内容参见 模块 模拟泛型类型 通过定义一个特殊方法可以实现由 所规定的泛型类语法 例如 按照 参数指定的类型返回一个表示泛型类的专门化对象 此方法的查找会基于对象自身并且当定义于类体内部时此方法将隐式地成为类方法 请注意此机制主要是被保留用于静态类型提示不鼓励在其他场合使用 参见 对 模块和泛型类型的核心支持 模拟可调用对象 此方法会在实例作为一个函数被调用时被调用如果定义了此方法则 就大致可以被改写为 模拟容器类型 可以定义下列方法来实现容器对象 容器通常属于序列如列表或元组或映射如字典但也存在其他形式的容器 前几个方法集被用于模拟序列或是模拟映射两者的不同之处在于序列允许的键应为整数 且 其中 是序列或定义指定区间的项的切片对象的长度 此外还建议让映射提供 以及 等方法它们的行为应与 标准字典对象的相应方法类似 此外 模块提供了一个 抽象基类以便根据由 和 组成的基本集来创建所需的方法 可变序列还应像 标准列表对象那样提供 和 等方法 最后序列类型还应通过定义下文描述的 和 等方法来实现加法指拼接和乘法指重复它们不应定义其他数值运算符 此外还建议映射和序列都实现 方法以允许高效地使用 运算符对于映射 应该搜索映射的键对于序列则应搜索其中的值 另外还建议映射和序列都实现 方法以允许高效地迭代容器中的条目对于映射 应当迭代对象的键对于序列则应当迭代其中的值 调用此方法以实现内置函数 应该返回对象的长度以一个 的整数表示 此外如果一个对象未定义 方法而其 方法返回值为零则在布尔运算中会被视为假值 在 中要求长度最大为 如果长度大于 则某些特性 例如 可能会引发 要通过真值检测来防止引发 对象必须定义 方法 调用此方法以实现 应该返回对象长度的估计 值可能大于或小于实际长度 此长度应为一个 的整数 返回 值也可以为 这会被视作与 方法完 全不存在时一样处理 此方法纯粹是为了优化性能并不要求正确无误 新版功能 注解 切片是通过下述三个专门方法完成的 以下形式的调用 会为转写为 其他形式以此类推 略去的切片项总是以 补全 调用此方法以实现 的求值 对于序列类型接受的键应为整数 和切片对象 请注意负数索引如果类想要模拟序列类型的特殊解读是取 决于 方法 如果 的类型不正确则会引发 异常如果为序列索引集范围以外的值在进行任何负数索引 的特殊解读之后则应引发 异常 对于映射类型如果 找不到不在容器中则应引发 异常 注解 循环在有不合法索引时会期待捕获 以便正确地检测 到序列的结束 调用此方法以实现向 赋值 注意事项与 相 同 为对象实现此方法应该仅限于需要映射允许基于键修改值或添加键或 是序列允许元素被替换时 不正确的 值所引发的异常应与 方法的情况相同 调用此方法以实现 的删除 注意事项与 相 同 为对象实现此方法应该权限于需要映射允许移除键或是序列允许移除 元素时 不正确的 值所引发的异常应与 方法的情 况相同 此方法由 在找不到字典中的键时调用以实现 子类的 此方法在需要为容器创建迭代器时被调用 此方法应该返回一个新的迭代器 对象它能够逐个迭代容器中的所有对象 对于映射它应该逐个迭代容器 中的键 迭代器对象也需要实现此方法它们需要返回对象自身 有关迭代器对象的 详情请参看 迭代器类型 一节 此方法如果存在会被 内置函数调用以实现逆向迭代 它 应当返回一个新的以逆序逐个迭代容器内所有对象的迭代器对象 如果未提供 方法则 内置函数将回退到 使用序列协议 和 支持序列协议的对象应 当仅在能够提供比 所提供的实现更高效的实现时才提供 方法 成员检测运算符 和 通常以对容器进行逐个迭代的方式来实现 不过容器对象可以提供以下特殊方法并采用更有效率的实现这样也不要求对象必须为可迭代对象 调用此方法以实现成员检测运算符 如果 是 的成员则应返 回真否则返回假 对于映射类型此检测应基于映射的键而不是值或者键 值对 对于未定义 的对象成员检测将首先尝试通过 进行迭代然后再使用 的旧式序列迭代协 议参看 语言参考中的相应部分 模拟数字类型 语句上下文管理器 特殊方法查找 协程 可等待对象 对象主要实现了 方法 从 函数返回的 协程对象 即属于可等待对象 注解 从带有 或 装饰器的生成器返 回的 对象也属于可等待对象但它们并未实现 必须返回一个 应当被用来实现 对象 例如 实现了此方法以与 表达式相兼容 新版功能 参见 了解有关可等待对象的详细信息 协程对象 协程对象 属于 对象 协程的执行可通过调用 并迭代其结果来控制 当协程结束执行并返回时迭代器会引发 该异常的 属性将存放返回值 如果协程引发了异常它会被迭代器所传播 协程不应直接引发未处理的 异常 协程也具有下面列出的方法它们类似于生成器的对应方法 参见 生成器迭代器的方法 但是与生成器不同协程并不直接支持迭代 在 版更改 等待一个协程超过一次将引发 开始或恢复协程的执行 如果 为 则这相当于前往 所返回迭代器的下一项 如果 不为 此方 法将委托给导致协程挂起的迭代器的 方法 其结果返回值 或是其他异常将与上述对 返回值进行迭 代的结果相同 在协程内引发指定的异常 此方法将委托给导致协程挂起的迭代器的 方法如果存在该方法 否则的话异常会在挂起点被引发 其结果返回值 或是其他异常将与上述对 返回值进行迭代的结果相同 如果异常未在协程内被捕获 则将回传给调用者 此方法会使得协程清理自身并退出 如果协程被挂起此方法会先委托给导 致协程挂起的迭代器的 方法如果存在该方法 然后它会在挂 起点引发 使得协程立即清理自身 最后协程会被标记 为已结束执行即使它根本未被启动 当协程对象将要被销毁时会使用以上处理过程来自动关闭 异步迭代器 异步迭代器 可以在其 方法中调用异步代码 异步迭代器可在 语句中使用 必须返回一个 异步迭代器 对象 必须返回一个 可迭代对象 输出迭代器的下一结果值 当迭代结束时应该 引发 错误 异步可迭代对象的一个示例 新版功能 在 版更改 在 之前 可以返回一个 可迭代对象 并解析为 异步迭代器 从 开始 必须 返回一个异步迭代器对象 返回任何其他对象都将导致 错误 异步上下文管理器 异步上下文管理器 是 上下文管理器 的一种它能够在其 和 方法中暂停执行 异步上下文管理器可在 语句中使用 在语义上类似于 仅有的区别是它必须返回一个 可等待对 象 在语义上类似于 仅有的区别是它必须返回一个 可等待对象 异步上下文管理器类的一个示例 新版功能 脚注 在某些情况下 有可能 基于可控的条件改变一个对象的类型 但这通常 不是个好主意因为如果处理不当会导致一些非常怪异的行为 以及 方法对此有特殊处理其他方法仍会引发 但可能依靠 属于不可调用对象的行为来做到这一点 这里的不支持是指该类无此方法或方法返回 如果 你想强制回退到右操作数的反射方法请不要设置方法为 那会造 成显式地 阻塞 此种回退的相反效果 对于相同类型的操作数如果非反射方法 例如 失败则 会认为整个运算都不被支持这就是反射方法未被调用的原因 执行模型 程序的结构 程序是由代码块构成的 代码块 是被作为一个单元来执行的一段 程序文本 以下几个都属于代码块模块 函数体和类定义 交互式输入的每条命令都是代码块 一个脚本文件作为标准输入发送给解释器或是作为命令行参数发送给解释器的文件也是代码块 一条脚本命令通过 选项在解释器命令行中指定的命令也是代码块 通过在命令行中使用 参数作为最高层级脚本即 模块运行的模块也是代码块 传递给内置函数 和 的字符串参数也是代码块 代码块在 执行帧 中被执行 一个帧会包含某些管理信息用于调试并决定代码块执行完成后应前往何处以及如何继续执行 命名与绑定 名称的绑定 名称 用于指代对象 名称是通过名称绑定操作来引入的 以下构造会绑定名称传给函数的正式形参 语句类与函数定义这会在定义的代码块中绑定类或函数名称以及发生以标识符为目标的赋值 循环的开头或 语句和 子句的 之后 语句的 形式会绑定在被导入模块中定义的所有名称那些以下划线开头的除外 这种形式仅在模块层级上被使用 语句的目标也被视作一种绑定虽然其实际语义为解除名称绑定 每条赋值或导入语句均发生于类或函数内部定义的代码块中或是发生于模块层级即最高层级的代码块 如果名称绑定在一个代码块中则为该代码块的局部变量除非声明为 或 如果名称绑定在模块层级则为全局变量 模块代码块的变量既为局部变量又为全局变量 如果变量在一个代码块中被使用但不是在其中定义则为 自由变量 每个在程序文本中出现的名称是指由以下名称解析规则所建立的对该名称的 绑定 名称的解析 内置命名空间和受限的执行 用户不应该接触 严格说来它属于实现细节 用户如果要重载内置命名空间中的值则应该 并相应地修改该模块中的属性 与一个代码块的执行相关联的内置命名空间实际上是通过在其全局命名空间中搜索名称 来找到的这应该是一个字典或一个模块在后一种情况下会使用该模块的字典 默认情况下当在 模块中时 就是内置模块 当在任何其他模块中时 则是 模块自身的字典的一个别名 与动态特性的交互 自由变量的名称解析发生于运行时而不是编译时 这意味着以下代码将打印出 和 函数没有对完整环境的访问权限来解析名称 名称可以在调用者的局部和全局命名空间中被解析 自由变量的解析不是在最近包含命名空间中而是在全局命名空间中 和 函数有可选参数用来重载全局和局部命名空间 如果只指定一个命名空间则它会同时作用于两者 异常 异常是中断代码块的正常控制流程以便处理错误或其他异常条件的一种方式 异常会在错误被检测到的位置 引发它可以被当前包围代码块或是任何直接或间接发起调用发生错误的代码块的其他代码块所 处理 解析器会在检测到运行时错误例如零作为被除数的时候引发异常 程序也可以通过 语句显式地引发异常 异常处理是通过 语句来指定的 该语句的 子句可被用来指定清理代码它并不处理异常而是无论之前的代码是否发生异常都会被执行 的错误处理采用的是终止模型异常处理器可以找出发生了什么问题并在外层继续执行但它不能修复错误的根源并重试失败的操作除非通过从顶层重新进入出错的代码片段 当一个异常完全未被处理时解释器会终止程序的执行或者返回交互模式的主循环 无论是哪种情况它都会打印栈回溯信息除非是当异常为 的时候 异常是通过类实例来标识的 子句会依据实例的类来选择它必须引用实例的类或是其所属的基类 实例可通过处理器被接收并可携带有关异常条件的附加信息 注解 异常消息不是 的组成部分 其内容可能在 升级到新版 本时不经警告地发生改变不应该被需要在多版本解释器中运行的代码所依赖 另请参看 语句 小节中对 语句的描述以及 语句 小节中对 语句的描述 脚注 出现这样的限制是由于通过这些操作执行的代码在模块被编译的时候并不可 用 完整的语法规范 导入系统 一个 内的 代码通过 操作就能够访问另一个模块内的代码 语句是发起调用导入机制的最常用方式但不是唯一的方式 以及内置的 等函数也可以被用来发起调用导入机制 语句结合了两个操作它先搜索指定名称的模块然后将搜索结果绑定到当前作用域中的名称 语句的搜索操作定义为对 函数的调用并带有适当的参数 的返回值会被用于执行 语句的名称绑定操作 请参阅 语句了解名称绑定操作的更多细节 对 的直接调用将仅执行模块搜索以及在找到时的模块创建操作 不过也可能产生某些副作用例如导入父包和更新各种缓存 包括 只有 语句会执行名称绑定操作 当 语句被执行时标准的内置 函数会被调用 其他发起调用导入系统的机制 例如 可能会选择绕过 并使用它们自己的解决方案来实现导入机制 当一个模块首次被导入时 会搜索该模块如果找到就创建一个 对象 并初始化它 如果指定名称的模块未找到则会引发 当发起调用导入机制时 会实现多种策略来搜索指定名称的模块 这些策略可以通过使用使用下文所描述的多种钩子来加以修改和扩展 在 版更改 导入系统已被更新以完全实现 中的第二阶段要求 不会再有任何隐式的导入机制 整个导入系统都通过 暴露出来 此外对原生命名空间包的支持也已被实现 参见 模块提供了一个丰富的 用来与导入系统进行交互 例如 提供了相比内置的 更推荐 更简单的 用来发起调用导入机制 更多细节请参看 库文档 包 只有一种模块对象类型所有模块都属于该类型无论模块是用 还是别的语言实现 为了帮助组织模块并提供名称层次结构 还引入了 包 的概念 你可以把包看成是文件系统中的目录并把模块看成是目录中的文件但请不要对这个类似做过于字面的理解因为包和模块不是必须来自于文件系统 为了方便理解本文档我们将继续使用这种目录和文件的类比 与文件系统一样包通过层次结构进行组织在包之内除了一般的模块还可以有子包 要注意的一个重点概念是所有包都是模块但并非所有模块都是包 或者换句话说包只是一种特殊的模块 特别地任何具有 属性的模块都会被当作是包 所有模块都有自己的名字 子包名与其父包名以点号分隔与 的标准属性访问语法致 例如你可能看到一个名为 的模块以及一个名为 的包这个包中又有一个名为 的子包和该子包中的名为 的子包 常规包 定义了两种类型的包常规包 和 命名空间包 常规包是传统的包类型它们在 及之前就已存在 常规包通常以一个包含 文件的目录形式实现 当一个常规包被导入时这个 文件会隐式地被执行它所定义的对象会被绑定到该包命名空间中的名称 文件可以包含与任何其他模块中所包含的 代码相似的代码 将在模块被导入时为其添加额外的属性 例如以下文件系统布局定义了一个最高层级的 包和三个子包 导入 将隐式地执行 和 后续导入 或 则将分别执行 和 命名空间包 命名空间包是由多个 部分 构成的每个部分为父包增加一个子包 各个部分可能处于文件系统的不同位置 部分也可能处于 文件中 网络上或者 在导入期间可以搜索的其他地方 命名空间包并不一定会直接对应到文件系统中的对象它们有可能是无实体表示的虚拟模块 命名空间包的 属性不使用普通的列表 而是使用定制的可迭代类型如果其父包的路径 或者最高层级包的 发生改变这种对象会在该包内的下一次导入尝试时自动执行新的对包部分的搜索 命名空间包没有 文件 实际上在导入搜索期间可能找到多个 目录每个都由不同的部分所提供 因此 的物理位置不一定与 相邻 在这种情况下 将为顶级的 包创建一个命名空间包无论是它本身还是它的某个子包被导入 另请参阅 了解对命名空间包的规格描述 搜索 模块缓存 在导入搜索期间首先会被检查的地方是 这个映射起到缓存之前导入的所有模块的作用包括其中间路径 因此如果之前导入过 则 将包含 和 条目 每个键的值就是相应的模块对象 在导入期间会在 查找模块名称如存在则其关联的值就是需要导入的模块导入过程完成 然而如果值为 则会引发 如果找不到指定模块名称 将继续搜索该模块 是可写的 删除键可能不会破坏关联的模块因为其他模块可能会保留对它的引用但它会使命名模块的缓存条目无效导致 在下次导入时重新搜索命名模块 键也可以赋值为 强制下一次导入模块导致 但是要小心因为如果你还保有对某个模块对象的引用同时停用其在 中的缓存条目然后又再次导入该名称的模块则前后两个模块对象将 不是 同一个 相反地 将重用 同一个 模块对象并简单地通过重新运行模块的代码来重新初始化模块内容 查找器和加载器 如果指定名称的模块在 找不到则将发起调用 的导入协议以查找和加载该模块 此协议由两个概念性模块构成即 查找器 和 加载器 查找器的任务是确定是否能使用其所知的策略找到该名称的模块 同时实现这两种接口的对象称为 导入器 它们在确定能加载所需的模块时会返回其自身 包含了多个默认查找器和导入器 第一个知道如何定位内置模块第二个知道如何定位冻结模块 第三个默认查找器会在 中搜索模块 是一个由文件系统路径或 文件组成的位置列表 它还可以扩展为搜索任意可定位资源例如由 指定的资源 导入机制是可扩展的因此可以加入新的查找器以扩展模块搜索的范围和作用域 查找器并不真正加载模块 如果它们能找到指定名称的模块会返回一个 模块规格说明这是对模块导入相关信息的封装供后续导入机制用于在加载模块时使用 以下各节描述了有关查找器和加载器协议的更多细节包括你应该如何创建并注册新的此类对象来扩展导入机制 在 版更改 在之前的 版本中查找器会直接返回 加载器现在它们则返回模块规格说明其中 包含 加载器 加载器仍然在导入期间被使用但负担的任务有所减少 导入钩子 导入机制被设计为可扩展其中的基本机制是 导入钩子 导入钩子有两种类型 元钩子 和 导入路径钩子 元钩子在导入过程开始时被调用此时任何其他导入过程尚未发生但 缓存查找除外 这允许元钩子重载 过程 冻结模块甚至内置模块 元钩子的注册是通过向 添加新的查找器对象具体如下所述 导入路径钩子是作为 或 过程的一部分在遇到它们所关联的路径项的时候被调用 导入路径钩子的注册是通过向 添加新的可调用对象具体如下所述 元路径 加载 当一个模块说明被找到时导入机制将在加载该模块时使用它及其所包含的加载器 下面是导入的加载部分所发生过程的简要说明 请注意以下细节 如果在 中存在指定名称的模块对象导入操作会已经将其 返回 在加载器执行模块代码之前该模块将存在于 中 这一 点很关键因为该模块代码可能直接或间接地导入其自身预先将其 添加到 可防止在最坏情况下的无限递归和最好情况下的多 次加载 如果加载失败则该模块 只限加载失败的模块 将从 中移除 任何已存在于 缓存的模块以 及任何作为附带影响被成功加载的模块仍会保留在缓存中 这与重新加载 不同后者会把即使加载失败的模块也保留在 中 在模块创建完成但还未执行之前导入机制会设置导入相关模块属性在 上面的示例伪代码中为 详情参见 后续部分 模块执行是加载的关键时刻在此期间将填充模块的命名空间 执行会完 全委托给加载器由加载器决定要填充的内容和方式 在加载过程中创建并传递给 的模块并不一定就是在导入结 束时返回的模块 在 版更改 导入系统已经接管了加载器建立样板的责任 这些在以前是由 方法来执行的 加载器 模块加载器提供关键的加载功能模块执行 导入机制调用 方法并传入一个参数来执行模块对象 从 返回的任何值都将被忽略 加载器必须满足下列要求 如果模块是一个 模块而非内置模块或动态加载的扩展加载 器应该在模块的全局命名空间 中执行模块的代码 如果加载器无法执行指定模块它应该引发 不过在 期间引发的任何其他异常也会被传播 在许多情况下查找器和加载器可以是同一对象在此情况下 方法将返回一个规格说明其中加载器会被设为 模块加载器可以选择通过实现 方法在加载期间创建模块对象 它接受一个参数即模块规格说明并返回新的模块对象供加载期间使用 不需要在模块对象上设置任何属性 如果模块返回 导入机制将自行创建新模块 新版功能 加载器的 方法 在 版更改 方法被 所替代导入机制会对加载的所有样板责任作出假定 为了与现有的加载器兼容导入机制会使用导入器的 方法如果它存在且导入器也未实现 但是 现已弃用加载器应该转而实现 除了执行模块之外 方法必须实现上文描述的所有样板加载功能 所有相同的限制仍然适用并带有一些附加规定 如果 中存在指定名称的模块对象加载器必须使用已存在 的模块 否则 将无法正确工作 如果该名 称模块不存在于 中加载器必须创建一个新的模块对象并 将其加入 在加载器执行模块代码之前模块 必须 存在于 之中 以防止无限递归或多次加载 如果加载失败加载器必须移除任何它已加入到 中的模块 但它必须 仅限 移除加载失败的模块且所移除的模块应为加载器 自身显式加载的 在 版更改 当 已定义但 未定义时将引发 在 版更改 当 已定义但 未定义时将引发 子模块 模块规格说明 导入相关的模块属性 模块的 默认情况下全部模块都具有一个可用的 但是你可以依据上述的属性设置在模块的规格说明中更为显式地控制模块对象的 如果模块具有 导入机制将尝试用它来生成一个 如果生成失败或找不到 导入系统将使用模块中的各种可用信息来制作一个默认 它将尝试使用 以及 作为 的输入并将任何丢失的信息赋为默认值 以下是所使用的确切规则 如果模块具有 属性其中的规格信息会被用来生成 被查询的属性有 和 等等 如果模块具有 属性这会被用作模块 的一部分 如果模块没有 但是有 且取值不为 则 加载器的 会被用作模块 的一部分 对于其他情况仅在 中使用模块的 在 版更改 已弃用导入机制现在使用模块规格说明来生成模块 为了向后兼容 如果加载器定义了 方法则会在尝试上述两种方式之前先调用该方法来生成模块 但请注意此方法已弃用 已缓存字节码的失效 在 从 文件加载已缓存字节码之前它会检查缓存是否由最新的 源文件所生成 默认情况下 通过在所写入缓存文件中保存源文件的最新修改时间戳和大小来实现这一点 在运行时导入系统会通过比对缓存文件中保存的元数据和源文件的元数据确定该缓存的有效性 也支持基于哈希的缓存文件即保存源文件内容的哈希值而不是其元数据 存在两种基于哈希的 文件检查型和非检查型 对于检查型基于哈希的 文件 会通过求哈希源文件并将结果哈希值与缓存文件中的哈希值比对来确定缓存有效性 如果检查型基于哈希的缓存文件被确定为失效 会重新生成并写入一个新的检查型基于哈希的缓存文件 对于非检查型 文件只要其存在 就会直接认定缓存文件有效 确定基于哈希的 文件有效性的行为可通过 旗标来重载 在 版更改 增加了基于哈希的 文件 在此之前 只支持基于时间戳来确定字节码缓存的有效性 基于路径的查找器 路径条目查找器 路径条目查找器协议 为了支持模块和已初始化包的导入也为了给命名空间包提供组成部分路径条目查找器必须实现 方法 接受两个参数即要导入模块的完整限定名称以及可选的目标模块 返回模块的完全填充好的规格说明 这个规格说明总是包含加载器集合但有一个例外 为了向导入机制提示该规格说明代表一个命名空间 路径条目查找器会将 设为一个包含该部分的列表 在 版更改 替代了 和 后两者现在都已弃用但会在 未定义时被使用 较旧的路径条目查找器可能会实现这两个已弃用的方法中的一个而没有实现 为保持向后兼容这两个方法仍会被接受 但是如果在路径条目查找器上实现了 这两个遗留方法就会被忽略 接受一个参数即要导入模块的完整限定名称 返回一个 元组其中第一项是加载器而第二项是命名空间 为了向后兼容其他导入协议的实现许多路径条目查找器也同样支持元路径查找器所支持的传统 方法 但是路径条目查找器 方法的调用绝不会带有 参数它们被期望记录来自对路径钩子初始调用的恰当路径信息 路径条目查找器的 方法已弃用因为它不允许路径条目查找器为命名空间包提供部分 如果 和 同时存在于一个路径条目查找器中导入系统将总是调用 而不选择 替换标准导入系统 替换整个导入系统的最可靠机制是移除 的默认内容将其完全替换为自定义的元路径钩子 一个可行的方式是仅改变导入语句的行为而不影响访问导入系统的其他 那么替换内置的 函数可能就够了 这种技巧也可以在模块层级上运用即只在某个模块内部改变导入语句的行为 想要选择性地预先防止在元路径上从一个钩子导入某些模块而不是完全禁用标准导入系统只需直接从 引发 而非返回 就足够了 返回后者表示元路径搜索应当继续而引发异常则会立即终止搜索 包相对导入 相对导入使用前缀点号 一个前缀点号表示相对导入从当前包开始 两个或更多前缀点号表示对当前包的上级包的相对导入第一个点号之后的每个点号代表一级 例如给定以下的包布局结构 不论是在 还是 中以下导入都是有效的 绝对导入可以使用 或 语法但相对导入只能使用第二种形式其中的原因在于 应当提供 作为可用表达式但 不是一个有效的表达式 有关 的特殊事项 对于 的导入系统来说 模块是一个特殊情况 正如在 另一节 中所述 模块是在解释器启动时直接初始化的与 和 很类似 但是与那两者不同它并不被严格归类为内置模块 这是因为 被初始化的方式依赖于发起调用解释器所附带的旗标和其他选项 根据 被初始化的方式 会被设置相应值或是 当 附加 选项启动时 会被设为相应模块或包的模块规格说明 也会在 模块作为执行某个目录 文件或其它 条目的一部分加载时被填充 在 其余的情况 下 会被设为 因为用于填充 的代码不直接与可导入的模块相对应 交互型提示 选项 从 运行 直接从源码或字节码文件运行请注意在最后一种情况中 总是为 即使 文件从技术上说可以作为一个模块被导入 如果想要让 中的元数据生效请使用 开关 还要注意即使是在 对应于一个可导入模块且 被相应地设定时它们仍会被视为 不同的 模块 这是由于以下事实使用 检测来保护的代码块仅会在模块被用来填充 命名空间时而非普通的导入时被执行 开放问题项 参考文献 导入机制自 诞生之初至今已发生了很大的变化 原始的 包规格说明仍然可以查阅但在撰写该文档之后许多相关细节已被修改 原始的 规格说明见 后续的扩展说明见 为 引入了 命名空间包 还引入了 协议作为 的替代 描述了新增的 属性用于在模块中的显式相对导入 引入了绝对和显式相对导入并初次提出了 语义最终由 为 加入规范描述 定义了将模块作为脚本执行 在 对象中增加了对每个模块导入状态的封装 它还将加载器的大部分样板责任移交回导入机制中 这些改变允许弃用导入系统中的一些 并为查找器和加载器增加一些新的方法 脚注 参见 实现避免直接使用返回值 而是通过在 中查找 模块名称来获取模块对象 这种方式的间接影响是被导入的模块可能在 中替换其自身 这属于具体实现的特定行为不保证能在 其他 实现中起作用 在遗留代码中有可能在 中找到 的实例 建议将这些代码修改为使用 代替 详情参见 简单语句 简单语句由一个单独的逻辑行构成 多条简单语句可以存在于同一行内并以分号分隔 简单语句的句法为 表达式语句 表达式语句用于计算和写入值大多是在交互模式下或者通常情况调用一个过程 过程就是不返回有意义结果的函数在 中过程的返回值为 表达式语句的其他使用方式也是允许且有特定用处的 表达式语句的句法为 表达式语句会对指定的表达式列表也可能为单一表达式进行求值 在交互模式下如果结果值不为 它会通过内置的 函数转换为一个字符串该结果字符串将以单独一行的形式写入标准输出例外情况是如果结果为 则该过程调用不产生任何输出 赋值语句 赋值语句用于将名称重绑定到特定值以及修改属性或可变对象的成员项 请参阅 原型 一节了解 属性引用 抽取 和 切片 的句法定义 赋值语句会对指定的表达式列表进行求值注意这可能为单一表达式或是由逗号分隔的列表后者将产生一个元组并将单一结果对象从左至右逐个赋值给目标列表 赋值是根据目标列表的格式递归地定义的 当目标为一个可变对象属性引用 抽取或切片的组成部分时该可变对象必须最终执行赋值并决定其有效性如果赋值操作不可接受也可能引发异常 各种类型可用的规则和引发的异常通过对象类型的定义给出参见 标准类型层级结构 一节 对象赋值的目标对象可以包含于圆括号或方括号内具体操作按以下方式递归地定义 如果目标列表为后面不带逗号 可以包含于圆括号内的单一目标则将对象赋 值给该目标 否则该对象必须为具有与目标列表相同项数的可迭代对象这些项将按从左 至右的顺序被赋值给对应的目标 如果目标列表包含一个带有星号前缀的目标这称为加星目标则该对象 至少必须为与目标列表项数减一相同项数的可迭代对象 该可迭代对象前 面的项将按从左至右的顺序被赋值给加星目标之前的目标 该可迭代对象 末尾的项将被赋值给加星目标之后的目标 然后该可迭代对象中剩余项的 列表将被赋值给加星目标该列表可以为空 否则该对象必须为具有与目标列表相同项数的可迭代对象这些项将按从 左至右的顺序被赋值给对应的目标 对象赋值给单个目标的操作按以下方式递归地定义 如果目标为标识符名称 如果该名称未出现于当前代码块的 或 语句中该名 称将被绑定到当前局部命名空间的对象 否则该名称将被分别绑定到全局命名空间或由 所确定的外层 命名空间的对象 如果该名称已经被绑定则将被重新绑定 这可能导致之前被绑定到该名称的 对象的引用计数变为零造成该对象进入释放过程并调用其析构器如果存在 如果该对象为属性引用引用中的原型表达式会被求值 它应该产生一个具 有可赋值属性的对象否则将引发 该对象会被要求将可赋值 对象赋值给指定的属性如果它无法执行赋值则会引发异常 通常应为 但并不强制要求 注意如果该对象为类实例并且属性引用在赋值运算符的两侧都出现则右侧 表达式 可以访问实例属性或如果实例属性不存在类属性 左侧目 标 将总是设定为实例属性并在必要时创建该实例属性 因此 的两次出现不一定指向相同的属性如果右侧表达式指向一个类属性则左侧 会创建一个新的实例属性作为赋值的目标 此描述不一定作用于描述器属性例如通过 创建的特征属性 如果目标为一个抽取项引用中的原型表达式会被求值 它应当产生一个可 变序列对象例如列表或一个映射对象例如字典 接下来该抽取表 达式会被求值 如果原型为一个可变序列对象例如列表抽取应产生一个整数 如其为 负值则再加上序列长度 结果值必须为一个小于序列长度的非负整数序 列将把被赋值对象赋值给该整数指定索引号的项 如果索引超出范围将会 引发 给被抽取序列赋值不能向列表添加新项 如果原型为一个映射对象例如字典抽取必须具有与该映射的键类型相兼 容的类型然后映射中会创建一个将抽取映射到被赋值对象的键值对 这可 以是替换一个现有键值对并保持相同键值也可以是插入一个新键值对如 果具有相同值的键不存在 对于用户定义对象会调用 方法并附带适当的参数 如果目标为一个切片引用中的原型表达式会被求值 它应当产生一个可变 序列对象例如列表 被赋值对象应当是一个相同类型的序列对象 接下 来下界与上界表达式如果存在的话将被求值默认值分别为零和序列长度 上下边界值应当为整数 如果某一边界为负值则会加上序列长度 求出的 边界会被裁剪至介于零和序列长度的开区间中 最后将要求序列对象以被 赋值序列的项替换该切片 切片的长度可能与被赋值序列的长度不同这会 在目标序列允许的情况下改变目标序列的长度 在当前实现中目标的句法被当作与表达式的句法相同无效的句法会在代码生成阶段被拒绝导致不太详细的错误信息 虽然赋值的定义意味着左手边与右手边的重叠是同时进行的例如 会交换两个变量的值但在赋值给变量的多项集 之内 的重叠是从左至右进行的这有时会令人混淆 例如以下程序将会打印出 参见 扩展的可迭代对象拆包 对 特性的规范说明 增强赋值语句 增强赋值语句就是在单个语句中将二元运算和赋值语句合为一体 请参阅 原型 一节了解最后三种符号的句法定义 增强赋值语句将对目标和表达式列表求值与普通赋值语句不同的是前者不能为可迭代对象拆包对两个操作数相应类型的赋值执行指定的二元运算并将结果赋值给原始目标 目标仅会被求值一次 增强赋值语句例如 可以改写为 获得类似但并非完全等价的效果 在增强赋值的版本中 仅会被求值一次 而且在可能的情况下实际的运算是 原地 执行的也就是说并不是创建一个新对象并将其赋值给目标而是直接修改原对象 不同于普通赋值增强赋值会在对右手边求值 之前 对左手边求值 例如 首先查找 然后对 求值并执行加法操作最后将结果写回到 除了在单个语句中赋值给元组和多个目标的例外情况增强赋值语句的赋值操作处理方式与普通赋值相同 类似地除了可能存在 原地 操作行为的例外情况增强赋值语句执行的二元运算也与普通二元运算相同 对于属性引用类目标针对常规赋值的 关于类和实例属性的警告 也同样适用 带标注的赋值语句 标注 赋值就是在单个语句中将变量或属性标注和可选的赋值语句合为一体 与普通 赋值语句 的差别在于仅允许单个目标 对于将简单名称作为赋值目标的情况如果是在类或模块作用域中标注会被求值并存入一个特殊的类或模块属性 中这是一个将变量名称如为私有会被移除映射到被求值标注的字典 此属性为可写并且在类或模块体开始执行时如果静态地发现标注就会自动创建 对于将表达式作为赋值目标的情况如果是在类或模块作用域中标注会被求值但不会保存 如果一个名称在函数作用域内被标注则该名称为该作用域的局部变量 标注绝不会在函数作用域内被求值和保存 如果存在右手边带标注的赋值会在对标注求值之前如果适用执行实际的赋值 如果用作表达式目标的右手边不存在则解释器会对目标求值但最后的 或 调用除外 参见 变量标注的语法 该提议增加了标注变量也包括类变量和实例变量类型的语法而不再 是通过注释来进行表达 类型提示 该提议增加了 模块以便为类型标注提供标准句法可被静态分 析工具和 所使用 在 版更改 现在带有标注的赋值允许在右边以同样的表达式作为常规赋值 之前某些表达式例如未加圆括号的元组表达式会导致语法错误 语句 语句是在程序中插入调试性断言的简便方式 简单形式 等价于 扩展形式 等价于 以上等价形式假定 和 指向具有指定名称的内置变量 在当前实现中内置变量 在正常情况下为 在请求优化时为 对应命令行选项为 如果在编译时请求优化当前代码生成器不会为 语句发出任何代码 请注意不必在错误信息中包含失败表达式的源代码它会被作为栈追踪的一部分被显示 赋值给 是非法的 该内置变量的值会在解释器启动时确定 语句 是一个空操作 当它被执行时什么都不发生 它适合当语法上需要一条语句但并不需要执行任何代码时用来临时占位例如 语句 删除是递归定义的与赋值的定义方式非常类似 此处不再详细说明只给出一些提示 目标列表的删除将从左至右递归地删除每一个目标 名称的删除将从局部或全局命名空间中移除该名称的绑定具体作用域的确定是看该名称是否有在同一代码块的 语句中出现 如果该名称未被绑定将会引发 属性引用 抽取和切片的删除会被传递给相应的原型对象删除一个切片基本等价于赋值为一个右侧类型的空切片但即便这一点也是由切片对象决定的 在 版更改 在之前版本中如果一个名称作为被嵌套代码块中的自由变量出现则将其从局部命名空间中删除是非法的 语句 在语法上只会出现于函数定义所嵌套的代码不会出现于类定义所嵌套的代码 如果提供了表达式列表它将被求值否则以 替代 会离开当前函数调用并以表达式列表 或 作为返回值 当 将控制流传出一个带有 子句的 语句时该 子句会先被执行然后再真正离开该函数 在一个生成器函数中 语句表示生成器已完成并将导致 被引发 返回值如果有的话会被当作一个参数用来构建 并成为 属性 在一个异步生成器函数中一个空的 语句表示异步生成器已完成并将导致 被引发 一个非空的 语句在异步生成器函数中会导致语法错误 语句 语句在语义上等同于 表达式 语句可用来省略在使用等效的 表达式语句时所必须的圆括号 例如以下 语句 等同于以下 表达式语句 表达式和语句仅在定义 函数时使用并且仅被用于生成器函数的函数体内部 在函数定义中使用 就足以使得该定义创建的是生成器函数而非普通函数 有关 语义的完整细节请参看 表达式 一节 语句 如果不带表达式 会重新引发当前作用域内最后一个激活的异常 如果当前作用域内没有激活的异常将会引发 来提示错误 否则的话 会将第一个表达式求值为异常对象 它必须为 的子类或实例 如果它是一个类当需要时会通过不带参数地实例化该类来获得异常的实例 异常的 类型 为异常实例的类值 为实例本身 当异常被引发时通常会自动创建一个回溯对象并将其关联到可写的 属性 你可以创建一个异常并同时使用 异常方法该方法将返回同一异常实例并将回溯对象设为其参数设置自己的回溯就像这样 子句用于异常串连如果有该子句则第二个 表达式 必须为另一个异常或实例它将作为可写的 属性被关联到所引发的异常 如果引发的异常未被处理两个异常都将被打印出来 如果一个异常在异常处理器或 中被引发类似的机制会隐式地发挥作用之前的异常将被关联到新异常的 属性 异常串连可通过在 子句中指定 来显式地加以抑制 有关异常的更多信息可在 异常 一节查看有关处理异常的信息可在 语句一节查看 在 版更改 现在允许被用作 中的 新版功能 使用 属性来抑制异常上下文的自动显示 语句 在语法上只会出现于 或 循环所嵌套的代码但不会出现于该循环内部的函数或类定义所嵌套的代码 它会终结最近的外层循环如果循环有可选的 子句也会跳过该子句 如果一个 循环被 所终结该循环的控制目标会保持其当前值 当 将控制流传出一个带有 子句的 语句时该 子句会先被执行然后再真正离开该循环 语句 在语法上只会出现于 或 循环所嵌套的代码中但不会出现于该循环内部的函数或类定义中 它会继续执行最近的外层循环的下一个轮次 当 将控制流传出一个带有 子句的 语句时该 子句会先被执行然后再真正开始循环的下一个轮次 语句 语句 语句 是一种针对编译器的指令指明某个特定模块应当使用在特定的未来某个 发行版中成为标准特性的语法或语义 语句的目的是使得向在语言中引入了不兼容改变的 未来版本的迁移更为容易 它允许基于每个模块在某种新特性成为标准之前的发行版中使用该特性 语句必须在靠近模块开头的位置出现 可以出现在 语句之前行只有 模块的文档字符串如果存在 注释 空行以及 其他 语句 唯一需要使用 语句的特性是 标注 参见 语句所启用的所有历史特性仍然为 所认可 其中包括 和 它们都已成为冗余项因为它们总是为已启用状态保留它们只是为了向后兼容 语句在编译时会被识别并做特殊对待对核心构造语义的改变常常是通过生成不同的代码来实现 新的特性甚至可能会引入新的不兼容语法例如新的保留字在这种情况下编译器可能需要以不同的方式来解析模块 这样的决定不能推迟到运行时方才作出 对于任何给定的发布版本编译器要知道哪些特性名称已被定义如果某个 语句包含未知的特性则会引发编译时错误 直接运行时的语义与任何 语句相同存在一个后文将详细说明的标准模块 它会在执行 语句时以通常的方式被导入 相应的运行时语义取决于 语句所启用的指定特性 请注意以下语句没有任何特别之处 这并非 语句它只是一条没有特殊语义或语法限制的普通 语句 在默认情况下通过对 内置函数 和 的调用所编译的代码如果出现于一个包含有 语句的模块 之中就会使用 语句所关联的语法和语义 此行为可以通过 的可选参数加以控制 请参阅该函数的文档以了解详情 在交互式解释器提示符中键入的 语句将在解释器会话此后的交互中有效 如果一个解释器的启动使用了 选项启动并传入了一个脚本名称来执行且该脚本包含 语句它将在交互式会话开始执行脚本之后保持有效 参见 回到 有关 机制的最初提议 语句 语句是作用于整个当前代码块的声明 它意味着所列出的标识符将被解读为全局变量 要给全局变量赋值不可能不用到 关键字不过自由变量也可以指向全局变量而不必声明为全局变量 在 语句中列出的名称不得在同一代码块内该 语句之前的位置中使用 在 语句中列出的名称不得被定义为正式形参不也得出现于 循环的控制目标 定义 函数定义 语句或变量标注之中 当前的实现并未强制要求所有的上述限制但程序不应当滥用这样的自由因为未来的实现可能会改为强制要求并静默地改变程序的含义 程序员注意事项 是对解析器的指令 它仅对与 语句同时被解析的代码起作用 特别地包含在提供给内置 函数字符串或代码对象中的 语句并不会影响 包含 该函数调用的代码块而包含在这种字符串中的代码也不会受到包含该函数调用的代码中的 语句影响 这同样适用于 和 函数 语句 语句会使得所列出的名称指向之前在最近的包含作用域中绑定的除全局变量以外的变量 这种功能很重要因为绑定的默认行为是先搜索局部命名空间 这个语句允许被封装的代码重新绑定局部作用域以外且非全局模块作用域当中的变量 与 语句中列出的名称不同 语句中列出的名称必须指向之前存在于包含作用域之中的绑定在这个应当用来创建新绑定的作用域不能被无歧义地确定 语句中列出的名称不得与之前存在于局部作用域中的绑定相冲突 参见 访问外层作用域中的名称 有关 语句的规范说明 概述 其他实现 标注 表达式 本章将解释 中组成表达式的各种元素的的含义 语法注释 在本章和后续章节中会使用扩展 标注来描述语法而不是词法分析 当某种替代的语法规则具有如下形式 并且没有给出语义则这种形式的 在语法上与 相同 算术转换 原子 原子指表达式的最基本构成元素 最简单的原子是标识符和字面值 以圆括号 方括号或花括号包括的形式在语法上也被归类为原子 原子的句法为 标识符名称 作为原子出现的标识符叫做名称 请参看 标识符和关键字 一节了解其词法定义以及 命名与绑定 获取有关命名与绑定的文档 当名称被绑定到一个对象时对该原子求值将返回相应对象 当名称未被绑定时尝试对其求值将引发 异常 私有名称转换 当以文本形式出现在类定义中的一个标识符以两个或更多下划线开头并且不以两个或更多下划线结尾它会被视为该类的 私有名称 私有名称会在为其生成代码之前被转换为一种更长的形式 转换时会插入类名移除打头的下划线再在名称前增加一个下划线 例如出现在一个名为 的类中的标识符 会被转换为 这种转换独立于标识符所使用的相关句法 如果转换后的名称太长超过 个字符可能发生由具体实现定义的截断 如果类名仅由下划线组成则不会进行转换 字面值 支持字符串和字节串字面值以及几种数字字面值 对字面值求值将返回一个该值所对应类型的对象字符串 字节串 整数 浮点数 复数 对于浮点数和虚数复数的情况该值可能为近似值 详情参见 字面值 所有字面值都对应与不可变数据类型因此对象标识的重要性不如其实际值 多次对具有相同值的字面值求值不论是发生在程序文本的相同位置还是不同位置可能得到相同对象或是具有相同值的不同对象 带圆括号的形式 列表 集合与字典的显示 为了构建列表 集合或字典 提供了名为显示的特殊句法每个类型各有两种形式 第一种是显式地列出容器内容 第二种是通过一组循环和筛选指令计算出来称为 推导式 推导式的常用句法元素为 推导式的结构是一个单独表达式后面加至少一个 子句以及零个或更多个 或 子句 在这种情况下新容器的元素产生方式是将每个 或 子句视为一个代码块按从左至右的顺序嵌套然后每次到达最内层代码块时就对表达式进行求值以产生一个元素 不过除了最左边 子句中的可迭代表达式推导式是在另一个隐式嵌套的作用域内执行的 这能确保赋给目标列表的名称不会泄露到外层的作用域 最左边的 子句中的可迭代对象表达式会直接在外层作用域中被求值然后作为一个参数被传给隐式嵌套的作用域 后续的 子句以及最左侧 子句中的任何筛选条件不能在外层作用域中被求值因为它们可能依赖于从最左侧可迭代对象中获得的值 例如 为了确保推导式得出的结果总是一个类型正确的容器在隐式嵌套作用域内禁止使用 和 表达式 从 开始在 函数中可以使用 子句来迭代 在 函数中构建推导式可以通过在打头的表达式后加上 或 子句也可能包含额外的 或 子句还可能使用 表达式 如果一个推导式包含 子句或者 表达式则被称为 异步推导式 异步推导式可以暂停执行它所在的协程函数 另请参阅 新版功能 引入了异步推导式 在 版更改 和 在隐式嵌套的作用域中已被禁用 列表显示 列表显示是一个用方括号括起来的可能为空的表达式系列 列表显示会产生一个新的列表对象其内容通过一系列表达式或一个推导式来指定 当提供由逗号分隔的一系列表达式时其元素会从左至右被求值并按此顺序放入列表对象 当提供一个推导式时列表会根据推导式所产生的结果元素进行构建 集合显示 集合显示是用花括号标明的与字典显示的区别在于没有冒号分隔的键和值 集合显示会产生一个新的可变集合对象其内容通过一系列表达式或一个推导式来指定 当提供由逗号分隔的一系列表达式时其元素会从左至右被求值并加入到集合对象 当提供一个推导式时集合会根据推导式所产生的结果元素进行构建 空集合不能用 来构建该字面值所构建的是一个空字典 字典显示 字典显示是一个用花括号括起来的可能为空的键数据对系列 字典显示会产生一个新的字典对象 如果给出一个由逗号分隔的键数据对序列它们会从左至右被求值以定义字典的条目每个键对象会被用作在字典中存放相应数据的键 这意味着你可以在键数据对序列中多次指定相同的键最终字典的值将由最后一次给出的键决定 双星号 表示 字典拆包 它的操作数必须是一个 每个映射项被会加入新的字典 后续的值会替代先前的键数据对和先前的字典拆包所设置的值 新版功能 拆包到字典显示最初由 提出 字典推导式与列表和集合推导式有所不同它需要以冒号分隔的两个表达式后面带上标准的 和 子句 当推导式被执行时作为结果的键和值元素会按它们的产生顺序被加入新的字典 对键取值类型的限制已列在之前的 标准类型层级结构 一节中 总的说来键的类型应该为 这就把所有可变对象都排除在外 重复键之间的冲突不会被检测指定键所保存的最后一个数据 即在显示中排最右边的文本为最终有效数据 在 版更改 在 之前的字典推导式中并没有定义好键和值的求值顺序 在 中值会先于键被求值 根据 的提议从 开始键会先于值被求值 生成器表达式 表达式 原型 原型代表编程语言中最紧密绑定的操作 它们的句法如下 属性引用 属性引用是后面带有一个句点加一个名称的原型 此原型必须求值为一个支持属性引用的类型的对象多数对象都支持属性引用 随后该对象会被要求产生以指定标识符为名称的属性 这个产生过程可通过重载 方法来自定义 如果这个属性不可用则将引发 异常 否则的话所产生对象的类型和值会根据该对象来确定 对同一属性引用的多次求值可能产生不同的对象 抽取 对序列字符串 元组或列表或映射字典对象的抽取操作通常就是从相应的多项集中选择一项 此原型必须求值为一个支持抽取操作的对象例如列表或字典 用户定义的对象可通过定义 方法来支持抽取操作 对于内置对象有两种类型的对象支持抽取操作如果原型为映射表达式列表必须求值为一个以该映射的键为值的对象抽取操作会在映射中选出该键所对应的值 表达式列表为一个元组除非其中只有一项 如果原型为序列表达式列表必须求值为一个整数或一个切片详情见下节 正式句法规则并没有在序列中设置负标号的特殊保留条款但是内置序列所提供的 方法都可通过在索引中添加序列长度来解析负标号 这样 会选出 中的最后一项 结果值必须为一个小于序列中项数的非负整数抽取操作会选出标号为该值的项从零开始数 由于对负标号和切片的支持存在于对象的 方法重载此方法的子类需要显式地添加这种支持 字符串的项是字符 字符不是单独的数据类型而是仅有一个字符的字符串 对特定 类 或 类型 的抽取操作会创建一个 泛型别名 在此情况下用户自定义类型可通过提供 类方法来支持抽取操作 切片 调用 表达式 挂起 的执行以等待一个 对象 只能在 内部使用 新版功能 幂运算符 幂运算符的绑定比在其左侧的一元运算符更紧密但绑定紧密程度不及在其右侧的一元运算符 句法如下 因此在一个未加圆括号的幂运算符和单目运算符序列中运算符将从右向左求值这不会限制操作数的求值顺序 结果将为 幂运算符与附带两个参数调用内置 函数具有相同的语义结果为对其左参数进行其右参数所指定幂次的乘方运算 数值参数会先转换为相同类型结果也为转换后的类型 对于 类型的操作数结果将具有与操作数相同的类型除非第二个参数为负数在那种情况下所有参数会被转换为 类型并输出 类型的结果 例如 返回 而 返回 对 进行负数幂次运算将导致 对负数进行分数幂次运算将返回 数值 在早期版本中这将引发 一元算术和位运算 所有算术和位运算具有相同的优先级 一元运算符 负 会产生其数值参数的负值 一元运算符 正 会产生与其数值参数相同的值 一元运算符 取反 的结果是对其整数参数按位取反 的按位取反被定义为 它只作用于整数 在所有三种情况下如果参数的类型不正确将引发 异常 二元算术运算符 移位运算 移位运算的优先级低于算术运算 这些运算符接受整数参数 它们会将第一个参数左移或右移第二个参数所指定的比特位数 右移 位被定义为被 整除 左移 位被定义为乘以 二元位运算 三种位运算具有各不相同的优先级 运算符 对两个参数进行按位 与 运算两个参数必须为整数 运算符 对两个参数进行按位 异或 运算两个参数必须为整数 运算符 对两个参数进行按位 或 运算两个参数必须为整数 比较运算 值比较 成员检测运算 运算符 和 用于成员检测 如果 是 的成员则 求值为 否则为 返回 取反后的值 所有内置序列和集合类型以及字典都支持此运算对于字典来说 检测其是否有给定的键 对于 或 这样的容器类型表达式 等价于 对于字符串和字节串类型来说当且仅当 是 的子串时 为 一个等价的检测是 空字符串总是被视为任何其他字符串的子串因此 将返回 对于定义了 方法的用户自定义类来说如果 返回真值则 返回 否则返回 对于未定义 但定义了 的用户自定义类来说如果在对 进行迭代时产生了值 使得表达式 为真则 为 如果在迭代期间引发了异常则等同于 引发了该异常 最后将会尝试旧式的迭代协议如果一个类定义了 则当且仅当存在非负整数索引号 使得 并且没有更小的索引号引发 异常时 为 如果引发了任何其他异常则等同于 引发了该异常 运算符 被定义为具有与 相反的逻辑值 标识号比较 运算符 和 用于检测对象的标识号当且仅当 和 是同一对象时 为真 一个对象的标识号可使用 函数来确定 会产生相反的逻辑值 布尔运算 赋值表达式 赋值表达式有时又被叫做命名表达式或海象表达式将一个 赋值给一个 同时还返回 的值 一个常见用例是在处理匹配的正则表达式的时候 或者是在处理分块的文件流的时候 新版功能 请参阅 了解有关赋值表达式的详情 条件表达式 条件表达式有时称为三元运算符在所有 运算中具有最低的优先级 表达式 首先是对条件 而非 求值 如果 为真 将被求值并返回其值否则将对 求值并返回其值 请参阅 了解有关条件表达式的详情 表达式 表达式有时称为 构型被用于创建匿名函数 表达式 会产生一个函数对象 该未命名对象的行为类似于用以下方式定义的函数 请参阅 函数定义 了解有关参数列表的句法 请注意通过 表达式创建的函数不能包含语句或标注 表达式列表 求值顺序 运算符优先级 